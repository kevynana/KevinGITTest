-* File ADV_SUM.fex
JOIN AIR_KEY IN AYMETX TO ALL AIR_KEY IN SYMETX AS J1
END

DEFINE FILE AYMETX
ADV_CAT/A30=
IF ADV_PURCH GT 0 AND ADV_PURCH LE 6 THEN '0-6 Advance Purchase Days' ELSE
IF ADV_PURCH GT 6 AND ADV_PURCH LE 13 THEN '7-13 Advance Purchase Days' ELSE
IF ADV_PURCH GT 13 AND ADV_PURCH LE 20 THEN '14-20 Advance Purchase Days' ELSE
'21+ Advance Purchase Days';
ADV_CNT/A1=
IF ADV_PURCH GT 0 AND ADV_PURCH LE 6 THEN '1' ELSE
IF ADV_PURCH GT 6 AND ADV_PURCH LE 13 THEN '2' ELSE
IF ADV_PURCH GT 13 AND ADV_PURCH LE 20 THEN '3' ELSE
'4';
MONTHM/M = TRN_DATE;
YEAR/A2Y = TRN_DATE;
QTRX/A2 = IF MONTHM EQ '01' OR '02' OR '03' THEN '1Q' ELSE
         IF MONTHM EQ '04' OR '05' OR '06' THEN '2Q' ELSE
		 IF MONTHM EQ '07' OR '08' OR '09' THEN '3Q' ELSE
		 '4Q';
QTR/A4 = QTRX||YEAR;
FARE_PAID/D12.2 = SEG_AMT + SEG_TAX;
LOST/D12.2 = FARE_PAID - SEG_LOWEST;
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND
                           (CONJ_REL EQ 1) THEN 1 ELSE
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (EX_FLAG EQ 'F') THEN (-1) ELSE
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
SPACE/A1 = ' ';
END
TABLE FILE AYMETX
SUM NET_TKT_CNT
    FARE_PAID
	LOST
	SPACE
BY ADV_CNT
BY ADV_CAT
BY QTR
ON TABLE HOLD
END

TABLE FILE HOLD
-* SUM *
SUM NET_TKT_CNT/I7CS AS 'Count' FARE_PAID/D12CS AS 'Fare Paid' LOST/D12CS AS 'Lost,Amount'
AND COMPUTE ATP/D9 = FARE_PAID/NET_TKT_CNT; SPACE AS ''
ACROSS ADV_CNT NOPRINT
ACROSS ADV_CAT AS ' '
BY QTR AS 'Quarter'
BY SPACE AS ''
ON TABLE RECOMPUTE AS TOTAL
ON TABLE SET PAGE-NUM OFF
ON TABLE PCHOLD FORMAT PDF
ON TABLE SET HTMLCSS ON
ON TABLE SET STYLE *
     UNITS=IN,
     PAGESIZE='Letter',
     SQUEEZE=ON,
     ORIENTATION=LANDSCAPE,
$
TYPE=REPORT,
     GRID=OFF,
     FONT='ARIAL',
     SIZE=6,
     COLOR='BLACK',
     BACKCOLOR='NONE',
     STYLE=NORMAL,
	 SQUEEZE=ON,
	 RIGHTGAP=0.125000,
	 LEFTGAP=0.125000,
$
TYPE=DATA,
     SIZE=6,
     BACKCOLOR=( RGB(234 234 255) 'WHITE' ),
$
TYPE=DATA,
     COLUMN=N1,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=DATA,
     COLUMN=N7,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=DATA,
     COLUMN=N12,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=DATA,
     COLUMN=N17,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=TITLE,
     STYLE=BOLD,
$
TYPE=TABHEADING,
     SIZE=6,
     STYLE=BOLD,
$
TYPE=TABFOOTING,
     SIZE=6,
     STYLE=BOLD,
$
TYPE=HEADING,
     SIZE=6,
     STYLE=BOLD,
$
TYPE=FOOTING,
     SIZE=6,
     STYLE=BOLD,
$
TYPE=SUBHEAD,
     SIZE=6,
     STYLE=BOLD,
$
TYPE=SUBFOOT,
     SIZE=6,
     STYLE=BOLD,
$
TYPE=SUBTOTAL,
     BACKCOLOR=RGB(210 210 210),
$
TYPE=ACROSSVALUE,
     SIZE=6,
$
TYPE=ACROSSTITLE,
     STYLE=BOLD,
$
TYPE=GRANDTOTAL,
     BACKCOLOR=RGB(210 210 210),
     STYLE=BOLD,
$
TYPE=GRANDTOTAL,
     COLUMN=N1,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=GRANDTOTAL,
     COLUMN=N7,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=GRANDTOTAL,
     COLUMN=N12,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
TYPE=GRANDTOTAL,
     COLUMN=N17,
     SIZE=6,
     BACKCOLOR=( RGB(255 255 255) 'WHITE' ),
$
ENDSTYLE
END
