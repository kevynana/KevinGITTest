-* File BLD_ROLL.FEX
-*   Builds a eTTek Review environment for a specific Rollup
-* 
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            DELETED CREATEMSG AND SEQUENCE
-*                                  THEY DO NOT APPLY IN WEBFOCUS
-**********************************************************************

-SET &&ROLLTAG = 'NATB-R';

-*SET CREATEMSG = OFF
SET FIELDNAME = NEW
SET FUSE = FUSE
SET MESSAGE = ON
-*SET SEQUENCE = OFF
-RUN

-TYPE Tabling ROLLUP
TABLE FILE ROLLUP
PRINT ROLLUP_CODE
IF ROLLUP_CODE NE &&ROLLTAG
ON TABLE HOLD
END
-RUN

-TYPE Building ROLLUP
MODIFY FILE ROLLUP
FIXFORM ROLLUP_CODE/A8
MATCH ROLLUP_CODE
  ON MATCH DELETE
  ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-TYPE Reorg on ROLLUP
REBUILD
REBUILD
ROLLUP
N

-TYPE Tabling ROLLQTR
TABLE FILE ROLLQTR
PRINT ROLLUP_CODE
IF ROLLUP_CODE NE &&ROLLTAG
ON TABLE HOLD
END
-RUN

-TYPE Building ROLLQTR
MODIFY FILE ROLLQTR
FIXFORM ROLLUP_CODE/A8
MATCH ROLLUP_CODE
  ON MATCH DELETE
  ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-TYPE Reorg on ROLLQTR
REBUILD
REBUILD
ROLLQTR
N

-TYPE Tabling RPT_INST
DEFINE FILE RPT_INST
  ROLLUP_CODE/A8 = SUBSTR(72, INST_KEY, 1, 8, 8, 'A8');
END
-RUN

TABLE FILE RPT_INST
PRINT INST_KEY
IF ROLLUP_CODE NE &&ROLLTAG
ON TABLE HOLD
END
-RUN

-TYPE Building RPT_INST
MODIFY FILE RPT_INST
FIXFORM INST_KEY/A72
MATCH INST_KEY
  ON MATCH DELETE
  ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-TYPE Reorg on ROLLUP
REBUILD
REBUILD
RPT_INST
N

-TYPE Tabling IHIER_SL
DEFINE FILE IHIER_SL
  ROLLUP_CODE/A8 = SUBSTR(72, INST_KEY, 1, 8, 8, 'A8');
END
-RUN

TABLE FILE IHIER_SL
PRINT INST_KEY AND SEL_KEY
IF ROLLUP_CODE NE &&ROLLTAG
ON TABLE HOLD
END
-RUN

-TYPE Building IHIER_SL
MODIFY FILE IHIER_SL
FIXFORM INST_KEY/A72 SEL_KEY/A34
MATCH INST_KEY SEL_KEY
  ON MATCH DELETE
  ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-TYPE Reorg on IHIER_SL
REBUILD
REBUILD
IHIER_SL
N

-TYPE Tabling IHIER_BK
DEFINE FILE IHIER_BK
  ROLLUP_CODE/A8 = SUBSTR(72, INST_KEY, 1, 8, 8, 'A8');
END
-RUN

TABLE FILE IHIER_BK
PRINT INST_KEY AND HIER_LEVEL
IF ROLLUP_CODE NE &&ROLLTAG
ON TABLE HOLD
END
-RUN

-TYPE Building IHIER_BK
MODIFY FILE IHIER_BK
FIXFORM INST_KEY/A72 HIER_LEVEL/A2
MATCH INST_KEY HIER_LEVEL
  ON MATCH DELETE
  ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-TYPE Reorg on IHIER_BK
REBUILD
REBUILD
IHIER_BK
N

-TYPE Tabling RPT_SET
TABLE FILE RPT_SET
PRINT SET_KEY
IF ROLLUP_CODE NE &&ROLLTAG
ON TABLE HOLD
END
-RUN

-TYPE Building RPT_SET
MODIFY FILE RPT_SET
FIXFORM SET_KEY/A30
MATCH SET_KEY
  ON MATCH DELETE
  ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-TYPE Reorg on RPT_SET
REBUILD
REBUILD
RPT_SET
N
