-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Created for the new quarterly review - JK 8/2/05
-* CHANGED AVG STAY TO USE NUM_DAYS INSTEAD OF NNROOMS 
-* CARRIED THROUGH NBR_DAYS - DV 3/28/13
-* Joy Updated Pref_Non define to contain C/P/N/M/L
-* 9/9/14 Updated Pref_non define to use exclude_flags - jk

-******************************************************************************

-INCLUDE SETECHO
SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

DEFINE FILE &&EXTRACT 
-*  PROP_CITY1/A25 = LCWORD(25, PROP_CITY, PROP_CITY1);
  CITY_ST/A36 = PROP_CITY||(' '| PROP_STATE);
  INV_DATE/MDYY = INVOICE_DATE;
  NEW_ROOM_RATE/D12.2C = ROOM_RATE;
  NEW_TOTAL_AMT/D12.2C = TOTAL_AMT;
  NBR_DAYS/D12 =  NUM_DAYS; 
  NNROOMS/D12 = IF (NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)
                THEN ((NBR_DAYS*NUM_ROOMS)*(-1))
                ELSE NBR_DAYS*NUM_ROOMS;           
-*  PREF_NON/A15 = IF CLIENT_PREF EQ 'C' OR 'P' OR 'N' OR 'M' OR 'L' THEN 'P' ELSE 'N';
 PNP_FLAG/A1 = EDIT(EXCLUDE_FLAGS, '$9');
 PNP_IE/A1 = EDIT(EXCLUDE_FLAGS, '$$9');
PREF_NON/A15 = IF PNP_FLAG EQ 'I' THEN 'P' ELSE 'N';
-*  PREF_NNR/D12 = IF CLIENT_PREF EQ 'C' OR 'P' OR 'N' OR 'M' OR 'L' THEN NNROOMS ELSE 0; 
PREF_NNR/D12 = IF PNP_FLAG EQ 'I' THEN NNROOMS ELSE 0;
  
  
-* ***DEFINES ON PREVIOUS DEFINED DEFINES***
 BOOKINGS/D12 = IF NEW_TOTAL_AMT GE 0 THEN 1 ELSE (-1);
 HTL_CNT/D12 = IF PROP_NAME NE LAST PROP_NAME THEN 1 ELSE 0;
END


TABLEF FILE &&EXTRACT
PRINT BOOKINGS
      CHAIN_CODE
      CITY_ST
      HTL_CNT
      INVOICE_DATE
      NEW_TOTAL_AMT
      NNROOMS
      NBR_DAYS
      PREF_NNR
-INCLUDE &HTLDATES 
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTLHOLD

END
-RUN
