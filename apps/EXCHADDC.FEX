-*7/01/15 - JEK - STORY ID - S-09964 - updated programs/created new routine for add collects and airline fees for request and to balance to other reports
-*7/02/15 - DV - S-10078 - ADDED ABVASAV TO KIEW ROUTINE DUE TO REPORT FAILING
-*7/06/15 - JK - S-10087 - Removed goto for any version other than Kiewit...skipping around the EXCHADDC program completley if not Kiewit
-INCLUDE SETECHO
 
SET ASNAMES = ON

-IF &&SETF EQ 'KWEXSM' GOTO KIEW;

DEFINE FILE &&RPT_HOLD
AC_AMT/D12.2 = IF TKT_SORT NE LAST TKT_SORT THEN ADDCOLLECT ELSE 0;
AP_DAYS/D9 = IF TKT_NUM NE LAST TKT_NUM THEN NEW_ADV_PURCH ELSE 0;
FARE/D12.2CS = (FARE_PAID * (-1));
 PNLTY_AMT/D12.2CS = 0;
ORGSALE/D12.2CS = 0;
C_ITIN2/A67 = IF C_ITIN EQ ' ' THEN 'MISCELL. CHARGE -MCO' ELSE C_ITIN;
END
-RUN
TABLE FILE &&RPT_HOLD
PRINT ADDCOLLECT
  TKT_DATE
  C_ITIN2 AS 'C_ITIN'  
  AP_DAYS
  TKT_NUM 
  DOC_NUMBER 
  EX_FLAG
  VAL_AIRLINE
  PNLTY_AMT
  AC_AMT
  FST_DPT_DATE
  FARE 
  ORGSALE
  NET_TKT_CNT
  PNR_LOCATOR
  TKT_PURCH
  EXG_ISS
  PEXG_ISS1 AS 'PEXG_ISS'
  INTL_DOM
  
BY LEVEL_DESC
BY XPSNGR_NM
BY AIRLINE_NAME
BY TKT_SORT
BY TRN_DATE
WHERE EX_FLAG NE ' ' 
ON TABLE HOLD AS EXHOLD FORMAT FOCUS
END
-RUN


TABLE FILE &&RPT_HOLD
SUM TKT_NUM
BY TKT_NUM NOPRINT
ON TABLE SAVE AS EXCHG
END
-RUN



DEFINE FILE &&RPT_HOLD
PNLTY_AMT/D12.2 = IF TKT_SORT NE LAST TKT_SORT THEN AIRLINE_FEE ELSE 0;
DOCNBR/A9 = EDIT(DOC_NUMBER, '$999999999');
AP_DAYS/D9 = IF TKT_NUM NE LAST TKT_NUM THEN NEW_ADV_PURCH ELSE 0;
FARE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN FARE_PAID2 ELSE 0;
ORGSALE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN ORG_SALE ELSE 0;
AC_AMT/D12.2CS = IF ORGSALE GT FARE THEN 0 ELSE FARE - ORGSALE;
C_ITIN2/A67 = IF C_ITIN EQ ' ' THEN 'MISCELL. CHARGE -MCO' ELSE C_ITIN;
END
TABLE FILE &&RPT_HOLD
PRINT 
  TKT_DATE 
  C_ITIN2 AS 'C_ITIN'  
  AP_DAYS
  TKT_NUM 
  DOC_NUMBER 
  EX_FLAG
  VAL_AIRLINE 
  PNLTY_AMT
  AC_AMT 
  FST_DPT_DATE
  FARE 
  ORGSALE
  NET_TKT_CNT
  PNR_LOCATOR
  TKT_PURCH
  EXG_ISS
  PEXG_ISS1 AS 'PEXG_ISS'
  INTL_DOM

BY LEVEL_DESC
BY XPSNGR_NM
BY AIRLINE_NAME
BY TKT_SORT
BY TRN_DATE 
WHERE DOC_NUMBER IN FILE EXCHG
WHERE EX_FLAG EQ ' '

ON TABLE HOLD AS EXHOLD2 FORMAT FOCUS
END
-RUN
-GOTO ENDit;


TABLE FILE EXHOLD2
SUM FARE ORGSALE AC_AMT
BY LEVEL_DESC
-*BY AIRLINE_NAME
ON TABLE COLUMN-TOTAL
-* ON TABLE HOLD AS EXCAIR2
END
-RUN
-QUIT

-KIEW;

DEFINE FILE VASAV1
AC_AMT/D12.2 = IF TKT_SORT NE LAST TKT_SORT THEN ADDCOLLECT ELSE 0;
AP_DAYS/D9 = IF TKT_NUM NE LAST TKT_NUM THEN NEW_ADV_PURCH ELSE 0;
FARE/D12.2CS = (FARE_PAID * (-1));
 PNLTY_AMT/D12.2CS = 0;
ORGSALE/D12.2CS = 0;
C_ITIN2/A67 = IF C_ITIN EQ ' ' THEN 'MISCELL. CHARGE -MCO' ELSE C_ITIN;
END
-RUN
TABLE FILE VASAV1
PRINT ADDCOLLECT
  TKT_DATE
  C_ITIN2 AS 'C_ITIN'  
  AP_DAYS
  TKT_NUM 
  DOC_NUMBER 
  EX_FLAG
  VAL_AIRLINE
  PNLTY_AMT
  AC_AMT
  FST_DPT_DATE
  FARE 
  ORGSALE
  NET_TKT_CNT
  PNR_LOCATOR
  TKT_PURCH
  EXG_ISS
  CG_PCNT AS 'PEXG_ISS'
  INTL_DOM
  
BY LEVEL_DESC
BY XPSNGR_NM
BY AIRLINE_NAME
BY TKT_SORT
BY TRN_DATE
WHERE EX_FLAG NE ' ' 
ON TABLE HOLD AS EXHOLD FORMAT FOCUS
END
-RUN


TABLE FILE VASAV1
SUM TKT_NUM
BY TKT_NUM NOPRINT
ON TABLE SAVE AS EXCHG
END
-RUN



DEFINE FILE VASAV1
PNLTY_AMT/D12.2 = IF TKT_SORT NE LAST TKT_SORT THEN AIRLINE_FEE ELSE 0;
DOCNBR/A9 = EDIT(DOC_NUMBER, '$999999999');
AP_DAYS/D9 = IF TKT_NUM NE LAST TKT_NUM THEN NEW_ADV_PURCH ELSE 0;
FARE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN FARE_PAID2 ELSE 0;
ORGSALE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN ORG_SALE ELSE 0;
AC_AMT/D12.2CS = IF ORGSALE GT FARE THEN 0 ELSE FARE - ORGSALE;
C_ITIN2/A67 = IF C_ITIN EQ ' ' THEN 'MISCELL. CHARGE -MCO' ELSE C_ITIN;
END
TABLE FILE VASAV1
PRINT 
  TKT_DATE 
  C_ITIN2 AS 'C_ITIN'  
  AP_DAYS
  TKT_NUM 
  DOC_NUMBER 
  EX_FLAG
  VAL_AIRLINE 
  PNLTY_AMT
  AC_AMT 
  FST_DPT_DATE
  FARE 
  ORGSALE
  NET_TKT_CNT
  PNR_LOCATOR
  TKT_PURCH
  EXG_ISS
  CG_PCNT AS 'PEXG_ISS'
  INTL_DOM

BY LEVEL_DESC
BY XPSNGR_NM
BY AIRLINE_NAME
BY TKT_SORT
BY TRN_DATE 
WHERE DOC_NUMBER IN FILE EXCHG
WHERE EX_FLAG EQ ' '

ON TABLE HOLD AS EXHOLD2 FORMAT FOCUS
END
-RUN
-GOTO ENDit;


TABLE FILE EXHOLD2
SUM FARE ORGSALE AC_AMT
BY LEVEL_DESC
-*BY AIRLINE_NAME
ON TABLE COLUMN-TOTAL
-* ON TABLE HOLD AS EXCAIR2
END
-RUN
-QUIT


-ENDit