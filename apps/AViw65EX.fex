-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AIREXTRT.FEX
-********************************************************************
-* MODIFICAIONS:
-* 5/22/1998 ADDED TRN_DATE CRITERIA TO WHERE STATEMENTS - LP
-* 7/09/1998 ADDED A DEFINE FOR TICKETLESS MIR TRANSACTIONS - LP
-* 10/17/01 ADDED A DEFINE (UPCOSTC) TO CAPTURE CTS BOOKINGS - JK
-* 4/29/2002 CHANGED MRK_TKT_CNT DEFINE TO CORRECTLY BACK OUT PARTIAL
-*           REFUNDS AND EXCHANGES SC DB
-* 4/2/2004  ADDED TKT_PURCH DEFINE JK
-* 4/2/2004  ADDED ROLLUP CODE SELECTION TO INCLUDE VOIDS FOR JHA
-* ADDED TRANTYPE INCLUDE - JK 12/15/14 STORY ID S-06492

-********************************************************************
-*
-* This program extracts data for the series of basic ticket listing
-* reports.  Based on the user profile selected, one of many report
-* formats will be produced.  
-*
-********************************************************************

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
LEVEL_DESC/A60      = &&LDESC;
MRK_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
  NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  NEW_SEG_COUNT/D8CS = SEG_COUNT;
  TRAN_MONTH/MT        = TRN_DATE;
  TKT_PURCH/D12 = IF (SEG_NBR EQ '01') AND (SEG_AMT+SEG_TAX GE 0) AND 
                     (SEG_COUNT EQ 1)
                      THEN 1 ELSE 0;
  
  XDPT_DT/MDYY         = DPT_DATE;
  XDPT_DATE/MDY        = DPT_DATE;
  XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  XTRAN_DT/MDYY        = TRN_DATE;

-INCLUDE TRANTYPE  
  
END
-RUN

-IF &&ROLLUP EQ 'JHA-R' THEN GOTO JHA ELSE GOTO STD;
-RUN

-STD
TABLEF FILE &&EXTRACT
PRINT 
  AGENT_NUM	
  AIR_KEY	
  AIRLINE	
  AIRLINE_NAME
  DPT_TIME	
  EMB_CTY.CITY_NAME    AS 'EMB_CTY_NM'	
  FARE_PAID	
  LEVEL_DESC	
  MRK_TKT_CNT	
  NET_TKT_CNT	
  NEW_SEG_COUNT	
  REFUSE_CODE	
  RTE_CTY.CITY_NAME    AS 'RTE_CTY_NM'	
  SEG_COUNT	
  SEG_NBR	
  TKT_NUM
  TKT_PURCH	
  TKT_SORT
  TRN_DATE	
  XDPT_DT	
  XDPT_DATE
  XPSNGR_NM
  XTRAN_DT	


-INCLUDE &AIRDATES

WHERE VOID_DATE EQ 0

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD
END
-RUN

-GOTO XXIT

-JHA
TABLEF FILE &&EXTRACT
PRINT 
  AGENT_NUM	
  AIR_KEY	
  AIRLINE	
  AIRLINE_NAME
  DPT_TIME	
  EMB_CTY.CITY_NAME    AS 'EMB_CTY_NM'	
  FARE_PAID	
  LEVEL_DESC	
  MRK_TKT_CNT	
  NET_TKT_CNT	
  NEW_SEG_COUNT	
  REFUSE_CODE	
  RTE_CTY.CITY_NAME    AS 'RTE_CTY_NM'	
  SEG_COUNT	
  SEG_NBR	
  TKT_NUM
  TKT_PURCH	
  TKT_SORT	
  TRN_DATE	
  XDPT_DT	
  XDPT_DATE
  XPSNGR_NM
  XTRAN_DT	


-INCLUDE &AIRDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


-XXIT

