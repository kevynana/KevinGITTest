-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**


SET ASNAMES=ON


DEFINE FILE OVMXRHLD
FARE_PAID/D12.2 = SEG_AMT + SEG_TAX ;

CY/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND
                TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PY/A1 =  IF TRN_DATE GE &&FXDATE.EVAL AND
               TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
NON_FLAG/A15 = IF NONREF_FLAG EQ 'N' THEN 'NON-REFUNDABLE' ELSE 
               'REFUNDABLE';
NET_TKT_CNT/D12      = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;

CYTTL_TKT/D12 = IF (CY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
CYREF_TKT/D12 = IF (NON_FLAG EQ 'REFUNDABLE') AND (CY EQ 'Y')
                   THEN NET_TKT_CNT ELSE 0;
CYNON_TKT/D12 = IF (NON_FLAG EQ 'NON-REFUNDABLE') AND (CY EQ 'Y')
                   THEN NET_TKT_CNT ELSE 0;
PYTTL_TKT/D12 = IF (NON_FLAG EQ 'REFUNDABLE' OR 'NON-REFUNDABLE') AND
                   (PY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
END
-RUN

TABLE FILE OVMXRHLD
SUM CYTTL_TKT
    PYTTL_TKT
    PCT.CYTTL_TKT AS 'CYTTL_PCT'
    PCT.PYTTL_TKT AS 'PYTTL_PCT'
BY NON_FLAG
ON TABLE HOLD AS OVREF1
END
-RUN

DEFINE FILE OVREF1
CATEGORY/A30 = 'REF-NONREF';
CAT_ORDER/I2 = 3;
END
-RUN

TABLE FILE OVREF1
PRINT CATEGORY/A30 AND NON_FLAG/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CYTTL_TKT/D15 AS 'VOL_CURR' AND 
CYTTL_PCT/D15 AS 'TKT_CURR' AND PYTTL_TKT/D15 AS 'VOL_PRIOR' 
AND PYTTL_PCT/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
WHERE NON_FLAG EQ 'REFUNDABLE';
ON TABLE HOLD AS OVREF2
END
-RUN

TABLE FILE OVREF2
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
      AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS OVREF3
END
MODIFY FILE OV1_MAIN
FIXFORM FROM OVREF3
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVREF3
END
-RUN

DEFINE FILE OVREF1
CATEGORY/A30 = 'REF-NONREF';
CAT_ORDER/I2 = 3;
END
-RUN

TABLE FILE OVREF1
PRINT CATEGORY/A30 AND NON_FLAG/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CYTTL_TKT/D15 AS 'VOL_CURR' AND 
CYTTL_PCT/D15 AS 'TKT_CURR' AND PYTTL_TKT/D15 AS 'VOL_PRIOR' 
AND PYTTL_PCT/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
WHERE NON_FLAG EQ 'NON-REFUNDABLE';
ON TABLE HOLD AS OVREF2
END
-RUN

TABLE FILE OVREF2
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
      AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS OVREF3
END
MODIFY FILE OV1_MAIN
FIXFORM FROM OVREF3
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVREF3
END
-RUN



-



