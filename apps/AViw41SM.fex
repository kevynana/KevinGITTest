-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File SMRYRPT.FEX 
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-* 1/21/02     TANDT-JK             ADDED SUMMATION FOR DISSAVINGS
-* 1/21/02     TANDT-JK             ADDED SUMMARTION FOR TKT_PURCH AND
-*                                  REF_EXCH_CNT
-* 5/06/02     TANDT-DB             CARRIED THROUGH PRIN_TKT 
-* 5/15/02     TANDT-DB             CARRIED THROUGH ISU_TKT
-* 9/02/03      TANDT-DV             CARRIED THROUGH PRIN_BASE
-* 12/08/03    TANDT-DV SC          CARRIED THROUGH CCNTR1 
-* 5/3/05      DEB                  ADDED CODE FOR GLOBAL CURRENCY
-*8/29/14      DEB             CARRIED THROUGH PROP_AMT1 PROP_LSAV PROP_LOW
-*9/16/14      DEB             CARRIED THROUGH PROP_TKT_CNT ADDED ROUTINE 
-*                             FOR CGPPSV3 
-*10/3/14      DEB             CARRIED THROUGH LEVEL4 LEVEL5 LEVEL6 
-*                             ND_ORG_CD ND_DST_CD - DV
-*10/28/14     DEB             ADDED CODE FOR CGPPSV STYLE SHEET
-*10/29/14     DEB             CHANGED LS_TKT DEFINE
-*11/25/14     DEB             CARRIED THROUGH CO_MILE_DSC CO_MILE_KEY
-*10/15/15     DLV   S-12173   ADDED PROP_LS_TKT  DEFINE AND 
-*                             ADDL CODE FOR NBPPSV
-*02/18/16 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels

-**********************************************************************

SET ASNAMES = ON
-RUN

-IF &&CURRENCY EQ 'USD' THEN GOTO SKIPTHIS;


-SET &&SUBHEAD = <NAMEC;
-SET &FPAID_CUR = 'FARE PAID, (' | &&CURRENCY || ')';
-SET &GDISV_CUR= 'LOST,SAVINGS, (' | &&CURRENCY || ')';
-SET &GAIRF_CUR ='FEES, (' | &&CURRENCY || ')';
-SET &&S_SUBJ6='PAID_FARE1/D16.2CS AS ' | '''&FPAID_CUR.EVAL''' ;
-SET &&S_SUBJ7='GDIS_SAVE1/D16.2S AS ' | '''&GDISV_CUR.EVAL''';
-SET &&S_SUBJ8='PCT.GDIS_SAVE1/P9.1 AS ''% OF,LOST SVGS''';
-SET &&S_SUBJ9='GAIR_FEE1/D16.2CS AS ' | '''&GAIRF_CUR.EVAL''';



-SKIPTHIS;


TABLE FILE RPTHOLD2
SUM PROP_NET_TKT
    PROP_LSAV/D12C  AS 'PTLSAV'
    SEG_CONTRACT AS 'TSEG_CON'
    FARE_PAID
    PASSNGR_NAME
BY LEVEL_DESC
BY REFUSE_CODE
BY TKT_NUM
BY EX_FLAG
 ON TABLE HOLD AS PROPHOLD
END
-RUN
 




DEFINE FILE PROPHOLD
PT_FLAG/A1 = IF FARE_PAID EQ TSEG_CON  THEN 'Y' ELSE 'N';
PT_FLAG2/A1 = IF TSEG_CON EQ 0 THEN 'Y' ELSE 'N';
PROP_LS_TKT/D8CS = IF PT_FLAG EQ 'Y' OR PT_FLAG2 EQ 'Y' THEN 0 ELSE PROP_NET_TKT;
PROP_LST_TKT/D8CS = IF REFUSE_CODE EQ 'LE' OR 'NF' THEN PROP_LS_TKT ELSE 0;
END
TABLE FILE PROPHOLD
SUM PROP_NET_TKT
    PTLSAV
    PROP_LST_TKT
    PT_FLAG
    PT_FLAG2
    FARE_PAID 
    TSEG_CON
BY LEVEL_DESC
BY REFUSE_CODE
WHERE PT_FLAG EQ 'N' OR PT_FLAG2 EQ 'N'
ON TABLE HOLD AS PRPHLD2
END
-RUN
 



TABLE FILE RPTHOLD2
SUM NET_TKT_CNT AS 'NTTKT'
    DISSAVINGS AS 'TLOSS'
    GDIS_SAVE1/D16.2CS AS 'GTLOSS'
    REF_EXCH_CNT AS 'TRFEX'
    TKT_PURCH AS 'TPURCH'	
    PROP_AMT1 AS 'PPSV'
    PROP_LSAV AS 'PLSAV'
    PROP_LOW AS 'PPLOW'
    PROP_LOW2 AS 'PPLOW2'
    PROP_NET_TKT AS 'PTTKT'
BY LEVEL_DESC
BY REFUSE_CODE
BY REFUSAL_DESC
ON TABLE HOLD AS HOLDONE
END
-RUN

MATCH FILE HOLDONE
SUM NTTKT
    TLOSS
    GTLOSS
    TRFEX
    TPURCH
    PPSV
    PLSAV
    PPLOW
    PPLOW2
    PTTKT
    REFUSAL_DESC
BY LEVEL_DESC
BY REFUSE_CODE
ON TABLE HOLD
RUN
FILE PRPHLD2
PRINT PROP_LST_TKT
BY LEVEL_DESC
BY REFUSE_CODE
AFTER MATCH HOLD AS XONE OLD-OR-NEW
END
-RUN

 


DEFINE FILE RPTHOLD2
LS_TKT/D8 = IF REFUSE_CODE NE 'LE' OR 'NF' OR 'SD' OR 'FR' THEN NET_TKT_CNT ELSE 0;

END
TABLE FILE RPTHOLD2
PRINT AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  ARR_DAY
  ARR_TIME
  AUX_NON_MIR
  BAIR_TKT
  BASE_FAR2	
  BR_CL_IDX
  CASH_CRDT	
  CLASS	
  CLASS_CAT	
  CLIENT_NAME
  CLIENT_NUM	
  CO_MILE_DSC 
  CO_MILE_KEY
-*   COSTCNTR
  CCNTR
  CC_NUM
  DEPT_MONTH
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DPT_DAY
  DPT_TIME
  FARE_BAS	
  FARE_PAID
  GAIR_FEE1/D16.2CS
  GDIS_SAVE1/D16.2CS
  FDEST_GEOZONE
  GROUP_CODE
  GROSS_DSAVE	
  GROSS_FARE
  ID
  INT_CODE
  INTL_DOM
  ISU_TKT
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LS_TKT
  MRK_TKT_CNT
  NAMEC
  ND_CITY_NM	
  ND_ORG_CD
  ND_DST_CD
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  PAID_FARE1/D16.2CS
  PRIN_BASE
  PRIN_TKT
  PRIN_TKT2
  PROP_AMT1
  PROP_LOW
  PROP_LOW2 
  PROP_LSAV
  PROP_NET_TKT
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH	
  SAVINGS	
  SEG_AMT	
  SEG_LOWEST	
  SEG_STANDARD
  SEG_TAX	
  STAY
  TKT_NUM	
  TKT_PURCH	
  VAL_AIRLINE
  XARR_DOW
  XPSNGR_NM	
  XTRAN_DT
  XDPT_DOW	
  XDPT_DT
 LEVEL_DESC
 REFUSE_CODE
 REFUSAL_DESC
BY LEVEL_DESC
BY REFUSE_CODE
BY REFUSAL_DESC
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  ARR_DAY
  ARR_TIME
  AUX_NON_MIR
  BAIR_TKT
  BASE_FAR2	
  BR_CL_IDX
  CASH_CRDT	
  CLASS	
  CLASS_CAT	
  CLIENT_NAME	
  CLIENT_NUM	
  CO_MILE_DSC 
  CO_MILE_KEY
-*   COSTCNTR
  CCNTR
  CC_NUM
  DEPT_MONTH
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DPT_DAY
  DPT_TIME
  FARE_BAS	
  FARE_PAID
  GAIR_FEE1
  GDIS_SAVE1
  FDEST_GEOZONE
  GROSS_DSAVE	
  GROSS_FARE	
  GROUP_CODE
  ID
  INT_CODE
  INTL_DOM
  ISU_TKT
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LS_TKT
  MRK_TKT_CNT
  NAMEC
  ND_CITY_NM	
  ND_ORG_CD
  ND_DST_CD
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  PAID_FARE1
  PRIN_BASE
  PRIN_TKT
  PRIN_TKT2
  PROP_AMT1
  PROP_LOW
  PROP_LOW2 
  PROP_LSAV
  PROP_NET_TKT
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH	
  SAVINGS	
  SEG_AMT	
  SEG_LOWEST	
  SEG_STANDARD
  SEG_TAX	
  STAY
  TKT_NUM	
  TKT_PURCH	
  VAL_AIRLINE
  XARR_DOW
  XPSNGR_NM	
  XTRAN_DT
  XDPT_DOW	
  XDPT_DT
 LEVEL_DESC
 REFUSE_CODE
 REFUSAL_DESC
BY LEVEL_DESC
BY REFUSE_CODE
ON TABLE HOLD
RUN
FILE XONE
PRINT GTLOSS
    NTTKT
    TLOSS
    TRFEX
    TPURCH
    PPSV
    PLSAV
    PPSV
    PPLOW2
    PTTKT
    PROP_LST_TKT
BY LEVEL_DESC
BY REFUSE_CODE
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN

DEFINE FILE XTHREE ADD
PCTDSAVE/D8.1S= IF ((TLOSS LT 1) AND (TLOSS GT (-1))) THEN 0
                ELSE ((DISSAVINGS/TLOSS)*100);	
PCTRFEX/D8.1S=  IF ((TRFEX LT 1) AND (TRFEX GT (-1))) THEN 0
                ELSE ((REF_EXCH_CNT/TRFEX)*100);	
PCTTKT/D8.1S=   IF ((TPURCH LT 1) AND (TPURCH GT (-1))) THEN 0
                ELSE ((TKT_PURCH/TPURCH)*100);	
PRP_LSTKT/D8CS = IF REFUSE_CODE NE LAST REFUSE_CODE THEN PROP_LST_TKT ELSE 0;                    
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;



-IF '&&SETF.EVAL' EQ 'CGPPSV' OR 'MXACARBN' OR 'MXTCARBN' OR 'NBPPSV' THEN GOTO MORElines;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10

-GOTO SKIPmore

-MORElines

    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20

-SKIPmore;

-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
 
 

ON TABLE COLUMN-TOTAL
-INCLUDE FOOTERSM
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

-IF '&&SETF.EVAL' EQ 'CGPPSV' OR 'NBPPSV' AND '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN GOTO CongStyle;

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT

-CongStyle


UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000, 
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
    
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=9, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=9, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=3, JUSTIFY=LEFT, $

-* -GOTO JOY

TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,  $
-*      BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$

     

-JOY
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$

TYPE=REPORT, COLUMN=N2, WRAP=  .65,     $
TYPE=REPORT, COLUMN=N3, WRAP=  2.75,     $
TYPE=REPORT, COLUMN=N4, WRAP=  .75,   $
TYPE=REPORT, COLUMN=N5, WRAP=  .75,   $

TYPE=REPORT, COLUMN=N6, WRAP=   .75,   $

TYPE=REPORT, COLUMN=N7, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N8, WRAP= .85,     $


TYPE=REPORT, COLUMN=N9, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N10, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N11, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N12,WRAP= .85, $

TYPE=REPORT, COLUMN=N13, WRAP=  .85,   $

TYPE=REPORT, COLUMN=N14, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N15, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N16, WRAP=  .85,   $
TYPE=REPORT, COLUMN=N17, WRAP=  .85,   $
    
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
     
TYPE=FOOTING, FONT=ARIAL, COLOR=GRAY,$

TYPE=SUBHEAD,
     STYLE=BOLD,
$

TYPE=SUBTOTAL, 
     STYLE=BOLD, 
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
     
TYPE=GRANDTOTAL, STYLE=BOLD, $

-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL2;
-INCLUDE &&DSTY

-SKIP_DRILL2

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN



-XXIT