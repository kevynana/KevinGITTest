 
-*09/01/17 - - DLV - S-37468  New limo extract for ABLDCO
-*                          created from TPCAREX
 
-INCLUDE SETECHO
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX LIMUSE 
-RUN
 
-SET &&RPTGRP = 'LIM'; 
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'LIM';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
FIXFORM INST_KEY/11 RPT_GROUP/3
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
 
 
EX CODEGEN
-RUN

-SET &&IDLEVELBREAK = ' ';
-RUN
 
-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
LIM_AMT/D12.2CS = RENTAL_AMT;
LEVEL_DESC1/A60      = &&LDESC;
LBOOK/P8CS = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
NBR_DAYS/D12 = NUM_DAYS;
LIM_DAYS/D12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
 
TRN_DATE/YYMD = INVOICE_DATE;
TRIP_KEY/A2   = EDIT(TRP_KEY, '$$$$$$$$99');
TRIPRSN/A10 = IF TRIP_KEY NE ' ' THEN TRIP_KEY ELSE 'ZZZZZZZZZZ';
TRIP_RSN/A10 = IF TRIPRSN EQ 'ZZZZZZZZZZ' THEN 'NONE GIVEN' ELSE TRIPRSN;
LPREFB/P8CS = IF CLIENT_PREF EQ 'P' THEN LBOOK ELSE 0;
 
-INCLUDE IDLEVDEFINE  

END
TABLE FILE &&EXTRACT
PRINT LBOOK LIM_DAYS LIM_AMT LEVEL_DESC TRIP_KEY TRIP_RSN  TRP_REF.TRP_DESC LPREFB  
BY CAR_KEY

-INCLUDE &CARDATES
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHLDL
END
-RUN
 
 
TABLE FILE RPTHLDL
PRINT LBOOK LIM_DAYS LIM_AMT LPREFB  
BY LEVEL_DESC
BY TRIP_KEY
BY TRP_DESC
BY TRIP_RSN
ON TABLE HOLD AS LIMHLDA
END
-RUN
 
TABLE FILE LIMHLDA
SUM LBOOK LIM_DAYS LIM_AMT LPREFB
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS LIMHLD
END
-RUN
 
 
-SET &&NOLIMREC = IF &RECORDS EQ 0 THEN 'Y' ELSE 'N';

 