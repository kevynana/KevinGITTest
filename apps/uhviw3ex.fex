-* ADDED IBOOK DEFINE - DEB - 5/30/13
-*1/31/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-* 2/26/14 - DEB - ADDED LEVEL1 TO EXTRACT
-*12/18/15 - DLV - S-13284   Updated to allow reports to sort/subtotal by id-levels

-* Created for the UDID reports
-INCLUDE SETECHO
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &&IDLEVELBREAK = '';
-RUN
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN

DEFINE FILE &&EXTRACT
  CITY_ST/A35 = PROP_CITY||(', '| PROP_STATE);
  LEVEL_DESC1/A60  = &&LDESC;
  IN_DATE/MDYY = CHKIN_DATE;
  INV_DATE/MDYY = INVOICE_DATE;
  NBR_DAYS/D12 =  NUM_DAYS;
  NBR_ROOMS/D12 = NUM_ROOMS;
  NEW_ROOM_RATE/D14.2C = ROOM_RATE;
  NEW_STD_RATE/D14.2C = STD_RATE;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  OUT_DATE/MDYY = CHKOUT_DATE;
  REASON_CD/A2=EDIT(REFUSE_KEY,'$$$$$$$$99');
  RSNCDE/A48=REASON_CD|| '-' ||REFUSAL_DESC;
  XPSNGR_NM/A15 =EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  PROP_ZIP5/A5=EDIT(PROP_ZIP, '99999$$$$$');
  IBOOK/A13 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE 'TRADITIONAL';  
-* ****DEFINES ON PREVIOUS DEFINES****
   BOOKINGS/D8 = IF NEW_TOTAL_AMT GT 0 THEN 1 ELSE (-1);
  
   TOTAL_STD/D12.2C = IF ((NNROOMS LT 0) AND (NEW_STD_RATE LT 0))
                      THEN ((NNROOMS * NEW_STD_RATE) * (-1))
                      ELSE NNROOMS * NEW_STD_RATE;

-* ****DEFINES ON PREVIOUS DEFINED DEFINES***
   TOTAL_SLSAV/D12.2C = TOTAL_STD - NEW_TOTAL_AMT;

-INCLUDE IDLEVDEFINE 
END
-RUN


TABLEF FILE &&EXTRACT
PRINT BOOKINGS	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE 	
  HTL_KEY
  IBOOK
  IN_DATE 	
  INVOICE_DATE 	
  INVOICE_NUM 	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6 
  LEVEL7
  NBR_DAYS	
  NBR_ROOMS
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NNROOMS	
  OUT_DATE 	
  PNR_LOCATOR 	
  PROP_ADDRESS
  PROP_CITY
  PROP_NAME 	
  PROP_ZIP5
  PROP_STATE_CD
  RATE_CODE
  RESV_STATUS
  REFUSAL_DESC	
  REFUSE_CODE
  RSNCDE
  TOTAL_SLSAV
  TOTAL_STD 
  TRIP_PURPOSE
  XPSNGR_NM
  
-INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS HTLHLD
-* ON TABLE HOLD AS &&RPT_HOLD
END
-RUN

TABLE FILE HTLHLD
PRINT BOOKINGS	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE 	
  HTL_KEY
  IBOOK
  IN_DATE 	
  INVOICE_DATE 	
  INVOICE_NUM 	
  LEVEL1
  LEVEL_DESC	
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NBR_DAYS	
  NBR_ROOMS
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NNROOMS	
  OUT_DATE 	
  PNR_LOCATOR 	
  PROP_ADDRESS
  PROP_CITY
  PROP_NAME 	
  PROP_ZIP5
  PROP_STATE_CD
  RATE_CODE
  RESV_STATUS
  REFUSAL_DESC	
  REFUSE_CODE
  RSNCDE
  TOTAL_SLSAV
  TOTAL_STD 
  TRIP_PURPOSE
  XPSNGR_NM
BY HTL_KEY
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


