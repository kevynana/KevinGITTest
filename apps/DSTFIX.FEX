

USE CLEAR *
USE
    D:\TNT\TTRACKER\SUDATA\ROLLUP.FOC
END
FI CUSTS DISK D:\LOAD\FOCTEMP\CUSTS.DAT
SET MESSAGE=ON
-*=======================================================================
SET ASNAMES=ON
DEFINE FILE ROLLUP
XL01/A1 = 'W' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP AS 'ROLLUP_CODE'
      XL01   AS 'PR_STAMP'
IF UPD_ENABLE NE ' '
IF QTR_ENABLE EQ ' '
IF LOAD_GRP NE 'X'
IF ROLLUP_CODE NE 'TOTAL-R' OR 'ABCD2-R'
ON TABLE HOLD
END
-RUN


MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-*======================================================================
USE CLEAR *
-RUN
SET TEMPDIR=K:\FOCTEMP
SET MESSAGE=ON
SET WARNING=OFF
SET YRTHRESH=30
SET DEFCENT=19
-RUN
-*=======================================================================
-TOP
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP COMP
BY ROLLUP_CODE NOPRINT
IF UPD_ENABLE NE ' '
IF RECORDLIMIT EQ 1
IF QTR_ENABLE EQ ' '
IF PR_STAMP EQ 'W'
ON TABLE SAVE AS CUSTS
END
-RUN


-READ CUSTS &&ROLLUP.A8 &&COMP.A6.
-RUN

-IF &RECORDS EQ 0 THEN GOTO STOP;
-RUN




-*=======================================================================
-*                 CREATE DATA FILES FOR PROCESSING
-*=======================================================================
-TYPE "BEFORE SETS"

-* TKT MAIN .FOC FILES
-SET &&DTBASE = 'G:\TNT\TTRACKER\DATA\'||'T_'||&&COMP|||'.FOC';

-* AIR .FOC FILES
-SET &&DDBASE = 'G:\TNT\TTRACKER\DATA\'||'D_'||&&COMP|||'.FOC';

-* TKT MAIN .MAS FILES
-SET &&DTBMAS = 'G:\TNT\TTRACKER\DATA\'||'T_'||&&COMP|||'.MAS';

-* DESTINATION .MAS FILES
-SET &&DDBMAS = 'G:\TNT\TTRACKER\DATA\'||'D_'||&&COMP|||'.MAS';

-* TKT MAIN FILE NAMES
-SET &&FOCTNAME = 'T_'||&&COMP;

-* DESTINATION FILE NAMES
-SET &&FOCDNAME = 'D_'||&&COMP;

-TYPE "AFTER SETS"

JOIN CLEAR *
-RUN

JOIN AIR_KEY IN &&FOCTNAME TO ALL AIR_KEY IN &&FOCDNAME
END

DEFINE FILE &&FOCTNAME
GEO1/A3 = EDIT(GEO_ZONE, '999');
END

TABLE FILE &&FOCTNAME 
PRINT ROUTE
BY AIR_KEY
WHERE GEO1 NE 'USA' OR ' '  
WHERE ORG_APC EQ DST_APC
WHERE SEG_NBR EQ '01'
WHERE ORG_APC NE 'DT1'
ON TABLE HOLD
END
-RUN

DEFINE FILE HOLD
DST_APC/A3 = ROUTE;
END
TABLE FILE HOLD
PRINT DST_APC
BY AIR_KEY
ON TABLE HOLD AS HOLD1
END


MODIFY FILE &&FOCTNAME 
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON MATCH UPDATE DST_APC
ON NOMATCH REJECT
DATA ON HOLD1
END
-RUN



SET ASNAMES=ON
DEFINE FILE ROLLUP
XL01/A1 = 'Z' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP AS 'ROLLUP_CODE'
      XL01   AS 'PR_STAMP'
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE HOLD
END
MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN



-GOTO TOP
-RUN
-*======================================================================
-STOP
































