-**************************************************************
-* Date       Author    Modification
-**************************************************************
-* 01/23/2012 GSE       Removed parens from around CLIMIT to
-*                      prevent errors in 7.7.03
-*  08/23/2016  REJ  S-17914 Changes for ER5.
-*  12/29/2016  REJ  S-28553 Move ER5 My Reports to production.

-**************************************************************
-INCLUDE SETECHO
 
CREATE FILE TCTRNK
-RUN
CREATE FILE TCTGCRNK
-RUN
 
-INCLUDE TCGETROLL
-RUN
 
-IF '&&SETF.EVAL' EQ 'TCTPGCRC' THEN GOTO RateCode;
 
-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT;
EX TCHTLDB
-RUN
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop2;
 
 
EX TCH103EX
-RUN
-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2
 
-GOTO FinRpt;
 
-RateCode
 
-SET &CNT = 1;
-REPEAT Loop3 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT;
EX TCHTLDB
-RUN
 
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop3;
EX TCH108EX
-RUN
-IncLoop3
-SET &CNT = &CNT + 1;
-Loop3
 
-FinRpt
 
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE AVRP_SUBFOOT
-:AVSF0
 
-INCLUDE SetParmtime
-RUN
 
-IF &&SETF EQ 'TCTPGCHN' THEN GOTO GROUP;
-IF '&&SETF.EVAL' EQ 'TCTPGCRC' THEN GOTO GROUP2;
-**************************************************************
-* GET THE FINAL REPORT
-**************************************************************
TABLE FILE TCTRNK
SUM BOOKINGS
    NBR_DAYS
    NNROOMS
    NNROOMS/D12 AS 'NMBR_DAYS'
    TOTAL_AMT/D12.2CS AS 'ROOM_AMT'
BY CHAIN
ON TABLE HOLD AS HOLD1
END
-RUN
 
TABLE FILE HOLD1
PRINT
  BOOKINGS
  NBR_DAYS
  NMBR_DAYS
  NNROOMS
  ROOM_AMT/D12.2CS
  TOTAL_AMT
RANKED BY HIGHEST NNROOMS NOPRINT
BY CHAIN
ON TABLE HOLD AS HOLD2
END
-RUN
 
DEFINE FILE HOLD2
 RANK_LIMIT/I2 = &&RANK_LIMIT;
 CLIMIT/A2    = EDIT(RANK_LIMIT) ;
  CRANK/D5     = RANK;
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF CHAIN NE LAST CHAIN THEN (LAST LIST + 1) ELSE
            LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6=EDIT(FRANKX,'$999999');
  RANK_VALUE/A9 = IF RANK_LIMIT EQ 0 THEN BRANK ELSE
                 IF LIST GT RANK_LIMIT THEN 'ALL OTHER' ELSE FRANK;
END
-RUN
 
TABLE FILE HOLD2
PRINT
  BOOKINGS
  CLIMIT
  NMBR_DAYS
  NNROOMS
  ROOM_AMT
  TOTAL_AMT
BY RANK_VALUE
BY CHAIN
ON TABLE HOLD AS HOLD3
END
-RUN
 
DEFINE FILE HOLD3
  CHAIN_PRINT/A35= IF RANK_VALUE LT CLIMIT THEN CHAIN ELSE ' ';
END
-RUN
 
TABLE FILE HOLD3
SUM
  BOOKINGS
  NMBR_DAYS
  NNROOMS
  ROOM_AMT
  TOTAL_AMT
BY RANK_VALUE
BY CHAIN_PRINT
ON TABLE HOLD AS HOLD4
END
-RUN
 
-GOTO Finishrpt;
 
 
-GROUP
 
JOIN CHAIN_GROUP IN TCTRNK TO CHAIN_GROUP IN HTL_CGRP
 
DEFINE FILE TCTRNK
CHN_GRP/A3 = IF CHAIN_GROUP EQ ' ' THEN 'XX' ELSE CHAIN_GROUP;
GRC_NAME/A30 = IF GCHN_NAME EQ ' ' THEN 'ALL OTHER' ELSE GCHN_NAME;
GCHN_NM/A30 = LCWORD (30, GRC_NAME, GCHN_NM);
END
TABLE FILE TCTRNK
SUM BOOKINGS
    NBR_DAYS
    NNROOMS AS 'NMBR_DAYS'
    NNROOMS
    TOTAL_AMT AS 'ROOM_AMT'
    TOTAL_AMT
    GCHN_NM
    CHAIN
BY CHN_GRP
BY CHAIN_CODE
WHERE CHN_GRP OMITS 'XX'
ON TABLE HOLD AS HOLD1
END
-RUN
 
 
TABLE FILE HOLD1
SUM  NNROOMS/D12 AS 'TNMBR_DAYS'
     TOTAL_AMT/D12.2CS AS 'TROOM_AMT'
     TOTAL_AMT
     NBR_DAYS
BY CHN_GRP
ON TABLE HOLD AS HOLD2
END
-RUN
 
TABLE FILE HOLD2
PRINT TNMBR_DAYS
    TROOM_AMT
    NBR_DAYS
    TOTAL_AMT
RANKED BY HIGHEST &&RANK_METH NOPRINT
BY CHN_GRP
ON TABLE HOLD AS RNKHLD1
END
-RUN
 
-SET &OTHERRNK = &RECORDS;
 
 DEFINE FILE RNKHLD1
 RANK_LIMIT/I5 = &&RANK_LIMIT;
 DRANK/D5      = RANK;
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5=EDIT(ARANKX,'$99999');
 RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                IF RANK GT RANK_LIMIT THEN 'OTHER' ELSE ARANK;
END
-RUN
 
TABLE FILE RNKHLD1
PRINT TNMBR_DAYS
      TROOM_AMT
      NBR_DAYS
      TOTAL_AMT
BY RANK_VALUE
BY CHN_GRP
ON TABLE HOLD AS HOLD3
END
 
 
MATCH FILE HOLD1
PRINT BOOKINGS
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    ROOM_AMT
    TOTAL_AMT
    GCHN_NM
    CHAIN
    CHAIN_CODE
BY CHN_GRP
ON TABLE HOLD
RUN
FILE HOLD3
SUM TNMBR_DAYS
    TROOM_AMT
   RANK_VALUE
BY CHN_GRP
AFTER MATCH HOLD AS XONE OLD-OR-NEW
END
-RUN
 
TABLE FILE XONE
PRINT BOOKINGS
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    ROOM_AMT
    TOTAL_AMT
    TNMBR_DAYS
    TROOM_AMT
    CHN_GRP
    GCHN_NM
    CHAIN
    CHAIN_CODE
BY RANK_VALUE
RANKED BY HIGHEST &&RANK_METH AS 'DAYS_RANK'
ON TABLE HOLD AS XTWO
END
-RUN
 
-SET &&RANK_LMT = 999;
DEFINE FILE XTWO
CHN_LIMIT/I2 = &&RANK_LMT;
CLIMIT/A2 =    EDIT(CHN_LIMIT);
CRANK/D5 =     RANK;
BRANK/A6 =     FTOA(CRANK, '(D5)', 'A6');
LIST/D6 =      IF CHAIN_CODE NE LAST CHAIN_CODE THEN (LAST LIST + 1) ELSE LAST LIST;
FRANKX/A7 =    FTOA(LIST, '(D6)', 'A7');
CHN_VALUE/A6 = IF CHN_LIMIT EQ 0 THEN BRANK ELSE
               IF RANK GT CHN_LIMIT THEN 'OTHER' ELSE BRANK;
END
 
TABLE FILE XTWO
PRINT BOOKINGS
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
    GCHN_NM
    CHAIN
    CHAIN_CODE
BY RANK_VALUE
BY CHN_VALUE
ON TABLE HOLD AS XTHREE
END
-RUN
 
 
DEFINE FILE XTHREE
FLAG/A1 = 'A';
END
TABLE FILE XTHREE
PRINT BOOKINGS
    CHAIN
    CHAIN_CODE
    CHN_VALUE
    GCHN_NM
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    RANK_VALUE
    ROOM_AMT
    TOTAL_AMT
BY FLAG
BY CHN_GRP
ON TABLE HOLD AS HOLD4 FORMAT FOCUS
END
-RUN
 
 
DEFINE FILE TCTRNK
CHN_GRP/A3 = IF CHAIN_GROUP EQ ' ' THEN 'XX' ELSE CHAIN_GROUP;
GRC_NAME/A30 = IF GCHN_NAME EQ ' ' THEN 'ALL OTHER' ELSE GCHN_NAME;
GCHN_NM/A30 = LCWORD (30, GRC_NAME, GCHN_NM);
END
TABLE FILE TCTRNK
SUM BOOKINGS
    NBR_DAYS
    NNROOMS AS 'NMBR_DAYS'
    NNROOMS
    TOTAL_AMT AS 'ROOM_AMT'
    TOTAL_AMT
BY CHN_GRP
BY GCHN_NM
BY CHAIN
BY CHAIN_CODE
WHERE CHN_GRP EQ 'XX'
ON TABLE HOLD AS HOLD5
END
-RUN
 
TABLE FILE HOLD5
SUM  NNROOMS/D12 AS 'TNMBR_DAYS'
     TOTAL_AMT/D12.2CS AS 'TROOM_AMT'
     TOTAL_AMT
     NBR_DAYS
BY CHN_GRP
ON TABLE HOLD AS HOLD6
END
-RUN
 
 
TABLE FILE HOLD6
PRINT TNMBR_DAYS
    TROOM_AMT
    NBR_DAYS
    TOTAL_AMT
RANKED BY HIGHEST &&RANK_METH NOPRINT
BY CHN_GRP
ON TABLE HOLD AS RNKHLD2
END
-RUN
 
 
 DEFINE FILE RNKHLD2
 RANK_LIMIT/I5 = &&RANK_LIMIT;
 DRANK/D5      = (&OTHERRNK + 1);
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5=EDIT(ARANKX,'$99999');
 RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                IF RANK GT RANK_LIMIT THEN 'OTHER' ELSE ARANK;
END
-RUN
 
TABLE FILE RNKHLD2
PRINT TNMBR_DAYS
      TROOM_AMT
      NBR_DAYS
      TOTAL_AMT
BY RANK_VALUE
BY CHN_GRP
ON TABLE HOLD AS HOLD7
END
-RUN
 
 
 
MATCH FILE HOLD5
PRINT BOOKINGS
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    ROOM_AMT
    TOTAL_AMT
    GCHN_NM
    CHAIN
    CHAIN_CODE
BY CHN_GRP
ON TABLE HOLD
RUN
FILE HOLD7
SUM TNMBR_DAYS
    TROOM_AMT
   RANK_VALUE
BY CHN_GRP
AFTER MATCH HOLD AS XFOUR OLD-OR-NEW
END
-RUN
 
 
TABLE FILE XFOUR
PRINT BOOKINGS
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
    GCHN_NM
    CHAIN
    CHAIN_CODE
BY RANK_VALUE
RANKED BY HIGHEST &&RANK_METH AS 'DAYS_RANK'
ON TABLE HOLD AS XFIVE
END
-RUN
 
-SET &&RANK_LMT = 999;
DEFINE FILE XFIVE
CHN_LIMIT/I2 = &&RANK_LMT;
CLIMIT/A2 =    EDIT(CHN_LIMIT);
CRANK/D5 =     RANK;
BRANK/A6 =     FTOA(CRANK, '(D5)', 'A6');
LIST/D6 =      IF CHAIN_CODE NE LAST CHAIN_CODE THEN (LAST LIST + 1) ELSE LAST LIST;
FRANKX/A7 =    FTOA(LIST, '(D6)', 'A7');
CHN_VALUE/A6 = IF CHN_LIMIT EQ 0 THEN BRANK ELSE
               IF RANK GT CHN_LIMIT THEN 'OTHER' ELSE BRANK;
END
 
TABLE FILE XFIVE
PRINT BOOKINGS
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
    GCHN_NM
    CHAIN
    CHAIN_CODE
BY RANK_VALUE
BY CHN_VALUE
ON TABLE HOLD AS XSIX
END
-RUN
 
 
DEFINE FILE XSIX
FLAG/A1 = 'B';
END
TABLE FILE XSIX
PRINT BOOKINGS
    CHAIN
    CHAIN_CODE
    CHN_VALUE
    GCHN_NM
    NBR_DAYS
    NMBR_DAYS
    NNROOMS
    RANK_VALUE
    ROOM_AMT
    TOTAL_AMT
BY FLAG
BY CHN_GRP
ON TABLE HOLD AS HOLD8 FORMAT FOCUS
END
-RUN
 
 
 
 
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK1=&HLDPATH || 'HOLD4.FOC';
-SET &HRANK2=&HLDPATH || 'HOLD8.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&HRANK1 AS HOLD4
&HRANK2 AS HOLD4
END
-RUN
 
 
-GOTO Finishrpt;
 
-GROUP2;
 
 
JOIN CHAIN_GROUP IN TCTGCRNK TO CHAIN_GROUP IN HTL_CGRP
 
DEFINE FILE TCTGCRNK
CHN_GRP/A3 = IF CHAIN_GROUP EQ ' ' THEN 'XX' ELSE CHAIN_GROUP;
GRC_NAME/A30 = IF GCHN_NAME EQ ' ' THEN 'ALL OTHER' ELSE GCHN_NAME;
GCHN_NM/A30 = LCWORD (30, GRC_NAME, GCHN_NM);
RATE_CD/A10 = IF RATE_CODE EQ ' ' THEN 'NONE GIVEN' ELSE RATE_CODE;
RANK_VALUE/A1 = '1';
END
TABLE FILE TCTGCRNK
SUM BOOKINGS
    NBR_DAYS
    NNROOMS AS 'NMBR_DAYS'
    NNROOMS
    TOTAL_AMT AS 'ROOM_AMT'
    TOTAL_AMT
    GCHN_NM
    RATE_CODE
BY CHN_GRP
BY IBOOK
BY RATE_CD
ON TABLE HOLD AS HOLD2
END
-RUN
 
TABLE FILE TCTGCRNK
SUM BOOKINGS AS 'HBOOK'
    NNROOMS AS 'HNDAY'
    TOTAL_AMT AS 'HTTL'
BY CHN_GRP
ON TABLE HOLD AS HOLD3
END
-RUN
 
MATCH FILE HOLD2
PRINT BOOKINGS
      NBR_DAYS
      NMBR_DAYS
      NNROOMS
      ROOM_AMT
      TOTAL_AMT
      GCHN_NM
      RATE_CODE
BY CHN_GRP
BY IBOOK
BY RATE_CD
ON TABLE HOLD
RUN
FILE HOLD3
SUM HBOOK
    HNDAY
    HTTL
BY CHN_GRP
AFTER MATCH HOLD AS HOLD4 OLD-OR-NEW
END
-RUN
 
DEFINE FILE HOLD4
   PCTHDAYS/D8.1S = IF ((HNDAY LT 1) AND (HNDAY GT (-1))) THEN 0
                    ELSE ((NNROOMS/HNDAY)*100);
   PCTHTAMT/D8.1S = IF ((HTTL LT 1) AND (HTTL GT (-1))) THEN 0
                    ELSE ((TOTAL_AMT/HTTL)*100);
   PCTBOOK/D8.1S = IF ((HBOOK LT 1) AND (HBOOK GT (-1))) THEN 0
                    ELSE ((BOOKINGS/HBOOK)*100);
NOWTOD/A8 WITH CHN_GRP = HHMMSS (NOWTOD);
END
 
-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN
 
-GOTO SKIPdefine;
 
-Finishrpt;
 
-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN
 
DEFINE FILE HOLD4
NOWTOD/A8 WITH RANK_VALUE = HHMMSS (NOWTOD);
END
 
-SKIPdefine
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS';
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
 
TABLE FILE HOLD4
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
 
 
 
-INCLUDE FOOTERSM
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
ENDSTYLE
 
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-IF &LINES GT 0 THEN GOTO XXIT;
EX TCEMPTY
-RUN
-XXIT
