-* File UPDODTP.fex

SET ASNAMES=ON

USE CLEAR *
USE
    K:\TNT\TTRACKER\SUDATA\ROLLUP.FOC
END

TABLE FILE ROLLUP
PRINT ROLLUP
BY ROLLUP NOPRINT
ON TABLE HOLD
END

MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH COMPUTE PR_STAMP=' ';
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN


SET MESSAGE=ON
-*=======================================================================
FI TTPBACA0 DISK K:\TNT\TTRACKER\DATA\TTPBACA0.TXT
-RUN

TABLE FILE TTPBACA0
SUM ROLLUP_CODE NOPRINT
BY ROLLUP_CODE
ON TABLE HOLD
END
-RUN

MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH COMPUTE PR_STAMP='X';
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-*======================================================================
USE CLEAR *
-RUN
SET TEMPDIR=K:\FOCTEMP
SET MESSAGE=ON
SET WARNING=OFF
SET YRTHRESH=30
SET DEFCENT=19
-RUN
-*=======================================================================

-SET &CNT=0;

-TOP
TABLE FILE ROLLUP
PRINT ROLLUP COMP QTR_ENABLE
BY ROLLUP_CODE NOPRINT
IF RECORDLIMIT EQ 1
IF PR_STAMP EQ 'X'
ON TABLE SAVE AS CUSTS
END
-RUN

-READ CUSTS &&ROLLUP.A8 &&COMP.A6 &&QTR.A1.
-RUN

-IF &RECORDS EQ 0 THEN GOTO STOP;
-RUN

-IF &&QTR EQ 'X' THEN GOTO QTR;
-RUN

-SET &&FOCANAME1 = 'A_'||&&COMP;

-TYPE FOCANAME1 = &&FOCANAME1
-TYPE ROLLUP = &&ROLLUP
-TYPE COMPANY = &&COMP
-TYPE QTR = &&QTR

TABLE FILE TTPBACA0
PRINT AIR_KEY DOD_TYPE
BY AIR_KEY NOPRINT
WHERE ROLLUP_CODE EQ '&&ROLLUP'
ON TABLE HOLD
END

MODIFY FILE &&FOCANAME1
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH UPDATE DOD_TYPE
ON NOMATCH REJECT
DATA ON HOLD
END

-GOTO SKIPQTR

-QTR
-* AIR FILES

-SET &&FOCANAME5 = 'A5'||&&COMP;
-SET &&FOCANAME6 = 'A6'||&&COMP;
-SET &&FOCANAME7 = 'A7'||&&COMP;
-SET &&FOCANAME8 = 'A8'||&&COMP;
-SET &&FOCANAME9 = 'A9'||&&COMP;

-* ************************* A1 UPDATE ***********************

TABLE FILE TTPBACA0
PRINT AIR_KEY DOD_TYPE
BY AIR_KEY NOPRINT
WHERE ROLLUP_CODE EQ '&&ROLLUP'
ON TABLE HOLD
END

MODIFY FILE &&FOCANAME5
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH UPDATE DOD_TYPE
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE &&FOCANAME6
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH UPDATE DOD_TYPE
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE &&FOCANAME7
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH UPDATE DOD_TYPE
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE &&FOCANAME8
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH UPDATE DOD_TYPE
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE &&FOCANAME9
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH UPDATE DOD_TYPE
ON NOMATCH REJECT
DATA ON HOLD
END

-SKIPQTR

TABLE FILE ROLLUP
PRINT ROLLUP PR_STAMP
IF ROLLUP EQ '&&ROLLUP'
ON TABLE HOLD
END

MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH COMPUTE PR_STAMP=' ';
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END

-GOTO TOP
-RUN
-*======================================================================
-STOP

-XFER
-TYPE PROGRAM COMPLETED.......
-EXIT

-XXIT
-EXIT



