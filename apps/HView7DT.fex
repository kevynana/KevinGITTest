-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-*                     FOCEXEC: HVIEW3DT
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*
-*----           ----               ---------------------
-* ADDED HTL_PHONE/PROP_PHONE TO THE JN6KEY/JN8KEY
-* THIS TELLS BETWEEN MULTIPLE HOTELS WITHIN THE SAME CITY JK 7/16/01
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*4/1/04     DEB                CHANGED TO SUM DEFINE BOOKINGS FIELD
-* 05/06/05  DEB                ADDED CODE FOR GLOBAL CURRENCY
-*12/22/11   GSE                Removed spaces from before -* and parens 
-*                              from around CLIMIT in DEFINEs to prevent
-*                              7.7.03 errors.
-* Joy Added additional field for MXTPHCIT 1/22/14
-* Added goto for ALTPHCIT - JK 3/10/14
-* Carried thru Number of Rooms JK 5/14/14
-*aDDED LOGIC FOR MXTPHCCW - JK 5/20/14
-**************************************************************************
-INCLUDE SETECHO

SET ASNAMES=ON 
-RUN

-SET &&PREF_LMT = &&RANK_LIMIT;


-IF &&SETF EQ 'MXTPHCIT' OR 'ALTPHCIT' OR 'ALTPHCHH' THEN GOTO MXRPT;
-IF &&SETF EQ 'MXTPHCCW' THEN GOTO MXRPT1 ELSE GOTO CURR;

-CURR;


-IF &&CURRENCY EQ 'USD' THEN GOTO SKIPTHIS;


-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,ROOM,AMOUNT, (' | &&CURRENCY || ')';
-SET &CAVG_CUR = 'AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &&PRINT2 ='GPROOM_AMT/D16.2CS AS ' | '''&TAMT_CUR.EVAL''';
-SET &&PRINT3='COMPUTE AVGAMT/D16.2= IF (GPROOM_AMT LT 0) AND ';
-SET &&PRINT4='(PNMBR_DAYS LT 0) THEN ((GPROOM_AMT/PNMBR_DAYS)*(-1)) ELSE ';
-SET &&PRINT5='IF ((PNMBR_DAYS LT 1) AND (PNMBR_DAYS GT (-1))) THEN 0 ELSE ';
-SET &&PRINT6='(GPROOM_AMT/PNMBR_DAYS); AS ' | '''&CAVG_CUR.EVAL''';

-SKIPTHIS;

TABLE FILE HTLHLD2
-* SUM CNT.NUM_DAYS AS 'BOOKINGS'
SUM BOOKINGS
    INVOICE_DATE
    INVOICE_NUM    
    NAMEC
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NUM_ROOMS/P12CS
    REFUSE_CD	
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    AMT_TOTL1/D16.2 AS 'GROOM_AMT'
    TOTAL_STD
    TOTAL_SLSAV	
    SLSAV_TTL1/D16.2
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_NAME
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
BY CHAIN_CODE
ON TABLE HOLD AS HOLD1
END
-RUN


TABLE FILE HOLD1
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE
  INVOICE_DATE
  INVOICE_NUM
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUM_ROOMS
  PROP_ADDRESS	
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  ROOM_AMT/D12.2	
  GROOM_AMT/D16.2
  SAVINGS
  TOTAL_STD	
  TOTAL_SLSAV
  SLSAV_TTL1/D16.2
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
RANKED BY HIGHEST NMBR_DAYS NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN


DEFINE FILE HOLD2
 RANK_LIMIT/I5 = &&PREF_LMT;
 DRANK/D5      = RANK;
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5  = EDIT(ARANKX,'$99999'); 
 RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                IF RANK GT RANK_LIMIT THEN ARANK ELSE ARANK;
-*              IF RANK GT RANK_LIMIT THEN 'OTHER' ELSE ARANK;
END
-RUN

TABLE FILE HOLD2
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE
  INVOICE_DATE
  INVOICE_NUM 
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NMBR_DAYS	
  NNROOMS	
  NUM_ROOMS
  PROP_ADDRESS	
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
ON TABLE HOLD AS HOLD3
END
-RUN

DEFINE FILE HOLD3
  CHAIN_CD/A2= IF RANK_VALUE NE 'OTHER' THEN CHAIN_CODE ELSE ' ';	
  CHAIN_NM/A35= IF RANK_VALUE LE 'OTHER' THEN CHAIN_NAME ELSE ' ';	
  HTL_ADDRESS/A35= IF RANK_VALUE LE 'OTHER' THEN PROP_ADDRESS ELSE ' ';	
  HTL_NAME/A30 = IF RANK_VALUE LE 'OTHER' THEN PROP_NAME ELSE ' ';	
  PROP_PHONE/A15= IF RANK_VALUE LE 'OTHER' THEN HOTEL_PHONE ELSE ' ';	
  ZIP5/A5 = IF RANK_VALUE LE 'OTHER' THEN PROP_ZIP5 ELSE ' ';
END
-RUN

TABLE FILE HOLD3
SUM 
  BOOKINGS
  INVOICE_DATE
  INVOICE_NUM  
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUM_ROOMS
  REFUSE_CD
  ROOM_AMT	
  GROOM_AMT
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY CHAIN_CD
BY CHAIN_NM
ON TABLE HOLD AS HOLD4
END
-RUN

TABLE FILE HOLD1
SUM 
  BOOKINGS
  INVOICE_DATE
  INVOICE_NUM  
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUM_ROOMS
  REFUSE_CD	
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
ON TABLE HOLD AS RHOLD1
END
-RUN

TABLE FILE RHOLD1
PRINT *
RANKED BY HIGHEST NMBR_DAYS AS 'DAYS_RANK'
ON TABLE HOLD AS RHOLD2
END
-RUN

MATCH FILE HOLD4
PRINT *
BY CITY_ST
ON TABLE HOLD
RUN
FILE RHOLD2
SUM DAYS_RANK
BY CITY_ST
AFTER MATCH HOLD AS HOLD5 OLD-OR-NEW
END
-RUN

TABLE FILE HOLD5
PRINT *
RANKED BY HIGHEST DAYS_RANK
ON TABLE HOLD AS HOLD6
END
-RUN

-SET &&CTY_LMT = &&RANK_LIMIT;

DEFINE FILE HOLD6
  CTY_LIMIT/I2 = &&CTY_LMT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6  = EDIT(FRANKX,'$999999');
  CTY_VALUE/A6 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                 IF RANK GT CTY_LIMIT THEN BRANK ELSE BRANK;
-*                 IF RANK GT CTY_LIMIT THEN 'OTHER' ELSE BRANK;
-*   JN6KEY/A82 = CITY_ST | HTL_NAME | PROP_PHONE | CHAIN_CD;
  JN6KEY/A97 = CITY_ST | HTL_NAME | PROP_PHONE | CHAIN_CD;
END
-RUN

TABLE FILE HOLD6
PRINT 
  BOOKINGS	
  CLIMIT	
  CTY_LIMIT	
  DAYS_RANK
  INVOICE_DATE
  INVOICE_NUM  
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUM_ROOMS
  REFUSE_CD	
  ROOM_AMT	
  GROOM_AMT
  SAVINGS	
  TOTAL_STD
BY JN6KEY
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_CD
BY CHAIN_NM
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
ON TABLE HOLD AS HOLD7 FORMAT FOCUS INDEX JN6KEY
END
-RUN

DEFINE FILE HTLHLD2
-* JN8KEY/A82 = CITY_ST | PROP_NAME| HOTEL_PHONE | CHAIN_CODE;
JN8KEY/A97 = CITY_ST | PROP_NAME | HOTEL_PHONE | CHAIN_CODE;

END
-RUN

TABLE FILE HTLHLD2
-* SUM CNT.NUM_DAYS AS 'PBOOKINGS'
SUM BOOKINGS AS 'PBOOKINGS'
    NEW_ROOM_RATE AS 'PNEW_ROOM_RATE'
    NEW_STD_RATE AS 'PNEW_STD_RATE'
    NEW_TOTAL_AMT AS 'PNEW_TOTAL_AMT'
    NNROOMS AS 'PNNROOMS'
    TTL_NGT AS 'PNMBR_DAYS'
    REFUSE_CD AS 'PREFUSE_CD'
    SAVINGS AS 'PSAVINGS'
    TOTAL_AMT/D12.2 AS 'PROOM_AMT'
    AMT_TOTL1/D16.2 AS 'GPROOM_AMT'
    TOTAL_STD AS 'PTOTAL_STD'
    TOTAL_SLSAV AS 'PTOTAL_SLSAV'
BY JN8KEY
BY CITY_ST
BY PREF_NON
BY CHAIN_NAME
BY PASSNGR_NAME
BY IN_DATE
BY OUT_DATE
-*BY XIN_DOW
-* BY XOUT_DOW
ON TABLE HOLD AS HOLD8 FORMAT FOCUS INDEX JN8KEY

END


-RUN

-TYPE JOIN 7 AND 8
JOIN HOLD8.JN8KEY IN HOLD8 TO ALL HOLD7.JN6KEY IN HOLD7 AS MYJOIN
-RUN



  

DEFINE FILE HOLD8
  ADDRESS/A35 = IF CTY_VALUE LT CLIMIT THEN HTL_ADDRESS ELSE ' ';	
  CHAIN_NAME/A35 = IF CTY_VALUE LT CLIMIT THEN CHAIN_NM ELSE ' ';	
  CHAIN_PRNT/A2 = IF CTY_VALUE LT CLIMIT THEN CHAIN_CD ELSE ' ';	
  CITY_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_CITY ELSE ' ';	
  CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';	
  HTL_PHONE/A15 = IF CTY_VALUE LT CLIMIT THEN PROP_PHONE ELSE ' ';	
  HTL_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN HTL_NAME ELSE ' ';	
  HTL_RANK/A5 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';	
  STATE_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_STATE_CD 
    ELSE ' ';	
  ZIP_PRINT/A5 = IF CTY_VALUE LT CLIMIT THEN ZIP5 ELSE ' ';
  PREF_RANK/A15 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';
  FLAG/A1 = 'A';
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH CTY_PRINT = HHMMSS (NOWTOD);	
END

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'HOLD8';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN


TABLE FILE HOLD8
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10


-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-*

JOIN CLEAR MYJOIN
-RUN
-GOTO XXIT;

-MXRPT;

-*********************************************************************
-* Metlife report based upon PREFHTL file
-*********************************************************************

TABLE FILE MXPREFH
SUM BOOKINGS
    INVOICE_DATE
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    REFUSE_CD	
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_NAME
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
BY CHAIN_CODE
ON TABLE HOLD AS HOLD1
END
-RUN


TABLE FILE HOLD1
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  PROP_ADDRESS	
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  ROOM_AMT/D12.2	
  SAVINGS
  TOTAL_STD	
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
RANKED BY HIGHEST NMBR_DAYS NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

DEFINE FILE HOLD2
 RANK_LIMIT/I5 = &&PREF_LMT;
 DRANK/D5      = RANK;
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5  = EDIT(ARANKX,'$99999'); 
 RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                 IF RANK GT RANK_LIMIT THEN ARANK ELSE ARANK;
END
-RUN

TABLE FILE HOLD2
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NMBR_DAYS	
  NNROOMS	
  PROP_ADDRESS	
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  ROOM_AMT	
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
ON TABLE HOLD AS HOLD3
END
-RUN

DEFINE FILE HOLD3
  CHAIN_CD/A2= IF RANK_VALUE LE '&&PREF_LMT' THEN CHAIN_CODE ELSE ' ';	
  CHAIN_NM/A35= IF RANK_VALUE LE '&&PREF_LMT' THEN CHAIN_NAME ELSE ' ';	
  HTL_ADDRESS/A35= IF RANK_VALUE LE '&&PREF_LMT' THEN PROP_ADDRESS ELSE ' ';	
  HTL_NAME/A30 = IF RANK_VALUE LE '&&PREF_LMT' THEN PROP_NAME ELSE ' ';	
  PROP_PHONE/A15= IF RANK_VALUE LE '&&PREF_LMT' THEN HOTEL_PHONE ELSE ' ';	
  ZIP5/A5 = IF RANK_VALUE LE '&&PREF_LMT' THEN PROP_ZIP5 ELSE ' ';
END
-RUN

TABLE FILE HOLD3
PRINT
  BOOKINGS
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  REFUSE_CD AS 'REF_CD'
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY CHAIN_CD
BY CHAIN_NM
ON TABLE HOLD AS HOLD4
END
-RUN

TABLE FILE HOLD1
SUM 
  BOOKINGS
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  REFUSE_CD  
  ROOM_AMT	
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
ON TABLE HOLD AS RHOLD1
END
-RUN


TABLE FILE RHOLD1
PRINT *
RANKED BY HIGHEST NMBR_DAYS AS 'DAYS_RANK'
ON TABLE HOLD AS RHOLD2
END
-RUN

MATCH FILE HOLD4
PRINT *
BY CITY_ST
ON TABLE HOLD
RUN
FILE RHOLD2
SUM DAYS_RANK
BY CITY_ST
AFTER MATCH HOLD AS HOLD5 OLD-OR-NEW
END
-RUN

TABLE FILE HOLD5
PRINT *
RANKED BY HIGHEST DAYS_RANK
ON TABLE HOLD AS HOLD6
END
-RUN

-SET &&CTY_LMT = &&RANK_LIMIT;

DEFINE FILE HOLD6
  CTY_LIMIT/I2 = &&CTY_LMT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A12     = FTOA(CRANK, '(D5)', 'A12');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A13 = FTOA(LIST, '(D6)', 'A13');
  FRANK/A12=EDIT(FRANKX,'$99999999999');
  CTY_VALUE/A12 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                  IF LIST GT CTY_LIMIT THEN 'ALL OTHER' ELSE FRANK;
  JN6KEY/A97 = CITY_ST | HTL_NAME | PROP_PHONE | CHAIN_CD;
END
-RUN

TABLE FILE HOLD6
PRINT 
  BOOKINGS	
  CLIMIT	
  CTY_LIMIT	
  DAYS_RANK
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  REF_CD	
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
BY JN6KEY
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_CD
BY CHAIN_NM
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
ON TABLE HOLD AS HOLD7 FORMAT FOCUS INDEX JN6KEY
END
-RUN


DEFINE FILE MXPREFH
JN8KEY/A97 = CITY_ST | PROP_NAME | HOTEL_PHONE | CHAIN_CODE;
END
-RUN

TABLE FILE MXPREFH
SUM BOOKINGS AS 'PBOOKINGS'
    NEW_ROOM_RATE AS 'PNEW_ROOM_RATE'
    NEW_STD_RATE AS 'PNEW_STD_RATE'
    NEW_TOTAL_AMT AS 'PNEW_TOTAL_AMT'
    NNROOMS AS 'PNNROOMS'
    TTL_NGT AS 'PNMBR_DAYS'
    REFUSE_CD AS 'PREFUSE_CD'
    SAVINGS AS 'PSAVINGS'
    TOTAL_AMT/D12.2 AS 'PROOM_AMT'
    TOTAL_STD AS 'PTOTAL_STD'
    TOTAL_SLSAV AS 'PTOTAL_SLSAV'
BY JN8KEY
BY CITY_ST
BY PREF_NON
BY CHAIN_NAME
BY PASSNGR_NAME
BY IN_DATE
BY OUT_DATE
ON TABLE HOLD AS HOLD8 FORMAT FOCUS INDEX JN8KEY
END
-RUN

-TYPE JOIN 7 AND 8
JOIN HOLD8.JN8KEY IN HOLD8 TO ALL HOLD7.JN6KEY IN HOLD7 AS MYJOIN
-RUN
  

DEFINE FILE HOLD8
  ADDRESS/A35 = IF CTY_VALUE LT CLIMIT THEN HTL_ADDRESS ELSE ' ';	
  CHAIN_NAME/A35 = IF CTY_VALUE LT CLIMIT THEN CHAIN_NM ELSE ' ';	
  CHAIN_PRNT/A2 = IF CTY_VALUE LT CLIMIT THEN CHAIN_CD ELSE ' ';	
  CITY_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_CITY ELSE ' ';	
  CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';	
  HTL_PHONE/A15 = IF CTY_VALUE LT CLIMIT THEN PROP_PHONE ELSE ' ';	
  HTL_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN HTL_NAME ELSE ' ';	
  HTL_RANK/A5 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';	
  STATE_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_STATE_CD 
    ELSE ' ';	
  ZIP_PRINT/A5 = IF CTY_VALUE LT CLIMIT THEN ZIP5 ELSE ' ';
  PREF_RANK/A15 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';

  FLAG/A1 = 'A';
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH CTY_PRINT = HHMMSS (NOWTOD);	
END

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'HOLD8';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE HOLD8
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-*

JOIN CLEAR MYJOIN
-RUN
-GOTO XXIT;

-MXRPT1;

-*********************************************************************
-* Metlife report based upon PREFHTL file
-*********************************************************************

TABLE FILE MXPREFH
SUM BOOKINGS
    INVOICE_DATE
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    REFUSE_CD	
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_NAME
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
BY CHAIN_CODE
ON TABLE HOLD AS HOLD1
END
-RUN


TABLE FILE HOLD1
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  PROP_ADDRESS	
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  ROOM_AMT/D12.2	
  SAVINGS
  TOTAL_STD	
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
RANKED BY HIGHEST NMBR_DAYS NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

DEFINE FILE HOLD2
 RANK_LIMIT/I5 = &&PREF_LMT;
 DRANK/D5      = RANK;
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5  = EDIT(ARANKX,'$99999'); 
 RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                 IF RANK GT RANK_LIMIT THEN ARANK ELSE ARANK;
END
-RUN

TABLE FILE HOLD2
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NMBR_DAYS	
  NNROOMS	
  PROP_ADDRESS	
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  ROOM_AMT	
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
ON TABLE HOLD AS HOLD3
END
-RUN

DEFINE FILE HOLD3
  CHAIN_CD/A2= IF RANK_VALUE LE '&&PREF_LMT' THEN CHAIN_CODE ELSE ' ';	
  CHAIN_NM/A35= IF RANK_VALUE LE '&&PREF_LMT' THEN CHAIN_NAME ELSE ' ';	
  HTL_ADDRESS/A35= IF RANK_VALUE LE '&&PREF_LMT' THEN PROP_ADDRESS ELSE ' ';	
  HTL_NAME/A30 = IF RANK_VALUE LE '&&PREF_LMT' THEN PROP_NAME ELSE ' ';	
  PROP_PHONE/A15= IF RANK_VALUE LE '&&PREF_LMT' THEN HOTEL_PHONE ELSE ' ';	
  ZIP5/A5 = IF RANK_VALUE LE '&&PREF_LMT' THEN PROP_ZIP5 ELSE ' ';
END
-RUN

TABLE FILE HOLD3
PRINT
  BOOKINGS
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  REFUSE_CD AS 'REF_CD'
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY CHAIN_CD
BY CHAIN_NM
ON TABLE HOLD AS HOLD4
END
-RUN

TABLE FILE HOLD1
SUM 
  BOOKINGS
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  REFUSE_CD  
  ROOM_AMT	
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
ON TABLE HOLD AS RHOLD1
END
-RUN


TABLE FILE RHOLD1
PRINT *
RANKED BY HIGHEST NMBR_DAYS AS 'DAYS_RANK'
ON TABLE HOLD AS RHOLD2
END
-RUN

MATCH FILE HOLD4
PRINT *
BY CITY_ST
ON TABLE HOLD
RUN
FILE RHOLD2
SUM DAYS_RANK
BY CITY_ST
AFTER MATCH HOLD AS HOLD5 OLD-OR-NEW
END
-RUN

TABLE FILE HOLD5
PRINT *
RANKED BY HIGHEST DAYS_RANK
ON TABLE HOLD AS HOLD6
END
-RUN

-SET &&CTY_LMT = &&RANK_LIMIT;

DEFINE FILE HOLD6
  CTY_LIMIT/I2 = &&CTY_LMT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A12     = FTOA(CRANK, '(D5)', 'A12');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A13 = FTOA(LIST, '(D6)', 'A13');
  FRANK/A12=EDIT(FRANKX,'$99999999999');
  CTY_VALUE/A12 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                  IF LIST GT CTY_LIMIT THEN 'ALL OTHER' ELSE FRANK;
  JN6KEY/A97 = CITY_ST | HTL_NAME | PROP_PHONE | CHAIN_CD;
END
-RUN

TABLE FILE HOLD6
PRINT 
  BOOKINGS	
  CLIMIT	
  CTY_LIMIT	
  DAYS_RANK
  INVOICE_DATE
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  REF_CD	
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
BY JN6KEY
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_CD
BY CHAIN_NM
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
ON TABLE HOLD AS HOLD7 FORMAT FOCUS INDEX JN6KEY
END
-RUN


DEFINE FILE MXPREFH
JN8KEY/A97 = CITY_ST | PROP_NAME | HOTEL_PHONE | CHAIN_CODE;
END
-RUN

TABLE FILE MXPREFH
SUM BOOKINGS AS 'PBOOKINGS'
    NEW_ROOM_RATE AS 'PNEW_ROOM_RATE'
    NEW_STD_RATE AS 'PNEW_STD_RATE'
    NEW_TOTAL_AMT AS 'PNEW_TOTAL_AMT'
    NNROOMS AS 'PNNROOMS'
    TTL_NGT AS 'PNMBR_DAYS'
    REFUSE_CD AS 'PREFUSE_CD'
    SAVINGS AS 'PSAVINGS'
    TOTAL_AMT/D12.2 AS 'PROOM_AMT'
    TOTAL_STD AS 'PTOTAL_STD'
    TOTAL_SLSAV AS 'PTOTAL_SLSAV'
BY JN8KEY
BY CITY_ST
BY CHAIN_WIDE
BY CHAIN_NAME
BY PASSNGR_NAME
BY IN_DATE
BY OUT_DATE
ON TABLE HOLD AS HOLD8 FORMAT FOCUS INDEX JN8KEY
END
-RUN

-TYPE JOIN 7 AND 8
JOIN HOLD8.JN8KEY IN HOLD8 TO ALL HOLD7.JN6KEY IN HOLD7 AS MYJOIN
-RUN
  

DEFINE FILE HOLD8
  ADDRESS/A35 = IF CTY_VALUE LT CLIMIT THEN HTL_ADDRESS ELSE ' ';	
  CHAIN_NAME/A35 = IF CTY_VALUE LT CLIMIT THEN CHAIN_NM ELSE ' ';	
  CHAIN_PRNT/A2 = IF CTY_VALUE LT CLIMIT THEN CHAIN_CD ELSE ' ';	
  CITY_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_CITY ELSE ' ';	
  CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';	
  HTL_PHONE/A15 = IF CTY_VALUE LT CLIMIT THEN PROP_PHONE ELSE ' ';	
  HTL_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN HTL_NAME ELSE ' ';	
  HTL_RANK/A5 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';	
  STATE_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_STATE_CD 
    ELSE ' ';	
  ZIP_PRINT/A5 = IF CTY_VALUE LT CLIMIT THEN ZIP5 ELSE ' ';
  PREF_RANK/A15 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';

  FLAG/A1 = 'A';
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH CTY_PRINT = HHMMSS (NOWTOD);	
END

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'HOLD8';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE HOLD8
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-*

JOIN CLEAR MYJOIN
-RUN



-XXIT;
