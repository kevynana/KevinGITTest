-* Created for new DL Bonus Points File - JK 10/13/14
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.


-INCLUDE SETECHO
SET ASNAMES=ON

-SET &FMM=EDIT(&&FROMDT.EVAL,'$$$$$99');
-SET &FMD=EDIT(&&FROMDT.EVAL,'$$$$$$$$99');
-SET &FMY=EDIT(&&FROMDT.EVAL,'9999');
-SET &TOM=EDIT(&&TODT.EVAL,'$$$$$99');
-SET &TOD=EDIT(&&TODT.EVAL,'$$$$$$$$99');
-SET &TOY=EDIT(&&TODT.EVAL,'9999');


-SET &&SP = '|';
-SET &&SP3 = IF &&ROLLCNCT EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP4 = IF &&ROLLPHN EQ ' ' THEN ' ' ELSE &&SP;
-SET &&RCNCT = &&ROLLCNCT.LENGTH;
-SET &&CSL = &&ROLLCS.LENGTH;
-SET &&CSLP = IF &&RCNCT.EVAL GE 10 OR &&CSL.EVAL GE 10 THEN 60 ELSE 68;
-SET &&ROLLCS11 = TRUNCATE(&&ROLLCS);
-SET &&RCNCT1 = TRUNCATE(&&ROLLCNCT);
-SET &&RPTSUF = &TOY.EVAL||&TOM.EVAL||&TOD.EVAL;


-INCLUDE FDEFRPTSP2P1
-RUN


-SET &&OUTLINE2='FORMAT COMT';
-RUN

DEFINE FILE AIRHLD
NOWTOD/A8 WITH ROLLUP_CODE = HHMMSS (NOWTOD);
ROLLUP_CODE/A8 = '&&ROLLUP.EVAL';
-* AIR_HTL1/A10 = IF HTLBT EQ '0/+1' AND FLAGA EQ 'Y' AND FLAGH EQ 'Y' THEN '+1/+1' ELSE HTLBT;

END
TABLE FILE AIRHLD
PRINT PNR_LOCATOR AS 'PNR'
    RES_SYS AS 'GDS'    
    VALALN AS 'VALIDATING AIRLINE'
    DL_FLAG AS 'AIRLINE FLAG'  
BY ROLLUP_CODE NOPRINT 
BY PNR_LOCATOR NOPRINT
BY RES_SYS NOPRINT   
HEADING
 "&&DTDESC &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
"<&&CSLP &&ROLLNME <+0> &&SP <+0> &&ROLLCS11 <+0> &&SP3 <+0> &&RCNCT1 <+0> &&SP4 <+0> &&ROLLPHN"
"</2"
"<10 &&RPT_TTL1"
"<10 &&RPT_TTL2"
"</2"
FOOTING BOTTOM
"eTTek Review &DATE AT <NOWTOD <60 &&FOOTR"
-* ON TABLE SET LINES 60000
ON TABLE SET PAGE-NUM OFF
ON TABLE NOTOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=1.250000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=1.000000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
-* TYPE=REPORT, TITLETEXT=EXLOVER, ROWOVERFLOW=OFF,$   
TYPE=REPORT,FONT=ARIAL, SIZE=8, COLOR=BLACK, 
     BACKCOLOR=NONE, STYLE=NORMAL, $


TYPE=FOOTING, SIZE=7, FONT=ARIAL, COLOR=RGB(70 136 177), $
TYPE=TABFOOTING,SIZE=7, FONT=ARIAL, COLOR=RGB(70 136 177), $

TYPE=TITLE, SIZE=8, FONT=ARIAL, JUSTIFY=LEFT, STYLE=BOLD, $
TYPE=HEADING, SIZE=9, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=HEADING, LINE=6, SIZE=10, FONT=ARIAL, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=HEADING, LINE=7, SIZE=10, FONT=ARIAL, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=REPORT, IMAGE=&&TNTPIC, POSITION=(&&TNTTRPOS), SIZE=(&&TNTTRSIZ), $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLTRPOS), SIZE=(&&ROLTRSIZ), $
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO JOY


-SET &&SAVEDXLS = '"'| &&TEMPPATH ||&DTTMIID || '.XLS' || '"' ;
-SET &&SAVEDCSV = '"'| &&TEMPPATH ||&DTTMIID || '.CSV' || '"' ;
-RUN

-* assume you have && USERNAME setup already
-* -SET &DESTFILE = "D:\TE\||'&&UNAME.EVAL'|| '\'|'SAVEREP.XLS';
-SET &DESTFILE = '"D:\TE\ |"&&UNAME.EVAL" || "\" | "SAVREP.XLS"';
-* -SET &DESTFILE = &&WEB_PATH || 'SAVREP.XLS';
-RUN

-SET &DESTFILE2 = '"D:\TE\ |"&&UNAME.EVAL" || "\" | "SAVREP.CSV"';
-* -SET &DESTFILE2 = &&WEB_PATH || 'SAVREP.CSV';
-* I think you may use copy command as well
-RUN
-DOS COPY &DESTFILE2
-RUN
-DOS RENAME &DESTFILE &DESTFILE2
-RUN
-DOS COPY &&SAVEDCSV &DESTFILE
-QUIT

-JOY

-IF &RECORDS EQ 0 THEN GOTO NORECORDS ELSE GOTO XXIT;


-NORECORDS
-SET &&RPTSUF = 'MSG';
-INCLUDE FDEFRPTS
-RUN

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADERDD
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT;