-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO 
-* File BVTKTSUM.FEX
 
-* 1/27/15 - DEB - S-06899 CREATED FOR BVACHFIL  
-*11/17/2016 - RSB - S-26926 Change reports to read employee ID from EMP_ID
-*                            Changed LEVEL1 to EMP_ID
-**********************************************************************

-**********************************************************************

SET ASNAMES=ON

 
 


MATCH FILE BVAIR 
PRINT AIRLINE
    C_ITIN
    FARE_PAID
    PASSNGR_NAME
    TKT_TYPE
    TRAN_DATE
BY LEVEL_DESC
BY EMP_ID
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM
ON TABLE HOLD  
RUN
FILE BVCAR
PRINT RENTAL_DAYS
      NEW_RENTAL_AMT
      PASSNGR_NAME
      VENDOR_NAME
BY LEVEL_DESC
BY EMP_ID
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM     
AFTER MATCH HOLD AS XONE OLD-OR-NEW
END
-RUN

 
MATCH FILE XONE
PRINT AIRLINE
    C_ITIN
    FARE_PAID
    PASSNGR_NAME
    TKT_TYPE
    TRAN_DATE
    RENTAL_DAYS
    NEW_RENTAL_AMT
    VENDOR_NAME 
BY LEVEL_DESC
BY EMP_ID
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM   
ON TABLE HOLD
RUN
FILE BVHTL
PRINT 
   NEW_TOTAL_AMT
     NNROOMS
     PASSNGR_NAME
     PROP_NAME
BY LEVEL_DESC
BY EMP_ID
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM
AFTER MATCH HOLD AS XTWO OLD-OR-NEW
END
-RUN


MATCH FILE XTWO
PRINT AIRLINE
    C_ITIN
    FARE_PAID
    PASSNGR_NAME
    TKT_TYPE
    TRAN_DATE
    RENTAL_DAYS
    NEW_RENTAL_AMT
    VENDOR_NAME 
    NEW_TOTAL_AMT
    NNROOMS
    PROP_NAME
BY LEVEL_DESC
BY EMP_ID
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM
ON TABLE HOLD
RUN
FILE BVLIM
PRINT LRDAYS
      LRAMT
      LVDR
BY LEVEL_DESC
BY EMP_ID
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM      
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN

 


-IF &LINES EQ 0 THEN GOTO xxit;



-SET &&RPTSUF = 'DTL';
-INCLUDE FDEFRPTS
-RUN


  

-**************************************************************************
DEFINE FILE XTHREE
 
NOWTOD/A8 WITH TKT_NUM = HHMMSS (NOWTOD);
ZFLAG/A1 = IF FARE_PAID EQ 0 AND NEW_RENTAL_AMT EQ 0 AND RENTAL_DAYS EQ 0 AND
            NEW_TOTAL_AMT EQ 0 AND NNROOMS EQ 0 AND LRAMT EQ 0 THEN 'Y' ELSE 'N';

 -INCLUDE DefineSubtotalFields  
END



-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'XTHREE';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************


 
  
 

 
-Checknext4
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADACH' ELSE 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;

 
-INCLUDE getLVLtitle



TABLE FILE XTHREE
HEADING
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
 
SUM
    EMP_ID AS 'Employee #'
    XPSNGR_NM AS 'Passenger,Name'
    PNR_LOCATOR AS 'PNR'
    AIRLINE AS 'Validating,Airline'
    TKT_NUM AS 'Ticket Number'
    C_ITIN AS 'Itinerary'
    FARE_PAID AS 'Paid Fare'
    PROP_NAME AS 'Hotel Name'
    NNROOMS/D8CS AS 'Room nights'
    NEW_TOTAL_AMT/D12.2CS AS 'Total Hotel Cost'
    VENDOR_NAME AS 'Car,Vendor'
    RENTAL_DAYS/D8CS AS 'Car,Days'
    NEW_RENTAL_AMT/D12.2CS AS 'Total Car Cost'
COMPUTE    TRIP_COST/D12.2CS = FARE_PAID + NEW_TOTAL_AMT + NEW_RENTAL_AMT; AS 'Total Trip Cost'
BY EMP_ID NOPRINT
BY PASSNGR_NAME NOPRINT
BY PNR_LOCATOR NOPRINT
BY TKT_NUM NOPRINT
BY TRAN_DATE NOPRINT
WHERE ZFLAG EQ 'N'

  
ON TABLE COLUMN-TOTAL

-FOOTER 
FOOTING BOTTOM
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

 
-INCLUDE &&PASTYD
-* -INCLUDE &&SMSTY
 


-* -INCLUDE &&DTSTY
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO xxit;



-xxit
