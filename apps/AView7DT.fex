-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**


-* File SMRYRPT.FEX
-* 11/2/04    TANDT-DV       ADDED CODE FOR GLOBAL CURRENCY
-* 11/30/04   TANDT-DV       CREATED FOR NEW VERSION OF ABINTPMP
-**********************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON
-RUN


-SET &&RANK_METH =  'NET_TKT_CNT';
-SET &&RANK_LIMIT =    49;

-IF &&CURRENCY EQ 'USD' THEN GOTO NEXT;

-SET &&SUBHEAD = <NAMEC;
-SET &BASF_CUR = 'BASE FARE, (' | &&CURRENCY || ')';
-SET &&PRINT6='GFARE/D16.2CS AS ' | '''&BASF_CUR.EVAL''';


-NEXT



TABLE FILE INTPMP1
SUM CP_FARE_PD 
    PAID_FAREX/D16.2CS  
    CP_AIRLINE
    DEMB_APT 
    DRTE_APT    	
    EMB_APT 
    KILO
    LABEL1
    LABEL2
    MILES
    NAMEC	
    NET_TKT_CNT	
    ORGDST
    REFUSE_CODE   	
    RTE_APT	
    TKT_NUM
    TKT_SORT
    TKT_TYPE
    XPSNGR_NM
    XDPT_DT
BY DEMB_APT NOPRINT
BY DRTE_APT NOPRINT	
BY CGBOOK
BY XPSNGR_NM NOPRINT
BY TKT_SORT NOPRINT
ON TABLE HOLD AS HOLD1
END
-RUN

-* -SET &&RANK_METH = 'NET_TKT_CNT';
-* -SET &&RANK_METH = 'FARE';

TABLE FILE HOLD1
PRINT CGBOOK
      CP_FARE_PD  
      PAID_FAREX/D16.2CS
      CP_AIRLINE
      DEMB_APT
      DRTE_APT
      LABEL1
      LABEL2         
      NET_TKT_CNT  
      KILO
      MILES
      NAMEC
      REFUSE_CODE
      RTE_APT
      TKT_NUM
      TKT_SORT
      TKT_TYPE
      XPSNGR_NM
      XDPT_DT
BY ORGDST
WHERE CGBOOK EQ 'ONLINE'
ON TABLE HOLD AS HOLD2
END
-RUN

TABLE FILE HOLD2
PRINT CGBOOK
      CP_FARE_PD  
      PAID_FAREX/D16.2CS
      DEMB_APT
      DRTE_APT  
      NET_TKT_CNT  
      CP_AIRLINE       
      KILO
      LABEL1
      LABEL2
      MILES
      NAMEC
      REFUSE_CODE
      RTE_APT
      TKT_NUM
      TKT_SORT
      TKT_TYPE
      XPSNGR_NM
      XDPT_DT
BY ORGDST
RANKED BY HIGHEST &&RANK_METH
ON TABLE HOLD AS HOLD3
END
-RUN

DEFINE FILE HOLD3
  DRANK/D5      = RANK ;
  ARANKX/A6     = FTOA(DRANK, '(D5)', 'A6');
  ARANK/A5      = EDIT(ARANKX,'$99999');
  RANK_LIMIT/I5 = &&RANK_LIMIT ;
  RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                  IF RANK GT RANK_LIMIT THEN 'OTHER' ELSE ARANK;
END
-RUN
 

TABLE FILE HOLD3
PRINT CGBOOK AS 'OBOOK'
      CP_FARE_PD AS 'OFARE'
      PAID_FAREX/D16.2CS AS 'GOFARE'
      DEMB_APT AS 'ODEMB_APT'
      DRTE_APT AS 'ODRTE_APT'
      NET_TKT_CNT AS 'OTKT'
      CP_AIRLINE AS 'OCP_AIRLINE'      
      KILO AS 'OKILO'
      LABEL1 AS 'OLABEL1'
      LABEL2 AS 'OLABEL2'
      MILES AS 'OMILES'
      NAMEC AS 'ONAMEC'
      REFUSE_CODE AS 'OREFUSE_CODE'
      RTE_APT AS 'ORTE_APT'
      TKT_NUM AS 'OTKT_NUM'
      TKT_SORT AS 'OTKT_SORT'
      TKT_TYPE AS 'OTKT_TYPE'
      XPSNGR_NM AS 'OXPSNGR_NM'
      XDPT_DT AS 'OXDPT_DT'
BY ORGDST
BY RANK_VALUE
ON TABLE HOLD AS HOLD4
END
-RUN

TABLE FILE HOLD1
PRINT CGBOOK AS 'TRBOOK'
      CP_FARE_PD AS 'TRFARE'
      PAID_FAREX/D16.2CS AS 'GTRFARE'
      DEMB_APT AS 'TRDEMB_APT'
      DRTE_APT AS 'TRDRTE_APT'
      NET_TKT_CNT AS 'TRTKT'  
      CP_AIRLINE AS 'TRCP_AIRLINE'      
      KILO AS 'TRKILO'
      LABEL1 AS 'TRLABEL1'
      LABEL2 AS 'TRLABEL2'
      MILES AS 'TRMILES'
      NAMEC AS 'TRNAMEC'
      REFUSE_CODE AS 'TRREFUSE_CODE'
      RTE_APT AS 'TRRTE_APT'
      TKT_NUM AS 'TRTKT_NUM'
      TKT_SORT AS 'TRTKT_SORT'
      TKT_TYPE AS 'TRTKT_TYPE'
      XPSNGR_NM AS 'TRXPSNGR_NM'
      XDPT_DT AS 'TRXDPT_DT'
BY ORGDST
WHERE CGBOOK EQ 'TRADITIONAL'
ON TABLE HOLD AS HOLD5
END
-RUN

TABLE FILE HOLD5
PRINT TRBOOK
      TRFARE
      GTRFARE
      TRDEMB_APT
      TRDRTE_APT  
      TRTKT 
      TRCP_AIRLINE       
      TRKILO
      TRLABEL1
      TRLABEL2
      TRMILES
      TRNAMEC
      TRREFUSE_CODE
      TRRTE_APT
      TRTKT_NUM
      TRTKT_SORT
      TRTKT_TYPE
      TRXPSNGR_NM
      TRXDPT_DT
BY ORGDST
ON TABLE HOLD AS HOLD6
END
-RUN

MATCH FILE HOLD4
PRINT OBOOK
      OFARE
      GOFARE
      ODEMB_APT
      ODRTE_APT
      OTKT
      OCP_AIRLINE     
      OKILO
      OLABEL1
      OLABEL2
      OMILES
      ONAMEC
      OREFUSE_CODE
      ORTE_APT 
      OTKT_NUM 
      OTKT_SORT
      OTKT_TYPE
      OXPSNGR_NM
      OXDPT_DT
      RANK_VALUE
BY ORGDST
ON TABLE HOLD
RUN
FILE HOLD6
PRINT TRBOOK
      TRFARE
      GTRFARE
      TRDEMB_APT
      TRDRTE_APT
      TRTKT
      TRCP_AIRLINE     
      TRKILO
      TRLABEL1
      TRLABEL2
      TRMILES
      TRNAMEC
      TRREFUSE_CODE
      TRRTE_APT 
      TRTKT_NUM 
      TRTKT_SORT
      TRTKT_TYPE
      TRXPSNGR_NM
      TRXDPT_DT
BY ORGDST
AFTER MATCH HOLD AS XONE OLD
END
-RUN

TABLE FILE XONE
PRINT OBOOK
      OFARE
      GOFARE
      ODEMB_APT
      ODRTE_APT
      OTKT
      OCP_AIRLINE     
      OKILO
      OLABEL1
      OLABEL2
      OMILES
      ONAMEC
      OREFUSE_CODE
      ORTE_APT 
      OTKT_NUM 
      OTKT_SORT
      OTKT_TYPE
      OXPSNGR_NM
      OXDPT_DT
      RANK_VALUE
      TRBOOK
      TRFARE
      GTRFARE
      TRDEMB_APT
      TRDRTE_APT
      TRTKT
      TRCP_AIRLINE     
      TRKILO
      TRLABEL1
      TRLABEL2
      TRMILES
      TRNAMEC
      TRREFUSE_CODE
      TRRTE_APT 
      TRTKT_NUM 
      TRTKT_SORT
      TRTKT_TYPE
      TRXPSNGR_NM
      TRXDPT_DT
BY ORGDST
ON TABLE HOLD AS XTWO
END
-RUN

TABLE FILE HOLD2
SUM &&RANK_METH
BY ORGDST
ON TABLE HOLD AS RHOLD1
END
-RUN


TABLE FILE RHOLD1
PRINT &&RANK_METH
RANKED BY HIGHEST &&RANK_METH AS 'SEG_RANK'
BY ORGDST
ON TABLE HOLD AS RHOLD2
END
-RUN

MATCH FILE XTWO
PRINT OBOOK
      OFARE
      GOFARE
      ODEMB_APT
      ODRTE_APT
      OTKT
      OCP_AIRLINE     
      OKILO
      OLABEL1
      OLABEL2
      OMILES
      ONAMEC
      OREFUSE_CODE
      ORTE_APT 
      OTKT_NUM 
      OTKT_SORT
      OTKT_TYPE
      OXPSNGR_NM
      OXDPT_DT
      RANK_VALUE
      TRBOOK
      TRFARE
      GTRFARE
      TRDEMB_APT
      TRDRTE_APT
      TRTKT
      TRCP_AIRLINE     
      TRKILO
      TRLABEL1
      TRLABEL2
      TRMILES
      TRNAMEC
      TRREFUSE_CODE
      TRRTE_APT 
      TRTKT_NUM 
      TRTKT_SORT
      TRTKT_TYPE
      TRXPSNGR_NM
      TRXDPT_DT
BY ORGDST
ON TABLE HOLD
RUN
FILE RHOLD2
SUM SEG_RANK
BY ORGDST
AFTER MATCH HOLD AS HOLD7 OLD-OR-NEW
END
-RUN

TABLE FILE HOLD7
PRINT OBOOK
      OFARE
      GOFARE
      ODEMB_APT
      ODRTE_APT
      OTKT
      OCP_AIRLINE     
      OKILO
      OLABEL1
      OLABEL2 
      OMILES
      ONAMEC
      OREFUSE_CODE
      ORTE_APT 
      OTKT_NUM 
      OTKT_SORT
      OTKT_TYPE
      OXPSNGR_NM
      OXDPT_DT
      RANK_VALUE
      TRBOOK
      TRFARE
      GTRFARE
      ORGDST
      TRDEMB_APT
      TRDRTE_APT
      TRTKT
      TRCP_AIRLINE     
      TRKILO
      TRLABEL1
      TRLABEL2
      TRMILES
      TRNAMEC
      TRREFUSE_CODE
      TRRTE_APT 
      TRTKT_NUM 
      TRTKT_SORT
      TRTKT_TYPE
      TRXPSNGR_NM
      TRXDPT_DT
RANKED BY HIGHEST SEG_RANK
ON TABLE HOLD AS HOLD8
END
-RUN

DEFINE FILE HOLD8
  ORG_LIMIT/I2 = &&RANK_LIMIT ;
  OLIMIT/A2    = EDIT(ORG_LIMIT) ;
  CRANK/D5     = RANK;
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF ORGDST NE LAST ORGDST THEN (LAST LIST + 1) 
    ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6  = EDIT(FRANKX,'$999999'); 
  ORG_VALUE/A6 = IF ORG_LIMIT EQ 0 THEN BRANK ELSE
               IF LIST GT ORG_LIMIT THEN 'OTHER' ELSE FRANK;
END
-RUN

TABLE FILE HOLD8
PRINT OBOOK
      OFARE
      GOFARE
      ODEMB_APT
      ODRTE_APT
      OTKT
      OCP_AIRLINE     
      OKILO
      OLABEL1
      OLABEL2
      OMILES
      ONAMEC
      OREFUSE_CODE
      ORTE_APT
      ORGDST
      OTKT_NUM 
      OTKT_SORT
      OTKT_TYPE
      OXPSNGR_NM
      OXDPT_DT
      OLIMIT
      TRBOOK
      TRFARE
      GTRFARE
      SEG_RANK
      TRDEMB_APT
      TRDRTE_APT
      TRTKT
      TRCP_AIRLINE     
      TRKILO
      TRLABEL1
      TRLABEL2
      TRMILES
      TRNAMEC
      TRREFUSE_CODE
      TRRTE_APT 
      TRTKT_NUM 
      TRTKT_SORT
      TRTKT_TYPE
      TRXPSNGR_NM
      TRXDPT_DT
BY ORG_VALUE
BY RANK_VALUE
ON TABLE HOLD AS HOLD9
END
-RUN

TABLE FILE HOLD9
PRINT OBOOK AS 'CGBOOK'
      OFARE AS 'FARE'
      GOFARE AS 'GFARE'
      ODEMB_APT AS 'DEMB_APT'
      ODRTE_APT AS 'DRTE_APT'
      OTKT AS 'NET_TKT_CNT'
      OCP_AIRLINE AS 'CP_AIRLINE'
      OKILO AS 'KILO'
      OLABEL1 AS 'LABEL1'
      OLABEL2 AS 'LABEL2'
      OMILES AS 'MILES'
      ONAMEC AS 'NAMEC'
      OREFUSE_CODE AS 'REFUSE_CODE'
      ORTE_APT AS 'RTE_APT'
      OTKT_NUM AS 'TKT_NUM'
      OTKT_SORT AS 'TKT_SORT'
      OTKT_TYPE AS 'TKT_TYPE'
      OXPSNGR_NM AS 'XPSNGR_NM'
      OXDPT_DT AS 'XDPT_DT'
      OLIMIT
BY ORG_VALUE
BY ORGDST
BY RANK_VALUE
WHERE OBOOK NE ' '
ON TABLE HOLD AS HOLD10 FORMAT FOCUS
END
-RUN


TABLE FILE HOLD9
PRINT TRBOOK AS 'CGBOOK'
      TRFARE AS 'FARE'
      GTRFARE AS 'GFARE'
      TRDEMB_APT AS 'DEMB_APT'
      TRDRTE_APT AS 'DRTE_APT'
      TRTKT AS 'NET_TKT_CNT'
      TRCP_AIRLINE AS 'CP_AIRLINE'
      TRKILO AS 'KILO'
      TRLABEL1 AS 'LABEL1'
      TRLABEL2 AS 'LABEL2'
      TRMILES AS 'MILES'
      TRNAMEC AS 'NAMEC'
      TRREFUSE_CODE AS 'REFUSE_CODE'
      TRRTE_APT AS 'RTE_APT'
      TRTKT_NUM AS 'TKT_NUM'
      TRTKT_SORT AS 'TKT_SORT'
      TRTKT_TYPE AS 'TKT_TYPE'
      TRXPSNGR_NM AS 'XPSNGR_NM'
      TRXDPT_DT AS 'XDPT_DT'
      OLIMIT
BY ORG_VALUE
BY ORGDST
BY RANK_VALUE
WHERE TRBOOK NE ' '
ON TABLE HOLD AS HOLD10S FORMAT FOCUS
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK=&HLDPATH || 'HOLD10.FOC';
-SET &HNORANK=&HLDPATH || 'HOLD10S.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD 
&HRANK AS HOLD10
&HNORANK AS HOLD10
END
-RUN


TABLE FILE HOLD10
PRINT
    CP_AIRLINE
    DEMB_APT 
    DRTE_APT   	
    FARE
    GFARE
    KILO
    LABEL1
    LABEL2
    MILES
    NAMEC	
    NET_TKT_CNT	
    OLIMIT	
    ORGDST
    REFUSE_CODE	
    TKT_NUM
    TKT_SORT
    TKT_TYPE
    XPSNGR_NM
    XDPT_DT	
BY ORG_VALUE
BY DEMB_APT NOPRINT
BY DRTE_APT NOPRINT
BY RANK_VALUE
BY CGBOOK
BY XPSNGR_NM NOPRINT
BY TKT_SORT NOPRINT
ON TABLE HOLD AS HOLD11
END
-RUN

DEFINE FILE HOLD11
  DEMBARK_APT/A21 = IF ORG_VALUE LT OLIMIT THEN DEMB_APT ELSE 'ALL OTHER';
  DROUTE_APT/A21 = IF ORG_VALUE LT OLIMIT THEN DRTE_APT ELSE 'ALL OTHER';
  ORG_PRINT/A55 =IF ORG_VALUE LT OLIMIT THEN ORGDST ELSE 'ALL OTHER';
  RO_PRINT/A33   =IF ORG_VALUE LT OLIMIT THEN CGBOOK ELSE ' ';
  EMB_LBL/A25 = IF ORG_VALUE LT OLIMIT THEN LABEL1 ELSE 'ALL OTHER';
  RTE_LBL/A25 = IF ORG_VALUE LT OLIMIT THEN LABEL2 ELSE 'ALL OTHER';
END
-RUN





TABLE FILE HOLD11
SUM CP_AIRLINE
    DEMB_APT
    DEMBARK_APT 
    DRTE_APT
    DROUTE_APT
    EMB_LBL
    RTE_LBL  	
    FARE
    GFARE
    KILO
    MILES
    NAMEC	
    NET_TKT_CNT	
    OLIMIT	
    ORGDST
    REFUSE_CODE	
    TKT_NUM
    TKT_SORT
    TKT_TYPE
    XPSNGR_NM
    XDPT_DT	
BY ORG_VALUE
BY DEMBARK_APT NOPRINT 
BY DROUTE_APT NOPRINT  
BY ORG_PRINT  
BY RANK_VALUE
BY RO_PRINT
BY XPSNGR_NM NOPRINT
BY TKT_SORT NOPRINT
ON TABLE HOLD AS HOLD12
END
-RUN


TABLE FILE HOLD12
PRINT CP_AIRLINE
    DEMB_APT 
    DEMBARK_APT
    DROUTE_APT
    DRTE_APT
    EMB_LBL   	
    FARE
    GFARE
    KILO
    MILES
    NAMEC	
    NET_TKT_CNT	
    OLIMIT	
    ORGDST
    ORG_PRINT
    ORG_VALUE
    RANK_VALUE
    REFUSE_CODE
    RO_PRINT
    RTE_LBL	
    TKT_NUM
    TKT_TYPE
    XDPT_DT   
BY XPSNGR_NM
BY TKT_SORT
ON TABLE HOLD AS HOLD13 FORMAT FOCUS
END
-RUN


TABLE FILE HOLD13
PRINT TKT_TYPE
      XDPT_DT
      DEMB_APT
      DRTE_APT
      CP_AIRLINE
      FARE 
      NET_TKT_CNT
BY ORG_VALUE
BY RO_PRINT
BY XPSNGR_NM
BY TKT_NUM
BY TKT_SORT NOPRINT
BY XDPT_DT NOPRINT
ON TABLE HOLD AS DEBTEST FORMAT ALPHA
END
-RUN







-TYPE BEFORE DEFINES


 

DEFINE FILE HOLD13

-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*7/31/00     IBISTL-KR             ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
NOWTOD/A8 WITH ORG_VALUE = HHMMSS (NOWTOD);
END

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'HOLD13';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE HOLD13
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-*

-* REJ EX RESTART 
-*-*-EXIT
