-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* ADDED TRANTYPE INCLUDE - JK 12/9/14 STORY ID S-06492

-* File PASSNGRS.FEX

SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
  FARE_PAID/D12.2 = SEG_AMT + SEG_TAX;
  LEVEL_DESC/A60      = &&LDESC;
  TKT_PURCH/D8CS = IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (FARE_PAID GE 0) AND
                          (SEG_COUNT EQ 1) AND 
                          (CONJ_REL EQ 1) THEN 1 ELSE 0; 
  TRAN_MONTH/MTYY = TRN_DATE; 
  TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                            (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                          IF (SEG_COUNT LE 0) AND 
                            (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                          IF (SEG_COUNT LE 0) AND 
                            (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                          IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
 XTRAN_DT/MDYY        = TRN_DATE; 
 XDPT_DT/MDYY         = DPT_DATE;
 -* ****DEFINES ON PREVIOUS DEFINES****  
 DPT/MDYY = IF SEG_NBR EQ '01' OR EMBARK EQ 'FP2' THEN XDPT_DT ELSE ' ';   
-INCLUDE TRANTYPE  
END
-RUN

TABLE FILE &&EXTRACT
PRINT ADIR_ALL  
  AIRLINE
  AIR_KEY
  C_ITIN
  CLASS	
  DOC_TYPE
  DPT
  FARE_PAID
  PASSNGR_NAME	
  PNR_LOCATOR	
  REFUSE_KEY	
  TKT_NUM	
  TKT_PURCH	
  TRAN_MONTH
  TKT_TYPE
  XTRAN_DT
  
-INCLUDE &AIRDATES

WHERE VOID_DATE EQ 0
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD

END

-*-EXIT
