

-INCLUDE SETECHO
-*=================================================================================================
-* CodeDVR.fex
-* This program reads data from DVR segment in BRPTFLDS, and then read back to variables and
-* construct where statements for Data Vault Reports.
-* 06/10/2008
-*  02/05/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-* 12/2/2015 - DLV - S-13469 Added -DEFAULT &WHATCS corrected &WHATCS statement to
-*                             include backing out of lost savings amounts

-*=================================================================================================
-DEFAULT &WHATCS = '';

-SET &DVEXPARM = &&WEB_PATH || 'DVEXPARM.FEX';
FILEDEF DVEXPARM DISK &DVEXPARM
 
-*-SET &DVLSPARM = &&WEB_PATH || 'DVLSPARM.FEX';
-*FILEDEF DVLSPARM DISK &DVLSPARM
-RUN
 
-WRITE DVEXPARM
-CLOSE DVEXPARM
-*-WRITE DVLSPARM
-*-CLOSE DVLSPARM
 
-IF &&FROMAVRP EQ 'Y' GOTO :DV1;
 
TABLE FILE BRPTFLDS
PRINT SEG.DVR.DVRID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS DVRSEG
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO DVRDONE;
-READ DVRSEG &X.1. &TRAN1.1. &TRAN2.1. &TRAN3.1. &TRAN4.1. &TRAN5.1.  &LSONLY.1. &UNUSEDT1.1. &UNUSEDT2.1. &UNUSEDT3.1. &UNUSEDT4.1.
-GOTO :DV1_CONT;
 
-:DV1
-SET &&TRANTYPE='';
TABLE FILE BRPT_FLDS_DVR
PRINT *
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS DVRSEG
END
-RUN
-IF &LINES EQ 0 THEN GOTO DVRDONE;
-READ DVRSEG &X.11. &TRAN1.6. &TRAN2.6. &TRAN3.6. &TRAN4.6. &TRAN5.6.  &LSONLY.6. &UNUSEDT1.6. &UNUSEDT2.6. &UNUSEDT3.6. &UNUSEDT4.6.
 
-:DV1_CONT
 
-CLOSE DVRSEG;
 
-TYPE &TRAN1 &TRAN2 &TRAN3 &TRAN4 &TRAN5 &LSONLY &UNUSEDT1 &UNUSEDT2 &UNUSEDT3 &UNUSEDT4
 
-*Expense Report
-SET &GETAIREXP  = IF &TRAN1 EQ 1 OR &TRAN2 EQ 1 THEN 'Y' ELSE 'N';
-SET &GETCAREXP  = IF &TRAN1 EQ 1 OR &TRAN3 EQ 1 THEN 'Y' ELSE 'N';
-SET &GETLIMEXP  = IF &TRAN1 EQ 1 OR &TRAN3 EQ 1 THEN 'Y' ELSE 'N';
-SET &GETHTLEXP  = IF &TRAN1 EQ 1 OR &TRAN4 EQ 1 THEN 'Y' ELSE 'N';
-SET &GETPROFEXP = IF &TRAN1 EQ 1 OR &TRAN5 EQ 1 THEN 'Y' ELSE 'N';
 
-WRITE DVEXPARM &&TRANTYPE
-CLOSE DVEXPARM
 
-*Cost Savings, &WHATCS is used in DVRAIRCS1.
-*-SET &WHATCS = IF &LSONLY EQ 1 THEN 'WHERE DISSAVINGS GT 0 ' ELSE ' ';
-SET &WHATCS = IF &LSONLY EQ 1 THEN 'WHERE DTSAVE GT 1 OR DTSAVE LT (-1) ' ELSE ' ';
 -*-WRITE DVLSPARM &WHATCS
-*-CLOSE DVLSPARM
 
-*Unused Tickets
-SET &WHATSTATUS = IF &UNUSEDT1 EQ 1 THEN 'WHERE STATUS_CODE EQ ''A'' OR ''U'' OR ''X'''
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''U'''
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''U'' OR ''X'''
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''U'' OR ''A'''
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''X'' OR ''A'''
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''X'''
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''A'''
- ELSE ' ';
 
 
-DVRDONE


 