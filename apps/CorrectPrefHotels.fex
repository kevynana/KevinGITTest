-* CorrectPrefHotels.fex
-*
-* Locate the hotel databases based on the rollup codes in your excel file, and then if the CHAIN_CODE in 
-* HR_50 matches the CHAIN_CODE field in your excel file for that rollup code, and if the field CHKIN_DATE 
-* in HR_50 falls within Effective Date and End Date in your excel file, I should update CLIENT_PREF in 
-* HR_50 to have value of "P" if it was blank.  If it was not blank, the value in CLIENT_PREF should not be changed.
-*


-SET &ECHO = ALL;
-SET &HTL_PATH='D:\TNT\TTRACKER\DATA\';
TABLE FILE PrefChainAccts
BY ROLLUP_CODE
ON TABLE SAVE AS ALLROLLS
END
-RUN

-SET &TROLLS = &LINES;

-REPEAT TOEND &TROLLS TIMES
-READ ALLROLLS NOCLOSE &ROLLUP.8.

TABLE FILE ROLLUP
PRINT COMP QTR_ENABLE
BY ROLLUP
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
ON TABLE SAVE AS ROLLINFO
END
-RUN
-READ ROLLINFO &X.8. &COMP.6. &QTR.1.
-TYPE &ROLLUP &X &COMP &QTR
-IF '&QTR.EVAL' EQ 'X' THEN GOTO :QTRDB ELSE GOTO :SINGLEDB;

-:QTRDB
-SET &CNT = 1;
-REPEAT WithinRoll 12 TIMES
-SET &QTRNO = IF &CNT LE 9 THEN &CNT 
- ELSE IF &CNT EQ 10 THEN '0' ELSE IF &CNT EQ 11 THEN 'Y' ELSE 'Z';

-INCLUDE SETHOTELDB
-SET &CNT = &CNT + 1;
-WithinRoll
-GOTO TOEND;

-:SINGLEDB
-SET &QTRNO = '_';
-INCLUDE SETHOTELDB

-TOEND