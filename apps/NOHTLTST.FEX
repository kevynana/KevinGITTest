SET ASNAMES=ON

USE 
D:\TNT\TTRACKER\DATA\AYKIEW.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\SYKIEW.FOC AS SR_50
D:\TNT\TTRACKER\DATA\TYKIEW.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\HYKIEW.FOC AS HR_50

END


DEFINE FILE SR_50
NEW_STAY/P12 = STAY;
JNKEY/A15 = AGENT_NUM|TKT_NUM;
END
TABLE FILE SR_50
PRINT NEW_STAY
-* RTE_CTY.CITY_NAME AS 'RTE_CTY_NM' 
BY AGENT_NUM
BY TKT_NUM
BY SEG_NBR
WHERE TRN_DATE GE '20090801' AND TRN_DATE LE '20090831'
WHERE VOID_DATE EQ 0
WHERE CATEGORY NE 'GLOBAL' OR 'PERSONAL' OR 'LEISURE' OR 'MEETING'
ON TABLE HOLD AS AIRHLD
END
-RUN

TABLE FILE AIRHLD
SUM NEW_STAY 
BY AGENT_NUM
BY TKT_NUM
BY SEG_NBR
ON TABLE HOLD AS AIRHLD1
END
-RUN

TABLE FILE AIRHLD1
SUM NEW_STAY 
BY AGENT_NUM
BY TKT_NUM
BY SEG_NBR
WHERE NEW_STAY NE 0
ON TABLE HOLD AS AIRHLD2
END
-RUN

DEFINE FILE HR_50
NBR_DAYS/P12 =  NUM_DAYS;
NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                 ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;                 
JNKEY/A15 = AGENT_NUM|TKT_NUM;
END
TABLE FILE HR_50
SUM NNROOMS
BY AGENT_NUM
BY TKT_NUM
WHERE INVOICE_DATE GE '20090801' AND INVOICE_DATE LE '20090831'
WHERE CATEGORY NE 'GLOBAL' OR 'PERSONAL' OR 'LEISURE' OR 'MEETING'
WHERE TKT_NUM NE '0000000000'
ON TABLE HOLD AS HTLHLD
END
-RUN

TABLE FILE HTLHLD
SUM NNROOMS
BY AGENT_NUM
BY TKT_NUM
ON TABLE HOLD AS HTLHLD1 
END
-RUN


MATCH FILE AIRHLD2
PRINT NEW_STAY SEG_NBR
BY AGENT_NUM
BY TKT_NUM
-* BY SEG_NBR
ON TABLE HOLD
RUN
FILE HTLHLD1
SUM NNROOMS
BY AROLL_DSC2
BY AGENT_NUM
BY TKT_NUM
AFTER MATCH HOLD AS AIRH1 OLD
END
-RUN

TABLE FILE AIRH1
SUM NEW_STAY NNROOMS
BY AGENT_NUM
BY TKT_NUM
BY SEG_NBR
ON TABLE COLUMN-TOTAL
END
-RUN
-QUIT

                 


