-********************************************************************
-* Modifications:
-* CREATED FOR DATA VAULT AIR DETAIL REPORT CREATED FROM AVIW74DT
-* Data Vault Report - Cost Savings
-* 5/10/10 - changed Level1 to be handled like all other Levels - Deb 
-*3/17/15 S-07667 - UPDATED COLUMN TITLE ON REF_AL
-*7/12/16 -DLV -  S-20630   Added EMP_ID to report  
-*03/09/17 - DLV - S-22486 - Updated IMAGE define to use server report is being ran from
-******************************************************************** 
SET ASNAMES=ON
-INCLUDE SETECHO

-SET &RPTTITLE = IF '&&ROLLUP.EVAL' NE 'OTHER-R' THEN  'Travel and Transport Cost Savings Report for &&ROLLNAME.EVAL Account'
- ELSE 'Travel and Transport Cost Savings Report for Client &&CLIENT.EVAL Account';

-IF &&COSAVRECS EQ 0 THEN GOTO NoCostSavRec;

DEFINE FILE DVRAIRCS
-INCLUDE GENDEFINE
-*IMAGE/A80 = '<img src=HTTPS://www.ettekreview.com/asp/NEW_HDR.jpg>';
IMAGE/A80 = '<img src=' || '&&SRVR.EVAL' || '/asp/NEW_HDR.PNG>';
END

TABLE FILE DVRAIRCS
HEADING 
"<IMAGE>"
"</5"
"&RPTTITLE.EVAL"
"&&DTDESC.EVAL &&FROMDT - &&TODT " 

SUM BR_CL_IDX AS 'ACCT'
  LEVEL1 &&LV1 
  XPSNGR_NM AS 'TRAVELER'
  EMP_ID &EMPID
  XTRAN_DT AS 'INVOICE'
  XFST_DPT AS 'TRAVEL' 
  RADV_PURCH AS 'ADV'
  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  C_ITIN AS 'ITINERARY'
  DISC_FARE AS 'PUBLISHED'
  FARE_AMT AS 'TRAVEL AND TRANSPORT'
  SAVE_AMT AS 'SAVINGS'
  REFUSE_CODE AS 'METHOD'
-*DVLOW AS 'DEC'L'
-*DVLST AS 'LOST'
  TLOW AS 'DEC'L'
  DTSAVE AS 'LOST'
  REF_AL AS 'DEC'L A/L'
  REF_RSN AS 'REASON'
  NET_TKT_CNT NOPRINT 
  LEVEL2 &&LV2
  LEVEL3 &&LV3
  LEVEL4 &&LV4 
  LEVEL5 &&LV5
  LEVEL6 &&LV6
  LEVEL7 &&LV7
  TRIP_PURPOSE &&TRIPPRP
  TRP_DESC &&TRIPRSN
BY BR_CL_IDX NOPRINT
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
ON BR_CL_IDX COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
    IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (RADV_PURCH/NET_TKT_CNT) ;  
ON TABLE RECOMPUTE DISC_FARE FARE_AMT SAVE_AMT TLOW DTSAV  AS 'TOTAL FOR'

-INCLUDE FOOTERDT

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 

ON TABLE SET STYLE *

UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=1.250000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=1.000000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT,FONT=TIMES NEW ROMAN, SIZE=8, COLOR=BLACK, GRID=ON, STYLE=NORMAL,WRAP= OFF, $
TYPE=TITLE, FONT=TIMES NEW ROMAN, SIZE=9, BACKCOLOR=RGB(170 170 170), $
TYPE=FOOTING, SIZE=6, $
TYPE=TITLE, SIZE=9, STYLE=BOLD+UNDERLINE, $
TYPE=HEADING, SIZE=10, STYLE=BOLD, FONT=TIMES NEW ROMAN,$
TYPE=HEADING, SIZE=14, LINE=8, STYLE=BOLD, FONT=TIMES NEW ROMAN,$

-*TYPE=REPORT, IMAGE=&&TNTPIC, POSITION=(&&TNTTRPOS), SIZE=(&&TNTTRSIZ), $
-*TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLTRPOS), SIZE=(&&ROLTRSIZ), $
TYPE=GRANDTOTAL, SIZE=9, STYLE=BOLD, COLOR=BLACK, BACKCOLOR=RGB(170 170 170),$
TYPE=REPORT, TITLETEXT=&DSC,$

ENDSTYLE

&&OUTLINE1

END
-RUN

-IF &FOCERRNUM EQ 205  OR &LINES EQ 0 THEN GOTO NoCostSavRec;
-GOTO XXITCostSav2;
-NoCostSavRec
-SET &TITLETEXT = 'Cost Savings ';
-INCLUDE DVRNoRecord
-XXITCostSav2