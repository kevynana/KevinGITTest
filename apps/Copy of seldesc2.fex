-****************************************************************************
-* Functions: This program is used to generate the footer page which is saved
-*   in sbfoot. This program contains three steps.  First, it is to extract 
-*   selection criteria from RPT_flds files, and construct to the appropriate
-*   printlines and where statements; secondly it retrieves code + desc from
-*   code tables; the last step is to write to sbfoot.fex
-* Date: March 4, 2003   - LS
-* Added &rpttyp of ETS to only allow 50 lines JK 5/29/03
-* Changed AVIW23 to be 52 lines - Steve (06/05/03)
-* Changed the ELSE to be 60 lines - Steve (06/05/03)
-* 10/22/03 LS - made changes as SU databases changes.
-* 02/23/04 LS - added changes for total company reporting.
-* 08/26/04 LS - added Trip Purpose and No Hotel Reason
-* 09/17/05 LS - added UDID 
-* 11/03/06 added Booking type,region/country/state and origin airport
-****************************************************************************
-INCLUDE SETECHO
SET USERFCHK= OFF  
-*SET TEMPERASE = OFF 

-DEFAULT &&USEPARM='X';
-DEFAULT &&STREAM='X';

-SET &&FOOTR = '&&SETF.EVAL' || '/' | '&&IKEY.EVAL';

FILEDEF SBFOOT CLEAR
FILEDEF SBFOOT DISK SBFOOT.FEX 
-RUN

-SET &FOOTLINES=IF &&STREAM EQ 'TRVLSUMK' THEN 41 ELSE
-   IF &&RPTTYPE EQ 'STS' THEN 41 ELSE 
-   IF &&RPTTYPE EQ 'ETS' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW23' OR 'AVIW83' OR 'AVI124' THEN 42 ELSE 
-   IF &&USEPARM.EVAL EQ 'AVIW74' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW90' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW48' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW98' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIEW3' OR 'UAVIW3' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIEW1' OR 'AVIW22' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'CVIEW1' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIEW1' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIEW8' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW51' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI100' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI107' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI108' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIEW8' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIEW6' THEN 47 ELSE
-   IF &&STREAM EQ 'SMP_FAR' THEN 82 ELSE
-   IF &&STREAM EQ 'HTL_PREF' THEN 45 ELSE
-   IF &&STREAM EQ 'SUMHIER' THEN 45 ELSE 51;

-*Change start - new su databases
-*Initialize the variables used as printline for level description/air/car/htl
-*&FT171 to FT175 Origin Airport 11/03/2006
-*&FT176 Region Code &FT177 Country &FT178 State
-*FT179 - 180 Booking types
-SET &CNT = 100;
-REPEAT ENDFORMAT 90 TIMES
-SET &FT.&CNT = ' ';
-SET &CNT = &CNT + 1;
-ENDFORMAT 

-*Initialize variables used for hierorg members/client/category/(client/reservation/ticketing)branch
-SET &CNT = 200;
-REPEAT TOHDES 99 TIMES
-SET &FT.&CNT = '';
-SET &CNT = &CNT + 1;
-TOHDES

-*booking type 400-410 
-*regin 411, country 412 state 413
-SET &CNT = 400;
-REPEAT region 15 TIMES
-SET &FT.&CNT = '';
-SET &CNT = &CNT + 1;
-region

DEFINE FILE BRPTFLDS
TEST/A1='X';
END
TABLE FILE BRPTFLDS
PRINT SEG BOOKTYPE_A
ON TABLE SAVE AS BOOKTYPE
END
-RUN
-IF &LINES EQ 0 THEN GOTO NOBT;
-READ BOOKTYPE &X.10. &BT1.1. &BT2.1. &BT3.1. &BT4.1. &BT5.1. &BT6.1. &BT7.1. &BT8.1. &BT9.1. &BT10.1.
-SET &ALLSEL = IF &BT1 EQ 1 AND &BT2 EQ 1 AND &BT3 EQ 1 AND &BT4 EQ 1 AND &BT5 EQ 1 AND &BT6 EQ 1 AND 
- &BT7 EQ 1 AND &BT8 EQ 1 AND &BT9 EQ 1 AND &BT10 EQ 1 THEN 'Y' ELSE 'N';

-SET &FT179 = IF &ALLSEL EQ 'Y' THEN ' '  ELSE '** Booking Types Selected: ';

-SET &FT179 = IF &BT1 EQ 1 THEN '&FT179.EVAL' | 'Agent' ELSE '&FT179.EVAL';
-SET &FIRST = IF &BT1 EQ 1 THEN 'N' ELSE 'Y';

-SET &FT179 = IF &FT179 NE ' ' AND &BT2 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Excutive Agent' 
- ELSE IF '&FT179.EVAL' NE ' ' AND &BT2 EQ 1 THEN '&FT179.EVAL' | 'Excutive Agent'  ELSE '&FT179.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT2 EQ 1 THEN 'N' ELSE 'Y';

-SET &FT179 = IF &FT179 NE ' ' AND &BT3 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Online' 
- ELSE IF '&FT179.EVAL' NE ' ' AND &BT3 EQ 1 THEN '&FT179.EVAL' | 'Online'  ELSE &FT179;
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT3 EQ 1 THEN 'Y' ELSE &FIRST;

-SET &FT179 = IF &FT179 NE ' ' AND &BT4 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Excutive Online' 
- ELSE IF '&FT179.EVAL' NE ' ' AND &BT4 EQ 1 THEN '&FT179.EVAL' | 'Excutive Online'  ELSE '&FT179.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT4 EQ 1 THEN 'Y' ELSE &FIRST;

-SET &FT179 = IF &FT179 NE ' ' AND &BT5 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Web' 
- ELSE IF '&FT179.EVAL' NE ' ' AND &BT5 EQ 1 THEN '&FT179.EVAL' | 'Web'  ELSE '&FT179.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT5 EQ 1 THEN 'Y' ELSE &FIRST;

-SET &FT179 = IF '&FT179.EVAL' NE ' ' AND &BT6 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Excutive Web' 
- ELSE IF '&FT179.EVAL' NE ' ' AND &BT6 EQ 1 THEN '&FT179.EVAL' | 'Excutive Web'  ELSE '&FT179.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT6 EQ 1 THEN 'Y' ELSE &FIRST;

-SET &FT179 = IF &FT179 NE ' ' AND &BT7 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Agency Web' 
- ELSE IF '&FT179.EVAL' NE ' ' AND &BT7 EQ 1 THEN '&FT179.EVAL' | 'Agency Web'  ELSE '&FT179.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT7 EQ 1 THEN 'Y' ELSE &FIRST;

-SET &FT179 = IF &FT179 NE ' ' AND &BT8 EQ 1  AND &FIRST EQ 'N'
- THEN '&FT179.EVAL' | ';Excutive Agency Web' 
- ELSE IF &FT179 NE ' ' AND &BT8 EQ 1 THEN '&FT179.EVAL' | 'Excutive Agency Web'  ELSE '&FT179.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT8 EQ 1 THEN 'Y' ELSE &FIRST;

-SET &FT180 = IF &BT9 EQ 1 THEN 'Exchange from Online' ELSE '';

-SET &FT180 = IF '&FT180.EVAL' NE ' ' AND &BT10 EQ 1 THEN '&FT180.EVAL' | ';Excutive Exchange from Online' 
- ELSE IF '&FT180.EVAL' EQ ' ' AND &BT10 EQ 1 THEN 'Excutive Exchange from Online'  ELSE '&FT180.EVAL';

-NOBT

-TYPE &&UDIDUSED

-IF &&ROLLUP EQ 'TOTAL-R' THEN GOTO TotalTandT;
-IF &&UDIDUSED NE 'Y' THEN GOTO FINUDID;
-******************************************************************************
-* the start of UDID changes;initialize for UDID 
-******************************************************************************
-SET &STARTCNT = 300;
-SET &CNT = &STARTCNT;
-REPEAT EndUDID 99 TIMES
-SET &FT.&CNT = '';
-SET &CNT = &CNT + 1;
-EndUDID



-SET &UFILE = 'UF' | '&&COMPNY.EVAL' || '';
JOIN CLEAR *
JOIN UDID IN BRPTFLDS TO UDID IN &UFILE

-*Retrieve from and to values
TABLE FILE BRPTFLDS
PRINT UDID UD_DESC FROMVAL TOVAL 
BY UDID NOPRINT
WHERE UINCL EQ 9
ON TABLE SAVE AS UDID9
END
-RUN


-IF &LINES EQ 0 THEN GOTO CHKUDID2;
-SET &CNT = &STARTCNT;
-SET &PrevUDID='';
-REPEAT TOUDID1 &LINES TIMES
-READ UDID9 NOCLOSE &VUDID.A3. &VUDDESC.A40. &VFROM.16. &VTO.16.

-SET &LEN=ARGLEN(40,'&VUDDESC.EVAL','I2');
-SET &VUDDESC = TRIM('T','&VUDDESC.EVAL', 40, ' ', 1, 'A&LEN.EVAL');

-SET &VFROM = TRIM('B','&VFROM.EVAL', 16, ' ', 1, 'A16');
-SET &LEN=ARGLEN(16,'&VFROM.EVAL','I2');
-SET &VFROM = TRIM('B','&VFROM.EVAL', 16, ' ', 1, 'A&LEN.EVAL');

-SET &VTO = TRIM('B','&VTO.EVAL', 16, ' ', 1, 'A16');
-SET &LEN=ARGLEN(16,'&VTO.EVAL','I2');
-SET &VTO = TRIM('B','&VTO.EVAL', 16, ' ', 1, 'A&LEN.EVAL');

-IF &PrevUDID EQ &VUDID THEN GOTO SameUDID1;
-SET &PrevUDID='&VUDID.EVAL';
-SET &FT.&CNT = '** ' | '&VUDDESC.EVAL' || ' from ' | '&VFROM.EVAL' || ' to ' | '&VTO.EVAL'; 
-*-TYPE &FT.&CNT
-GOTO IncUDID1;
-SameUDID1
-SET &CNT = &CNT - 1;
-SET &FT.&CNT = &FT.&CNT || ', from ' | '&VFROM.EVAL' || ' to ' | '&VTO.EVAL';
-IncUDID1
-SET &CNT = &CNT + 1;
-TOUDID1
-CLOSE UDID9

-CHKUDID2
-SET &CNT = IF &LINES EQ 0 THEN &STARTCNT ELSE &CNT;
TABLE FILE BRPTFLDS
PRINT UDID UINCL UD_DESC UDDATA
BY UDID NOPRINT
BY UINCL NOPRINT
WHERE UINCL NE 9
ON TABLE SAVE AS UDID2
END
-RUN

-IF &LINES EQ 0 THEN GOTO FINUDID;

-SET &PrevUDID='';
-SET &PrevIncl='';
-REPEAT TOUDID2 &LINES TIMES
-READ UDID2 &VUDID.3. &VINCL.1. &VUDDESC.40. &VUDDATA.64.
-SET &LEN=ARGLEN(40,'&VUDDESC.EVAL','I2');
-SET &VUDDESC = TRIM('T', '&VUDDESC.EVAL', 40, ' ', 1, 'A&LEN.EVAL');
-SET &LEN=ARGLEN(64,'&VUDDATA.EVAL','I2');
-SET &VUDDATA2 = TRIM('T','&VUDDATA.EVAL', 64, ' ', 1, 'A&LEN.EVAL');
-IF &PrevUDID EQ &VUDID AND &PrevIncl EQ &VINCL THEN GOTO SameUDID2;
-SET &PrevUDID='&VUDID.EVAL';
-SET &PrevIncl = '&VINCL.EVAL';
-SET &OP = IF &VINCL EQ 1 THEN ' equal to:' 
-     ELSE IF &VINCL EQ 2 THEN ' not equal to:' 
-     ELSE IF &VINCL EQ 3 THEN ' contains:' ELSE '';

-SET &FT.&CNT = '** ' | '&VUDDESC.EVAL' || ' &OP.EVAL ' | '&VUDDATA2.EVAL'; 
-GOTO IncUDID2;
-SameUDID2
-SET &CNT = &CNT - 1;
-SET &VAL = &FT.&CNT;
-SET &CNT = IF &VAL.LENGTH GT 150 THEN &CNT+1 ELSE &CNT ;
-SET &FT.&CNT = &FT.&CNT || ', ' | '&VUDDATA2.EVAL';
-IncUDID2
-SET &CNT = &CNT + 1;
-TOUDID2

-FINUDID
-******************************************************************************
-* the end of UDID changes 
-******************************************************************************

TABLE FILE BRPTFLDS
PRINT SEG HIEORG1.ID
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS HDES1
END
-RUN

-IF &LINES EQ 0 THEN GOTO NOHIEORG1;

-READ HDES1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &LEVEL.A2.
-CLOSE HDES1
-GOTO AFTERSETH1;

-NOHIEORG1
-SET &INCL1=0;
-SET &INCL2=0;
-SET &INCL3=0;
-SET &LEVEL=' ';

-AFTERSETH1
-*Hierarchy selection headings
-SET &K0 = 'NO SELECTION';
-SET &FT200 = IF &INCL3 EQ 1 
-   THEN '** HIERARCHY SELECTION - INCLUDED **'
-  ELSE IF &INCL3 EQ 2 
-   THEN '** HIERARCHY SELECTION - EXCLUDED **'
-  ELSE '** HIERARCHY SELECTION CRITERIA **';
-SET &FT201=' ----------------------------------------------------------';
-SET &FT202 = IF &INCL3 EQ 0 THEN 'NO SELECTION' ELSE ' ';

-*Client selection headings
-*-SET &FT230=IF &INCL1 EQ 0 THEN '** CLIENT SELECTION CRITERIA **'
-SET &FT230=IF &INCL1 EQ 0 THEN ' '
- ELSE IF &INCL1 EQ 1 
-  THEN '** CLIENT NUMBER SELECTION CRITERIA - INCLUDED **'
- ELSE IF &INCL1 EQ 2 
-  THEN '** CLIENT NUMBER SELECTION CRITERIA - EXCLUDED **';
-SET &FT231= IF &INCL1 EQ 0 THEN ' ' 
- ELSE ' ----------------------------------------------------------';
-*-SET &FT232=IF &INCL1 EQ 0 THEN 'NO SELECTION' ELSE ' ';

-*Category selection headings
-SET &FT240=IF &INCL2 EQ 0  THEN ' '
- ELSE IF &INCL2 EQ 1 
-   THEN '** CATEGORY SELECTION CRITERIA - INCLUDED **'
- ELSE IF &INCL2 EQ 2 
-   THEN '** CATEGORY SELECTION CRITERIA - EXCLUDED **';
-SET &FT241=IF &INCL2 EQ 0  THEN ' ' 
- ELSE ' ----------------------------------------------------------';
-*-SET &FT242=IF &INCL2 EQ 0 THEN ' ' ELSE ' ';

-*IF &INCL1,2,3 are all zero, that means no selections.
-IF &INCL1 EQ 0 AND &INCL2 EQ 0  AND &INCL3 EQ 0 THEN GOTO NoHDES;

-IF &&SETF EQ 'TCBMNBV' THEN GOTO CHK_CAT;
-IF &INCL3 EQ 0 THEN GOTO CHK_CLIENT;

TABLE FILE BRPTFLDS
PRINT MEMBER 
BY MEMBER NOPRINT
WHERE INST_KEY EQ &&IKEY 
ON TABLE HOLD AS ORGMEM1 FORMAT FOCUS INDEX MEMBER
END
-RUN

-IF &LINES EQ 0 THEN GOTO CHK_CLIENT;
-*-INCLUDE GETHRMEM
JOIN ROLL_LEV IN HIERORG TO MEMBER IN ORGMEM1
TABLE FILE HIERORG
PRINT DEPTNAME
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL' AND 
  LEVEL EQ '&LEVEL.EVAL'
WHERE ROLL_LEV EQ ORGMEM1.MEMBER
ON TABLE SAVE AS MEMBER1
END
-RUN

-READMEM
-SET &CNT=202;

-SET &LOOPTIME = INT((&LINES + 1)/2);

-REPEAT EndMember &LOOPTIME TIMES
-*-REPEAT EndMember &LINES TIMES
-*-READ MEMBER1 NOCLOSE &FT.&CNT.A60.

-SET &MEM = '';
-SET &MEM2 = '';

-READ MEMBER1 NOCLOSE &MEM.A60.
-READ MEMBER1 NOCLOSE &MEM2.A60.

-SET &FT.&CNT = '&MEM.EVAL' || '<55 &MEM2.EVAL';
-SET &CNT = &CNT + 1;

-EndMember

-CHK_CLIENT

-IF &INCL1 EQ 0 THEN GOTO CHK_CAT;
-IF &&SETF EQ 'TCBMNBV' THEN GOTO CHK_CAT;
TABLE FILE BRPTFLDS
PRINT CLIENT
IF INST_KEY EQ &&IKEY 
WHERE CLIENT NE ' '
ON TABLE SAVE AS CLIENT1
END
-RUN

-*Original variables: &&WHERE11 - &&WHERE15
-SET &CNT=232;
-REPEAT ClientEnd &LINES TIMES
-READ CLIENT1 NOCLOSE &VAL.A8
-SET &VAL2=&FT.&CNT;
-SET &CNT = IF &VAL2.LENGTH GT 64 THEN &CNT + 1 ELSE &CNT;
-SET &FT.&CNT = IF &VAL2.LENGTH GT 64 THEN '  ' | &VAL
-  ELSE &VAL2 || ' ' | &VAL;
-ClientEnd
-CLOSE CLIENT1

-CHK_CAT
-IF &INCL2 EQ 0 THEN GOTO NoHDES;
TABLE FILE BRPTFLDS
PRINT CATG
IF INST_KEY EQ &&IKEY 
WHERE CATG NE ' '
ON TABLE SAVE AS CATG1
END
-RUN
-*Original variables: &&WHERE16 - &&WHERE18
-SET &CNT=242;
-REPEAT CATGEnd &LINES TIMES
-READ CATG1 NOCLOSE &VAL.A15
-SET &VAL2=&FT.&CNT;
-SET &CNT = IF &VAL2.LENGTH GT 64 THEN &CNT + 1 ELSE &CNT;
-SET &FT.&CNT = IF &VAL2.LENGTH GT 64 THEN '  ' | &VAL
-  ELSE &VAL2 || ' ' | &VAL;
-CATGEnd
-CLOSE CATG1

-NoHDES
-*Change End - new su databases
-**************************************************
-* Added total company reporting
-**************************************************
-GOTO EndTotal;
-TotalTandT
TABLE FILE BRPTFLDS
PRINT SEG ROLL1.ID
IF INST_KEY EQ &&IKEY 
ON TABLE SAVE AS ROLL11
END
-RUN

-SET &IN1 = 0;
-SET &IN2 = 0;
-SET &IN3 = 0;
-SET &IN4 = 0;
-SET &IN5 = 0;
-SET &IN6 = 0;
-IF &LINES EQ 0 THEN GOTO NoReadRoll11;
-READ ROLL11 &X.1. &IN1.1. &IN2.1. &IN3.1. &IN4.1. &IN5.1. &IN6.1. 

-NoReadRoll11
-IF &&SETF EQ 'TCBMNBV' THEN GOTO CheckClient;
-SET &FT200 = IF &IN1 EQ 1 
-   THEN '** COMPANY SELECTION - INCLUDED **'
-  ELSE IF &IN1 EQ 2 
-   THEN '** COMPANY SELECTION - EXCLUDED **'
-  ELSE '** COMPANY SELECTION CRITERIA **';
-SET &FT201=' ----------------------------------------------------------';
-SET &FT202 = IF &IN1 EQ 0 THEN 'All Companies selected' ELSE ' ';

-CheckClient
-*Client/category selection headings
-SET &FT230=IF &IN5 EQ 0 AND &IN6 EQ 0 THEN ' '
- ELSE IF &IN6 EQ 1 
-  THEN '** CLIENT SELECTION CRITERIA - INCLUDED **'
- ELSE IF &IN6 EQ 2 
-  THEN '** CLIENT SELECTION CRITERIA - EXCLUDED **'
- ELSE IF &IN5 EQ 1 
-   THEN '** CATEGORY SELECTION CRITERIA - INCLUDED **'
- ELSE IF &IN5 EQ 2 
-   THEN '** CATEGORY SELECTION CRITERIA - EXCLUDED **';
-SET &FT231=IF &IN5 EQ 0 AND &IN6 EQ 0 THEN  ' ' ELSE
- ' ----------------------------------------------------------';
-SET &FT232=' ';

-IF &LINES EQ 0 THEN GOTO EndTotal;

-*client branch selections
-SET &FT238=IF &IN2 EQ 0 THEN ' ' 
- ELSE IF &IN2 EQ 1 THEN '** CLIENT BRANCHES - INCLUDED ** '
- ELSE IF &IN2 EQ 2 THEN '** CLIENT BRANCHES - EXCLUDED ** ';
-SET &FT239=IF &IN2 EQ 0 THEN ' ' 
- ELSE ' ----------------------------------------------------------';

-*Reservation branch selections
-SET &FT252=IF &IN3 EQ 0 THEN ' ' 
- ELSE IF &IN3 EQ 1 THEN '** RESERVATION BRANCHES - INCLUDED ** '
- ELSE IF &IN3 EQ 2 THEN '** RESERVATION BRANCHES - EXCLUDED ** ';
-SET &FT253=IF &IN3 EQ 0 THEN ' ' 
- ELSE ' ----------------------------------------------------------';

-*Ticketing branch selections
-SET &FT266=IF &IN4 EQ 0 THEN ' ' 
- ELSE IF &IN4 EQ 1 THEN '** TICKETING BRANCHES - INCLUDED **'
- ELSE IF &IN4 EQ 2 THEN '** TICKETING BRANCHES - EXCLUDED **';
-SET &FT267=IF &IN4 EQ 0 THEN ' ' 
- ELSE ' ----------------------------------------------------------';

TABLE FILE BRPTFLDS
PRINT ROLLUP BRANCH_CODE RESV_BRANCH TKT_BRANCH CATG2 BR_CL_IDX
IF INST_KEY EQ &&IKEY 
ON TABLE SAVE AS ROLL22
END
-RUN

-IF &LINES EQ 0 THEN GOTO EndTotal;

-*Defines the first printline for a particular field 
-SET &CNT  = 202;
-SET &CNT2 = 232;
-SET &CNT3 = 232;
-SET &CNT4 = 240;
-SET &CNT5 = 254;
-SET &CNT6 = 268;
-REPEAT ENDROLL2 &LINES TIMES
-READ ROLL22 NOCLOSE &ROLL.8. &CB.2. &RB.2. &TB.2. &CATG.15. &CL.8.
-SET &VAL=&FT.&CNT;
-SET &CNT = IF &ROLL EQ ' ' THEN &CNT 
- ELSE IF &VAL.LENGTH GT 150 THEN &CNT+1 ELSE &CNT;
-SET &FT.&CNT = IF &&SETF EQ 'TCBMNBV' THEN '' 
- ELSE IF &IN1 EQ 0 THEN &FT.&CNT 
- ELSE IF &VAL.LENGTH GT 150 THEN &ROLL
- ELSE IF &VAL.LENGTH LT 8 THEN &ROLL
- ELSE IF &ROLL EQ ' ' THEN &VAL
- ELSE &VAL || ' ' | &ROLL;

-IF &IN6 EQ 0 THEN GOTO CHKROLLCAT;
-SET &VAL = &FT.&CNT2;
-SET &CNT2 = IF &VAL.LENGTH GT 150 THEN &CNT2+1 ELSE &CNT2;
-SET &FT.&CNT2 = IF &IN6 EQ 0 THEN &FT.&CNT2 
- ELSE IF &VAL.LENGTH GT 150 THEN &CL
- ELSE IF &VAL.LENGTH LT 8 THEN &CL
- ELSE &VAL || ' ' | &CL;

-CHKROLLCAT
-IF &IN5 EQ 0 THEN GOTO CHKRCBRANCH;
-SET &VAL = &FT.&CNT3;
-SET &CNT3 = IF &CATG EQ ' ' THEN &CNT3 
- ELSE IF &VAL.LENGTH GT 150 THEN &CNT3+1 ELSE &CNT3;
-SET &FT.&CNT3 = IF &IN5 EQ 0 THEN &FT.&CNT3 
- ELSE IF &VAL.LENGTH GT 150 THEN &CATG
- ELSE IF &VAL.LENGTH LT 15 THEN &CATG
- ELSE IF &CATG EQ ' ' THEN &VAL
- ELSE &VAL || ' ' | &CATG;

-CHKRCBRANCH
-*client branch selections
-SET &VAL = &FT.&CNT4;
-SET &CNT4 = IF &VAL.LENGTH GT 150 THEN &CNT4+1 ELSE &CNT4;
-SET &FT.&CNT4 = IF &IN2 EQ 0 THEN &FT.&CNT4 
- ELSE IF &VAL.LENGTH GT 150 THEN &CB
- ELSE IF &VAL.LENGTH LT 2 THEN &CB
- ELSE IF &CB EQ ' ' THEN &VAL
- ELSE &VAL || ' ' | &CB;

-*Reservation branch selections
-SET &VAL = &FT.&CNT5;
-SET &CNT5 = IF &VAL.LENGTH GT 150 THEN &CNT5+1 ELSE &CNT5;
-SET &FT.&CNT5 = IF &IN3 EQ 0 THEN &FT.&CNT5 
- ELSE IF &VAL.LENGTH GT 150 THEN &RB
- ELSE IF &VAL.LENGTH LT 2 THEN &RB
- ELSE &VAL || ' ' | &RB;

-*Ticketing branch selections
-SET &VAL = &FT.&CNT6;
-SET &CNT6 = IF &VAL.LENGTH GT 150 THEN &CNT6+1 ELSE &CNT6;
-SET &FT.&CNT6 = IF &IN4 EQ 0 THEN &FT.&CNT6 
- ELSE IF &VAL.LENGTH GT 150 THEN &TB
- ELSE IF &VAL.LENGTH LT 2 THEN &TB
- ELSE &VAL || ' ' | &TB;

-ENDROLL2

-EndTotal
-**************************************************
-* the following portion of subfoot come from BRPTFLDS database
-* Date: 02/27/03 level descriptives from rollup file
-**************************************************
-*========================================================================
-* GET DESCRIPTIVE VALUES FROM ROLLUP
-*========================================================================
-*WHENCE BRPTINST FOCUS
-*-RUN
-*TABLE FILE BRPTINST
-*PRINT ROLLUP_CODE USE_PARM RPT_GROUP
-*WHERE INST_KEY EQ &&IKEY
-*ON TABLE SAVE AS RUCODE
-*END
-*-RUN

-SET &VIEW = &&VIEW;
-SET &RPTGRP = &&RPTGRP;
-SET &ROLLUP = &&ROLLUP;

-*-READ RUCODE &ROLLUP.A8. &VIEW.A8. &RPTGRP.A3.
-SET &VIEWTYPE = EDIT(&VIEW,'9');

-IF &&ROLLUP EQ 'TOTAL-R' THEN GOTO ChkViewType;

TABLE FILE ROLLUP
PRINT LEV1 LEV2 LEV3 TP_DESC
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
ON TABLE SAVE AS LEVINFO
END
-RUN

-READ LEVINFO &LEVEL1.A20. &LEVEL2.A20. &LEVEL3.A20. &TRIPDESC.A20.
-CLOSE LEVINFO

-SET &Temp1='''' || &LEVEL1 || '''';
-SET &LEN = 
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL1 = 
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL2 || '''';
-SET &LEN = 
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL2 = 
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &Temp1='''' || &LEVEL3 || '''';
-SET &LEN = 
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL3 = 
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &TRIPDESC = IF '&TRIPDESC.EVAL' NE ' '  THEN  &TRIPDESC
- ELSE 'Trip Purpose';

-*========================================================================
-* GET VALUES FROM COMMON1 SEGMENT - DATA FILE: BRPTFLDS.FOC
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.COMMON1.INCL1 
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS COMMON1
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkViewType;
-READ COMMON1 &COM1A.A1. &COM1B.A1. &COM1C.A1. &INCL4.1. &INCL5.1.
-CLOSE COMMON1

-*REGION,COUNTRY AND STATE
TABLE FILE BRPTFLDS
PRINT REGION_CODE COUNTRY_CODE STATE_CODE 
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
ON TABLE SAVE AS CNST
END
-RUN
-IF &LINES EQ 0 THEN GOTO ChkLevel1;
-SET &FT176 = '** Geo Region Selected: ';
-SET &FT177 = IF &INCL4 EQ 0 THEN '' ELSE IF &INCL4 EQ 1 THEN '** Countries Included: ' ELSE '** Countries Excluded: ';
-SET &FT178 = IF &INCL5 EQ 0 THEN '' ELSE IF &INCL5 EQ 1 THEN '** States Included: ' ELSE '** States Excluded: ';
-SET &CNT = 1;
-REPEAT ALLstates &LINES TIMES
-READ CNST NOCLOSE &RC.A3. &CC.A3. &SC.A2.
-SET &FT176 = IF &RC NE ' ' AND &CNT EQ 1 THEN '&FT176.EVAL' | '&RC.EVAL'
- ELSE IF &RC NE ' ' THEN '&FT176.EVAL' | ';' | '&RC.EVAL' ELSE &FT176;

-TYPE "PRIOR FT177"

-SET &FT177 = IF &INCL4 EQ 0 THEN ' ' 
- ELSE IF &CC NE ' ' AND &CNT EQ 1 THEN '&FT177.EVAL' | '&CC.EVAL'
- ELSE IF &CC NE ' ' THEN '&FT177.EVAL' | ';' | '&CC.EVAL' ELSE &FT177 ;

-TYPE "AFTER FT177"

-SET &FT178 = IF &INCL5 EQ 0 THEN ' ' 
- ELSE IF &SC NE ' '  AND &CNT EQ 1  THEN '&FT178.EVAL' | '&SC.EVAL'
- ELSE IF &SC NE ' ' THEN '&FT178.EVAL' | ';' | '&SC.EVAL' ELSE &FT178;
-SET &CNT = &CNT + 1;
-ALLstates
-CLOSE CNST

-************
-ChkLevel1
-************
-IF &COM1A EQ 0 THEN GOTO ChkLevel2;
-SET &FT100= IF &COM1A EQ 1 THEN 
- '**  &LEVEL1.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1A EQ 2 THEN 
- '**  &LEVEL1.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE  '**  &LEVEL1.EVAL Selection Criteria CONTAINS  ** ';

TABLE FILE BRPTFLDS
PRINT ID_LEVEL1 
WHERE INST_KEY EQ &&IKEY
WHERE COMMON2.ID_LEVEL1 NE ' '
BY INST_KEY NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-SET &CNT = 0;
-SET &IND = 1;
-REPEAT A100 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15. 
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A = 
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &FT10.&IND = IF &V1A EQ ' ' THEN &FT10.&IND
- ELSE IF &CNT = 1 THEN &V1A 
- ELSE &FT10.&IND || '; ' | &V1A;
-SET &FTLINE = &FT10.&IND;
-IF &FTLINE.LENGTH GT 90 
- THEN GOTO INCREMENT1 ELSE GOTO A100;
-INCREMENT1
-SET &IND = &IND + 1;
-*****
-A100
-*****
-CLOSE COMMON2

-************
-ChkLevel2
-************
-IF &COM1B EQ 0 THEN GOTO ChkLevel3;
-SET &FT103= IF &COM1B EQ 1 THEN 
- '**  &LEVEL2.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1B EQ 2 THEN 
- '**  &LEVEL2.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM1B EQ 3 THEN 
- '**  &LEVEL2.EVAL Selection Criteria CONTAINS  **';

TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL2
WHERE INST_KEY EQ &&IKEY
WHERE COMMON2.ID_LEVEL2 NE ' '
BY INST_KEY NOPRINT
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-SET &IND = 4;
-SET &CNT = 0;
-REPEAT A200 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15. 
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A = 
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &FT10.&IND = IF &V1A EQ ' ' THEN &FT10.&IND
- ELSE IF &CNT = 1 THEN &V1A 
- ELSE &FT10.&IND || '; ' | &V1A;
-SET &FTLINE = &FT10.&IND;
-IF &FTLINE.LENGTH GT 90 
- THEN GOTO INCREMENT2 ELSE GOTO A200;
-INCREMENT2
-SET &IND = &IND + 1;
-*****
-A200
-*****
-CLOSE COMMON2

-************
-ChkLevel3
-************
-IF &COM1C EQ 0 THEN GOTO ChkViewType;
-SET &FT106= IF &COM1C EQ 1 THEN 
- '**  &LEVEL3.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1C EQ 2 THEN 
- '**  &LEVEL3.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM1C EQ 3 THEN 
- '**  &LEVEL3.EVAL Selection Criteria CONTAINS  **';

TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL3
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL3 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-SET &CNT = 0;
-SET &IND = 7;
-REPEAT A300 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15. 
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A = 
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &FT10.&IND = IF &V1A EQ ' ' THEN &FT10.&IND
- ELSE IF &CNT = 1 THEN &V1A 
- ELSE &FT10.&IND || '; ' | &V1A;
-SET &FTLINE = &FT10.&IND;
-IF &FTLINE.LENGTH GT 90 
- THEN GOTO INCREMENT3 ELSE GOTO A300;

-INCREMENT3
-SET &IND = &IND + 1;
-*****
-A300
-*****
-CLOSE COMMON2

-*********************
-ChkViewType
-*********************
-IF &RPTGRP EQ 'CAR' OR 'CDD' OR &VIEWTYPE EQ 'C' THEN GOTO CarReport
-  ELSE IF &RPTGRP EQ 'HTL' OR 'HDD' OR &VIEWTYPE EQ 'H' THEN GOTO HtlReport
-    ELSE GOTO AirReport;

-**********
-AirReport
-**********
-*========================================================================
-* GET VALUES FROM AIR SEGMENT
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.AIR.ID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS AIR1
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-READ AIR1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &INCL4.1. &INCL5.1. ,
-   &INCL6.1. &INCL7.1. &INCL8.1. &INCL9.1. &INCL10.1. &INCL11.1. &INCL12.1. ,
-   &INTDOMT.1. &INTDOMS.1. &&RANK_LIMIT.5. &RankMeth.1. ,
-   &ClassA.1. &ClassF.1. &ClassB.1. &ClassC.1. &ClassD.1. ,
-   &TransS.1. &TransE.1. &TransR.1. &TransV.1. ,
-   &AdvA.1. &Adv0.1. &Adv7.1. &Adv14.1. &Adv21.1. &&RANK_LIMIT2.5. &CPfld.1.
-CLOSE AIR1

-SET &FT109 = IF &INTDOMT EQ 0 THEN ' '
- ELSE IF &VIEW EQ 'AVIW16' OR &VIEW EQ 'AVIW18' OR &VIEW EQ 'AVIW38' THEN ' '
- ELSE IF &INTDOMT EQ 1 THEN '** Intl/Dom/All Ticket Selection: ALL  **'
- ELSE IF &INTDOMT EQ 2 THEN '** Intl/Dom/All Ticket Selection: DOMESTIC  **'
- ELSE '** Intl/Dom/All Ticket selection: INTERNATIONAL  **';

-SET &FT110 = IF &INTDOMS EQ 0 THEN ' '
- ELSE IF &INTDOMS EQ 1 THEN '** Intl/Dom/All CityPair Selection: ALL  **'
- ELSE IF &INTDOMS EQ 2 THEN '** Intl/Dom/All CityPair Selection: DOMESTIC  **'
- ELSE '** Intl/Dom/All CityPair selection: INTERNATIONAL  **'

-SET &FT111=IF &ClassA EQ 0 AND &ClassF EQ 0 AND &ClassB EQ 0 AND &ClassC EQ 0
-   AND &ClassB EQ 0 THEN ' '
- ELSE '** Class Category Selection(s): ';
-SET &FT111 = IF &ClassF NE 0 THEN &FT111 | 'FIRST '    ELSE &FT111;
-SET &FT111 = IF &ClassB NE 0 
- THEN &FT111 | 'BUSINESS ' ELSE &FT111;
-SET &FT111 = IF &ClassC NE 0 
- THEN &FT111 | 'COACH '    ELSE &FT111;
-SET &FT111 = IF &ClassD NE 0 
- THEN &FT111 | 'DISCOUNTED COACH ' ELSE &FT111;
-SET &FT111 = IF &ClassA NE 0 
- THEN &FT111 | 'ALL **'   
-  ELSE IF &FT111 NE ' ' THEN &FT111 | '**' ELSE &FT111;

-SET &FT112=IF &TransS EQ 0 AND &TransE EQ 0 AND &TransR EQ 0 AND &TransV EQ 0
-   THEN ' '
- ELSE '** Transaction Type Selection(s): ';
-SET &FT112 = IF &TransS NE 0 THEN &FT112 | 'SALES '     ELSE &FT112;
-SET &FT112 = IF &TransE NE 0 THEN &FT112 | 'EXCHANGES ' ELSE &FT112;
-SET &FT112 = IF &TransR NE 0 
- THEN &FT112 | 'REFUNDS '   ELSE &FT112;
-SET &FT112 = IF &TransV NE 0 
- THEN &FT112 | 'VOIDS '     ELSE &FT112;
-SET &FT112 = IF &FT112 EQ ' ' THEN ' ' 
- ELSE &FT112 | '**';

-IF &AdvA EQ 0 AND &Adv0 EQ 0 AND &Adv7 EQ 0 AND &Adv14 EQ 0 AND
-   &Adv21 EQ 0 THEN GOTO chkAirPass;

-SET &FT113 = IF &AdvA EQ 0 AND &Adv0 EQ 0 AND &Adv7 EQ 0 AND &Adv14 EQ 0 AND
-   &Adv21 EQ 0 THEN ' '
- ELSE '** Advanced Purchase Selection(s): ';
-SET &FT113 = IF &Adv0  NE 0 THEN '&FT113.EVAL' | '0-6 Days '  
- ELSE '&FT113.EVAL';
-SET &FT113 = IF &Adv7  NE 0 THEN '&FT113.EVAL' | '7-13 Days '  
- ELSE '&FT113.EVAL';
-SET &FT113 = IF &Adv14 NE 0 THEN '&FT113.EVAL' | '14-20 Days ' 
- ELSE '&FT113.EVAL';
-SET &FT113 = IF &Adv21 NE 0 THEN '&FT113.EVAL' | '21+ Days '   
- ELSE '&FT113.EVAL';
-SET &FT113 = IF &AdvA  EQ 1 THEN '&FT113.EVAL' | 'ALL  **'    
- ELSE IF &FT113 NE ' ' THEN
- '&FT113.EVAL' | '**' ELSE &FT113;

-*========================================================================
-* GET VALUES FROM AIRFLDS SEGMENT
-*========================================================================
-chkAirPass
-IF &INCL1 EQ 0 THEN GOTO ChkTicket;
-SET &FT114= IF &INCL1 EQ 1 THEN 
- '**  Passenger Selection Criteria CONTAINS  **'
- ELSE '**  Passenger Selection Criteria OMITS  **'

-*Get Passengers
TABLE FILE BRPTFLDS
PRINT AIRFLDS.PASSENGER
BY AIRFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
WHERE AIRFLDS.PASSENGER NE ' ' 
ON TABLE SAVE AS CUSTFILE
END
-RUN

-SET &IND = 115;

-REPEAT A400 &LINES TIMES
-READ CUSTFILE NOCLOSE &V1.A33. 
-SET &V1B = '''' || &V1 || '''';
-SET &LEN = ARGLEN(35, &V1B, 'I2') - 1;
-SET &V1A = 
- SUBSTR(35, &V1B, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &FT.&IND = IF &V1A EQ ' ' THEN &FT.&IND
- ELSE IF &FT.&IND EQ '' THEN &V1A
- ELSE &FT.&IND || ';' | &V1A;

-SET &FTLINE = &FT.&IND;
-IF &FTLINE.LENGTH GT 80 THEN GOTO Increment40 ELSE GOTO A400;
-Increment40
-SET &IND = &IND + 1;
-*****
-A400
-*****
-CLOSE CUSTFILE

-**********
-ChkTicket
-**********
-IF &INCL2 EQ 0 THEN GOTO ChkAirCodes;
-SET &FT120= IF &INCL2 EQ 1 THEN 
- '**  Ticket Number Selection Criteria CONTAINS  **'
- ELSE '**  Ticket Number Selection Criteria OMITS  **';

-*Get Tickets
TABLE FILE BRPTFLDS
PRINT TICKET_NO
WHERE INST_KEY EQ &&IKEY
WHERE TICKET_NO NE ' ' 
ON TABLE SAVE AS TICKFILE
END
-RUN

-REPEAT A410 &LINES TIMES
-READ TICKFILE NOCLOSE &V1.A10. 
-SET &V1A = '''' || &V1 || '''';

-SET &FT121 = IF &V1A EQ ' ' THEN &FT121
- ELSE &FT121 || ' ' | &V1A;
-*****
-A410
-*****
-CLOSE TICKFILE

-********
-ChkAirCodes
-********
-SET &Temp1 = ' ';
-SET &Temp2 = ' ';
-SET &Temp3 = ' ';
-SET &Temp4 = ' ';
-SET &Temp5 = ' ';
-SET &Temp6 = ' ';
-SET &Temp7 = ' ';
-SET &Temp8 = ' ';
-SET &Temp9 = ' ';

-IF &INCL3 EQ 0 THEN GOTO A420;
-SET &FT124 = IF &INCL3 EQ 1 THEN '**  Depart Airport INCLUDED **'
- ELSE '**  Depart Airport EXCLUDED **';
-SET &Temp1 = IF &INCL3 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';

-A420
-IF &INCL4 EQ 0 THEN GOTO A430;
-SET &FT129 = 
- IF &VIEW EQ 'AVIW56' AND &INCL4 EQ 1 THEN '** Overnight City INCLUDED **'
- ELSE IF &VIEW EQ 'AVIW56' AND &INCL4 EQ 2 
- THEN '** Overnight City EXCLUDED **'
- ELSE IF &INCL4 EQ 1 THEN '**  Return Airport INCLUDED **'
- ELSE '**  Return Airport EXCLUDED **';
-SET &Temp2 = IF &VIEW EQ 'AVIW56' AND &INCL4 NE 0 
- THEN 'WHERE CITY_CODE EQ '
- ELSE IF &INCL4 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';

-A430
-IF &INCL5 EQ 0 THEN GOTO A440;
-SET &FT134 = IF &INCL5 EQ 1 THEN '**  Validating Airline INCLUDED **'
- ELSE '**  Validating Airline EXCLUDED **';
-SET &Temp3 = IF &INCL5 NE 0 THEN 'WHERE AIRLINE EQ ' ELSE ' ';

-A440
-IF &INCL6 EQ 0 THEN GOTO A450;
-SET &FT137 = IF &INCL6 EQ 1 THEN '**  Airline Flown INCLUDED **'
- ELSE '**  Airline Flown EXCLUDED **';
-SET &Temp4 = IF &INCL6 NE 0 THEN 'WHERE AIRLINE EQ ' ELSE ' ';

-A450
-IF &INCL7 EQ 0 THEN GOTO A460;
-SET &FT140 = IF &INCL7 EQ 1 THEN '**  Reason Code and Description INCLUDED **'
- ELSE '**  Reason Code and Description EXCLUDED **';
-SET &Temp5 = IF &INCL7 NE 0 THEN 'WHERE REFUSE_CODE EQ ' ELSE ' ';

-A460
-IF &INCL8 EQ 0 THEN GOTO A470;
-SET &FT146 = IF &INCL8 EQ 1 THEN '**  CityPair Airport Code INCLUDED **'
- ELSE '**  CityPair Airport Code EXCLUDED **';

-A470
-IF &INCL9 EQ 0 THEN GOTO A480;
-SET &FT151 = IF &INCL9 EQ 1 THEN '**  ' | &TRIPDESC | ' INCLUDED **'
- ELSE '**  ' | &TRIPDESC | ' EXCLUDED **';
-SET &Temp6 = IF &INCL9 NE 0 THEN 'WHERE TRP_KEY EQ ' ELSE ' ';

-A480
-IF &INCL10 EQ 0 THEN GOTO A490;
-SET &FT161 = IF &INCL10 EQ 1 THEN '**  No Hotel Reason Code INCLUDED **'
- ELSE '**  No Hotel Reason Code EXCLUDED **';
-SET &Temp7 = IF &INCL10 NE 0 THEN 'WHERE NHR_KEY EQ ' ELSE ' ';

-A490
-IF &INCL11 EQ 0 THEN GOTO A491;
-SET &Temp8 = IF &INCL11 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';

-A491
TABLE FILE BRPTFLDS
PRINT DPT_AIRPORT RTE_AIRPORT VAL_AIR FLOWN_AIR AIRFLDS.REFUSE_CODE
  CP_AIRPORT TRIP_CODE NHTL_CODE ORG_APC DST_APC
BY AIRFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS AIRCODES
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-SET &CNT = 1;
-REPEAT AirEnd3 &LINES TIMES
-READ AIRCODES NOCLOSE &V0A.A3. &V1A.A3. &V2A.A3. &V3A.A3. &V4A.A2. &V5A.A6. ,
-, &V6A.A2. &V7A.A2. &V8A.A3. &V9A.A3.

-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &V1= IF &V1A EQ ' ' THEN ' ' ELSE '''' | &V1A || '''';
-SET &V2= IF &V2A EQ ' ' THEN ' ' ELSE '''' | &V2A || '''';
-SET &V3= IF &V3A EQ ' ' THEN ' ' ELSE '''' | &V3A || '''';
-SET &V4= IF &V4A EQ ' ' THEN ' ' ELSE '''' | &V4A || '''';
-SET &V5= IF &V5A EQ ' ' THEN ' ' ELSE '''' | &V5A || '''';
-SET &V6= IF &V6A EQ ' ' THEN ' ' ELSE '''' | &V6A || '''';
-SET &V7= IF &V7A EQ ' ' THEN ' ' ELSE '''' | &V7A || '''';
-SET &V8= IF &V8A EQ ' ' THEN ' ' ELSE '''' | &V8A || '''';
-SET &V9= IF &V9A EQ ' ' THEN ' ' ELSE '''' | &V9A || '''';

-SET &Temp1 = IF &V0 EQ ' '  THEN &Temp1
- ELSE IF &CNT EQ 1 THEN &Temp1 | &V0
- ELSE &Temp1 | ' OR ' | &V0;

-SET &Temp2 = IF &V1 EQ ' '  THEN &Temp2
- ELSE IF &CNT EQ 1 THEN &Temp2 | &V1
- ELSE &Temp2 | ' OR ' | &V1;

-SET &Temp3 = IF &V2 EQ ' '  THEN &Temp3
- ELSE IF &CNT EQ 1 THEN &Temp3 | &V2
- ELSE &Temp3 | ' OR ' | &V2;

-SET &Temp4 = IF &V3 EQ ' '  THEN &Temp4
- ELSE IF &CNT EQ 1 THEN &Temp4 | &V3
- ELSE &Temp4 | ' OR ' | &V3;

-SET &Temp5 = IF &V4 EQ ' '  THEN &Temp5
- ELSE IF &CNT EQ 1 THEN &Temp5 | &V4
- ELSE &Temp5 | ' OR ' | &V4;

-SET &FT147 = IF &V5 EQ ' '  THEN &FT147
- ELSE &FT147 || ' ' | &V5;

-SET &Temp6 = IF &V6 EQ ' '  THEN &Temp6
- ELSE IF &CNT EQ 1 THEN &Temp6 | '''' | &&ROLLUP | &V6A | ''''
- ELSE &Temp6 | ' OR ' |  '''' | &&ROLLUP | &V6A | '''';

-SET &Temp7 = IF &V7 EQ ' '  THEN &Temp7
- ELSE IF &CNT EQ 1 THEN &Temp7 | '''' | &&ROLLUP | &V7A | ''''
- ELSE &Temp7 | ' OR ' | '''' | &&ROLLUP | &V7A | '''';

-SET &Temp8 = IF &V8 EQ ' '  THEN &Temp8
- ELSE IF &CNT EQ 1 THEN &Temp8 | &V8
- ELSE &Temp8 | ' OR ' | &V8;

-SET &Temp9 = IF &V9 EQ ' '  THEN &Temp9
- ELSE IF &CNT EQ 1 THEN &Temp9 | &V9
- ELSE &Temp9 | ' OR ' | &V9;

-SET &CNT = &CNT + 1;
-AirEnd3
-CLOSE AIRCODES
-RUN

-********************************************************************
-* Get Depart Airport Code + name
-********************************************************************
-IF &INCL3 EQ 0 THEN GOTO RTE_AIR;
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp1
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO RTE_AIR;

-SET &IND = 125;

-REPEAT AirEnd4 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd4;
-SET &IND = &IND + 1;
-AirEnd4
-CLOSE VCODE

-RTE_AIR
-********************************************************************
-* Get Return Airport Code + name
-********************************************************************
-IF &VIEW EQ 'AVIW56' THEN GOTO OVERNIGHT;
-IF &INCL4 EQ 0 THEN GOTO Validating;
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp2
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO Validating;

-SET &IND = 130;
-REPEAT AirEnd5 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd5;
-SET &IND = &IND + 1;
-AirEnd5

-CLOSE VCODE
-GOTO Validating

-OVERNIGHT
-IF &INCL4 EQ 0 THEN GOTO Validating;
DEFINE FILE CITY
  CNAME/A30 = CITY_CODE | '-' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
-*&Temp3
&Temp2
ON TABLE SAVE AS VCODE
END
-RUN

-SET &IND = 130;
-REPEAT AirEnd5A &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';


-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 80 THEN GOTO AirEnd5A;
-SET &IND = &IND + 1;

-AirEnd5A
-CLOSE VCODE

-Validating
-********************************************************************
-* Get Validating Airline Code + name
-********************************************************************
-IF &INCL5 EQ 0 THEN GOTO FlownAir;
DEFINE FILE AIRLINE
  DESC/A16 = AIRLINE | '-' | AIRLINE_NAME;
END
TABLE FILE AIRLINE
PRINT DESC
BY AIRLINE NOPRINT
&Temp3
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO FlownAir;

-SET &IND = 135;
-REPEAT AirEnd6 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A16. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd6;
-SET &IND = &IND + 1;
-AirEnd6

-CLOSE VCODE

-FlownAir
-********************************************************************
-* Get Flown Airline Code + name
-********************************************************************
-IF &INCL6 EQ 0 THEN GOTO Air_ref;
DEFINE FILE AIRLINE
  DESC/A16 = AIRLINE | '-' | AIRLINE_NAME;
END
TABLE FILE AIRLINE
PRINT DESC
BY AIRLINE NOPRINT
&Temp4
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO Air_ref;

-SET &IND = 138;

-REPEAT AirEnd7 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A16. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd7;
-SET &IND = &IND + 1;
-AirEnd7

-CLOSE VCODE
-**************************************************************************
-* Get Air Refuse Code + Description 
-* Check Reason table to see if the client uses the standard code or not
-**************************************************************************
-Air_ref
-IF &INCL7 EQ 0 THEN GOTO TripCode;
TABLE FILE AIR_REF
PRINT *
IF REFUSE_KEY CONTAINS '&ROLLUP.EVAL'
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-SET &STANDARD = IF &LINES EQ 0 THEN 'Y' ELSE 'N';

DEFINE FILE AIR_REF
  REFUSE_CODE/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
  ROLLUP_CODE/A8 = EDIT(REFUSE_KEY, '99999999$$');
  DESC/A45 = REFUSE_CODE | ' - ' | REFUSAL_DESC;
  
END
TABLE FILE AIR_REF
PRINT DESC
BY REFUSE_KEY NOPRINT
&Temp5
-IF &STANDARD EQ 'Y' THEN GOTO AirStandand;
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
-GOTO DONEair
-AirStandand
WHERE ROLLUP_CODE EQ ' '
-DONEair
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO TripCode;

-SET &IND = 141;
-SET &CNT = 1;

-REPEAT AirEnd8 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A45. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE IF (&CNT/2 - &CNT/2*2) EQ 0 THEN &V1 ELSE &FT.&IND || ' ' | &V1;
-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 80 THEN GOTO IncACnt8;
-SET &IND = &IND + 1;

-IncACnt8
-SET &CNT = &CNT + 1;
-AirEnd8
-CLOSE VCODE


-**** 08/24/2004 ****************************************************
-TripCode
-********************************************************************
-* Get Trip Purpose Code + Description
-********************************************************************
-IF &INCL9 EQ 0 THEN GOTO NohtlCode;
DEFINE FILE TRP_REF
  TRP_CODE/A2 = EDIT(TRP_KEY,'$$$$$$$$99'); 
  DESC/A43 = TRP_CODE | '-' | TRP_DESC;
END
TABLE FILE TRP_REF
PRINT DESC
BY TRP_KEY NOPRINT
&Temp6
ON TABLE SAVE AS VCODE
END
-RUN
-IF &LINES EQ 0 THEN GOTO NohtlCode;

-SET &IND = 152;
-REPEAT AirEnd9 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A43. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd9;
-SET &IND = &IND + 1;
-AirEnd9
-CLOSE VCODE

-NohtlCode
-********************************************************************
-* Get No Hotel Reason Code + Description
-********************************************************************
-IF &INCL10 EQ 0 THEN GOTO ORGAPC;
DEFINE FILE NHR_REF
  NHT_CODE/A2 = EDIT(NHR_KEY,'$$$$$$$$99');
  DESC/A43 = NHT_CODE | '-' | NHR_DESC;
END
TABLE FILE NHR_REF
PRINT DESC
BY NHR_KEY NOPRINT
&Temp7
ON TABLE SAVE AS VCODE
END
-RUN
-IF &LINES EQ 0 THEN GOTO ORGAPC;

-SET &IND = 162;
-REPEAT AirEnd10 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A43. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd10;
-SET &IND = &IND + 1;
-AirEnd10

-CLOSE VCODE

-********************************************************************
-*11/03/2006 origin airport
-* Get Origin Airport Code + name
-********************************************************************
-ORGAPC
-IF &INCL11 EQ 0 THEN GOTO WriteFooter;
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp8
ON TABLE SAVE AS VCODE11
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-SET &FT171=IF &INCL11 EQ 1 THEN '** Origin Airport Included **' ELSE '** Origin Airport Excluded **';
-SET &IND = 172;

-REPEAT AirEnd11 &LINES TIMES
-READ VCODE11 NOCLOSE &V0A.A30. 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO AirEnd11;
-SET &IND = &IND + 1;
-AirEnd11
-CLOSE VCODE11


-GOTO WriteFooter
-**********
-CarReport
-**********
-*========================================================================
-* GET VALUES FROM CAR SEGMENT
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.CAR.ID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS CAR1
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-READ CAR1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &INCL4.1. &INCL5.1. &INCL6.1. ,
-     &&RANK_LIMIT.5. &RankMeth.1. &RateAll.1. &Rate1.1. &Rate2.1. ,
-     &Rate3.1. &Rate4.1. &Rate5.1.  &Rate6.1. 
-CLOSE CAR1

-SET &FT109 = IF &RateAll EQ 0 AND &Rate1 EQ 0 AND &Rate2 EQ 0 AND &Rate2 EQ 0 
- AND &Rate4 EQ 0 AND &Rate5 EQ 0  AND &Rate6 EQ 0  THEN ' '
- ELSE '** Car Rental Rate Selection(s) ** ';
-SET &FT110 = IF &Rate1 NE 0 THEN &FT110 | '$00.00-19.99 ' 
- ELSE &FT110;
-SET &FT110 = IF &Rate2 NE 0 THEN &FT110 | '$20.00-34.99 ' 
- ELSE &FT110;
-SET &FT110 = IF &Rate3 NE 0 THEN &FT110 | '$35.00-49.99 ' 
- ELSE &FT110;
-SET &FT110 = IF &Rate4 NE 0 THEN 
- &FT110 | '$50.00-64.99 ' 
- ELSE &FT110;
-SET &FT110 = IF &Rate5 NE 0 THEN
- &FT110 | '$65.00-79.99 ' 
- ELSE &FT110;
-SET &FT110 = IF &Rate6 NE 0 THEN &FT110 | '$80.00+ '      
- ELSE &FT110;
-SET &FT110 = IF &RateAll NE 0 THEN 'ALL ' 
- ELSE &FT110;

-*========================================================================
-* GET VALUES FROM CARFLDS SEGMENT
-*========================================================================
-*Get Passengers
-IF &INCL1 EQ 0  THEN GOTO ChkCarCodes;
-SET &FT114= IF &INCL1 EQ 1 THEN 
- '**  Passenger Selection Criteria CONTAINS  **'
- ELSE '**  Passenger Selection Criteria OMITS  **';
TABLE FILE BRPTFLDS
PRINT CARFLDS.PASSENGER
WHERE INST_KEY EQ &&IKEY
WHERE CARFLDS.PASSENGER NE ' ' 
ON TABLE SAVE AS CUSTFILE
END
-RUN

-SET &IND = 115;
-REPEAT A500 &LINES TIMES
-READ CUSTFILE NOCLOSE &V1.A33. 

-SET &V1B = '''' || &V1 || '''';
-SET &LEN = ARGLEN(35, &V1B, 'I2') - 1;
-SET &V1A = 
- SUBSTR(35, &V1B, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &FT.&IND = IF &V1A EQ ' ' THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V1A;

-SET &FTLINE = &FT.&IND;
-IF &FTLINE.LENGTH GT 80 THEN GOTO INCREMENT50 ELSE GOTO A500;
-INCREMENT50
-SET &IND = &IND + 1;
-*****
-A500
-*****
-CLOSE CUSTFILE

-****************
-ChkCarCodes
-****************
-SET &Temp1 = ' ';
-IF &INCL2 EQ 0 THEN GOTO A520;
-SET &FT120 = IF &INCL2 EQ 1 THEN '**  Vendor Code and Name INCLUDED **'
- ELSE '**  Vendor Code and Name EXCLUDED **';
-SET &Temp1 = IF &INCL2 NE 0 THEN 'WHERE VENDOR_CODE EQ ' ELSE ' ';

-A520
-SET &Temp2 = ' ';
-IF &INCL3 EQ 0 THEN GOTO A530;
-SET &FT124 = IF &INCL3 EQ 1 THEN '**  Reason Code and Description INCLUDED **'
- ELSE '**  Reason Code and Description EXCLUDED **';
-SET &Temp2 = IF &INCL3 NE 0 THEN 'WHERE REFUSE_CODE EQ ' ELSE ' ';

-A530
-SET &Temp3 = ' ';
-IF &INCL4 EQ 0 THEN GOTO A540;
-SET &FT130 = IF &INCL4 EQ 1 THEN '**  PickUp City Code and Name INCLUDED **'
- ELSE '**  PickUp City Code and Name EXCLUDED **';
-SET &Temp3 = IF &INCL4 NE 0 THEN 'WHERE CITY_CODE EQ ' ELSE ' ';

-A540
-SET &Temp4 = ' ';
-IF &INCL5 EQ 0 THEN GOTO A550;
-SET &FT135 = IF &INCL5 EQ 1 THEN '**  Drop off City Code and Name INCLUDED **'
- ELSE '**  Drop off City Code and Name EXCLUDED **';
-SET &Temp4 = IF &INCL5 NE 0 THEN 'WHERE CITY_CODE EQ ' ELSE ' ';

-A550  
-SET &Temp5 = ' ';
-IF &INCL6 EQ 0 THEN GOTO A560;  
-SET &FT140 = IF &INCL6 EQ 1 
-   THEN '**  Car Type Code and Description INCLUDED **'
- ELSE '**  Car Type Code and Description EXCLUDED **';
-SET &Temp5 = IF &INCL6 NE 0 THEN 'WHERE CAR_TYPE EQ ' ELSE ' ';

-A560
TABLE FILE BRPTFLDS
PRINT VENDOR_CODE CARFLDS.REFUSE_CODE PICKUP_CITY DROPOFF_CITY CAR_TYPE
BY CARFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS CarCODES
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-SET &CNT = 1;
-REPEAT CarEnd3 &LINES TIMES
-READ CarCODES NOCLOSE &V0A.A2. &V1A.A2. &V2A.A3. &V3A.A3. &V4A.A7. 

-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &V1= IF &V1A EQ ' ' THEN ' ' ELSE '''' | &V1A || '''';
-SET &V2= IF &V2A EQ ' ' THEN ' ' ELSE '''' | &V2A || '''';
-SET &V3= IF &V3A EQ ' ' THEN ' ' ELSE '''' | &V3A || '''';
-SET &V4= IF &V4A EQ ' ' THEN ' ' ELSE '''' | &V4A || '''';

-SET &Temp1 = IF &V0 EQ ' '  THEN &Temp1
- ELSE IF &CNT EQ 1 THEN &Temp1 | &V0
- ELSE &Temp1 | ' OR ' | &V0;

-SET &Temp2 = IF &V1 EQ ' '  THEN &Temp2
- ELSE IF &CNT EQ 1 THEN &Temp2 | &V1 
- ELSE &Temp2 | ' OR ' | &V1;

-SET &Temp3 = IF &V2 EQ ' '  THEN &Temp3
- ELSE IF &CNT EQ 1 THEN &Temp3 | &V2
- ELSE &Temp3 | ' OR ' | &V2;

-SET &Temp4 = IF &V3 EQ ' '  THEN &Temp4
- ELSE IF &CNT EQ 1 THEN &Temp4 | &V3
- ELSE &Temp4 | ' OR ' | &V3;

-SET &Temp5 = IF &V4 EQ ' '  THEN &Temp5
- ELSE IF &CNT EQ 1 THEN &Temp5 | &V4
- ELSE &Temp5 | ' OR ' | &V4;

-SET &CNT = &CNT + 1;
-CarEnd3
-CLOSE CarCODES

-********************************************************************
-* Get Car Vendor Code + Description 
-********************************************************************
-IF &INCL2 EQ 0 THEN GOTO CAR_REF;
DEFINE FILE CAR_VEND
  DESC/A15 = VENDOR_CODE | '-' | VENDOR_NAME;
END
TABLE FILE CAR_VEND
PRINT DESC
BY VENDOR_CODE NOPRINT
&Temp1
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO CAR_REF;

-SET &IND = 121;

-REPEAT CarEnd4 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A15. 

-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 75 THEN GOTO CarEnd4;
-SET &IND = &IND + 1;
-CarEnd4
-CLOSE VCODE
-**************************************************************************
-* Get Car Refuse Code + Description 
-* Check Reason table to see if the client uses the standard code or not
-**************************************************************************
-CAR_REF
-IF &INCL3 EQ 0 THEN GOTO PickUpCity;
TABLE FILE CAR_REF
PRINT *
IF REFUSE_KEY CONTAINS '&ROLLUP.EVAL'
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-SET &STANDARD = IF &LINES EQ 0 THEN 'Y' ELSE 'N';

DEFINE FILE CAR_REF
  REFUSE_CODE/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
  ROLLUP_CODE/A8 = EDIT(REFUSE_KEY, '99999999$$');
  DESC/A45 = REFUSE_CODE | ' - ' | REFUSAL_DESC;
  
END
TABLE FILE CAR_REF
PRINT DESC
BY REFUSE_KEY NOPRINT
&Temp2
-IF &STANDARD EQ 'Y' THEN GOTO CarStandand;
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
-GOTO DONEROLL
-CarStandand
WHERE ROLLUP_CODE EQ ' '
-DONEROLL
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO PickUpCity;

-SET &IND = 125;
-SET &CNT = 1;

-REPEAT CarEnd5 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A45. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';

-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE IF (&CNT/2 - &CNT/2*2) EQ 0 THEN &V1 ELSE &FT.&IND || ' ' | &V1;
-*- ELSE IF IMOD(&CNT/2)      EQ 0 THEN &V1 ELSE &FT.&IND || ' ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 75 THEN GOTO IncCCnt5;
-SET &IND = &IND + 1;

-IncCCnt5
-SET &CNT = &CNT + 1;
-CarEnd5
-CLOSE VCODE

-PickUpCity
-IF &INCL4 EQ 0 THEN GOTO DropOffCity; 
DEFINE FILE CITY
  CNAME/A30 = CITY_CODE | '-' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
&Temp3
ON TABLE SAVE AS VCODE
END
-RUN

-SET &IND = 131;

-REPEAT CarEnd6 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';

-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 80 THEN GOTO CarEnd6;
-SET &IND = &IND + 1;

-CarEnd6
-CLOSE VCODE

-DropOffCity
-IF &INCL5 EQ 0 THEN GOTO CarType; 
DEFINE FILE CITY
  CNAME/A30 = CITY_CODE | '-' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
&Temp4
ON TABLE SAVE AS VCODE
END
-RUN

-SET &IND = 136;

-REPEAT CarEnd7 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';

-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 80 THEN GOTO CarEnd7;
-SET &IND = &IND + 1;
-CarEnd7
-CLOSE VCODE

-CarType
-IF &INCL6 EQ 0 THEN GOTO WriteFooter; 
DEFINE FILE CAR_TYPE
  CAR_INFO/A40 = CAR_TYPE | ' - ' | CAR_DESC;
END
TABLE FILE CAR_TYPE
PRINT CAR_INFO
BY CAR_TYPE NOPRINT
&Temp5
ON TABLE SAVE AS VCODE
END
-RUN

-SET &IND = 141;
-REPEAT CarEnd8 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A40. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';

-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND | '  ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 80 THEN GOTO CarEnd8;
-SET &IND = &IND + 1;
-CarEnd8
-CLOSE VCODE

-GOTO WriteFooter
-**********
-HtlReport
-**********
-*========================================================================
-* GET VALUES FROM HTL SEGMENT
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.HTL.ID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS HTL1
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-READ HTL1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &INCL4.1. ,
-     &&RANK_LIMIT.5. &RankMeth.1. &&RANK_LIMIT2.5.
-CLOSE HTL1

-*========================================================================
-* GET VALUES FROM HTLFLDS SEGMENT
-*========================================================================
-*Get Passengers
-IF &INCL1 EQ 0  THEN GOTO ChkHtlCodes;
-SET &FT114= IF &INCL1 EQ 1 THEN 
- '**  Passenger Selection Criteria CONTAINS  **'
- ELSE '**  Passenger Selection Criteria OMITS  **';
TABLE FILE BRPTFLDS
PRINT HTLFLDS.PASSENGER
WHERE INST_KEY EQ &&IKEY
WHERE HTLFLDS.PASSENGER NE ' ' 
ON TABLE SAVE AS CUSTFILE
END
-RUN

-SET &IND = 115;
-REPEAT A600 &LINES TIMES
-READ CUSTFILE NOCLOSE &V1.A33. 
-SET &V1B = '''' || &V1 || '''';
-SET &LEN = ARGLEN(35, &V1B, 'I2') - 1;
-SET &V1A = 
- SUBSTR(35, &V1B, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &FT.&IND = IF &V1A EQ ' ' THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V1A;

-SET &FTLINE = &FT.&IND;
-IF &FTLINE.LENGTH GT 80 THEN GOTO Increment60 ELSE GOTO A600;

-Increment60
-SET &IND = &IND + 1;
-*****
-A600
-*****
-CLOSE CUSTFILE

-************
-ChkHtlCodes
-************
-SET &Temp1 = ' ';
-IF &INCL2 EQ 0 THEN GOTO A620;
-SET &FT122 = IF &INCL2 EQ 1 THEN '**  Hotel Chain Code and Name INCLUDED **'
- ELSE '**  Hotel Chain Code and Name EXCLUDED **';
-SET &Temp1 = IF &INCL2 NE 0 THEN 'WHERE CHAIN_CODE EQ ' ELSE ' ';

-A620
-SET &Temp2 = ' ';
-IF &INCL3 EQ 0 THEN GOTO A630;
-SET &FT128 = IF &INCL3 EQ 1 THEN '**  Hotel City Code and Name INCLUDED **'
- ELSE '**  Hotel City Code and Name EXCLUDED **';
-SET &Temp2 = IF &INCL3 NE 0 THEN 'WHERE CITY_CODE EQ ' ELSE ' ';

-A630
-SET &Temp3 = ' ';
-IF &INCL4 EQ 0 THEN GOTO A640;
-SET &FT134 = IF &INCL4 EQ 1 THEN '**  Reason Code and Description INCLUDED **'
- ELSE '**  Reason Code and Description EXCLUDED **';
-SET &Temp3 = IF &INCL4 NE 0 THEN 'WHERE REFUSE_CODE EQ ' ELSE ' ';

-A640
TABLE FILE BRPTFLDS
PRINT CHAIN_CODE HTL_CITY HTLFLDS.REFUSE_CODE
BY HTLFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS HtlCODES
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-SET &CNT = 1;
-REPEAT HtlEnd3 &LINES TIMES
-READ HtlCODES NOCLOSE &V0A.A2. &V1A.A3. &V2A.A2. 

-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &V1= IF &V1A EQ ' ' THEN ' ' ELSE '''' | &V1A || '''';
-SET &V2= IF &V2A EQ ' ' THEN ' ' ELSE '''' | &V2A || '''';

-SET &Temp1 = IF &V0 EQ ' '  THEN &Temp1
- ELSE IF &CNT EQ 1 THEN &Temp1 | &V0
- ELSE &Temp1 | ' OR ' | &V0;

-SET &Temp2 = IF &V1 EQ ' '  THEN &Temp2
- ELSE IF &CNT EQ 1 THEN &Temp2 | &V1 
- ELSE &Temp2 | ' OR ' | &V1;

-SET &Temp3 = IF &V2 EQ ' '  THEN &Temp3
- ELSE IF &CNT EQ 1 THEN &Temp3 | &V2
- ELSE &Temp3 | ' OR ' | &V2;

-SET &CNT = &CNT + 1;
-HtlEnd3
-CLOSE HtlCODES

-********************************************************************
-* Get HTL CHAIN Code + name 
-********************************************************************
-IF &INCL2 EQ 0 THEN GOTO HTL_CITY;
DEFINE FILE HOTL_CHN
  DESC/A35 = CHAIN_CODE | ' - ' | CHAIN_NAME;
END
TABLE FILE HOTL_CHN
PRINT DESC
BY CHAIN_CODE NOPRINT
&Temp1
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO HTL_CITY;

-SET &IND = 123;

-REPEAT HtlEnd4 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A35. 

-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&IND = IF &V0 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V0;
-SET &PRINTLINE = &FT.&IND;
-IF &PRINTLINE.LENGTH LT 80 THEN GOTO HtlEnd4;
-SET &IND = &IND + 1;
-HtlEnd4
-CLOSE VCODE

-HTL_CITY
-********************************************************************
-* Get HTL City Code + name 
-********************************************************************
-IF &INCL3 EQ 0 THEN GOTO HTL_REF;
DEFINE FILE CITY
  CNAME/A32 = CITY_CODE | ' - ' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
&Temp2
ON TABLE SAVE AS VCODE
END
-RUN

-SET &IND = 129;

-REPEAT HtlEnd5 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A32. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';

-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE &FT.&IND || ' ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 80 THEN GOTO HtlEnd5;
-SET &IND = &IND + 1;

-HtlEnd5
-CLOSE VCODE

-HTL_REF
-**************************************************************************
-* Get HTL_REF Code + Description 
-* Check Reason table to see if the client uses the standard code or not
-**************************************************************************
-IF &INCL4 EQ 0 THEN GOTO WriteFooter;
TABLE FILE HTL_REF
PRINT *
IF REFUSE_KEY CONTAINS '&ROLLUP.EVAL'
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-SET &STANDARD = IF &LINES EQ 0 THEN 'Y' ELSE 'N';

DEFINE FILE HTL_REF
  REFUSE_CODE/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
  ROLLUP_CODE/A8 = EDIT(REFUSE_KEY, '99999999$$');
  DESC/A45 = REFUSE_CODE | ' - ' | REFUSAL_DESC;
  
END
TABLE FILE HTL_REF
PRINT DESC
BY REFUSE_KEY NOPRINT
&Temp3
-IF &STANDARD EQ 'Y' THEN GOTO HtlStandand;
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
-GOTO DONEHtl
-HtlStandand
WHERE ROLLUP_CODE EQ ' '
-DONEHtl
ON TABLE SAVE AS VCODE
END
-RUN

-IF &LINES EQ 0 THEN GOTO WriteFooter;

-SET &IND = 135;
-SET &CNT = 1;

-REPEAT HtlEnd6 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A45. 

-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';

-SET &FT.&IND = IF &V1 EQ ' '  THEN &FT.&IND
- ELSE IF (&CNT/2 - &CNT/2*2) EQ 0 THEN &V1 ELSE &FT.&IND || ' ' | &V1;
-*- ELSE IF IMOD(&CNT/2)      EQ 0 THEN &V1 ELSE &FT.&IND || ' ' | &V1;

-SET &LINE = &FT.&IND;
-IF &LINE.LENGTH LT 75 THEN GOTO IncHCnt6;
-SET &IND = &IND + 1;

-IncHCnt6
-SET &CNT = &CNT + 1;
-HtlEnd6
-CLOSE VCODE

-**********************************************************************
-WriteFooter
-**********************************************************************
-WRITE SBFOOT "</3"
-WRITE SBFOOT "** THIS REPORT IS BASED ON THE FOLLOWING SELECTION CRITERIA **"
-WRITE SBFOOT "================================================================"

-*Write Hierarchy, client and category selections to the footer
-WRITE SBFOOT "&FT200"
-SET &FOOTLINES=&FOOTLINES - 11;
-SET &CNT = 201;
-REPEAT TOFOOT1 98 TIMES
-IF &FT.&CNT EQ ' ' GOTO AddOne;
-SET &LINE = &FT.&CNT;
-SET &FIRSTTWO = SUBSTR(&LINE.LENGTH, &LINE, 1, 2, 2, 'A2');
-IF &FIRSTTWO NE '**' THEN GOTO WRLINE1;
-WRITE SBFOOT " "
-WRLINE1
-WRITE SBFOOT "&LINE"
-SET &FOOTLINES=&FOOTLINES - 1;
-AddOne
-SET &CNT = &CNT + 1;
-TOFOOT1
-ENDREPEAT1

-*The followings are from rpt_flds 
-SET &CNT = 100;
-REPEAT ContWrite 81 TIMES
-SET &LINE = &FT.&CNT;
-IF &FT.&CNT EQ  ' ' 
- THEN GOTO IncCount;
-SET &FIRSTTWO = SUBSTR(&LINE.LENGTH, &LINE, 1, 2, 2, 'A2');
-IF &FIRSTTWO EQ '**' THEN GOTO SkipALine;
-WRITE SBFOOT " &LINE"
-SET &FOOTLINES=&FOOTLINES-1;
-GOTO IncCount
-SkipALine

-WRITE SBFOOT " "
-WRITE SBFOOT "&LINE"
-*-WRITE SBFOOT " -----------------------------------------------------------"
-SET &FOOTLINES=&FOOTLINES-3;
-IncCount
-SET &CNT = &CNT + 1;
-ContWrite 

-IF &&ROLLUP EQ 'TOTAL-R' THEN GOTO SkipWUDID;
-IF &&UDIDUSED NE 'Y' THEN GOTO SkipWUDID;
-******************************************************************************
-* THE START OF UDID
-******************************************************************************
-WRITE SBFOOT " "
-SET &FOOTLINES=&FOOTLINES-1;
-SET &CNT = &STARTCNT;
-REPEAT UDIDWrite 99 TIMES
-SET &LINE = &FT.&CNT;
-IF &FT.&CNT EQ  ' ' 
- THEN GOTO IncUDIDCount;  
-WRITE SBFOOT " &LINE"
-SET &FOOTLINES=&FOOTLINES-1;
-IncUDIDCount
-SET &CNT = &CNT + 1;
-UDIDWrite 
-******************************************************************************
-* THE END OF UDID
-******************************************************************************
-SkipWUDID

-SET &FOOTLINES=&FOOTLINES+4;
-SET &FOOTLINES = IF &FOOTLINES LT 0 THEN 0 ELSE &FOOTLINES;
-WRITE SBFOOT "</&FOOTLINES.EVAL"
-SET &SPOTNUM=IF &&USEPARM.EVAL EQ 'AVIW23' OR 'AVI124' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'AVIEW3' OR 'UAVIW3' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'AVIW74' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'AVIW90' THEN 52 ELSE
- IF &&STREAM EQ 'TC_TRAN2' THEN 52 ELSE 
- IF &&STREAM EQ 'TC_TRAN1' THEN 52 ELSE 
- IF &&STREAM EQ 'HTL_PREF' THEN 52 ELSE 
- IF &&STREAM EQ 'SUMHIER' THEN 52 ELSE 64;
-WRITE SBFOOT "eTTek Review &DATE AT <NOWTOD <&SPOTNUM.EVAL &&FOOTR"
-WRITE SBFOOT "&&CRIGHT.EVAL"
-CLOSE SBFOOT