-*02/15/16 - DLV - S-13286  Updated to allow reports to sort/subtotal by id-levels

-INCLUDE SETECHO

FILEDEF RPTPARMS CLEAR
-RUN

EX HTLUSE
-RUN

-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN

DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
LOG DUPL MSG OFF
FIXFORM INST_KEY/7 RPT_GROUP/3
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN

MODIFY FILE BRPTFLDS
LOG DUPL MSG OFF
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1 
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH00
END
-RUN

EX CODEGEN
-RUN

-SET &&IDLEVELBREAK = '';
-RUN

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN

DEFINE FILE &&EXTRACT
HBOOK/P8CS = IF TOTAL_AMT GE 0 THEN 1 ELSE (-1);
LEVEL_DESC1/A60      = &&LDESC;
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/P12CS = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
HTL_DT/MDYY         = CHKIN_DATE;
HTL_AMT/D12.2CS = TOTAL_AMT;

TRN_DATE/YYMD = INVOICE_DATE;
HC_ITIN/A67 = CITY.CITY_NAME;
-INCLUDE IDLEVDEFINE  
END                
TABLE FILE &&EXTRACT
PRINT HBOOK NNROOMS LEVEL_DESC HC_ITIN HTL_DT HTL_AMT PROP_NAME HTL_DT XPSNGR_NM TRN_DATE TKT_NUM INVOICE_NUM PNR_LOCATOR LEVEL4
BY HTL_KEY 
-INCLUDE &HTLDATES
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHLDH 
END
-RUN

TABLE FILE RPTHLDH
SUM HBOOK NNROOMS HTL_AMT 
BY LEVEL_DESC
BY LEVEL4
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS HTLHLD
END
-RUN





