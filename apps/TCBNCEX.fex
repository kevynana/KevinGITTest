-***************************************************************************
-* REPORT NAME: BENCHMARKING ANALYSIS (CAR EXTRACT)
-* TOTAL COMPANY REPORTING
-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK

-***************************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON

DEFINE FILE CR_50

BOOKINGS/D8 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
  NBR_DAYS/P12S = NUM_DAYS;
  RENTAL_DAYS/P12S = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
  INT_DOM/A1 =IF (PICK_CTY.INTL_DOM EQ 'I') THEN 'I' ELSE 'D';
-* ****DEFINES ON PREVIOUS DEFINES****
  MIDBOOK/P12S = IF (DAILY_RATE GE 0) AND 
                  (CAR_CAT EQ 'INTERMEDIATE' OR 'ECONOMY' OR 'COMPACT') THEN 1 
                  ELSE IF (DAILY_RATE LT 0) AND 
                  (CAR_CAT EQ 'INTERMEDIATE' OR 'ECONOMY' OR 
                  'COMPACT') THEN (-1) ELSE 0;
  MIDAMT/D9.2S   =  IF (CAR_CAT EQ 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                  OR 'COMPACT') THEN RENTAL_AMT ELSE 0;
  MID_DAYS/P12S  = IF (CAR_CAT EQ 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                  OR 'COMPACT') THEN RENTAL_DAYS ELSE 0;
  NOMID_DAYS/P12S = IF (CAR_CAT NE 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY' 
                   OR 'COMPACT') THEN RENTAL_DAYS ELSE 0;
    
END
-RUN

TABLEF FILE CR_50
PRINT BOOKINGS
  CAR_CAT	
  CAR_DESC
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE 	
  DAILY_RATE
  INVOICE_DATE
  INT_DOM 	
  MIDBOOK
  MIDAMT
  MID_DAYS
  NOMID_DAYS
  NBR_DAYS 
  RENTAL_AMT
  RENTAL_DAYS
WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL) OR
      (INVOICE_DATE GE &&FXDATE.EVAL AND INVOICE_DATE LE &&TXDATE.EVAL)
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
-* &&WHERE1
-* &&WHERE2
-* &&WHERE3
-* &&WHERE4
-* &&WHERE5
-* &&WHERE6
&&WHERE7
&&WHERE8
-* &&WHERE9
-* &&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TC_CBNM
END
-RUN


-IF &LINES EQ 0 THEN GOTO NEXTONE;

DEFINE FILE TC_CBNM
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TC_CBNM
-*PRINT
SUM
BOOKINGS
  CAR_CAT	
  CAR_DESC
  CAR_RATE 	
  CAR_TYPE 	
  DAILY_RATE 
  INVOICE_DATE
  INT_DOM 	
  MIDBOOK
  MIDAMT
  MID_DAYS
  NOMID_DAYS
  NBR_DAYS 
  RENTAL_AMT 
  RENTAL_DAYS
BY ROLLCD
BY CAR_KEY
ON TABLE HOLD AS CARHOLD1 
END
-RUN



TABLE FILE CARHOLD1
PRINT BOOKINGS
  CAR_CAT	
  CAR_DESC
  CAR_RATE 	
  CAR_TYPE 	
  DAILY_RATE 
  INVOICE_DATE
  INT_DOM 	
  MIDBOOK
  MIDAMT
  MID_DAYS
  NOMID_DAYS
  NBR_DAYS 
  RENTAL_AMT 
  RENTAL_DAYS
BY ROLLCD
ON TABLE HOLD AS TCC1
END
-RUN

DEFINE FILE TCC1
CURRENT/A1 = IF INVOICE_DATE GE &&FROMDT.EVAL AND
                INVOICE_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PRIOR/A1 =  IF INVOICE_DATE GE &&FXDATE.EVAL AND
               INVOICE_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
END

TABLE FILE TCC1
PRINT 
  BOOKINGS
  CAR_DESC	
  CAR_RATE 	
  CAR_TYPE 
  CURRENT	
  DAILY_RATE
  MIDAMT
  MIDBOOK
  MID_DAYS	
  NOMID_DAYS
  NBR_DAYS 
  PRIOR
  RENTAL_AMT
  RENTAL_DAYS
BY ROLLCD
ON TABLE HOLD AS CARTWO
END
-RUN

DEFINE FILE CARTWO
CRENTAL/D12S = IF CURRENT EQ 'Y' THEN RENTAL_DAYS ELSE 0;
CNOMID_DAYS/D12S = IF CURRENT EQ 'Y' THEN NOMID_DAYS ELSE 0;
CRENTALA/D12.2CS = IF CURRENT EQ 'Y' THEN MIDAMT ELSE 0;
CRENTALD/D12 = IF CURRENT EQ 'Y' THEN MID_DAYS ELSE 0;
CCAMT/D12.2CS = IF CURRENT EQ 'Y' THEN RENTAL_AMT ELSE 0;

END

TABLE FILE CARTWO
SUM CRENTAL
    CRENTALA
    CRENTALD
    CNOMID_DAYS 
    CCAMT
BY ROLLCD
ON TABLE HOLD AS TCC2
END
-RUN


MODIFY FILE TCCBNM
FIXFORM FROM TCC2
DATA ON TCC2
END
-RUN

-NEXTONE