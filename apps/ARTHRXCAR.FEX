-*11/13/17-S-39877-JEM- Creation of new program for setfile ARTCNTRY


-INCLUDE SETECHO 
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN


-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

DEFINE FILE &&EXTRACT
  AIR_DSS/D12.2CSM = 0;
  FARE_PAID/D12.2CSM   = 0; 
  HRS_AMT/D12.2CSM = 0;
-*  LEVEL_DESC/A60 = &&LDESC;
  LEVEL_DESC/A60 = IF AROLL_LEV2 EQ 'ARTHRXB' OR 'ARTHRXP' OR 'ARTHRXG' OR 'ARTHRXP' THEN 'UNITED STATES' ELSE AROLL_LEV2;

  NET_TKT_CNT/D8CS = 0; 
  NEW_SEG_COUNT/D12CS = 0;                          
  NEW_SEG_MILES/D12CS = 0; 
  NEW_TOTAL_AMT/D12.2CSM = 0;
  NEW_RENTL_AMT/D14.2C = RENTAL_AMT;
  NNROOMS/D12CS = 0;
  RES_ST/A1 = EDIT(RESV_STATUS, '$9');
  RENTAL_DAYS/D12CS = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;

  
-* ****DEFINES ON PREVIOUS DEFINES****


 
END
-RUN

TABLEF FILE &&EXTRACT
PRINT AIR_DSS
      CAR_KEY
      FARE_PAID
      HRS_AMT
      INVOICE_DATE
      LEVEL_DESC
      NET_TKT_CNT
      NEW_SEG_COUNT
      NEW_SEG_MILES
      NEW_TOTAL_AMT
      NNROOMS
      PICK_CTY.COUNTRY_CODE AS 'CCODE'
      PNR_LOCATOR
      RENTAL_DAYS
      NEW_RENTL_AMT
      RES_ST
      TKT_NUM
   
-INCLUDE &CARDATES
-********************************************************************
-* Where statements to select data specified in user profile
-* *******************************************************************
-* &&WHERE1
-* &&WHERE2
-* &&WHERE3
-* &&WHERE4
-* &&WHERE5
-* &&WHERE6
 &&WHERE7
 &&WHERE8
-* &&WHERE9
-* &&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS CARHOLD1
END
-RUN 



TABLE FILE CARHOLD1
SUM AIR_DSS
      FARE_PAID
      HRS_AMT
      NET_TKT_CNT
      NEW_SEG_COUNT
      NEW_SEG_MILES
      NEW_TOTAL_AMT
      NNROOMS      
      RENTAL_DAYS
BY LEVEL_DESC
ON TABLE HOLD AS HOLDC1 
END
-RUN


TABLE FILE CARHOLD1
SUM PNR_LOCATOR
BY LEVEL_DESC
BY PNR_LOCATOR
BY TKT_NUM
WHERE RES_ST NE 'X'
WHERE TKT_NUM EQ '0000000000'
ON TABLE HOLD AS PNRHC1
END
-RUN


DEFINE FILE PNRHC1
PNR_CNT/D12CS = IF PNR_LOCATOR NE LAST PNR_LOCATOR THEN 1 ELSE 0;
END
-RUN
TABLE FILE PNRHC1
SUM PNR_CNT
BY LEVEL_DESC
BY PNR_LOCATOR
ON TABLE HOLD AS PNRHC2
END
-RUN

MATCH FILE HOLDC1
SUM AIR_DSS
      FARE_PAID
      HRS_AMT
      NET_TKT_CNT
      NEW_SEG_COUNT
      NEW_SEG_MILES
      NEW_TOTAL_AMT
      NNROOMS
      RENTAL_DAYS
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE PNRHC2
SUM PNR_CNT
BY LEVEL_DESC
AFTER MATCH HOLD AS HOLDC2 OLD-OR-NEW
END
-RUN

TABLE FILE HOLDC2
PRINT AIR_DSS
      FARE_PAID
      HRS_AMT
      NET_TKT_CNT
      NEW_SEG_COUNT
      NEW_SEG_MILES
      NEW_TOTAL_AMT
      NNROOMS
      PNR_CNT
      RENTAL_DAYS
BY LEVEL_DESC
ON TABLE HOLD AS HOLDC FORMAT FOCUS 
END
-RUN




-XXITCAR;

-SET &&CARREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';

