-**************************************************************************
-* DVREXCHGHLD.FEX - Identical to AVI129DT.fex
-* CREATED FOR DATA VAULT EXCHANGE REPORT
-* CREATED FROM AVIW10
-* DVREXCHG.FEX
-*12/4/14 - DEB CHANGED SORT ON MATCH TO ASHLD FILE
-*7/11/16 -DLV -  S-20630   Carried through EMP_ID  

-**************************************************************************
-INCLUDE SETECHO
SET ASNAMES=ON
-RUN

TABLE FILE EXCAIR
SUM 
  DISSAVINGS AS 'DTSAVE'	
  EXCH_FARE AS 'EFARE'	
  FARE_PAID AS 'TFARE'
  NET_TKT_CNT AS 'TTKT'	
  ORG_SALE AS 'TORG'	
  REF_EXCH_CNT AS 'TRFEX'	
  SAVINGS AS 'TSAVE'
  TKT_PURCH AS 'TPURCH'	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN

DEFINE FILE EXCAIR
TICKET1/A10 = DOC_NUMBER;
END
TABLE FILE EXCAIR
PRINT ADDCOLLECT
  AIR_KEY
  AIRLINE	
  AIRLINE_FEE	
  AUX_TKTLS_NUM
  BR_CL_IDX
  C_ITIN
  RESV_DATE
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOD_TYPE	
  DOC_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE	
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE
  FARE_BAS	
  FARE_PAID	
  FLIGHT	
  INVOICE_NUM	
  LEVEL1
  LEVEL2
  LEVEL3 LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE	
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM	
  SEG_LOWEST
  SEG_STANDARD
  TICKET1
  TKT_DATE
  TKT_NUM	
  TKT_PURCH	
  TKT_TYPE
  TRIP_PURPOSE
  TRP_DESC
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XTRAN_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT ADDCOLLECT
  AIR_KEY
  AIRLINE	
  AIRLINE_FEE	
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL1
  LEVEL2
  LEVEL3 LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_STANDARD
  TICKET1
  TKT_DATE
  TKT_NUM	
  TKT_PURCH	
  TKT_TYPE
  TRIP_PURPOSE
  TRP_DESC
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT	
  XFST_DPT
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN


-INCLUDE AEXUSE
-RUN

MATCH FILE AIRHOLD2
PRINT ADDCOLLECT
  AIRLINE	
  AIRLINE_FEE	
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_NBR
  SEG_STANDARD	
  TRN_DATE
  TKT_DATE
  TKT_NUM	
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  TRIP_PURPOSE
  TRP_DESC
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	  
BY TICKET1
RUN
FILE ASHLD
SUM OLD_ITIN
BY TICKET1
AFTER MATCH HOLD AS MATCH2 OLD
END
-RUN

TABLE FILE MATCH2
PRINT ADDCOLLECT
  AIRLINE	
  AIRLINE_FEE	
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_STANDARD	
  TKT_DATE
  TKT_NUM	
  TKT_PURCH
  TKT_TYPE
  TRIP_PURPOSE
  TRN_DATE
  TRP_DESC
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	
  OLD_ITIN
BY TKT_SORT 
BY TKT_NUM
BY SEG_NBR
ON TABLE HOLD AS 'EXCHANGE'
END
-RUN
-SET &&EXCHGRECS = &LINES;
