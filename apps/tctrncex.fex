-* JK added code to select only tnt_company eq 1 or 2 2/21/05
-INCLUDE SETECHO
SET ASNAMES = ON
-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED IN STEP3
-*========================================================================








DEFINE FILE CR_50

EDATE/YYMD=  &&TODT.EVAL ;
EOM_DATE/YYMD=DATEMOV(EDATE,'EOM');

SDATE/YYMD = &&FROMDT.EVAL;


BOM_DATE/YYMD=DATEMOV(SDATE,'BOM');
ANNUAL_BEGIN/YYMD = &&FROMDT.EVAL;
P_ANNUAL_BEGIN/YYMD=DATEMOV(DATEADD(BOM_DATE, 'M', (-12)), 'BOM');

P_ANNUAL_END1/YYMD=DATEMOV(DATEADD(P_ANNUAL_BEGIN, 'M', (+0)), 'EOM');

P_ANNUAL_END2/YYMD=DATEMOV(DATEADD(P_ANNUAL_END1, 'M', (+11)), 'EOY');


 
YD/A1 = IF (INVOICE_DATE GE  &&FROMDT.EVAL)  AND (INVOICE_DATE LE  &&TODT.EVAL ) THEN 'Y' ELSE 'N';



P_YD/A1 = IF (INVOICE_DATE GE P_ANNUAL_BEGIN ) AND
            (INVOICE_DATE LE P_ANNUAL_END2) THEN 'Y' ELSE 'N';





  NEW_RENTL_AMT/D14.2C = RENTAL_AMT;

  
  RENTAL_DAYS/D12 =  IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                  ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;  
 
  
-*  YTD

 YCAMT/D14.2C = IF YD EQ 'Y' THEN NEW_RENTL_AMT ELSE 0;
 YRENTL/D12C = IF YD EQ 'Y' THEN RENTAL_DAYS ELSE 0;
  
-*  PRIOR  

 PYCAMT/D14.2C = IF P_YD EQ 'Y' THEN NEW_RENTL_AMT ELSE 0;
 PYRENTL/D12C = IF YD EQ 'Y' THEN RENTAL_DAYS ELSE 0;


CLIENT/A8 = '&&CURROLL.EVAL';
END

TABLE  FILE CR_50
PRINT YCAMT
PYCAMT
P_ANNUAL_BEGIN 
P_ANNUAL_END2
EOM_DATE
COMPUTE CDAYS/I6=(EOM_DATE - ANNUAL_BEGIN) + 1;

BY CLIENT
-* &AIRDATES CANNOT BE USED FOR THIS REPORT B/C IT WILL RUN FOR CURRENT MONTH ONLY INSTEAD OF YTD,QTR, ETC
-* -INCLUDE &AIRDATES
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCCTRNYTD
END
-RUN
 


 

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACT DATA FROM ABOVE
-*========================================================================

DEFINE FILE TCCTRNYTD
ROLLCD/A8 = CLIENT;
 
END
TABLE FILE TCCTRNYTD
 
SUM YCAMT/D14.2 PYCAMT/D14.2 P_ANNUAL_BEGIN 
P_ANNUAL_END2
EOM_DATE
   
COMPUTE NDAYS/I6 = FST.CDAYS;
    
COMPUTE DIVBY/I6=IF NDAYS GT 365 THEN NDAYS ELSE 365; NOPRINT
COMPUTE CPROSP1/D14.2   = ((YCAMT/FST.CDAYS)*DIVBY) ;
 

BY CLIENT
ON TABLE HOLD AS TCCYTD1
END
-RUN


DEFINE FILE TCCYTD1
  NMB/I5 = NMB + 1;  
  ROLLCD/A8 = CLIENT;
END


TABLE FILE TCCYTD1
PRINT YCAMT PYCAMT CPROSP1
BY ROLLCD
BY NMB
ON TABLE HOLD AS TCCAR
END
-RUN



MODIFY FILE TCCTRNYD
FIXFORM FROM TCCAR
DATA ON TCCAR
END
-RUN




-NEXTONE
