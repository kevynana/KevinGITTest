-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*  02/05/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-* Story ID S-10086 Added &&overdrill flag logic for use in 5.0 to choose to for the report to be drillable or non-drillable - 9/15/15 - JM
-*  01/06/2016  REJ  S-13202 ER5 changes so the selection criteria would show on the subfoot page.
-*01/19/16 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*4/20/2017-JEM-S-33318-updated logic for no records report
-* 06/27/2017 - RSB - S-36530 Report stream to be updated with standard footer
-* 
-INCLUDE SETECHO
 
-SET &&DRILLABLE = IF &&DEPLOY EQ 'L' AND EDIT(&&OUTTO,'$9') NE 'B'
- THEN 'N' ELSE 'Y';
 
-DEFAULT &&OVERDRILL = 'N';
 
-*SET TEMPERASE = OFF
 
EX SETDBLS SETFILE=&&SETF
-RUN
-INCLUDE OTHPARMS
 
-INCLUDE SetParmtime
-RUN
-**********************************************************************
-* DETERMINE IF WE HAVE WEB DEPLOYMENT OR LOCAL STAND ALONE
-* SET PATH FOR SAVING THE SETFILE
-**********************************************************************
-******LOCAL DEPLOYMENT
-IF &&DEPLOY EQ 'W' GOTO SETWEB;
-*-SET &&LOCPATH = &&TNTDRV || '\TT\ ' ||&&ROLLUP || '\ '||&&UNAME.EVAL|| '\';
-SET &&SETFNM= &&LOCPATH || &&DTTMSTRM ||'.FTM';
COPY &&SETF &&SETFNM
-RUN
-GOTO SETFILDEF;
 
-******WEB DEPLOYMENT
-SETWEB
-SET &&WEBPATH = '&&WEBSRV.EVAL' || '\TTWEB\ ' || &&ROLLUP || '\ '||&&UNAME.EVAL|| '\';
 
-SET &&SETFNM = &&WEBPATH || &&DTTMSTRM ||'.FTM';
COPY &&VARFWEB &&SETFNM
-INCLUDE SETFPARM
-RUN
-GOTO SETFILDEF;
 
-SETFILDEF
-INCLUDE APNDSETF
-RUN
 
FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN
 
-INCLUDE SELCATQT
-RUN
 
EX &&CATQTRPR
-RUN
 
FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN
 
-INCLUDE SetBDBsForDrill
-RUN
-SET &&SMD = 'S';
-RUN
 
EX AIRUSE
-RUN
 
-SET &&RPTGRP = 'AIR';
EX UDIDGEN
-RUN

-IF &&SETF EQ 'CGNONC' OR 'CGNONSM' THEN GOTO CGNONC ELSE
-IF &&SETF EQ 'CHNONC'              THEN GOTO CHNONC ELSE
-IF &&SETF EQ 'PRNONCA'             THEN GOTO PRNONC ELSE GOTO ABNONC;

-*** INACTIVE SETFILES ***
-* -IF &&SETF EQ 'MXNONC' THEN GOTO MXNONC ELSE
-* -IF &&SETF EQ 'MXNONC1' OR 'MXNONC2' THEN GOTO MXNONC1 ELSE
-* -IF &&SETF EQ 'TTNONC' OR 'TTNONCD' OR 'TTNONCI' THEN GOTO TTNONC ELSE
-*** INACTIVE SETFILES ***
 
 
-ABNONC
EX ABNONAIR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :AB1;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AB1_CONT;
-:AB1
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AB1_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :AB2;
 
TABLE FILE BRPTFLDS
PRINT AIR.ID AIR.INCL1
BY INST_KEY
ON TABLE SAVE AS AIRACH11
END
-RUN
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH11
END
-RUN
 
TABLE FILE BRPTFLDS
PRINT AIRFLDS.PASSENGER
BY RPT_INST.INST_KEY
BY AIRFLDS.SEQ_NO
ON TABLE SAVE AS AIRACH22
END
-RUN
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTLFLDS.SEQ_NO/2 HTLFLDS.PASSENGER/A33
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTLFLDS
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTLFLDS.PASSENGER
DATA ON AIRACH22
END
-RUN
-:AB2
-IF &&FROMAVRP NE 'Y' GOTO :TA1;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:TA1
-IF &&FROMAVRP EQ 'Y' GOTO :TA2;
EX CODEGEN
-:TA2
 
 
-RUN
-*
-*** INACTIVE SETFILE
-IF &&SETF EQ 'MXNONC2' THEN GOTO METX2;
EX ABNONHTL
-RUN
-GOTO Car;
 
 
-METX2
 
 
EX ABNONHTL2
-RUN
 
 
-Car
EX CARUSE
-RUN
 
-SET &&RPTGRP = 'CAR';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
RT/A3 = 'CAR';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :AB3;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AB3_CONT;
-:AB3
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AB3_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :AB4;
 
TABLE FILE BRPTFLDS
PRINT AIR.ID AIR.INCL1
BY INST_KEY
ON TABLE SAVE AS AIRACH11
END
-RUN
 
TABLE FILE BRPTFLDS
PRINT AIRFLDS.PASSENGER
BY RPT_INST.INST_KEY
BY AIRFLDS.SEQ_NO
ON TABLE SAVE AS AIRACH22
END
-RUN
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 CAR.ID/1 CAR.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG CAR
  ON NOMATCH INCLUDE
  ON MATCH UPDATE CAR.INCL1
DATA ON AIRACH11
END
-RUN
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 CARFLDS.SEQ_NO/2 CARFLDS.PASSENGER/A33
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG CARFLDS
  ON NOMATCH INCLUDE
  ON MATCH UPDATE CARFLDS.PASSENGER
DATA ON AIRACH22
END
-RUN
-:AB4
EX CODEGEN
-RUN
 
EX ABNONCAR
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF1;
-INCLUDE AVRP_SUBFOOT
-:AVSF1
 
-IF &&SETF EQ 'CRNONC' THEN GOTO CERN;

-IF &&AIRREC EQ 'N' AND &&CARREC EQ 'N' AND &&HTLREC EQ 'N' THEN GOTO NORECORDS;
 
EX ABNONSUM
-RUN
 
-GOTO NEXT
 
-CERN

-IF &&AIRREC EQ 'N' AND &&CARREC EQ 'N' AND &&HTLREC EQ 'N' THEN GOTO NORECORDS;

 
EX CRNONSUM
-RUN
 
-GOTO NEXT
 
 
-CGNONC
EX CGNONAIR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
 
EX CGNONHTL
-RUN

-IF &&AIRREC EQ 'N' AND &&HTLREC EQ 'N' GOTO NORECORDS;
 
EX CGNONSUM
-RUN
 
-GOTO NEXT
 
-CHNONC
EX ABNONAIR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
EX ABNONHTL
-RUN
 
EX CARUSE
-RUN
 
-SET &&RPTGRP = 'CAR';
EX UDIDGEN
-RUN
 
 
EX ABNONCAR
-RUN

-IF &&AIRREC EQ 'N' AND &&HTLREC EQ 'N' AND &&CARREC EQ 'N' GOTO NORECORDS;

 
EX CHNONSUM
-RUN
-GOTO NEXT
 
-MXNONC
 
EX MXNONAIR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
EX MXNONHTL
-RUN
 
-IF '&&MXNOAIR.EVAL' EQ 'Y' AND '&&MXNOHTL.EVAL' EQ 'Y' THEN GOTO NEXT;
 
EX MXNONSUM
-RUN
-GOTO NEXT
 
-MXNONC1
 
EX MXNONAR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
EX MXNONHT
-RUN

-IF &&AIRREC EQ 'N' AND &&HTLREC EQ 'N' GOTO NORECORDS;

 
EX MXNONSM
-RUN
-GOTO NEXT
 
-TTNONC
EX TTNONA
-RUN
-IF &&AIRREC EQ 'N' GOTO NORECORDS;

-GOTO NEXT
 
-PRNONC

EX PRNONC
-RUN

-IF &&AIRREC EQ 'N' GOTO NORECORDS;
 
 
-NEXT
 
 
-* REJ ADDED TO TRAP ERRORS
-SET &&FEXNOW=&&EXPARM;
-INCLUDE ERRORCHK
-IF &&RET GT 1 GOTO XXIT;
-* REJ ADDED TO TRAP ERRORS
 
-IF &RECORDS GT 0 THEN GOTO DOIT;
 
-NORECORDS
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF2;
-INCLUDE AVRP_SUBFOOT
-:AVSF2

-INCLUDE NORECRPT
-RUN


-DOIT
 
-XXIT
 
 
