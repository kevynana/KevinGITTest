-* Created for the UDID reports
-* Joy Updated Pref_Non define to contain C/P/N/M/L
-* 9/9/14 Updated Pref_non define to use exclude_flags - jk
-*7/11/16 S-20630 DLV  Added EMP_ID to extract


SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';


DEFINE FILE &&EXTRACT
  CITY_ST/A35 = PROP_CITY||(', '| PROP_STATE);
  FOP/A2 = EDIT(CC_NUM,'99$$$$$$$$$$$$$$$$');
  FOP2/A7 = IF FOP EQ 'AX' THEN EDIT(CC_NUM, '99$$$$$$$$$$99999')
             ELSE EDIT(CC_NUM, '99$$$$$$$$$$$$9999');    
  LEVEL_DESC/A60  = &&LDESC;
  IN_DATE/MDYY = CHKIN_DATE;
  INV_DATE/MDYY = INVOICE_DATE;
  NBR_DAYS/D12 =  NUM_DAYS;
  NBR_ROOMS/D12 = NUM_ROOMS;
  NEW_ROOM_RATE/D14.2C = ROOM_RATE;
  NEW_STD_RATE/D14.2C = STD_RATE;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  OUT_DATE/MDYY = CHKOUT_DATE;
 PNP_FLAG/A1 = EDIT(EXCLUDE_FLAGS, '$9');
 PNP_IE/A1 = EDIT(EXCLUDE_FLAGS, '$$9');
 -* PREF_NON/A15 = IF CLIENT_PREF EQ 'C' OR 'P' OR 'N' OR 'M' OR 'L' THEN 'PREFERRED' ELSE 'NON-PREFERRED';
 PREF_NON/A15 = IF PNP_FLAG EQ 'I'  THEN 'PREFERRED' ELSE 'NON-PREFERRED';
 

  REASON_CD/A2=EDIT(REFUSE_KEY,'$$$$$$$$99');
  REFUSE_CD/A2=EDIT(REFUSE_KEY,'$$$$$$$$99');

  RSNCDE/A48=REASON_CD|| '-' ||REFUSAL_DESC;
  XPSNGR_NM/A15 =EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  PROP_ZIP5/A5=EDIT(PROP_ZIP, '99999$$$$$');
  
-* ****DEFINES ON PREVIOUS DEFINES****
   BOOKINGS/D8 = IF NEW_TOTAL_AMT GT 0 THEN 1 ELSE (-1);
  
   TOTAL_STD/D12.2C = IF ((NNROOMS LT 0) AND (NEW_STD_RATE LT 0))
                      THEN ((NNROOMS * NEW_STD_RATE) * (-1))
                      ELSE NNROOMS * NEW_STD_RATE;

-* ****DEFINES ON PREVIOUS DEFINED DEFINES***
   TOTAL_SLSAV/D12.2C = TOTAL_STD - NEW_TOTAL_AMT;
END
-RUN

TABLEF FILE &&EXTRACT
PRINT 
  AROLL_LEV5
  AROLL_LEV6
  BOOKINGS	
  BR_CL_IDX
  CHAIN_CODE
  CHAIN_NAME
  CHKIN_DATE
  CHKOUT_DATE
  CITY_ST
  DAILY_RATE
  DOD_TYPE
  EMP_ID
  FOP2
  HHL_CONFIRM
  HOTEL_PHONE 	
  HTL_KEY
  IN_DATE 	
  INVOICE_DATE 	
  INVOICE_NUM 	
  LEVEL_DESC
  LEVEL2
  LEVEL3
  NBR_DAYS	
  NBR_ROOMS
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NNROOMS	
  OUT_DATE 
  PASSNGR_NAME
  PNR_LOCATOR 
  PREF_NON
  PROP_ADDRESS 
  PROP_CITY
  PROP_NAME
  PROP_STATE_CD
  PROP_ZIP5
  RESV_STATUS
  REFUSAL_DESC
  REFUSE_CD
  REFUSE_CODE
  RSNCDE
  TOTAL_SLSAV
  TOTAL_STD 
  XPSNGR_NM
  
-INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

-* ON TABLE HOLD AS HTLHOLD1
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN




