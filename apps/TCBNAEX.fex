-***************************************************************************
-* REPORT NAME: BENMARKING ANALYSIS (AIR EXTRACT)
-* TOTAL COMPANY REPORTING
-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT
-***************************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON



-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED IN STEP3
-*========================================================================
DEFINE FILE SR_50
-*  CARD/A8 = EDIT (CREDIT_CARD, '99999999$$$$$$$$$$');
-*  CCARD2/A6 =EDIT(CREDIT_CARD, '$$999999$$$$$$$$$$');
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE 
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';   
-*  CRD_CRD/A2=EDIT(CREDIT_CARD, '99$$$$$$$$$$$$$$$'); 
-*   FLAG/A1 = 'A';
  FARE_PAID/D12 = SEG_AMT + SEG_TAX;
  NET_FARE/D12 = SEG_AMT - SEG_COM;
  NET_TKT_CNT/P8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                      IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                      IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;

-*  NET_TKT_CNT/P8CS  =   IF (SEG_NBR EQ '01') AND
-*                           (FARE_PAID GE 0) AND
-*                           (SEG_COUNT EQ 1) THEN 1 ELSE 
-*                        IF (SEG_NBR EQ '01') AND 
-*                           (EX_FLAG EQ 'F') AND (SEG_COUNT EQ -1)
-*				   THEN (-1) ELSE 
-*                        IF (DOC_TYPE NE '1') AND
-*                          (SEG_NBR EQ '01') AND
-*                           (RF_FLAG EQ 'F') AND
-*				   (SEG_COUNT EQ -1)
-*				   THEN (-1) ELSE 0;
   SAVINGS/D11.2CS     = SEG_STANDARD - FARE_PAID;
   NEW_SEG_MILES/P9 = SEG_MILES;
   TKT_AMOUNT/D12.2CS = TICKET_AMT + TAX_AMT;
   TKT_PURCH/D8.2CS      = IF (TICKET_CODE EQ '1') AND
                             (SEG_NBR EQ '01') AND
                             (FARE_PAID GE 0) AND
                             (SEG_COUNT EQ 1) AND 
                             (CONJ_REL EQ 1) THEN 1 ELSE 0;
   EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') THEN 1 ELSE 0;
-* Defines on Previous Defines
  DISSAVINGS/D12 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
  VASAVINGS/D12 = SEG_DISCOUNT - FARE_PAID;
-*  DECLINE_AMT/D12.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
-*                         TKT_AMOUNT - LOWEST_AMT;
  
-* Defines on Previously Defined Defines
  
END
-RUN

TABLEF FILE SR_50
PRINT AIR_MAIN.INTL_DOM AS 'INTL_DOM'
-*  AIR_KEY
-*  BR_CL_IDX
-*  CARD
-*  CCARD2
  CGADV
-*  CRD_CRD
-*  CREDIT_CARD
  CITYPAIR.INTL_DOM AS 'ITDOM'
  DISSAVINGS
  DOC_TYPE	
  DOD_TYPE
-*  DPT_DATE	
-*  EMBARK	
   EX_FLAG	
-*  EXCHG_SALE
  FARE_PAID
-*   FLAG
  NET_FARE	
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  REFUSE_CODE
  RF_FLAG
  SAVINGS
-*  SEG_AMT/D12	
-*  SEG_COM/D12	
  SEG_COUNT
  SEG_NBR 	
-*  SEG_TAX/D12 
  TKT_NUM
  TKT_PURCH	
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	

WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
-* &&WHERE7
-* &&WHERE8
-* &&WHERE9
-* &&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS TC_ABNM
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*                <---------------- STEP5 ---------------->
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TCAREV       
-*========================================================================
DEFINE FILE TC_ABNM
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TC_ABNM
PRINT 
-*  AIR_KEY
-*  BR_CL_IDX
-*  CARD
-*  CCARD2
  CGADV
-*  CRD_CRD
-*  CREDIT_CARD
  DISSAVINGS
  DOC_TYPE	
  DOD_TYPE
-*  DPT_DATE	
-*  EMBARK	
  EX_FLAG	
-*  EXCHG_SALE
  FARE_PAID
-*  FLAG
  INTL_DOM
  ITDOM
  NET_FARE	
  NET_TKT_CNT/P8CS
  NEW_SEG_MILES
  NONREF_FLAG
  REFUSE_CODE
  RF_FLAG
  SAVINGS
-*  SEG_AMT/D12	
-*  SEG_COM/D12	
-*  SEG_COUNT
  SEG_NBR 	
-*  SEG_TAX/D12 
-*  TKT_NUM
  TKT_PURCH	
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	
BY ROLLCD
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS HOLD2
END
-RUN

DEFINE FILE HOLD2
  NMB/I5 = NMB + 1;  
END
TABLE FILE HOLD2
PRINT
-* AIR_KEY
-*  BR_CL_IDX
-*  CARD
-*  CCARD2
  CGADV
-*  CRD_CRD
-*  CREDIT_CARD
  DISSAVINGS
  DOC_TYPE	
  DOD_TYPE
-*  DPT_DATE	
-*  EMBARK	
  EX_FLAG	
-*  EXCHG_SALE
  FARE_PAID
-*   FLAG
  INTL_DOM
  ITDOM	
  NET_FARE
  NET_TKT_CNT/P8CS
  NEW_SEG_MILES
  NONREF_FLAG
  REFUSE_CODE
  RF_FLAG
  SAVINGS
-*  SEG_AMT/D12	
-*  SEG_COM/D12	
  SEG_COUNT
  SEG_NBR 	
-*  SEG_TAX/D12 
  TKT_NUM
  TKT_PURCH	
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	
BY ROLLCD
BY NMB
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS TCAIR1
END
-RUN

MODIFY FILE TCABNM
FIXFORM FROM TCAIR1
DATA ON TCAIR1
END
-RUN



-NEXTONE
