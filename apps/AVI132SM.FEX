
-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-********************************************************************
-* Modifications: 
-* CREATED FOR PURITY TRANSACTION FEE REPORT CREATED FROM AVIW74DT 
-* UPDATED NORECORDS TO DEFINE - JK 12/10/14
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*2/17/15 - DEB = S-07237  ADDED CODE FOR ABTRNFSM
-*12/28/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*4/21/2017-JEM-S-33318-updated logic for no records report

-********************************************************************

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';


SET ASNAMES=ON
-RUN
-INCLUDE SETECHO

-IF &&SETF EQ 'KWPAXMO' THEN GOTO EMPINCL;
-IF '&&SETF.EVAL' EQ 'ABTRNFSM' GOTO TRANFEE;

DEFINE FILE &&RPT_HOLD
FLAG/A1 = 'A';
END
TABLE FILE &&RPT_HOLD
SUM MRK_TKT_CNT/D8 AS 'TMKT'
BY PASSNGR_NAME
BY TRNM
-* WHERE PASSNGR_NAME CONTAINS 'LANOHA/RICHARD' OR 'MURPHY/CHRISTOPHER J' OR 'CASSELS/SCOTT L' OR
-* 'SANMAN/RANDY' OR 'MURPHY/WILLIAM' OR 'MILES/DAVID' OR 'COLF/RICHARD W' OR 'RILEY/KEN' OR
-* 'POZIN/RAFAIL' OR 'JANSEN/H JOHN' OR 'PHELPS/MICHAEL K' OR 'SAMUELSON/KIRK R' OR
-* 'BENTLEY/WALTER L' OR 'SHELBY/THOMAS' OR 'ADAMS/HENRY' OR 'CHAPDELAINE/LOUIS' OR
-* 'PATTERSON/DOUGLAS' OR 'SCHROPP/TOBIN' OR 'PIECHOSKI/MICHAEL J' OR 'JANSEN/HERMAN JOHN' OR
-* 'LANOHA/RICHARD ANDREW' OR 'SCHROPP/TOBIN ANDREW' OR 'PIECHOSKI/MICHAEL JOSEPH' OR
-* 'WISENBAKER/JAMIE' OR 'CARLSGAARD/TERRY' OR 'MCKENZIE/GARY' OR 'MCKENZIE/MARK' OR 
-* 'MEADOR/RUDOLPH LEROY' OR 'PAUL/JOHN CLEO'
-* WHERE LEVEL2 EQ '5854' OR '1434' OR '1432' OR '2936' OR '6783' OR '7651' OR '6258' OR 
-*                 '7702' OR '7434' OR '1163' OR '2434' OR '7003' OR '5765' OR '1999' OR
-*                 '734342' OR '1350' OR '3032' OR '5347' OR '7434' OR '5854' OR '3032' OR 
-*                 '2283' OR '115441' OR '13401' OR '10501' OR '11289' OR '11821'
           
ON TABLE HOLD AS AIRHOLD1 
END
-RUN
-GOTO NOEMP;

-EMPINCL;


-* PROGRAM TO UPDATE KWEMPID IS KWEMPUPD.FEX
TABLE FILE KWEMPID
BY LEVEL2
ON TABLE HOLD AS EMPID
END
-RUN

DEFINE FILE &&RPT_HOLD
FLAG/A1 = 'A';
END
TABLE FILE &&RPT_HOLD
SUM MRK_TKT_CNT/D8 AS 'TMKT'
BY PASSNGR_NAME
BY TRNM
WHERE LEVEL2 IN FILE EMPID
ON TABLE HOLD AS AIRHOLD1
END
-RUN

DEFINE FILE AIRHOLD1
FLAG/A1 = 'A';
END
TABLE FILE AIRHOLD1
SUM MRK_TKT_CNT/D8 AS 'TTMKT'
BY FLAG
BY PASSNGR_NAME
ON TABLE HOLD AS AIRHOLD2
END
-RUN

MATCH FILE AIRHOLD1
PRINT TMKT
BY PASSNGR_NAME
BY TRNM
ON TABLE HOLD
RUN
FILE AIRHOLD2
SUM TTMKT
BY PASSNGR_NAME
AFTER MATCH HOLD AS MATCHONE OLD-OR-NEW
END
-RUN

-IF &RECORDS EQ 0 GOTO NORECORDS;


-GOTO KWCN;



-NOEMP;
DEFINE FILE &&RPT_HOLD
FLAG/A1 = 'A';
END
TABLE FILE &&RPT_HOLD
SUM MRK_TKT_CNT AS 'TTMKT'
BY FLAG
BY PASSNGR_NAME
ON TABLE HOLD AS AIRHOLD2
END
-RUN

 
MATCH FILE AIRHOLD1
PRINT TMKT
BY PASSNGR_NAME
BY TRNM
ON TABLE HOLD
RUN
FILE AIRHOLD2
SUM TTMKT
BY PASSNGR_NAME
AFTER MATCH HOLD AS MATCHONE OLD-OR-NEW
END
-RUN


-GOTO KWCN

-TRANFEE

TABLE FILE &&RPT_HOLD
SUM    NW_FARE_PAID/D12.2CS AS 'TFARE'
    FARE_PAID
    NET_TKT_CNT
    NW_TKT_CNT AS 'NTTKT'
BY LEVEL_DESC
BY BR_CL_IDX
BY TRNM
ON TABLE HOLD AS AIRHOLD1
END
-RUN


TABLE FILE &&RPT_HOLD
PRINT AA_CC
  ACCT
  ADDCOLLECT
  AGENT_NUM
  AIR_KEY	
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  C_ITIN
  CC_NUM
  EMB_APT_CD	
  DISSAVINGS
  DOC_NUMBER
  DOC_TYPE  
  EMBARK 
  EX_FLAG
  EX_RF_FLAG
  EX_IND
  EXSALE
  EXCHG_SALE
  EXCHGS
  FARE_BAS
  INVOICE_NUM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  MRK_TKT_CNT
  NET_COMM
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  NW_FARE_PAID
  NW_TKT_CNT
  ONLINE_TRADITIONAL
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SAVINGS
  SEG_AMT
  SEG_COM
  SEG_CNT
  SEG_NBR
  SEG_STANDARD
  SEG_TAX
  TKT_DATE	
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  FARE_PAID
  VOID_DATE
  VOIDS
  XARR_DT
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  CREDIT_CARD
BY LEVEL_DESC
BY BR_CL_IDX
BY TRNM
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AA_CC
  ACCT
  ADDCOLLECT
  AGENT_NUM
  AIR_KEY	
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  C_ITIN
  CC_NUM
  EMB_APT_CD	
  DISSAVINGS
  DOC_NUMBER
  DOC_TYPE  
  EMBARK 
  EX_FLAG
  EX_RF_FLAG
  EX_IND
  EXSALE
  EXCHG_SALE
  EXCHGS
  FARE_BAS
  INVOICE_NUM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  MRK_TKT_CNT
  NET_COMM
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  NW_FARE_PAID
  NW_TKT_CNT
  ONLINE_TRADITIONAL
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SAVINGS
  SEG_AMT
  SEG_COM
  SEG_CNT
  SEG_NBR
  SEG_STANDARD
  SEG_TAX
  TKT_DATE	
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  FARE_PAID
  VOID_DATE
  VOIDS
  XARR_DT
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  CREDIT_CARD
BY LEVEL_DESC
BY BR_CL_IDX
BY TRNM
ON TABLE HOLD
RUN
FILE AIRHOLD1
SUM  
    TFARE
    NTTKT
BY LEVEL_DESC
BY BR_CL_IDX
BY TRNM
ON TABLE HOLD AS XONE OLD-OR-NEW
END
-RUN

DEFINE FILE XONE
FLAG/A1 = 'A';
TASF_TKT_NUM/A10 = '          ';
END
TABLE FILE XONE
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  NW_FARE_PAID
  FLAG
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  NEW_SEG_AMT
  NW_TKT_CNT
  NEW_SEG_MILES
  ONLINE_TRADITIONAL
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT  
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XTRAN_DT
  XPSNGR_NM
  TFARE
  NTTKT
BY AIR_KEY 
ON TABLE HOLD AS AIRHOLD4  
END 
-RUN
 

-INCLUDE PFXUSE
-RUN

-INCLUDE PFTRANSUM
-RUN

 

DEFINE FILE HOLDAM
NEW_FARE/D12.2CS = IF FLAG EQ 'A' OR 'F' THEN NW_FARE_PAID ELSE 0;
NW_TCNT/D8CS = IF FLAG EQ 'A' THEN NW_TKT_CNT ELSE 0;
AFEE/D12.2CS = IF FLAG EQ 'F' THEN AIRLINE_FEE ELSE 0;
FEE/D12.2CS = IF FLAG EQ 'B' THEN TFARE ELSE 0;
IDOM/A15 = IF INTL_DOM EQ 'D' THEN 'DOMESTIC' ELSE 'INTERNATIONAL';
END
TABLE FILE HOLDAM
PRINT  AIR_KEY	
  AFEE  
  BR_CL_IDX  
  IDOM
  LEVEL_DESC
  NEW_FARE AS 'NW_FARE_PAID'
  NW_TCNT  AS 'NW_TKT_CNT'
  ONLINE_TRADITIONAL
  TKT_NUM
  TASF_TKT_NUM
  PASSNGR_NAME
  FEE  
BY FLAG
BY PASSNGR_NAME NOPRINT
BY TKT_NUM NOPRINT
 
ON TABLE HOLD AS MATCHONE
END
-RUN
 



-IF &LINES EQ 0 THEN GOTO NORECORDS;


DEFINE FILE MATCHONE

NOWTOD/A8 WITH BR_CL_IDX = HHMMSS (NOWTOD);

END
-RUN

-IF '&&SETF.EVAL' EQ 'ABTRNFSM' GOTO TRNFEE;
 


-KWCN


-IF &LINES EQ 0 THEN GOTO NORECORDS;


DEFINE FILE MATCHONE

NOWTOD/A8 WITH TRNM = HHMMSS (NOWTOD);

END
-RUN
 

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'MATCHONE';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE MATCHONE
-*-INCLUDE HEADER
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-IF '&&SETF.EVAL' EQ 'ABTRNFSM' THEN GOTO TRNFEE; 


 
SUM TMKT  AS ' '
BY HIGHEST TTMKT NOPRINT
BY PASSNGR_NAME AS 'TRAVELER NAME'
ACROSS TRNM AS ' '
ON TRNM SUMMARIZE AS 'YTD'
ON TABLE COLUMN-TOTAL
-* FOOTING BOTTOM
-FOOTER
-INCLUDE FOOTERSM
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
-*ON TABLE HOLD
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 

ON TABLE SET STYLE *
-*-INCLUDE &&SMSTY
-INCLUDE &&PASTYD
ENDSTYLE
-*


&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-TRNFEE

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-SET &&DRILLRPT = 'MATCHONE';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE MATCHONE
-*-INCLUDE HEADER
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
  
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
 

-* FOOTING BOTTOM
-FOOTER
-INCLUDE FOOTERSM
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
-*ON TABLE HOLD
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 

ON TABLE SET STYLE *

-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-TYPE BEFORE
-*-INCLUDE &&DSTY

-SKIP_DRILL


-*-INCLUDE &&SMSTY
-INCLUDE &&PASTYD
ENDSTYLE
-*


&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT
