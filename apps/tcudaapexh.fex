-*S-29899-JEM-2/27/17-Created for new report TCUDAAP

-INCLUDE SETECHO
SET ASNAMES = ON 

-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED
-*========================================================================
-SET &&EXTRACT = 'HR_50';

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';



TABLE FILE &&EXTRACT
PRINT HTL_KEY	
      PNR_LOCATOR
-INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

-* ON TABLE HOLD AS &&RPT_HOLD
ON TABLE HOLD AS REPHOLDH
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;

TABLE FILE REPHOLDH
PRINT PNR_LOCATOR 
BY HTL_KEY
ON TABLE HOLD AS REPHOLD1H FORMAT FOCUS INDEX HTL_KEY
END
-RUN


-INCLUDE TCUDHUSE
-RUN

-* AAP UDID

TABLE FILE UDHTL
PRINT AUD_DATA AS 'AAP_VAL'
BY HTL_KEY
WHERE UDID EQ 'AAP'
ON TABLE HOLD AS TCAAPH FORMAT FOCUS INDEX HTL_KEY
END
-RUN


JOIN CLEAR *
-RUN
JOIN HTL_KEY IN REPHOLD1H TO HTL_KEY IN TCAAPH AS JH
-RUN


DEFINE FILE REPHOLD1H
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE REPHOLD1H
SUM PNR_LOCATOR
BY ROLLCD
BY PNR_LOCATOR 
WHERE AAP_VAL EQ 'Y'
ON TABLE HOLD AS TCSD3H
END
-RUN


MODIFY FILE TC_UDAAP
LOG DUPL MSG OFF
FIXFORM FROM TCSD3H
MATCH ROLLCD PNR_LOCATOR
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON TCSD3H
END
-RUN


-NEXTONE

 


