SET ASNAMES=ON


USE CLEAR *
USE
    C:\TNT\TTRACKER\SUDATA\ROLLUP.FOC
END

  FI CUSTS DISK C:\LOAD\FOCTEMP\CUSTS.DAT
SET MESSAGE=ON
-*=======================================================================
SET ASNAMES=ON
DEFINE FILE ROLLUP
XL01/A1 = 'W' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP AS 'ROLLUP_CODE'
      XL01   AS 'PR_STAMP'
IF UPD_ENABLE NE ' '
IF QTR_ENABLE NE ' '
-* IF ROLLUP_CODE NE 'TOTAL-R'
IF ROLLUP_CODE EQ 'CH2M-R'
-* ON TABLE HOLD
END
-RUN
-QUIT

MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-*======================================================================
USE CLEAR *
-RUN
SET TEMPDIR=C:\FOCTEMP
SET MESSAGE=ON
SET WARNING=OFF
SET YRTHRESH=30
SET DEFCENT=19
-RUN
-*=======================================================================

-SET &CNT=0;

-TOP
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP COMP
BY ROLLUP_CODE NOPRINT
IF UPD_ENABLE NE ' '
IF RECORDLIMIT EQ 1
IF QTR_ENABLE NE ' '
IF PR_STAMP EQ 'W'
ON TABLE SAVE AS CUSTS
END
-RUN

-READ CUSTS &&ROLLUP.A8 &&COMP.A6.
-RUN

-IF &RECORDS EQ 0 THEN GOTO STOP;
-RUN


-SET &&SMD = 'S';

EX AIRXUSUPD
-RUN

-* TKT MAIN FILE NAMES

-SET &&FOCTNAME1='T1'||&&COMP;
-SET &&FOCTNAME2='T2'||&&COMP;
-SET &&FOCTNAME3='T3'||&&COMP;
-SET &&FOCTNAME4='T4'||&&COMP;
-SET &&FOCTNAME5='T5'||&&COMP;
-SET &&FOCTNAME6='T6'||&&COMP;
-SET &&FOCTNAME7='T7'||&&COMP;
-SET &&FOCTNAME8='T8'||&&COMP;
-SET &&FOCTNAME9='T9'||&&COMP;
-SET &&FOCTNAME0='T0'||&&COMP;
-SET &&FOCTNAMEY='TY'||&&COMP;
-SET &&FOCTNAMEZ='TZ'||&&COMP;

TABLE FILE SR_50 
PRINT AIR_KEY
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
WHERE TKT_MAIN.GEO_ZONE EQ ' '
END
-RUN
-QUIT

TABLE FILE SR_50
SUM AIR_KEY
BY AIR_KEY
WHERE RF_FLAG NE ' '
WHERE SEG_COUNT LT 0
ON TABLE HOLD AS HLD2
END
-RUN


MATCH FILE HLD1
SUM AIR_KEY
BY AIR_KEY
ON TABLE HOLD
RUN
FILE HLD2
SUM AIR_KEY
BY AIR_KEY
AFTER MATCH HOLD AS HLD3 OLD-AND-NEW
END
-RUN

TABLE FILE SR_50
PRINT EMBARK ROUTE CL_CAT AIRLINE SEG_NBR
BY AIR_KEY
ON TABLE HOLD AS SRHOLD
END
-RUN

MATCH FILE SRHOLD
PRINT EMBARK ROUTE CL_CAT AIRLINE SEG_NBR
BY AIR_KEY
ON TABLE HOLD
RUN 
FILE HLD3
SUM AIR_KEY
BY AIR_KEY
AFTER MATCH HOLD AS SRHOLD1 OLD-AND-NEW
END
-RUN

-* FIELD 1 ADIR_ALL

CREATE FILE TTEMP
-RUN

-* SEGMENT 1
DEFINE FILE SRHOLD1
MADIRX/A13 = '-'||EMBARK||ROUTE||'/'||AIRLINE||'*'||CL_CAT;
MADIRXA/A13 = EMBARK||ROUTE||'/'||AIRLINE||'*'||CL_CAT;
END
-RUN
TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN


-* SEGMENT 2

TABLE FILE SRHOLD1
PRINT MADIRX AS 'MADIRX2'
BY AIR_KEY 
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN

-* SEGMENT 3

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN


TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

TABLE FILE TTEMP1
PRINT MADIRX
BY AIR_KEY 
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN


MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRX
DATA ON TTEMP2
END
-RUN

-* FIELD 2 = ANON_ALL

DEFINE FILE SRHOLD1
TEMBARK/A3 = IF EMBARK LT ROUTE THEN EMBARK ELSE ROUTE;
TROUTE/A3 = IF EMBARK GT ROUTE THEN EMBARK ELSE ROUTE;
MADIRX/A13 = '-'||TEMBARK||TROUTE||'/'||AIRLINE|'*'||CL_CAT;
MADIRXA/A13 = TEMBARK||TROUTE||'/'||AIRLINE|'*'||CL_CAT;
END
-RUN

TABLE FILE SRHOLD1
PRINT AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN

TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRX AS 'MANONX'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONX
DATA ON TTEMP2
END
-RUN


-* FIELD 3 = CDIR_ALL

JOIN CLEAR *
-RUN

JOIN EMBARK IN SRHOLD1 TO EMBARK IN EMBARPT AS J1
JOIN ROUTE IN SRHOLD1 TO ROUTE IN RTEARPT AS J2
END

DEFINE FILE SRHOLD1
MADIRX/A13= '-'||EMB_CITY||RTE_CITY||'/'||AIRLINE|'*'||CL_CAT;
MADIRXA/A13 = EMB_CITY||RTE_CITY||'/'||AIRLINE||'*'||CL_CAT;
END
-RUN

TABLE FILE SRHOLD1
PRINT AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN


MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN

TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRX AS 'MCDIRX'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRX
DATA ON TTEMP2
END
-RUN

-* FIELD 4 = CNON_ALL

DEFINE FILE SRHOLD1
TEMBARK/A3 = IF EMB_CITY LT RTE_CITY
THEN EMB_CITY ELSE RTE_CITY;
TROUTE/A3 = IF EMB_CITY GT RTE_CITY
THEN EMB_CITY ELSE RTE_CITY;
MADIRX/A13 = '-'||TEMBARK||TROUTE||'/'||AIRLINE||'*'||CL_CAT;
MADIRXA/A13 = TEMBARK||TROUTE||'/'||AIRLINE||'*'||CL_CAT;
END
-RUN

TABLE FILE SRHOLD1
PRINT AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE SRHOLD1
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN

TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRX AS 'MCNONX'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONX
DATA ON TTEMP2
END
-RUN

-SET &&SMD = 'M';

EX AIRXUSREFQ
-RUN

-* Fields Produced using MR_50

TABLE FILE MR_50 
SUM AIR_KEY
BY AIR_KEY
WHERE RF_FLAG EQ ' '
WHERE SEG_COUNT GT 0
ON TABLE HOLD AS MHLD1
END
-RUN

TABLE FILE MR_50
SUM AIR_KEY
BY AIR_KEY
WHERE RF_FLAG NE ' '
WHERE SEG_COUNT LT 0
ON TABLE HOLD AS MHLD2
END
-RUN


MATCH FILE MHLD1
SUM AIR_KEY
BY AIR_KEY
ON TABLE HOLD
RUN
FILE MHLD2
SUM AIR_KEY
BY AIR_KEY
AFTER MATCH HOLD AS MHLD3 OLD-AND-NEW
END
-RUN

TABLE FILE MR_50
PRINT EMBARK ROUTE CL_CAT AIRLINE SEG_NBR RF_FLAG
BY AIR_KEY
ON TABLE HOLD AS MRHOLD
END
-RUN

MATCH FILE MRHOLD
PRINT EMBARK ROUTE CL_CAT AIRLINE SEG_NBR RF_FLAG
BY AIR_KEY
ON TABLE HOLD
RUN 
FILE MHLD3
SUM AIR_KEY
BY AIR_KEY
AFTER MATCH HOLD AS MRHOLD1 OLD-AND-NEW
END
-RUN

-* FIELD 5 - ADIR_STP

DEFINE FILE MRHOLD1
MADIRX/A13 = '-'||EMBARK||ROUTE||'/'||AIRLINE;
MADIRXA/A13 = EMBARK||ROUTE||'/'||AIRLINE;
END
-RUN

TABLE FILE MRHOLD1
SUM AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
IF RF_FLAG EQ ' '
ON TABLE HOLD AS MRHOLD2
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN


TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

DEFINE FILE TTEMP1
MADIRXA1/A1 = SUBSTR (208, MADIRX, 1, 2, 1, MADIRXA1);
MADIRXX/A208 = SUBSTR(208, MADIRX, 2, 208, 208, MADIRXX);
MADIRXA/A208 = IF MADIRXA1 EQ '-' THEN MADIRXX ELSE MADIRX;
END

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRXA AS 'MADIRO'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN


MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MADIRO
DATA ON TTEMP2
END
-RUN


-* FIELD 6 = ANON_STP

DEFINE FILE MRHOLD1
TEMBARK/A3 = IF EMBARK LT ROUTE THEN EMBARK ELSE ROUTE;
TROUTE/A3 = IF EMBARK GT ROUTE THEN EMBARK ELSE ROUTE;
MADIRX/A13 = '-'||TEMBARK||TROUTE||'/'||AIRLINE;
MADIRXA/A13 = TEMBARK||TROUTE||'/'||AIRLINE;
END
-RUN

TABLE FILE MRHOLD1
PRINT AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
IF RF_FLAG EQ ' '
ON TABLE HOLD AS MRHOLD2
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN


MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN

TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

DEFINE FILE TTEMP1
MADIRXA1/A1 = SUBSTR (208, MADIRX, 1, 2, 1, MADIRXA1);
MADIRXX/A208 = SUBSTR(208, MADIRX, 2, 208, 208, MADIRXX);
MADIRXA/A208 = IF MADIRXA1 EQ '-' THEN MADIRXX ELSE MADIRX;
END

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRXA AS 'MANONO'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN


MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MANONO
DATA ON TTEMP2
END
-RUN

-JOY1

-* FIELD 7 - CDIR_STP
JOIN CLEAR *
-RUN
JOIN EMBARK IN MRHOLD1 TO EMBARK IN EMBARPT AS J3
JOIN ROUTE IN MRHOLD1 TO ROUTE IN RTEARPT AS J4
END

DEFINE FILE MRHOLD1
MADIRX/A13 = '-'||EMB_CITY||RTE_CITY||'/'||AIRLINE;
MADIRXA/A13 = EMB_CITY||RTE_CITY||'/'||AIRLINE;
END
-RUN

TABLE FILE MRHOLD1
PRINT AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
IF RF_FLAG EQ ' '
ON TABLE HOLD AS MRHOLD2
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN


MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN

TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

DEFINE FILE TTEMP1
MADIRXA1/A1 = SUBSTR (208, MADIRX, 1, 2, 1, MADIRXA1);
MADIRXX/A208 = SUBSTR(208, MADIRX, 2, 208, 208, MADIRXX);
MADIRXA/A208 = IF MADIRXA1 EQ '-' THEN MADIRXX ELSE MADIRX;
END

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRXA AS 'MCDIRO'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCDIRO
DATA ON TTEMP2
END
-RUN

-* FIELD 8 = CNON_STP

DEFINE FILE MRHOLD1
TEMBARK/A3 = IF EMB_CITY LT RTE_CITY THEN EMB_CITY ELSE RTE_CITY;
TROUTE/A3 = IF EMB_CITY GT RTE_CITY THEN EMB_CITY ELSE RTE_CITY;
MADIRX/A13 = '-'||TEMBARK||TROUTE||'/'||AIRLINE;
MADIRXA/A13 = TEMBARK||TROUTE||'/'||AIRLINE;
END
-RUN

TABLE FILE MRHOLD1
PRINT AIR_KEY SEG_NBR MADIRX MADIRXA
BY AIR_KEY NOPRINT
BY SEG_NBR NOPRINT
IF RF_FLAG EQ ' '
ON TABLE HOLD AS MRHOLD2
END
-RUN

CREATE FILE TTEMP
END
-RUN

-* SEGMENT 1

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRXA AS 'MADIRX1'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX1
DATA ON HOLD1
END
-RUN

-* SEGMENT 2

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX2'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX2
DATA ON HOLD2
END
-RUN


-* SEGMENT 3

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX3'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX3
DATA ON HOLD3
END
-RUN

-* SEGMENT 4

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX4'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD4
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX4
DATA ON HOLD4
END
-RUN

-* SEGMENT 5

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX5'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD5
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX5
DATA ON HOLD5
END
-RUN

-* SEGMENT 6

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX6'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD6
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX6
DATA ON HOLD6
END
-RUN

-* SEGMENT 7

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX7'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '07'
ON TABLE HOLD AS HOLD7
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD7
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX7
DATA ON HOLD7
END
-RUN

-* SEGMENT 8

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX8'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '08'
ON TABLE HOLD AS HOLD8
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD8
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX8
DATA ON HOLD8
END
-RUN

-* SEGMENT 9

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX9'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '09'
ON TABLE HOLD AS HOLD9
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD9
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX9
DATA ON HOLD9
END
-RUN

-* SEGMENT 10

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX10'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '10'
ON TABLE HOLD AS HOLD10
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD10
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX10
DATA ON HOLD10
END
-RUN

-* SEGMENT 11

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX11'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '11'
ON TABLE HOLD AS HOLD11
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD11
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX11
DATA ON HOLD11
END
-RUN

-* SEGMENT 12

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX12'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '12'
ON TABLE HOLD AS HOLD12
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD12
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX12
DATA ON HOLD12
END
-RUN

-* SEGMENT 13

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX13'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '13'
ON TABLE HOLD AS HOLD13
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD13
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX13
DATA ON HOLD13
END
-RUN

-* SEGMENT 14

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX14'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '14'
ON TABLE HOLD AS HOLD14
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD14
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX14
DATA ON HOLD14
END
-RUN

-* SEGMENT 15

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX15'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '15'
ON TABLE HOLD AS HOLD15
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD15
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX15
DATA ON HOLD15
END
-RUN

-* SEGMENT 16

TABLE FILE MRHOLD2
PRINT AIR_KEY MADIRX AS 'MADIRX16'
BY AIR_KEY NOPRINT
IF SEG_NBR EQ '16'
ON TABLE HOLD AS HOLD16
END
-RUN

MODIFY FILE TTEMP
LOG NOMATCH MSG OFF
FIXFORM FROM HOLD16
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE MADIRX16
DATA ON HOLD16
END
-RUN

TABLE FILE TTEMP
PRINT AIR_KEY AND COMPUTE
MADIRX/A208 = MADIRX1||MADIRX2||MADIRX3||MADIRX4||MADIRX5||MADIRX6||
MADIRX7||MADIRX8||MADIRX9||MADIRX10||MADIRX11||MADIRX12||MADIRX13||
MADIRX14||MADIRX15||MADIRX16;
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP1
END
-RUN

DEFINE FILE TTEMP1
MADIRXA1/A1 = SUBSTR (208, MADIRX, 1, 2, 1, MADIRXA1);
MADIRXX/A208 = SUBSTR(208, MADIRX, 2, 208, 208, MADIRXX);
MADIRXA/A208 = IF MADIRXA1 EQ '-' THEN MADIRXX ELSE MADIRX;
END

TABLE FILE TTEMP1
PRINT AIR_KEY MADIRXA AS 'MCNONO'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME1
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME2
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME3
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME4
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME5
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME6
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME7
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME8
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME9
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAME0
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEY
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

MODIFY FILE &&FOCTNAMEZ
LOG NOMATCH MSG OFF
FIXFORM FROM TTEMP2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE MCNONO
DATA ON TTEMP2
END
-RUN

SET ASNAMES=ON
DEFINE FILE ROLLUP
XL01/A1 = 'Z';
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP AS 'ROLLUP_CODE'
      XL01   AS 'PR_STAMP'
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE HOLD
END
MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-GOTO TOP
-RUN
-*======================================================================
-STOP

-XFER
-TYPE PROGRAM COMPLETED.......
-EXIT

