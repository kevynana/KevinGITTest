-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File HVIEW3SM.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM 
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*08/05/02   STEVE/DEB          CHANGED HTL_NAME TO "ALL OTHER" FROM " "
-*08/05/03   DEB                ADDED PCTTAMT
-*11/11/03   jk                 Commented out the drilldown detail style
-*                              to run a report for Metx/put back in
-*3/18/04    DEB                ADDED HARDCODED FOOTERS TO ABTOPHTL
-*3/31/04    DEB                CHANGED TO SUM DEFINE BOOKINGS FIELD
-*                              INSTEAD OF CNT.NUM_DAYS AS 'BOOKINGS'
-*01/30/06   DEB                ADDED FLAG AND FLAGN DEFINE IN ORDER TO 
-*                              SUBTOTAL RANKED HOTELS
-*10/5/06    DEB                ADDED SORT BY PROP_CODE
-*12/22/11   GSE                Removed parens from around CLIMIT in
-*                              DEFINEs for 7.7.03
-*3/14/13    DEB                CARRIED THROUGH NBR_DAYS SO THE AVG STAY
-*                              COULD BE CHANGED IN SETFILE TO USE THIS FIELD
-*                              INSTEAD OF NNROOMS - 
-*2/20/19    JOY                CARRIED THROUGH FIELDS FOR TAT SAVINGS
-*1/21/14    JOY                HARD CODED LIMITS FOR ABTPHTAT PER LAURA
-*3/11/14    Joy                Worked with Hotel Names not being combined
-*3/19/14    Joy                Carried through Pref_Non
-*4/23/14    Joy                Updated sorts for Preferred/Non-Preferred
-*6/6/14     DEB                ADDED ABTOPHTC TO SKIP SORT BY PREF_NON
-*7/31/14     DEB               ADDED VXTOPHTL VXTOPHTC TO SKIP SORT BY PREF_NON
-*9/18/14    Joy                ADDED KOTPHTL TO GOTO TO SKIP AROUND PREF_NON SORT
-*10/8/14    joy                ADDED HTL_CLIENT_PREF
-*10/25/14 Updated to carry through HTL_PREF_SHT_DESC - JK
-*10/31/14 Tested with hold files for ABTOPHTL - JK
-*10/31/14 Updated to skip around HTL_PREF_SHT_DESC SORT IF NOT ABTPHTAT - jk
-*11/25/14 - Carried through GEO_ZONE so it could be added to VXTOPHTC - DEB
-*1/30/15 -  DEB               S-07138 CHANGED CGTPHTL TO SKIP SORT BY PREF_NON
-* 04/21/2015 - DEB -S-08013 - ADDED DEFINE FOR ABTPHTAT CHANGED WHERE CLAUSE ON 
-*                             FINAL REPORT IN ORDER TO BALANCE TO T_SVGS ON TCVASAVE
-*10/11/16-JEM-S-25670-CHANGED DSTOPHTL TO SKIP SORT BY PREF_NON
-*10/14/16 - DLV - S-25922 - Changed where clause so ABTPHTAT would be only report to
-*                           use sort by PREF_NON due to multiple reports not drilling
-*                           correctly
-*10/18/16-JEM-S-26030-Added Lanyon_id into kwtophh hold files to correct error
-*03/13/17 - DLV - S-22486 - updated ettek Review to Post-trip Reporting
-*08/21/17 - DLV - D-01611 - Added VXTOPHTC TO ABTOPHTL footer routine
-*08/24/17 - DLV - S-38843 - Carried through TRAN_MY for VXTOPHTM
-*                           added code for hard coded footers for this report
-*                           added HHRNKVAL define for KWTOPHH 
-**********************************************************************
 

SET ASNAMES=ON
-RUN
-IF '&&SETF.EVAL' EQ 'MXTOP50H' GOTO MXSET;
-SET &&CTY_LMT = &&RANK_LIMIT;
-SET &&HTL_LMT = &&RANK_LIMIT2;
-SET &&RANK_METH = IF &&RANK_METH EQ 'ROOM_AMT' THEN 'ROOM_AMT'
- ELSE IF &&RANK_METH EQ 'NMBR_DAYS' THEN 'NMBR_DAYS' 
- ELSE 'NMBR_DAYS';
-RUN
-GOTO DNESET;


-MXSET;
-SET &&RANK_LIMIT=50;
-SET &&RANK_LIMIT2=50;
-SET &&CTY_LMT = &&RANK_LIMIT;
-SET &&HTL_LMT = &&RANK_LIMIT2;
-SET &&RANK_METH = IF &&RANK_METH EQ 'ROOM_AMT' THEN 'ROOM_AMT'
- ELSE IF &&RANK_METH EQ 'NMBR_DAYS' THEN 'NMBR_DAYS' 
- ELSE 'NMBR_DAYS';


-DNESET;
-IF &&SETF EQ 'HDTOPH' THEN GOTO HDTOPH ELSE GOTO NEXT;
 

-HDTOPH
TABLE FILE &&RPT_HOLD
SUM BOOKINGS
    NBR_DAYS AS 'NUMDYS'
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMS/D8 AS 'NMBR_DAYS'	
    REFUSE_CD	
    RESV_BRANCH	
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	
    PROP_CODE
    PREF_NON
    TAT_SAV
    GEO_ZONE
    TRAN_MY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_NAME
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
BY CHAIN_CODE
BY REFUSE_CD NOPRINT
-* New Property Master fields
BY PROP_LANYON_ID
BY PROP_LATITUDE
BY PROP_LONGITUDE
BY PROP_MOBIL_STARS
BY PROP_AAA_DIAMONDS
BY PROP_OHG_CLASS
BY SCALE_DESC
BY HTL_PREF_SHT_DESC  
ON TABLE HOLD AS HOLD1
END
-RUN




-GOTO NXTHLD;

-NEXT


-IF &&SETF EQ 'MXTOP50H' THEN GOTO MXTOP;

TABLE FILE &&RPT_HOLD
SUM BOOKINGS
    NBR_DAYS AS 'NUMDYS'
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMS/D8 AS 'NMBR_DAYS'	
    REFUSE_CD	
    RESV_BRANCH	
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	
    PROP_CODE
    TAT_SAV
    PREF_NON
    HTL_PREF_SHT_DESC  
    GEO_ZONE
    TRAN_MY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
-*-IF &&SETF EQ 'ABTOPHTL' OR 'ABTOPHTC' OR 'KOTPHTL' OR 'VXTOPHTL' OR 'VXTOPHTC' OR 'CGTPHTL' OR 'CHTOPHTC' OR 'DSTOPHTL' GOTO NOPREF;
-IF &&SETF NE 'ABTPHTAT' THEN GOTO NOPREF;
BY PREF_NON
-NOPREF;
BY CHAIN_NAME
BY CHAIN_CODE
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
-IF &&SETF NE 'ABTPHTAT' GOTO NODESCBY;
BY HTL_PREF_SHT_DESC 
-NODESCBY;
-* New Property Master fields
BY PROP_LANYON_ID
BY PROP_LATITUDE
BY PROP_LONGITUDE
BY PROP_MOBIL_STARS
BY PROP_AAA_DIAMONDS
BY PROP_OHG_CLASS
BY SCALE_DESC
-IF '&&SETF.EVAL' NE 'VXTOPHTM' THEN GOTO NOtrnSORT;
BY TRAN_MY
-NOtrnSORT;
ON TABLE HOLD AS HOLD1
END
-RUN
 




-GOTO Nextone;

-MXTOP


TABLE FILE &&RPT_HOLD
SUM BOOKINGS
    NBR_DAYS AS 'NUMDYS'
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMS/D8 AS 'NMBR_DAYS'	
    REFUSE_CD	
    RESV_BRANCH	
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	
    PREF_NON
    TAT_SAV
    GEO_ZONE
    TRAN_MY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_NAME
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
BY CHAIN_CODE
BY PROP_CODE
-* New Property Master fields
BY PROP_LANYON_ID
BY PROP_LATITUDE
BY PROP_LONGITUDE
BY PROP_MOBIL_STARS
BY PROP_AAA_DIAMONDS
BY PROP_OHG_CLASS
BY SCALE_DESC
BY HTL_PREF_SHT_DESC 
ON TABLE HOLD AS HOLD1
END
-RUN

-Nextone
-NXTHLD;
TABLE FILE HOLD1
PRINT 
  BOOKINGS	
  CHAIN_CODE	
  CHAIN_NAME	
  HOTEL_PHONE	
  HTL_PREF_SHT_DESC 
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUMDYS
  PREF_NON
  PROP_ADDRESS	
  PROP_CODE
  PROP_NAME	
  PROP_ZIP5	
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT/D12.2	
  SAVINGS
  TOTAL_STD	
  TOTAL_SLSAV
-* New Property Master fields
  PROP_LANYON_ID
  PROP_LATITUDE
  PROP_LONGITUDE
  PROP_MOBIL_STARS
  PROP_AAA_DIAMONDS
  PROP_OHG_CLASS  
  SCALE_DESC
  PREF_NON
  TAT_SAV
  GEO_ZONE
  TRAN_MY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
-* RANKED BY HIGHEST NMBR_DAYS NOPRINT
RANKED BY HIGHEST &&RANK_METH NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN


DEFINE FILE HOLD2
 RANK_LIMIT/I5 = &&HTL_LMT;
 DRANK/D5      = RANK;
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5=EDIT(ARANKX,'$99999');
 RANK_VALUE/A5 = IF (RANK_LIMIT EQ 0) THEN ARANK ELSE
                 IF RANK GT RANK_LIMIT THEN 'OTHER' ELSE ARANK;
                 
END
-RUN

TABLE FILE HOLD2
SUM 
  BOOKINGS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NMBR_DAYS	
  NNROOMS
  NUMDYS
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT	
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
  TAT_SAV  
  PREF_NON
  HTL_PREF_SHT_DESC
  GEO_ZONE
  TRAN_MY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY CHAIN_NAME
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY HOTEL_PHONE
-IF &&SETF NE 'ABTPHTAT' GOTO NODESCBY1;
BY HTL_PREF_SHT_DESC 
-NODESCBY1;
BY CHAIN_CODE
BY PROP_CODE
-* New Property Master fields
BY PROP_LANYON_ID
BY PROP_LATITUDE
BY PROP_LONGITUDE
BY PROP_MOBIL_STARS
BY PROP_AAA_DIAMONDS
BY PROP_OHG_CLASS
BY SCALE_DESC
-IF '&&SETF.EVAL' NE 'VXTOPHTM' THEN GOTO NOtrnSORT2;
BY TRAN_MY
-NOtrnSORT2;
ON TABLE HOLD AS HOLD3
END
-RUN
 

-IF '&&SETF.EVAL' NE 'KWTOPHH' GOTO NOSTOP;


DEFINE FILE HOLD3 
 HH_FLAG/A1 = IF CHAIN_CODE EQ 'HH' OR 'HL' OR 'HX' OR 'HG' OR 'CN' OR 'DT' OR 'ES' OR 'GI' OR 'WA' THEN 'Y' ELSE 'N';
 RANK_VAL/A5 = IF HH_FLAG EQ 'Y' THEN RANK_VALUE ELSE 'OTHER'; 	
 HTL_NAME/A30 = IF RANK_VALUE LE '&&HTL_LMT' AND HH_FLAG EQ 'Y' THEN PROP_NAME ELSE 'ALL OTHER';
-************************IBI KR 
  CHAIN_CD/A2= IF RANK_VAL EQ 'OTHER'	THEN ' ' ELSE CHAIN_CODE;
  CHAIN_NM/A35= IF RANK_VAL EQ 'OTHER' THEN ' ' ELSE CHAIN_NAME;	
  HTL_ADDRESS/A35= IF RANK_VAL EQ 'OTHER' THEN ' ' ELSE PROP_ADDRESS;
  PROP_PHONE/A15= IF RANK_VAL EQ 'OTHER'  THEN ' ' ELSE HOTEL_PHONE;
  PROP_C/A7 = IF RANK_VAL EQ 'OTHER' THEN ' ' ELSE PROP_CODE;
  ZIP5/A5 = IF RANK_VAL EQ 'OTHER' THEN ' ' ELSE PROP_ZIP5;
  GEOZ/A3 = IF RANK_VAL NE 'OTHER' THEN GEO_ZONE ELSE ' ' ;
PREF_N1/A15 = IF RANK_VALUE NE 'OTHER' THEN PREF_NON ELSE ' ';
TRNMY/MYY = IF RANK_VAL NE 'OTHER' THEN TRAN_MY ELSE ' ';  
END
-RUN


TABLE FILE HOLD3
SUM 
  BOOKINGS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUMDYS
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  TAT_SAV
  PREF_N1
  GEOZ
  PROP_LANYON_ID AS 'LANYON_ID'
  PROP_LATITUDE AS 'PROP_LAT'
  PROP_LONGITUDE AS 'PROP_LON'
  PROP_MOBIL_STARS AS 'MOBILE_STARS'
  PROP_AAA_DIAMONDS AS 'AAA_DIAMONDS'
  PROP_OHG_CLASS AS 'OHG_CLASS'
  SCALE_DESC AS 'SCALED'
  TRNMY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VAL
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY HTL_PREF_SHT_DESC  
BY CHAIN_CD
BY CHAIN_NM
BY PROP_C
ON TABLE HOLD AS HOLD4
END



-GOTO KWCONT;




-NOSTOP
DEFINE FILE HOLD3  
-*   CHAIN_CD/A2= IF RANK_VALUE LE '&&HTL_LMT' THEN CHAIN_CODE ELSE ' ';
CHAIN_CD/A2 = IF RANK_VALUE NE 'OTHER' THEN CHAIN_CODE ELSE ' ';
-*   CHAIN_NM/A35= IF RANK_VALUE LE '&&HTL_LMT' THEN CHAIN_NAME ELSE ' ';	
CHAIN_NM/A35 = IF RANK_VALUE NE 'OTHER' THEN CHAIN_NAME ELSE ' ';
-*  HTL_ADDRESS/A35= IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_ADDRESS ELSE ' ';
HTL_ADDRESS/A35 = IF RANK_VALUE NE 'OTHER' THEN PROP_ADDRESS ELSE ' ';
-* HTL_NAME/A35 = IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_NAME ELSE ' ';
 -* HTL_NAME/A35 = IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_NAME ELSE 'ALL OTHER';
-* HTL_NAME/A30= IF RANK_VALUE NE 'OTHER' THEN PROP_NAME ELSE 'ALL OTHER';
HTL_NAME/A30 = IF RANK_VALUE NE 'OTHER' THEN PROP_NAME ELSE 'OTHER';

 HH_NAME/A30 = IF RANK_VALUE LE '&&HTL_LMT' AND CHAIN_CODE EQ 'HH' THEN PROP_NAME ELSE 'ALL OTHER';
-************************IBI KR 
-*PROP_PHONE/A14= IF RANK_VALUE LE '&&HTL_LMT' THEN HOTEL_PHONE ELSE ' ';	
-*  PROP_PHONE/A15= IF RANK_VALUE LE '&&HTL_LMT' THEN HOTEL_PHONE ELSE ' ';
PROP_PHONE/A15 = IF RANK_VALUE NE 'OTHER' THEN HOTEL_PHONE ELSE ' ';
-*   PROP_C/A7 = IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_CODE ELSE ' ';
PROP_C/A7 = IF RANK_VALUE NE 'OTHER' THEN PROP_CODE ELSE ' ';  
-*   ZIP5/A5 = IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_ZIP5 ELSE ' ';	
ZIP5/A5 = IF RANK_VALUE NE 'OTHER' THEN PROP_ZIP5 ELSE ' ';
-* New Property Master fields
LANYON_ID/A15 = IF RANK_VALUE NE 'OTHER' THEN PROP_LANYON_ID ELSE ' ';
PROP_LAT/D13.8CS = IF RANK_VALUE NE 'OTHER' THEN PROP_LATITUDE ELSE 0;
PROP_LON/D13.8CS = IF RANK_VALUE NE 'OTHER' THEN PROP_LONGITUDE ELSE 0;
MOBILE_STARS/I5 = IF RANK_VALUE NE 'OTHER' THEN PROP_MOBIL_STARS ELSE 0;
AAA_DIAMONDS/I5 = IF RANK_VALUE NE 'OTHER' THEN PROP_AAA_DIAMONDS ELSE 0;
OHG_CLASS/A5 = IF RANK_VALUE NE 'OTHER' THEN PROP_OHG_CLASS ELSE ' ';
SCALED/A20 = IF RANK_VALUE NE 'OTHER' THEN SCALE_DESC ELSE ' ';
PREF_N1/A15 = IF RANK_VALUE NE 'OTHER' THEN PREF_NON ELSE ' ';
-* HCP/A1 = IF RANK_VALUE NE 'OTHER' THEN HTL_CLIENT_PREF ELSE ' ';
GEOZ/A3 = IF RANK_VAL NE 'OTHER' THEN GEO_ZONE ELSE ' ' ;
TRNMY/MYY = IF RANK_VAL NE 'OTHER' THEN TRAN_MY ELSE ' ';
END
-RUN



TABLE FILE HOLD3
SUM
  BOOKINGS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUMDYS
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  TAT_SAV
  PREF_N1
  HTL_PREF_SHT_DESC
  GEOZ
  TRNMY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY HH_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
-IF &&SETF NE 'ABTPHTAT' GOTO NODESCBY2;
BY HTL_PREF_SHT_DESC 
-NODESCBY2;
BY CHAIN_CD
BY CHAIN_NM
BY PROP_C
BY LANYON_ID
BY PROP_LAT
BY PROP_LON
BY MOBILE_STARS
BY AAA_DIAMONDS
BY OHG_CLASS
BY SCALED
-IF '&&SETF.EVAL' NE 'VXTOPHTM' THEN GOTO NOtrnSORT3;
BY TRNMY
-NOtrnSORT3;
ON TABLE HOLD AS HOLD4
END
-RUN



-KWCONT;


TABLE FILE HOLD1
SUM 
  BOOKINGS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUMDYS
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT	
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
  TAT_SAV
  PREF_NON
  TRAN_MY
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
ON TABLE HOLD AS RHOLD1
END
-RUN


TABLE FILE RHOLD1
PRINT *
-* RANKED BY HIGHEST NMBR_DAYS AS 'DAYS_RANK'
RANKED BY HIGHEST &&RANK_METH AS 'DAYS_RANK'
ON TABLE HOLD AS RHOLD2
END
-RUN




MATCH FILE HOLD4
PRINT *
BY CITY_ST
ON TABLE HOLD
RUN
FILE RHOLD2
SUM DAYS_RANK
BY CITY_ST
AFTER MATCH HOLD AS HOLD5 OLD-OR-NEW
END
-RUN

TABLE FILE HOLD5
PRINT *
RANKED BY HIGHEST DAYS_RANK
ON TABLE HOLD AS HOLD6
END
-RUN


DEFINE FILE HOLD6
  CTY_LIMIT/I2 = &&CTY_LMT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6= EDIT(FRANKX,'$999999');
  CTY_VALUE/A9 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                 IF RANK GT CTY_LIMIT THEN 'ALL OTHER' ELSE BRANK;
-*                  IF CITY_ST EQ ' ' THEN 'ALL OTHER' ELSE BRANK;
  FLAG/A9 = IF CTY_VALUE EQ 'ALL OTHER' THEN 'ALL OTHER' ELSE 'A'; 
 END
-RUN

TABLE FILE HOLD6
PRINT
  BOOKINGS	
  CLIMIT
  CITY_ST	
  CTY_LIMIT	
  DAYS_RANK 	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NUMDYS
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  FLAG
  TAT_SAV
  PREF_N1
  HTL_PREF_SHT_DESC
  TRNMY
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY CHAIN_CD
BY CHAIN_NM
BY RANK_VAL AS 'RANK_VALUE'
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
-IF &&SETF NE 'ABTPHTAT' GOTO NODESCBY3;
BY HTL_PREF_SHT_DESC 
-NODESCBY3;
BY PROP_C
BY LANYON_ID
BY PROP_LAT
BY PROP_LON
BY MOBILE_STARS
BY AAA_DIAMONDS
BY OHG_CLASS
BY SCALED
ON TABLE HOLD AS HOLD7
END
-RUN



TABLE FILE &&RPT_HOLD
SUM NNROOMS/D8 AS 'CTLDAYS'
    NEW_TOTAL_AMT AS 'CTLAMT'
    GEO_ZONE 
BY CITY_ST
ON TABLE HOLD AS HOLD8
END
-RUN

MATCH FILE HOLD7
PRINT 
  BOOKINGS	
  CLIMIT	
  CTY_LIMIT	
  DAYS_RANK 
  FLAG
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS	
  NUMDYS
  REFUSE_CD	
  RESV_BRANCH	
  ROOM_AMT	
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  CTY_VALUE
  PROP_C
  PROP_CITY
  PROP_STATE_CD
  CHAIN_CD
  CHAIN_NM
  RANK_VALUE
  HTL_NAME
  ZIP5
  HTL_ADDRESS
  PROP_PHONE
  LANYON_ID
  PROP_LAT
  PROP_LON
  MOBILE_STARS
  AAA_DIAMONDS
  OHG_CLASS  
  SCALED
  PREF_N1
  TAT_SAV
  HTL_PREF_SHT_DESC 
  TRNMY
BY CITY_ST
ON TABLE HOLD
RUN
FILE HOLD8
SUM CTLDAYS
    CTLAMT
    GEO_ZONE
BY CITY_ST
AFTER MATCH HOLD AS HOLD9 OLD-OR-NEW
END
-RUN



-NOSTP;

-IF '&&SETF.EVAL' EQ 'KWTOPHH' THEN GOTO KIEWHH; 

DEFINE FILE HOLD9
GEOZ/A3 = IF RANK_VAL NE 'OTHER' THEN GEO_ZONE ELSE ' ';
END
TABLE FILE HOLD9
PRINT
   BOOKINGS
   BOOKINGS AS 'BKGS'   
   CTLAMT
   CTLDAYS
   CLIMIT
   CTY_LIMIT
   DAYS_RANK
   FLAG
   NEW_ROOM_RATE
   NEW_STD_RATE
   NEW_TOTAL_AMT
   NMBR_DAYS
   NMBR_DAYS AS 'NDYS'
   NNROOMS
   NUMDYS
   REFUSE_CD
   RESV_BRANCH
   ROOM_AMT
   SAVINGS
   TOTAL_STD
   TOTAL_SLSAV
   TOTAL_SLSAV AS 'TSLV'
   TAT_SAV
   TRNMY
   PREF_N1
   HTL_PREF_SHT_DESC
   GEOZ
COMPUTE PCTTAMT/D8.1S = IF ((CTLAMT LT 1) AND (CTLAMT GT (-1))) THEN 0
                        ELSE ((NEW_TOTAL_AMT/CTLAMT)*100);
     
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
-IF &&SETF NE 'ABTPHTAT' GOTO NODESCBY4;
BY HTL_PREF_SHT_DESC 
-NODESCBY4;
BY CHAIN_CD
BY CHAIN_NM
BY PROP_C
BY LANYON_ID
BY PROP_LAT
BY PROP_LON
BY MOBILE_STARS
BY AAA_DIAMONDS
BY OHG_CLASS
BY SCALED
ON TABLE HOLD AS HOLD10
END
-RUN





-GOTO Finishrpt;
-KIEWHH

DEFINE FILE HOLD9
GEOZ/A3 = IF RANK_VAL NE 'OTHER' THEN GEO_ZONE ELSE '   ';
END
TABLE FILE HOLD9
PRINT
   BOOKINGS
   BOOKINGS AS 'BKGS'   
   CTLAMT
   CTLDAYS
   CLIMIT
   CTY_LIMIT
   DAYS_RANK
   FLAG
   NEW_ROOM_RATE
   NEW_STD_RATE
   NEW_TOTAL_AMT
   NMBR_DAYS
   NMBR_DAYS AS 'NDYS'
   NNROOMS
   NUMDYS
   REFUSE_CD
   RESV_BRANCH
   ROOM_AMT
   SAVINGS
   TOTAL_STD
   TOTAL_SLSAV
   TOTAL_SLSAV AS 'TSLV'
   TAT_SAV
   GEOZ
   TRNMY
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY CHAIN_CD
BY CHAIN_NM
BY PROP_C
ON TABLE HOLD AS HOLD9A  
END
-RUN


TABLE FILE HOLD9A
PRINT
   BOOKINGS
   BKGS  
   CTLAMT
   CTLDAYS
   CLIMIT
   CTY_LIMIT
   DAYS_RANK
   NEW_ROOM_RATE
   NEW_STD_RATE
   NEW_TOTAL_AMT
   NMBR_DAYS
   NDYS
   NNROOMS
   NUMDYS
   REFUSE_CD
   RESV_BRANCH
   ROOM_AMT
   SAVINGS
   TOTAL_STD
   TOTAL_SLSAV
   TSLV
   TRNMY
  CTY_VALUE
  CITY_ST
  PROP_CITY
  PROP_STATE_CD
  RANK_VALUE
  HTL_NAME
  ZIP5
  HTL_ADDRESS
  PROP_PHONE
  CHAIN_CD
  CHAIN_NM
  PROP_C  
  TAT_SAV
  GEOZ
BY FLAG 
ON TABLE HOLD AS HOLDA FORMAT FOCUS INDEX FLAG
END
-RUN 


DEFINE FILE HOLD9
CTY_VALUE/A9 = 'GRAND TTL';
CLIMIT2/A2 = '  ';
CTY_LIMIT/I2 = 0;
CITY_ST/A35 = ' ';
RANK_VALUE/A5 = 'GRAND';
HH_FLAG/A1 = IF CHAIN_CD EQ 'HH' OR 'HL' OR 'HX' OR 'HG' OR 'CN' OR 'DT' OR 'ES' OR 'GI' OR 'WA' THEN 'Y' ELSE 'N';
HTL_NAME/A30 =  IF HH_FLAG EQ 'Y' THEN 'ALL HILTON BRANDS' ELSE 'TOTAL ALL OTHER';
ZIP5/A5 = '';
HTL_ADDRESS/A35 = ' ';
PROP_PHONE/A15 = ' ';
CHAIN_CD2/A2 = ' ';
CHAIN_NM/A35 = ' ';
PROP_C/A7 = ' ';
PROP_CITY/A25 = ' ';
PROP_STATE_CD/A3 = ' ';
FLAG2/A9 = 'C';
REF_CD/A2 = ' ';
CTLDAYS/D8 = 0; 
CTLAMT/D12.2C = 0;
NEW_ROOM_RATE/D12.2C = 0;
NEW_STD_RATE/D12.2C = 0;
DAYS_RANK/D8 = 0;
GEOZ/A3 = '   ';
END
TABLE FILE HOLD9
SUM  BOOKINGS
   BOOKINGS AS 'BKGS'
   CTLAMT
   CTLDAYS
   CLIMIT2 AS 'CLIMIT'
   CTY_LIMIT
   DAYS_RANK
   FLAG2 AS 'FLAG'
   NEW_ROOM_RATE
   NEW_STD_RATE
   NEW_TOTAL_AMT
   NMBR_DAYS
   NMBR_DAYS AS 'NDYS'
   NNROOMS
   NUMDYS
   REF_CD AS 'REFUSE_CD'
   RESV_BRANCH
   ROOM_AMT
   SAVINGS
   TOTAL_STD
   TOTAL_SLSAV
   TOTAL_SLSAV AS 'TSLV'
   TAT_SAV
   GEOZ
   TRNMY
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY CHAIN_CD2 AS 'CHAIN_CD'
BY CHAIN_NM
BY PROP_C

ON TABLE HOLD AS DEBTEST 
END
-RUN

TABLE FILE DEBTEST 
PRINT BOOKINGS
   BKGS   
   CTLAMT
   CTLDAYS
   CLIMIT
   CTY_LIMIT
   DAYS_RANK
   NEW_ROOM_RATE
   NEW_STD_RATE
   NEW_TOTAL_AMT
   NMBR_DAYS
   NDYS
   NNROOMS
   NUMDYS
   REFUSE_CD
   RESV_BRANCH
   ROOM_AMT
   SAVINGS
   TOTAL_STD
   TOTAL_SLSAV
   TSLV 
   TRNMY
  CTY_VALUE
  CITY_ST
  PROP_CITY
  PROP_STATE_CD
  RANK_VALUE
  HTL_NAME
  ZIP5
  HTL_ADDRESS
  PROP_PHONE
  CHAIN_CD
  CHAIN_NM
  PROP_C  
  TAT_SAV
  GEOZ
BY FLAG 
ON TABLE HOLD AS HOLDB FORMAT FOCUS INDEX FLAG
END
-RUN


 


USE CLEAR *
-RUN


-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'HOLDA.FOC';
-SET &HNKB=&HLDPATH || 'HOLDB.FOC';

-RUN

-SET &FILENAME = 'HOLDA'; 
-RUN

-DOS STATE &HNKA
-SET &HOLDFILEA = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKB
-SET &HOLDFILEB = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';


USE ADD 
&HOLDFILEA
&HOLDFILEB 
END
-RUN
 
TABLE FILE HOLDA
PRINT   BOOKINGS
   BKGS
   CTLAMT
   CTLDAYS
   CLIMIT
   CTY_LIMIT
   DAYS_RANK
   FLAG
   NEW_ROOM_RATE
   NEW_STD_RATE
   NEW_TOTAL_AMT
   NMBR_DAYS
   NDYS
   NNROOMS
   NUMDYS
   REFUSE_CD
   RESV_BRANCH
   ROOM_AMT
   SAVINGS
   TOTAL_STD
   TOTAL_SLSAV
   TSLV
   TAT_SAV
   GEOZ
   TRNMY
COMPUTE PCTTAMT/D8.1S = IF ((CTLAMT LT 1) AND (CTLAMT GT (-1))) THEN 0
                        ELSE ((NEW_TOTAL_AMT/CTLAMT)*100);
BY CTY_VALUE
BY CITY_ST
BY PROP_CITY
BY PROP_STATE_CD
BY RANK_VALUE
BY HTL_NAME
BY ZIP5
BY HTL_ADDRESS
BY PROP_PHONE
BY CHAIN_CD
BY CHAIN_NM
BY PROP_C
ON TABLE HOLD AS HOLD10 
END
-RUN



-Finishrpt

-SET &&TOTALR = &&RANK_LIMIT;
 


DEFINE FILE HOLD10

  HTL_NAM1/A20 = SUBSTR(30, HTL_NAME, 1, 20, 20, HTL_NAM1);
  HADDRS/A22 = SUBSTR(35, HTL_ADDRESS, 1, 20, 20, HADDRS);
  ADDRESS/A22 = IF CTY_VALUE LT CLIMIT THEN HADDRS ELSE ' ';	
  ADDRESS2/A18 = EDIT(ADDRESS,'999999999999999999');
  CHAIN_NAME/A35 = IF CTY_VALUE LT CLIMIT THEN CHAIN_NM ELSE ' ';	
  CHAIN_PRNT/A2 = IF CTY_VALUE LT CLIMIT THEN CHAIN_CD ELSE ' ';	
  CITY_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_CITY ELSE ' ';	
  CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';	
  CTY_PRINT2/A22 = EDIT(CTY_PRINT, '9999999999999999999999');
  HH_RANK/A1 = IF RANK_VALUE EQ 'OTHER' THEN 'B' ELSE 
               IF RANK_VALUE EQ 'GRAND' THEN 'C' ELSE 'A';
  HH_FLAG/A15 = IF HH_RANK EQ 'A' THEN 'HILTON BRAND' ELSE 
                IF HH_RANK EQ 'C' THEN 'GRAND TOTAL' ELSE 'ALL OTHER';
  HHRNKVAL/A9 = IF HH_FLAG EQ 'HILTON BRAND' THEN RANK_VALUE ELSE
                IF HH_FLAG EQ 'GRAND' THEN 'GRAND' ELSE 'ALL OTHER';                
 CTY_PRINT3/A18 = IF RANK_VALUE EQ 'GRAND' THEN EDIT(CITY_ST, '999999999999999999') ELSE
                  EDIT(CTY_PRINT, '999999999999999999');
             
-************************IBI KR  
-* HTL_PHONE/A14 = IF CTY_VALUE LT CLIMIT THEN PROP_PHONE ELSE ' ';	
  HTL_PHONE/A15 = IF CTY_VALUE LT CLIMIT THEN PROP_PHONE ELSE ' ';	
-*  HTL_PRINT/A30 = IF CTY_VALUE EQ 'GRAND TTL' THEN HTL_NAME ELSE
-*                  IF CTY_VALUE LT CLIMIT THEN HTL_NAME ELSE ' ';
 HTL_PRINT/A30 = IF CTY_VALUE LT CLIMIT THEN HTL_NAME ELSE ' ';

  HTL_PRINT1/A20 = IF CTY_VALUE LT CLIMIT THEN HTL_NAM1 ELSE ' ';	
  HTL_RANK/A5 = IF CTY_VALUE LT CLIMIT THEN RANK_VALUE ELSE ' ';
  HTL_RANK1/A5 = IF CTY_VALUE LT CLIMIT AND RANK_VALUE NE 'OTHER' THEN RANK_VALUE ELSE ' ';
  STATE_PRNT/A35 = IF CTY_VALUE LT CLIMIT THEN PROP_STATE_CD ELSE ' ';	
  ZIP_PRINT/A5 = IF CTY_VALUE LT CLIMIT THEN ZIP5 ELSE ' ';	
  FLAGN/A9 = IF FLAG EQ 'A' THEN ':' ELSE FLAG;      
  PROP_CD/A7 = IF CTY_VALUE LT CLIMIT THEN PROP_C ELSE ' ';
-IF '&&SETF.EVAL' EQ 'KWTOPHH' THEN GO TO DefineEnd;
  PREF_N/A15 = IF CTY_VALUE LT CLIMIT THEN PREF_N1 ELSE ' ';
  LID_P/A15 = IF CTY_VALUE LT CLIMIT THEN LANYON_ID ELSE ' ';
  LAT_P/D13.8CS = IF CTY_VALUE LT CLIMIT THEN PROP_LAT ELSE 0;
  LON_P/D13.8CS = IF CTY_VALUE LT CLIMIT THEN PROP_LON ELSE 0;
  MOS_P/I5 = IF CTY_VALUE LT CLIMIT THEN MOBILE_STARS ELSE 0;
  AAA_P/I5 = IF CTY_VALUE LT CLIMIT THEN MOBILE_STARS ELSE 0;
  OHG_P/A5 = IF CTY_VALUE LT CLIMIT THEN OHG_CLASS ELSE ' ';
  SCALE_D/A20 = IF CTY_VALUE LT CLIMIT THEN SCALED ELSE ' ';

  GEOZ2/A3 = IF CTY_VALUE LT CLIMIT THEN GEOZ ELSE  ' ';
-IF '&&SETF.EVAL' NE 'ABTPHTAT' THEN GOTO DefineEnd;
TAT_FLAG/A1 = IF NMBR_DAYS EQ 0 AND ROOM_AMT EQ 0 AND BOOKINGS EQ 0 AND TAT_SAV EQ 0 THEN 'Y' ELSE 'N';
 
-DefineEnd;
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH CTY_VALUE = HHMMSS (NOWTOD);	
END

 

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN
 
 

TABLE FILE HOLD10
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
   
 
-IF '&&SETF.EVAL' NE 'ABTPHTAT' GOTO NOTATWHR;
-*WHERE ROOM_AMT NE 0

WHERE TAT_FLAG EQ 'N'
-NOTATWHR;


-*
-IF &&SETF EQ 'ABTOPHTL' OR 'KOTPHTL' OR 'VXTOPHTL' OR 'ABTOPHTC' OR 'SELTPHTC' OR 'CHTOPHTC' OR 'DSTOPHTL' 
-          OR 'VXTOPHTC' OR 'VXTOPHTM' THEN GOTO ABTOPHTL;
-IF &&SETF EQ  'ABTPHTAT' THEN GOTO TPHTAT;

-INCLUDE FOOTERSM
-GOTO OTHER1

-ABTOPHTL

-SET &FTR_AddlLines = 4;
FOOTING BOTTOM
"&&FOOTER1"
"SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"STANDARD DAILY RATE MINUS DAILY RATE"
"MULTIPLIED BY NUMBER OF ROOM NIGHTS"
-INCLUDE FOOTERSM


-GOTO OTHER1

-TPHTAT;
-SET &FTR_AddlLines = 4;

FOOTING BOTTOM
"&&FOOTER1"
"SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"TAT UDID AMOUNT - BOOKED RATE "
"MULTIPLIED BY NUMBER OF ROOM NIGHTS AND ROOMS"
-INCLUDE FOOTERSM

-OTHER1

-*
-*ON TABLE SET STYLE &&SMSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 

ON TABLE SET STYLE *

 

-INCLUDE &&PASTYS

 
 
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&SETF EQ 'MXTOP50H' AND &&UNAME EQ 'cindyw' OR 'cpereira' GOTO SKIP_DRILL;
-IF &&SETF EQ 'VXTOPHTM' THEN GOTO SKIP_DRILL;
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
-*
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-*

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
