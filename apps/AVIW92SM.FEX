-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File SMRYRPT.FEX 
-* 2/17/15 - DEB - S-07456 ADDED &&PAX_LMT
-*12/17/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*07/12/16   RSB   S-20630 - New Employee ID database field
-*                           Added EMP_ID 
-* 02/24/2017 - DLV - S-22486 CHANGED ettek Review to Post-trip Reporting
-*09/28/2017 - JEM - S-35422 Place the footer date/time stamp text in a separate file to be -INCLUDED in the stylesheets

-*
-**********************************************************************


-**********************************************************************
-IF '&&SETF.EVAL' NE 'HNTPLSV' THEN GOTO SkipThis;

-SET &&RANK_METH = DISSAVINGS;



-SkipThis
 
-SET &&PAX_LMT = &&RANK_LIMIT;

SET ASNAMES = ON
-RUN

TABLE FILE &&RPT_HOLD

SUM NET_TKT_CNT 
    FARE_PAID 
    EMP_ID
    LEVEL1
    NEW_SEG_MILES
    AIRLINE_FEE
    AIRFEE_CNT
    TKT_PURCH
    REF_EXCH_CNT
    DISSAVINGS
BY LEVEL_DESC
BY PASSNGR_NAME
ON TABLE HOLD AS HOLD1
END
-RUN


 


TABLE FILE HOLD1
SUM NET_TKT_CNT
    FARE_PAID
    EMP_ID
    LEVEL1
    NEW_SEG_MILES
    AIRLINE_FEE
    AIRFEE_CNT
    TKT_PURCH
    REF_EXCH_CNT
    DISSAVINGS
BY LEVEL_DESC
-*RANKED BY HIGHEST NET_TKT_CNT
RANKED BY HIGHEST &&RANK_METH
BY PASSNGR_NAME
ON TABLE HOLD AS HOLD2
END
-RUN



-* -SET &&RANK_LIMIT = 9999;

DEFINE FILE HOLD2
  RANK_LIMIT/I9 = RANK;
  DRANK/D9 = RANK;
  ARANKX/A11 = FTOA(DRANK, '(D9)', 'A11');
  ARANK/A9 = EDIT(ARANKX,'$$999999999');
  LIST/D9 = (LAST LIST + 1);
  CRANKX/A11 = FTOA(LIST, '(D9)', 'A11');
  CRANK/A9 = EDIT(CRANKX,'$$999999999');
  RANK_VALUE/A9 = IF &&RANK_LIMIT EQ 0 THEN ARANK ELSE 
                  IF LIST GT &&RANK_LIMIT THEN 'ALL OTHER' ELSE 
                  CRANK;
  RANK_VALUE2/A9 = IF &&RANK_LIMIT EQ 0 THEN ARANK ELSE                 
                  IF LIST GT &&RANK_LIMIT THEN 'ALL OTHER' ELSE 
                  IF DISSAVINGS EQ 0 THEN 'ALL OTHER' ELSE
                  CRANK;                
  RANK_VAL/A9 = IF &&RANK_LIMIT EQ 0 THEN ARANK ELSE
                IF RANK GT &&RANK_LIMIT THEN 'ALL OTHER' ELSE
                ARANK;
  RANK_LAB1/A80 = IF RANK_VAL NE 'ALL OTHER' THEN &&RANK_LABEL1
                  ELSE 'ALL OTHER';
-*  RANK_LABEL1/A60 = IF RANK_VALUE NE 'ALL OTHER' THEN &&RANK_LABEL1
-*                       ELSE ' ';
-*  RANK_LABEL2/A60 = IF RANK_VALUE NE 'ALL OTHER' THEN &&RANK_LABEL2
-*                      ELSE ' ';
-*  RANK_LABEL3/A60 = IF RANK_VALUE NE 'ALL OTHER' THEN &&RANK_LABEL3
-*                      ELSE ' ';

END
-RUN

TABLE FILE HOLD2
SUM   NET_TKT_CNT
      FARE_PAID
      NEW_SEG_MILES      
      EMP_ID
      LEVEL1
      AIRLINE_FEE
      AIRFEE_CNT
      TKT_PURCH
      REF_EXCH_CNT
      DISSAVINGS
BY LEVEL_DESC
BY RANK_VALUE
-*BY RANK_VALUE2
BY PASSNGR_NAME
ON TABLE HOLD AS HOLD3
END
-RUN




TABLE FILE HOLD3
PRINT
    RANK_VALUE
-*  RANK_VALUE2
    NET_TKT_CNT 
    FARE_PAID 
    EMP_ID
    LEVEL1
    NEW_SEG_MILES
    AIRLINE_FEE
    AIRFEE_CNT
    PASSNGR_NAME
    TKT_PURCH
    REF_EXCH_CNT
    DISSAVINGS
BY LEVEL_DESC
-*RANKED BY HIGHEST NET_TKT_CNT 
RANKED BY HIGHEST &&RANK_METH
ON TABLE HOLD AS HOLD4
END
-RUN
 



DEFINE FILE HOLD4
  PAX_LIMIT/I5 = &&PAX_LMT;
  CRANK/D5     = RANK;
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
-*  LIST/D6      = IF PASSNGR_NAME NE LAST PASSNGR_NAME THEN (LAST LIST + 1)
-*                  ELSE LAST LIST;    
  LIST/D6      = (LAST LIST + 1);
  FRANKX/A7    = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6     = EDIT(FRANKX,'$999999');
  PAX_VALUE/A9 = IF PAX_LIMIT EQ 0 THEN BRANK ELSE
                 IF RANK GT PAX_LIMIT THEN 'OTHER' ELSE BRANK;
  PAX_VALUE2/A9 = IF PAX_LIMIT EQ 0 THEN BRANK ELSE
                 IF DISSAVINGS EQ 0 THEN 'OTHER' ELSE
                 IF RANK GT PAX_LIMIT THEN 'OTHER' ELSE BRANK;
                                
  RANK_LABEL1/A80 = IF PAX_VALUE NE 'OTHER' THEN &&RANK_LABEL1
                      ELSE ' ';
  RNK_LABEL1/A80 = IF PAX_VALUE2 NE 'OTHER' THEN &&RANK_LABEL1
                      ELSE 'ALL OTHER';                    
  RANK_LABEL2/A80 = IF PAX_VALUE NE 'OTHER' THEN &&RANK_LABEL2
                      ELSE ' ';
  RANK_LABEL3/A80 = IF PAX_VALUE NE 'OTHER' THEN &&RANK_LABEL3
                      ELSE ' ';

END
-RUN

 -IF &&SETF EQ 'HNTPLSV' THEN GOTO HNI;
 

TABLE FILE HOLD4
PRINT LIST
    CRANK
    FRANK
    NET_TKT_CNT 
    FARE_PAID 
    NEW_SEG_MILES
    AIRLINE_FEE
    AIRFEE_CNT
    RANK_LABEL1
    RANK_LABEL2
    RANK_LABEL3
    TKT_PURCH
    REF_EXCH_CNT
    DISSAVINGS
BY LEVEL_DESC
BY PAX_VALUE
BY RANK_VALUE
BY PASSNGR_NAME
-* BY PAX_NAM
ON TABLE HOLD AS HOLD5
END
-RUN

-GOTO Finish;

-HNI

TABLE FILE HOLD4
SUM LIST
    CRANK
    FRANK
    NET_TKT_CNT 
    FARE_PAID 
    NEW_SEG_MILES
    AIRLINE_FEE
    AIRFEE_CNT
    RANK_LABEL1
    RANK_LABEL2
    RANK_LABEL3
    RNK_LABEL1
    TKT_PURCH
    REF_EXCH_CNT
    DISSAVINGS
BY LEVEL_DESC
BY PAX_VALUE 
-*BY PAX_VALUE2
BY RANK_VALUE
-*BY RANK_VALUE2
BY PASSNGR_NAME
ON TABLE HOLD AS HOLD5
END
-RUN








-Finish

DEFINE FILE HOLD5
-* NOWTOD/A8 WITH RANK_VALUE = HHMMSS (NOWTOD);
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);

END
-RUN




-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE HOLD5
HEADING
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-IF &&SETF EQ 'HNTPLSV' THEN GOTO SplFoot;
-*
-GOTO OTHER1;
-*
-*******
-SplFoot
-******* 
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
"INCLUDES RECORDS ONLY WITH A LOST SAVINGS"
-*
-*******
-OTHER1
-******
-INCLUDE FOOTERSM
-*
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-*-*-EXIT




