-* ADDED LONHI TO ABCDNH ROUTINE - DEB - 4/8/14
-*10/29/14 - DEB - CHANGED VERB FROM SUM TO PRINT
-*                 ISSUE WAS CAUSING ALL CITIES ON DETAIL TO SHOW SAME CITY
-*10/30/14 - joy - summary was not balancing to detail had to update match conditions.
-*1/7/15 - DEB - S-06898 - Changed define of NHDESC that was producing no html error
-*               updated code to balance to summary
-* 1/9/2015 - DEB- S-06926 CHANGED CODE SO ABCDNH AND ABNHD WOULD BALANCE
-*            STAY1 CHANGED TO BE SAME AS STAY - STAY BASED ON NUMBER OF
-*            HOTEL NIGHTS FROM AIR EXTRACT
-*1/12/15     S-06926 Updated code so ABCDNH and ABNHD would balance to
-*            one another - DEB
-* 10/26/2015 - REJ S-12369 - Added code for Available Reports - For Report ABNHD.
-*12/09/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-* 03/10/2016 - REJ S-16697 - Added code for Available Reports for a drill down that wasn't 
-*                            working for ABCDNH.
-*10/4/16-JEM-S-25410-Added BBSDQNH to goto so report will run
 
-INCLUDE SETECHO
 
-IF &&FROMAVRP EQ 'Y' GOTO :NO1;
TABLE FILE BRPTFLDS
PRINT AIR.ID AIR.INCL1
BY INST_KEY
ON TABLE SAVE AS AIRACH11
END
-RUN
-:NO1
 
-IF '&&SETF.EVAL' EQ 'BZNYCP' OR 'BZNNYCP' OR 'BZCTP' THEN GOTO BZNYCH ELSE
-IF '&&SETF.EVAL' EQ 'ABCDNH' OR 'BAIRNHD' OR 'MCNH' OR 'ORSGNH' OR 'WRNH' OR 'TTNH' OR 'JHNHDTL' OR 'LONHI' OR 'SPGNH' OR 'BBSDQNH' THEN GOTO ABCDNH ELSE GOTO ABNHD;
 
-ABCDNH
DEFINE FILE AIRHLD
XTRN_DT/MDYY = TRN_DATE;
END
-RUN
TABLE FILE AIRHLD
PRINT STAY TKT_TYPE NOHR_KEY NOHTL_KEY XFST_DPT TKT_SORT XTRN_DT INVOICE_NUM
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
WHERE STAY NE 0
ON TABLE HOLD AS AIRHLD2
END
-RUN
 
 
-GOTO JKK;
 
-BZNYCH;
TABLE FILE AIRHLD
SUM STAY
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY COUNTRY_CODE
BY STATE_CODE
-IF '&&SETF.EVAL' NE 'BZNNYCP' GOTO NOWHR;
WHERE STATE_CODE EQ 'NY'
-NOWHR;
-IF '&&SETF.EVAL' NE 'BZCTP' GOTO NOWHR1;
WHERE STATE_CODE EQ 'CT'
-NOWHR1;
ON TABLE HOLD AS AIRHLD2
END
-RUN
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX HTLUSE
-RUN
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :AV4;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AV4_CONT;
-:AV4
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AV4_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :NOH1;
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH11
END
-RUN
 
EX CODEGEN
-RUN
-:NOH1
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW1;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW1
 
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';
 
-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
BZNYCEMP/A1 =
IF LEVEL4 EQ '548716' OR '202929' OR '548524' OR '550015' OR '520237' OR '549046' OR '546467' OR
'546770' OR '549289' OR '549625' OR '548247' OR '203303' OR '548509' OR '530064' OR '200235' OR '548492' OR
'525115' OR '516696' OR '509751' OR '548280' OR '550028' OR '549959' OR '549224' OR '549126' OR '530071' OR
'549205' OR '550042' OR '531039' OR '530909' OR '529068' OR '549692' OR '546772' OR '549242' OR '529474' OR
'550000' OR '538382' OR '549754' OR '548327' OR '550031' OR '531012' OR '549900' OR '511092' OR '549647' OR
'529097' OR '549766' OR '531741' OR '549687' OR '550160' OR '548474' OR '524764' OR '549657' OR '544341' OR
'549633' OR '550029' OR '548350' OR '539458' OR '528280' OR '548113' OR '550021' OR '549706' OR '549195' OR
'301385' OR '206258' OR '206126' OR '550233' OR '546516' OR '538384' OR '549475' OR '506309' OR '546431' OR
'547064' OR '546502' OR '530433' OR '549986' OR '549801' OR '528765' OR '549314' OR '546416' OR '535248' OR
'546397' OR '549174' OR '548242' OR '302396' OR '303885' OR '549154' OR '549550' OR '550032' OR '548833' OR
'546489' OR '549960' OR '538381' OR '548506' OR '503730' OR '549461' OR '548204' OR '531630' OR '517313' OR
'546039' OR '549898' OR '549254' OR '544631' OR '528150' OR '549339' OR '548556' OR '549843' OR '511427' OR
'204539' OR '546454' OR '548295' OR '550152' OR '200455' OR '538738' OR '548423' OR '550016' OR '521212' OR
'201253' OR '548621' OR '517337' OR '525434' OR '205885' OR '538351' OR '540971' OR '504784' OR '201274' OR
'546512' OR '201298' OR '549939' OR '549761' OR '549282' OR '550033' OR '549183' OR '549344' OR '522202' OR
'548892' OR '546384' OR '549686' OR '549823' OR '300969' OR '527729' OR '205991' OR '543370' OR '548495' OR
'548753' OR '531278' OR '302265' OR '549719' OR '538353' OR '549246' OR '525228' OR '526670' OR '002100' OR
'542921' OR '526078' OR '548383' OR '523350' OR '548447' OR '547250' OR '549897' OR '526202' OR '548708' OR
'548687' OR '549301' OR '521607' OR '528453' OR '546378' OR '550170' OR '525463' OR '530046' OR '549906' OR
'548517' OR '549894' OR '549165' OR '546455' OR '541068' OR '548675' OR '548146' OR '549993' OR '549173' OR
'548916' OR '530136' OR '541883' OR '550020' OR '550167' OR '303033' OR '549768' OR '530137' OR '512232' OR
'539629' OR '543786' OR '544681' OR '548748' OR '502811' OR '304619' OR '521274' OR '526700' OR '546392' OR
'549232' OR '549311' OR '550166' OR '532203' OR '544632' OR '549975' OR '544682' OR '550154' OR '538364' OR
'207420' OR '542922' OR '548298' OR '546510' OR '205371' OR '548148' OR '549767' OR '546769' OR '548290' OR
'501005' OR '548244' OR '531284' OR '515723' OR '538369' OR '305075' OR '546492' OR '548224' OR '548229' OR
'549150' OR '026657' OR '548154' OR '028833' OR '549646' OR '548153' OR '527904' OR '549318' OR '521615' OR
'549194' OR '544357' OR '548514' OR '532274' OR '548346' OR '301365' OR '549535' OR '207502' OR '548236' OR
'541060' OR '543369' OR '546440' OR '548493' OR '548155' OR '525419' OR '538357' OR '548794' OR '549044' OR
'549278' OR '549901' OR '548067' OR '201026' OR '207094' OR '530569' OR '206835' OR '548342' OR '521673' OR
'546511' OR '207641' OR '549775' OR '549284' OR '548301' OR '513489' OR '548674' OR '530371' OR '548525' OR
'548140' OR '538354' OR '549995' OR '522109' OR '550041' OR '521392' OR '548256' OR '548141' OR '549296' OR
'549309' OR '546443'  THEN 'Y' ELSE 'N';
 
CNCODE/A3 = CITY.COUNTRY_CODE;
SCODE/A3 = CITY.STATE_CODE;
LEVEL_DESC1/A80      = &&LDESC;
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/P12C = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
HTL_DT/MDYY         = CHKIN_DATE;
NHTL_RC/A2 = 'BO';
NOHTL_KEY/A40 = 'BKD AFTER TKTING/UNMATCHING DATES';
HLEVEL1/A15 = LEVEL1;
XINV_DT/MDYY = INVOICE_DATE;
HINVOICE/A7 = INVOICE_NUM;
-INCLUDE IDLEVDEFINE
 
END
TABLE FILE &&EXTRACT
SUM NNROOMS
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY CNCODE AS 'COUNTRY_CODE'
BY SCODE AS 'STATE_CODE'
-INCLUDE &HTLDATES
-INCLUDE RPTPARMS
-IF '&&SETF.EVAL' EQ 'BZNNYCP' GOTO NON;
-IF '&&SETF.EVAL' EQ 'BZCTP' GOTO BZCT;
WHERE BZNYCEMP EQ 'Y'
-GOTO SKIPNO;
-NON;
WHERE BZNYCEMP EQ 'N'
WHERE AIRPORT_CODE EQ 'EWR' OR 'JFK' OR 'LGA'
-GOTO SKIPNO;
-BZCT;
WHERE STATE_CODE EQ 'CT'
-SKIPNO;
ON TABLE HOLD AS HTLHLD
END
-RUN
 
 
TABLE FILE HTLHLD
SUM NNROOMS
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY COUNTRY_CODE
BY STATE_CODE
WHERE NNROOMS NE 0
ON TABLE HOLD AS HTLHLD1
END
 
 
TABLE FILE AIRHLD2
SUM STAY
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY COUNTRY_CODE
BY STATE_CODE
WHERE STAY NE 0
ON TABLE HOLD AS AIRHLD3
END
 
MATCH FILE AIRHLD3
SUM STAY
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY COUNTRY_CODE
BY STATE_CODE
ON TABLE HOLD
RUN
FILE HTLHLD1
SUM NNROOMS
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY COUNTRY_CODE
BY STATE_CODE
AFTER MATCH HOLD AS AHHLD OLD-OR-NEW
END
 
 
TABLE FILE AHHLD
SUM STAY NNROOMS
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY COUNTRY_CODE
BY STATE_CODE
ON TABLE HOLD AS AHHLD1
END
-RUN
 
TABLE FILE AHHLD1
PRINT COUNTRY_CODE
      LEVEL_DESC
      LEVEL4
      NNROOMS
      PASSNGR_NAME
      PNR_LOCATOR
      STAY
      TKT_NUM
BY STATE_CODE
ON TABLE HOLD AS RHLD FORMAT FOCUS INDEX STATE_CODE
END
-RUN
 
 
JOIN RHLD.STATE_CODE IN RHLD TO STATE.STATE_CODE IN STATE AS J1
-RUN
 
TABLE FILE RHLD
PRINT LEVEL_DESC
      LEVEL4
      NNROOMS
      PASSNGR_NAME
      PNR_LOCATOR
      STAY
      STATE_NAME
      TKT_NUM
BY COUNTRY_CODE
ON TABLE HOLD AS RHLD1 FORMAT FOCUS INDEX COUNTRY_CODE
END
-RUN
 
JOIN RHLD1.COUNTRY_CODE IN RHLD1 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J2
-RUN
 
DEFINE FILE RHLD1
STATE_COUNTRY/A25 = IF STATE_NAME EQ ' ' THEN COUNTRY_NAME ELSE STATE_NAME;
END
TABLE FILE RHLD1
SUM STAY NNROOMS
BY LEVEL_DESC
BY LEVEL4
BY PASSNGR_NAME
BY TKT_NUM
BY PNR_LOCATOR
BY STATE_COUNTRY
ON TABLE HOLD AS HRPTHOLD
END
-RUN
-GOTO XXIT;
 
 
-JKK;
-*  Match to Hotel Data
 
-IF '&&SETF.EVAL' EQ 'BZNHD' THEN GOTO Nextuse;
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :AV1;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AV1_CONT;
-:AV1
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AV1_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :NOH2;
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH11
END
-RUN
 
EX CODEGEN
-RUN
-:NOH2
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW2;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW2
 
-GOTO EXTRACT;
 
-Nextuse
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX BZHTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :AV2;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AV2_CONT;
-:AV2
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AV2_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :NOH3;
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH11
END
-RUN
 
EX CODEGEN
-RUN
-:NOH3
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW3;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW3
 
-EXTRACT
 
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';
 
-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
BZNYCEMP/A1 = IF LEVEL4 EQ '548716' OR '202929' OR '548524' OR '550015' OR '520237' OR '549046' OR '546467' OR
'546770' OR '549289' OR '549625' OR '548247' OR '203303' OR '548509' OR '530064' OR '200235' OR '548492' OR
'525115' OR '516696' OR '509751' OR '548280' OR '550028' OR '549959' OR '549224' OR '549126' OR '530071' OR
'549205' OR '550042' OR '531039' OR '530909' OR '529068' OR '549692' OR '546772' OR '549242' OR '529474' OR
'550000' OR '538382' OR '549754' OR '548327' OR '550031' OR '531012' OR '549900' OR '511092' OR '549647' OR
'529097' OR '549766' OR '531741' OR '549687' OR '550160' OR '548474' OR '524764' OR '549657' OR '544341' OR
'549633' OR '550029' OR '548350' OR '539458' OR '528280' OR '548113' OR '550021' OR '549706' OR '549195' OR
'301385' OR '206258' OR '206126' OR '550233' OR '546516' OR '538384' OR '549475' OR '506309' OR '546431' OR
'547064' OR '546502' OR '530433' OR '549986' OR '549801' OR '528765' OR '549314' OR '546416' OR '535248' OR
'546397' OR '549174' OR '548242' OR '302396' OR '303885' OR '549154' OR '549550' OR '550032' OR '548833' OR
'546489' OR '549960' OR '538381' OR '548506' OR '503730' OR '549461' OR '548204' OR '531630' OR '517313' OR
'546039' OR '549898' OR '549254' OR '544631' OR '528150' OR '549339' OR '548556' OR '549843' OR '511427' OR
'204539' OR '546454' OR '548295' OR '550152' OR '200455' OR '538738' OR '548423' OR '550016' OR '521212' OR
'201253' OR '548621' OR '517337' OR '525434' OR '205885' OR '538351' OR '540971' OR '504784' OR '201274' OR
'546512' OR '201298' OR '549939' OR '549761' OR '549282' OR '550033' OR '549183' OR '549344' OR '522202' OR
'548892' OR '546384' OR '549686' OR '549823' OR '300969' OR '527729' OR '205991' OR '543370' OR '548495' OR
'548753' OR '531278' OR '302265' OR '549719' OR '538353' OR '549246' OR '525228' OR '526670' OR '002100' OR
'542921' OR '526078' OR '548383' OR '523350' OR '548447' OR '547250' OR '549897' OR '526202' OR '548708' OR
'548687' OR '549301' OR '521607' OR '528453' OR '546378' OR '550170' OR '525463' OR '530046' OR '549906' OR
'548517' OR '549894' OR '549165' OR '546455' OR '541068' OR '548675' OR '548146' OR '549993' OR '549173' OR
'548916' OR '530136' OR '541883' OR '550020' OR '550167' OR '303033' OR '549768' OR '530137' OR '512232' OR
'539629' OR '543786' OR '544681' OR '548748' OR '502811' OR '304619' OR '521274' OR '526700' OR '546392' OR
'549232' OR '549311' OR '550166' OR '532203' OR '544632' OR '549975' OR '544682' OR '550154' OR '538364' OR
'207420' OR '542922' OR '548298' OR '546510' OR '205371' OR '548148' OR '549767' OR '546769' OR '548290' OR
'501005' OR '548244' OR '531284' OR '515723' OR '538369' OR '305075' OR '546492' OR '548224' OR '548229' OR
'549150' OR '026657' OR '548154' OR '028833' OR '549646' OR '548153' OR '527904' OR '549318' OR '521615' OR
'549194' OR '544357' OR '548514' OR '532274' OR '548346' OR '301365' OR '549535' OR '207502' OR '548236' OR
'541060' OR '543369' OR '546440' OR '548493' OR '548155' OR '525419' OR '538357' OR '548794' OR '549044' OR
'549278' OR '549901' OR '548067' OR '201026' OR '207094' OR '530569' OR '206835' OR '548342' OR '521673' OR
'546511' OR '207641' OR '549775' OR '549284' OR '548301' OR '513489' OR '548674' OR '530371' OR '548525' OR
'548140' OR '538354' OR '549995' OR '522109' OR '550041' OR '521392' OR '548256' OR '548141' OR '549296' OR
'549309' OR '546443'  THEN 'Y' ELSE 'N';
RTE_CTY_NM/A25 = CITY.CITY_NAME;
LEVEL_DESC1/A80      = &&LDESC;
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/P12C = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
NNROOMS1/P12C = IF TKT_NUM NE '0000000000' THEN NNROOMS ELSE 0;
NNROOMS2/P12C = IF TKT_NUM EQ '0000000000' THEN NNROOMS ELSE 0;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
HTL_DT/MDYY         = CHKIN_DATE;
NHTL_RC/A2 = 'BO';
NOHTL_KEY/A40 = 'BKD AFTER TKTING/UNMATCHING DATES';
HLEVEL1/A15 = LEVEL1;
XINV_DT/MDYY = INVOICE_DATE;
HINVOICE/A7 = INVOICE_NUM;
-INCLUDE IDLEVDEFINE
 
END
TABLE FILE &&EXTRACT
PRINT NNROOMS1 NNROOMS2 XINV_DT HTL_DT HINVOICE
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
-IF '&&SETF.EVAL' EQ 'BZNHD' THEN GOTO Skipdate;
-INCLUDE &HTLDATES
-Skipdate
-IF '&&SETF.EVAL' NE 'LONHI' THEN GOTO SkipIntl;
WHERE CITY.INTL_DOM EQ 'I'
-SkipIntl
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTLHLD
END
-RUN
 
 
MATCH FILE AIRHLD2
PRINT STAY TKT_TYPE NOHR_KEY NOHTL_KEY XFST_DPT TKT_SORT XTRN_DT INVOICE_NUM
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
ON TABLE HOLD
RUN
FILE HTLHLD
PRINT NNROOMS1 NNROOMS2 XINV_DT HTL_DT RTE_CTY_NM HINVOICE
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
AFTER MATCH HOLD AS AHHLD OLD-OR-NEW
END
-RUN
 
 
 
 
-GOTO JOY
 
TABLE FILE AHHLD
SUM RTE_CTY_NM
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS AHHLD1
END
-RUN
 
 
MATCH FILE AHHLD
PRINT TKT_TYPE NOHR_KEY NOHTL_KEY XFST_DPT TKT_SORT XTRN_DT INVOICE_NUM
      XINV_DT HTL_DT STAY NNROOMS1 NNROOMS2 HINVOICE
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE AHHLD1
SUM RTE_CTY_NM
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
AFTER MATCH HOLD AS AHHLD2 OLD
END
-RUN
 
-JOY
 
DEFINE FILE AHHLD
TKT/A10 = IF TKT_NUM EQ '0000000000' THEN 'HTL ONLY' ELSE TKT_NUM;
ZFLAG/A1 = IF (STAY EQ 0) AND (NNROOMS1 EQ 0) AND (NNROOMS2 NE 0) AND TKT EQ 'HTL ONLY' THEN 'N' ELSE
                   IF (STAY EQ 0) AND (NNROOMS1 EQ 0) AND (NNROOMS2 EQ 0) THEN 'Y' ELSE 'N';
END
TABLE FILE AHHLD
PRINT STAY NNROOMS1/P12C NNROOMS2/P12C ZFLAG
-*COMPUTE STAY1/P12C = IF (STAY EQ 0) AND (NNROOMS1 NE 0) THEN NNROOMS1 ELSE STAY;
COMPUTE STAY1/P12C = STAY;
COMPUTE NOHOTEL/P12C = STAY1 - NNROOMS1;
-*COMPUTE ZFLAG/A1 = IF (STAY EQ 0) AND (NNROOMS1 EQ 0) AND (NNROOMS2 EQ 0) THEN 'Y' ELSE 'N';
 
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT
BY TKT_NUM
BY RTE_CTY_NM
ON TABLE HOLD AS AHHLDA1
END
-RUN
 
TABLE FILE AHHLDA1
SUM STAY1 NNROOMS1 NNROOMS2 NOHOTEL
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
WHERE ZFLAG EQ 'N'
ON TABLE HOLD AS AHHLDB1
END
-RUN
 
MATCH FILE AHHLD
SUM TKT_TYPE NOHR_KEY NOHTL_KEY XFST_DPT TKT_SORT XTRN_DT INVOICE_NUM
      XINV_DT HTL_DT RTE_CTY_NM HINVOICE
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
ON TABLE HOLD
RUN
FILE AHHLDB1
PRINT STAY1 NNROOMS1 NNROOMS2 NOHOTEL
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
AFTER MATCH HOLD AS TTLHLD OLD-AND-NEW
END
-RUN
 
TABLE FILE TTLHLD
PRINT STAY1 NNROOMS1 NNROOMS2 NOHOTEL XTRN_DT XINV_DT INVOICE_NUM XFST_DPT HTL_DT NOHR_KEY NOHTL_KEY HINVOICE
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY RTE_CTY_NM
ON TABLE HOLD AS TTLHLD1
END
-RUN
 
 
DEFINE FILE TTLHLD1
TDATE/MDYY = IF XTRN_DT EQ ' ' THEN XINV_DT ELSE XTRN_DT;
DPTDT/MDYY = IF XFST_DPT EQ ' ' THEN HTL_DT ELSE XFST_DPT;
INVOICE/A7 = IF INVOICE_NUM EQ ' ' THEN HINVOICE ELSE INVOICE_NUM;
TKT/A10 = IF TKT_NUM EQ '0000000000' THEN 'HTL ONLY' ELSE TKT_NUM;
NOHTL_RSN/A40 = IF NOHOTEL LE 0 THEN ' ' ELSE NOHTL_KEY;
NHDESC/A40 = NOHTL_KEY;
 
-* NOHTL_KEY1/A40 = IF NOHTL_KEY EQ ' ' AND NNROOMS EQ 0 THEN NOHTL_KEY ELSE 'BKD AFTER TKTING/UNMATCHING DATES';
END
-RUN
TABLE FILE TTLHLD1
PRINT TDATE DPTDT INVOICE STAY1 NNROOMS1 NNROOMS2 NOHOTEL NOHTL_KEY NOHR_KEY NHDESC
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT
BY RTE_CTY_NM
ON TABLE HOLD AS HRPTHOLD
END
-RUN
 
 
 
-SET &&NOHDTREC = IF &LINES NE 0 THEN 'N' ELSE 'Y';
 
 
-GOTO XXIT;
 
-ABNHD
DEFINE FILE AIRHLD
XTRN_DT/MDYY = TRN_DATE;
END
-RUN
TABLE FILE AIRHLD
PRINT STAY TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY NOHTL_KEY
WHERE STAY NE 0
ON TABLE HOLD AS AIRHLD3
END
-RUN
 
-*  Match to Hotel Data
 
-IF '&&SETF.EVAL' EQ 'BZNHD' THEN GOTO Nextuse;
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX HTLUSE
-RUN
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :NO2;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :NO2_CONT;
-:NO2
FIXFORM INST_KEY/11 RPT_GROUP/3
-:NO2_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :NO4;
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH11
END
-RUN
 
EX CODEGEN
-RUN
-:NO4
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW4;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW4
 
 
-GOTO EXTRACT;
 
-Nextuse
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX BZHTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
-IF &&FROMAVRP EQ 'Y' GOTO :AV3;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AV3_CONT;
-:AV3
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AV3_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :NOH5;
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH11
END
-RUN
 
EX CODEGEN
-RUN
-:NOH5
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW5;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW5
 
-EXTRACT
 
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';
 
-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
HCTY_NM/A25 = CITY.CITY_NAME;
LEVEL_DESC1/A80      = &&LDESC;
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/P12C = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
NNROOMS1/P12C = IF TKT_NUM NE '0000000000' THEN NNROOMS ELSE 0;
NNROOMS2/P12C = IF TKT_NUM EQ '0000000000' THEN NNROOMS ELSE 0;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
HTL_DT/MDYY         = CHKIN_DATE;
NHTL_RC/A2 = 'BO';
NOHTL_KEY/A40 = 'BKD AFTER TKTING/UNMATCHING DATES';
HTL_KEY/A40 = 'BKD AFTER TKTING/UNMATCHING DATES';
HLEVEL1/A15 = LEVEL1;
XINV_DT/MDYY = INVOICE_DATE;
HINVOICE/A7 = INVOICE_NUM;
-INCLUDE IDLEVDEFINE
 
END
TABLE FILE &&EXTRACT
PRINT NNROOMS1 NNROOMS2 XINV_DT HTL_DT HINVOICE HCTY_NM HTL_KEY
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY NOHTL_KEY
-IF '&&SETF.EVAL' EQ 'BZNHD' THEN GOTO Skipdate;
-INCLUDE &HTLDATES
-Skipdate
-INCLUDE RPTPARMS
 
ON TABLE HOLD AS HTLHLD
END
-RUN
 
MATCH FILE AIRHLD3
PRINT STAY TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM NOHTL_KEY
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
-* BY NOHTL_KEY
ON TABLE HOLD
RUN
FILE HTLHLD
SUM NNROOMS1 NNROOMS2 XINV_DT HTL_DT HINVOICE HTL_KEY
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
-* BY NOHTL_KEY
AFTER MATCH HOLD AS AHHLD OLD-OR-NEW
END
-RUN
 
 
DEFINE FILE AHHLD
TKT/A10 = IF TKT_NUM EQ '0000000000' THEN 'HTL ONLY' ELSE TKT_NUM;
NROOM1/P12C = IF TKT_NUM NE LAST TKT_NUM THEN NNROOMS1 ELSE 0;
-*NROOM2/P12C = IF TKT_NUM NE LAST TKT_NUM THEN NNROOMS2 ELSE 0;
NROOM2/P12C = IF TKT EQ 'HTL ONLY' THEN NNROOMS2 ELSE 0;
-*              IF TKT_NUM NE LAST TKT_NUM THEN NNROOMS2 ELSE 0;
END
-RUN
TABLE FILE AHHLD
PRINT STAY TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM
      NROOM1 AS 'NNROOMS1' NROOM2 AS 'NNROOMS2' NOHTL_KEY HTL_KEY HINVOICE
      XINV_DT HTL_DT TKT
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS AHHLD1
END
-RUN
 
 
 
 
TABLE FILE AIRHLD
PRINT RTE_CTY_NM
BY TKT_NUM
ON TABLE HOLD AS ARTEHLD
END
-RUN
 
 
TABLE FILE HTLHLD
PRINT HCTY_NM
BY TKT_NUM
ON TABLE HOLD AS HCITHLD
END
-RUN
 
 
MATCH FILE ARTEHLD
PRINT RTE_CTY_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HCITHLD
PRINT HCTY_NM
BY TKT_NUM
AFTER MATCH HOLD AS RTECIT OLD-OR-NEW
END
-RUN
 
DEFINE FILE RTECIT
CITY/A25 = IF TKT_NUM EQ '0000000000' THEN HCTY_NM ELSE
           IF RTE_CTY_NM EQ ' ' THEN HCTY_NM ELSE
           IF HCTY_NM EQ ' ' THEN RTE_CTY_NM ELSE HCTY_NM;
END
-RUN
TABLE FILE RTECIT
PRINT CITY
BY TKT_NUM
ON TABLE HOLD AS RTECIT1
END
-RUN
 
MATCH FILE AHHLD1
PRINT STAY TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM NOHTL_KEY HTL_KEY
      NNROOMS1 NNROOMS2 XINV_DT HTL_DT HINVOICE LEVEL_DESC XPSNGR_NM LEVEL1 TKT
BY TKT_NUM
ON TABLE HOLD
RUN
FILE RTECIT1
-*SUM CITY
PRINT CITY
BY TKT_NUM
AFTER MATCH HOLD AS AHHLD1X OLD-AND-NEW
END
-RUN
 
DEFINE FILE AHHLD1X
ZFLAG/A1 = IF (STAY EQ 0) AND (NNROOMS1 EQ 0) AND (NNROOMS2 NE 0) AND TKT EQ 'HTL ONLY' THEN 'N' ELSE
                   IF (STAY EQ 0) AND (NNROOMS1 EQ 0) AND (NNROOMS2 EQ 0) THEN 'Y' ELSE 'N';
END
TABLE FILE AHHLD1X
PRINT TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM HINVOICE
      XINV_DT HTL_DT STAY NNROOMS1 NNROOMS2 NOHTL_KEY HTL_KEY CITY TKT ZFLAG
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS AHHLD1C
END
-RUN
 
 
TABLE FILE AHHLD1C
SUM STAY NNROOMS1/P12C NNROOMS2/P12C TKT ZFLAG
-*COMPUTE STAY1/P12C = IF (STAY EQ 0) AND (NNROOMS1 NE 0) THEN NNROOMS1 ELSE STAY;
COMPUTE STAY1/P12C = STAY;
COMPUTE NOHOTEL/P12C = STAY1 - NNROOMS1;
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
-* BY NOHTL_KEY
ON TABLE HOLD AS AHHLD2
END
-RUN
 
TABLE FILE AHHLD2
SUM STAY1 NNROOMS1 NNROOMS2 NOHOTEL TKT
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
-* BY NOHTL_KEY
WHERE ZFLAG EQ 'N'
ON TABLE HOLD AS AHHLD3
END
-RUN
 
MATCH FILE AHHLD1C
-*SUM TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM
PRINT TKT_TYPE XFST_DPT XTRN_DT INVOICE_NUM
      XINV_DT HTL_DT CITY HINVOICE NOHTL_KEY HTL_KEY TKT
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE AHHLD3
PRINT STAY1 NNROOMS1 NNROOMS2 NOHOTEL
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
AFTER MATCH HOLD AS TTLHLD OLD-AND-NEW
END
-RUN
 
 
 
TABLE FILE TTLHLD
PRINT STAY1 NNROOMS1 NNROOMS2 NOHOTEL XTRN_DT XINV_DT INVOICE_NUM XFST_DPT
      HTL_DT HINVOICE CITY HTL_KEY TKT
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT_NUM
BY NOHTL_KEY
ON TABLE HOLD AS TTLHLD1
END
-RUN
 
 
 
 
 
DEFINE FILE TTLHLD1
-*TKT/A10 = IF TKT_NUM EQ '0000000000' THEN 'HTL ONLY' ELSE TKT_NUM;
TDATE/MDYY = IF XTRN_DT EQ ' ' THEN XINV_DT ELSE XTRN_DT;
DPTDT/MDYY = IF XFST_DPT EQ ' ' THEN HTL_DT ELSE XFST_DPT;
INVOICE/A7 = IF INVOICE_NUM EQ ' ' THEN HINVOICE ELSE INVOICE_NUM;
NHDESC/A40 = IF TKT EQ 'HTL ONLY' THEN 'HOTEL ONLY' ELSE
             IF NOHTL_KEY EQ ' ' THEN HTL_KEY ELSE NOHTL_KEY;
-* CITY/A25 = IF HCTY_NM NE ' ' THEN HCTY_NM ELSE RTE_CTY_NM;
END
-RUN
TABLE FILE TTLHLD1
PRINT TDATE DPTDT INVOICE STAY1 NNROOMS1 NNROOMS2 NOHOTEL CITY
BY LEVEL_DESC
BY LEVEL1
BY XPSNGR_NM
BY TKT
BY NHDESC
ON TABLE HOLD AS HRPTHOLD
END
-RUN
 
 
 
 
 
-* -SET &&NOHDTREC = IF &LINES NE 0 THEN 'N' ELSE 'Y';
 
-XXIT;
 
 
