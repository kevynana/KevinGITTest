-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AVIW35SM.FEX
-INCLUDE SETECHO
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS. 
-*03/30/01     DEB BUCKNER/WTORRES  VIEW AMENDED TO NOT INCLUDE CARRIERS
-*                                  W/NO NAME
-*04/09/01     SCORDS/JKALHORN      COMMENTED OUT THE CARRIERS W/NO NAME
-*                                  COMMENTED OUT THE IF FARE > 0
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*11/5/03    JK                 &&RANK_METH WAS NOT BEING SET CORRECTLY
-*                              FROM CODEGEN/ADDED CODE TO SET THIS CORRECTLY
-*3/15/04    JK                 CHANGED VIEW TO NOT SORT BY LEVEL_DESC TO 
-*                              ELMINATE DUP AIRLINES IF SORTED 
-*                              AT A LOWER LEVEL
-*10/29/04    DEB               CHANGED TO ADD GLOBAL CURRENCY
-*03/15/05   DEB                CREATED FOR DUAL DATE CARRIER USAGE REPORT
-*5/9/13     jk                 Changed the header to include travel date
-* 06/23/2017 - DLV - S-35283 PRISM reports - make drillable to details
-*                             Added defines for Contract Saving 
-* 09/18/2017 RSB S-38044 Place the footer date/time stamp text in a separate file to be -INCLUDED in the stylesheets
-**********************************************************************
-* 
-SET &&RANK_METH = 'BASE_FARE';
-SET &&RANK_LIMIT = 10;


-SET &&RANK_METH = IF &&RANK_METH EQ 'BASE_FARE' THEN 'BASE_FARE'
- ELSE IF &&RANK_METH EQ 'NET_TKT_CNT' THEN 'NET_TKT_CNT' 
- ELSE 'NET_TKT_CNT';





SET ASNAMES = ON
-RUN

-IF &&SETF EQ 'ABCARIDD' AND &&CURRENCY NE 'USD' THEN GOTO CARIR
-ELSE GO TO NEXT;

-CARIR;

-SET &&SUBHEAD = <NAMEC;
-SET &FBASE_CUR = 'BASE FARE, (' | &&CURRENCY || ')';
-SET &GAVGP_CUR= 'AVG,FLIGHT,PRICE, (' | &&CURRENCY || ')';
-SET &GCPK_CUR= 'COST,/KLMTR, (' | &&CURRENCY || ')';
-SET &&S_SUBJ3='GFARE/D16.2CS AS ' | '''&FBASE_CUR.EVAL'''  ;
-SET &&S_SUBJ4='PCT.GFARE/D8.2 AS ''% OF,FARE'' KILO/P9CS AS ''TOTAL KLMTRS''';
-SET &&S_SUBJ5='PCT.KILO/P8.2 AS ''% OF,KLMTRS''';
-SET &&S_SUBJ6='COMPUTE CAVG_FLT/P14.2 = IF ((NET_TKT_CNT LT 1) AND';
-SET &&S_SUBJ7='(NET_TKT_CNT GT (-1))) THEN 0';
-SET &&S_SUBJ8='ELSE (GFARE/NET_TKT_CNT); AS ' | '''&GAVGP_CUR.EVAL''';
-SET &&S_SUBJ9='COMPUTE GCPK/P14.2= IF ((KILO LT 1) AND (KILO GT (-1))) ';
-SET &&S_SUBJ10='THEN 0 ELSE (GFARE/KILO); AS ' | '''&GCPK_CUR.EVAL''';

-NEXT;
-SET &SUMMSUB1='SUM NET_TKT_CNT/P8CS AS ''TOTAL,MARKETS''';
-SET &SUMMSUB2='PCT.NET_TKT_CNT/P9.2 AS ''% OF,MKT'' FARE/D16.2CS AS ';
-SET &SUMMSUB3='''BASE,FARE'' PCT.FARE AS ''% OF,FARE'' MILES/P9CS AS ';
-SET &SUMMSUB4='PCT.MILES/P9.2 AS ''% OF,MILES''''TOTAL MILES''';
-SET &SUMMSUB5='COMPUTE AVG_FLT/P8.2 = IF ((NET_TKT_CNT LT 1) AND ';
-SET &SUMMSUB6='(NET_TKT_CNT GT (-1))) THEN 0 ELSE (FARE/NET_TKT_CNT);';
-SET &SUMMSUB7='AS ''AVG,FLIGHT,PRICE'' COMPUTE CPM/P8.2=';
-SET &SUMMSUB8='IF ((MILES LT 1) AND (MILES GT (-1))) THEN 0 ELSE';
-SET &SUMMSUB9='(FARE/MILES); AS ''COST,/MILE''';
-SET &SUMMSUB10='NFVSVX/D16.2 AS ''CONTRACT,SAVINGS''';

-IF &&SETF EQ 'ABCARIDB' AND &&CURRENCY NE 'USD' THEN GOTO CARIDB
-ELSE GO TO NEXT2;
-CARIDB;

-SET &&SUBHEAD = <NAMEC;
-SET &FBASE_CUR = 'BASE FARE, (' | &&CURRENCY || ')';
-SET &GAVGP_CUR= 'AVG,FLIGHT,PRICE, (' | &&CURRENCY || ')';
-SET &GCPK_CUR= 'COST,/KLMTR, (' | &&CURRENCY || ')';
-SET &GCCS_CUR= 'CONTRACT,SAVINGS, (' | &&CURRENCY ||')';
-SET &&S_SUBJ3='GFARE/D16.2CS AS ' | '''&FBASE_CUR.EVAL'''  ;
-SET &&S_SUBJ4='PCT.GFARE/D8.2 AS ''% OF,FARE'' KILO/P9CS AS ''TOTAL KLMTRS''';
-SET &&S_SUBJ5='PCT.KILO/P8.2 AS ''% OF,KLMTRS''';
-SET &&S_SUBJ6='COMPUTE CAVG_FLT/P14.2 = IF ((NET_TKT_CNT LT 1) AND';
-SET &&S_SUBJ7='(NET_TKT_CNT GT (-1))) THEN 0';
-SET &&S_SUBJ8='ELSE (GFARE/NET_TKT_CNT); AS ' | '''&GAVGP_CUR.EVAL''';
-SET &&S_SUBJ9='COMPUTE GCPK/P14.2= IF ((KILO LT 1) AND (KILO GT (-1))) ';
-SET &&S_SUBJ10='THEN 0 ELSE (GFARE/KILO); AS ' | '''&GCPK_CUR.EVAL'' NFVSVX/D16.2 AS ' | '''&GCCS_CUR.EVAL''';

-NEXT2;

TABLE FILE AIRCARI3
SUM BASE_FARE 
  COMM_SEG	
  CP_FARE_PD AS 'FARE'
  FARE_BASE1/D20.6CS AS 'GBASE_FARE'
  FARE_TTL1/D20.6CS AS 'GTTL_FARE'	
  INTCNT
  KILO
  MILES	
  LEVEL_DESC
  NAMEC
  NET_COMM
  NET_FARE
  NET_TKT_CNT
  NET_FARE
  NEW_SEG_MILES
  PAID_FARE1/D20.6CS AS 'GFARE'
  TAX_TTL1/D20.6CS AS 'GTTL_TAX'
  TOTAL_FARE
  TOTAL_TAX	
  NFVSVX/D20.6
BY AIRLINE_NAME
ON TABLE HOLD AS RNKHLD1
END
-RUN

TABLE FILE RNKHLD1
PRINT BASE_FARE 
      COMM_SEG 
      FARE 
      GBASE_FARE 
      GFARE 
      GTTL_FARE 
      GTTL_TAX
      INTCNT 
      KILO 
      MILES 
      NET_COMM 
      NET_FARE 
      NET_TKT_CNT 
      NAMEC
      NET_FARE 
      NEW_SEG_MILES 
      TOTAL_FARE 
      TOTAL_TAX 
      LEVEL_DESC
      NFVSVX
RANKED BY HIGHEST &&RANK_METH NOPRINT
BY AIRLINE_NAME
ON TABLE HOLD AS RNKHLD2 
END
-RUN

DEFINE FILE RNKHLD2
  DRANK/D9 = RANK;
  ARANKX/A11 = FTOA(DRANK, '(D9)', 'A11');
  ARANK/A9 = EDIT(ARANKX,'$$999999999');
  LIST/D9 = LAST LIST + 1;
  CRANKX/A11 = FTOA(LIST, '(D9)', 'A11');
  CRANK/A9 = EDIT(CRANKX,'$$999999999');
  RANK_VALUE/A9 = IF &&RANK_LIMIT EQ 0 THEN ARANK ELSE  
                  IF LIST GT &&RANK_LIMIT THEN 'ALL OTHER' ELSE 
                     CRANK;
  RANK_LABEL/A35 = IF RANK_VALUE NE 'ALL OTHER' THEN AIRLINE_NAME
                     ELSE 'OTHER';
-*   RANK_LBL/A35 =  IF RANK_VALUE NE 'ALL OTHER' THEN AIRLN ELSE 'OTHER';
END
-RUN

TABLE FILE RNKHLD2
SUM FARE        AS 'TFARE'
    GFARE       AS 'GTFARE'
    KILO        AS 'TKILO'	
    MILES       AS 'TMILES'	
    NET_COMM    AS 'TCOM'	
    NET_TKT_CNT AS 'TTKTS'
    NFVSVX      AS 'TVSAV'
BY AIRLINE_NAME
ON TABLE HOLD AS RNKHLD3
END
-RUN

MATCH FILE RNKHLD2
PRINT 
  BASE_FARE	
  COMM_SEG	
  FARE 
  GBASE_FARE
  GFARE
  GTTL_FARE
  GTTL_TAX	
  INTCNT
  KILO
  LEVEL_DESC
  MILES	
  NAMEC
  NET_COMM	
  NET_TKT_CNT	
  NEW_SEG_MILES
  RANK_LABEL
  RANK_VALUE
  TOTAL_FARE
  TOTAL_TAX
  NFVSVX
BY AIRLINE_NAME
ON TABLE HOLD
RUN
FILE RNKHLD3
SUM GTFARE
  TFARE
  TKILO
  TMILES
  TTKTS
  TVSAV
BY AIRLINE_NAME
AFTER MATCH HOLD AS RNKHLD4 OLD-AND-NEW
END
-RUN 



DEFINE FILE RNKHLD4
  PCTFARE/D8.1= IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0
                ELSE ((FARE/TFARE)*100);
  PCTTKT/D8.1= IF ((TTKT LT 1) AND (TTKT GT (-1))) THEN 0
               ELSE ((NET_TKT_CNT/TTKT)*100);
  PTMILES/D8.1= IF ((TMILES LT 1) AND (TMILES GT (-1))) THEN 0
                ELSE ((MILES/TMILES)*100);
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HDRPRISMSM' ELSE 'HDREXLPRISM'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE RNKHLD4
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDRPRISMSM' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-*
-INCLUDE FOOTERSM
-*
-*ON TABLE SET STYLE &&SMSTY

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;

-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE



-*
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN


-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
