SET ASNAMES = ON


-*-INCLUDE SETECHO

FILEDEF IT_EMP DISK D:\AS400\IT_EMP.TXT



TABLE FILE IT_EMP
PRINT EMP_NUM EMP_NAME
BY EMP_NUM NOPRINT
ON TABLE HOLD AS FIXEMP FORMAT FOCUS INDEX EMP_NUM

END
-RUN


DEFINE FILE FIXEMP
LAST_NAME/A25 = GETTOK(EMP_NAME, 33, -2, '/', 25, LAST_NAME);
FIRST_NAME/A25 = GETTOK(EMP_NAME, 33, -1, '/', 25, FIRST_NAME);
FN_INIT/A5= EDIT(FIRST_NAME, '99999');
 END
TABLE FILE FIXEMP
PRINT EMP_NAME LAST_NAME  FN_INIT  
BY EMP_NUM 
ON TABLE HOLD AS ITFIX
END
-RUN





DEFINE FILE AZITRON
LST_NM/A25 = GETTOK(PASSNGR_NAME, 33, -2, '/', 25, LST_NM);
FIRST_NAME/A25 = GETTOK(PASSNGR_NAME, 33, -1, '/', 25, FIRST_NAME);
FST_INIT/A5 = EDIT(FIRST_NAME, '99999');
END
TABLE FILE AZITRON
PRINT LEVEL1 AIR_KEY LST_NM FST_INIT PASSNGR_NAME
BY LEVEL1 NOPRINT  
WHERE LEVEL1 OMITS 'ACTARIS' OR 'NONEMP'
ON TABLE HOLD AS HOLD1  
END
-RUN



JOIN LEVEL1 IN HOLD1 TO EMP_NUM IN ITFIX AS J1
TABLE FILE HOLD1
PRINT AIR_KEY LEVEL1 EMP_NAME PASSNGR_NAME
  LAST_NAME LST_NM FN_INIT FST_INIT
BY AIR_KEY NOPRINT
WHERE LAST_NAME CONTAINS LST_NM
ON TABLE HOLD AS HOLD2
END
-RUN

 

TABLE FILE HOLD2
PRINT AIR_KEY EMP_NAME AS 'PASSNGR_NAME' 
BY AIR_KEY NOPRINT
WHERE FST_INIT EQ FN_INIT
WHERE EMP_NAME NE PASSNGR_NAME
ON TABLE SET ONLINE-FMT EXL2K
ON TABLE HOLD AS HOLD3
END
-RUN




MODIFY FILE AZITRON
FIXFORM FROM HOLD3
MATCH AIR_KEY  
ON MATCH UPDATE PASSNGR_NAME
ON NOMATCH REJECT
DATA ON HOLD3
END
-RUN

DEFINE FILE CZITRON
LST_NM/A25 = GETTOK(PASSNGR_NAME, 33, -2, '/', 25, LST_NM);
FIRST_NAME/A25 = GETTOK(PASSNGR_NAME, 33, -1, '/', 25, FIRST_NAME);
FST_INIT/A5 = EDIT(FIRST_NAME, '99999');
END
TABLE FILE CZITRON
PRINT LEVEL1 CAR_KEY LST_NM FST_INIT PASSNGR_NAME
BY LEVEL1 NOPRINT  
WHERE LEVEL1 OMITS 'ACTARIS' OR 'NONEMP'
ON TABLE HOLD AS CARHOLD1
END
-RUN

JOIN LEVEL1 IN CARHOLD1 TO EMP_NUM IN ITFIX AS J1
TABLE FILE CARHOLD1
PRINT CAR_KEY LEVEL1 EMP_NAME PASSNGR_NAME
  LAST_NAME LST_NM FN_INIT FST_INIT
BY CAR_KEY NOPRINT
WHERE LAST_NAME CONTAINS LST_NM
ON TABLE HOLD AS CARHOLD2
END
-RUN
 
TABLE FILE CARHOLD2
PRINT CAR_KEY EMP_NAME AS 'PASSNGR_NAME'
BY CAR_KEY NOPRINT
WHERE FST_INIT EQ FN_INIT
WHERE EMP_NAME NE PASSNGR_NAME
ON TABLE HOLD AS CARHOLD3
END
-RUN


MODIFY FILE CZITRON
FIXFORM FROM CARHOLD3
MATCH CAR_KEY  
ON MATCH UPDATE PASSNGR_NAME
ON NOMATCH REJECT
DATA ON CARHOLD3
END
-RUN

DEFINE FILE HZITRON
LST_NM/A25 = GETTOK(PASSNGR_NAME, 33, -2, '/', 25, LST_NM);
FIRST_NAME/A25 = GETTOK(PASSNGR_NAME, 33, -1, '/', 25, FIRST_NAME);
FST_INIT/A5 = EDIT(FIRST_NAME, '99999');
END
TABLE FILE HZITRON
PRINT LEVEL1 HTL_KEY LST_NM FST_INIT PASSNGR_NAME
BY LEVEL1 NOPRINT   
WHERE LEVEL1 OMITS 'ACTARIS' OR 'NONEMP'
ON TABLE HOLD AS HTLHOLD1
END
-RUN

JOIN LEVEL1 IN HTLHOLD1 TO EMP_NUM IN ITFIX AS J1
TABLE FILE HTLHOLD1
PRINT HTL_KEY LEVEL1 EMP_NAME PASSNGR_NAME
  LAST_NAME LST_NM FN_INIT FST_INIT
BY HTL_KEY NOPRINT
WHERE LAST_NAME CONTAINS LST_NM
ON TABLE HOLD AS HTLHOLD2
END
-RUN
 
TABLE FILE HTLHOLD2
PRINT HTL_KEY EMP_NAME AS 'PASSNGR_NAME'
BY HTL_KEY NOPRINT
WHERE FST_INIT EQ FN_INIT
WHERE EMP_NAME NE PASSNGR_NAME
ON TABLE HOLD AS HTLHOLD3
END
-RUN


MODIFY FILE HZITRON
FIXFORM FROM HTLHOLD3
MATCH HTL_KEY  
ON MATCH UPDATE PASSNGR_NAME
ON NOMATCH REJECT
DATA ON HTLHOLD3
END
-RUN


