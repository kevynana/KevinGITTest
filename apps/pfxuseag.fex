-* 6/29/16 - JEM - S-20131 Created to accommodate updates to DVEXPNAG per Linda Paesl's requirements
-* 9/20/19 - JEM - S-24945 Updated joins/in file to use an edited htl_key (removes the resv_status off the end) when using htl_key records were missing due to changes/cancellations
-* 9/20/19 - JEM - S-24945 Updated joins/in file to use an edited car_key (removes the resv_status off the end) when using car_key records were missing due to changes/cancellations
-* 06/16/17  DLV - D-01541 - Carried through BR_CL_IDX PAX_NM IN PFHOLDA PFHOLDC PFHOLDH
-INCLUDE SETECHO
 
 

-SET &COMPPF = 'PF' ||&&COMPNY || '.FOC';
-SET &PROFDATES = &&WEB_PATH || 'PROFDATES.fex';

-SET &DATAPATH='&&DATASRV.EVAL' || '\TNT\TTRACKER\DATA\';
 
-SET &FILE1A = '&DATAPATH.EVAL' || '&COMPPF.EVAL AS PROFFEE';

-RUN



 USE ADD
 &FILE1A
 END
 
  
 DEFINE FILE PROFFEE
  FLAG/A1 = 'B';
-*  CITY1/A25 = IF FEE_AMT EQ 25.00 THEN 'VOD' ELSE 'SVC FEE';
  CITY1/A25 = 'SVC FEE';
  CNT/D12 = 0;

 END
 
 
 TABLE FILE PROFFEE
 PRINT BR_CL_IDX PASSNGR_NAME AS 'PAX_NM' TRN_TYPE TRN_DATE FEE_SRC FEE_AMT PAY_METHOD CREDIT_CARD FST_DPT_DATE CNT CITY1 RPT_DATE TASF_TKT_NUM
 BY FLAG
 BY AIR_KEY
 WHERE AIR_KEY NE ''
 -INCLUDE &PROFDATES
 -*ON TABLE COLUMN-TOTAL
 ON TABLE HOLD AS PFHOLDA FORMAT FOCUS INDEX AIR_KEY
 END
 -RUN
   
 
 -SET &&AIRPROF = IF &LINES GT 0 THEN 'Y' ELSE 'N';
  DEFINE FILE PROFFEE
   FLAG/A1 = 'D';
 -*  CITY1/A25 = IF FEE_AMT EQ 25.00 THEN 'VOD' ELSE 'SVC FEE';
   CITY1/A25 = 'SVC FEE';
   CNT/D12 = 0;
 CKEYR/A69=REVERSE(69, CAR_KEY, CKEYR);
 CKEYR1/A68=EDIT(CKEYR, '$$9999999999999999999999999999999999999999999999999999999999999999999');
 CKEY1/A69=REVERSE(82, CKEYR1, CKEY1);      
 END
 TABLE FILE PROFFEE
 PRINT BR_CL_IDX PASSNGR_NAME AS 'PAX_NM' TRN_TYPE TRN_DATE FEE_SRC FEE_AMT PAY_METHOD CREDIT_CARD FST_DPT_DATE CNT CITY1 TASF_TKT_NUM CAR_KEY
 BY FLAG
 -* BY CAR_KEY
 BY CKEY1
 WHERE CAR_KEY NE ''
 -INCLUDE &PROFDATES
 ON TABLE HOLD AS PFHOLDC FORMAT FOCUS INDEX CKEY1
 END
 -RUN
 -SET &CARPROF = IF &LINES GT 0 THEN 'Y' ELSE 'N';
 
 DEFINE FILE PROFFEE
   FLAG/A1 = 'I';
 -*  CITY1/A25 = IF FEE_AMT EQ 25.00 THEN 'VOD' ELSE 'SVC FEE';
   CITY1/A25 = 'SVC FEE';
   CNT/D12 = 0;
 HKEYR/A69=REVERSE(69, HTL_KEY, HKEYR);
 HKEYR1/A68=EDIT(HKEYR, '$$9999999999999999999999999999999999999999999999999999999999999999999');
 HKEY1/A69=REVERSE(82, HKEYR1, HKEY1);    
 END 
 TABLE FILE PROFFEE
 PRINT BR_CL_IDX PASSNGR_NAME AS 'PAX_NM' TRN_TYPE TRN_DATE FEE_SRC FEE_AMT PAY_METHOD CREDIT_CARD FST_DPT_DATE CNT CITY1 TASF_TKT_NUM HTL_KEY
 BY FLAG
 -* BY HTL_KEY
 BY HKEY1
 WHERE HTL_KEY NE ''
 -INCLUDE &PROFDATES
 ON TABLE HOLD AS PFHOLDH FORMAT FOCUS INDEX HKEY1
 END
 -RUN
 -SET &HTLPROF = IF &LINES GT 0 THEN 'Y' ELSE 'N';
 
 DEFINE FILE PROFFEE
   FLAG/A1 = 'M';
 -*  CITY1/A25 = IF FEE_AMT EQ 25.00 THEN 'VOD' ELSE 'SVC FEE';
   CITY1/A25 = 'SVC FEE';
   CNT/D12 = 0;
  ONLT/A33 = ' ';
  IDFLAG/A15=' ';  
  EXECF/A13 = ' ';
  EXCHG_SALE/A1=''; 
  DOC_TYPE/A1='';
  AGENT_NUM/A5='';

 END
-*
TABLE FILE PROFFEE
 PRINT BR_CL_IDX 
       PASSNGR_NAME 
       INVOICE_NUM 
       PNR_LOCATOR 
       TKT_NUM 
       ID_LEVEL1 
       ID_LEVEL2 
       ID_LEVEL3 
       ID_LEVEL4 
       ID_LEVEL5 
       ID_LEVEL6 
       ID_LEVEL7
       TRN_TYPE 
       TRN_DATE 
       FEE_SRC 
       FEE_AMT 
       PAY_METHOD 
       CREDIT_CARD 
       FST_DPT_DATE 
       CNT 
       TASF_TKT_NUM
-*
-* 3/29/16 - RSB - S-17009 Need to add ASSOC_CONF_NUM to PFHOLDM extract.
       ASSOC_CONF_NUM 
       ONLT
       IDFLAG
       EXECF
       TRANS_CODE
       EXCHG_SALE
       DOC_TYPE
       AGENT_NUM
BY MISC_KEY
WHERE MISC_KEY NE ''
-INCLUDE &PROFDATES
ON TABLE HOLD AS PFHOLDM FORMAT FOCUS INDEX MISC_KEY
END
-RUN

-SET &MISCPROF = IF &LINES GT 0 THEN 'Y' ELSE 'N';

-SET &&MISCPROF = '&MISCPROF.EVAL';
 
 
