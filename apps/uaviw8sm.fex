-* CHANGED CODE DUE TO DRILL DOWN NOT WORKING - DEB 11/18/13
-* Added logic for New Cost Opporunities report - JK 4/04/14
-* Added logic for New Cost Opps by Hierarchy report - JK 4/24/14
-* CHANGED Domestic online % to use DTKTS instead of NET_TKT_CNT - 6/13/14 -DEB 
-* CHANGED FEXR to use TKT_PURCH instead of NET_TKT_CNT - Deb 6/16/14
-* Added Dissavings - JK 6/18/14
-* 9/26/14 Updated to use exclude flags in % - JK
-* 12/30/14 - DEB - STORY ID S-06408 CHANGED ROUTINE FOR PREFAIR EXTRACT DUE TO DATABASE  
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 4/29/15 - DEB - S-08628 - Carried through ADDCOLLECT AIRLINE_FEE NEW_ADV_PURCH1 TO ABLDCO
-* 5/5/15 -   DEB - S-08628 - Moved AVGAP to appear before all adv purch fields and
-*                                 DISSAVINGS to appear before all exchange fields 
-*5/20/15 - DEB - S-08628 - Added HDRADDC routine to ABLDCO so add coll and pntly amts
-*                          would balance ABEXCH2
-* 06/12/15 - DEB - S-09682  added NOprefAir routine for no preferred air records
-*7/01/15 - JEK - STORY ID - S-09964 - updated programs/created new routine for add collects and airline fees for request and to balance to other reports
-*02/12/16 - DLV - S-13286  Updated to allow reports to sort/subtotal by id-levels
-*03/24/16 - JEM - S-17133 Updated to fix error when running report CG07D
-*06/29/16 - RSB - S-20630 New Employee ID database field
-*                         Added EMP_ID
-*08/10/16 - DLV - S-22735 - Added code for CGEXSM1 to make drillable
-*4/26/2017-JEM-S-33318-updated logic for no records report
-*05/05/2017-DLV-D-01482 - added NEWFULL define for FULL_EXCH so Exchange Rate % would always be
-*                         a positive number
-*09/01/17 - DLV - S-37468 - added limo data to ABLDCO


-INCLUDE SETECHO   
SET ASNAMES = ON 
-RUN   

-IF '&&SETF.EVAL' EQ 'CG07D' GOTO 07DUDID;
-IF '&&SETF.EVAL' EQ 'ABTPCO' GOTO NEWTP;
-IF '&&SETF.EVAL' EQ 'ABLDCO' GOTO NEWLD;
-IF '&&SETF.EVAL' EQ 'CGEXSM1' GOTO CONG;

TABLE FILE &&RPT_HOLD
PRINT FARE_PAID
      NET_TKT_CNT  
      TRIP_RSN
      TRIP_KEY
      TRP_DESC
BY LEVEL_DESC 
ON TABLE HOLD AS XTWO
END
-RUN


TABLE FILE XTWO
SUM FARE_PAID NET_TKT_CNT 
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS AIRHLD 
END
-RUN

 


-INCLUDE TPHTLEX
-RUN






MATCH FILE AIRHLD
PRINT FARE_PAID NET_TKT_CNT 
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD
RUN
FILE HTLHLD
SUM NNROOMS HTL_AMT HBOOK
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
AFTER MATCH HOLD AS AHHLD OLD-OR-NEW
END
-RUN


TABLE FILE AHHLD
SUM FARE_PAID NET_TKT_CNT NNROOMS HBOOK HTL_AMT
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS AHHLD1
END
-RUN

-INCLUDE TPCAREX
-RUN

MATCH FILE AHHLD1
PRINT FARE_PAID NET_TKT_CNT NNROOMS HBOOK HTL_AMT  
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
AFTER MATCH HOLD AS AHCHLD OLD-OR-NEW
END
-RUN


DEFINE FILE AHCHLD
-*TRIPDSC/A40 = IF TRP_DESC EQ ' ' THEN 'NONE GIVEN' ELSE TRP_DESC;
TRIPDSC/A40 = IF TRIP_RSN EQ 'NONE GIVEN' AND TRP_DESC EQ ' ' THEN 'NONE GIVEN' ELSE 
              IF TRIP_RSN NE ' ' AND TRP_DESC EQ ' ' THEN 'NOT ON FILE' ELSE TRP_DESC;
 
END
TABLE FILE AHCHLD
PRINT FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CAR_DAYS CAR_AMT CBOOK TRIP_KEY TRIP_RSN TRIPDSC AS 'TRP_DESC'
BY LEVEL_DESC
ON TABLE HOLD AS AHCHLD1
END
-RUN



TABLE FILE AHCHLD
SUM SUM FARE_PAID AS 'TFARE'	
    NET_TKT_CNT AS 'NTTKT'
    CAR_DAYS AS 'TCDAYS'
    NNROOMS AS 'THRMS'
BY LEVEL_DESC  
ON TABLE HOLD AS TAHC
END
-RUN

MATCH FILE AHCHLD1
PRINT FARE_PAID NET_TKT_CNT HBOOK CBOOK NNROOMS CAR_DAYS HTL_AMT CAR_AMT TRIP_KEY TRIP_RSN TRP_DESC
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE TAHC
SUM TFARE NTTK TCDAYS THRMS
BY LEVEL_DESC
AFTER MATCH HOLD AS TAHC1 OLD-OR-NEW
END
-RUN

 
DEFINE FILE TAHC1
TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' OR TRP_DESC EQ 'NONE GIVEN' THEN 'Z' ELSE 'A';
END
TABLE FILE TAHC1
PRINT FARE_PAID NET_TKT_CNT HBOOK CBOOK NNROOMS CAR_DAYS HTL_AMT CAR_AMT TFARE NTTK TCDAYS THRMS TKEY
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS TAHC2
END
-RUN

 


DEFINE FILE TAHC2  	
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADER' ELSE 'HDREXACH'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE TAHC2
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10


 
-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL


ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-IF &&OUTFMT EQ 'EXCEL' THEN GOTO SKIPdd;


-INCLUDE &&DSTY

-SKIPdd;


ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-*-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

-*EX REPORT_3

-*-SKIP_R3

-GOTO XXIT

-07DUDID;

-INCLUDE RETUDID
-RUN

TABLE FILE &&RPT_HOLD
PRINT FARE_PAID
      NET_TKT_CNT  
      LEVEL_DESC
      TKT_NUM
BY AIR_KEY  
ON TABLE HOLD AS XTWO FORMAT FOCUS INDEX AIR_KEY
END
-RUN

EX UDCG07DSM
-RUN

-IF &&CG07DSM EQ 'Y' THEN GOTO NORECORDS;



TABLE FILE XTHREE
SUM FARE_PAID NET_TKT_CNT 
BY LEVEL_DESC
BY TKT_NUM
BY 7D_DSC
ON TABLE HOLD AS AIRHLD
END
-RUN

-INCLUDE 07HTLEX
-RUN



MATCH FILE AIRHLD
PRINT FARE_PAID NET_TKT_CNT 7D_DSC
BY LEVEL_DESC
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HTLHLD
SUM NNROOMS HTL_AMT HBOOK
BY LEVEL_DESC
BY TKT_NUM
AFTER MATCH HOLD AS AHHLD OLD
END
-RUN

TABLE FILE AHHLD
PRINT FARE_PAID NET_TKT_CNT NNROOMS HBOOK HTL_AMT 7D_DSC
BY LEVEL_DESC
BY TKT_NUM
ON TABLE HOLD AS AHHLD1
END
-RUN

-INCLUDE 07CAREX
-RUN

MATCH FILE AHHLD1
PRINT FARE_PAID NET_TKT_CNT NNROOMS HBOOK HTL_AMT 7D_DSC
BY LEVEL_DESC
BY TKT_NUM
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT
BY LEVEL_DESC
BY TKT_NUM
AFTER MATCH HOLD AS AHCHLD OLD
END
-RUN

TABLE FILE AHCHLD
SUM FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CAR_DAYS CAR_AMT CBOOK 
BY LEVEL_DESC
BY 7D_DSC
ON TABLE HOLD AS AHCHLD1
END
-RUN


TABLE FILE AHCHLD
SUM SUM FARE_PAID AS 'TFARE'	
    NET_TKT_CNT AS 'NTTKT'
    CAR_DAYS AS 'TCDAYS'
    NNROOMS AS 'THRMS'
BY LEVEL_DESC  
ON TABLE HOLD AS TAHC
END
-RUN

MATCH FILE AHCHLD1
PRINT FARE_PAID NET_TKT_CNT HBOOK CBOOK NNROOMS CAR_DAYS HTL_AMT CAR_AMT 7D_DSC
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE TAHC
SUM TFARE NTTK TCDAYS THRMS
BY LEVEL_DESC
AFTER MATCH HOLD AS TAHC1 OLD-OR-NEW
END
-RUN


DEFINE FILE TAHC1  	
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
PNT/D8.1S% = IF NTTKT EQ 0 THEN 0 ELSE (NET_TKT_CNT/NTTKT)*100;
PHB/D8.1S% = IF NNROOMS EQ 0 THEN 0 ELSE (NNROOMS/THRMS)*100;
PCB/D8.1S% = IF CAR_DAYS EQ 0 THEN 0 ELSE (CAR_DAYS/TCDAYS)*100;
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADER' ELSE 'HDREXLS1'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;

TABLE FILE TAHC1
-* -INCLUDE TPHEADER
-INCLUDE &&PAHDR
"&&SUBHEAD"
"</2"
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
 &&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10




-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL


ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-* -INCLUDE &&SMSTY
-INCLUDE &&PASTYD

-IF &&OUTFMT EQ 'EXCEL' THEN GOTO SKIPdd;


-INCLUDE &&DSTY

-SKIPdd;


ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-GOTO XXIT


-NEWTP;

DEFINE FILE &&RPT_HOLD
NWFULL2/D8 = FULL_EXCH * (-1) ;                   
NEWFULL/D8 = IF NWFULL2 GE 0 THEN NWFULL2 ELSE FULL_EXCH;  
END
TABLE FILE &&RPT_HOLD
PRINT DTKTS 
      FARE_PAID
      NET_TKT_CNT 
      ONLTKTS
      TRIP_RSN
      TRIP_KEY
      TRP_DESC
      06_TKT
      713_TKT
      1420_TKT
      21_TKT 
      LEVEL_DESC
      VAL_AIRLINE
      CATEGORY
      FST_DPT_DATE
      DOM_INTL_CODE
      TRN_DATE
      NEWFULL AS 'FULL_EXCH'
      FEXR
      TKT_PURCH
BY ROLLUP_CODE      
ON TABLE HOLD AS XTWO FORMAT FOCUS INDEX ROLLUP_CODE
END
-RUN


TABLE FILE PREFAIR
PRINT ROLLUP_CODE
-*AIRLINE_CODE AIRLINE_CATEGORY TICKET_EFFECTIVE_DATE TICKET_EXPIRATION_DATE TSINT
AIRLINE_CODE AIRLINE_CATEGORY TICKET_EFFECTIVE_DATE TICKET_EXPIRATION_DATE TSINT GROUP_NUMBER DEPART_EFFECTIVE_DATE DEPART_EXPIRATION_DATE

WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS NWPREFAIR FORMAT FOCUS INDEX ROLLUP_CODE
END
-RUN 
-SET &PAIRRECS=IF &LINES EQ 0 THEN 'N' ELSE 'Y';
-RUN 

-IF '&PAIRRECS.EVAL' EQ 'N' THEN GOTO noPREFair; 

TABLE FILE NWPREFAIR
SUM GROUP_NUMBER
BY GROUP_NUMBER NOPRINT
WHERE GROUP_NUMBER NE ' '
ON TABLE SAVE AS GROUP
END
-RUN

-SET &GROUPCK = IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
-IF &GROUPCK EQ 'N' THEN GOTO Cont:

-READ GROUP &GN.A9
-CLOSE GROUP

-Cont:


JOIN CLEAR *

JOIN ROLLUP_CODE IN XTWO TO ALL ROLLUP_CODE IN NWPREFAIR AS J1
-RUN
 
DEFINE FILE XTWO
-*PREF_AIRA/I5=IF '&PAIRRECS.EVAL' EQ 'N' THEN 0 ELSE
-*            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND (FST_DPT_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND (AIRLINE_INT_DOM EQ 'B')  THEN 1 ELSE 
-*            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND (FST_DPT_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND (DOM_INTL_CODE EQ AIRLINE_INT_DOM) THEN 1 ELSE 0;
-IF &GROUPCK EQ 'Y' THEN GOTO NWPDEFINE;
PREF_AIRA/I5=IF '&PAIRRECS.EVAL' EQ 'N' THEN 0 ELSE
             IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (AIRLINE_INT_DOM EQ 'B')  THEN 1 ELSE 
            IF  (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (AIRLINE_INT_DOM EQ 'B') THEN 1 ELSE 
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) THEN 1 ELSE
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) THEN 1 ELSE 0;
-GOTO FinDefine;
-NWPDEFINE;
PREF_AIRA/I5=IF '&PAIRRECS.EVAL' EQ 'N' THEN 0 ELSE
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (AIRLINE_INT_DOM EQ 'B')  AND (BR_CL_IDX EQ GROUP_NUMBER)  THEN 1 ELSE 
            IF  (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (AIRLINE_INT_DOM EQ 'B') AND (BR_CL_IDX EQ GROUP_NUMBER) THEN 1 ELSE 
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) AND (BR_CL_IDX EQ GROUP_NUMBER) THEN 1 ELSE
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) AND (BR_CL_IDX EQ GROUP_NUMBER) THEN 1 ELSE 0;
-FinDefine
END



TABLE FILE XTWO
SUM DTKTS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIRA 
    TKT_PURCH
    COMPUTE PREF_AIR1/A1 = IF PREF_AIRA GT 0 THEN 'P' ELSE 'N';  
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
BY VAL_AIRLINE
BY TRN_DATE
BY FST_DPT_DATE
BY CATEGORY
BY DOM_INTL_CODE
ON TABLE HOLD AS XTWOA
END
-RUN

-GOTO NEXThold;

-noPREFair

DEFINE FILE XTWO
PREF_AIRA/I5  = 0;
END
TABLE FILE XTWO
SUM DTKTS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIRA 
    TKT_PURCH
    COMPUTE PREF_AIR1/A1 = IF PREF_AIRA GT 0 THEN 'P' ELSE 'N';  
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
BY VAL_AIRLINE
BY TRN_DATE
BY FST_DPT_DATE
BY CATEGORY
BY DOM_INTL_CODE
ON TABLE HOLD AS XTWOA
END
-RUN


-NEXThold;


DEFINE FILE XTWOA
PREF_AIR/P12CS = IF PREF_AIR1 EQ 'P' THEN NET_TKT_CNT ELSE 0;
END
TABLE FILE XTWOA
SUM DTKTS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIR
    TKT_PURCH

BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS AIRHLD
END
-RUN


TABLE FILE AIRHLD
PRINT DTKTS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH 
    FEXR   
    PREF_AIR
    TKT_PURCH
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS AIRHLD2
END
-RUN


 
-INCLUDE TPHTLEX
-RUN


MATCH FILE AIRHLD2
PRINT DTKTS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD
RUN
FILE HTLHLD
SUM NNROOMS NNROOMS3 HTL_AMT HBOOK PREF_NGT PREF_NGT1
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
AFTER MATCH HOLD AS AHHLD OLD-OR-NEW
END
-RUN


TABLE FILE AHHLD
SUM DTKTS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH NNROOMS NNROOMS3 HBOOK HTL_AMT PREF_NGT PREF_NGT1
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS AHHLD1
END
-RUN


-INCLUDE TPCAREX
-RUN

MATCH FILE AHHLD1
PRINT DTKTS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH HBOOK NNROOMS NNROOMS3 HTL_AMT PREF_NGT PREF_NGT1
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT CPREFB CSMC
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
AFTER MATCH HOLD AS AHCHLD OLD-OR-NEW
END
-RUN


DEFINE FILE AHCHLD
-*TRIPDSC/A40 = IF TRP_DESC EQ ' ' THEN 'NONE GIVEN' ELSE TRP_DESC;
TRIPDSC/A40 = IF TRIP_RSN EQ 'NONE GIVEN' AND TRP_DESC EQ ' ' THEN 'NONE GIVEN' ELSE 
              IF TRIP_RSN NE ' ' AND TRP_DESC EQ ' ' THEN 'NOT ON FILE' ELSE TRP_DESC;
END
TABLE FILE AHCHLD
SUM DTKTS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH HBOOK NNROOMS NNROOMS3 HTL_AMT PREF_NGT PREF_NGT1 CAR_DAYS CAR_AMT CBOOK CPREFB CSMC 
BY LEVEL_DESC
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS AHCHLD1
END
-RUN




DEFINE FILE AHCHLD
FLAG/A1 = 'A';
END
TABLE FILE AHCHLD
SUM DTKTS AS 'DTTKT'
    FARE_PAID AS 'TFARE'	
    NET_TKT_CNT AS 'NTTKT'
    CAR_DAYS/P8 AS 'TCDAYS'
    NNROOMS/P8 AS 'THRMS'
BY LEVEL_DESC
ON TABLE HOLD AS TAHC
END
-RUN


MATCH FILE AHCHLD1
PRINT DTKTS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH HBOOK CBOOK NNROOMS NNROOMS3 PREF_NGT PREF_NGT1 CAR_DAYS HTL_AMT CAR_AMT CPREFB CSMC 
      TRIP_KEY TRIP_RSN TRP_DESC 
BY LEVEL_DESC    
ON TABLE HOLD
RUN
FILE TAHC
SUM TFARE NTTKT TCDAYS THRMS DTTKT
BY LEVEL_DESC
AFTER MATCH HOLD AS TAHC1 OLD-OR-NEW
END
-RUN


DEFINE FILE TAHC1
TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' OR TRP_DESC EQ 'NONE GIVEN' THEN 'B' ELSE 'A';
END
TABLE FILE TAHC1
SUM DTKTS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH HBOOK CBOOK NNROOMS NNROOMS3 PREF_NGT PREF_NGT1 CAR_DAYS HTL_AMT CAR_AMT CPREFB CSMC TFARE NTTKT TCDAYS THRMS DTTKT
-*    COMPUTE FEXR/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE ((FULL_EXCH*(-1))/NET_TKT_CNT)*100; AS 'Exchange,Rate' 
-*    COMPUTE FEXR/P8% = IF TKT_PURCH EQ 0 THEN 0 ELSE ((FULL_EXCH*(-1))/TKT_PURCH)*100; AS 'Exchange,Rate' 

BY LEVEL_DESC
BY TKEY
BY TRIP_KEY
BY TRIP_RSN
BY TRP_DESC
ON TABLE HOLD AS TAHC2
END
-RUN


DEFINE FILE TAHC2
PNT/D8% = IF NTTKT EQ 0 THEN 0 ELSE NET_TKT_CNT/NTTKT*100; 
HNTP/D8% = IF THRMS EQ 0 THEN 0 ELSE NNROOMS/THRMS*100;
CNTP/D8% = IF TCDAYS EQ 0 THEN 0 ELSE CAR_DAYS/TCDAYS*100;

NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADER' ELSE 'HDREXACH'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE TAHC2
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
SUM FARE_PAID/D12.2CSM AS 'Air,Volume'
    NET_TKT_CNT AS 'Net,Tickets'
    PNT AS '% Net,Tkts'
    COMPUTE ATP/D12.2CSM = IF NET_TKT_CNT EQ 0 THEN 0 ELSE FARE_PAID/NET_TKT_CNT; AS 'Average,Ticket,Price' 
-*    COMPUTE PONL/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE ONLTKTS/NET_TKT_CNT*100; AS 'Domestic,Online,Booking %'
    COMPUTE PONL/P8% = IF DTKTS EQ 0 THEN 0 ELSE ONLTKTS/DTKTS*100; AS 'Domestic,Online,Booking %'
    COMPUTE PAP1/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 06_TKT/NET_TKT_CNT*100; AS '% 0-6,Advanced,Tickets'
    COMPUTE PAP2/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 713_TKT/NET_TKT_CNT*100; AS '% 7-13,Advanced,Tickets'
    COMPUTE PAP3/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 1420_TKT/NET_TKT_CNT*100; AS '% 14-20,Advanced,Tickets'
    COMPUTE PAP4/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 21_TKT/NET_TKT_CNT*100; AS '% 21+,Advanced,Tickets'
    COMPUTE APP/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE PREF_AIR/NET_TKT_CNT*100; AS '% Preferred,Airline'
-*  COMPUTE FEXR/P8% = IF TKT_PURCH EQ 0 THEN 0 ELSE ((FULL_EXCH*(-1))/TKT_PURCH)*100; AS 'Exchange,Rate' 
    COMPUTE FEXR/P8% = IF TKT_PURCH EQ 0 THEN 0 ELSE (FULL_EXCH/TKT_PURCH)*100; AS 'Exchange,Rate' 
    HTL_AMT/D12.2CSM AS 'Hotel,Volume'
    NNROOMS/P8CS AS 'Hotel,Nights'
    HNTP AS '% Hotel,Nights'
    COMPUTE ANR/D12.2CSM = IF NNROOMS EQ 0 THEN 0 ELSE HTL_AMT/NNROOMS; AS 'Average,Nightly,Rate'
    COMPUTE PHTL/P8% = IF NNROOMS EQ 0 THEN 0 ELSE PREF_NGT1/NNROOMS3*100; AS '% Preferred,Hotel,Nights*'
    CAR_AMT/D12.2CSM AS 'Car,Volume'
    CAR_DAYS/P8CS AS 'Car,Days'
    COMPUTE ADR/D12.2CSM = IF CAR_DAYS EQ 0 THEN 0 ELSE CAR_AMT/CAR_DAYS; AS 'Average,Daily,Rate'
    CNTP AS '% Car,Days'
    COMPUTE PCAR/P8% = IF CBOOK EQ 0 THEN 0 ELSE CPREFB/CBOOK*100; AS '% Preferred,Car,Bookings'  
    COMPUTE SCAR/P8% = IF CBOOK EQ 0 THEN 0 ELSE CSMC/CBOOK*100; AS '% Cars,Larger,Than Midsize'   
    
BY LEVEL_DESC NOPRINT
BY TKEY NOPRINT
BY TRIP_RSN AS 'Trip,Purpose'
BY TRP_DESC AS 'Trip,Description'
ON LEVEL_DESC RECOMPUTE MULTILINES AS 'TOTAL FOR'
ON TABLE NOTOTAL



-INCLUDE FOOTERSM
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"


ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=SUBTOTAL, JUSTIFY=LEFT, $
TYPE=GRANDTOTAL, JUSTIFY=LEFT, $

-IF &&OUTFMT EQ 'EXCEL' THEN GOTO SKIPdd;


-INCLUDE &&DSTY

-SKIPdd;


ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-GOTO XXIT

-NEWLD;
 
DEFINE FILE &&RPT_HOLD
NWFULL2/D8 = FULL_EXCH * (-1) ;                   
NEWFULL/D8 = IF NWFULL2 GE 0 THEN NWFULL2 ELSE FULL_EXCH;  
END
TABLE FILE &&RPT_HOLD
PRINT DTKTS
      DISSAVINGS
      FARE_PAID
      NET_TKT_CNT 
      ONLTKTS
      06_TKT
      713_TKT
      1420_TKT
      21_TKT 
      LEVEL_DESC
      VAL_AIRLINE
      CATEGORY
      FST_DPT_DATE
      DOM_INTL_CODE
      TRN_DATE
      NEWFULL AS 'FULL_EXCH'
      FEXR
      TKT_PURCH
      NEW_ADV_PURCH1
BY ROLLUP_CODE      
ON TABLE HOLD AS XTWO FORMAT FOCUS INDEX ROLLUP_CODE
END
-RUN


TABLE FILE PREFAIR
PRINT ROLLUP_CODE
-*AIRLINE_CODE AIRLINE_CATEGORY TICKET_EFFECTIVE_DATE TICKET_EXPIRATION_DATE TSINT
AIRLINE_CODE AIRLINE_CATEGORY TICKET_EFFECTIVE_DATE TICKET_EXPIRATION_DATE TSINT GROUP_NUMBER DEPART_EFFECTIVE_DATE DEPART_EXPIRATION_DATE

WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS NWPREFAIR FORMAT FOCUS INDEX ROLLUP_CODE
END
-RUN 
-SET &PAIRRECS=IF &LINES EQ 0 THEN 'N' ELSE 'Y';
-RUN 



-IF '&PAIRRECS.EVAL' EQ 'N' GOTO NOprefAir;


TABLE FILE NWPREFAIR
SUM GROUP_NUMBER
BY GROUP_NUMBER NOPRINT
WHERE GROUP_NUMBER NE ' '
ON TABLE SAVE AS GROUP1
END
-RUN

-SET &GROUPCK2 = IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
-IF &GROUPCK2 EQ 'N' THEN GOTO Cont2:

-READ GROUP1 &GN.A9
-CLOSE GROUP1

-Cont2:

JOIN CLEAR *

JOIN ROLLUP_CODE IN XTWO TO ALL ROLLUP_CODE IN NWPREFAIR AS J1
-RUN
 
DEFINE FILE XTWO
-*PREF_AIRA/I5=IF '&PAIRRECS.EVAL' EQ 'N' THEN 0 ELSE
-*            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND (FST_DPT_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND (AIRLINE_INT_DOM EQ 'B')  THEN 1 ELSE 
-*            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND (FST_DPT_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND (DOM_INTL_CODE EQ AIRLINE_INT_DOM) THEN 1 ELSE 0;
-IF &GROUPCK2 EQ 'Y' THEN GOTO NWPDEFINE2;
PREF_AIRA/I5=IF '&PAIRRECS.EVAL' EQ 'N' THEN 0 ELSE
             IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (AIRLINE_INT_DOM EQ 'B')  THEN 1 ELSE 
            IF  (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (AIRLINE_INT_DOM EQ 'B') THEN 1 ELSE 
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) THEN 1 ELSE
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) THEN 1 ELSE 0;
-GOTO FinDefine2;
-NWPDEFINE2;
PREF_AIRA/I5=IF '&PAIRRECS.EVAL' EQ 'N' THEN 0 ELSE
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (AIRLINE_INT_DOM EQ 'B')  AND (BR_CL_IDX EQ GROUP_NUMBER)  THEN 1 ELSE 
            IF  (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (AIRLINE_INT_DOM EQ 'B') AND (BR_CL_IDX EQ GROUP_NUMBER) THEN 1 ELSE 
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (FST_DPT_DATE FROM DEPART_EFFECTIVE_DATE TO DEPART_EXPIRATION_DATE) AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) AND (BR_CL_IDX EQ GROUP_NUMBER) THEN 1 ELSE
            IF (VAL_AIRLINE EQ AIRLINE_CODE) AND (CATEGORY EQ AIRLINE_CATEGORY) AND 
               (TRN_DATE FROM TICKET_EFFECTIVE_DATE TO TICKET_EXPIRATION_DATE) AND 
               (DEPART_EFFECTIVE_DATE EQ ' ') AND 
               (DOM_INTL_CODE EQ AIRLINE_INT_DOM) AND (BR_CL_IDX EQ GROUP_NUMBER) THEN 1 ELSE 0;
-FinDefine2
END

TABLE FILE XTWO
SUM DTKTS 
    DISSAVINGS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIRA 
    TKT_PURCH
    COMPUTE PREF_AIR1/A1 = IF PREF_AIRA GT 0 THEN 'P' ELSE 'N';  
BY LEVEL_DESC
BY VAL_AIRLINE
BY TRN_DATE
BY FST_DPT_DATE
BY CATEGORY
BY DOM_INTL_CODE
BY NEW_ADV_PURCH1
ON TABLE HOLD AS XTWOA
END
-RUN

-GOTO NextHold;

-NOprefAir

DEFINE FILE XTWO
PREF_AIRA/I5= 0;
END
TABLE FILE XTWO
SUM DTKTS 
    DISSAVINGS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIRA 
    TKT_PURCH
    COMPUTE PREF_AIR1/A1 = IF PREF_AIRA GT 0 THEN 'P' ELSE 'N';  


BY LEVEL_DESC
BY VAL_AIRLINE
BY TRN_DATE
BY FST_DPT_DATE
BY CATEGORY
BY DOM_INTL_CODE
BY NEW_ADV_PURCH1
ON TABLE HOLD AS XTWOA
END
-RUN

  


-NextHold


DEFINE FILE XTWOA
PREF_AIR/P12CS = IF PREF_AIR1 EQ 'P' THEN NET_TKT_CNT ELSE 0;
TTLDAYS/D8 = NEW_ADV_PURCH1*NET_TKT_CNT;
END
TABLE FILE XTWOA
SUM DTKTS
    DISSAVINGS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR
 
    PREF_AIR
    TKT_PURCH
    TTLDAYS
BY LEVEL_DESC
ON TABLE HOLD AS AIRHLD2
END
-RUN 




-INCLUDE HDRADDC
-RUN

 
TABLE FILE EXHOLD2
SUM AC_AMT PNLTY_AMT
BY LEVEL_DESC
ON TABLE HOLD AS EXCAIR2
END
-RUN 


MATCH FILE AIRHLD2
PRINT DTKTS
    DISSAVINGS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIR
    TKT_PURCH
    TTLDAYS
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE EXCAIR2
SUM AC_AMT PNLTY_AMT
BY LEVEL_DESC
AFTER MATCH HOLD AS AIRHLD3 OLD-OR-NEW
END
-RUN


TABLE FILE AIRHLD3
PRINT DTKTS
    DISSAVINGS
    FARE_PAID
    NET_TKT_CNT 
    ONLTKTS
    06_TKT
    713_TKT
    1420_TKT
    21_TKT  
    FULL_EXCH
    FEXR   
    PREF_AIR
    TKT_PURCH
    TTLDAYS
    AC_AMT PNLTY_AMT
BY LEVEL_DESC
ON TABLE HOLD AS AIRHLD
END
-RUN




-INCLUDE TPHTLEX
-RUN


MATCH FILE AIRHLD
PRINT DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HTLHLD
SUM NNROOMS NNROOMS3 HTL_AMT HBOOK PREF_NGT PREF_NGT1
BY LEVEL_DESC
AFTER MATCH HOLD AS AHHLD OLD-OR-NEW
END
-RUN
 

TABLE FILE AHHLD
SUM DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS NNROOMS NNROOMS3 HBOOK HTL_AMT PREF_NGT PREF_NGT1
BY LEVEL_DESC
ON TABLE HOLD AS AHHLD1
END
-RUN

 


-INCLUDE TPCAREX
-RUN


MATCH FILE AHHLD1
PRINT DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS NNROOMS NNROOMS3 HBOOK HTL_AMT PREF_NGT PREF_NGT1
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT CPREFB CSMC
BY LEVEL_DESC
AFTER MATCH HOLD AS AHCHLD OLD-OR-NEW
END
-RUN




-INCLUDE TPLIMEX
-RUN

-IF &&NOLIMREC EQ 'Y' THEN GOTO NOlimo;

MATCH FILE AHCHLD
PRINT DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS HBOOK NNROOMS NNROOMS3 HTL_AMT PREF_NGT PREF_NGT1
      NNROOMS NNROOMS3 HTL_AMT HBOOK PREF_NGT PREF_NGT1 CBOOK CAR_DAYS CAR_AMT CPREFB CSMC
BY LEVEL_DESC
ON TABLE HOLD
RUN 
FILE LIMHLD
SUM LBOOK LIM_DAYS LIM_AMT LPREFB
BY LEVEL_DESC
AFTER MATCH HOLD AS XACHL OLD-OR-NEW
END
-RUN


DEFINE FILE XACHL
FLAG/A1 = 'A';
END
TABLE FILE XACHL
SUM DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS HBOOK NNROOMS NNROOMS3 HTL_AMT PREF_NGT PREF_NGT1
      CBOOK CAR_DAYS CAR_AMT CPREFB CSMC LBOOK LIM_DAYS LIM_AMT LPREFB 
BY FLAG
BY LEVEL_DESC
ON TABLE HOLD AS AHCHLHLD
END
 
JOIN CLEAR *
-RUN


-GOTO SkipNOlimo;

-NOlimo; 



DEFINE FILE AHCHLD
FLAG/A1 = 'A';
LBOOK/P8CS = 0;
LIM_DAYS/D12 = 0;
LIM_AMT/D12.2CS = 0;
LPREFB/P8CS = 0;
END
TABLE FILE AHCHLD
SUM DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS HBOOK NNROOMS NNROOMS3
    HTL_AMT PREF_NGT PREF_NGT1 CAR_DAYS CAR_AMT CBOOK CPREFB CSMC LBOOK LIM_DAYS LIM_AMT LPREFB
BY FLAG
BY LEVEL_DESC
ON TABLE HOLD AS AHCHLHLD
END
-RUN


-SkipNOlimo;
 

DEFINE FILE AHCHLHLD
FLAG/A1 = 'A';
END
TABLE FILE AHCHLHLD
SUM FARE_PAID AS 'TFARE'	
    NET_TKT_CNT AS 'NTTKT'
    CAR_DAYS/P8 AS 'TCDAYS'
    NNROOMS/P8 AS 'THRMS'
    LBOOK/P8 AS 'TLBOOK'
BY FLAG
ON TABLE HOLD AS TAHC
END
-RUN



MATCH FILE AHCHLHLD
PRINT DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS HBOOK CBOOK NNROOMS NNROOMS3 PREF_NGT PREF_NGT1
      CAR_DAYS HTL_AMT CAR_AMT CPREFB CSMC LBOOK LIM_DAYS LIM_AMT LPREFB LEVEL_DESC
BY FLAG    
ON TABLE HOLD
RUN
FILE TAHC
SUM TFARE NTTKT TCDAYS THRMS TLBOOK
BY FLAG
AFTER MATCH HOLD AS TAHC1 OLD-OR-NEW
END
-RUN

TABLE FILE TAHC1
SUM DTKTS DISSAVINGS FARE_PAID NET_TKT_CNT ONLTKTS 06_TKT 713_TKT 1420_TKT 21_TKT PREF_AIR FULL_EXCH FEXR TKT_PURCH AC_AMT PNLTY_AMT TTLDAYS HBOOK CBOOK NNROOMS NNROOMS3 PREF_NGT PREF_NGT1
CAR_DAYS HTL_AMT CAR_AMT CPREFB CSMC LBOOK LIM_DAYS LIM_AMT LPREFB TFARE NTTKT TCDAYS THRMS TLBOOK
BY LEVEL_DESC
ON TABLE HOLD AS TAHC2
END
-RUN


 


 

 

DEFINE FILE TAHC2
PNT/D8% = IF NTTKT EQ 0 THEN 0 ELSE NET_TKT_CNT/NTTKT*100;
HNTP/D8% = IF THRMS EQ 0 THEN 0 ELSE NNROOMS/THRMS*100;
CNTP/D8% = IF TCDAYS EQ 0 THEN 0 ELSE CAR_DAYS/TCDAYS*100;
LNTP/D8% = IF TLBOOK EQ 0 THEN 0 ELSE LBOOK/TLBOOK*100;

NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADER' ELSE 'HDREXACH'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN




TABLE FILE TAHC2
-INCLUDE &&PAHDR
SUM FARE_PAID/D12.2CSM AS 'Air,Volume'
    NET_TKT_CNT AS 'Net,Tickets'
    PNT AS '% Net,Tkts'
    COMPUTE ATP/D12.2CSM = IF NET_TKT_CNT EQ 0 THEN 0 ELSE FARE_PAID/NET_TKT_CNT; AS 'Average,Ticket,Price' 
-*  COMPUTE PONL/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE ONLTKTS/NET_TKT_CNT*100; AS 'Domestic,Online,Booking %'
    COMPUTE PONL/P8% = IF DTKTS EQ 0 THEN 0 ELSE ONLTKTS/DTKTS*100; AS 'Domestic,Online,Booking %'
    COMPUTE AVGAP/P8= IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TTLDAYS/NET_TKT_CNT); AS 'Average,Advance,Purchase,  Days'

    COMPUTE PAP1/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 06_TKT/NET_TKT_CNT*100; AS '% 0-6,Advanced,Tickets'
    COMPUTE PAP2/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 713_TKT/NET_TKT_CNT*100; AS '% 7-13,Advanced,Tickets'
    COMPUTE PAP3/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 1420_TKT/NET_TKT_CNT*100; AS '% 14-20,Advanced,Tickets'
    COMPUTE PAP4/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE 21_TKT/NET_TKT_CNT*100; AS '% 21+,Advanced,Tickets'
    COMPUTE APP/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE PREF_AIR/NET_TKT_CNT*100; AS '% Preferred,Airline'
-*    COMPUTE FEXR/P8% = IF NET_TKT_CNT EQ 0 THEN 0 ELSE ((FULL_EXCH*(-1))/NET_TKT_CNT)*100; AS 'Exchange,Rate' 
    DISSAVINGS/D12.2CSM AS 'Lost,Savings,Amount'

-*    COMPUTE FEXR/P8% = IF TKT_PURCH EQ 0 THEN 0 ELSE ((FULL_EXCH*(-1))/TKT_PURCH)*100; AS 'Exchange,Rate' 

    
    COMPUTE FEXR/P8% = IF TKT_PURCH EQ 0 THEN 0 ELSE (FULL_EXCH/TKT_PURCH)*100; AS 'Exchange,Rate' 

-*    ADD_AMT/D12.2CSM AS 'Additional,Collection'
    AC_AMT/D12.2CSM AS 'Additional,Collection'  
-*    AIRLINE_FEE/D12.2CSM AS 'Forfeit,Penalty,Amount'
    PNLTY_AMT/D12.2CSM AS 'Forfeit,Penalty,Amount'
    HTL_AMT/D12.2CSM AS 'Hotel,Volume'
    NNROOMS/P8CS AS 'Hotel,Nights'
    HNTP AS '% Hotel,Nights'
    COMPUTE ANR/D12.2CSM = IF NNROOMS EQ 0 THEN 0 ELSE HTL_AMT/NNROOMS; AS 'Average,Nightly,Rate'
    COMPUTE PHTL/P8% = IF NNROOMS EQ 0 THEN 0 ELSE PREF_NGT1/NNROOMS3*100; AS '% Preferred,Hotel,Nights*'
    CAR_AMT/D12.2CSM AS 'Car,Volume'
    CAR_DAYS/P8CS AS 'Car,Days'
    COMPUTE ADR/D12.2CSM = IF CAR_DAYS EQ 0 THEN 0 ELSE CAR_AMT/CAR_DAYS; AS 'Average,Daily,Rate'
    CNTP AS '% Car,Days'
    COMPUTE PCAR/P8% = IF CBOOK EQ 0 THEN 0 ELSE CPREFB/CBOOK*100; AS '% Preferred,Car,Bookings'  
    COMPUTE SCAR/P8% = IF CBOOK EQ 0 THEN 0 ELSE CSMC/CBOOK*100; AS '% Cars,Larger,Than Midsize'   
-IF &&NOLIMREC EQ 'Y' THEN GOTO NOlimDisplay;
    LIM_AMT/D12.2CSM AS 'Limo,Volume'
    LBOOK/P8CS AS 'Limo,Bookings'
    COMPUTE LADR/D12.2CSM = IF LBOOK EQ 0 THEN 0 ELSE LIM_AMT/LBOOK; AS 'Average,Daily,Rate'
    LNTP AS '% Limo,Bookings'
-NOlimDisplay;
BY LEVEL_DESC AS 'Hierarchy'
ON LEVEL_DESC RECOMPUTE MULTILINES AS 'TOTAL FOR'

 

-INCLUDE FOOTERSM
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
" FORFEIT PENALTIES ARE INCLUDED IN THE ADDITIONAL COLLECTION AMOUNT "

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=SUBTOTAL, JUSTIFY=LEFT, $
TYPE=GRANDTOTAL, JUSTIFY=LEFT, $
TYPE=REPORT, COLUMN=N1, WRAP=2.5,$
TYPE=REPORT, COLUMN=N2, WRAP=1.0,$
TYPE=REPORT, COLUMN=N3, WRAP=0.75,$
TYPE=REPORT, COLUMN=N4, WRAP=0.75,$
TYPE=REPORT, COLUMN=N5, WRAP=0.75,$
TYPE=REPORT, COLUMN=N6, WRAP=0.75,$
TYPE=REPORT, COLUMN=N7, WRAP=0.75,$
TYPE=REPORT, COLUMN=N8, WRAP=0.75,$
TYPE=REPORT, COLUMN=N9, WRAP=0.75,$
TYPE=REPORT, COLUMN=N10, WRAP=0.75,$
TYPE=REPORT, COLUMN=N11, WRAP=0.75,$
TYPE=REPORT, COLUMN=N12, WRAP=0.75,$
TYPE=REPORT, COLUMN=N13, WRAP=1.0,$
TYPE=REPORT, COLUMN=N14, WRAP=1.0,$
TYPE=REPORT, COLUMN=N15, WRAP=1.0,$
TYPE=REPORT, COLUMN=N16, WRAP=0.75,$
TYPE=REPORT, COLUMN=N17, WRAP=1.0,$
TYPE=REPORT, COLUMN=N18, WRAP=0.75,$
TYPE=REPORT, COLUMN=N19, WRAP=0.75,$
TYPE=REPORT, COLUMN=N20, WRAP=0.75,$
TYPE=REPORT, COLUMN=N21, WRAP=0.75,$
TYPE=REPORT, COLUMN=N22, WRAP=1.0,$
TYPE=REPORT, COLUMN=N23, WRAP=0.75,$
TYPE=REPORT, COLUMN=N24, WRAP=0.75,$
TYPE=REPORT, COLUMN=N25, WRAP=0.75,$
TYPE=REPORT, COLUMN=N26, WRAP=0.75,$
TYPE=REPORT, COLUMN=N27, WRAP=0.75,$
TYPE=REPORT, COLUMN=N28, WRAP=0.75,$
TYPE=REPORT, COLUMN=N29, WRAP=0.75,$
TYPE=REPORT, COLUMN=N30, WRAP=0.75,$
TYPE=REPORT, COLUMN=N31, WRAP=0.75,$




-IF &&OUTFMT EQ 'EXCEL' THEN GOTO SKIPdd;


-INCLUDE &&DSTY

-SKIPdd;


ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-GOTO XXIT



-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT;

-CONG;
DEFINE FILE &&RPT_HOLD
-*AD_COL/D12.2CS = IF EXCHG_SALE NE ' ' THEN ADDCOLLECT ELSE 0;
AD_COL/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN ADDCOLLECT ELSE 0;
FPAID2/D12.2CS = IF EMBARK NE 'DT1' AND EX_FLAG NE ' ' AND TKT_NUM NE LAST TKT_NUM THEN FARE_PAID2 ELSE 0;
NEW_EXAP/D9 = IF EXCHG_SALE NE ' ' THEN NEW_ADV_PURCH1 ELSE 0;
NEW_EXCNT/D9 = IF EXCHG_SALE NE ' ' THEN NET_TKT_CNT ELSE 0;

END
TABLE FILE &&RPT_HOLD
PRINT 
  06_TKT
  1420_TKT
  21_TKT
  713_TKT
  AD_COL AS 'ADDCOLLECT'
  ADV_CAT
  ADV_DAYS 
  AGENT_NUM
  AIR_KEY
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NAME
  AROLL_DSC3
  AROLL_DSC4
  AROLL_LEV3
  ARR_TIME
  BASE_FARE
  BR_CL_IDX
  C_ITIN
  CATEGORY
  CC_NUM
  CL_CAT
  CLASS
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DOM_INTL_CODE 
  DPT_TIME
  DTKTS
  ECNTRY 
  EMB_APT_CD
  EMB_APT_NM
  EMB_CTY_NM
  EMBARK
  EX_FLAG
  EXCHG_SALE
  EXG_ISS
  FARE_BAS
  FARE_PAID
  FPAID2 AS 'FARE_PAID2'
  FEXR
  FLIGHT
  FST_DPT_DATE
  FULL_EXCH
  FULL_EXCH
  INTL_DOM 
  INVOICE_NUM
  LEVEL_DESC
  EMP_ID
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LOWEST_AMT
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_ADV_PURCH1
  NEW_SEG_AMT
  NEW_SEG_DISC
  NEW_SEG_LOW
  NEW_SEG_MILES
  NFVSV
  ONLTKTS
  ORG_SALE
  OTFLAG
  PEXG_ISS
  PNR_LOCATOR
  RCNTRY
  REF_EXCH_CNT
  REFUSAL_DESC
  REFUSE_CODE
  REFUSE_KEY   
  ROLLUP_CODE
  RTE_APT_CD 
  RTE_APT_NM 
  RTE_CNTRY_CODE 
  RTE_CTY_NM 
  SAVINGS
  SEG_AMT
  SEG_COUNT
  SEG_DESIG
  SEG_LOWEST
  SEG_STANDARD
  SEG_TAX
  STD_FARE
  TKT_AMT
  TKT_DATE
  TKT_NUM
  TKT_PURCH
  TKT_SORT
  TKT_TYP2
  TKT_TYPE
  TRIP_KEY
  TRIP_PURPOSE
  TRIP_RSN
  TRN_DATE
  TRP_DESC 
  VAL_AIRLINE
  VOID_DATE
  XARR_DT
  XDPT_DT
  XFNL_DT
  XFST_DT
  XPSNGR_NM
  XTRAN_DT
  PEXG_ISS1
  NEW_EXAP
  NEW_EXCNT
BY LEVEL_DESC  
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS AIRHLD2
END
-RUN
 
DEFINE FILE AIRHLD2
NW_EXAP/D9 = IF NEW_EXAP EQ 0 THEN 0 ELSE
             IF (TKT_SORT NE LAST TKT_SORT) AND (NEW_EXCNT GE 0) THEN NEW_EXAP ELSE
                 IF (TKT_SORT NE LAST TKT_SORT) AND (NEW_EXCNT LT 0) THEN NEW_EXAP * (-1) ELSE NEW_EXAP;
END
TABLE FILE AIRHLD2
SUM FARE_PAID TKT_PURCH EXG_ISS  PEXG_ISS1  NW_EXAP NEW_EXCNT NEW_EXAP
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHLD2A 
END
-RUN





-*-INCLUDE EXCHADDC
-INCLUDE HDRADDC
-RUN

TABLE FILE EXHOLD2
SUM AC_AMT PNLTY_AMT PEXG_ISS AP_DAYS
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS EXCAIR2
END
-RUN 
 
MATCH FILE AIRHLD2A
SUM FARE_PAID TKT_PURCH EXG_ISS PEXG_ISS1 NW_EXAP NEW_EXCNT NEW_EXAP
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD
RUN
FILE EXCAIR2
PRINT AC_AMT PNLTY_AMT AP_DAYS
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN


 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

DEFINE FILE XTHREE
CGEX_CNT/D8CS = EXG_ISS + PEXG_ISS;  

NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
              
END


TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;



    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10

    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10

-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10


-INCLUDE FOOTERSM
-* ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
-IF &&PASTYS EQ 'SMEXL' GOTO EXLCONG;


ON TABLE SET STYLE *



-IF &&OVERDRILL EQ 'Y' GOTO OVERDRILL;

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N2, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='NETVOL' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N3, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='TKTPUR' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N4, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='FULLEX' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N5, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='PARTEX' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N7, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='ADDCOL' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N8, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='AIRFEE' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $
-GOTO DEB;
TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N8, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='FULLRF' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N10, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='ADVP' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $
 
-TYPE &&OVERDRILL
 

-INCLUDE GLOBAL_LOGO_SM
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.500000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, JUSTIFY=LEFT, $
TYPE=HEADING, OBJECT=TEXT, SIZE=8, COLOR=BLACK, $
TYPE=HEADING, LINE=4, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=5, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=6, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=7, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=8, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=10, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=11, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=12, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=FOOTING, SIZE=7, STYLE=BOLD, COLOR=GREY, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBFOOT, SIZE=8, JUSTIFY=LEFT, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=8, JUSTIFY=LEFT, STYLE=BOLD, $
TYPE=GRANDTOTAL, SIZE=8, JUSTIFY=LEFT, STYLE=BOLD, $
TYPE=REPORT, COLUMN=N1, JUSTIFY=LEFT, SQUEEZE=2.0, $
TYPE=REPORT, COLUMN=N2, JUSTIFY=LEFT, SQUEEZE=1.2, $
TYPE=REPORT, COLUMN=N3, JUSTIFY=LEFT, SQUEEZE=1.2, $
TYPE=REPORT, COLUMN=N4, JUSTIFY=LEFT, SQUEEZE=1.0, $
TYPE=REPORT, COLUMN=N5, JUSTIFY=LEFT, SQUEEZE=1.0, $
TYPE=REPORT, COLUMN=N6, JUSTIFY=LEFT, SQUEEZE=1.0, $
TYPE=REPORT, COLUMN=N7, JUSTIFY=LEFT, SQUEEZE=1.0, $
TYPE=REPORT, COLUMN=N8, JUSTIFY=LEFT, SQUEEZE=1.2, $
TYPE=REPORT, COLUMN=N9, JUSTIFY=LEFT, SQUEEZE=1.2, $
TYPE=REPORT, COLUMN=N10, JUSTIFY=LEFT, SQUEEZE=1.2, $
TYPE=REPORT, COLUMN=N11, JUSTIFY=LEFT, SQUEEZE=1.2, $


TYPE=REPORT, IMAGE=&&TNTPIC,  POSITION=(&&TNTSMPOS), SIZE=(&&TNTSMSIZ), $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLSMPOS), SIZE=(&&ROLSMSIZ), $



ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-GOTO NXT;

-EXLCONG;


ON TABLE SET STYLE *



 

-IF &&OVERDRILL EQ 'Y' GOTO OVERDRILL2;

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N2, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='NETVOL' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N3, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='TKTPUR' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N4, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='FULLEX' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N5, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='PARTEX' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N7, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='ADDCOL' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $

TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N8, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='AIRFEE' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $
 
TYPE=DATA, COLOR=RGB(0 0 138), JUSTIFY=LEFT, COLUMN=N10, \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='DREXSM' ROW_LABEL=N1 FLAG='ADVP' LSEL=LEVEL_DESC PARM2='&&IDLEVELBREAK.EVAL'\
 SETFNM='&&DTTMSTRM.EVAL' \
 FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'), $



-OVERDRILL2;
-INCLUDE GLOBAL_LOGO_SM
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.500000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=2, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=2, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=10, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=10, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=2, JUSTIFY=LEFT, $

TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
     
TYPE=FOOTING, FONT=ARIAL, COLOR=GRAY,$

TYPE=SUBHEAD,
     SIZE=9,
     STYLE=BOLD,
$

TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8, 
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$

TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=9,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$


TYPE=SUBFOOT, SIZE=8, JUSTIFY=LEFT, STYLE=BOLD, $

TYPE=SUBTOTAL, 
     STYLE=BOLD, 
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
     
TYPE=GRANDTOTAL, JUSTIFY=LEFT, STYLE=BOLD, $

-IF &&SETF EQ 'CGEXSM1' GOTO CONGSTY;


TYPE=REPORT, COLUMN=N1, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N2, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N3, JUSTIFY=LEFT, SQUEEZE=.6, $
TYPE=REPORT, COLUMN=N4, JUSTIFY=LEFT, SQUEEZE=.6, $
TYPE=REPORT, COLUMN=N5, JUSTIFY=LEFT, SQUEEZE=.7, $
TYPE=REPORT, COLUMN=N6, JUSTIFY=LEFT, SQUEEZE=.6, $
TYPE=REPORT, COLUMN=N7, JUSTIFY=LEFT, SQUEEZE=.6, $
TYPE=REPORT, COLUMN=N8, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N9, JUSTIFY=LEFT, SQUEEZE=1, $
-GOTO XXITSTY;
-CONGSTY;
TYPE=REPORT, COLUMN=N1, JUSTIFY=LEFT, SQUEEZE=2.5, $
TYPE=REPORT, COLUMN=N2, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N3, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N4, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N5, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N6, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N7, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N8, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N9, JUSTIFY=LEFT, SQUEEZE=1, $
TYPE=REPORT, COLUMN=N10, JUSTIFY=LEFT, SQUEEZE=1, $



-XXITSTY;
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN


-GOTO XXIT



-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN




-GOTO XXIT;

-XXIT



-*-*-EXIT




