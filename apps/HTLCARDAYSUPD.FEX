

SET ASNAMES=ON
-* -SET &ECHO=ALL;
-* -INCLUDE SETECHO


TABLE FILE ROLLUP
PRINT COMP 
-* WHERE QTR_ENABLE EQ 'X'
-* WHERE UPD_ENABLE NE ' '
-* WHERE LOAD_GRP EQ ''
-* WHERE ROLLUP_CODE NE 'ARCH-R'
-* WHERE ROLLUP_CODE NE 'TOTAL-R' OR 'ABCD-R' OR 'ABCD2-R' OR 'ABCD3-R' OR 'AMERUS-R'
WHERE ROLLUP_CODE EQ 'KIEWIT-R'
ON TABLE SAVE AS CUSTOMER
END
-RUN 



-SET &TOTROLLS = &LINES;
 


-GetCount

-SET &CNT = 0;
-REPEAT Loop1 &TOTROLLS TIMES
-READ CUSTOMER NOCLOSE &VAL.6.
-IF &VAL EQ ' ' THEN GOTO Loop1;
-SET &CNT = &CNT + 1;
-SET &COMP.&CNT = &VAL;

-Loop1
-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &COMPNY = &COMP.&CNT;
-RUN


-SET &DATAPATH='&&DATASRV.EVAL' || '\TNT\TTRACKER\DATA\';
-SET &&COMP1A = 'A1' || '&COMPNY.EVAL';
-SET &&COMP2A = 'A2' || '&COMPNY.EVAL';
-SET &&COMP3A = 'A3' || '&COMPNY.EVAL';
-SET &&COMP4A = 'A4' || '&COMPNY.EVAL';
-SET &&COMP5A = 'A5' || '&COMPNY.EVAL';
-SET &&COMP6A = 'A6' || '&COMPNY.EVAL';
-SET &&COMP7A = 'A7' || '&COMPNY.EVAL';
-SET &&COMP8A = 'A8' || '&COMPNY.EVAL';
-SET &&COMP9A = 'A9' || '&COMPNY.EVAL';
-SET &&COMP0A = 'A0' || '&COMPNY.EVAL';
-SET &&COMPYA = 'AY' || '&COMPNY.EVAL';
-SET &&COMPZA = 'AZ' || '&COMPNY.EVAL';


-SET &&COMP1A1 = '&DATAPATH.EVAL' || 'A1' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP2A1 = '&DATAPATH.EVAL' || 'A2' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP3A1 = '&DATAPATH.EVAL' || 'A3' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP4A1 = '&DATAPATH.EVAL' || 'A4' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP5A1 = '&DATAPATH.EVAL' || 'A5' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP6A1 = '&DATAPATH.EVAL' || 'A6' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP7A1 = '&DATAPATH.EVAL' || 'A7' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP8A1 = '&DATAPATH.EVAL' || 'A8' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP9A1 = '&DATAPATH.EVAL' || 'A9' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP0A1 = '&DATAPATH.EVAL' || 'A0' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPYA1 = '&DATAPATH.EVAL' || 'AY' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPZA1 = '&DATAPATH.EVAL' || 'AZ' || '&COMPNY.EVAL' || '.FOC';

-* SEGMENT USES
-SET &&COMP1S1 = '&DATAPATH.EVAL' || 'S1' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP2S1 = '&DATAPATH.EVAL' || 'S2' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP3S1 = '&DATAPATH.EVAL' || 'S3' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP4S1 = '&DATAPATH.EVAL' || 'S4' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP5S1 = '&DATAPATH.EVAL' || 'S5' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP6S1 = '&DATAPATH.EVAL' || 'S6' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP7S1 = '&DATAPATH.EVAL' || 'S7' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP8S1 = '&DATAPATH.EVAL' || 'S8' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP9S1 = '&DATAPATH.EVAL' || 'S9' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP0S1 = '&DATAPATH.EVAL' || 'S0' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPYS1 = '&DATAPATH.EVAL' || 'SY' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPZS1 = '&DATAPATH.EVAL' || 'SZ' || '&COMPNY.EVAL' || '.FOC';

-SET &&COMP1S = 'S1' || '&COMPNY.EVAL';
-SET &&COMP2S = 'S2' || '&COMPNY.EVAL';
-SET &&COMP3S = 'S3' || '&COMPNY.EVAL';
-SET &&COMP4S = 'S4' || '&COMPNY.EVAL';
-SET &&COMP5S = 'S5' || '&COMPNY.EVAL';
-SET &&COMP6S = 'S6' || '&COMPNY.EVAL';
-SET &&COMP7S = 'S7' || '&COMPNY.EVAL';
-SET &&COMP8S = 'S8' || '&COMPNY.EVAL';
-SET &&COMP9S = 'S9' || '&COMPNY.EVAL';
-SET &&COMP0S = 'S0' || '&COMPNY.EVAL';
-SET &&COMPYS = 'SY' || '&COMPNY.EVAL';
-SET &&COMPZS = 'SZ' || '&COMPNY.EVAL';

-* MARKET USES

-SET &&COMP1M1 = '&DATAPATH.EVAL' || 'M1' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP2M1 = '&DATAPATH.EVAL' || 'M2' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP3M1 = '&DATAPATH.EVAL' || 'M3' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP4M1 = '&DATAPATH.EVAL' || 'M4' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP5M1 = '&DATAPATH.EVAL' || 'M5' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP6M1 = '&DATAPATH.EVAL' || 'M6' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP7M1 = '&DATAPATH.EVAL' || 'M7' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP8M1 = '&DATAPATH.EVAL' || 'M8' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP9M1 = '&DATAPATH.EVAL' || 'M9' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP0M1 = '&DATAPATH.EVAL' || 'M0' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPYM1 = '&DATAPATH.EVAL' || 'MY' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPZM1 = '&DATAPATH.EVAL' || 'MZ' || '&COMPNY.EVAL' || '.FOC';


-SET &&COMP1M = 'M1' || '&COMPNY.EVAL';
-SET &&COMP2M = 'M2' || '&COMPNY.EVAL';
-SET &&COMP3M = 'M3' || '&COMPNY.EVAL';
-SET &&COMP4M = 'M4' || '&COMPNY.EVAL';
-SET &&COMP5M = 'M5' || '&COMPNY.EVAL';
-SET &&COMP6M = 'M6' || '&COMPNY.EVAL';
-SET &&COMP7M = 'M7' || '&COMPNY.EVAL';
-SET &&COMP8M = 'M8' || '&COMPNY.EVAL';
-SET &&COMP9M = 'M9' || '&COMPNY.EVAL';
-SET &&COMP0M = 'M0' || '&COMPNY.EVAL';
-SET &&COMPYM = 'MY' || '&COMPNY.EVAL';
-SET &&COMPZM = 'MZ' || '&COMPNY.EVAL';

-* DESTINATION USES

-SET &&COMP1D1 = '&DATAPATH.EVAL' || 'D1' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP2D1 = '&DATAPATH.EVAL' || 'D2' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP3D1 = '&DATAPATH.EVAL' || 'D3' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP4D1 = '&DATAPATH.EVAL' || 'D4' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP5D1 = '&DATAPATH.EVAL' || 'D5' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP6D1 = '&DATAPATH.EVAL' || 'D6' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP7D1 = '&DATAPATH.EVAL' || 'D7' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP8D1 = '&DATAPATH.EVAL' || 'D8' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP9D1 = '&DATAPATH.EVAL' || 'D9' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMP0D1 = '&DATAPATH.EVAL' || 'D0' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPYD1 = '&DATAPATH.EVAL' || 'DY' || '&COMPNY.EVAL' || '.FOC';
-SET &&COMPZD1 = '&DATAPATH.EVAL' || 'DZ' || '&COMPNY.EVAL' || '.FOC';


-SET &&COMP1D = 'D1' || '&COMPNY.EVAL';
-SET &&COMP2D = 'D2' || '&COMPNY.EVAL';
-SET &&COMP3D = 'D3' || '&COMPNY.EVAL';
-SET &&COMP4D = 'D4' || '&COMPNY.EVAL';
-SET &&COMP5D = 'D5' || '&COMPNY.EVAL';
-SET &&COMP6D = 'D6' || '&COMPNY.EVAL';
-SET &&COMP7D = 'D7' || '&COMPNY.EVAL';
-SET &&COMP8D = 'D8' || '&COMPNY.EVAL';
-SET &&COMP9D = 'D9' || '&COMPNY.EVAL';
-SET &&COMP0D = 'D0' || '&COMPNY.EVAL';
-SET &&COMPYD = 'DY' || '&COMPNY.EVAL';
-SET &&COMPZD = 'DZ' || '&COMPNY.EVAL';
-RUN


USE CLEAR *
-RUN

USE 
-* AIR_MAIN
&&COMP1A1 AS AIR_MAIN
&&COMP2A1 AS AIR_MAIN
&&COMP3A1 AS AIR_MAIN
&&COMP4A1 AS AIR_MAIN 
&&COMP5A1 AS AIR_MAIN
&&COMP6A1 AS AIR_MAIN
&&COMP7A1 AS AIR_MAIN
&&COMP8A1 AS AIR_MAIN
&&COMP9A1 AS AIR_MAIN
&&COMP0A1 AS AIR_MAIN
&&COMPYA1 AS AIR_MAIN
&&COMPZA1 AS AIR_MAIN
-* SR_50
&&COMP1S1 AS SR_50
&&COMP2S1 AS SR_50
&&COMP3S1 AS SR_50
&&COMP4S1 AS SR_50 
&&COMP5S1 AS SR_50
&&COMP6S1 AS SR_50
&&COMP7S1 AS SR_50
&&COMP8S1 AS SR_50
&&COMP9S1 AS SR_50
&&COMP0S1 AS SR_50
&&COMPYS1 AS SR_50
&&COMPZS1 AS SR_50
-* MR_50
&&COMP1M1 AS MR_50
&&COMP2M1 AS MR_50
&&COMP3M1 AS MR_50
&&COMP4M1 AS MR_50 
&&COMP5M1 AS MR_50
&&COMP6M1 AS MR_50
&&COMP7M1 AS MR_50
&&COMP8M1 AS MR_50
&&COMP9M1 AS MR_50
&&COMP0M1 AS MR_50
&&COMPYM1 AS MR_50
&&COMPZM1 AS MR_50
-* DR_50
&&COMP1D1 AS DR_50
&&COMP2D1 AS DR_50
&&COMP3D1 AS DR_50
&&COMP4D1 AS DR_50 
&&COMP5D1 AS DR_50
&&COMP6D1 AS DR_50
&&COMP7D1 AS DR_50
&&COMP8D1 AS DR_50
&&COMP9D1 AS DR_50
&&COMP0D1 AS DR_50
&&COMPYD1 AS DR_50
&&COMPZD1 AS DR_50
END

-*********** SEGMENT MODIFY


JOIN CLEAR *
JOIN AIR_KEY IN AIR_MAIN TO ALL AIR_KEY IN SR_50 AS JS1
-RUN


TABLE FILE AIR_MAIN
PRINT STAY HTL_DAYS CAR_DAYS
BY TKT_NUM
BY EMBARK
BY ROUTE
-* WHERE SEG_COUNT EQ '-1'
-* WHERE HTL_DAYS NE 0 OR CAR_DAYS NE 0
WHERE TKT_NUM EQ '9001122589'
ON TABLE HOLD AS SHLD1
END
-RUN


TABLE FILE AIR_MAIN
PRINT STAY HTL_DAYS AIR_KEY TKT_SORT SEG_NBR 
BY TKT_NUM
BY EMBARK
BY ROUTE
-* WHERE SEG_COUNT EQ '+1'
-* WHERE STAY NE 0
WHERE TKT_NUM EQ '9001122589'
ON TABLE HOLD AS SHLD2
END
-RUN

MATCH FILE SHLD1
SUM STAY HTL_DAYS CAR_DAYS  
BY TKT_NUM
BY EMBARK
BY ROUTE
ON TABLE HOLD
RUN
FILE SHLD2
PRINT AIR_KEY TKT_SORT SEG_NBR 
BY TKT_NUM
BY EMBARK
BY ROUTE
AFTER MATCH HOLD AS SHLD3 OLD
END

TABLE FILE SHLD3
PRINT *
END
-RUN
-QUIT

DEFINE FILE SHLD3
-* HDAYS/I5 = (HTL_DAYS * (-1));
HDAYS/I5 = (STAY * (-1));
-* CDAYS/I5 = (CAR_DAYS * (-1));
CDAYS/I5 = (STAY * (-1));
END
TABLE FILE SHLD3
PRINT HDAYS AS 'HTL_DAYS' CDAYS AS 'CAR_DAYS'
BY AIR_KEY 
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
-* ON TABLE HOLD AS SHLD4
END
-RUN
-QUIT

-* S1 MODIFY

MODIFY FILE &&COMP1S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN


-* S2 MODIFY

MODIFY FILE &&COMP2S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S3 MODIFY

MODIFY FILE &&COMP3S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S4 MODIFY

MODIFY FILE &&COMP4S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S5 MODIFY

MODIFY FILE &&COMP5S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S6 MODIFY

MODIFY FILE &&COMP6S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S7 MODIFY

MODIFY FILE &&COMP7S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN


-* S8 MODIFY

MODIFY FILE &&COMP8S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S9 MODIFY

MODIFY FILE &&COMP9S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* S0 MODIFY

MODIFY FILE &&COMP0S
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* SY MODIFY

MODIFY FILE &&COMPYS
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN

-* SZ MODIFY

MODIFY FILE &&COMPZS
LOG NOMATCH MSG OFF
FIXFORM FROM SHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON SHLD4
END
-RUN
-QUIT


-***********************  Market *****************************************


JOIN CLEAR *
JOIN AIR_KEY IN AIR_MAIN TO ALL AIR_KEY IN MR_50 AS JM1
-RUN


TABLE FILE AIR_MAIN
SUM HTL_DAYS CAR_DAYS
BY TKT_NUM
BY EMBARK
BY ROUTE
WHERE SEG_COUNT EQ '-1'
WHERE HTL_DAYS NE 0 OR CAR_DAYS NE 0
ON TABLE HOLD AS MHLD1
END
-RUN


TABLE FILE AIR_MAIN
PRINT AIR_KEY TKT_SORT SEG_NBR
BY TKT_NUM
BY EMBARK
BY ROUTE
WHERE SEG_COUNT EQ '+1'
WHERE STAY NE 0
ON TABLE HOLD AS MHLD2
END
-RUN

MATCH FILE MHLD1
SUM HTL_DAYS CAR_DAYS  
BY TKT_NUM
BY EMBARK
BY ROUTE
ON TABLE HOLD
RUN
FILE MHLD2
PRINT AIR_KEY TKT_SORT SEG_NBR 
BY TKT_NUM
BY EMBARK
BY ROUTE
AFTER MATCH HOLD AS MHLD3 OLD
END
DEFINE FILE MHLD3
HDAYS/I5 = (HTL_DAYS * (-1));
CDAYS/I5 = (CAR_DAYS * (-1));
END
TABLE FILE MHLD3
SUM HDAYS AS 'HTL_DAYS' CDAYS AS 'CAR_DAYS'
BY AIR_KEY 
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS MHLD4
END
-RUN

-* M1 MODIFY

MODIFY FILE &&COMP1M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M2 MODIFY

MODIFY FILE &&COMP2M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M3 MODIFY

MODIFY FILE &&COMP3M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M4 MODIFY

MODIFY FILE &&COMP4M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN


-* M5 MODIFY

MODIFY FILE &&COMP5M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M6 MODIFY

MODIFY FILE &&COMP6M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M7 MODIFY

MODIFY FILE &&COMP7M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M8 MODIFY

MODIFY FILE &&COMP8M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M9 MODIFY

MODIFY FILE &&COMP9M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* M0 MODIFY

MODIFY FILE &&COMP0M
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* MY MODIFY

MODIFY FILE &&COMPYM
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN

-* MZ MODIFY

MODIFY FILE &&COMPZM
LOG NOMATCH MSG OFF
FIXFORM FROM MHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON MHLD4
END
-RUN


-*************************  Destination *****************************************

JOIN CLEAR *
JOIN AIR_KEY IN AIR_MAIN TO ALL AIR_KEY IN DR_50 AS JD1
-RUN

TABLE FILE AIR_MAIN
SUM HTL_DAYS CAR_DAYS
BY TKT_NUM
BY EMBARK
BY ROUTE
BY TKT_DATE
WHERE SEG_COUNT EQ '-1'
WHERE HTL_DAYS NE 0 OR CAR_DAYS NE 0
ON TABLE HOLD AS DHLD1
END
-RUN


TABLE FILE AIR_MAIN
PRINT AIR_KEY TKT_SORT SEG_NBR
BY TKT_NUM
BY EMBARK
BY ROUTE
WHERE SEG_COUNT EQ '+1'
WHERE STAY NE 0
ON TABLE HOLD AS DHLD2
END
-RUN

MATCH FILE DHLD1
SUM HTL_DAYS CAR_DAYS  
BY TKT_NUM
BY EMBARK
BY ROUTE
ON TABLE HOLD
RUN
FILE DHLD2
PRINT AIR_KEY TKT_SORT SEG_NBR 
BY TKT_NUM
BY EMBARK
BY ROUTE
AFTER MATCH HOLD AS DHLD3 OLD
END
DEFINE FILE DHLD3
HDAYS/I5 = (HTL_DAYS * (-1));
CDAYS/I5 = (CAR_DAYS * (-1));
END
TABLE FILE DHLD3
SUM HDAYS AS 'HTL_DAYS' CDAYS AS 'CAR_DAYS'
BY AIR_KEY 
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS DHLD4
END
-RUN

-* D1 MODIFY

MODIFY FILE &&COMP1D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D2 MODIFY

MODIFY FILE &&COMP2D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D3 MODIFY

MODIFY FILE &&COMP3D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D4 MODIFY

MODIFY FILE &&COMP4D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN


-* D5 MODIFY

MODIFY FILE &&COMP5D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D6 MODIFY

MODIFY FILE &&COMP6D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D7 MODIFY

MODIFY FILE &&COMP7D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D8 MODIFY

MODIFY FILE &&COMP8D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D9 MODIFY

MODIFY FILE &&COMP9D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* D0 MODIFY

MODIFY FILE &&COMP0D
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* DY MODIFY

MODIFY FILE &&COMPYD
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN

-* DZ MODIFY

MODIFY FILE &&COMPZD
LOG NOMATCH MSG OFF
FIXFORM FROM DHLD4
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE HTL_DAYS CAR_DAYS
DATA ON DHLD4
END
-RUN


-NEXTONE

-NOUPDATE

-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2

-TYPE "UPDATE COMPLETED NORMALLY"

