-*SET TEMPERASE=OFF
-* CHANGED TO OBTAIN LEVEL1 LEVEL2 LEVEL3 LEVEL4 INFO
-* FROM AIR DATABASE - Deb 5/10/10
-* CHANGED TO ALWAYS SHOW LEVEL1 LEVEL2 LEVEL3 FROM AMN_DATA BASE
-* DEB 4/16/14
-* DEB 4/18/14 - UPDATED &NOHIERAMN
-* DEB 5/23/14 - ADDED EX5 TO EX_RF_FLAG DEFINE
-*************************************************************************
-* DVUNUSED.FEX - unused ticket listing
-*************************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON
-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';



-SET &WHATDATE = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'TRN_DATE' ELSE 'FST_DPT_DATE';

-DEFAULT &WHATSTATUS = 'WHERE STATUS_CODE EQ ''A'' OR ''S'' OR ''U'' OR ''X'' ';
-DEFAULT &MEM = ' ';

FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN

-INCLUDE SELCATQT
-RUN

EX &&CATQTRPR
-RUN

FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN

TABLE FILE BRPTFLDS
PRINT SEG HIEORG1.ID
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS CHKHIER
END
-RUN

-READ CHKHIER &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &LEVEL.A2.
-CLOSE CHKHIER

-SET &CKHIER =  EDIT(&LEVEL, '99');

TABLE FILE BRPTFLDS
PRINT SEG HIEORG1.ID
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS CHKHIER
END
-RUN

TABLE FILE BRPTFLDS
PRINT SEG HIEORG2.SEQ_NO
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS CHKMEM
END
-RUN



-READ CHKMEM &SEQNO.2. &CLIENT.A8. &CATG.A15. &MEM.A15. &LEVEL.A2.
-CLOSE CHKMEM

-SET &CKMEM = IF '&MEM.EVAL' EQ '&&ROLLUP.EVAL' THEN 'Y' ELSE 'N';

-*-SET &NOHIERAMN = IF '&CKMEM.EVAL' EQ 'Y' AND '&CKHIER.EVAL' EQ '01' THEN 'Y' ELSE 'N';
-SET &NOHIERAMN = IF '&CKMEM.EVAL' EQ 'Y' OR '&CKHIER.EVAL' EQ '01' THEN 'Y' ELSE 'N';
 

-SET &&SMD = 'S';
EX EXAUSE
-RUN

DEFINE FILE SR_50 
EX_RF_FLAG/A1 = IF VOID_DATE NE 0 THEN ' ' ELSE 
                IF (((RF_FLAG EQ 'F' OR 'P') AND (EMBARK NE 'EX1' OR 'FP2' OR 'EX5') AND (SEG_COUNT LE 0)) OR (EMBARK EQ 'RF1'))  THEN 'R' ELSE
                IF (((EXSALE NE ' ') AND (SEG_COUNT GE 0)) OR ((EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (RF_FLAG EQ ' ')))  THEN 'E' ELSE ' ';  
SALES_FLAG/A1 = IF RF_FLAG EQ ' ' AND EX_FLAG EQ ' '  AND VOID_DATE EQ 0 THEN 'S' ELSE 
                IF RF_FLAG EQ ' ' AND EX_FLAG EQ ' '  AND VOID_DATE NE 0  THEN 'V' ELSE ' ';
AIRLN_PNR/A14 = EDIT(AUX_TKTLS_PNR, '99999999999999');
AUX_TKT/A10 = AUX_TKTLS_NUM;                
END
-RUN


TABLE FILE SR_50
SUM  LEVEL1 LEVEL2 LEVEL3 LEVEL4  AUX_TKT AIRLN_PNR AS 'AUX_PNR' SALES_FLAG
BY TKT_NUM
-*WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS AIRHOLD FORMAT FOCUS INDEX TKT_NUM
END
-RUN


TABLE FILE SR_50
SUM LEVEL1 AS 'L1' LEVEL2 AS 'L2' LEVEL3 AS 'L3' LEVEL4 AS 'L4'
BY AUX_TKTLS_NUM AS 'AUX_NUM'
WHERE AUX_TKTLS_NUM NE ' ' OR '0000000000'
-INCLUDE RPTPARMS
ON TABLE HOLD AS AUXHLD
END
-RUN


-****** Excluding travel/Tran date so id- levels will match up regardless of time period


-INCLUDE getUnusedTktsByStatus
-RUN

-GOTO DEB;
UNUSEDT1 - ALL
UNUSEDT2 - AVAILABLE
UNUSEDT3 - EXPIRED
UNUSEDT4 - USED





TABLE FILE BRPTFLDS
PRINT UNUSEDT1 UNUSEDT2 UNUSEDT3 UNUSEDT4
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS UNUSEDT
END
-RUN
-IF &LINES EQ 0 THEN GOTO :NOREAD;
-READ UNUSEDT &UNUSEDT1.1.  &UNUSEDT2.1.  &UNUSEDT3.1.  &UNUSEDT4.1.
-SET &WHATSTATUS = IF &UNUSEDT1 EQ 1 THEN 'WHERE STATUS_CODE EQ ''A'' OR ''S'' OR ''U'' OR ''X'' '
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''A'' OR ''S'' OR ''U'' OR ''X'' '
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''A'' OR ''S'' OR ''U'' OR ''X'' '
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''A'' OR ''X'' '
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''A'' '
- ELSE IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''A'' OR ''S'' OR ''U'' '
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''S'' OR ''U'' OR ''X'' '
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 0 THEN 'WHERE STATUS_CODE EQ ''X'' '
- ELSE IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN 'WHERE STATUS_CODE EQ ''S'' OR ''U'' ';
-:NOREAD
-DEB

-DEFAULT &OPT1 = ' ';
-DEFAULT &OPT2 = ' ';
-DEFAULT &OPT3 = ' ';
-DEFAULT &OPT4 = ' ';
-DEFAULT &OPT5 = ' ';
-DEFAULT &OPT6 = ' ';
-DEFAULT &OPT7 = ' ';
-DEFAULT &UNUSEDT1 = ' ';
-DEFAULT &UNUSEDT2 = ' ';
-DEFAULT &UNUSEDT3 = ' ';
-DEFAULT &UNUSEDT4 = ' ';



-SET &OPT1 = 'WHERE (APPLYDATE GE ''&&FROMDT.EVAL'') AND (APPLYDATE LE ''&&TODT.EVAL'') AND (STATUS_CODE EQ ''S'' OR ''U'') OR (EXPIREDATE GE ''&&FROMDT.EVAL'') AND (EXPIREDATE LE ''&&TODT.EVAL'') AND (STATUS_CODE EQ ''X'') OR (STATUS_CODE EQ ''A'') ';
-SET &OPT2 = 'WHERE (APPLYDATE GE ''&&FROMDT.EVAL'') AND (APPLYDATE LE ''&&TODT.EVAL'')';
-SET &OPT3 = 'WHERE (EXPIREDATE GE ''&&FROMDT.EVAL'') AND (EXPIREDATE LE ''&&TODT.EVAL'')';
-SET &OPT4 = ' ' ;
-SET &OPT5 = 'WHERE (APPLYDATE GE ''&&FROMDT.EVAL'') AND (APPLYDATE LE ''&&TODT.EVAL'') AND (STATUS_CODE EQ ''S'' OR ''U'') OR STATUS_CODE EQ ''A''';  
-SET &OPT6 = 'WHERE (EXPIRE DATE GE ''&&FROMDT.EVAL'') AND (EXPIREDATE ''&&TODT.EVAL'') AND (STATUS_CODE EQ ''X'') OR (STATUS_CODE EQ ''A'')';
-SET &OPT7 = 'WHERE (APPLYDATE GE ''&&FROMDT.EVAL'') AND (APPLYDATE LE ''&&TODT.EVAL'') AND (STATUS_CODE EQ ''S'' OR ''U'') OR (EXPIREDATE GE ''&&FROMDT.EVAL'') AND (EXPIREDATE LE ''&&TODT.EVAL'') AND (STATUS_CODE EQ ''X'') ';                                 
-RUN

-TYPE '&OPT1.EVAL';
-TYPE '&OPT2.EVAL';
-TYPE '&OPT3.EVAL';
-TYPE '&OPT4.EVAL';
-TYPE '&OPT5.EVAL';
-TYPE '&OPT6.EVAL';
-TYPE '&OPT7.EVAL';


-SET &WHATDTRNG = IF &UNUSEDT1 EQ 1 THEN &OPT1 ELSE 
-  IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN &OPT2 ELSE
-  IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 0 THEN &OPT3 ELSE
-  IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 0 THEN &OPT6 ELSE
-  IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN &OPT5 ELSE
-  IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 1 THEN &OPT2 ELSE
-  IF &UNUSEDT2 EQ 0 AND &UNUSEDT3 EQ 1 AND &UNUSEDT4 EQ 1 THEN &OPT7 ELSE 
-  IF &UNUSEDT2 EQ 1 AND &UNUSEDT3 EQ 0 AND &UNUSEDT4 EQ 0 THEN &OPT4 ELSE &OPT1;
-:NOREAD;
-DEFAULT &WHATDTRNG = ' ';

-* -TYPE &WHATSTATUS
-TYPE &WHATDTRNG

-TYPE &&OUTTO




DEFINE FILE AMN_ITEM
 CLIENT/A8 = '&&ROLLUP.EVAL';
 ISSUEDATE/YYMD = HDATE(DATE_ISSUED, 'YYMD');
 -*EXPIREDATE/YYMD = HDATE(DATE_EXPIRES, 'YYMD');
 EXPIREDATE/YYMD = HDATE(STATUS_DATE, 'YYMD');
 APPLYDATE/YYMD = HDATE(DATE_SELECTED, 'YYMD');
 DEPART_DT/YYMD = HDATE(DEPART_DATE, 'YYMD');
 PASSNGR_NM/A33 = EDIT(PAX, '999999999999999999999999999999999');
 TRN_DATE/YYMD = ISSUEDATE;
 FST_DPT_DATE/YYMD = DEPART_DT;
 NW_LEV1/A15 = EDIT(LEVEL1, '999999999999999');
 NW_LEV2/A15 = EDIT(LEVEL2, '999999999999999');
 NW_LEV3/A15 = EDIT(LEVEL3, '999999999999999');
-*Selections passed from GUI
 BR_CL_IDX/A8 = AGENT_BRANCH | CLIENT_CODE;
 PASSNGR_NAME/A33 = EDIT(PAX, '999999999999999999999999999999999');
 TKT_NUM/A10 = TICKET_NUM;
 VAL_AIRLINE/A3 = AIRLINE_CODE;
 AUX_TKT/A14 = AIRLINE_PNR;
END
TABLE FILE AMN_ITEM
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE CLIENT AUX_TKT 
      NW_LEV1 NW_LEV2 NW_LEV3 
BY TKT_NUM
-IF &&HMEMEBERSELECTED EQ 'N' THEN GOTO NoHierMember;
-NoHierMember
-IF '&&ROLLUP.EVAL' EQ 'OTHER-R' THEN GOTO ChkClinetNUM;
WHERE ROLLUP EQ '&&ROLLUP.EVAL'
-ChkClinetNUM
&WHATSTATUS
&WHATDTRNG
WHERE TYPE_CODE NE 'R'
-INCLUDE DVRUTPARMS
ON TABLE HOLD AS AMNHLD FORMAT FOCUS INDEX TKT_NUM
END
-RUN





-IF '&NOHIERAMN.EVAL' EQ 'Y' THEN GOTO ALLrecords;

-* Ticket in AMN_ITEM for Status S, U, or X
DEFINE FILE AMNHLD
TKTN/A12 = ''''||TKT_NUM||'''';
NONTNTTKT/A1 = EDIT(TKT_NUM, '9');
END
TABLE FILE AMNHLD
PRINT TKTN
BY TKTN NOPRINT
WHERE TKT_NUM NE ' '
IF NONTNTTKT NE '2'
ON TABLE SAVE AS USEDTKT
END
-RUN

DEFINE FILE AMNHLD
ATKTN/A12 = ''''||TKT_NUM||'''';
NONTNTTKT/A1 = EDIT(TKT_NUM, '9');
END
TABLE FILE AMNHLD
PRINT ATKTN
BY ATKTN NOPRINT
WHERE NONTNTTKT EQ '2'
ON TABLE SAVE AS USED2
END
-RUN

DEFINE FILE AMNHLD
AUXTKT/A16 = ''''||AUX_TKT||'''';
END
-RUN
TABLE FILE AMNHLD
SUM AUXTKT
BY AUX_TKT NOPRINT
WHERE TKT_NUM EQ ' '
ON TABLE SAVE AS USEDAUX
END
-RUN


JOIN CLEAR *
JOIN TKT_NUM IN AMNHLD TO TKT_NUM IN AIRHOLD AS J1
-RUN


TABLE FILE AMNHLD
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4  CLIENT TKT_NUM AUX_PNR  AUX_TKT
      NW_LEV1 NW_LEV2 NW_LEV3 
BY TKT_NUM
WHERE AIRHOLD.TKT_NUM IN FILE USEDTKT
ON TABLE HOLD AS AMNTKT FORMAT FOCUS  
END
-RUN


TABLE FILE AIRHOLD
SUM LEVEL1 LEVEL2 LEVEL3 LEVEL4 AUX_TKT TKT_NUM
BY AUX_PNR
ON TABLE HOLD AS AIRHOLD2 FORMAT FOCUS INDEX AUX_PNR
END
-RUN

JOIN CLEAR *
JOIN AUX_TKT IN AMNHLD TO AUX_PNR IN AIRHOLD2 AS J2
-RUN 


TABLE FILE AMNHLD
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4  CLIENT TKT_NUM AUX_PNR  TKT_NUM
      NW_LEV1 NW_LEV2 NW_LEV3 
BY AUX_TKT
WHERE AIRHOLD2.AUX_PNR IN FILE USEDAUX
ON TABLE HOLD AS AMNAUX  
END
-RUN


TABLE FILE AMNAUX
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4  CLIENT TKT_NUM AUX_PNR  AUX_TKT
      NW_LEV1 NW_LEV2 NW_LEV3 
BY TKT_NUM
ON TABLE HOLD AS AMNAUX1 FORMAT FOCUS
END
-RUN


TABLE FILE AIRHOLD
SUM LEVEL1 LEVEL2 LEVEL3 LEVEL4 AUX_PNR TKT_NUM
BY AUX_TKT
ON TABLE HOLD AS AIRHOLD3 FORMAT FOCUS INDEX AUX_TKT
END
-RUN

JOIN CLEAR *
JOIN TKT_NUM IN AMNHLD TO AUX_TKT IN AIRHOLD3 AS J3
-RUN 


TABLE FILE AMNHLD
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4  CLIENT TKT_NUM AUX_PNR  TKT_NUM
      NW_LEV1 NW_LEV2 NW_LEV3 
BY AUX_TKT
WHERE AIRHOLD3.AUX_TKT IN FILE USED2
ON TABLE HOLD AS AMNTKT2 
END
-RUN

TABLE FILE AMNTKT2
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4  CLIENT TKT_NUM AUX_PNR  AUX_TKT
      NW_LEV1 NW_LEV2 NW_LEV3 
BY TKT_NUM
ON TABLE HOLD AS AMNTKT3 FORMAT FOCUS
END
-RUN





-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'AMNTKT.FOC';
-SET &HNKB=&HLDPATH || 'AMNAUX1.FOC';
-SET &HNKC=&HLDPATH || 'AMNTKT3.FOC';

-SET &FILENAME = 'AMNTKT'; 
-RUN



-DOS STATE &HNKA
-SET &HOLDFILEA = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKB
-SET &HOLDFILEB = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKC
-SET &HOLDFILEC = IF &RETCODE.EVAL EQ 0 THEN &HNKC | ' AS ' | &FILENAME ELSE ' ';


USE ADD 
&HOLDFILEA
&HOLDFILEB
&HOLDFILEC
END



DEFINE FILE AMNTKT
AUX_NUM/A10 = IF TKT_NUM EQ ' ' THEN NEW_TICKET_NUM ELSE TKT_NUM;
END
TABLE FILE AMNTKT
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4 TKT_NUM AUX_TKT AUX_PNR AUX_NUM
      NW_LEV1 NW_LEV2 NW_LEV3 

BY AUX_NUM
ON TABLE HOLD AS AMNHOLD1
END
-RUN

MATCH FILE AMNHOLD1
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4 TKT_NUM AUX_TKT AUX_PNR AUX_NUM
      NW_LEV1 NW_LEV2 NW_LEV3 
BY AUX_NUM
ON TABLE HOLD
RUN 
FILE AUXHLD
SUM L1 L2 L3 L4
BY AUX_NUM
AFTER MATCH HOLD AS AMNHOLD3 OLD
END
-RUN



-GOTO Finish;
-ALLrecords



JOIN CLEAR *
JOIN TKT_NUM IN AMNHLD TO TKT_NUM IN AIRHOLD AS J1
-RUN 
DEFINE FILE AMNHLD
AUX_NUM/A10 = IF TKT_NUM EQ ' ' THEN NEW_TICKET_NUM ELSE TKT_NUM;
END
TABLE FILE AMNHLD
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4 TKT_NUM AUX_TKT AUX_PNR AUX_NUM
      NW_LEV1 NW_LEV2 NW_LEV3 

BY TKT_NUM
ON TABLE HOLD AS AMNHOLD1
END
-RUN



MATCH FILE AMNHOLD1
PRINT ROLLUP PASSNGR_NAME TYPE_CODE STATUS_CODE APPLYDATE
      AIRLINE_CODE TICKET_VALUE DEPART_DT
      EXPIREDATE NEW_TICKET_NUM NEW_TICKET_VALUE ISSUEDATE
      LEVEL1 LEVEL2 LEVEL3 LEVEL4 TKT_NUM AUX_TKT AUX_PNR AUX_NUM
      NW_LEV1 NW_LEV2 NW_LEV3 
BY AUX_NUM
ON TABLE HOLD
RUN 
FILE AUXHLD
SUM L1 L2 L3 L4
BY AUX_NUM
AFTER MATCH HOLD AS AMNHOLD3 OLD
END
-RUN
 
-Finish



-SET &RPTTITLE = IF '&&ROLLUP.EVAL' NE 'OTHER-R' THEN 'Travel and Transport Unused Ticket Report for &&ROLLUP.EVAL Account'
- ELSE 'Travel and Transport Unused Ticket Report for Client &&CLIENT.EVAL Account';


-IF &LINES EQ 0 THEN GOTO NOUNUSED2;

DEFINE FILE AMNHOLD3
-* STS_RSN/A8 = IF STATUS_CODE EQ 'A' THEN 'OPEN' ELSE
-*       IF STATUS_CODE EQ 'U' THEN 'USED' ELSE 'EXPIRED';
 STS_RSN/A9 = IF STATUS_CODE EQ 'A' THEN 'AVAILABLE' ELSE
       IF STATUS_CODE EQ 'S' OR 'U' THEN 'USED' ELSE 'EXPIRED';
 EXP_DATE/MDYY = EXPIREDATE;
 ISD_DATE/MDYY= ISSUEDATE;
 APPLY_DT/MDYY= APPLYDATE;
 DPT_DT/MDYY = DEPART_DT;
 XLV1/A15 = IF TKT_NUM EQ ' ' AND AUX_NUM NE ' ' THEN L1 ELSE 
            IF TKT_NUM EQ ' ' AND AUX_NUM EQ ' ' THEN NW_LEV1 ELSE LEVEL1;
 XLV2/A15 = IF TKT_NUM EQ ' ' AND AUX_NUM NE ' ' THEN L2 ELSE
            IF TKT_NUM EQ ' ' AND AUX_NUM EQ ' ' THEN NW_LEV2 ELSE LEVEL2;
 XLV3/A15 = IF TKT_NUM EQ ' ' AND AUX_NUM NE ' ' THEN L3 ELSE 
            IF TKT_NUM EQ ' ' AND AUX_NUM EQ ' ' THEN NW_LEV3 ELSE LEVEL3;
 XLV4/A60 = IF TKT_NUM EQ ' ' AND AUX_NUM NE ' ' THEN L4 ELSE LEVEL4;
 XTKT_NUM/A14 = IF TKT_NUM EQ ' ' THEN AUX_TKT ELSE TKT_NUM;
 NOWTOD/A8 = HHMMSS (NOWTOD);
IMAGE/A80 = '<img src=HTTPS://www.ettekreview.com/asp/NEW_HDR.jpg>';
END
TABLE FILE AMNHOLD3
HEADING
"<IMAGE>"
"</5"
"&RPTTITLE.EVAL"
"&&DTDESC.EVAL &&FROMDT - &&TODT "
 
PRINT STS_RSN AS 'STATUS'
      ISD_DATE AS 'ISSUED'
      EXP_DATE AS 'EXPIRATION'
      PASSNGR_NAME AS 'TRAVELER'
      XTKT_NUM AS 'TICKET NUMBER'
      AIRLINE_CODE AS 'A/L'
      NEW_TICKET_NUM AS 'APPLIED TO'
      APPLY_DT AS 'APPLIED DATE'
      TICKET_VALUE AS 'AMOUNT'
      NW_LEV1 &&LV1
      NW_LEV2 &&LV2
      NW_LEV3 &&LV3
-*      XLV1  &&LV1 
-*      XLV2 &&LV2 
-*      XLV3 &&LV3
      XLV4 &&LV4      
BY STS_RSN NOPRINT 
ON STS_RSN RECOMPUTE MULTILINES AS 'TOTAL FOR'
ON TABLE COLUMN-TOTAL

 
&&OUTLINE1
&&OUTLINE2


ON TABLE SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.200000, RIGHTMARGIN=0.200000,
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT,FONT=TIMES NEW ROMAN, SIZE=8, COLOR=BLACK, GRID=ON, STYLE=NORMAL,WRAP= OFF, $
TYPE=TITLE, SIZE=9, STYLE=BOLD+UNDERLINE,  $
TYPE=HEADING, SIZE=10, STYLE=BOLD, FONT=TIMES NEW ROMAN,$
TYPE=HEADING, SIZE=14, LINE=8, STYLE=BOLD, FONT=TIMES NEW ROMAN,$
TYPE=HEADING, SIZE=10, LINE=9, STYLE=BOLD, FONT=TIMES NEW ROMAN,$
 
TYPE=FOOTING, SIZE=7, STYLE=BOLD, COLOR=GREY, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBFOOT, SIZE=14, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=9, STYLE=BOLD, $
TYPE=GRANDTOTAL, SIZE=9, STYLE=BOLD, $
TYPE=REPORT, TITLETEXT=&DSC,$
 
ENDSTYLE
 
END
-RUN
 
-IF &FOCERRNUM EQ 205  OR &LINES EQ 0 THEN GOTO NOUNUSED2;
-GOTO XXUNUSED2;
-NOUNUSED2
-SET &TITLETEXT = 'Unused Tickets  ';
-INCLUDE DVRNoRecord
-GOTO XXIT;
-XXUNUSED2
-GOTO XXIT;








-XXIT;