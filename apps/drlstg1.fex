
SET ASNAMES=ON
-*SET TEMPERASE = OFF
JOIN AIR_KEY IN AYMETX TO ALL AIR_KEY IN SYMETX AS J1
END

DEFINE FILE AYMETX
FARE_PAID/D12.2 = SEG_AMT + SEG_TAX;
DISSAVINGS/D12.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
NEW_SEG_DISC/D12.2CS = SEG_DISCOUNT;                        
                           
VASAVINGS/D12.2CS    = NEW_SEG_DISC - FARE_PAID;
QTR/MT        = TRN_DATE;
END

TABLE FILE AYMETX
SUM DISSAVINGS AS 'PDIS' FARE_PAID NET_TKT_CNT VASAVINGS
BY QTR
BY REFUSE_CODE
WHERE RF_FLAG EQ ' '
WHERE EX_FLAG EQ ' '
WHERE QTR EQ '&QTR.EVAL';
WHERE REFUSE_CODE NE ' '
ON TABLE HOLD AS ONEH
END
-RUN

DEFINE FILE AIR_REF
RC/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
END
-RUN
TABLE FILE AIR_REF
SUM REFUSAL_DESC
BY RC AS 'REFUSE_CODE'
-* WHERE REFUSE_KEY CONTAINS 'METX-R'
ON TABLE HOLD AS ONEH1
END
-RUN
 
MATCH FILE ONEH
SUM PDIS FARE_PAID NET_TKT_CNT VASAVINGS
BY REFUSE_CODE
ON TABLE HOLD
RUN
FILE ONEH1
SUM REFUSAL_DESC
BY REFUSE_CODE
AFTER MATCH HOLD AS ONEH2 OLD-AND-NEW
END
-RUN

DEFINE FILE ONEH2
RD/A40 = LCWORD(40, REFUSAL_DESC, RD);
END
-RUN
GRAPH FILE ONEH2
SUM PDIS FARE_PAID VASAVINGS
ACROSS RD AS ' '
WHERE REFUSE_CODE NE 'LE'
ON GRAPH SET GRAPHEDIT SERVER
ON GRAPH SET BARNUMB OFF
ON GRAPH SET 3D OFF
ON GRAPH SET VZERO ON
ON GRAPH SET GRID ON
ON GRAPH SET GRAPHSTYLE *
setGraphType(55);
-* setData(0,0,.5);
setGroupLabel(0,"Lost Savings");
setGroupLabel(1,"Fare Paid");
setGroupLabel(2,"Value Added Savings");
setPiesPerRow(3);
setPieFeelerTextDisplay (1);
setPieFeelerTextFormat(6);
setPieLabelDisplay(0);
setFontSizeAbsolute(getPieLabelDisplay(),(false);
setAutofit(getPieLabelDisplay(),(true);
setTitleString("Performance");
setAutofit(getTitle(),false);
setTextJustHoriz(getTitle(),1);
setFontSizeAbsolute(getTitle(),true); 
setFontStyle(getTitle(),0);
setFontSize(getTitle(),10);
setLegendDisplay(true);
setLegendMarkersPerRow(3);
setLegendTextAutofit(true);
setFontSizeAbsolute(getLegendText(),true);
setFontStyle(getLegendText(),0);
setFillColor(getSeries(0), new Color, 0 64 128));
setFillColor(getSeries(1), new Color, 145 207 255)); 
setFillColor(getSeries(2), new Color, 160 0 181));
setFillColor(getSeries(3), new Color, 255 255 128 ));
setFillColor(getSeries(4), new Color, 0 128 0));
setFillColor(getSeries(5), new Color, 128 128 128));
setFillColor(getSeries(6), new Color, 255 0 255));
setFillColor(getSeries(7), new Color, 64 128 128));
setFillColor(getSeries(8), new Color, 255 128 0));
setFillColor(getSeries(9), new Color, 128 0 0));
setFillColor(getSeries(10), new Color, 192 192 192));
-* setFillColor(getSeries(11), new Color, 0 0 160));
-* setFillColor(getSeries(12), new Color, 190 115 65));
setFillColor(getSeries(11), new Color, 255 23 23));
setFillColor(getSeries(12), new Color, 64 0 128));
setFillColor(getSeries(13), new Color, 255 0 128));
setFillColor(getSeries(14), new Color, 52 203 181));
setPlace(true);
ENDSTYLE

ON TABLE SET PAGE-NUM OFF
ON GRAPH SET STYLE *
     PAGESIZE='Letter',
     LEFTMARGIN=0.250000,
     RIGHTMARGIN=0.250000,
     TOPMARGIN=0.250000,
     BOTTOMMARGIN=0.250000,
     SQUEEZE=ON,
     ORIENTATION=PORTRAIT,
$
TYPE=REPORT,
     GRID=OFF,
     FONT='TIMES NEW ROMAN',
     SIZE=9,
     BACKCOLOR='NONE',
     STYLE=NORMAL,
$     
    

ENDSTYLE
END
