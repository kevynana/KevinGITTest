-* Joy Updated Pref_Non define to contain C/P/N/M/L
-* 9/8/14 Updated Pref_non define to use exclude_flags
-*  10/03/2016  REJ  S-24432 ER5 Testing updates.
-*  12/29/2016  REJ  S-28553 Move ER5 My Reports to production.

 
-INCLUDE SETECHO
-DEFAULT &&FIELD = 'XX';
-DEFAULT &&SETF = 'XX';
-DEFAULT &&LSEL = 'XX';
 
-SET &&DTSTY = 'DT';
 
-SET &&FIELD = &ROW_LABEL;
 
-DEFAULT &FPARM = ' ';
-SET &&FIPARM = &FPARM;
-SET &&DRILLED_RUN = 'Y';
 
-**********************************************************************
-* EX RPTRESET TO RESET PARAMS
-**********************************************************************
-SET &&ROLLUP = &ROLUP;
-* -SET &&UNAME = &UID;
-SET &&UNAME = &user;
EX RPTRESET
-RUN
EX RESET
-RUN
 
-**********************************************************************
-* CHECK FOR PRESENCE OF ORIGINAL SET FILE
-*********************************************************************
-*****  USE VALUE PASSED AS &SETFNM TO DETERMINE FILE NAME
-IF &&DEPLOY EQ 'W' GOTO SETWEB;
-SET &&LOCPATH = '&&DATASRV.EVAL' || '\TT\ '|| &&ROLLUP || '\ '||&&UNAME.EVAL||'\';
-SET &FILEXIST = &&LOCPATH || &SETFNM || '.FTM';
-GOTO CHKFILE;
 
-SETWEB
-SET &&WEBPATH = '&&WEBSRV.EVAL' || '\TTWEB\ ' || &&ROLLUP || '\ '||&&UNAME.EVAL||'\';
-SET &FILEXIST = &&WEBPATH || &SETFNM || '.FTM';
 
-CHKFILE
STATE &FILEXIST
-RUN
-IF &RETCODE NE 0 GOTO NOFILE;
-GOTO CONT;
 
-*
-*
-**********************************************************************
-*
-**********************************************************************
-CONT
 
 
-SET &TMPDRIL = &&WEB_PATH || 'TEMPDRIL.FEX' ;
COPY &FILEXIST &TMPDRIL
-SET &&SETF='TEMPDRIL';
-RUN
 
EX SETDBLS SETFILE=&&SETF
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :DRD1;
APP PREPENDPATH REVIEW_50_SHARED REVIEW_50_AVRP ttapps_sql
-RUN
 
-INCLUDE GetForDrillDown
-RUN
 
-SET &&OUTLINE1 = 'ON TABLE SET ONLINE-FMT';
-SET &&OUTLINE2 = IF &&OUTLINE2 CONTAINS 'PDF' THEN 'PDF' ELSE
-          IF &&OUTLINE2 CONTAINS 'EXCEL' THEN 'EXCEL' ELSE
-          IF &&OUTLINE2 CONTAINS 'EXL2K' THEN 'EXL2K' ELSE 'PDF';
 
 
-* &&FIELD WILL EQUAL ONE OF THE FIELD NAMES WITHIN THE REPORT
-****
 
-SET &&PAXCHK='WHERE PASSNGR_NAME EQ ''&&FIELD.EVAL''';
 
-GOTO ENDLEV
- IF &&LDESC EQ 'AROLL_DSC1' THEN GOTO ROLL1
- ELSE IF &&LDESC EQ 'AROLL_DSC2' THEN GOTO ROLL2
- ELSE IF &&LDESC EQ 'AROLL_DSC3' THEN GOTO ROLL3
- ELSE IF &&LDESC EQ 'AROLL_DSC4' THEN GOTO ROLL4
- ELSE IF &&LDESC EQ 'AROLL_DSC5' THEN GOTO ROLL5
- ELSE IF &&LDESC EQ 'AROLL_DSC6' THEN GOTO ROLL6
- ELSE IF &&LDESC EQ 'AROLL_DSC7' THEN GOTO ROLL7
- ELSE IF &&LDESC EQ 'AROLL_DSC8' THEN GOTO ROLL8
- ELSE GOTO FIRST;
 
 
-ROLL1
-SET &&LCHK='WHERE AROLL_DSC1
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL2
-SET &&LCHK='WHERE AROLL_DSC2
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL3
-SET &&LCHK='WHERE AROLL_DSC3
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL4
-SET &&LCHK='WHERE AROLL_DSC4
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL5
-SET &&LCHK='WHERE AROLL_DSC5
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL6
-SET &&LCHK='WHERE AROLL_DSC6
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL7
-SET &&LCHK='WHERE AROLL_DSC7
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ROLL8
-SET &&LCHK='WHERE AROLL_DSC8
- EQ ''&&FIELD.EVAL''';
-SET &&RPT_TTL1='                    NON-PREFERRED HOTEL DETAIL';
-GOTO ENDLEV
-RUN
 
-ENDLEV
 
FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN
 
-*****************************************************************
-*DATE           NAME                 DESCRIPTION OF CHANGE
-*9/13/00      IBISTL-KR              Drill Down functionality
-*****************************************************************
-SET &&RPTTYP = ' ';
-SET &&SMD = 'S';
EX TS_JAMS2
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :DOD1;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-RUN
-:DOD1
 
-INCLUDE SELCATQT
-RUN
 
-*EX CATQTR
EX &&CATQTRPR
-RUN
 
FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN
 
EX HTLUSE
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF1;
-INCLUDE AVRP_SUBFOOT
-:AVSF1
 
-TYPE Before Extract
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';
 
DEFINE FILE &&EXTRACT
CITY_ST/A35 = PROP_STATE||(', '| PROP_CITY);
IN_DATE/MDYY = CHKIN_DATE;
INV_DT/YYMD = INVOICE_DATE;
NBR_DAYS/D12 = NUM_DAYS;
NBR_ROOMS/D12 = NUM_ROOMS;
NEW_ROOM_RATE/D12.2C = ROOM_RATE;
NEW_TOTAL_AMT/D12.2C = TOTAL_AMT;
OUT_DATE/MDYY = CHKOUT_DATE;
NBR_DAYS/D12=NUM_DAYS;
NBR_ROOMS/D12 = NUM_ROOMS;
TOTAL_RATE/D14.2C = TOTAL_AMT;
NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                 ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
PROP_ZIP5/A5=EDIT(PROP_ZIP, '99999$$$$$');
PNP_FLAG/A1 = EDIT(EXCLUDE_FLAGS, '$9');
PNP_IE/A1 = EDIT(EXCLUDE_FLAGS, '$$9');
-* PR_FLAG/A1 = IF REFUSE_CODE EQ 'A' OR 'R' OR 'RT' OR 'RV' THEN 'Y' ELSE 'N';
-* NPR_FLAG/A1 = IF REFUSE_CODE EQ 'C' OR 'CT' OR 'CV' OR 'L' OR 'LT' OR 'LV' OR 'T' OR 'P' OR 'PT' OR 'PV' OR 'X' OR 'XT' OR 'XV' OR 'Y' OR 'YT' OR 'YV' THEN 'Y' ELSE 'N';
-* TTL_FLAG/A1 = IF REFUSE_CODE NE 'M' OR 'MT' OR 'MV' OR 'NT' OR 'NV' OR 'S' OR 'ST' OR 'SV' THEN 'Y' ELSE 'N';
-* PR_FLAG/A1 = IF CLIENT_PREF EQ 'C' OR 'P' OR 'N' OR 'M' OR 'L' THEN 'Y' ELSE 'N';
PR_FLAG/A1 = IF PNP_FLAG EQ 'I' THEN 'Y' ELSE 'N';
-* NPR_FLAG/A1 = IF CLIENT_PREF NE 'C' OR 'P' OR 'N' OR 'M' OR 'L' THEN 'Y' ELSE 'N';
NPR_FLAG/A1 = IF PNP_FLAG NE 'I' THEN 'Y' ELSE 'N';
TTL_FLAG/A1 = IF PR_FLAG EQ 'Y' OR NPR_FLAG EQ 'Y' THEN 'Y' ELSE 'N';
HDP_FLAG/A1 = IF REFUSE_CODE EQ 'N' OR 'I' OR 'V' THEN 'N' ELSE 'Y';
 
-* Defines on Previous Defines
BOOKINGS/D8 = IF TOTAL_RATE GE 0 THEN 1 ELSE (-1);
PR_FLAG1/A25 = IF PR_FLAG EQ 'Y' THEN 'Preferred Hotel' ELSE
               IF NPR_FLAG EQ 'Y' THEN 'Non-Preferred Hotel' ELSE 'Other';
 
NONPRM/P8CS = IF NPR_FLAG EQ 'Y' THEN NNROOMS ELSE 0;
PREFRM/P8CS = IF PR_FLAG EQ 'Y' THEN NNROOMS ELSE 0;
TTLRM/P8CS = NONPRM+PREFRM;
 
NONPAM/D12.2CS = IF NPR_FLAG EQ 'Y' THEN TOTAL_RATE ELSE 0;
PREFAM/D12.2CS = IF PR_FLAG EQ 'Y' THEN TOTAL_RATE ELSE 0;
TTLAM/D12.2CS = NONPAM+PREFAM;
 
NONPBK/P8CS = IF NPR_FLAG EQ 'Y' THEN BOOKINGS ELSE 0;
PREFBK/P8CS = IF PR_FLAG EQ 'Y' THEN BOOKINGS ELSE 0;
TTLBK/P8CS = NONPBK+PREFBK;
END
-RUN
 
TABLEF FILE &&EXTRACT
PRINT BOOKINGS
  CITY_ST
  IN_DATE
  INVOICE_DATE
  LEVEL2
  NBR_ROOMS
  NEW_ROOM_RATE
  NEW_TOTAL_AMT
  NNROOMS
  OUT_DATE
  PASSNGR_NAME
  PROP_NAME
  PROP_ADDRESS
  HOTEL_PHONE
  PROP_ZIP5
  PR_FLAG1
  REFUSE_CODE
  TTLBK
  TTLRM
-***************************************************************
-* Where statements to select data specified in user profile
-***************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
-INCLUDE RPTPARMS
-INCLUDE &HTLDATES
WHERE HDP_FLAG EQ 'Y'
&&PAXCHK
ON TABLE HOLD AS DRHHLD
END
-RUN
 
-IF &RECORDS EQ 0 GOTO NORECORDS;
-RUN
 
TABLE FILE DRHHLD
SUM BOOKINGS
    NEW_TOTAL_AMT
    NNROOMS
    TTLBK
    TTLRM
-* BY PR_FLAG1
BY PASSNGR_NAME
BY INVOICE_DATE
BY IN_DATE
BY OUT_DATE
BY PROP_NAME
BY PROP_ADDRESS
BY PROP_ZIP5
BY CITY_ST
BY REFUSE_CODE
ON TABLE HOLD AS DRHHLD1
END
-RUN
 
DEFINE FILE DRHHLD1
NOWTOD/A8 WITH PASSNGR_NAME = HHMMSS (NOWTOD);
END
TABLE FILE DRHHLD1
-INCLUDE HEADAIR
SUM
PASSNGR_NAME AS 'PASSENGER NAME'
IN_DATE AS 'CHECKIN,DATE'
OUT_DATE AS 'CHECKOUT,DATE'
PROP_NAME AS 'HOTEL'
PROP_ADDRESS AS 'ADDRESS'
PROP_ZIP5 AS 'ZIP,CDE'
CITY_ST AS 'CITY/STATE'
REFUSE_CODE AS 'RSN,CDE'
TTLBK AS 'BOOKINGS'
TTLRM AS 'NUMBER,NIGHTS'
-*
-******************************************************************
-* By statements (one per field)
-******************************************************************
-*
-* BY PR_FLAG1 AS ' '
BY PASSNGR_NAME NOPRINT
BY INVOICE_DATE NOPRINT
BY IN_DATE NOPRINT
BY OUT_DATE NOPRINT
BY PROP_NAME NOPRINT
BY PROP_ADDRESS NOPRINT
BY PROP_ZIP5 NOPRINT
BY CITY_ST NOPRINT
BY REFUSE_CODE NOPRINT
 
-* IF PR_FLAG1 NE 'Other'
 
-* ON PR_FLAG1 RECOMPUTE AS 'TOTAL FOR'
ON TABLE COLUMN-TOTAL
-INCLUDE FOOTERDT
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
 
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-*
-GOTO ENDIT;
 
-XXIT
-SKIPTHIS
-HTMLFORM BEGIN
<HTML>
<HEAD>
 
</HEAD>
<BODY>
 
 
<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>THIS FIELD IS NOT DRILLABLE!!!</H2></CENTER>
 
<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER>
 
</BODY>
</HTML>
-HTMLFORM END
-GOTO ENDIT;
 
-NOFILE
-HTMLFORM BEGIN
<HTML>
<HEAD>
 
</HEAD>
<BODY>
 
 
<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>THE REPORT IS NO LONGER DRILLABLE!!!</H2></CENTER>
 
<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER>
 
</BODY>
</HTML>
-HTMLFORM END
-ENDIT
-GOTO XXIT;
 
-NORECORDS
-HTMLFORM BEGIN
<HTML>
<HEAD>
 
</HEAD>
<BODY>
 
 
<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>NO RECORDS FOUND FOR THIS SELECTION!!!</H2></CENTER>
 
<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER>
 
</BODY>
</HTML>
-HTMLFORM END
 
-XXIT
 
