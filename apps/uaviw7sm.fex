-INCLUDE SETECHO 
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 4/13/16-JEM-S-17755 Added goto for excel format so it skips around the inclusion of the drilldown detail stylesheet
-*4/18/16 - JEM - S-17913 Corrected issue with validating airline selection so in ER5 will select correctly 
-*4/26/2017-JEM-S-33318-updated logic for no records report

SET ASNAMES = ON
-SET &&BREAKOPTION = ' ';
-RUN



TABLE FILE &&RPT_HOLD
SUM STD_FEE AS 'TSFEE'
    PD_FEE AS 'TPFEE'	
    NET_TKT_CNT AS 'TTKT'
    SVGS AS 'TSVG'
BY LEVEL_DESC  
ON TABLE HOLD AS HOLDONE
END
-RUN


TABLE FILE &&RPT_HOLD
SUM FARE_PAID
  NET_TKT_CNT    
  STD_FEE
  PD_FEE
  SVGS
BY LEVEL_DESC
BY VAL_AIRLINE
ON TABLE HOLD AS XTWO
END
-RUN



MATCH FILE XTWO
PRINT FARE_PAID
  NET_TKT_CNT    
  STD_FEE
  PD_FEE
  SVGS
  VAL_AIRLINE
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDONE
SUM TTKT    
    TSFEE
    TPFEE
    TSVG
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN


TABLE FILE XTHREE
SUM FARE_PAID
  NET_TKT_CNT    
  STD_FEE
  PD_FEE
  SVGS
  TSFEE
  TPFEE
  TTKT
  TSVG
BY LEVEL_DESC
BY VAL_AIRLINE
ON TABLE HOLD AS AIRHOLD4
END
-RUN


DEFINE FILE AIRHOLD4
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
PCTN/D8.1%=IF TTKT EQ 0 THEN 0 ELSE (NET_TKT_CNT/TTKT)*100;
PCTS/D8.1% = IF TSVG EQ 0 THEN 0 ELSE (SVGS/TSVG)*100;
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE AIRHOLD4
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-* &&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

FOOTING
-INCLUDE FOOTERSM

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-IF '&&OUTFMT.EVAL' EQ 'EXCEL' GOTO NODTSTY;

-INCLUDE &&DSTY

-NODTSTY;


ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-GOTO XXIT

-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT



-*-*-EXIT




