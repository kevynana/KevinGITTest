
-*7/01/16-JEM-S-16738 Created for new report that shows global data
-*11/7/16-JEM-S-26142-Adding counts/annualized spend fields per Patti 
-*3/2/17-JEM-S-31069-Updating Prior year to date to be Prior annual year 
-*8/29/17-JEM-S-34936 Replaced COMPANY_NAME WITH LEVEL_DESC

-* SET TEMPERASE = OFF
-INCLUDE SETECHO

CREATE FILE TCAGLOBAL
CREATE FILE TCHGLOBAL
CREATE FILE TCCGLOBAL
-RUN


-SET &&DRILLABLE = 'N';
-SET &&FROMER5 = 'Y';

-INCLUDE TCGETROLL
-RUN


-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT; 


-TYPE TCAIRDB
-SET &&PAIRDB = 'S';
EX TCAIRDB
-RUN
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop2;

EX TCAGLBLEX
-RUN


EX TCCARDB 
-RUN


EX TCCGLBLEX
-RUN


EX TCHTLDB
-RUN

EX TCHGLBLEX
-RUN


-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2
-RUN


-INCLUDE SetParmtime
-RUN

 
-**************************************************************
-* GET THE FINAL REPORT
-**************************************************************

TABLE FILE TCAGLOBAL
SUM CAVOL
    CANETT
    CATRNS
    CTVOL
    CTNETT
    CTTRNS
    CYAVOL
    CYTVOL
    PAVOL
    PANETT
    PATRNS
    PTVOL
    PTNETT
    PTTRNS
    PYAVOL
    PYTVOL 
    PYRAVOL
    PYRATRNS
    PYRANETT
    PYRTVOL
    PYRTTRNS
    PYRTNETT    
BY ROLLCD
BY RNR_FLAG
BY COMP_NAME
ON TABLE HOLD AS ATRN1
END
-RUN


MATCH FILE ATRN1
PRINT CAVOL
    CANETT
    CATRNS
    CTVOL
    CTNETT
    CTTRNS
    CYAVOL
    CYTVOL
    PAVOL
    PANETT
    PATRNS
    PTVOL
    PTNETT
    PTTRNS
    PYAVOL
    PYTVOL 
    PYRAVOL
    PYRATRNS
    PYRANETT
    PYRTVOL
    PYRTTRNS
    PYRTNETT    
BY ROLLCD
BY RNR_FLAG
BY COMP_NAME
ON TABLE HOLD
RUN
FILE TCHGLOBAL
SUM CHVOL
    CHNGT
    CYHVOL
    PHVOL
    PHNGT
    PYHVOL 
    PYRHVOL
    PYRHNGT    
BY ROLLCD
BY RNR_FLAG
BY COMP_NAME
AFTER MATCH HOLD AS AHTRN1 OLD-OR-NEW
END
-RUN

MATCH FILE AHTRN1
PRINT CAVOL
      CANETT
      CATRNS
      CTVOL
      CTNETT
      CTTRNS
      CYAVOL
      CYTVOL
      PAVOL
      PANETT
      PATRNS
      PTVOL
      PTNETT
      PTTRNS
      PYAVOL
      PYTVOL 
      PYRAVOL
      PYRATRNS
      PYRANETT
      PYRTVOL
      PYRTTRNS
      PYRTNETT      
      CHVOL
      CHNGT
      CYHVOL
      PHVOL
      PHNGT
      PYHVOL 
      PYRHVOL
      PYRHNGT     
BY ROLLCD
BY RNR_FLAG
BY COMP_NAME
ON TABLE HOLD
RUN
FILE TCCGLOBAL
SUM CCVOL
    CCDAY
    CYCVOL
    PCVOL
    PCDAY
    PYCVOL
    PYRCVOL
    PYRCDAY     
BY ROLLCD
BY RNR_FLAG
BY COMP_NAME
AFTER MATCH HOLD AS AHCTRN1 OLD-OR-NEW
END
-RUN




-INCLUDE OTHPARMS
-INCLUDE AVRP_SUBFOOT
-RUN

-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN



-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLSDD'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;

DEFINE FILE AHCTRN1
NOWTOD/A8 WITH ROLLCD = HHMMSS (NOWTOD);
TFLAG/A1 = IF (CAVOL EQ 0) AND (PAVOL EQ 0) AND (CHVOL EQ 0) AND (PHVOL EQ 0) AND (CCVOL EQ 0) AND (PCVOL EQ 0) THEN 'N' ELSE 'Y';
END
TABLE FILE AHCTRN1
-INCLUDE &&PAHDR
-IF '&&OUTFMT.EVAL' NE 'PPT' OR 'PDF' OR 'COM' THEN GOTO NOSPC;
"</2"
-NOSPC;  
SUM CAVOL AS 'CURRENT,AIR,SPEND'
    CYAVOL AS 'ANNUALIZED,CURRENT,AIR,SPEND'
    CANETT AS 'CURRENT,AIR,TICKETS'
    CATRNS AS 'CURRENT,AIR,TRANSACTIONS'
    CTVOL AS 'CURRENT,RAIL,SPEND'
    CYTVOL AS 'ANNUALIZED,CURRENT,RAIL,SPEND'
    CTNETT AS 'CURRENT,RAIL,TICKETS'
    CTTRNS AS 'CURRENT,RAIL,TRANSACTIONS'
    PAVOL AS 'PRIOR,AIR,SPEND'
    PYAVOL AS 'ANNUALIZED,PRIOR,AIR,SPEND'   
    PANETT AS 'PRIOR,AIR,TICKETS'
    PATRNS AS 'PRIOR,AIR,TRANSACTIONS'
    PTVOL AS 'PRIOR,RAIL,SPEND'
    PYTVOL AS 'ANNUALIZED,PRIOR,RAIL,SPEND'
    PTNETT AS 'PRIOR,RAIL,TICKETS'
    PTTRNS AS 'PRIOR,RAIL,TRANSACTIONS'
    
    PYRAVOL AS 'PRIOR YEAR,AIR SPEND'
    PYRANETT AS 'PRIOR YEAR,AIR TICKETS'
    PYRATRNS AS 'PRIOR YEAR,AIR TRANSACTIONS'
    PYRTVOL AS 'PRIOR YEAR,RAIL SPEND'
    PYRTNETT AS 'PRIOR YEAR,RAIL,TICKETS'
    PYRTTRNS AS 'PRIOR YEAR,RAIL,TRANSACTIONS'
    
    CHVOL AS 'CURRENT,HOTEL,SPEND'
    CYHVOL AS 'ANNUALIZED,CURRENT,HOTEL,SPEND'
    CHNGT AS 'CURRENT,HOTEL,NIGHTS'
    PHVOL AS 'PRIOR,HOTEL,SPEND'
    PYHVOL AS 'ANNUALIZED,PRIOR,HOTEL,SPEND'
    PHNGT AS 'PRIOR,HOTEL,NIGHTS'
    PYRHVOL AS 'PRIOR YEAR,HOTEL,SPEND'
    PYRHNGT AS 'PRIOR YEAR,HOTEL,NIGHTS'    
    
    CCVOL AS 'CURRENT,CAR,SPEND'
    CYCVOL AS 'ANNUALIZED,CURRENT,CAR,SPEND'
    CCDAY AS 'CURRENT,CAR,DAYS'
    PCVOL AS 'PRIOR,CAR,SPEND'
    PYCVOL AS 'ANNUALIZED,PRIOR,CAR,SPEND'
    PCDAY AS 'PRIOR,CAR,DAYS'
    PYRCVOL AS 'PRIOR YEAR,CAR,SPEND'
    PYRCDAY AS 'PRIOR YEAR,CAR,DAYS'    
    
BY ROLLCD AS 'ROLLUP'
BY RNR_FLAG AS 'RADIUS/,NON-RADIUS'
BY COMP_NAME AS 'COMPANY'
ON ROLLCD SUMMARIZE  AS 'TOTAL FOR'
WHERE TFLAG EQ 'Y'
-* -INCLUDE FOOTERSM
FOOTING BOTTOM
"&&FOOTER1"
"&&FOOTER2"
"eTTek Review &DATE AT <NOWTOD <75 &&FOOTR"
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &LINES GT 0 THEN GOTO XXIT;

EX TCEMPTY
-RUN
-GOTO XXIT;


-XXIT
