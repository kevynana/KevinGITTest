-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO

-*06/02/17-jem-S-34231-Created for new report QBEACH
-*06/19/17-jem-S-34231-Corrected so report would return to email.  Was missing -xxit;
-*06/27/17-jem-S-34231-Updated TYPE to be 6 characters
-*07/19/17-jem-S-37248-Updating norecords report to show all fields with blank values so the customer's load process won't error out also edited class field to show first character only


-**********************************************************************

-**********************************************************************

SET ASNAMES=ON


-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'HOLDA.FOC';
-SET &HNKB=&HLDPATH || 'HOLDH.FOC';
-SET &HNKC=&HLDPATH || 'HOLDC.FOC';

-RUN


-SET &FILENAME = 'HOLDA'; 
-RUN



-DOS STATE &HNKA
-SET &HOLDFILEA = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKB
-SET &HOLDFILEH = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKC
-SET &HOLDFILEC = IF &RETCODE.EVAL EQ 0 THEN &HNKC | ' AS ' | &FILENAME ELSE ' ';


USE ADD 
&HOLDFILEA
&HOLDFILEH
&HOLDFILEC
END
-RUN


TABLE FILE HOLDA
PRINT
  AMOUNT
  GAMOUNT
  TTL_COUNT
  LOST_AMT
  LOW_AMT
  CDAYS
  NEW_RENTAL_AMT
  HTL_AMT
  HTL_NGTS
  NUMCH
  DRATE
BY LEVEL_DESC
BY CLIENT_NUM
BY CLIENT_NAME
BY PASSNGR_NAME
BY LAST_NAME
BY FIRST_NAME
BY PNR_LOCATOR
BY TRAN_DATE
BY FDATE
BY TKT_NUM
BY TKTN
BY TSORT
BY SEG
BY TYPE
BY NAME 
BY AIRLINE
BY DATE
BY EMBARK
BY ROUTE
BY CITY1
BY CITY2
BY EMP_ID
BY FLAG
BY REFUSE_CODE
BY NAMEC
BY CLASS
BY INVOICE_NUM 
BY VENDOR
BY RESV_STATUS
ON TABLE HOLD AS HOLDE 
END
-RUN

-IF &RECORDS EQ 0 THEN GOTO NORECORDS;


-SET &&RPTSUF = 'DTL';
-INCLUDE FDEFRPTS
-RUN


-**************************************************************************
DEFINE FILE HOLDE
COUNT1/D12CS = IF (FLAG EQ 'A') THEN TTL_COUNT ELSE 0;
COUNT2/D12CS = IF (FLAG EQ 'C') THEN TTL_COUNT ELSE 0;
COUNT3/D12CS = IF (FLAG EQ 'H') THEN TTL_COUNT ELSE 0;
COUNT4/D12CS = IF (FLAG EQ 'L') THEN TTL_COUNT ELSE 0;
CLASS1/A1 = EDIT(CLASS, '9');
AMT1/D12.2CS = IF (FLAG EQ 'A') THEN AMOUNT ELSE 0;
AMT2/D12.2CS = IF (FLAG EQ 'C') THEN AMOUNT ELSE 0;
AMT3/D12.2CS = IF (FLAG EQ 'H') THEN AMOUNT ELSE 0;
AMT4/D12.2CS = IF (FLAG EQ 'L') THEN AMOUNT ELSE 0;
FLAGA/A5 = DECODE FLAG ('A' 'AIR'   'C' 'CAR'  'H' 'HTL' 'L' 'LIM'); 
RECKEY/A25='';

XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
TICKET_NMBR/A10 = IF (TKT_NUM EQ '0000000000') THEN ' ' ELSE
                  TKT_NUM;
TKTN1/A10 = IF (TKT_NUM EQ '0000000000') THEN ' ' ELSE TKT_NUM;
TKTN2/A10 = IF TKTN1 EQ ' ' THEN ' ' ELSE TKTN1;
TKTNPG/A10 = IF (TKTN EQ '0000000000') THEN ' ' ELSE
                  TKTN;

-* CUR_DESC/A95 = LEVEL_DESC||'-'||NAMEC;
CUR_DESC/A50 = NAMEC;
  
                 
-*DEFINES ON PREVIOUS DEFINES 
PASNGR_NAME/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
TRAN_MYA/I6MTYY = TRAN_DATE;
NOWTOD/A8 WITH TKT_NUM = HHMMSS (NOWTOD);
-* ITIN/A67 = IF SEG EQ '01' THEN C_ITIN ELSE ' ';
DATE1/MDYY = IF FLAG EQ 'A' THEN ' ' ELSE DATE;
CHAMT/D12.2C = IF FLAG EQ 'C' THEN NEW_RENTAL_AMT ELSE
               IF FLAG EQ 'H' THEN HTL_AMT ELSE 0;

               
DAYS/D12 = IF FLAG EQ 'C' THEN CDAYS ELSE
           IF FLAG EQ 'H' THEN HTL_NGTS ELSE 0;
           
BLANKFIELD/A5 = 'XXXXX';  
ROLL/A8 = '&&ROLLUP.EVAL';
END
-RUN


-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'HOLDE';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************


-IF &&CURRENCY EQ 'USD' THEN GOTO NEXT;

-SET &&SUBHEAD = <CUR_DESC;
-SET &GFAR_CUR = 'AMOUNT, (' | &&CURRENCY || ')';
-SET &GFEE_CUR = 'ARLN, FEE, (' | &&CURRENCY || ')';
-SET &&PRINT3='CITY1/A20 AS ''ORG'' CITY2/A18 AS ''DST'' ';
-SET &&PRINT4='GAMOUNT/D16.2CS AS ' | '''&GFAR_CUR.EVAL''';
-SET &&PRINT5='FEEX/D16.2CS AS ' | '''&GFEE_CUR.EVAL''';
-SET &&PRINT7='COUNT2 AS ''CAR,DAY'' ';


-NEXT;

-* -SET &&OUTLINE2='FORMAT COMT';
-* -RUN 


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;



TABLE FILE HOLDE
-INCLUDE &&PAHDR
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</1"
-NOSPC;
-*"&&SUBHEAD"
"</2"
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
PRINT RECKEY AS 'reckey'
      CLIENT_NUM AS 'account'
      CLIENT_NAME AS 'acctdes'
      EMP_ID AS 'employee'
      LAST_NAME AS 'passlast'
      FIRST_NAME AS 'passfrst'
      TKTN AS 'ticket'
      INVOICE_NUM AS 'invoice'
      TRAN_DATE AS 'invdate'
      GAMOUNT AS 'airchg'
      LOW_AMT AS 'offrdchg'
      REFUSE_CODE AS 'reascode'
      LOST_AMT AS 'lostamt'
      DATE AS 'rdedate'
      EMBARK AS 'origin'
      ROUTE AS 'destinat'
      CITY1 AS 'orgdesc'
      CITY2 AS 'destdesc'
      AIRLINE AS 'airline'
      CLASS1 AS 'class'
      VENDOR AS 'vendor'
      DATE1 AS 'indate'
      DRATE AS 'bookrate'
      TYPE AS 'typecode'
      DAYS AS 'days'
      NUMCH AS 'rooms'
      NEW_RENTAL_AMT AS 'carcost'
      HTL_AMT AS 'hotelcost'
      

BY PASSNGR_NAME NOPRINT
BY TRAN_DATE NOPRINT
BY PNR_LOCATOR NOPRINT
BY TSORT NOPRINT 
BY SEG NOPRINT
BY TKT_NUM NOPRINT
 
FOOTING BOTTOM
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *


-IF &&CURRENCY EQ 'TRL' THEN GOTO SMALLER;
-INCLUDE &&PASTYD
-* -INCLUDE &&SMSTY
-GOTO FINFONT;
-SMALLER
-INCLUDE DT7
-FINFONT

ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO xxit;

-NORECORDS;


-SET &&RPTSUF = 'DTL';
-INCLUDE FDEFRPTS
-RUN


TABLE FILE ROLLUP_SQL
PRINT ROLLUP_CODE
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE HOLD AS NORECH
END
-RUN

DEFINE FILE NORECH
RECKEY/A5 = '';
CLIENT_NUM/A5 = '';
CLIENT_NAME/A5='';
EMP_ID/A5='';
LAST_NAME/A5='';
FIRST_NAME/A5='';
TKTN/A5='';
INVOICE_NUM/A5='';
TRAN_DATE/A5='';
GAMOUNT/A5='';
LOW_AMT/A5='';
REFUSE_CODE/A5='';
LOST_AMT/A5='';
DATE/A5='';
EMBARK/A5='';
ROUTE/A5='';
CITY1/A5='';
CITY2/A5='';
AIRLINE/A5='';
CLASS/A5='';
VENDOR/A5='';
DATE1/A5='';
DRATE/A5='';
TYPE/A5='';
DAYS/A5='';
NUMCH/A5='';
NEW_RENTAL_AMT/A5='';
HTL_AMT/A5='';
END
-RUN

TABLE FILE NORECH
PRINT RECKEY AS 'reckey'
      CLIENT_NUM AS 'account'
      CLIENT_NAME AS 'acctdes'
      EMP_ID AS 'employee'
      LAST_NAME AS 'passlast'
      FIRST_NAME AS 'passfrst'
      TKTN AS 'ticket'
      INVOICE_NUM AS 'invoice'
      TRAN_DATE AS 'invdate'
      GAMOUNT AS 'airchg'
      LOW_AMT AS 'offrdchg'
      REFUSE_CODE AS 'reascode'
      LOST_AMT AS 'lostamt'
      DATE AS 'rdedate'
      EMBARK AS 'origin'
      ROUTE AS 'destinat'
      CITY1 AS 'orgdesc'
      CITY2 AS 'destdesc'
      AIRLINE AS 'airline'
      CLASS AS 'class'
      VENDOR AS 'vendor'
      DATE1 AS 'indate'
      DRATE AS 'bookrate'
      TYPE AS 'typecode'
      DAYS AS 'days'
      NUMCH AS 'rooms'
      NEW_RENTAL_AMT AS 'carcost'
      HTL_AMT AS 'hotelcost'
BY ROLL NOPRINT
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-QUIT



-xxit;
