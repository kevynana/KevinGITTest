-************************************************************************************
-*
-************************************************************************************
-* JK - Updated to pass passenger name selection from screen if utilized
-* DV - Updated to check for presence of misc fee and presence of
-*      name selection and updated code if multiple selections made 12/13/13
-* 4/11/14 - DEB - ADDED TASF_TKT_NUM
-* 6/18/14 - DEB - ADDED GOTO TO SKIP TASF_TKT_NUM IF DVSETF IS BEING RAN
-*                 BECAUSE THIS FIELD IS NOT ON THE COMPOUND REPORT
-* 9/26/14 - DEB - CORRECTED ISSUE WITH MISC FEE FILE NOT WORKING CORRECTLY
-* 9/29/14 - GSE - Added PASSNGR_NAME, INVOICE_NUM, PNR_LOCATOR, TKT_NUM,
-*                 ID_LEVEL1, ID_LEVEL2, ID_LEVEL3, ID_LEVEL4, ID_LEVEL5, ID_LEVEL6,
-*                 and ID_LEVEL7 to PFHOLDM-based TABLE FILEs and removed DEFINEs that
-*                 created these fields for HOLD/HOLDMA/HOLDM
-* 10/22/14 - DEB  CARRIED THROUGH LEVEL6 IN LAST HOLDM FILE
-*3/17/15 S-07667 - ADDED CODE TO EXCLUDE/INCLUDE REPORT SELECTIONS IF MADE - DEB
-*  02/05/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-*  06/26/2015  REJ  S-08389 Latest changes for ER5 Available Reports.
-* 3/29/16 - RSB - S-17009  New version of DVEXPNS called: DVEXPNAG
-*                          Need to add ASSOC_CONF_NUM to HOLDM extract.
-*7/11/16   -DLV - S-20630    Added EMP_ID to extract
-*08/17/17 - DLV - D-01609 - Added additional code to include only records with BR_CL_IDX in 
-*                         air extract
-* 
-DEFAULT &&TOTPAX = 0;
-DEFAULT &&PAXN1 = ' ';
-DEFAULT &&PAXN2 = ' ';
-DEFAULT &&PAXN3 = ' ';
-DEFAULT &&PAXN4 = ' ';
-DEFAULT &&PAXN5 = ' ';
-INCLUDE SETECHO
 
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
 
-IF '&&SETF.EVAL' EQ 'HREXPNS' THEN GOTO CCspec;
 
 
TABLE FILE PFHOLDM
 PRINT BR_CL_IDX 
       PASSNGR_NAME 
       INVOICE_NUM 
       PNR_LOCATOR 
       TKT_NUM
       ID_LEVEL1 
       ID_LEVEL2 
       ID_LEVEL3 
       ID_LEVEL4 
       ID_LEVEL5 
       ID_LEVEL6 
       ID_LEVEL7
       EMP_ID
       TRN_TYPE 
       TRN_DATE 
       FEE_SRC 
       FEE_AMT 
       PAY_METHOD 
       CREDIT_CARD 
       FST_DPT_DATE 
       CNT 
       TASF_TKT_NUM
       ASSOC_CONF_NUM
       EMP_ID
 BY MISC_KEY
WHERE MISC_KEY NE ''
ON TABLE HOLD AS MISCFEE
END
-RUN
-* 
-SET &&MFEE = IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
 
-* CHECK FOR NAME SELECTION
 
-IF &&FROMAVRP EQ 'Y' GOTO :DVM0;
 
TABLE FILE BRPTFLDS
-*PRINT SEG AIRFLDS.PASSENGER
PRINT AIRFLDS.SEQ_NO PASSENGER
IF INST_KEY EQ &&IKEY
ON TABLE HOLD
END
-RUN
-GOTO :DVM0_CONT;
 
-:DVM0
JOIN CLEAR *
JOIN PARM_SEQ IN BRPT_FLDS_PARM TO ALL PARM_SEQ IN BRPT_FLDS_PARM_VALUES AS J1
-RUN
TABLE FILE BRPT_FLDS_PARM
PRINT DATA_VALUE AS 'PASSENGER'
WHERE DB_FIELD EQ 'PASSNGR_NAME'
ON TABLE SET ASNAMES ON
ON TABLE HOLD
END
-RUN
 
JOIN CLEAR *
-RUN
 
-:DVM0_CONT
 
DEFINE FILE HOLD
PAXL/I2 = ARGLEN(33, PASSENGER, 'I2');
PAXN/A12 = EDIT(PASSENGER, '999999999999');
END
TABLE FILE HOLD
PRINT  PAXN
ON TABLE SAVE AS PKEY
END
-RUN
 
 
 
-IF &LINES EQ 0 THEN GOTO XEXIT;
-SET &PAXCNT = &LINES;
-SET &&TOTPAX = &LINES;
-SET &CNT = 1;
-REPEAT TOEND &LINES TIMES
-READ PKEY NOCLOSE  &PAXN.A12.
-SET &&PAXN.&CNT = &PAXN;
 
-SET &CNT = &CNT + 1;
-TOEND
-CLOSE PKEY
 
-XEXIT;
-SET &&MFEEPAX = IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
 
-SET &COM1A = 0;
-SET &COM1B = 0;
-SET &COM1C = 0;
-SET &CN = 0;
-SET &ST = 0;
-SET &COM1D = 0;
-SET &REG = 0;
-SET &COM5 = 0;
-SET &COM6 = 0;
-SET &COM7 = 0;
-SET &WHERE500 = ' ';
-SET &WHERE501 = ' ';
-SET &WHERE502 = ' ';
-SET &WHERE505 = ' ';
-SET &WHERE506 = ' ';
-SET &WHERE507 = ' ';
-SET &WHERE510 = ' ';
-SET &WHERE511 = ' ';
-SET &WHERE512 = ' ';
-SET &WHERE550 = ' ';
-SET &WHERE551 = ' ';
-SET &WHERE552 = ' ';
-SET &WHERE554 = ' ';
-SET &WHERE555 = ' ';
-SET &WHERE556 = ' ';
-SET &WHERE558 = ' ';
-SET &WHERE559 = ' ';
-SET &WHERE600 = ' ';
 
 
-IF &&FROMAVRP EQ 'Y' GOTO :DVM1;
 
TABLE FILE BRPTFLDS
 PRINT SEG.COMMON1.INCL1
 BY INST_KEY NOPRINT
 WHERE INST_KEY EQ &&IKEY
 ON TABLE SAVE AS COMMON1
END
-RUN
-IF       &LINES EQ 0 THEN GOTO Continue;
-READ COMMON1 &COM1A.1. &COM1B.1. &COM1C.1. &CN.1. &ST.1. &COM1D.1. &REG.1. &COM5.1. &COM6.1. &COM7.1.
-CLOSE COMMON1;
-IF &COM1A EQ 0 THEN GOTO ChkLevel2;
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL1
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL1 NE ' '
ON TABLE SAVE AS COMMON2
END
-RUN
 
 
-IF &LINES EQ 0 THEN GOTO ChkLevel2;
 
-SET &CNT = 1;
-SET &WHERE500 = IF &COM1A EQ 1  THEN 'WHERE LEVEL1 EQ '
- ELSE IF &COM1A EQ 2  THEN 'WHERE LEVEL1 NE '
-   ELSE IF &COM1A EQ 3 THEN 'WHERE LEVEL1 CONTAINS '
-   ELSE IF &COM1A EQ 4 THEN 'WHERE LEVEL1 OMITS '
- ELSE ' ';
 
 
-REPEAT TOEND1A &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A15.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(17, &V3, 'I2');
-SET &V1 = SUBSTR(17, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl501;
-IF &CNT GE 51  THEN GOTO Lbl502;
 
-SET &OP = IF &COM1A EQ 1 OR &COM1A EQ 3 OR &COM1A EQ 4 THEN ' OR ' ELSE ' AND LEVEL1 NE ';
 
-SET &WHERE500 = IF &CNT EQ &LINES THEN &WHERE500 | &V1
-   ELSE &WHERE500 | &V1 | '&OP.EVAL';
 
-GOTO Increment1A
-***********
-Lbl501
-***********
-SET &WHERE501 = IF &WHERE500 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE501 | &V1
-    ELSE &WHERE501 | &V1 | '&OP.EVAL';
 
-GOTO Increment1A
-***********
-Lbl502
-***********
-SET &WHERE502 = IF &WHERE500 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE502 | &V1
-    ELSE &WHERE502 | &V1 | '&OP.EVAL';
 
-Increment1A
-SET &CNT = &CNT + 1;
 
-TOEND1A
-CLOSE COMMON2
-RUN
 
-***********
-ChkLevel2
-***********
-IF &COM1B EQ 0 THEN GOTO ChkLevel3;
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL2
WHERE INST_KEY EQ &&IKEY
WHERE COMMON2.ID_LEVEL2 NE ' '
BY INST_KEY NOPRINT
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO ChkLevel3;
-SET &CNT = 1;
 
-SET &WHERE505 = IF &COM1B EQ 1  THEN 'WHERE LEVEL2 EQ '
- ELSE IF &COM1B EQ 2  THEN 'WHERE LEVEL2 NE '
-   ELSE IF &COM1B EQ 3 THEN 'WHERE LEVEL2 CONTAINS '
-   ELSE IF &COM1B EQ 4 THEN 'WHERE LEVEL2 OMITS '
-  ELSE ' ';
 
-REPEAT TOEND1B &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A15.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(17, &V3, 'I2');
-SET &V1 = SUBSTR(17, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl506;
-IF &CNT GE 51  THEN GOTO Lbl507;
 
-IF &V1 EQ '' THEN GOTO Increment1B;
 
-SET &OP = IF &COM1B EQ 1 OR &COM1B EQ 3 OR &COM1B EQ 4 THEN ' OR ' ELSE ' AND LEVEL2 NE ';
 
-SET &WHERE505 = IF &CNT EQ &LINES THEN &WHERE505 | &V1
-   ELSE &WHERE505 | &V1 | '&OP.EVAL';
 
-GOTO Increment1B
-***********
-Lbl506
-***********
-SET &WHERE506 = IF &WHERE505 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE506 | &V1
-    ELSE &WHERE506 | &V1 | '&OP.EVAL';
 
-GOTO Increment1B
-***********
-Lbl507
-***********
-SET &WHERE507 = IF &WHERE505 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE507 | &V1
-    ELSE &WHERE507 | &V1 | '&OP.EVAL';
 
-Increment1B
-SET &CNT = &CNT + 1;
 
-TOEND1B
-CLOSE COMMON2
-RUN
 
-***********
-ChkLevel3
-***********
-IF &COM1C EQ 0 THEN GOTO ChkLevel4;
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL3
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL3 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO ChkLevel4;
-SET &CNT = 1;
-SET &WHERE510 = IF &COM1C EQ 1  THEN 'WHERE LEVEL3 EQ '
- ELSE IF &COM1C EQ 2  THEN 'WHERE LEVEL3 NE '
-   ELSE IF &COM1C EQ 3 THEN 'WHERE LEVEL3 CONTAINS '
-   ELSE IF &COM1C EQ 4 THEN 'WHERE LEVEL3 OMITS '
- ELSE ' ';
 
-REPEAT TOEND1C &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A15.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(17, &V3, 'I2');
-SET &V1 = SUBSTR(17, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl511;
-IF &CNT GE 51  THEN GOTO Lbl512;
 
-IF &V1 EQ '' THEN GOTO Increment1C;
 
-SET &OP = IF &COM1C EQ 1 OR &COM1C EQ 3  OR &COM1C EQ 4 THEN ' OR ' ELSE ' AND LEVEL3 NE ';
 
-SET &WHERE510 = IF &CNT EQ &LINES THEN &WHERE510 | &V1
-   ELSE &WHERE510 | &V1 | '&OP.EVAL';
 
-GOTO Increment1C
-***********
-Lbl511
-***********
-SET &WHERE511 = IF &WHERE510 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE511 | &V1
-    ELSE &WHERE511 | &V1 | '&OP.EVAL';
 
-GOTO Increment1C
-***********
-Lbl512
-***********
-SET &WHERE512 = IF &WHERE510 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE512 | &V1
-    ELSE &WHERE512 | &V1 | '&OP.EVAL';
 
-Increment1C
-SET &CNT = &CNT + 1;
 
-TOEND1C
-CLOSE COMMON2
-RUN
 
-* REJ ****************************************************************************
-***********
-ChkLevel4
-***********
-IF &COM1D EQ 0 THEN GOTO ChkLevel5;
-*-IF &COM1D EQ 0 THEN GOTO ChkViewType;
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL4
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL4 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO ChkLevel5;
-SET &CNT = 1;
-SET &WHERE550 = IF &COM1D EQ 1  THEN 'WHERE LEVEL4 EQ '
- ELSE IF &COM1D EQ 2  THEN 'WHERE LEVEL4 NE '
-   ELSE IF &COM1D EQ 3 THEN 'WHERE LEVEL4 CONTAINS '
-   ELSE IF &COM1D EQ 4 THEN 'WHERE LEVEL4 OMITS '
- ELSE ' ';
 
-REPEAT TOEND1D &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A60.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(62, &V3, 'I2');
-SET &V1 = SUBSTR(62, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 10 AND &CNT LE 20 THEN GOTO Lbl551;
-IF &CNT GE 21  THEN GOTO Lbl552;
 
-IF &V1 EQ '' THEN GOTO Increment1D;
 
-SET &OP = IF &COM1D EQ 1 OR &COM1D EQ 3 OR &COM1D EQ 4 THEN ' OR ' ELSE ' AND LEVEL4 NE ';
 
-SET &WHERE550 = IF &CNT EQ &LINES THEN &WHERE550 | &V1
-   ELSE &WHERE550 | &V1 | '&OP.EVAL';
 
-GOTO Increment1D
-***********
-Lbl551
-***********
-SET &WHERE551 = IF &WHERE550 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE551 | &V1
-    ELSE &WHERE551 | &V1 | '&OP.EVAL';
 
-GOTO Increment1D
-***********
-Lbl552
-***********
-SET &WHERE552 = IF &WHERE550 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE552 | &V1
-    ELSE &WHERE552 | &V1 | '&OP.EVAL';
 
-Increment1D
-SET &CNT = &CNT + 1;
 
-TOEND1D
-CLOSE COMMON2
-RUN
 
-ChkLevel5
-***********
-IF &COM5 EQ 0 THEN GOTO ChkLevel6;
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL5
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL5 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO ChkLevel6;
-SET &CNT = 1;
-SET &WHERE554 = IF &COM5 EQ 1  THEN 'WHERE LEVEL5 EQ '
- ELSE IF &COM5 EQ 2 THEN 'WHERE LEVEL5 NE '
- ELSE IF &COM5 EQ 3 THEN 'WHERE LEVEL5 CONTAINS '
- ELSE IF &COM5 EQ 4 THEN 'WHERE LEVEL5 OMITS '
- ELSE ' ';
 
-REPEAT TOENDIDlvl5 &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A20.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(22, &V3, 'I2');
-SET &V1 = SUBSTR(22, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl555;
-IF &CNT GE 51  THEN GOTO Lbl556;
 
-IF &V1 EQ '' THEN GOTO IncrementID5;
 
-SET &OP = IF &COM5 EQ 1 OR &COM5 EQ 3  OR &COM5 EQ 4 THEN ' OR ' ELSE ' AND LEVEL5 NE ';
 
-SET &WHERE554 = IF &CNT EQ &LINES THEN &WHERE554 | &V1
-   ELSE &WHERE554 | &V1 | '&OP.EVAL';
 
-GOTO IncrementID5
-***********
-Lbl555
-***********
-SET &WHERE555 = IF &WHERE554 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE555 | &V1
-    ELSE &WHERE555 | &V1 | '&OP.EVAL';
 
-GOTO IncrementID5
-***********
-Lbl556
-***********
-SET &WHERE556 = IF &WHERE554 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE556 | &V1
-    ELSE &WHERE556 | &V1 | '&OP.EVAL';
 
-IncrementID5
-SET &CNT = &CNT + 1;
 
-TOENDIDlvl5
-CLOSE COMMON2
-RUN
 
-***********
-ChkLevel6
-***********
-IF &COM6 EQ 0 THEN GOTO EndCheck;
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL6
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL6 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO ChkLevel7;
-SET &CNT = 1;
-SET &WHERE558 = IF &COM6 EQ 1  THEN 'WHERE LEVEL6 EQ '
- ELSE IF &COM6 EQ 2 THEN 'WHERE LEVEL6 NE '
- ELSE IF &COM6 EQ 3 THEN 'WHERE LEVEL6 CONTAINS '
- ELSE IF &COM6 EQ 4 THEN 'WHERE LEVEL6 OMITS '
- ELSE ' ';
 
-REPEAT TOENDIDlvl6 &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A20.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(22, &V3, 'I2');
-SET &V1 = SUBSTR(22, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl559;
-IF &CNT GE 51  THEN GOTO Lbl560;
 
-IF &V1 EQ '' THEN GOTO IncrementID6;
 
-SET &OP = IF &COM6 EQ 1 OR &COM6 EQ 3  OR &COM6 EQ 4 THEN ' OR ' ELSE ' AND LEVEL6 NE ';
 
-SET &WHERE558 = IF &CNT EQ &LINES THEN &WHERE558 | &V1
-   ELSE &WHERE558 | &V1 | '&OP.EVAL';
 
-GOTO IncrementID6
-***********
-Lbl559
-***********
-SET &WHERE559 = IF &WHERE558 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE559 | &V1
-    ELSE &WHERE559 | &V1 | '&OP.EVAL';
 
-GOTO IncrementID6
-***********
-Lbl560
-***********
-SET &WHERE560 = IF &WHERE558 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE560 | &V1
-    ELSE &WHERE560 | &V1 | '&OP.EVAL';
 
-IncrementID6
-SET &CNT = &CNT + 1;
 
-TOENDIDlvl6
-CLOSE COMMON2
-RUN
 
-EndCheck
-GOTO :DVM1_CONT;
 
-:DVM1
 
APP FI TEMPPARM DISK TEMPPARM.FEX 
-RUN
 
 
-* Counters that will be used to keep track if a where statement was
-* created for each category (Air, Hotel, Car, or Limo)
-SET &ACTR=0;
-SET &HCTR=0;
-SET &CCTR=0;
-SET &LCTR=0;
 
JOIN CLEAR *
JOIN OPERATOR IN BRPT_FLDS_PARM TO OPERATOR IN SELECTION_OPERATORS AS J1
JOIN PARM_SEQ IN BRPT_FLDS_PARM TO ALL PARM_SEQ IN BRPT_FLDS_PARM_VALUES AS J2
JOIN INST_KEY IN BRPT_FLDS_PARM TO INST_KEY IN BRPT_FLDS_MISC AS J3
-RUN
 
DEFINE FILE BRPT_FLDS_PARM
FIELD_DESC/A50=DESCRIPTION;
DATA_DESC/A10='All' ;
OPER_DESC/A50=SELECTION_OPERATORS.DESCRIPTION;
END
TABLE FILE BRPT_FLDS_PARM
SUM MAX.PARM_VALUE_SEQ
BY DEFAULT_PARM
BY PARM_SEQ
PRINT INST_KEY
      SELECTION_AND_OR
	  DEFAULTS_SELECTION_AND_OR
	  DB_FIELD
	  OPERATOR
	  VALUE_FORMAT
	  PARM_VALUE_SEQ
	  DATA_VALUE
	  DATA_VALUE_DESCRIPTION
	  FIELD_DESC
	  DATA_TYPE
	  DATA_DESC
-*	  WHERE_TOTAL
-*	  RANGE
	  OPER_DESC
BY DEFAULT_PARM
BY PARM_SEQ
BY PARM_VALUE_SEQ
WHERE DB_FIELD EQ 'LEVEL1' OR 'LEVEL2' OR 'LEVEL3' OR 'LEVEL4' OR 'LEVEL5' OR 'LEVEL6'
WHERE BRPT_FLDS_PARM.DEFAULT_PARM EQ 0
WHERE BRPT_FLDS_PARM_VALUES.DEFAULT_PARM EQ 0
ON TABLE SAVE
END
-RUN
 
-SET &NPARMS=&RECORDS;
-IF &RECORDS EQ 0 GOTO :DVM1_CONT0;
-SET &PVAL1='';
-SET &PVAL2='';
-SET &PVALDESC='';
-SET &HDEFP='';
-SET &HDEFSF='N';
-:NextParm
-READ SAVE &DEFP.11, &PNBR.11, &TOTVALS.11, &PVAL.11, &PIKEY.11, &ANDOR.3, &DANDOR.3,
-, &DBFLD.64, &OPER.16, &VFMT.2, &XFILL.11, &VAL.50, &VALDESC.500, &FLDDESC.50, &PTYPE.10,
-, &PDESC.10, &ODESC.50
-IF &IORETURN NE 0 GOTO :DVM1_CONT0;
 
-SET &TOK=TRUNCATE('&VAL.EVAL');
-SET &DBF0=TRUNCATE('&DBFLD.EVAL');
-SET &DBF='&DBF0.EVAL';
-SET &OPR=TRUNCATE('&OPER.EVAL');
-SET &OPD=TRUNCATE('&ODESC.EVAL');
-SET &DBD=TRUNCATE('&FLDDESC.EVAL');
-SET &VDS=TRUNCATE('&VALDESC.EVAL');
 
-SET &OPER1=IF &DBF0 EQ 'EMBRTE' AND &VDS.LENGTH EQ 3 AND &OPR EQ 'CONTAINS' THEN 'LIKE' ELSE
-           IF &DBF0 EQ 'EMBRTE' AND &VDS.LENGTH EQ 3 THEN 'NOT LIKE' ELSE
-           IF &OPER EQ 'BEGINS' THEN 'LIKE' ELSE
-           IF &OPER EQ 'ENDS' THEN 'LIKE' ELSE &OPR;
-SET &OPER1A=&OPR;
-SET &ROPER='';
-SET &PVALUE=IF &DBF0 EQ 'EMBRTE' AND &VDS.LENGTH EQ 3 THEN ('''' || &TOK || '%' || '''') |  ' OR ' | ('''' || '%' || &TOK || '''') ELSE
-            IF &OPER EQ 'BEGINS' THEN &TOK || '%' ELSE
-            IF &OPER EQ 'ENDS' THEN '%' || &VAL ELSE &TOK;
-SET &POR= ' OR ';
-SET &PVAL1=IF &DBF0 EQ 'EMBRTE' AND &VDS.LENGTH EQ 3 THEN &PVALUE ELSE           
-           IF EDIT(&VFMT.&CTR,'9') EQ 'T' THEN '''' | &PVALUE | '''' ELSE &PVALUE;
-SET &PVAL2=IF &PVAL EQ 1 THEN &PVAL1 ELSE
-           IF &TOTVALS GE &PVAL THEN &PVAL2 | ' OR ' | &PVAL1 ELSE &PVAL2;
-SET &PVALDESC=IF &PVAL EQ 1 THEN &VDS ELSE &PVALDESC | ' OR ' | &VDS;
-IF &TOTVALS NE &PVAL GOTO :NextParm;
 
-SET &ACTR = &ACTR + 1;
-SET &HDEFP = IF &ACTR EQ 1 THEN &DEFP ELSE &HDEFP;
-* set WHERE
-SET &WHERE1=IF &ACTR EQ 1 THEN 'WHERE' ELSE
-            IF &DEFP NE &HDEFP THEN 'WHERE' ELSE '';
-* set AND/OR
-SET &WANDOR=IF &ACTR EQ 1 THEN '' ELSE
-            IF &DEFP NE &HDEFP THEN '' ELSE
-            IF &HDEFSF EQ 'Y' THEN ' &DANDOR.EVAL' ELSE ' &ANDOR.EVAL';
-SET &WANDORSF=IF &ACTR EQ 1 THEN '' ELSE
-            IF &DEFP NE &HDEFP THEN '</1' ELSE
-            IF &HDEFSF EQ 'Y' THEN ' &DANDOR.EVAL' ELSE ' &ANDOR.EVAL';
 
-WRITE TEMPPARM NOCLOSE &WANDOR &WHERE1 (&DBF &OPER1 &PVAL2)
-GOTO :NextParm;
 
JOIN CLEAR *
-RUN
-:DVM1_CONT0
-CLOSE TEMPPARM
 
-:DVM1_CONT
 
 
-GOTO Continue;
-* 
-******* 
-CCspec
-******* 
TABLE FILE PFHOLDM
 PRINT BR_CL_IDX 
       PASSNGR_NAME 
       INVOICE_NUM 
       PNR_LOCATOR 
       TKT_NUM
       ID_LEVEL1 
       ID_LEVEL2 
       ID_LEVEL3 
       ID_LEVEL4 
       ID_LEVEL5 
       ID_LEVEL6 
       ID_LEVEL7
       EMP_ID
       TRN_TYPE 
       TRN_DATE 
       FEE_SRC 
       FEE_AMT 
       PAY_METHOD 
       CREDIT_CARD 
       FST_DPT_DATE 
       CNT 
       TASF_TKT_NUM
       ASSOC_CONF_NUM
       EMP_ID
BY MISC_KEY
WHERE MISC_KEY NE ' '
WHERE CREDIT_CARD CONTAINS '3122361602'
ON TABLE HOLD AS MISCFEE
END
-RUN
-*
-**********
-Continue
-**********


-* 
-IF '&&MFEE.EVAL' EQ 'N'  THEN GOTO MiscXXIT;


-* Added additional code to include only MISC fees with BR_CL_IDX based on hierarchy selection

TABLE FILE HOLDA
SUM ACCT
BY ACCT NOPRINT
ON TABLE SAVE AS CLIENT
END
-RUN
 
-* End of additional code


-* 
DEFINE FILE MISCFEE
-*PASSNGR_NAME/A33 = EDIT(MISC_KEY, '$$$$$$$999999999999999999999999999999999');
-*INVOICE_NUM/A7= EDIT(MISC_KEY, '9999999');
-*TEST/A35 = EDIT(MISC_KEY, '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99999999999999999999999999999999999');
-*XL01/I2 = POSIT(MISC_KEY, 75, '4', 1, 'I2');
-*TEST2/I2= POSIT(TEST, 35, '-', 1, 'I2');
-*DASH3/A15 = GETTOK(TEST, 35, 3, '-', 15, DASH3);
-*DASH2/A15 = GETTOK(TEST, 35, 2, '-', 15, DASH2);
-*DASH4/A60 = '                                                            ';
 CATEGORY    /A15 = '               ';
-*LEVEL1/A15 = EDIT(TEST, '$$$$$$999999999999999');
-*PNR_LOCATOR/A6  = '      ';
-*TKT_NUM    /A30 = '                              ';
 TKT_NUM_30  /A30 = TKT_NUM;
 TSORT       /A11 = '           ';
 TYPE        /A3  = 'SAL';
 XFST_DT     /MDYY= FST_DPT_DATE;
 DATE2       /MDYY= FST_DPT_DATE;
 DATA_V1     /A9  = '*********';
 DV_NUM2     /A6  = EDIT(CREDIT_CARD, '$$$$$$$$$$$$999999');
 DV_NUM      /A15 = IF DV_NUM2 EQ ' ' THEN ' ' ELSE DATA_V || DV_NUM2;
 AMOUNT      /D12.2CS= FEE_AMT;
 TTL_COUNT   /D12CS  = CNT;
 ACCT        /A8   = '        ';
 LEVEL_DESC  /A60  = '                                                            ';
 GEO_ZONE    /A3   = '   ';
 TRIP_PURPOSE/A2   = '  ';
 TRP_DESC    /A40  = '                                        ';
 NAME        /A3   = '   ';
 STATUS      /A1   = 'O';
 FLAG        /A1   = 'M';
 CITY1       /A25  = 'MISC SVC FEE'; 
 SEG         /A2   = '  ';
 XTRAN_DT    /MDYY = TRN_DATE;
 BLANK20     /A20  = '                    ';
 BLANK50     /A50  = '                                                  ';
END
-*
TABLE FILE MISCFEE
PRINT PASSNGR_NAME
      PNR_LOCATOR
      XTRAN_DT     AS 'TRAN_DATE' 
      TKT_NUM_30   AS 'TKT_NUM'
      TSORT
      TYPE
      EMP_ID
      SEG
      NAME
      XFST_DT      AS 'DATE'
      DATE2
      CITY1
      DV_NUM
      AMOUNT
      TTL_COUNT
      BR_CL_IDX    AS 'ACCT'
      INVOICE_NUM
      STATUS
      LEVEL_DESC
-* 
-*   LEVEL1
-*   DASH2   AS 'LEVEL2'
-*   DASH3   AS 'LEVEL3'
-*   DASH4   AS 'LEVEL4'
-*   BLANK20 AS 'LEVEL5'
-*   BLANK20 AS 'LEVEL6'
-*   BLANK50 AS 'LEVEL7'
-* 
      ID_LEVEL1 AS 'LEVEL1'
      ID_LEVEL2 AS 'LEVEL2'
      ID_LEVEL3 AS 'LEVEL3'
      ID_LEVEL4 AS 'LEVEL4'
      ID_LEVEL5 AS 'LEVEL5'
      ID_LEVEL6 AS 'LEVEL6'
      ID_LEVEL7 AS 'LEVEL7'
-* 
      GEO_ZONE
      TRIP_PURPOSE
      TRP_DESC
      TASF_TKT_NUM
      ASSOC_CONF_NUM
BY FLAG
BY PASSNGR_NAME NOPRINT
WHERE BR_CL_IDX IN FILE CLIENT
ON TABLE HOLD
END
-RUN
-* 
 
TABLE FILE HOLD
PRINT PASSNGR_NAME
      PNR_LOCATOR
      TRAN_DATE
      TKT_NUM
      TSORT
      TYPE
      EMP_ID
      SEG
      NAME
      DATE
      DATE2
      CITY1
      DV_NUM
      AMOUNT
      TTL_COUNT
      ACCT
      INVOICE_NUM
      STATUS
      LEVEL_DESC
      LEVEL1
      LEVEL2
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      LEVEL7
      GEO_ZONE
      TRIP_PURPOSE
      TRP_DESC
      TASF_TKT_NUM
      ASSOC_CONF_NUM
BY FLAG
BY PASSNGR_NAME NOPRINT
ON TABLE HOLD AS HOLDMA FORMAT FOCUS
END
-RUN


 
-IF '&&SETF.EVAL' EQ 'DVEXPNS' OR 'DVEXPNAG' THEN GOTO NextFile;
 
 
TABLE FILE HOLDMA
PRINT PASSNGR_NAME
BY PASSNGR_NAME NOPRINT
ON TABLE SAVE AS PAXFILE
END
-RUN
 
-READ PAXFILE &&PN.33
 
 
TABLE FILE HOLDMA
PRINT PASSNGR_NAME
      PNR_LOCATOR
      TRAN_DATE
      TKT_NUM
      TSORT
      TYPE
      EMP_ID
      SEG
      NAME
      DATE
      DATE2
      CITY1
      DV_NUM
      AMOUNT
      TTL_COUNT
      ACCT
      INVOICE_NUM
      STATUS
      LEVEL_DESC
      LEVEL1
      LEVEL2
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      LEVEL7
      GEO_ZONE
      TRIP_PURPOSE
      TRP_DESC
      TASF_TKT_NUM
      ASSOC_CONF_NUM
-*FEE_AMT
BY FLAG
BY PASSNGR_NAME NOPRINT
-IF '&&MFEEPAX.EVAL' EQ 'N' GOTO NOPAXWHR;
-*WHERE '&&PAX.EVAL' EQ '&&PN.EVAL'
-IF &&TOTPAX.EVAL EQ 1 THEN GOTO ONEPX;
-IF &&TOTPAX.EVAL EQ 2 THEN GOTO TWOPX;
-IF &&TOTPAX.EVAL EQ 3 THEN GOTO THREEPX;
-IF &&TOTPAX.EVAL EQ 4 THEN GOTO FOURPX;
-IF &&TOTPAX.EVAL EQ 5 THEN GOTO FIVEPX;
-*
-********
-ONEPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL
-GOTO NOPAXWHR
-*
-********
-TWOPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR  &&PAXN2.EVAL
-GOTO NOPAXWHR
-*
-********
-THREEPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR  &&PAXN2.EVAL  OR  &&PAXN3.EVAL
-GOTO NOPAXWHR
-*
-********
-FOURPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR  &&PAXN2.EVAL  OR  &&PAXN3.EVAL  OR  &&PAXN4.EVAL
-GOTO NOPAXWHR
-*
-********
-FIVEPX
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR &&PAXN2.EVAL  OR &&PAXN3.EVAL  OR  &&PAXN4.EVAL  OR  &&PAXN5.EVAL
-*
-********
-NOPAXWHR
-********
 
&WHERE500
&WHERE501
&WHERE502
&WHERE505
&WHERE506
&WHERE507
&WHERE510
&WHERE511
&WHERE512
&WHERE550
&WHERE551
&WHERE552
&WHERE554
&WHERE555
&WHERE556
&WHERE558
&WHERE559
&WHERE600
-IF &&FROMAVRP NE 'Y' GOTO :DVNOW;
-INCLUDE TEMPPARM
-*
-********
-:DVNOW
-********
ON TABLE HOLD AS HOLDM FORMAT FOCUS
END
-RUN
-* 
-GOTO MiscXXIT
-*
-********
-NextFile
-********

TABLE FILE HOLDMA
PRINT PASSNGR_NAME
     PNR_LOCATOR
     TRAN_DATE
     TKT_NUM
     TSORT
     TYPE
     EMP_ID
     SEG
     NAME
     DATE
     DATE2
     CITY1
     DV_NUM
     AMOUNT
     TTL_COUNT
     ACCT
     INVOICE_NUM
     STATUS
     LEVEL_DESC
     LEVEL1
     LEVEL2
     LEVEL3
     LEVEL4
     LEVEL5
     LEVEL6
     GEO_ZONE
     TRIP_PURPOSE
     TRP_DESC
     TASF_TKT_NUM
     ASSOC_CONF_NUM
-*FEE_AMT
BY FLAG
BY PASSNGR_NAME NOPRINT
-*
-IF '&&MFEEPAX.EVAL' EQ 'N' GOTO NOPAXWHR;
-*WHERE '&&PAX.EVAL' EQ '&&PN.EVAL'
-IF &&TOTPAX.EVAL EQ 1 THEN GOTO ONEPX;
-IF &&TOTPAX.EVAL EQ 2 THEN GOTO TWOPX;
-IF &&TOTPAX.EVAL EQ 3 THEN GOTO THREEPX;
-IF &&TOTPAX.EVAL EQ 4 THEN GOTO FOURPX;
-IF &&TOTPAX.EVAL EQ 5 THEN GOTO FIVEPX;
-*
-********
-ONEPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL
-GOTO NOPAXWHR
-*
-********
-TWOPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR  &&PAXN2.EVAL
-GOTO NOPAXWHR
-*
-********
-THREEPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR  &&PAXN2.EVAL  OR  &&PAXN3.EVAL
-GOTO NOPAXWHR
-*
-********
-FOURPX;
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR  &&PAXN2.EVAL  OR  &&PAXN3.EVAL  OR  &&PAXN4.EVAL
-GOTO NOPAXWHR
-*
-********
-FIVEPX
-********
IF PASSNGR_NAME CONTAINS   &&PAXN1.EVAL  OR &&PAXN2.EVAL  OR &&PAXN3.EVAL  OR  &&PAXN4.EVAL  OR  &&PAXN5.EVAL
-*
-********
-NOPAXWHR
-******** 
&WHERE500
&WHERE501
&WHERE502
&WHERE505
&WHERE506
&WHERE507
&WHERE510
&WHERE511
&WHERE512
&WHERE550
&WHERE551
&WHERE552
&WHERE554
&WHERE555
&WHERE556
&WHERE558
&WHERE559
&WHERE600
-* 
-IF &&FROMAVRP NE 'Y' GOTO :DVNOW1;
-INCLUDE TEMPPARM
-*
-********
-:DVNOW1
-******** 
ON TABLE HOLD AS HOLDM FORMAT FOCUS 
END
-RUN
-*
-******** 
-MiscXXIT
-********
 
 
 
 
 
 
 
 

