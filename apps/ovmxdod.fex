-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Percentages were not rounding up..fixed so they would JK 10/21/03 JK
-* 12/28/04 - DEB - ADDED ADDT'L DOD_TYPE TO INT_FLAG DEFINE
-* 10/11/05 - DEB - ADDED DOD_TYPE H TO INT_FLAG DEFINE
-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE


SET ASNAMES=ON

DEFINE FILE OVMXHLD
FARE_PAID/D12.2 = SEG_AMT + SEG_TAX ;

CY/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND
                TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PY/A1 =  IF TRN_DATE GE &&FXDATE.EVAL AND
               TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
INT_FLAG/A15 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE
   IF DOD_DESC CONTAINS 'EXCHANGE' THEN 'EXCHANGE' ELSE
   IF DOD_DESC CONTAINS 'WEB' THEN 'WEB' ELSE 'TRADITIONAL'; 

NET_TKT_CNT/D12      = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;

CYINT_TKT/D12 = IF (INT_FLAG EQ 'ONLINE') AND
                   (CY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
CYAGT_TKT/D12 = IF (INT_FLAG EQ 'TRADITIONAL') AND
                   (CY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
PYINT_TKT/D12 = IF (INT_FLAG EQ 'ONLINE') AND
                   (PY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
PYAGT_TKT/D12 = IF (INT_FLAG EQ 'TRADITIONAL') AND
                   (PY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
CYTTL_TKT/D12.2 = IF (INT_FLAG EQ 'ONLINE' OR 'TRADITIONAL') AND
                   (CY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
PYTTL_TKT/D12.2 = IF (INT_FLAG EQ 'ONLINE' OR 'TRADITIONAL') AND
                   (PY EQ 'Y') THEN NET_TKT_CNT ELSE 0;
FLAG/A1 = 'A';

END
-RUN

TABLE FILE OVMXHLD
SUM CYINT_TKT PYINT_TKT CYAGT_TKT PYAGT_TKT
    CYTTL_TKT PYTTL_TKT
BY FLAG
BY INT_FLAG
ON TABLE HOLD AS OVINT1 
END
-RUN

TABLE FILE OVMXHLD
SUM CYTTL_TKT AS 'CYTTL_TKT1'
    PYTTL_TKT AS 'PYTTL_TKT1'
BY FLAG
ON TABLE HOLD AS HOLD1
END
-RUN

MATCH FILE OVINT1
PRINT CYINT_TKT
      PYINT_TKT
      CYAGT_TKT
      PYAGT_TKT
      CYTTL_TKT
      PYTTL_TKT
      INT_FLAG
BY FLAG
ON TABLE HOLD
RUN
FILE HOLD1
SUM CYTTL_TKT1
    PYTTL_TKT1
BY FLAG
AFTER MATCH HOLD AS TTLHOLD OLD-OR-NEW
END
-RUN

TABLE FILE TTLHOLD
SUM CYINT_TKT PYINT_TKT CYAGT_TKT PYAGT_TKT CYTTL_TKT PYTTL_TKT
COMPUTE CYTTL_PCT/P12.2 = CYTTL_TKT/CYTTL_TKT1*100;
        PYTTL_PCT/P12.2 = PYTTL_TKT/PYTTL_TKT1*100;
BY INT_FLAG
ON TABLE HOLD AS TTLHOLD1
END
-RUN







DEFINE FILE TTLHOLD1
CATEGORY/A30 = 'BOOKING TYPE';
CAT_ORDER/I2 = 4;
END
-RUN

TABLE FILE TTLHOLD1
PRINT CATEGORY/A30 AND INT_FLAG/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CYINT_TKT/D15 AS 'VOL_CURR' AND 
CYTTL_PCT/D15 AS 'TKT_CURR' AND PYINT_TKT/D15 AS 'VOL_PRIOR' 
AND PYTTL_PCT/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
WHERE INT_FLAG EQ 'ONLINE';
ON TABLE HOLD AS OVINT2
END
-RUN

TABLE FILE OVINT2
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
      AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS OVINT3
END
MODIFY FILE OV1_MAIN
FIXFORM FROM OVINT3
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVINT3
END


DEFINE FILE TTLHOLD1
CATEGORY/A30 = 'BOOKING TYPE';
CAT_ORDER/I2 = 4;
END
-RUN

TABLE FILE TTLHOLD1
PRINT CATEGORY/A30 AND INT_FLAG/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CYAGT_TKT/D15 AS 'VOL_CURR' AND 
CYTTL_PCT/D15 AS 'TKT_CURR' AND PYAGT_TKT/D15 AS 'VOL_PRIOR' 
AND PYTTL_PCT/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1; 
WHERE INT_FLAG EQ 'TRADITIONAL';   
ON TABLE HOLD AS OVINT2
END
-RUN

TABLE FILE OVINT2
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
      AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS OVINT3
END
MODIFY FILE OV1_MAIN
FIXFORM FROM OVINT3
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVINT3
END
-RUN






