-* File UPDAL.FEX
-GOTO CUCU77

-***************************************************************************
-* This program will update the AL, CL and HL databases when there is a blank
-* AROLL_LEV1 or AROLL_DSC1 - based off of the TTPHIERA0 file.
-* DATE           NAME
-* 03/27/02       Steve Cords - Initial Creation
-***************************************************************************

TABLE FILE A1METX
PRINT AIR_KEY LEVEL3
BY AIR_KEY NOPRINT
IF LEVEL3 = 'NEWFNPCC' OR 'GENAMPCC' OR 'PARAPCC'
ON TABLE HOLD
END
-RUN

MODIFY FILE A1METX
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE LEVEL3='PERSONALCC';
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

-DRILLPROB

USE
F:\TNT\TTRACKER\DATA\ALMETX.FOC AS ALMETX
END
-RUN

TABLE FILE ALMETX
PRINT AIR_KEY AROLL_DSC4 AND COMPUTE
-* LOB
AROLL_DSCA4/A60 = GETTOK (AROLL_DSC4, 60, 1, '(', 60, AROLL_DSCA4);
AROLL_DSCF4/A11 = GETTOK (AROLL_DSC4, 60, -1, '(', 11, AROLL_DSCF4);
AROLL_DSCL4/A11 = GETTOK (AROLL_DSCF4, 60, 1, ')', 11, AROLL_DSCF4);
-* SUB-LOB
AROLL_DSCA5/A60 = GETTOK (AROLL_DSC5, 60, 1, '(', 60, AROLL_DSCA5);
AROLL_DSCF5/A11 = GETTOK (AROLL_DSC5, 60, -1, '(', 11, AROLL_DSCF5);
AROLL_DSCL5/A11 = GETTOK (AROLL_DSCF5, 60, 1, ')', 11, AROLL_DSCF5);
-* DEPARTMENT
AROLL_DSCA6/A60 = GETTOK (AROLL_DSC6, 60, 1, '(', 60, AROLL_DSCA6);
AROLL_DSCF6/A11 = GETTOK (AROLL_DSC6, 60, -1, '(', 11, AROLL_DSCF6);
AROLL_DSCL6/A11 = GETTOK (AROLL_DSCF6, 60, 1, ')', 11, AROLL_DSCF6);
-* DIVISION
AROLL_DSCA7/A60 = GETTOK (AROLL_DSC7, 60, 1, '(', 60, AROLL_DSCA7);
AROLL_DSCF7/A11 = GETTOK (AROLL_DSC7, 60, -1, '(', 11, AROLL_DSCF7);
AROLL_DSCL7/A11 = GETTOK (AROLL_DSCF7, 60, 1, ')', 11, AROLL_DSCF7);
-* COST CENTER
AROLL_DSCA8/A60 = GETTOK (AROLL_DSC8, 60, 1, '(', 60, AROLL_DSCA8);
AROLL_DSCF8/A11 = GETTOK (AROLL_DSC8, 60, -1, '(', 11, AROLL_DSCF8);
AROLL_DSCL8/A11 = GETTOK (AROLL_DSCF8, 60, 1, ')', 11, AROLL_DSCF8);
-* IF RECORDLIMIT EQ 100
ON TABLE HOLD AS HOLD1
END

DEFINE FILE HOLD1
-* LOB
AROLL_DSCZ/A130 = '('||AROLL_DSCA4||' - LOB';
AROLL_DSC4/A60 =
EDIT
(AROLL_DSCZ, '999999999999999999999999999999999999999999999999999999999999');
-* SUB LOB
AROLL_DSCY/A130 = '('||AROLL_DSCA5||' - sub LOB';
AROLL_DSC5/A60 =
EDIT
(AROLL_DSCY, '999999999999999999999999999999999999999999999999999999999999');
-* DEPARTMENT
AROLL_DSCX/A130 = '('||AROLL_DSCA6||' - Department';
AROLL_DSC6/A60 =
EDIT
(AROLL_DSCX, '999999999999999999999999999999999999999999999999999999999999');
-* DIVISION
AROLL_DSCW/A130 = '('||AROLL_DSCA7||' - Division';
AROLL_DSC7/A60 =
EDIT
(AROLL_DSCW, '999999999999999999999999999999999999999999999999999999999999');
-* COST CENTER
AROLL_DSCV/A130 = '('||AROLL_DSCA8||' - Cost Center';
AROLL_DSC8/A60 =
EDIT
(AROLL_DSCV, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD1
PRINT AIR_KEY AROLL_DSC4 AROLL_DSC5 AROLL_DSC6 AROLL_DSC7 AROLL_DSC8
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE ALMETX
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_DSC5
ON MATCH UPDATE AROLL_DSC6
ON MATCH UPDATE AROLL_DSC7
ON MATCH UPDATE AROLL_DSC8
ON NOMATCH REJECT
DATA ON HOLD2
END
-RUN
-EXIT

-DRILLPROBC

USE
F:\TNT\TTRACKER\DATA\CLMETX.FOC AS CLMETX
END
-RUN

TABLE FILE CLMETX
PRINT CAR_KEY AROLL_DSC4 AND COMPUTE
-* LOB
AROLL_DSCA4/A60 = GETTOK (AROLL_DSC4, 60, 1, '(', 60, AROLL_DSCA4);
AROLL_DSCF4/A11 = GETTOK (AROLL_DSC4, 60, -1, '(', 11, AROLL_DSCF4);
AROLL_DSCL4/A11 = GETTOK (AROLL_DSCF4, 60, 1, ')', 11, AROLL_DSCF4);
-* SUB-LOB
AROLL_DSCA5/A60 = GETTOK (AROLL_DSC5, 60, 1, '(', 60, AROLL_DSCA5);
AROLL_DSCF5/A11 = GETTOK (AROLL_DSC5, 60, -1, '(', 11, AROLL_DSCF5);
AROLL_DSCL5/A11 = GETTOK (AROLL_DSCF5, 60, 1, ')', 11, AROLL_DSCF5);
-* DEPARTMENT
AROLL_DSCA6/A60 = GETTOK (AROLL_DSC6, 60, 1, '(', 60, AROLL_DSCA6);
AROLL_DSCF6/A11 = GETTOK (AROLL_DSC6, 60, -1, '(', 11, AROLL_DSCF6);
AROLL_DSCL6/A11 = GETTOK (AROLL_DSCF6, 60, 1, ')', 11, AROLL_DSCF6);
-* DIVISION
AROLL_DSCA7/A60 = GETTOK (AROLL_DSC7, 60, 1, '(', 60, AROLL_DSCA7);
AROLL_DSCF7/A11 = GETTOK (AROLL_DSC7, 60, -1, '(', 11, AROLL_DSCF7);
AROLL_DSCL7/A11 = GETTOK (AROLL_DSCF7, 60, 1, ')', 11, AROLL_DSCF7);
-* COST CENTER
AROLL_DSCA8/A60 = GETTOK (AROLL_DSC8, 60, 1, '(', 60, AROLL_DSCA8);
AROLL_DSCF8/A11 = GETTOK (AROLL_DSC8, 60, -1, '(', 11, AROLL_DSCF8);
AROLL_DSCL8/A11 = GETTOK (AROLL_DSCF8, 60, 1, ')', 11, AROLL_DSCF8);
-* IF RECORDLIMIT EQ 100
ON TABLE HOLD AS HOLD1
END

DEFINE FILE HOLD1
-* LOB
AROLL_DSCZ/A130 = '('||AROLL_DSCA4||' - LOB';
AROLL_DSC4/A60 =
EDIT
(AROLL_DSCZ, '999999999999999999999999999999999999999999999999999999999999');
-* SUB LOB
AROLL_DSCY/A130 = '('||AROLL_DSCA5||' - sub LOB';
AROLL_DSC5/A60 =
EDIT
(AROLL_DSCY, '999999999999999999999999999999999999999999999999999999999999');
-* DEPARTMENT
AROLL_DSCX/A130 = '('||AROLL_DSCA6||' - Department';
AROLL_DSC6/A60 =
EDIT
(AROLL_DSCX, '999999999999999999999999999999999999999999999999999999999999');
-* DIVISION
AROLL_DSCW/A130 = '('||AROLL_DSCA7||' - Division';
AROLL_DSC7/A60 =
EDIT
(AROLL_DSCW, '999999999999999999999999999999999999999999999999999999999999');
-* COST CENTER
AROLL_DSCV/A130 = '('||AROLL_DSCA8||' - Cost Center';
AROLL_DSC8/A60 =
EDIT
(AROLL_DSCV, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD1
PRINT CAR_KEY AROLL_DSC4 AROLL_DSC5 AROLL_DSC6 AROLL_DSC7 AROLL_DSC8
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE CLMETX
FIXFORM FROM HOLD2
MATCH CAR_KEY
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_DSC5
ON MATCH UPDATE AROLL_DSC6
ON MATCH UPDATE AROLL_DSC7
ON MATCH UPDATE AROLL_DSC8
ON NOMATCH REJECT
DATA ON HOLD2
END
-RUN
-EXIT

-DRILLPROH

USE
F:\TNT\TTRACKER\DATA\HLMETX.FOC AS HLMETX
END
-RUN

TABLE FILE HLMETX
PRINT HTL_KEY AROLL_DSC4 AND COMPUTE
-* LOB
AROLL_DSCA4/A60 = GETTOK (AROLL_DSC4, 60, 1, '(', 60, AROLL_DSCA4);
AROLL_DSCF4/A11 = GETTOK (AROLL_DSC4, 60, -1, '(', 11, AROLL_DSCF4);
AROLL_DSCL4/A11 = GETTOK (AROLL_DSCF4, 60, 1, ')', 11, AROLL_DSCF4);
-* SUB-LOB
AROLL_DSCA5/A60 = GETTOK (AROLL_DSC5, 60, 1, '(', 60, AROLL_DSCA5);
AROLL_DSCF5/A11 = GETTOK (AROLL_DSC5, 60, -1, '(', 11, AROLL_DSCF5);
AROLL_DSCL5/A11 = GETTOK (AROLL_DSCF5, 60, 1, ')', 11, AROLL_DSCF5);
-* DEPARTMENT
AROLL_DSCA6/A60 = GETTOK (AROLL_DSC6, 60, 1, '(', 60, AROLL_DSCA6);
AROLL_DSCF6/A11 = GETTOK (AROLL_DSC6, 60, -1, '(', 11, AROLL_DSCF6);
AROLL_DSCL6/A11 = GETTOK (AROLL_DSCF6, 60, 1, ')', 11, AROLL_DSCF6);
-* DIVISION
AROLL_DSCA7/A60 = GETTOK (AROLL_DSC7, 60, 1, '(', 60, AROLL_DSCA7);
AROLL_DSCF7/A11 = GETTOK (AROLL_DSC7, 60, -1, '(', 11, AROLL_DSCF7);
AROLL_DSCL7/A11 = GETTOK (AROLL_DSCF7, 60, 1, ')', 11, AROLL_DSCF7);
-* COST CENTER
AROLL_DSCA8/A60 = GETTOK (AROLL_DSC8, 60, 1, '(', 60, AROLL_DSCA8);
AROLL_DSCF8/A11 = GETTOK (AROLL_DSC8, 60, -1, '(', 11, AROLL_DSCF8);
AROLL_DSCL8/A11 = GETTOK (AROLL_DSCF8, 60, 1, ')', 11, AROLL_DSCF8);
-* IF RECORDLIMIT EQ 100
ON TABLE HOLD AS HOLD1
END

DEFINE FILE HOLD1
-* LOB
AROLL_DSCZ/A130 = '('||AROLL_DSCA4||' - LOB';
AROLL_DSC4/A60 =
EDIT
(AROLL_DSCZ, '999999999999999999999999999999999999999999999999999999999999');
-* SUB LOB
AROLL_DSCY/A130 = '('||AROLL_DSCA5||' - sub LOB';
AROLL_DSC5/A60 =
EDIT
(AROLL_DSCY, '999999999999999999999999999999999999999999999999999999999999');
-* DEPARTMENT
AROLL_DSCX/A130 = '('||AROLL_DSCA6||' - Department';
AROLL_DSC6/A60 =
EDIT
(AROLL_DSCX, '999999999999999999999999999999999999999999999999999999999999');
-* DIVISION
AROLL_DSCW/A130 = '('||AROLL_DSCA7||' - Division';
AROLL_DSC7/A60 =
EDIT
(AROLL_DSCW, '999999999999999999999999999999999999999999999999999999999999');
-* COST CENTER
AROLL_DSCV/A130 = '('||AROLL_DSCA8||' - Cost Center';
AROLL_DSC8/A60 =
EDIT
(AROLL_DSCV, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD1
PRINT HTL_KEY AROLL_DSC4 AROLL_DSC5 AROLL_DSC6 AROLL_DSC7 AROLL_DSC8
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE HLMETX
FIXFORM FROM HOLD2
MATCH HTL_KEY
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_DSC5
ON MATCH UPDATE AROLL_DSC6
ON MATCH UPDATE AROLL_DSC7
ON MATCH UPDATE AROLL_DSC8
ON NOMATCH REJECT
DATA ON HOLD2
END
-RUN
-EXIT

-FIXISUMM

USE C:\TNT\TTRACKER\SUDATA\I_SUMM.FOC AS I_SUMM
END

-* COST CENTER
TABLE FILE I_SUMM
PRINT INST_KEY HDES1 AND COMPUTE
HDESX/A60 = GETTOK (HDES1, 60, 1, '(', 60, HDESX);
HDESX1/A11 = GETTOK (HDES1, 60, -1, '(', 11, HDESX1);
HDESX2/A11 = GETTOK (HDES2, 60, 1, ')', 11, HDESX2);
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS 'Cost Center)'
ON TABLE HOLD
END
-RUN

DEFINE FILE HOLD
HDESX3/A130 = '('||HDESX||' - Cost Center';
HDES1/A60 =
EDIT
(HDESX3, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY HDES1
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HDES1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* DIVISION
TABLE FILE I_SUMM
PRINT INST_KEY HDES1 AND COMPUTE
HDESX/A60 = GETTOK (HDES1, 60, 1, '(', 60, HDESX);
HDESX1/A11 = GETTOK (HDES1, 60, -1, '(', 11, HDESX1);
HDESX2/A11 = GETTOK (HDES2, 60, 1, ')', 11, HDESX2);
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS 'Division)'
ON TABLE HOLD
END
-RUN

DEFINE FILE HOLD
HDESX3/A130 = '('||HDESX||' - Division';
HDES1/A60 =
EDIT
(HDESX3, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY HDES1
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HDES1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* DEPARTMENT
TABLE FILE I_SUMM
PRINT INST_KEY HDES1 AND COMPUTE
HDESX/A60 = GETTOK (HDES1, 60, 1, '(', 60, HDESX);
HDESX1/A11 = GETTOK (HDES1, 60, -1, '(', 11, HDESX1);
HDESX2/A11 = GETTOK (HDES2, 60, 1, ')', 11, HDESX2);
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS 'Department)'
ON TABLE HOLD
END
-RUN

DEFINE FILE HOLD
HDESX3/A130 = '('||HDESX||' - Department';
HDES1/A60 =
EDIT
(HDESX3, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY HDES1
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HDES1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* SUBLOB
TABLE FILE I_SUMM
PRINT INST_KEY HDES1 AND COMPUTE
HDESX/A60 = GETTOK (HDES1, 60, 1, '(', 60, HDESX);
HDESX1/A11 = GETTOK (HDES1, 60, -1, '(', 11, HDESX1);
HDESX2/A11 = GETTOK (HDES2, 60, 1, ')', 11, HDESX2);
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS 'sub LOB)'
ON TABLE HOLD
END
-RUN

DEFINE FILE HOLD
HDESX3/A130 = '('||HDESX||' - sub LOB';
HDES1/A60 =
EDIT
(HDESX3, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY HDES1
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HDES1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* LOB

TABLE FILE I_SUMM
PRINT INST_KEY HDES1 AND COMPUTE
HDESX/A60 = GETTOK (HDES1, 60, 1, '(', 60, HDESX);
HDESX1/A11 = GETTOK (HDES1, 60, -1, '(', 11, HDESX1);
HDESX2/A11 = GETTOK (HDES2, 60, 1, ')', 11, HDESX2);
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS 'LOB)'
ON TABLE HOLD
END
-RUN

DEFINE FILE HOLD
HDESX3/A130 = '('||HDESX||' - LOB';
HDES1/A60 =
EDIT
(HDESX3, '999999999999999999999999999999999999999999999999999999999999');
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY HDES1
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HDES1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

sub LOB
Division
Department
Cost Center

-FIXISUMM2

USE
F:\TNT\TTRACKER\SUDATA\I_SUMM.FOC
END
-RUN

-* COST CENTER
DEFINE FILE I_SUMM
HSIF01/A65 = 'IF AROLL_LEV8 EQ '|''''||''''||HSEL1||''''||'''';
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSIF01 AND COMPUTE LEVEL/A2='08';
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS '- Cost Center'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HSIF01
ON MATCH UPDATE LEVEL
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* DIVISION
DEFINE FILE I_SUMM
HSIF01/A65 = 'IF AROLL_LEV7 EQ '|''''||''''||HSEL1||''''||'''';
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSIF01 AND COMPUTE LEVEL/A2='07';
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS '- Division'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HSIF01
ON MATCH UPDATE LEVEL
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* DEPARTMENT
DEFINE FILE I_SUMM
HSIF01/A65 = 'IF AROLL_LEV6 EQ '|''''||''''||HSEL1||''''||'''';
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSIF01 AND COMPUTE LEVEL/A2='06';
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS '- Department'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HSIF01
ON MATCH UPDATE LEVEL
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* SUBLOB
DEFINE FILE I_SUMM
HSIF01/A65 = 'IF AROLL_LEV5 EQ '|''''||''''||HSEL1||''''||'''';
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSIF01 AND COMPUTE LEVEL/A2='05';
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS '- sub LOB'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HSIF01
ON MATCH UPDATE LEVEL
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-* LOB
DEFINE FILE I_SUMM
HSIF01/A65 = 'IF AROLL_LEV4 EQ '|''''||''''||HSEL1||''''||'''';
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSIF01 AND COMPUTE LEVEL/A2='04';
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'METX-R'
IF HDES1 CONTAINS '- LOB'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH UPDATE HSIF01
ON MATCH UPDATE LEVEL
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

sub LOB
Division
Department
Cost Center

-CUCU77
TABLE FILE A_CUCU
PRINT AIR_KEY TKT_NUM 
BY AIR_KEY NOPRINT
ON TABLE HOLD
END
-RUN

TABLE FILE T_CUCU
PRINT AIR_KEY
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

MATCH FILE HOLD
PRINT AIR_KEY TKT_NUM 
BY AIR_KEY NOPRINT
RUN
FILE HOLD2
SUM
AIR_KEY
BY AIR_KEY NOPRINT
AFTER MATCH HOLD AS HOLD5 OLD-NOT-NEW
END
-RUN

TABLE FILE HOLD5
PRINT *
END
