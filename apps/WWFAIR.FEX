-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* This was created for the WWF Transaction detail
-*04/20/10   DEB                CHANGED ORIG_SALE DEFINE
-*4/26/2017-JEM-S-33318-updated logic for no records report



-INCLUDE SETECHO

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT    
FARE_PAID/D12.2CS= SEG_AMT + SEG_TAX;
LEVEL_DESC/A60 = &&LDESC;
TKT_CNT/D8CS = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT 
  EQ 1) THEN 1 ELSE 0;
BKD_ONLINE/A1 = IF DOD_TYPE EQ 'H' OR 'I' OR 'J' THEN 'Y' ELSE 'N';

XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
XTRAN_DT/MDYY        = TRN_DATE;   
-* DEFINES ON PREVIOUS DEFINES
-*ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT 
-* EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE IF (DOC_TYPE EQ '1') AND
-* (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') THEN 1 ELSE 0;


ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND 
     (SEG_COUNT EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE 
     IF (DOC_TYPE EQ '1') AND (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') AND
     (RF_FLAG EQ ' ') THEN 1 ELSE 0;	
-* PAX/A5 = EDIT(XPSNGR_NM, '99999$$$$$$$$$$');
EXCHGS/D9 = IF (EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK 
  NE 'DT1' OR 'RF1' OR 'FP3') THEN TKT_CNT ELSE
  IF (DOC_TYPE EQ '1') AND (EXCHG_SALE EQ 'E') THEN 0 ELSE
  IF (SEG_COUNT GE 0) AND (EXCHG_SALE NE ' ') THEN TKT_CNT ELSE 0;
EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') THEN 1 ELSE 0; 
PAX/A5 = EDIT(XPSNGR_NM, '99999$$$$$$$$$$');

LOC_CD/A2 = '01';
GL_CODE/A4 = '5315';
DEPT_CD/A3 = EDIT(LEVEL1, '999$$$$$$$$$$$$');
PROJ_CD/A8 = EDIT(LEVEL1, '$$$99999999$$$$');
FUND_SRC/A4 = EDIT(LEVEL1, '$$$$$$$$$$$9999');
AGR_CD/A4 = '0000';
FEE/P5.2S = IF BKD_ONLINE EQ 'N' THEN 38 ELSE 12;
LINE_DESC/A38 = XPSNGR_NM||TKT_NUM||PNR_LOCATOR|' '|'A';          
XDPT_DT/MDYY=DPT_DATE;
END

TABLEF FILE &&EXTRACT
PRINT BKD_ONLINE
      AGR_CD
      C_ITIN
      FEE
      LOC_CD
      GL_CODE
      DEPT_CD
      PROJ_CD
      FUND_SRC
      LEVEL2
      LINE_DESC
      PAX
      PNR_LOCATOR
      TRN_DATE
      TKT_NUM
      VAL_AIRLINE
      XDPT_DT
      XPSNGR_NM
      XTRAN_DT
      
-INCLUDE &AIRDATES

WHERE ORIG_SALE NE 0 OR EXMCOS NE 0 OR EXCHGS NE 0
-* WHERE ORIG_SALE NE 0 OR EXCHGS NE 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


-SET &&AFLG = IF &LINES EQ 0 THEN 'N' ELSE 'Y';
-IF &LINES EQ 0 THEN GOTO NOAREC;

TABLE FILE &&RPT_HOLD
SUM PNR_LOCATOR 
BY PNR_LOCATOR NOPRINT
WHERE BKD_ONLINE EQ 'Y'
ON TABLE HOLD AS WAIRHLD
END
-RUN

DEFINE FILE WAIRHLD
PNR_LOC/A8 = '''' |PNR_LOCATOR|'''';
END
TABLE FILE WAIRHLD
PRINT PNR_LOC
ON TABLE SAVE AS AIRHLD2
END
-RUN




DEFINE FILE &&RPT_HOLD
FLAG/A1 = 'A';
END
TABLE FILE &&RPT_HOLD
PRINT AGR_CD
      C_ITIN
      FEE
      LOC_CD
      GL_CODE
      DEPT_CD
      PROJ_CD
      FUND_SRC
      LEVEL2
      LINE_DESC
      PAX
      PNR_LOCATOR
      TKT_NUM
      VAL_AIRLINE
      XDPT_DT
      XPSNGR_NM
      XTRAN_DT
BY FLAG
ON TABLE HOLD AS WWFA FORMAT FOCUS
END
-RUN

-NOAREC
-SET &&AIRREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
