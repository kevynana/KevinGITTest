-* 7/8/15-JEK-STORY ID-S-10107-Added logic for new request to add RBT- udid to report
-* 2/4/16-JEM S-15215 - Added logic for new request to add GN- udid to EJUDOT
-*03/13/17 - DLV - S-22486 - updated ettek Review to Post-trip Reporting
-*06/21/17 - DLV - S-34926 - Carried through FLAG added routine for NYINTER
-* 08/14/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = #;

-INCLUDE SETECHO

SET ASNAMES = ON 

-INCLUDE RETUDID
-RUN

-IF &&CURRENCY EQ 'USD' THEN GOTO NEXT;

-INTER;
-SET &&SUBHEAD = <NAMEC;
-SET &TATP_CUR = 'TRADITIONAL,AVERAGE,TICKET, (' | &&CURRENCY || ')';
-SET &OATP_CUR= 'ONLINE,AVERAGE,TICKET, (' | &&CURRENCY || ')';
-SET &&S_SUBJ11='COMPUTE AAVGTKT/D16.2CS = IF ((ABOOK_CNT LT 1) AND';
-SET &&S_SUBJ12='(ABOOK_CNT GT (-1))) THEN 0 ELSE (FARE_ABOOKX/ABOOK_CNT);';
-SET &&S_SUBJ13='AS ' | '''&TATP_CUR.EVAL''';
-SET &&S_SUBJ14='COMPUTE IAVGTKT/D16.2CS = IF ((IBOOK_CNT LT 1) AND';
-SET &&S_SUBJ15='(IBOOK_CNT GT (-1))) THEN 0 ELSE (FARE_IBOOKX/IBOOK_CNT);';
-SET &&S_SUBJ16='AS ' | '''&OATP_CUR.EVAL''';

-NEXT


TABLE FILE &&RPT_HOLD
SUM BASE_FARE AS 'TBASE'
    FARE_PAID/D14.2CS AS 'TFARE'
    PAID_FAREX/D16.2CS AS 'GTFARE'
    NET_TKT_CNT AS 'TTKT'
    NEW_SEG_MILES AS 'TMILE'
    SEG_LOWEST AS 'TLOW'
    DISSAVINGS AS 'DTSAVE'
    ABOOK_DSAVE AS 'TADSAV'
    IBOOK_DSAVE AS 'TIDSAV'
    DSAV_ABOOKX/D16.2CS AS 'GTADSAV'
    DSAV_IBOOKX/D16.2CS AS 'GTIDSAV'  
BY LEVEL_DESC
ON TABLE HOLD AS AIRHOLD1
END
-RUN


TABLE FILE &&RPT_HOLD
PRINT AIR_KEY
  ABOOK_CNT
  ABOOK_FARE
  ABOOK_DSAVE
  AIBOOK_CNT
  AIR_KEY	
  AIRLINE	
  ARR_TIME
  DISSAVINGS
  DPT_TIME	
  EMB_CTY_NM
  FARE_PAID
  FARE_IBOOKX/D16.2CS
  FARE_ABOOKX/D16.2CS
  FARE_IEBOOKX/D16.2CS	
  FLAG
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IEBOOK_CNT
  IEBOOK_FARE
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3
  NAMEC	
  NET_TKT_CNT
  PAID_FAREX/D16.2CS	
  RTE_CTY_NM
  SEG_COUNT
  SEG_LOWEST	
  SEG_NBR	
  SIBOOK_CNT
  TKT_NUM	
  TKT_SORT	
  TKT_TYPE	
  TRAN_MY
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
ON TABLE HOLD AS HOLDTWO
END
-RUN

MATCH FILE HOLDTWO
PRINT AIR_KEY
  ABOOK_CNT
  ABOOK_FARE
  ABOOK_DSAVE
  AIBOOK_CNT
  AIR_KEY	
  AIRLINE	
  ARR_TIME
  DISSAVINGS
  DPT_TIME	
  EMB_CTY_NM
  FARE_PAID
  FARE_IBOOKX
  FARE_ABOOKX
  FARE_IEBOOKX
  FLAG
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IEBOOK_CNT
  IEBOOK_FARE
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3
  NAMEC	
  NET_TKT_CNT
  PAID_FAREX	
  RTE_CTY_NM
  SEG_COUNT
  SEG_LOWEST	
  SEG_NBR	
  SIBOOK_CNT
  TKT_NUM	
  TKT_SORT	
  TKT_TYPE	
  TRAN_MY
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE AIRHOLD1
SUM TFARE
    TTKT
BY LEVEL_DESC    
AFTER MATCH HOLD AS XTWO OLD-OR-NEW
END
-RUN



-IF '&&SETF.EVAL' EQ 'TUUDOT'  THEN GOTO TEMPU;
-IF '&&SETF.EVAL' EQ 'PBUDOT' THEN GOTO PUBLIC;
-IF '&&SETF.EVAL' EQ 'NYINTER' THEN GOTO NYL;

-Continue

  
TABLE FILE XTWO
PRINT
  ABOOK_CNT
  ABOOK_FARE
  ABOOK_DSAVE
  AIBOOK_CNT
  AIR_KEY	
  AIRLINE	
  ARR_TIME
  DPT_TIME	
  EMB_CTY_NM
  FARE_PAID
  FARE_IBOOKX 
  FARE_ABOOKX
  FARE_IEBOOKX
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IEBOOK_CNT
  IEBOOK_FARE
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3
  NAMEC	
  NET_TKT_CNT
  PAID_FAREX	
  RTE_CTY_NM
  SEG_COUNT
  SEG_LOWEST	
  SEG_NBR	
  SIBOOK_CNT
  TKT_NUM	
  TKT_SORT	
  TKT_TYPE	
  TRAN_MY
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT	
  TFARE
  TTKT
  
BY LEVEL_DESC
ON TABLE HOLD AS XTHREE
END
-RUN

-GOTO SkipThis


-TEMPU

EX UDTEMPUSM
-RUN
-GOTO SkipThis;

-PUBLIC;
EX UDPBRBT
-RUN

-GOTO SkipThis;

-NYL
EX UDNYLRBT
-RUN


-*-IF '&&SETF.EVAL' NE 'NYUDOT' THEN GOTO SkipThis;

-*-SET &&BREAKOPTION = 'ON TRAN_MY RECOMPUTE MULTILINES AS ''TOTAL FOR'' ' ;


-SkipThis

DEFINE FILE XTHREE
PCTTKT/D8.1S=IF ((TTKT LT 1) AND (TTKT GT (-1))) THEN 0 ELSE ((NET_TKT_CNT/TTKT)*100);
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
-IF '&&SETF.EVAL' NE 'NYINTER' THEN GOTO NotThis;
TCPCTONLX/D9.2 = IF LEVEL_DESC NE LAST LEVEL_DESC THEN TCPCTONL ELSE 0;
-NotThis;
END
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
   
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

-IF '&&SETF.EVAL' EQ 'NYINTER' THEN GOTO NOfoot;

-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
"EXCLUDES WEB BOOKINGS AND EXCH FROM ONLINE BKGS "
-*******
-NOfoot
-******* 
-INCLUDE FOOTERSM 
-*
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-*-*-EXIT




