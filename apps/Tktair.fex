-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* File TKTAIR.FEX
-********************************************************************

-********************************************************************
-*
-* This program extracts data for the series of basic ticket listing
-* reports.  Based on the user profile selected, one of many report
-* formats will be produced.  
-* 5/18/04 - DEB - ADDED AIRLINE_FEE COLUMN PER MONICA COLLIGAN
-* 10/08/04 - DV - ADDED LEVEL1 LEVEL2 LEVEL3
-* 12/15/04 - DV - ADDED FILEDEF CODE FOR FUJI REPORT
-* 01/04/05 - DV - ADDED CODE FOR GLOBAL CURRENCY 
-* 10/01/05 - DV - ADDED GEO_ZONE
-* 3/17/11  - DV - ADDED LIMO DATA TO REPORT COMMENTED OUT 
-*                 WHERE5 WHERE6 SO THEY COULD BE USED FOR LIMO
-* 2/7/13 - DV  -  ADDED AR_BRANCH AND VAL_AIR
-* 12/31/13 - DV - CORRECTED CCNUM2 DEFINE
-* 1/3/14 - DV     ADDED CLASS_CAT DEFINE
-* 1/7/14 - JK - ADDED CCARD7 DEFINE
-*1/31/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*4/4/14 - DV - CARRIED THROUGH C_ITIN DST_APC FDATE TKTN FOR TENAS ROUTINE
-*6/30/14 - JK - Added defines to select specific NEBOOK credit card
-*7/17/14 - DEB - Added routine for LOACHCN
-* ADDED TRANTYPE INCLUDE - JK 12/30/14 STORY ID S-06492
-* 1/22/15 - DEB - S-07118 ADDED LEVEL5 LEVEL6 FOR LOWES-R LWACHTT
-*2/25/15 - DEB - S-07611 CHANGED PGACHDCC TO INCLUDE VOIDS
-*3/26/15 - DEB - S-07912 CORRECTED ISSUE WITH LAST HOLD FILE ERRING OUT DUE TO VOID_DATE
-*12/29/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*3/2/16 - JEM -S-16367 Updated hard coded d:\ to use &&WFSRV1.EVAL
-*7/21/16 S-20630 DLV  Added EMP_ID to extract
-*4/26/2017-JEM-S-33318-updated logic for no records report


-********************************************************************
-INCLUDE SETECHO
 

SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &&IDLEVELBREAK = '';


FI FUTKTLST DISK &&WFSRV1.EVAL\TNT\TTRACKER\TEMP\FUTKTLST.TXT

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';
-SET &WHATDATE = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'TRN_DATE' ELSE 'FST_DPT_DATE';

-INCLUDE IDLEVROLLDEF
-RUN

DEFINE FILE &&EXTRACT
  AIRLN/A30 = AIRLINE_NAME;
  CCA_CARD/A7 = EDIT(CREDIT_CARD, '99$$$$$$$$$$99999');
  CHG_COD/A47 = IF LEVEL3 NE ' ' AND LEVEL2 NE ' ' THEN
                    LEVEL1  || '-' || LEVEL2 || '-' ||LEVEL3 ELSE
                    IF LEVEL3 EQ ' ' AND LEVEL2 NE ' ' THEN
                    LEVEL1  || '-' || LEVEL2 ELSE
                    IF LEVEL3 EQ ' ' AND LEVEL2 EQ ' ' THEN LEVEL1;
  CC/A2 = EDIT(CREDIT_CARD, '99$$$$$$$$$$$$$$$$');
  CCARD7/A4 = EDIT(CREDIT_CARD, '$$$$$$$$$$$$$$9999');

-* CCNUM2/A4 = IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$$9999$')
-*             ELSE EDIT(CREDIT_CARD, '$$$$$$$$$$$$$$9999');
             

-* CCNUM2/A4 = CCNUM2/A4 = IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$9999')
-*              ELSE EDIT(CREDIT_CARD, '$$$$$$$$$$$$$$9999');
             
-*  CCNUM2A/A4 = CCNUM2/A4 = IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$9999')
-*              ELSE EDIT(CREDIT_CARD, '$$$$$$$$$$$$$99999');                 
              
              


  CCNUM2/A4 = IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$9999')
              ELSE EDIT(CREDIT_CARD,'$$$$$$$$$$$$$$9999');
             
  CCNUM2A/A4 =  IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$9999')
              ELSE EDIT(CREDIT_CARD,'$$$$$$$$$$$$$$9999');                  
             
  CLASS_CAT/A15 = DECODE CL_CAT ('F' 'FIRST'     'P' 'PREMIUM ECONOMY'   
   			        'D' 'DEFAULT'   'B' 'BUSINESS'
   			        'E' 'ECONOMY'   'U'  'UPGRADE' 
                                ' ' 'DEFAULT');       
 CTY1/A25 = CITYPAIR.EMBARK;
  CTY2/A25 = CITYPAIR.ROUTE;
  FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
  LEVEL_DESC1/A80 = &&LDESC;
  OTFLAG/A15 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE 'TRADITIONAL';
  NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  NEW_ADV_PURCH/D9CS    = ADV_PURCH;
  NEW_SEG_DISC/D12.2CS = SEG_DISCOUNT;
  NEW_SEG_MILES/D9= SEG_MILES;

                         
  TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                          (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
  XDPT_DT/MDYY         = DPT_DATE;
  XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  XTRAN_DT/MDYY        = TRN_DATE;

-***DEFINES ON PREVIOUS DEFINES
  AIRLINE_FEE/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' 
  THEN FARE_PAID ELSE 0;
WRCC4/A1 = IF CREDIT_CARD CONTAINS 'CA5405107001603300' OR 
               'CA5405107003656207' OR 'CA5405107003656199' OR
               'CA5405107003656181' THEN 'Y' ELSE 'N'; 
  DISSAVINGS/D11.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;               
  VASAVINGS/D12.2CS    = NEW_SEG_DISC - FARE_PAID;
FDATE/MDYY = FST_DPT_DATE;  
-* PGCC_FLAG/A1 = IF CCNUM2 EQ '2356' OR '2349' OR '7827' THEN 'Y' ELSE
-*                IF CCNUM2A EQ '02349' OR '02356' OR '60754' OR '48576' OR '41785' THEN 'Y' ELSE 'N';
PGCC_FLAG/A1 = IF CCNUM2 EQ '2356' OR '2349' OR '7827' THEN 'Y' ELSE
               IF CCNUM2 EQ '2349' OR '2356' OR '0754' OR '8576' OR '1785' THEN 'Y' ELSE 'N';
TKTN/A10 = IF DOC_TYPE EQ '9' THEN AUX_TKTLS_NUM ELSE TKT_NUM;
NEBC1/A6 = EDIT(CREDIT_CARD, '999999');
NEBC2/A4 = EDIT(CREDIT_CARD, '$$$$$$$$$$$$$$9999');
NEBCC/A10 = NEBC1||NEBC2;
FLAG/A1 = IF VOID_DATE NE 0 THEN 'V' ELSE 'A';
-INCLUDE TRANTYPE
-INCLUDE IDLEVDEFINE 

END

-IF &&SETF EQ 'TNACHD' THEN GOTO TENAS;

TABLEF FILE &&EXTRACT
PRINT  
  AIRCRAFT_TYPE AS 'AIRT'
  AIRLN  
  AIRLINE_FEE  
  AIRCRAFT_TYPE
  AR_BRANCH
  BR_CL_IDX
  C_ITIN
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CLASS
  CLASS_CAT
  CONJ_REL
  CREDIT_CARD
  DISSAVINGS
  DST_APC
  EMB_CTY.CITY_NAME AS 'CITY1' 
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 
  LEVEL4
  LEVEL5
  LEVEL6
  NET_TKT_CNT 
  NEW_ADV_PURCH
  NEW_SEG_MILES
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  RF_FLAG
  RTE_CTY.CITY_NAME AS 'CITY2'
  SEG_COUNT
  SEG_NBR
  SEG_LOWEST
  TICKET_CODE
  TKT_DATE
  TKT_NUM
  TKTN
  TKT_SORT
  TKT_TYPE
  VASAVINGS
  &WHATDATE
  TRIP_PURPOSE
  XDPT_DT   
  XTRAN_DT   
  XPSNGR_NM
  EMB_APT.GEO_ZONE AS 'GEO_ZONE'
  VAL_AIRLINE AS 'VAL_AIR'
-INCLUDE BYHIERARCHY
-INCLUDE &AIRDATES
-IF '&&SETF.EVAL' EQ 'PGACHDCC' THEN GOTO InclVoids;
WHERE VOID_DATE EQ 0
-InclVoids;
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
-*&&WHERE5
-*&&WHERE6
-* &&WHERE7
-* &&WHERE8
-* &&WHERE9
-* &&WHERE10
-IF '&&SETF.EVAL' NE 'FUPXACH' GOTO :NOSTP;
-INCLUDE FUPXFILE

-:NOSTP;
-INCLUDE RPTPARMS
ON TABLE HOLD AS AIRHOLD
END
-RUN

-Kohls;
-IF &&SETF.EVAL EQ 'KOACH' GOTO XXIT;
 
 
-IF '&&SETF.EVAL' NE 'LOACHCN' THEN GOTO SkipThis;

TABLE FILE AIRHOLD
SUM PNR_LOCATOR
BY PNR_LOCATOR NOPRINT
ON TABLE HOLD AS LOWESHOLD
END
-RUN

DEFINE FILE LOWESHOLD
PNR/A10 = ''''||PNR_LOCATOR||'''';
END
TABLE FILE LOWESHOLD
SUM PNR
BY PNR NOPRINT
ON TABLE SAVE AS LOAIRCN
END
-RUN

 



-SkipThis


-GOTO Continue;

-TENAS

TABLEF FILE &&EXTRACT
PRINT 
  AIRLN  
  AIRCRAFT_TYPE AS 'AIRT'
  AIRLINE_FEE 
  AR_BRANCH
  BR_CL_IDX
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  C_ITIN
  CLASS
  CLASS_CAT
  CONJ_REL
  CTY1 AS 'CITY1'
  DISSAVINGS
  DST_APC
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 
  LEVEL4
  LEVEL5
  LEVEL6
  NET_TKT_CNT 
  NEW_ADV_PURCH
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  RF_FLAG
  CTY2 AS 'CITY2'
  SEG_COUNT
  SEG_NBR
  SEG_LOWEST
  TICKET_CODE
  TKT_DATE
  TKT_NUM
  TKTN
  TKT_SORT
  TKT_TYPE 
  TRIP_PURPOSE
  VASAVINGS
  &WHATDATE
  XDPT_DT   
  XTRAN_DT   
  XPSNGR_NM
  VAL_AIRLINE AS 'VAL_AIR'
  EMB_APT.GEO_ZONE AS 'GEO_ZONE'

-INCLUDE BYHIERARCHY
-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
-* &&WHERE7
-* &&WHERE8
-* &&WHERE9
-* &&WHERE10


-INCLUDE RPTPARMS
ON TABLE HOLD AS AIRHOLD
END
-RUN
 

-Continue;



TABLE FILE AIRHOLD
PRINT AIRLN  
  AIRLINE_FEE
  AIRT
  AR_BRANCH
  BR_CL_IDX
  C_ITIN
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CLASS
  CLASS_CAT
  CONJ_REL  
  CITY1  
  DISSAVINGS
  DST_APC
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  GEO_ZONE
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 
  LEVEL4
  LEVEL5
  LEVEL6
  NET_TKT_CNT 
  NEW_ADV_PURCH
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  RF_FLAG
  CITY2
  SEG_COUNT
  SEG_NBR
  SEG_LOWEST
  TICKET_CODE
  TKT_NUM
  TKTN
  TKT_SORT
  TKT_TYPE 
  VASAVINGS
  &WHATDATE
  TRIP_PURPOSE
  XDPT_DT  
  XTRAN_DT  
  XPSNGR_NM
  VAL_AIR
-INCLUDE BYHIERARCHY      
BY TKT_DATE 
ON TABLE HOLD AS AIRHOLD1 FORMAT FOCUS INDEX TKT_DATE
END
-RUN


-* Global Reporting JOIN
JOIN AIRHOLD1.TKT_DATE IN AIRHOLD1 TO GLOBAL.DATE IN GLOBAL AS J1
END

DEFINE FILE AIRHOLD1
NAMEC/A30 = CNAME;

-******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;

-* DEFINES ON PREVIOUS DEFINES	
PAID_FAREX/D20.6 = FARE_PAID * CURR1X;
FEEX/D20.6 = AIRLINE_FEE * CURR1X;
END
 
TABLE FILE AIRHOLD1
PRINT AIRLN AS 'NAME'
  AIRLINE_FEE AS 'FEE'
  AIRT
  AR_BRANCH
  BR_CL_IDX
  C_ITIN
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CLASS
  CLASS_CAT
  CONJ_REL
  CITY1
  DISSAVINGS
  DST_APC
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  GEO_ZONE
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 
  LEVEL4
  LEVEL5
  LEVEL6
  NET_TKT_CNT 
  NEW_ADV_PURCH
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  RF_FLAG
  CITY2
  SEG_COUNT
  SEG_NBR
  SEG_LOWEST
  TICKET_CODE
  TKT_DATE
  TKT_NUM
  TKTN
  TKT_SORT
  TKT_TYPE AS 'TYPE'
  VASAVINGS
  &WHATDATE
  TRIP_PURPOSE
  XDPT_DT AS 'DATE'
  XTRAN_DT AS 'TRAN_DATE'
  XPSNGR_NM
  NAMEC
  PAID_FAREX
  FEEX
  VAL_AIR AS 'NAME2'
-INCLUDE BYHIERARCHY      
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS AIRHOLD2
END
-RUN


TABLE FILE AIRHOLD2

SUM FARE_PAID AS 'AMOUNT'
    PAID_FAREX/D16.2CS AS 'GAMOUNT'
    NET_TKT_CNT/D12 AS 'TTL_COUNT'
    DISSAVINGS AS 'LOST_AMT'
    SEG_LOWEST/D12.2CS AS 'LOW_AMT'
    VASAVINGS AS 'VASAV'
-INCLUDE BYHIERARCHY  
BY LEVEL_DESC 
BY PASSNGR_NAME
BY TKT_SORT
BY &WHATDATE
ON TABLE HOLD AS HOLD3
END
-RUN

TABLE FILE AIRHOLD2
PRINT AIRT
  AR_BRANCH
  BR_CL_IDX
  C_ITIN
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CITY1
  CITY2
  CLASS
  CLASS_CAT
  CONJ_REL
  DATE
  DST_APC
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  FEE
  FEEX/D16.2CS
  GEO_ZONE
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  NAME
  NET_TKT_CNT
  NEW_ADV_PURCH
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  REFUSE_CODE
  SEG_COUNT
  TICKET_CODE
  TKT_NUM
  TKTN
  TRAN_DATE  
  TRIP_PURPOSE
  TYPE
   NAMEC
  PAID_FAREX/D16.2CS  
  NAME2
-INCLUDE BYHIERARCHY  
BY LEVEL_DESC 
BY PASSNGR_NAME NOPRINT
BY TKT_SORT  
BY &WHATDATE
BY SEG_NBR   
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIRT
  AR_BRANCH
  BR_CL_IDX
  C_ITIN
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CITY1
  CITY2
  CLASS
  CLASS_CAT
  CONJ_REL
  DATE
  DST_APC
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  FEE
  FEEX
  GEO_ZONE
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  NAME
  NET_TKT_CNT
  NEW_ADV_PURCH
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  REFUSE_CODE
  SEG_COUNT
  TICKET_CODE
  TKT_NUM
  TKTN
  TRAN_DATE  
  TRIP_PURPOSE
  TYPE
  NAMEC
  PAID_FAREX  
  NAME2
-INCLUDE BYHIERARCHY   
BY LEVEL_DESC 
BY PASSNGR_NAME NOPRINT
BY TKT_SORT   
BY &WHATDATE
BY SEG_NBR   
ON TABLE HOLD
RUN
FILE HOLD3
PRINT
  AMOUNT
  GAMOUNT
  LOST_AMT
  TTL_COUNT
  LOW_AMT
  VASAV
-INCLUDE BYHIERARCHY    
BY LEVEL_DESC 
BY PASSNGR_NAME   
BY TKT_SORT  
BY &WHATDATE  
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN


DEFINE FILE XTHREE
 REC_CNT/D8CS = IF NET_TKT_CNT EQ 1 THEN 1 ELSE 0;
  TTLDAYS/D8 = NEW_ADV_PURCH*REC_CNT;
  
END                    
TABLE FILE XTHREE
SUM NET_TKT_CNT AS 'PTTKT'
REC_CNT
TTLDAYS
COMPUTE PADV1/P8 = IF ((REC_CNT LT 1) AND (REC_CNT GT (-1))) THEN 0 ELSE 
            (TTLDAYS/REC_CNT); 
-INCLUDE BYHIERARCHY      
BY LEVEL_DESC 
BY PASSNGR_NAME
BY TKT_NUM
BY TKTN
ON TABLE HOLD AS PHOLDONE
END
-RUN

 



MATCH FILE XTHREE
PRINT AIRT
  AR_BRANCH
  BR_CL_IDX
  C_ITIN
  AMOUNT
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CITY1
  CITY2
  CLASS
  CLASS_CAT
  CONJ_REL
  DATE
  DST_APC
  EMP_ID
  EX_FLAG
  FARE_PAID
  FDATE
  FLAG
  FEE
  FEEX
  GEO_ZONE
  INVOICE_NUM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LOST_AMT
  LOW_AMT
  NAME
  NEW_ADV_PURCH
  NET_TKT_CNT
  OTFLAG
  PNR_LOCATOR
  REFUSE_CODE
  RF_FLAG
  SEG_COUNT
  SEG_NBR
  TICKET_CODE
  TTL_COUNT
  TKT_SORT
  TRAN_DATE  
  TRIP_PURPOSE
  TYPE
  VASAV
  GAMOUNT
  NAMEC
  PAID_FAREX 
  NAME2
-INCLUDE BYHIERARCHY      
BY LEVEL_DESC  
BY PASSNGR_NAME  
BY TKT_NUM 
BY TKTN
ON TABLE HOLD  
RUN
FILE PHOLDONE
SUM PADV1
-INCLUDE BYHIERARCHY     
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
BY TKTN
AFTER MATCH HOLD AS AIRHOLD3 OLD-OR-NEW
END
-RUN



DEFINE FILE AIRHOLD3
-IF '&&SETF.EVAL' NE 'PGACHDCC' GOTO NextFlag;
FLAG/A1 = IF VOID_DATE NE 0 THEN 'V' ELSE 'A';
-GOTO ContDefine
-NextFlag
FLAG/A1 = 'A';
-ContDefine
SEG/A2 = SEG_NBR;
TSORT/A11 = TKT_SORT;
PADV/P9S = IF TKT_NUM NE LAST TKT_NUM THEN PADV1 ELSE 0;
RESV_STATUS/A2 = ' ';
END
TABLE FILE AIRHOLD3
PRINT 
  PASSNGR_NAME
  PNR_LOCATOR
  TRAN_DATE
  TKT_NUM
  TKTN
  TSORT
  TYPE
  SEG
  NAME
  DATE
  AIRT
  CITY1
  CITY2
  EMP_ID
  FARE_PAID AS 'AMOUNT'
  FDATE
  GAMOUNT
  FEE
  FEEX
  TTL_COUNT
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LOST_AMT
  LOW_AMT
  NAMEC
  GEO_ZONE
  TRIP_PURPOSE
  CHG_COD
  PADV 
  OTFLAG
  CCA_CARD
  CC_NUM
  REFUSE_CODE
  VASAV
  CLASS
  CLASS_CAT
  CCNUM2
  C_ITIN
  DST_APC
  AR_BRANCH
  BR_CL_IDX
  INVOICE_NUM
  NAME2
  NEW_ADV_PURCH
  RESV_STATUS
BY FLAG 
-INCLUDE BYHIERARCHY     
ON TABLE HOLD AS HOLDA FORMAT FOCUS
END
-RUN

-SET &&AIRREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';



-XXIT;

