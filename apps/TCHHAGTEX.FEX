-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT

-INCLUDE SETECHO
SET ASNAMES = ON

-TYPE '&&ROLL.EVAL'

-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED
-*========================================================================
-SET &&EXTRACT = 'HR_50';

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

DEFINE FILE &&EXTRACT
NBR_DAYS/P12 =  NUM_DAYS;
NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                 ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
                 
NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;                 
                 
                 
HBOOK1/P8 = IF NEW_TOTAL_AMT GE 0 THEN 1 ELSE (-1); 
HBOOK/P8 = IF TKT_NUM EQ '0000000000' THEN HBOOK1 ELSE 0;
NNROOMS1/P12C = IF TKT_NUM NE '0000000000' THEN NNROOMS ELSE 0; 
NNROOMS2/P12C = IF TKT_NUM EQ '0000000000' THEN NNROOMS ELSE 0;


END

TABLEF FILE &&EXTRACT
PRINT NNROOMS1 HBOOK
 NNROOMS2
 AGENT_NUM
 TKT_NUM
-INCLUDE &HTLDATES
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCHHH1
END
-RUN


-IF &LINES EQ 0 THEN GOTO NEXTONE;

-IF '&&SETF.EVAL' EQ 'TCNHD' GOTO TCNHD;
-*========================================================================
-*   PROCESS EXTRACTED DATA FROM ABOVE
-*========================================================================
DEFINE FILE TCHHH1
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCHHH1
SUM NNROOMS1 NNROOMS2 HBOOK
BY ROLLCD
BY TKT_NUM
BY AGENT_NUM
ON TABLE HOLD AS TCHHH2
END
-RUN

TABLE FILE TCHHH2
SUM NNROOMS1 NNROOMS2 HBOOK
BY ROLLCD
BY TKT_NUM
BY AGENT_NUM
ON TABLE HOLD AS TCHHH3
END
-RUN



MODIFY FILE TC_NHH
LOG DUPL MSG OFF
FIXFORM FROM TCHHH3
MATCH ROLLCD TKT_NUM AGENT_NUM 
ON NOMATCH INCLUDE
ON MATCH UPDATE NNROOMS1 NNROOMS2 HBOOK
DATA ON TCHHH3
END
-RUN
-GOTO NEXTONE

-TCNHD
DEFINE FILE TCHHH1
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCHHH1
SUM NNROOMS1
BY ROLLCD
ON TABLE HOLD AS TCNH2
END
-RUN

TABLE FILE TCNH2
SUM NNROOMS1 
BY ROLLCD
ON TABLE HOLD AS TCNH3
END
-RUN

MODIFY FILE TC_NHD1
LOG NOMATCH MSG OFF
FIXFORM FROM TCNH3
MATCH ROLLCD 
ON NOMATCH INCLUDE
ON MATCH UPDATE NNROOMS1 
DATA ON TCNH3
END
-RUN





-NEXTONE
