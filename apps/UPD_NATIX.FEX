
SET ASNAMES = ON

FILEDEF NATIX_LVL DISK D:\AS400\NATIX_LVL.TXT



TABLE FILE NATIX_LVL
PRINT ROLLUP_CODE LOWEST_VAL LEVEL1 LEVEL2 LEVEL3 LEVEL4 LEVEL5 LEVEL6
BY ROLLUP_CODE NOPRINT
BY LOWEST_VAL NOPRINT  
ON TABLE HOLD
END
-RUN

 
 
TABLE FILE HOLD
PRINT LOWEST_VAL LEVEL1 AS 'NEW1' LEVEL2 AS 'NEW2' LEVEL3 AS 'NEW3' LEVEL4 AS 'NEW4' LEVEL5 AS 'NEW5' LEVEL6 AS 'NEW6'
BY LOWEST_VAL NOPRINT
ON TABLE HOLD AS NATIXFIX FORMAT FOCUS INDEX LOWEST_VAL
END
-RUN
 

 
-* AIR


DEFINE FILE A_NATIX
DASH_CNT/I2 = POSIT(ICODEX, 36, '-', 1, 'I2');
N_ICODE/A31 = EDIT(ICODEX, '$$$$$99999999999999999999999999999');
DASH_CNT2/I2 = POSIT(N_ICODE, 31, '-', 1, 'I2');

XL01/A15 = GETTOK (ICODEX, 36, -1, '-', 15, XL01);
NW_LVL3/A15 = IF DASH_CNT2 NE 0 THEN XL01 ELSE ' ';
LV1/A9 = EDIT(LEVEL1, '999999999');
LV1_1/A5 = EDIT(XL01, '99999');
NW_LVL1/A15 = IF NW_LVL3 EQ ' ' THEN LEVEL1 ELSE
              LV1 || '-' || LV1_1;
END
TABLE FILE A_NATIX
PRINT  NW_LVL1 AS 'LEVEL1' LEVEL3 AS 'LEVEL2' NW_LVL3 AS 'LEVEL3'  
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD
END
-RUN




TABLE FILE A_NATIX
PRINT AIR_KEY
BY AIR_KEY NOPRINT
ON TABLE HOLD
END

MODIFY FILE A_NATIX
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE LEVEL1='               ';
ON MATCH COMPUTE LEVEL2='               ';
ON MATCH COMPUTE LEVEL3='               ';
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE A_NATIX
FIXFORM FROM AIRHOLD
MATCH AIR_KEY
ON MATCH UPDATE LEVEL1 LEVEL2 LEVEL3
ON NOMATCH REJECT
DATA ON AIRHOLD
END
-RUN





JOIN AIR_KEY IN S_NATIX TO ALL AIR_KEY IN A_NATIX AS J1
TABLE FILE S_NATIX
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL1
ON TABLE HOLD AS DEBHOLD
END
-RUN





JOIN CLEAR *
-RUN





JOIN LEVEL1 IN DEBHOLD TO ALL LOWEST_VAL IN NATIXFIX AS J1
TABLE FILE DEBHOLD
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR LEVEL1 LOWEST_VAL NEW1 NEW2 NEW3 NEW4 NEW5 NEW6
BY LEVEL1 
ON TABLE HOLD AS FIXSEG
END
-RUN






TABLE FILE FIXSEG
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NEW1 AS 'AROLL_LEV1' NEW2 AS 'AROLL_LEV2' NEW3 AS 'AROLL_LEV3' NEW4 AS 'AROLL_LEV4' NEW5 AS 'AROLL_LEV5' NEW6 AS 'AROLL_LEV6'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXSEG1
END
-RUN

MODIFY FILE S_NATIX
FIXFORM FROM FIXSEG1
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV1
ON MATCH UPDATE AROLL_LEV2
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_LEV6
ON NOMATCH REJECT
DATA ON FIXSEG1
END
-RUN

 
-* MARKET

JOIN AIR_KEY IN M_NATIX TO AIR_KEY IN A_NATIX AS J1
TABLE FILE M_NATIX
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY LEVEL1
ON TABLE HOLD AS DEBHOLDM
END
-RUN


JOIN CLEAR *
-RUN

 



JOIN LEVEL1 IN DEBHOLDM TO ALL LOWEST_VAL IN NATIXFIX AS J1
TABLE FILE DEBHOLDM
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR LEVEL1 LOWEST_VAL NEW1 NEW2 NEW3 NEW4 NEW5 NEW6
BY LEVEL1
ON TABLE HOLD AS FIXMKT
END


TABLE FILE FIXMKT
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NEW1 AS 'AROLL_LEV1' NEW2 AS 'AROLL_LEV2' NEW3 AS 'AROLL_LEV3' NEW4 AS 'AROLL_LEV4' NEW5 AS 'AROLL_LEV5' NEW6 AS 'AROLL_LEV6' 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXMKT1
END
-RUN

MODIFY FILE M_NATIX
FIXFORM FROM FIXMKT1
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV1
ON MATCH UPDATE AROLL_LEV2
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_LEV6
ON NOMATCH REJECT
DATA ON FIXMKT1
END
-RUN

 
 
-* DESTINATION



-* MARKET

JOIN AIR_KEY IN D_NATIX TO AIR_KEY IN A_NATIX AS J1
TABLE FILE D_NATIX
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY LEVEL1
ON TABLE HOLD AS DEBHOLDD
END
-RUN


JOIN CLEAR *
-RUN





JOIN LEVEL1 IN DEBHOLDD TO ALL LOWEST_VAL IN NATIXFIX AS J1
TABLE FILE DEBHOLDD
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR LEVEL1 LOWEST_VAL NEW1 NEW2 NEW3 NEW4 NEW5 NEW6
BY LEVEL1
ON TABLE HOLD AS FIXDST
END


TABLE FILE FIXDST
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NEW1 AS 'AROLL_LEV1' NEW2 AS 'AROLL_LEV2' NEW3 AS 'AROLL_LEV3' NEW4 AS 'AROLL_LEV4' NEW5 AS 'AROLL_LEV5' NEW6 AS 'AROLL_LEV6'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXDST1
END
-RUN

MODIFY FILE D_NATIX
FIXFORM FROM FIXDST1
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV1
ON MATCH UPDATE AROLL_LEV2
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_LEV6
ON NOMATCH REJECT
DATA ON FIXDST1
END
-RUN

 
-* CAR



DEFINE FILE C_NATIX
DASH_CNT/I2 = POSIT(ICODEX, 36, '-', 1, 'I2');
N_ICODE/A31 = EDIT(ICODEX, '$$$$$99999999999999999999999999999');
DASH_CNT2/I2 = POSIT(N_ICODE, 31, '-', 1, 'I2');

XL01/A15 = GETTOK (ICODEX, 36, -1, '-', 15, XL01);
NW_LVL3/A15 = IF DASH_CNT2 NE 0 THEN XL01 ELSE ' ';
LV1/A9 = EDIT(LEVEL1, '999999999');
LV1_1/A5 = EDIT(XL01, '99999');
NW_LVL1/A15 = IF NW_LVL3 EQ ' ' THEN LEVEL1 ELSE
              LV1 || '-' || LV1_1;
END
TABLE FILE C_NATIX
PRINT  NW_LVL1 AS 'LEVEL1' LEVEL3 AS 'LEVEL2' NW_LVL3 AS 'LEVEL3'
BY CAR_KEY
ON TABLE HOLD AS CARHOLD
END
-RUN
 

TABLE FILE C_NATIX
PRINT CAR_KEY
BY CAR_KEY NOPRINT
ON TABLE HOLD
END

MODIFY FILE C_NATIX
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE LEVEL1='               ';
ON MATCH COMPUTE LEVEL2='               ';
ON MATCH COMPUTE LEVEL3='               ';
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE C_NATIX
FIXFORM FROM CARHOLD
MATCH CAR_KEY
ON MATCH UPDATE LEVEL1 LEVEL2 LEVEL3
ON NOMATCH REJECT
DATA ON CARHOLD
END
-RUN







-*BLANK OUT AROLL_LEV1 IN CAR FILES
TABLE FILE C_NATIX
PRINT CAR_KEY
BY LEVEL1
ON TABLE HOLD AS DEBHOLDC
END
-RUN


JOIN LEVEL1 IN DEBHOLDC TO ALL LOWEST_VAL IN NATIXFIX AS J1
TABLE FILE DEBHOLDC
PRINT CAR_KEY LEVEL1 LOWEST_VAL NEW1 NEW2 NEW3 NEW4 NEW5 NEW6
BY LEVEL1
ON TABLE HOLD AS FIXCAR
END

TABLE FILE FIXCAR
PRINT CAR_KEY NEW1 AS 'AROLL_LEV1' NEW2 AS 'AROLL_LEV2' NEW3 AS 'AROLL_LEV3' NEW4 AS 'AROLL_LEV4' NEW5 AS 'AROLL_LEV5' NEW6 AS 'AROLL_LEV6'
BY CAR_KEY NOPRINT
ON TABLE HOLD AS FIXCAR1
END
-RUN

MODIFY FILE C_NATIX
FIXFORM FROM FIXCAR1
MATCH CAR_KEY
ON MATCH UPDATE AROLL_LEV1
ON MATCH UPDATE AROLL_LEV2
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_LEV6
ON NOMATCH REJECT
DATA ON FIXCAR1
END
-RUN

-* HOTEL


DEFINE FILE H_NATIX
DASH_CNT/I2 = POSIT(ICODEX, 36, '-', 1, 'I2');
N_ICODE/A31 = EDIT(ICODEX, '$$$$$99999999999999999999999999999');
DASH_CNT2/I2 = POSIT(N_ICODE, 31, '-', 1, 'I2');

XL01/A15 = GETTOK (ICODEX, 36, -1, '-', 15, XL01);
NW_LVL3/A15 = IF DASH_CNT2 NE 0 THEN XL01 ELSE ' ';
LV1/A9 = EDIT(LEVEL1, '999999999');
LV1_1/A5 = EDIT(XL01, '99999');
NW_LVL1/A15 = IF NW_LVL3 EQ ' ' THEN LEVEL1 ELSE
              LV1 || '-' || LV1_1;
END
TABLE FILE H_NATIX
PRINT  NW_LVL1 AS 'LEVEL1' LEVEL3 AS 'LEVEL2' NW_LVL3 AS 'LEVEL3'
BY HTL_KEY
ON TABLE HOLD AS HTLHOLD
END
-RUN
 

TABLE FILE H_NATIX
PRINT HTL_KEY
BY HTL_KEY NOPRINT
ON TABLE HOLD
END

MODIFY FILE H_NATIX
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE LEVEL1='               ';
ON MATCH COMPUTE LEVEL2='               ';
ON MATCH COMPUTE LEVEL3='               ';
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLD
END

MODIFY FILE H_NATIX
FIXFORM FROM HTLHOLD
MATCH HTL_KEY
ON MATCH UPDATE LEVEL1 LEVEL2 LEVEL3
ON NOMATCH REJECT
DATA ON HTLHOLD
END
-RUN


TABLE FILE H_NATIX
PRINT HTL_KEY
BY LEVEL1
ON TABLE HOLD AS DEBHOLDH
END
-RUN



JOIN LEVEL1 IN DEBHOLDH TO ALL LOWEST_VAL IN NATIXFIX AS J1
TABLE FILE DEBHOLDH
PRINT HTL_KEY LEVEL1 LOWEST_VAL NEW1 NEW2 NEW3 NEW4 NEW5 NEW6
BY LEVEL1
ON TABLE HOLD AS FIXHTL
END

TABLE FILE FIXHTL
PRINT HTL_KEY NEW1 AS 'AROLL_LEV1' NEW2 AS 'AROLL_LEV2' NEW3 AS 'AROLL_LEV3' NEW4 AS 'AROLL_LEV4' NEW5 AS 'AROLL_LEV5' NEW6 AS 'AROLL_LEV6'
BY HTL_KEY NOPRINT
ON TABLE HOLD AS FIXHTL1
END
-RUN

MODIFY FILE H_NATIX
FIXFORM FROM FIXHTL1
MATCH HTL_KEY
ON MATCH UPDATE AROLL_LEV1
ON MATCH UPDATE AROLL_LEV2
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_LEV6
ON NOMATCH REJECT
DATA ON FIXHTL1
END
-RUN


-TYPE UPDATE COMPLETED

-XXIT
