-* 3/28/14 - DEB - ADDED ROUTINE FOR KCUHHRS
-* 5/12/14 - Joy - Updated JHA routing to validate setfile as well as rollup code
-*12/18/15 - DLV - S-13284   Updated to allow reports to sort/subtotal by id-levels
-*9/29/16-JEM-S-20812-Added routine for NDUHNRS
-*S-20812-10/7/16-JEM-Added HRS_AMT1
-* 06/22/17 - DLV - S-33777 - Added ABHRSAG TO UDHRS routine Added HRS_DUE define
-*                            Code report style sheet for Position to be variable instead of hard coded
-* 08/14/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Backed out old footer changes.

-INCLUDE SETECHO
-* 
SET ASNAMES=ON
-RUN

-INCLUDE RETUDID
-RUN


TABLE FILE &&RPT_HOLD
PRINT BOOKINGS
      CHAIN_NAME
      CITY_ST
      HOTEL_PHONE
      HTL_KEY
      IBOOK
      IN_DATE
      INVOICE_DATE
      INVOICE_NUM
      LEVEL1
      LEVEL2
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      LEVEL7  
      NBR_DAYS
      NBR_ROOMS
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      OUT_DATE
      PNR_LOCATOR      
      PROP_ADDRESS
      PROP_CITY
      PROP_NAME
      PROP_STATE_CD
      PROP_ZIP5
      RATE_CODE
      RESV_STATUS
      REFUSAL_DESC
      REFUSE_CODE
      RSNCDE
      TOTAL_SLSAV 
      TOTAL_STD
      TRIP_PURPOSE
      XPSNGR_NM
BY LEVEL_DESC
ON TABLE HOLD AS HTLHLD
END
-RUN

TABLE FILE &&RPT_HOLD
SUM 
  NBR_DAYS AS 'TDAY'
  NEW_TOTAL_AMT AS 'TAMT'
BY LEVEL_DESC 
ON TABLE HOLD AS HHOLD1
END
-RUN

MATCH FILE HTLHLD
PRINT BOOKINGS
      CHAIN_NAME
      CITY_ST
      HOTEL_PHONE
      HTL_KEY
      IBOOK
      IN_DATE
      INVOICE_DATE
      INVOICE_NUM
      LEVEL1
      LEVEL2
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      LEVEL7  
      NBR_DAYS
      NBR_ROOMS
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      OUT_DATE
      PNR_LOCATOR      
      PROP_ADDRESS
      PROP_CITY
      PROP_NAME
      PROP_STATE_CD
      PROP_ZIP5
      RATE_CODE
      RESV_STATUS
      REFUSAL_DESC
      REFUSE_CODE
      RSNCDE
      TOTAL_SLSAV 
      TOTAL_STD
      TRIP_PURPOSE
      XPSNGR_NM
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HHOLD1
SUM TDAY
    TAMT
BY LEVEL_DESC
AFTER MATCH HOLD AS XONE OLD-OR-NEW
END
-RUN

TABLE FILE XONE
PRINT BOOKINGS
      CHAIN_NAME
      CITY_ST
      HOTEL_PHONE
      IBOOK
      IN_DATE
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      LEVEL1
      LEVEL2
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      LEVEL7  
      NBR_DAYS
      NBR_ROOMS
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      OUT_DATE
      PNR_LOCATOR      
      PROP_ADDRESS
      PROP_CITY
      PROP_NAME
      PROP_STATE_CD
      PROP_ZIP5
      RATE_CODE
      RESV_STATUS
      REFUSAL_DESC
      REFUSE_CODE
      RSNCDE
      TOTAL_SLSAV 
      TOTAL_STD
      TRIP_PURPOSE
      XPSNGR_NM
      TDAY
      TAMT
BY HTL_KEY
ON TABLE HOLD AS HTLHLD2
END 
-RUN

-IF '&&ROLLUP.EVAL' EQ 'JHA-R' AND '&&SETF.EVAL' EQ 'JHUDHLS' THEN GOTO EXJHA;
-IF '&&SETF.EVAL' EQ 'ABUHHRS' OR 'KCUHHRS' OR 'ABHRSAG' THEN GOTO EXHRS;
-IF '&&SETF.EVAL' EQ 'NDUHNRS' GOTO EXNORD;

-EXJHA

 
EX UDHLSJHA
-RUN

-GOTO FINALHLD;

-EXNORD;
EX UDNDNRS
-RUN

-GOTO FINALHLD1;


-EXHRS
EX UDHRS
-RUN
-GOTO FINALHLD;


-FINALHLD;
DEFINE FILE HTLHLD3
HRS_DUE/D12.2CS = IF HRS_AMT1 EQ 0 THEN 0 ELSE HRS_AMT1 * .30;
END
TABLE FILE HTLHLD3
PRINT HTL_KEY
      BOOKINGS
      CHAIN_NAME
      CITY_ST
      HOTEL_PHONE
      IBOOK
      IN_DATE
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      NBR_ROOMS
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      OUT_DATE
      PNR_LOCATOR      
      PROP_ADDRESS
      PROP_CITY
      PROP_NAME
      PROP_STATE_CD
      PROP_ZIP5
      RATE_CODE
      RESV_STATUS
      REFUSAL_DESC
      REFUSE_CODE
      RSNCDE
      TOTAL_SLSAV 
      TOTAL_STD
      XPSNGR_NM
      TDAY
      TAMT
      HOTEL
      HTL_LSAV
      HRS_AMT1
      HRS_DAYS
      HRS_BOOK
      TRP_PRP
-*      TRIP
      HRS_DUE
BY HTL_KEY
ON TABLE HOLD AS HTLHLD4
END
-RUN
-GOTO CONTUDIDRPT;

-FINALHLD1;

TABLE FILE HTLHLD3
PRINT HTL_KEY
      BOOKINGS
      CHAIN_NAME
      CITY_ST
      HOTEL_PHONE
      IBOOK
      IN_DATE
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      NBR_ROOMS
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      OUT_DATE
      PNR_LOCATOR      
      PROP_ADDRESS
      PROP_CITY
      PROP_NAME
      PROP_STATE_CD
      PROP_ZIP5
      RATE_CODE
      RESV_STATUS
      REFUSAL_DESC
      REFUSE_CODE
      RSNCDE
      TOTAL_SLSAV 
      TOTAL_STD
      XPSNGR_NM
      TDAY
      TAMT
      HOTEL
      HTL_LSAV
      NRS_AMT1
      NRS_DAYS
      NRS_BOOK
      TRP_PRP
      HLS_AMT1
-*      TRIP
BY HTL_KEY
ON TABLE HOLD AS HTLHLD4
END
-RUN


-GOTO CONTUDIDRPT;

-CONTUDIDRPT;

DEFINE FILE HTLHLD4 ADD
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);

END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN
 

TABLE FILE HTLHLD4
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5 
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
  
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 


-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT



-XXIT



