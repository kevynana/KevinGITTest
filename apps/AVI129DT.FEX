-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* CREATED FOR DATA VAULT EXCHANGE REPORT
-* CREATED FROM AVIW10
-* 5/10/10 - changed Level1 to be handled like all other Levels - Deb
-* Added Add collect amount, new amount, forfeit penatly amount
-* and removed total amount field Deb 6/22/12
-*5/22/14   DEB   UPDATED RADV_PURCH DEFINE TO INCLUDE EX5
-* 8/28/14 DEB ADDED ROUTINE FOR DVEXCHF TO ADD FEE AMT
-*12/4/14 - DEB CHANGED SORT ON MATCH TO ASHLD FILE
-* 3/20/15 -DEB -  S-07953 - ADDED ROUTINE FOR ITEXCHG
-* 04/17/2015 - DEB - S-08364 - ADDED ROUTINE FOR CMEXCHG
-* 4/30/15 - DEB - S-08628 - ADDED FIELD DEFINITION FOR ADD_AMT SO WOULD 
-*                           SUBTOTAL CORRECTLY 
-*12/28/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*7/11/16 -DLV -  S-20630  Carried through EMP_ID  
-*08/03/16 - DLV - S-21658/22696 - Updated report styling
-*10/18/16 - DLV - S-26029 - Updated reports using EMP_ID - changed LEVEL1 to EMP_ID
-************************************************************************** 
-*DATE           NAME               DESCRIPTION OF CHANGE

-**************************************************************************
-INCLUDE SETECHO
SET ASNAMES=ON
-RUN

-INCLUDE SETECHO


TABLE FILE EXCAIR
SUM 
  DISSAVINGS AS 'DTSAVE'	
  EXCH_FARE AS 'EFARE'	
  FARE_PAID AS 'TFARE'
  NET_TKT_CNT AS 'TTKT'	
  ORG_SALE AS 'TORG'	
  REF_EXCH_CNT AS 'TRFEX'	  
  SAVINGS AS 'TSAVE'
  TKT_PURCH AS 'TPURCH'	
  EXCH_NET_FARE AS 'ENFARE'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN




DEFINE FILE EXCAIR
TICKET1/A10 = DOC_NUMBER;
END
TABLE FILE EXCAIR
PRINT ADDCOLLECT
  AIR_KEY
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  AUX_TKTLS_NUM
  BR_CL_IDX
  C_ITIN
  RESV_DATE
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOD_TYPE	
  DOC_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE	
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE
  FARE_BAS	
  FARE_PAID	
  FLIGHT	
  INVOICE_NUM	
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MV_CCNUM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE	
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM	
  SEG_LOWEST
  SEG_STANDARD
  TICKET1
  TKT_DATE
  TKT_NUM	
  TKT_PURCH	
  TKT_TYPE
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XTRAN_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
ON TABLE COLUMN-TOTAL
END
-RUN


MATCH FILE XTWO
PRINT ADDCOLLECT
  AIR_KEY
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MV_CCNUM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_STANDARD
  TICKET1
  TKT_DATE
  TKT_NUM	
  TKT_PURCH	
  TKT_TYPE
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT	
  XFST_DPT
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	
  ENFARE
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

-IF '&&SETF.EVAL' NE 'PWDVEXCH' THEN GOTO STD;

-INCLUDE PWAEXUSE
-RUN

-GOTO FinishRpt;

-STD

-INCLUDE AEXUSE
-RUN

MATCH FILE AIRHOLD2
PRINT ADDCOLLECT AIR_KEY
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_NBR
  SEG_STANDARD	
  TRN_DATE
  TKT_DATE
  TKT_NUM	
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT
  ENFARE
BY TICKET1
ON TABLE HOLD
RUN
FILE ASHLD
SUM OLD_ITIN
BY TICKET1
AFTER MATCH HOLD AS MATCH2 OLD
END
-RUN

-IF '&&SETF.EVAL' NE 'DVEXCHF' THEN GOTO SkipFees;

-INCLUDE PFXUSE
-RUN

TABLE FILE MATCH2
PRINT ADDCOLLECT
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_NBR
  SEG_STANDARD	
  TRN_DATE
  TKT_DATE
  TKT_NUM	
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	
  ENFARE
  OLD_ITIN
BY AIR_KEY
ON TABLE HOLD AS HOLD3
END
-RUN


 
JOIN AIR_KEY IN HOLD3 TO ALL AIR_KEY IN PFHOLDA
-RUN


DEFINE FILE HOLD3
FEE/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF TKT_TYPE NE ' ' THEN 0 ELSE
              IF TKT_SORT NE LAST TKT_SORT THEN FEE_AMT ELSE 0;
END
TABLE FILE HOLD3
PRINT ADDCOLLECT
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_NBR
  SEG_STANDARD	
  TRN_DATE
  TKT_DATE
  TKT_NUM	
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	
  ENFARE
  OLD_ITIN
  FEE
BY TKT_SORT 
BY TKT_NUM
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN

-GOTO FinalStep;

-SkipFees


-IF '&&SETF.EVAL' NE 'CMEXCHG' THEN GOTO SkipUdid;

EX UDCOMPRFT
-RUN

-GOTO FinalStep;



-SkipUdid


TABLE FILE MATCH2
PRINT ADDCOLLECT
  AIRLINE	
  AIRLINE_FEE
  ARR_TIME
  AUX_TKTLS_NUM
  RESV_DATE
  BR_CL_IDX
  C_ITIN
  CLASS	
  CREDIT_CARD
  DOC_NUMBER
  DOC_TYPE
  DOD_TYPE
  DPT
  DPT_TIME	
  EMB_CTY_NM	
  EMBARK
  EMP_ID
  EX_FLAG
  EXCH_AC	
  EXCH_FARE
  EXCH_NET_FARE
  EXCH_NET_TAX
  EXCHG_SALE	
  FARE_BAS	
  FARE_PAID	
  FLIGHT
  INVOICE_NUM	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NET_TKT_CNT
  NEW_ADV_PURCH
  NON_REF	
  ORG_SALE
  PARENT_DATE
  PENALTY
  PENALTY_CNT
  REFUSE_CODE
  REF_EXCH_CNT	
  RESV_DATE
  RTE_CTY_NM
  SEG_LOWEST
  SEG_STANDARD	
  TKT_DATE
  TKT_NUM	
  TKT_PURCH
  TKT_TYPE
  TRN_DATE
  VAL_AIRLINE
  XARR_DT	
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
  EFARE
  DTSAVE
  TFARE	
  TORG	
  TPURCH	
  TRFEX	
  TSAVE
  TTKT	
  ENFARE
  C_ITIN
  OLD_ITIN
BY TKT_SORT 
BY TKT_NUM
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN


-FinalStep

-INCLUDE DATAVROLL


-FinishRpt


-SET &FEE = IF '&&SETF.EVAL' NE 'DVEXCHF' THEN ' ' ELSE 'FEE AS ''FEE,AMT'' ';
-SET &RFTRSN = IF '&&SETF.EVAL' NE 'CMEXCHG' THEN ' ' ELSE 'RFT_RSN AS ''REASON FOR TRAVEL'' ';


DEFINE FILE AIRHOLD3
-INCLUDE STDTIME
  PASNGR_NAME/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
  TICKET_NMBR/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_NUM ELSE ' ';
  TRN_DT/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN XTRAN_DT ELSE 0;
  PAR_DT/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN PARENT_DATE ELSE 0;
  XT_DTE/A8 = EDIT(TRN_DATE);
  XTKT_SRT/A10 = EDIT(TKT_SORT,'9999999999$');
  XINV_NUM/A7 = IF TKT_NUM NE LAST TKT_NUM THEN INVOICE_NUM ELSE ' ';
  XNON_REF/A15 = IF TKT_NUM NE LAST TKT_NUM THEN NON_REF ELSE ' ' ;
-* ****DEFINES ON PREVIOUS DEFINES****
  SRT_DT/A120 = TKT_SORT||XT_DTE||LEVEL_DESC||XPSNGR_NM;
  DOC_NMBR/A10 = IF (DOC_NUMBER EQ '0000000000') THEN ' ' ELSE               
               IF (EMBARK EQ 'FP2') THEN ' ' ELSE
               IF (SRT_DT NE LAST SRT_DT) THEN DOC_NUMBER ELSE ' ';
  AUX_NMBR/A10 = IF (AUX_TKTLS_NUM EQ '0000000000') THEN ' ' ELSE               
               IF (EMBARK EQ 'FP2') THEN ' ' ELSE
               IF (SRT_DT NE LAST SRT_DT) THEN AUX_TKTLS_NUM ELSE ' ';
  EXCH_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN EFARE ELSE 0;
  EXCHN_AMT/D12.2CS = IF (TKT_NUM NE LAST TKT_NUM) AND (EX_FLAG EQ ' ') THEN EXCH_NET_FARE ELSE 0;
 
  FARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TFARE ELSE 0; 
  ORIG_SALE/D12.2C  = IF (EMBARK EQ 'FP2') THEN 0 ELSE 
                      IF (SRT_DT NE LAST SRT_DT) THEN ORG_SALE ELSE 0;
  ORIG_SL/D12.2CS = IF (EMBARK EQ 'FP2') THEN 0 ELSE 
                      IF (DOC_TYPE EQ '1') THEN 0 ELSE
                   IF (SRT_DT NE LAST SRT_DT) THEN ORG_SALE ELSE 0;
  LOST_SAV_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN DTSAVE ELSE 0;
  SAVE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TSAVE ELSE 0;
  RADV_PURCH/I8CS = IF (EMBARK EQ 'FP2' OR 'EX1' OR 'RF1' OR 'EX5') THEN 0
  ELSE IF (TKT_TYPE EQ 'P-RF' OR 'P-EX') THEN 0
  ELSE IF (SEG_NBR EQ '00') THEN 0
  ELSE IF (TKT_SORT NE LAST TKT_SORT) AND (FARE_AMT GE 0) THEN NEW_ADV_PURCH
  ELSE IF (TKT_SORT NE LAST TKT_SORT) AND (FARE_AMT LT 0) 
  THEN NEW_ADV_PURCH * (-1) ELSE 0;
  RREFUSE_CODE/A2 = IF TKT_SORT NE LAST TKT_SORT THEN REFUSE_CODE ELSE ' ';
-*   ADD_AMT/D12.2CS = IF (DOC_NUMBER EQ '0000000000') THEN FARE_AMT ELSE
-*                    IF (DOC_NUMBER NE '0000000000')  THEN (FARE_AMT - ORIG_SALE) ELSE 0;
-*                    IF TKT_NUM NE LAST TKT_NUM THEN ADDCOLLECT ELSE 0;
  ADD_AMT2/D12.2CS= IF (DOC_NUMBER EQ '0000000000') THEN FARE_AMT ELSE                    
                    IF TKT_NUM NE LAST TKT_NUM THEN ADDCOLLECT ELSE 0;
-*                    IF TKT_TYPE EQ 'F-EX' THEN 0 ELSE
-*  ADD_AMT/D12.2CS = IF TKT_NUM NE LAST TKT_NUM AND EX_FLAG EQ ' 'THEN ADDCOLLECT ELSE 0;
  ADD_AMT/D12.2CS = IF TKT_NUM NE LAST TKT_NUM AND EX_FLAG EQ ' ' THEN ADDCOLLECT ELSE 0;

  MCO_AMT/D12.2CS = IF DOC_TYPE EQ '1' THEN FARE_AMT ELSE 0;
  CITIN/A67 = IF DOC_TYPE EQ '1' THEN 'MCO' ELSE C_ITIN;
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
  NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
END

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD3';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

-IF '&&SETF.EVAL' EQ 'PWDVEXCH' THEN GOTO POWENG;
-IF '&&SETF.EVAL' EQ 'ITEXCHG' THEN GOTO ITRON;

TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
SUM BR_CL_IDX AS 'ACCT'
  LEVEL1 &LV1 
  XPSNGR_NM AS 'TRAVELER'
  EMP_ID &EMPID
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'TRAVEL'
  INVOICE_NUM AS 'INVOICE'  
  VAL_AIRLINE AS 'A/L'
  C_ITIN AS 'ITINERARY'
  TKT_NUM AS 'TICKET'
  OLD_ITIN AS 'ORIG ITINERARY'  DOC_NUMBER AS 'ORIG TICKET'
  ADD_AMT   AS 'ADD,COLLECT,AMT'
  ORIG_SALE AS 'ORIG AMT'
-*  FARE_AMT
-*  ADD_AMT2
-*  AIRLINE_FEE
-*COMPUTE TTL/D12.2S = IF DOC_TYPE EQ '1' THEN MCO_AMT ELSE
-*                           ADD_AMT + ORIG_SALE;
COMPUTE TTL/D12.2S =  FARE_AMT - AIRLINE_FEE; AS 'NEW,AMT'

  AIRLINE_FEE/D12.2CS AS 'FORFEIT,PENALTY,AMT'
&FEE
  LEVEL2 &LV2
  LEVEL3 &LV3 
  LEVEL4 &LV4 
&RFTRSN  
BY BR_CL_IDX NOPRINT
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY INVOICE_NUM NOPRINT
BY TKT_NUM NOPRINT
BY DOC_NUMBER NOPRINT
WHERE EX_FLAG NE 'F' OR 'P'
ON TABLE COLUMN-TOTAL


-GOTO FinFoot;

-POWENG

-GOTO DEB2;
TRAVELER
INVOICED
TRAVEL DATE
A/L
ITINERARY
TICKET #
TICKET TYPE
JOB TYPE
PROJECT #
FOP
AMT
TOTAL AMT
ORIG ITINERARY
ORIG TICKET #
ORIG TICKET TYPE
ORIG JOB TYPE
ORIG PROJECT #
ORIG FOP
ORIG AMT

-DEB2


TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC
SUM
  XPSNGR_NM AS 'TRAVELER'
  OLD_ITIN AS 'ORIG ITINERARY'  
  DOC_NUMBER AS 'ORIG TICKET' 
  OLD_LEV2 AS 'ORIG,JOB,TYPE'
  OLD_LEV4 AS 'ORIG,PROJECT#'
  OLD_FOP AS 'ORIG,FOP'
  ORIG_SALE AS 'ORIG AMT'  
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'TRAVEL'
  INVOICE_NUM AS 'INVOICE'  
  VAL_AIRLINE AS 'A/L'
  C_ITIN AS 'ITINERARY'
  TKT_NUM AS 'TICKET'
-*  TKT_TYPE AS 'TKT_TYPE'
  LEVEL2 &LV2
  LEVEL4 &LV4 
  MV_CCNUM AS 'FOP'
  ADD_AMT   AS 'ADD,COLLECT,AMT'
  
-*  COMPUTE TTL/D12.2S = IF DOC_TYPE EQ '1' THEN MCO_AMT ELSE
-*                           ADD_AMT + ORIG_SALE;
  COMPUTE TTL/D12.2S =  FARE_AMT - AIRLINE_FEE; AS 'NEW,AMT'

  AIRLINE_FEE AS 'FORFEIT,PENALTY,AMT'
  
-*  OLD_TYPE AS 'ORIG,TKT,TYPE'
  
  

BY BR_CL_IDX NOPRINT
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY INVOICE_NUM NOPRINT
BY TKT_NUM NOPRINT 
BY DOC_NUMBER NOPRINT


WHERE EX_FLAG NE 'F' OR 'P'
-*WHERE DOC_NUMBER OMITS '0000000000'
 ON TABLE COLUMN-TOTAL

-INCLUDE FOOTERDT

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-*-INCLUDE DT8
-INCLUDE &&PASTYD

ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO XXIT;


-ITRON
TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC


PRINT
AIRLINE AS 'FLOWN,AIRLINE'
XDPT_DT AS  'DEPARTURE,DATE'           
TIME_DPT AS 'DEPARTURE,TIME'          
XARR_DT AS 'ARRIVAL,DATE'             
TIME_ARR AS 'ARRIVAL,TIME'
RADV_PURCH AS 'ADV,PURCH, DAYS'
FARE_AMT AS 'FARE,PAID'           
ADD_AMT AS 'OUT OF,POCKET,EXPENSE'
BY LEVEL_DESC NOPRINT  
BY XPSNGR_NM AS 'PASSENGER,  NAME'           
BY EMP_ID AS  'EMPLOYEE,NUMBER'             
BY XTRAN_DT AS 'TRANSACTION,DATE'            
BY TKT_NUM AS 'TICKET,NUMBER'
BY CITIN AS  'ITINERARY'            
BY TKT_SORT             SKIP-LINE NOPRINT  
BY SEG_NBR              NOPRINT  

ON LEVEL_DESC RECOMPUTE MULTILINES FARE_AMT ADD_AMT  AS 'Total For '
ON XPSNGR_NM RECOMPUTE  MULTILINES FARE_AMT ADD_AMT   AS 'TOTAL FOR '



-FinFoot



-INCLUDE FOOTERDT

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD

ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-XXIT