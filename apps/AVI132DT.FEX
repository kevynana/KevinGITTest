  
-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-********************************************************************
-* Modifications:
-* CREATED FOR PURITY TRANSACTION FEE REPORT CREATED FROM AVIW74DT  
-********************************************************************
-* CHANGED FLAG FROM M TO B ON FEES DUE TO CHANGE IN PFXUSE CHANGES
-* 5/6/14 - DEB
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*2/4/15 - DEB = S-07237  ADDED TASF_TKT_NUM TO ABTRNFEE 
-*2/17/15 - DEB = S-07237  ADDED CODE FOR ABTRNFSM
-*12/28/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*10/24/16- DLV S-26029 - Carried through EMP_ID updated to show literal names of ID-level
-*10/24/16- DLV - S-26029 - Carried through EMP_ID changed to show literal names in ID-levels
-*01/13/2017 -DLV - S-29195 - Removed EMP_ID sort for ABTRNFEE due to TASF appearing before ticket information
-*4/21/2017-JEM-S-33318-updated logic for no records report
-* 08/04/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = 3;
-*08/09/17 CA D-01601 added "," to Transaction,Date line 1226 & Ticket,Number line 1232
-* 09/08/2017 - RSB - D-01622 BUG FIX - ABBTALS1 and AATRNFEE - width not fitting on one page Part 2
-*                             Changed &LV1 to &LV1_TITLE and &EMPID to &EMPID_TITLE for AATRNFEE
-*                             LEVEL1 is currently a NOPRINT in the report.
-*
-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

SET ASNAMES=ON 
-RUN
-INCLUDE SETECHO

DEFINE FILE &&RPT_HOLD ADD
EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') AND
               (EXCHG_SALE NE ' ') THEN 1 ELSE 0;  
REFUND/D9CS    = IF (VOID_DATE EQ 0) AND
                    (SEG_CNT LE 0) AND
                    (TKT_SORT NE LAST TKT_SORT) AND
                    (EMBARK NE 'DT1' OR 'RF1' OR 'FP3') AND
                    (RF_FLAG NE ' ') THEN 1 ELSE 0;
FARE/D12.2 = IF VOID_DATE EQ 0 THEN FARE_PAID ELSE 0;
COMM/D12.2 = IF VOID_DATE EQ 0 THEN SEG_COM ELSE 0;
                    
END

TABLE FILE &&RPT_HOLD
SUM FARE AS 'TFARE'
    NEW_SEG_AMT AS 'TBASE'
    EXCHGS AS 'TEXCH'
    EXMCOS AS 'TEXMCO'
    MCOS AS 'TMCO'
    REFUND AS 'TREF'
    VOIDS AS 'TVOID'
    COMM AS 'TCOMM'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN


TABLE FILE &&RPT_HOLD
PRINT XDPT_DT
BY AIR_KEY
BY SEG_NBR NOPRINT
WHERE EMBARK OMITS 'DT1' OR 'FP' 
ON TABLE HOLD AS TEST1
END
-RUN

TABLE FILE TEST1
SUM LST.XDPT_DT AS 'RTN_DT'
BY AIR_KEY
ON TABLE HOLD AS TEST2
END
-RUN
 
TABLE FILE &&RPT_HOLD
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG  
  EX_IND 
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
BY AIR_KEY  
ON TABLE HOLD AS HOLD1
END
-RUN


MATCH FILE HOLD1
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG  
  EX_IND  
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
BY AIR_KEY  
ON TABLE HOLD
RUN
FILE TEST2
SUM RTN_DT
BY AIR_KEY
AFTER MATCH HOLD AS XTWO OLD
END
-RUN


MATCH FILE XTWO
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  RTN_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT 
      TBASE     
      TFARE
      TEXCH
      TEXMCO
      TMCO
      TREF
      TVOID
      TCOMM
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

-INCLUDE PFXUSE
-RUN
 

DEFINE FILE AIRHOLD2
FLAG/A1 = 'A';
TASF_TKT_NUM/A10 = '          ';
END
TABLE FILE AIRHOLD2
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  FLAG
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XTRAN_DT
  XPSNGR_NM
  TBASE 
  TCOMM
  TFARE
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RTN_DT
BY AIR_KEY 
ON TABLE HOLD AS AIRHOLD4  
END
-RUN



DEFINE FILE PFHOLDA
  AKEY/A47=''''| AIR_KEY |'''';
END

TABLE FILE PFHOLDA
PRINT AKEY
BY AIR_KEY NOPRINT
ON TABLE SAVE 
END
-RUN

DEFINE FILE SR_50
 CC_LEN/I2 = ARGLEN(18, CREDIT_CARD, CC_LEN);
 AA_CC/A7 = IF CC_LEN LT 18 THEN EDIT(CREDIT_CARD, '99$$$$$$$$$$99999')
              ELSE EDIT(CREDIT_CARD, '99$$$$$$$$$$$99999');
 COMM/D12.2 = IF VOID_DATE EQ 0 THEN SEG_COM ELSE 0;

 FARE_PAID/D12.2C   = SEG_AMT + SEG_TAX;
 XTRAN_DT/MDYY        = TRN_DATE;
 LEVEL_DESC/A60 = &&LDESC;
 MCOS/D9CS           = IF (DOC_TYPE EQ '1') AND
                            (EX_FLAG EQ ' ')  AND
                           (EXCHG_SALE NE ' ') THEN 1 ELSE 0;        
 NEW_SEG_AMT/D12.2CS = SEG_AMT;
 NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                            (SEG_NBR EQ '01') AND
                            (FARE_PAID GE 0) AND
                            (SEG_COUNT EQ 1) AND 
                            (CONJ_REL EQ 1) THEN 1 ELSE 
                         IF (TICKET_CODE EQ '1') AND
                            (SEG_NBR EQ '01') AND 
                            (EX_FLAG EQ 'F') THEN (-1) ELSE 
                         IF (TICKET_CODE EQ '1') AND
                            (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
NET_TKT_CNT1/D9 =   IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND
                         (SEG_COUNT  EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE 
                    IF (DOC_TYPE EQ '1') AND (EX_FLAG EQ ' ') AND 
                         (EXCHG_SALE NE ' ') AND (RF_FLAG EQ ' ') THEN 1 ELSE 0;
NEW_SEG_MILES/D9= SEG_MILES;
SEG_CNT/D8CS         = SEG_COUNT;
TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                          (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                           (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
                           EX_IND/A1 = IF EXCHG_SALE NE ' ' THEN 'E' ELSE ' ';
XPSNGR_NM/A15        = 
  EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');   
XDPT_DT/MDYY         = DPT_DATE;
VOIDS/D9CS          = IF (VOID_DATE NE 0) AND
                           (SEG_COUNT EQ 1) AND
                           (SEG_NBR EQ '01') THEN 1 ELSE
                        IF (DOC_TYPE EQ '1') AND 
                           (VOID_DATE NE 0) THEN 1 ELSE 0;
FLAG/A1 = 'B';
TKT_CNT/D9CS        = IF (SEG_NBR EQ '01') AND 
                         (FARE_PAID GE 0) AND 
                           (SEG_COUNT EQ 1) THEN 1 ELSE 0;       
-* Defines on previous defines
 AIRLINE_FEE/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' 
      THEN FARE_PAID ELSE 0;
 EXCHGS/D9 = IF (EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK 
  NE 'DT1' OR 'RF1' OR 'FP3') THEN TKT_CNT ELSE
  IF (DOC_TYPE EQ '1') AND (EXCHG_SALE EQ 'E') THEN 0 ELSE
  IF (SEG_COUNT GE 0) AND (EXCHG_SALE NE ' ') THEN TKT_CNT ELSE 0;
 REFUND/D9CS    = IF (VOID_DATE EQ 0) AND
                     (SEG_COUNT LE 0) AND
                    (TKT_SORT NE LAST TKT_SORT) AND
                    (EMBARK NE 'DT1' OR 'RF1' OR 'FP3') AND
                    (RF_FLAG NE ' ') THEN 1 ELSE 0;
 TSFARE_PAID/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN 0 ELSE FARE_PAID ;
 XFST_DPT/MDYY = FST_DPT_DATE;
 EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') AND (EXCHG_SALE 
	NE ' ') THEN 1 ELSE 0;  
 END

TABLE FILE SR_50
PRINT AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  CITYPAIR.EMBARK      AS 'EMB_APT_CD'	
  EMP_ID
  EXCHG_SALE AS 'EXSALE'
  EX_FLAG
  EX_IND
  EXCHGS
  TSFARE_PAID AS 'FARE_PAID'
  FLAG
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MCOS
  LST.XDPT_DT AS 'RTN_DT'
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  NEW_SEG_AMT AS 'TBASE' 
  COMM AS 'TCOMM'
  TSFARE_PAID AS 'TFARE'
  EXCHGS AS 'TEXCH'
  EXMCOS AS 'TEXMCO'
  MCOS AS 'TMCO'
  REFUND AS 'TREF'
  VOIDS AS 'TVOID'
BY AIR_KEY
-INCLUDE RPTPARMS
-INCLUDE &AIRDATES
-* WHERE AIR_KEY IN FILE SAVE
ON TABLE HOLD AS SR50SUB FORMAT FOCUS INDEX AIR_KEY
END
-RUN
 

JOIN AIR_KEY IN PFHOLDA TO ALL AIR_KEY IN SR50SUB AS PFJ
-RUN

DEFINE FILE PFHOLDA
-* IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
FEE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN FEE_AMT ELSE 0;
END
TABLE FILE PFHOLDA
PRINT 
  AIR_KEY	
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE   
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  TBASE  
  TCOMM
  FEE AS 'TFARE' 
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RPT_DATE  
BY FLAG
BY PASSNGR_NAME NOPRINT
ON TABLE HOLD AS HOLDFEE FORMAT FOCUS
END
-RUN




TABLE FILE AIRHOLD4
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  TBASE 
  TCOMM
  TFARE
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RTN_DT AS 'RPT_DATE'
BY FLAG
BY PASSNGR_NAME NOPRINT
WHERE AIRLINE_FEE EQ 0
ON TABLE HOLD  
END
-RUN


MODIFY FILE HOLDFEE
FIXFORM FROM HOLD
DATA ON HOLD
END
-RUN

TABLE FILE HOLDFEE
PRINT 
  AIR_KEY	
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  XPSNGR_NM
  XFST_DPT
  VOID_DATE
  XTRAN_DT
  TBASE 
  TCOMM
  TFARE
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RPT_DATE
BY FLAG
BY PASSNGR_NAME NOPRINT
ON TABLE HOLD AS HOLDAM FORMAT FOCUS
END
-RUN



DEFINE FILE AIRHOLD4
FLAG/A1 = 'F';
END
TABLE FILE AIRHOLD4
PRINT 
  AIR_KEY
  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID  
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  TBASE   
  TCOMM
  TFARE
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RTN_DT AS 'RPT_DATE'
BY FLAG
BY PASSNGR_NAME NOPRINT
WHERE AIRLINE_FEE NE 0
ON TABLE HOLD
END
-RUN

MODIFY FILE HOLDAM
FIXFORM FROM HOLD
DATA ON HOLD
END
-RUN

 

-IF '&&SETF.EVAL' NE 'AATRNFEE' OR 'SBCTRFEE' THEN GOTO Skipstep;

-INCLUDE RETUDID
-RUN

 

TABLE FILE HOLDAM
PRINT  AA_CC
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  TBASE 
  TCOMM
  TFARE
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RPT_DATE
  FLAG
BY AIR_KEY
ON TABLE HOLD AS HOLD3
END
-RUN

-IF &&SETF.EVAL EQ 'SBCTRFEE' GOTO SBC;

EX UDAMEREA
-RUN

 

-GOTO NORECCHK

-SBC;
EX UDSBC
-RUN

-NORECCHK;
-IF &&NOAAREC EQ 'Y' THEN GOTO NORECORDS;

-GOTO Report
 
 


-Skipstep

TABLE FILE HOLDAM
PRINT 
  INTL_DOM
  AIRLINE
  AIRLINE_FEE
  BR_CL_IDX
  C_ITIN
  CC_NUM
  DOC_NUMBER
  DOC_TYPE
  EMBARK
  EMB_APT_CD
  EMP_ID
  EXSALE
  EX_FLAG
  EX_IND
  EXCHGS
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  NEW_SEG_AMT
  NET_TKT_CNT
  NET_TKT_CNT1
  NEW_SEG_MILES
  PASSNGR_NAME
  PNR_LOCATOR
  RF_FLAG
  SEG_CNT
  SEG_NBR
  TASF_TKT_NUM
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE
  VOID_DATE
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  TBASE 
  TCOMM
  TFARE
  TEXCH
  TEXMCO
  TMCO
  TREF
  TVOID
  RPT_DATE
BY AIR_KEY
BY FLAG
BY PASSNGR_NAME NOPRINT
ON TABLE HOLD AS AIRHOLD3 
END
-RUN





-Report


 

DEFINE FILE AIRHOLD3

DOC_NMBR/A10 = IF (DOC_NUMBER EQ '0000000000') THEN ' ' ELSE               
               DOC_NUMBER;	
XT_DTE/A8 = EDIT(TRN_DATE);
XTKT_SRT/A10 = EDIT(TKT_SORT,'9999999999$');
-* ****DEFINES ON PREVIOUS DEFINES****
SRT_DT/A120 = TKT_SORT||XT_DTE||LEVEL_DESC||XPSNGR_NM;

FARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TFARE ELSE 0;
BASE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TBASE ELSE 0;

-*TTYPE/A25 = IF FLAG EQ 'M' THEN 'Transaction Charge' ELSE 
TTYPE/A25 = IF FLAG EQ 'B' THEN 'Transaction Charge' ELSE 
               IF FLAG EQ 'F' THEN 'Airline/Penalty Fee' ELSE 
               IF VOID_DATE NE 0 THEN 'Void' ELSE
               IF RF_FLAG NE ' ' THEN 'Refund Credit' ELSE 
               IF EX_IND EQ 'E' THEN 'Exchange Sale' ELSE 
               IF EX_FLAG NE ' ' THEN 'Original Sale Credit' ELSE
              'Original Sale'; 
-*FAREAMT/D12.2CS = IF FLAG EQ 'M' THEN TFARE ELSE IF FLAG EQ 'F' THEN AIRLINE_FEE ELSE FARE_AMT;  
FAREAMT/D12.2CS = IF FLAG EQ 'B' THEN TFARE ELSE IF FLAG EQ 'F' THEN AIRLINE_FEE ELSE FARE_AMT;  

-*RPTDT/MDY= IF FLAG EQ 'M' THEN RPT_DATE ELSE ' ';
-*RTNDT/MDY = IF FLAG NE 'M' THEN RPT_DATE ELSE ' ';
RPTDT/MDY= IF FLAG EQ 'B' THEN RPT_DATE ELSE ' ';
RTNDT/MDY = IF FLAG NE 'B' THEN RPT_DATE ELSE ' ';
TKTAMT/D12.2CS = IF FLAG EQ 'A'  THEN TFARE ELSE 0;
-*FEEAMT/D12.2CS = IF FLAG EQ 'M' THEN TFARE ELSE 0;
FEEAMT/D12.2CS = IF FLAG EQ 'B' THEN TFARE ELSE 0;

AIRFEE_AMT/D12.2CS = IF FLAG EQ 'F' THEN AIRLINE_FEE ELSE 0;
TASF_TN/A10 = IF FLAG EQ 'B' THEN TASF_TKT_NUM ELSE ' ';
-*Define on previous defines
-IF '&&SETF.EVAL' NE 'SBTRNFEE' THEN GOTO SkipDefine;
EXCH_CNT/D9CS = IF (FLAG EQ 'A') AND (SEG_NBR EQ '01') THEN TEXCH ELSE 0;
SALES_CNT/D9CS = IF (FLAG EQ 'A') AND (VOID_DATE EQ 0) THEN NET_TKT_CNT1 ELSE
                 IF (FLAG EQ 'A') AND (VOID_DATE NE 0) THEN NET_TKT_CNT1 ELSE 0;
MCO_CNT/D9CS = IF FLAG EQ 'A' AND SRT_DT NE LAST SRT_DT THEN TMCO ELSE 0;
REFUNDS/D9CS = IF FLAG EQ 'A' AND TKT_SORT NE LAST TKT_SORT THEN TREF ELSE 0;
EMCO_CNT/D9CS = IF FLAG EQ 'A' AND SRT_DT NE LAST SRT_DT THEN TEXMCO ELSE 0;
VOID_CNT/D9CS = IF (FLAG EQ 'A') AND (SEG_NBR EQ '01') THEN TVOID ELSE 
                IF (FLAG EQ 'A') AND (DOC_TYPE EQ '1') THEN TVOID ELSE 0;

 
TOTAL_TRAN/D9CS =  SALES_CNT + EXCH_CNT + REFUNDS + VOID_CNT ;
XCOMM/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TCOMM ELSE 0;

-SkipDefine
NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
XTS_FLAG/A1 = ' ';

END
-RUN
 
-INCLUDE DATAVROLL 
-RUN
 


-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD3';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-IF '&&SETF.EVAL' EQ 'AATRNFEE' THEN GOTO AMEREA; 
-IF '&&SETF.EVAL' EQ 'SBTRNFEE' THEN GOTO BTC;
-IF '&&SETF.EVAL' EQ 'BETRNFEE' THEN GOTO BETRN;
-IF '&&SETF.EVAL' EQ 'MBTRNFEE' THEN GOTO MILLB;
-IF '&&SETF.EVAL' EQ 'CHTRNFEE' THEN GOTO CH2M;
-IF '&&SETF.EVAL' EQ 'SBCTRFEE' THEN GOTO SBCRPT;
-IF '&&SETF.EVAL' EQ 'ABTRNFSM' THEN GOTO TRANFEE;
-IF '&&ROLLUP.EVAL' NE 'PURITY-R' THEN GOTO STANDARD;


SUM LEVEL1 AS 'LEVEL1'
      XPSNGR_NM AS 'PASSENGER NAME'
      XTRAN_DT AS 'TRANSACTION DATE'
      XFST_DPT AS 'DEPARTURE,DATE'
      RPTDT AS 'FEE,REPORT,DATE'
      TTYPE AS 'TRANSACTION, TYPE'
      C_ITIN AS 'ITINERARY'
      TKT_NUM AS 'TICKET NUMBER'
      FAREAMT AS 'CHARGE'
BY LEVEL1 NOPRINT
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT

BY FLAG NOPRINT
BY TTYPE NOPRINT
ON TABLE COLUMN-TOTAL
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "
-GOTO Finishrpt;


-STANDARD

SUM BR_CL_IDX AS 'CLIENT'
      XPSNGR_NM AS 'PASSENGER NAME'
      EMP_ID &EMPID
      LEVEL1 &LV1
      LEVEL2 &LV2
      LEVEL3 &LV3
      XTRAN_DT AS 'TRAN, DATE'
      XFST_DPT AS 'DEPART,DATE'
      RTNDT AS 'RETURN,DATE'
      RPTDT AS 'FEE,REPORT,DATE'
      TTYPE AS 'TRANSACTION, TYPE'
      C_ITIN AS 'ITINERARY'
      TKT_NUM AS 'TICKET, NUMBER'
      TASF_TN AS 'TASF,TICKET,NUMBER'
      FAREAMT AS 'CHARGE'

BY XPSNGR_NM NOPRINT

-*BY EMP_ID NOPRINT
BY BR_CL_IDX NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
BY FLAG NOPRINT
BY TTYPE NOPRINT
BY LEVEL1 NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT
ON TABLE COLUMN-TOTAL
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "
 

-GOTO Finishrpt

-TRANFEE

-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&BREAKOPTION
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 


-GOTO Finishrpt


-SBCRPT


SUM 
      XPSNGR_NM AS 'PASSENGER NAME'
      EMP_ID &EMPID
      LEVEL1 &LV1
      LEVEL2 &LV2
      LEVEL3 &LV3
      PROJ_NBR AS 'PROJECT,NUMBER'
      XTRAN_DT AS 'TRANSACTION DATE'
      XFST_DPT AS 'DEPARTURE,DATE'
      RTNDT AS 'RETURN,DATE'
      RPTDT AS 'FEE,REPORT,DATE'
      TTYPE AS 'TRANSACTION, TYPE'
      C_ITIN AS 'ITINERARY'
      TKT_NUM AS 'TICKET NUMBER'
      FAREAMT AS 'CHARGE'

BY XPSNGR_NM NOPRINT
BY EMP_ID NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
BY FLAG NOPRINT
BY TTYPE NOPRINT
BY LEVEL1 NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT
BY PROJ_NBR NOPRINT
ON TABLE COLUMN-TOTAL
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "

-GOTO Finishrpt



-MILLB
 


SUM 
      XPSNGR_NM AS 'PASSENGER NAME'
      EMP_ID &EMPID
      CC_NUM AS 'CREDIT,CARD'
      LEVEL2 AS 'DEPARTMENT'
      LEVEL3 AS 'LOCATION'
      LEVEL4 AS 'PROFIT CENTER'
      XTRAN_DT AS 'TRANSACTION DATE'
      XFST_DPT AS 'DEPARTURE,DATE'
      RTNDT AS 'RETURN,DATE'
      RPTDT AS 'FEE,REPORT,DATE'
      TTYPE AS 'TRANSACTION, TYPE'
      C_ITIN AS 'ITINERARY'
      TKT_NUM AS 'TICKET NUMBER'
      FAREAMT AS 'CHARGE'
BY XPSNGR_NM NOPRINT
BY EMP_ID NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
BY FLAG NOPRINT
BY TTYPE NOPRINT
BY CC_NUM NOPRINT
BY LEVEL1 NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT
ON CC_NUM RECOMPUTE MULTILINES AS 'TOTAL FOR'
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "
 

-GOTO Finishrpt

-BETRN;

SUM   
      XPSNGR_NM AS 'PASSENGER NAME'
      EMP_ID &EMPID
      LEVEL1 &LV1
      LEVEL2 &LV2
      LEVEL3 &LV3
      XTRAN_DT AS 'TRANSACTION DATE'
      XFST_DPT AS 'DEPARTURE,DATE'
      RTNDT AS 'RETURN,DATE'
      RPTDT AS 'FEE,REPORT,DATE'
      TTYPE AS 'TRANSACTION, TYPE'
      C_ITIN AS 'ITINERARY'
      TKT_NUM AS 'TICKET NUMBER'
      FAREAMT AS 'CHARGE'
      
BY CC_NUM NOPRINT
BY XPSNGR_NM NOPRINT
BY EMP_ID NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
BY FLAG NOPRINT
BY TTYPE NOPRINT
BY LEVEL1 NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT
ON CC_NUM SUMMARIZE AS 'TOTAL FOR'
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "

-GOTO Finishrpt

-*******
-AMEREA
-*******
SUM AA_CC     AS 'CREDIT,CARD'
    XPSNGR_NM AS 'PASSENGER NAME'
    EMP_ID    &EMPID_TITLE
    LEVEL1    &LV1_TITLE
    GN_NBR    AS 'GROUP,NUMBER'
    XTRAN_DT  AS 'TRANSACTION,DATE'
    XFST_DPT  AS 'DEPARTURE,DATE'
    RTNDT     AS 'RETURN,DATE'
    RPTDT     AS 'FEE,REPORT,DATE'
    TTYPE     AS 'TRANSACTION, TYPE'
    C_ITIN    AS 'ITINERARY'
    TKT_NUM   AS 'TICKET,NUMBER'
    FAREAMT   AS 'CHARGE'
BY AA_CC NOPRINT
BY XPSNGR_NM NOPRINT
BY EMP_ID NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
BY FLAG NOPRINT
BY TTYPE NOPRINT
BY LEVEL1 NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT
ON AA_CC RECOMPUTE MULTILINES AS 'TOTAL FOR'
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "

-GOTO Finishrpt

-BTC


SUM   XPSNGR_NM AS 'PASSENGER NAME'
      PNR_LOCATOR AS 'PNR'
      XTRAN_DT AS 'TRANSACTION DATE'
      XFST_DPT AS 'DEPARTURE,DATE'
      C_ITIN AS 'ITINERARY'
      TKT_NUM AS 'TICKET NUMBER'
      TKTAMT AS 'FARE'
      AIRFEE_AMT AS 'AIRLINE,PENALTY'
      FEEAMT AS 'FEE'
      SALES_CNT AS 'NEW,SALES'
      EXCH_CNT AS 'EXCHGS,SALES'
      EMCO_CNT AS 'EXCHG,MCOS'
      MCO_CNT AS 'MCOS'
      REFUNDS AS 'REFUNDS'
      VOID_CNT AS 'VOIDS'
      TOTAL_TRAN AS 'CHARGED,TRANSACTIONS'
      XCOMM AS 'COMMISSION'
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
ON TABLE COLUMN-TOTAL



-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "
-GOTO Finishrpt

-CH2M
		
 

SUM 
      XPSNGR_NM AS 'PASSENGER NAME'
      EMP_ID &EMPID
      LEVEL1 &LV1
      XTRAN_DT AS 'TRANSACTION DATE'
      TKT_NUM AS 'TICKET NUMBER'
      DOC_NMBR AS 'EXCHANGED/,OLD TICKET'
      XFST_DPT AS 'DEPARTURE,DATE'
      RTNDT AS 'RETURN,DATE'
      FAREAMT AS 'CHARGE'
      RPTDT AS 'FEE,REPORT,DATE'
      TTYPE AS 'TRANSACTION, TYPE'
      C_ITIN AS 'ITINERARY'

BY XPSNGR_NM NOPRINT
BY EMP_ID NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
BY FLAG NOPRINT
BY TTYPE NOPRINT
BY LEVEL1 NOPRINT

ON TABLE COLUMN-TOTAL
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "



-Finishrpt
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
-*ON TABLE HOLD
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 

ON TABLE SET STYLE *
-INCLUDE &&PASTYD


ENDSTYLE
-*


&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT
