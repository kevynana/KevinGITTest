-* 12/14/13 - ADDED ADV PUR DAYS AND REFUSE CODE PER CLIENT RQ - DEB
-* 12/17/13  - ADDED REFUSAL_DESC PER CLIENT REQ - DEB
-* 6/25/13 - ADDED TRIP_PURPOSE PER CLIENT REQ - CA
-* 02/24/2017 - DLV - S-22486 CHANGED ettek Review to Post-trip Reporting

-INCLUDE SETECHO

SET ASNAMES = ON;

 

-SET &&RPTSUF = 'SMY';
-SET &FMM=EDIT(&&FROMDT,'$$$$$99$');
-SET &FMD=EDIT(&&FROMDT,'$$$$$$$$99$');
-SET &FMY=EDIT(&&FROMDT,'9999$');
-SET &TOM=EDIT(&&TODT,'$$$$$99$');
-SET &TOD=EDIT(&&TODT,'$$$$$$$$99$');
-SET &TOY=EDIT(&&TODT,'9999$');
 
-SET &&SP = '|';
-SET &&SP1A = IF &&ROLLNME EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP1 = IF &&ROLLCS EQ ' ' THEN ' ' ELSE &&SP1A;
-SET &&SP3 = IF &&ROLLCNCT EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP4 = IF &&ROLLPHN EQ ' ' THEN ' ' ELSE &&SP;
-SET &&RCNCT = &&ROLLCNCT.LENGTH;
-SET &&CSL = &&ROLLCS.LENGTH;
-SET &&CSLPA = IF &&RCNCT.EVAL GE 10 OR &&CSL.EVAL GE 10 THEN 60 ELSE 68;
-SET &&CSLP = IF '&&ROLLUP.EVAL' EQ 'BOOZ-R' THEN 78 ELSE &&CSLPA;
-SET &&ROLLCS11 = TRUNCATE(&&ROLLCS);
-SET &&RCNCT1 = TRUNCATE(&&ROLLCNCT);
-SET &&BLANK = ' ';
-RUN

-INCLUDE FDEFRPTS
-RUN


-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'CBAIRFNL.FOC';
-SET &HNKB=&HLDPATH || 'CBCARFNL.FOC';
-SET &HNKC=&HLDPATH || 'CBHTLFNL.FOC';
 
-RUN


-SET &FILENAME = 'CBAIRFNL'; 
-RUN

-DOS STATE &HNKA
-SET &HOLDFILEA = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKB
-SET &HOLDFILEB = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKC
-SET &HOLDFILEC = IF &RETCODE.EVAL EQ 0 THEN &HNKC | ' AS ' | &FILENAME ELSE ' ';

 

USE ADD 
&HOLDFILEA
&HOLDFILEB
&HOLDFILEC
 END

 



TABLE FILE CBAIRFNL
PRINT 
 BLANK  
 BR_CL_IDX  
 C_ITIN  
 FARE_PAID 
 FNL_DEST_AIRPORT  
 IFLAG  
 INT_CODE  
 INVOICE_NUM  
 LEVEL_DESC 
 LEVEL1  
 LEVEL2  
 LEVEL3  
 LEVEL4    
 ORG_APC 
 REFUSE_CODE
 REFUSAL_DESC
 RTN_DT  
 TKT_DATE  
 TKT_TYPE 
 TRAN_MY  
 TRAN_TYPE  
 TRP_LEN
 TRIP_PURPOSE
 VALAL_NM
 XFST_DPT 
 PADV
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY FLAG
BY TKT_NUM 
BY TRAN_TYPE
BY TRN_DATE  
ON TABLE HOLD AS FINALHLD
END
-RUN

DEFINE FILE FINALHLD
AIR_AMT/D12.2C = IF FLAG EQ 'X' THEN FARE_PAID ELSE 0;
CAR_AMT/D12.2C  = IF FLAG EQ 'C' THEN FARE_PAID ELSE 0;
HTL_AMT/D12.2C  = IF FLAG EQ 'H' THEN FARE_PAID ELSE 0;
HTL_DAYS/D8C  = IF FLAG EQ 'H' THEN TRP_LEN ELSE 0;
CAR_DAYS/D8C  = IF FLAG EQ 'C' THEN TRP_LEN ELSE 0;
ATRP_LEN/D8CS = IF FLAG EQ 'X' THEN TRP_LEN ELSE 0;
BLANK20/A20 = ' ';
AORG_APC/A3 = IF FLAG EQ 'X' THEN ORG_APC ELSE ' ';
ADST_APC/A3 = IF FLAG EQ 'X' THEN FNL_DEST_AIRPORT ELSE ' ';
TKTYPE/A13 = IF FLAG EQ 'X' THEN TRAN_TYPE ELSE 'BLANK';
AIRLINE/A12 = IF FLAG EQ 'X' THEN VALAL_NM ELSE 'UNDEFINED';
ND_FLAG/A1 = IF TKT_NUM EQ ' ' AND AIR_AMT EQ 0 AND CAR_AMT EQ 0 AND HTL_AMT EQ 0 THEN 'Y' ELSE 'N';
TRANMO/MT = TRAN_MY;
TRANYR/YY = TRAN_MY;
RSN_AIR/A2 = IF FLAG EQ 'X' THEN REFUSE_CODE ELSE ' ';
RSN_HTL/A2 = IF FLAG EQ 'H' THEN REFUSE_CODE ELSE ' ';
AIR_RSN_DSC/A40 = IF FLAG EQ 'X' THEN REFUSAL_DESC ELSE ' ';
HTL_RSN_DSC/A40 = IF FLAG EQ 'H' THEN REFUSAL_DESC ELSE ' ';
ADVP/P8 = IF FLAG EQ 'X' THEN PADV ELSE 0;
END
 
TABLE FILE FINALHLD
   SUM TRANMO TRANYR    
   TRAN_MY
    PASSNGR_NAME
    INT_CODE
    LEVEL3
    LEVEL2
    LEVEL1
    IFLAG
    BR_CL_IDX
    PNR_LOCATOR
    TKT_DATE
    INVOICE_NUM
    TKT_NUM
    XFST_DPT
    RTN_DT
    ORG_APC
    FNL_DEST_AIRPORT
    C_ITIN
    AIRLINE
    LEVEL4
    BLANK20
    BLANK20
    BLANK20
    TKTYPE
    AIR_AMT
    HTL_AMT
    HTL_DAYS
    CAR_AMT
    CAR_DAYS
    ATRP_LEN
    TRIP_PURPOSE
    RSN_AIR
    RSN_HTL
    ADVP
    AIR_RSN_DSC
    HTL_RSN_DSC
BY TRAN_MY NOPRINT
BY PASSNGR_NAME NOPRINT
BY PNR_LOCATOR NOPRINT
BY TKT_DATE NOPRINT
BY INVOICE_NUM NOPRINT
BY TKTYPE NOPRINT
BY TKT_NUM NOPRINT
 WHERE ND_FLAG NE 'Y'
ON TABLE HOLD AS FINALHLD1
END
-RUN



 


DEFINE FILE FINALHLD1
NTRP_LEN/D8 = IF AIR_AMT EQ 0 AND HTL_AMT NE 0 AND CAR_AMT NE 0 THEN 1 ELSE 
              IF AIR_AMT EQ 0 AND HTL_AMT EQ 0 AND CAR_AMT NE 0 THEN 1 ELSE
              IF AIR_AMT EQ 0 AND HTL_AMT NE 0 AND CAR_AMT EQ 0 THEN 1 ELSE ATRP_LEN;
END
TABLE FILE FINALHLD1
SUM TRAN_MY
    PASSNGR_NAME
    INT_CODE
    LEVEL3
    LEVEL2
    LEVEL1
    IFLAG
    BR_CL_IDX
    PNR_LOCATOR
    TKT_DATE
    INVOICE_NUM
    TKT_NUM
    XFST_DPT
    RTN_DT
    ORG_APC
    FNL_DEST_AIRPORT
    C_ITIN
    AIRLINE
    LEVEL4
    BLANK20
    BLANK20
    BLANK20
    TKTYPE
    AIR_AMT
    HTL_AMT/D12
    HTL_DAYS
    CAR_AMT/D12
    CAR_DAYS
    NTRP_LEN
    RSN_AIR
    RSN_HTL   
    TRIP_PURPOSE
    ADVP
    AIR_RSN_DSC
    HTL_RSN_DSC
BY TRAN_MY NOPRINT
BY PASSNGR_NAME NOPRINT
BY PNR_LOCATOR NOPRINT
BY TKT_DATE NOPRINT
BY TKTYPE NOPRINT
BY TKT_NUM NOPRINT
ON TABLE HOLD AS CBFNLHLD 
END
-RUN

DEFINE FILE CBFNLHLD
 
NOWTOD/A8 WITH PASSNGR_NAME = HHMMSS (NOWTOD);
BLANK/A1 = ' ';
END
-RUN

TABLE FILE CBFNLHLD
SUM TRAN_MY AS 'Invoice Month'
    PASSNGR_NAME AS 'Traveler Name'
    INT_CODE AS 'Statement Information'
    LEVEL3 AS 'Customer Defined 01'
    LEVEL2 AS 'Customer Defined 02'
    LEVEL1 AS 'Customer Defined 03'
    IFLAG AS 'Online/Offline'
    BR_CL_IDX AS 'Account No or DK#'
    PNR_LOCATOR AS 'PNR'
    TKT_DATE AS 'Invoice Date'
    INVOICE_NUM AS 'Invoice #'
    TKT_NUM AS 'Ticket #'
    XFST_DPT AS 'Travel Start Date'
    RTN_DT AS 'Travel End Date'	
    ORG_APC AS 'Origin Airport (Predominant)'
    FNL_DEST_AIRPORT AS 'Destination Airport (Predominant)'
    C_ITIN AS 'Itinerary'
    AIRLINE AS 'Carrier (Validating)'
    LEVEL4 AS 'Customer Defined 04'
    TRIP_PURPOSE AS 'Customer Defined 05'
    BLANK20 AS 'Customer Defined 06'
    BLANK20 AS 'Customer Defined 07'
    TKTYPE AS 'Exchange/Refund Code'
    AIR_AMT AS 'Air/Rail Net Ticket Amount - NR'	
    HTL_AMT/D12 AS 'Hotel Amount'
    HTL_DAYS AS 'Hotel Total Room Nights'	
    CAR_AMT/D12 AS 'Car Amount'
    CAR_DAYS AS '# of Car Days'
    NTRP_LEN AS 'Total Days Traveled'	
    ADVP AS 'Adv Purchase Days'
    RSN_AIR AS 'Air Reason Code'
    AIR_RSN_DSC AS 'Air Reason Description'
    RSN_HTL AS 'Hotel Reason Code'
    HTL_RSN_DSC AS 'Hotel Reason Description'

BY TRAN_MY NOPRINT 
BY PASSNGR_NAME NOPRINT
BY PNR_LOCATOR NOPRINT
BY TKT_DATE NOPRINT
BY TKT_NUM NOPRINT
BY TKTYPE NOPRINT
 

-HEAD
HEADING
"&&ROLLNME &&SP1 &&ROLLCS11 &&SP3 &&RCNCT1 &&SP4 &&ROLLPHN"
"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  "
"&&RPT_TTL1"
"&&RPT_TTL2"
" "
 

FOOTING BOTTOM
"Post-trip Reporting &DATE AT <NOWTOD <60 &&FOOTR"
ON TABLE SET PAGE-NUM OFF
ON TABLE NOTOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000, 
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=OFF, 
    ORIENTATION=LANDSCAPE, $
    
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=4, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=4, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=20, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=20, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=6, COLSPAN=4, JUSTIFY=LEFT, $


TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8, 
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$
-JOY
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$
     
TYPE=TITLE, JUSTIFY=LEFT, $     
    
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
     
TYPE=FOOTING, FONT=ARIAL, COLOR=GRAY,$

TYPE=SUBHEAD,
     STYLE=BOLD,
$

TYPE=SUBTOTAL, 
     STYLE=BOLD, 
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
     
TYPE=GRANDTOTAL, STYLE=BOLD, $


    TYPE=REPORT, COLUMN=N7, WRAP=  1.0,$
    TYPE=REPORT, COLUMN=N8, WRAP=  2.5,$
    TYPE=REPORT, COLUMN=N9, WRAP=  1.5,$
    TYPE=REPORT, COLUMN=N10, WRAP=  1.5,$
    TYPE=REPORT, COLUMN=N11, WRAP=  1.5,$
    TYPE=REPORT, COLUMN=N12, WRAP=  1.5,$
    TYPE=REPORT, COLUMN=N13, WRAP=  .85,$
    TYPE=REPORT, COLUMN=N14, WRAP=  .85,$
    TYPE=REPORT, COLUMN=N15, WRAP= .85,$
    TYPE=REPORT, COLUMN=N16, WRAP= .85,$
    TYPE=REPORT, COLUMN=N17, WRAP= .85,$
    TYPE=REPORT, COLUMN=N18, WRAP= .85,$
    TYPE=REPORT, COLUMN=N19, WRAP= 1.10,$
    TYPE=REPORT, COLUMN=N20, WRAP= 1.10,$
    TYPE=REPORT, COLUMN=N21, WRAP= 1.30,$
    TYPE=REPORT, COLUMN=N22, WRAP= 1.30,$
    TYPE=REPORT, COLUMN=N23, WRAP= 2.65,$
    TYPE=REPORT, COLUMN=N24, WRAP= 2.65,$
    TYPE=REPORT, COLUMN=N25, WRAP= 1.5,$
    TYPE=REPORT, COLUMN=N26, WRAP= 1.5,$
    TYPE=REPORT, COLUMN=N27, WRAP= 1.5,$
    TYPE=REPORT, COLUMN=N28, WRAP= 1.5,$
    TYPE=REPORT, COLUMN=N29, WRAP= 1.55,$       
    TYPE=REPORT, COLUMN=N30, WRAP= 2.0,$
    TYPE=REPORT, COLUMN=N31, WRAP= 1.0,$       
    TYPE=REPORT, COLUMN=N32, WRAP= 1.0,$       
    TYPE=REPORT, COLUMN=N33, WRAP= 1.0,$       
    TYPE=REPORT, COLUMN=N34, WRAP= 1.0,$       
    TYPE=REPORT, COLUMN=N35, WRAP= 1.0,$       

ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
-*
END
-RUN





 

 
    