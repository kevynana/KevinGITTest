-*========================================================================
-*         IDENTIFY AND BACKUP FILES FOR HIERARCHY UPDATE PROCESS
-*========================================================================

-INCLUDE SETECHO

-SET &&ROLLUP   = 'METX-R' ;
-SET &&EFF_DATE = '20010122';
-RUN

DEFINE FILE ROLLUP
XL01/A8=GETTOK(ROLLUP,8,1,'-',8,XL01);
END
TABLEF FILE ROLLUP
BY ROLLUP NOPRINT
PRINT XL01
IF ROLLUP EQ &&ROLLUP
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-READ SAVE &&COMP.A8.
-RUN
-SET &&C1  = 'HP'||&&COMP ;
-SET &&C2  = 'HX'||&&COMP ;
-SET &&C3  = 'AH'||&&COMP ;
-SET &&C4  = 'CH'||&&COMP ;
-SET &&C5  = 'HH'||&&COMP ;
-SET &&C6  = &&C1|||'.*';
-SET &&C7  = &&C2|||'.*';
-SET &&C8  = &&C3|||'.*';
-SET &&C9  = &&C4|||'.*';
-SET &&C10 = &&C5|||'.*';
-SET HIER50  = &&C1 ;
-SET XHIER50 = &&C2 ;
-SET AH_50   = &&C3 ;
-SET CH_50   = &&C4 ;
-SET HH_50   = &&C5 ;

-SET &&C11 = 'COPY D:\TNT\TTRACKER\DATA\'||&&C6;
-SET &&C12 = 'COPY D:\TNT\TTRACKER\DATA\'||&&C7;
-SET &&C13 = 'COPY D:\TNT\TTRACKER\DATA\'||&&C8;
-SET &&C14 = 'COPY D:\TNT\TTRACKER\DATA\'||&&C9;
-SET &&C15 = 'COPY D:\TNT\TTRACKER\DATA\'||&&C10;
-RUN

&&C11 D:\LOADBACK
&&C12 D:\LOADBACK
&&C13 D:\LOADBACK
&&C14 D:\LOADBACK
&&C15 D:\LOADBACK
-RUN
-*========================================================================
-*         IDENTIFY AND BACKUP FILES FOR HIERARCHY UPDATE PROCESS
-*========================================================================
-SET &&USE_HP = &&C1|||.FOC ;
-SET &&USE_HX = &&C2|||.FOC ;
-SET &&USE_AH = &&C3|||.FOC ;
-SET &&USE_CH = &&C4|||.FOC ;
-SET &&USE_HH = &&C5|||.FOC ;
-SET &&USE_TSEG = 'D:\TNT\TTRACKER\DATA\TMPSEG.FOC'  ;
-SET &&USE_TCAR = 'D:\TNT\TTRACKER\DATA\TMPCAR.FOC'  ;
-SET &&USE_THTL = 'D:\TNT\TTRACKER\DATA\TMPHTL.FOC'  ;
-SET &&USE_MAP  = 'D:\TNT\TTRACKER\DATA\HIERMAP.FOC' ;
-SET &&USE_ROLL = 'D:\TNT\TTRACKER\SUDATA\ROLLUP.FOC' ;
-SET &&TTFILE = 'D:\AS400\'||'TT'||&&COMP|||.DAT;

FILEDEF TTDATA DISK &&TTFILE

DEFINE FILE TTDATA
XL01/YYMD = &&EFF_DATE;
END
TABLE FILE TTDATA
PRINT LEVEL_CODE LEVEL_DESC LEVEL_BOSS XL01
ON TABLE SAVE
END

CREATE FILE HIERMAP

MODIFY FILE HIERMAP
FIXFORM LEVEL_CODE/A15 LEVEL_DESC/A30 LEVEL_BOSS/A15 EDATE/A8YYMD
MATCH LEVEL_CODE
  ON MATCH REJECT
  ON NOMATCH INCLUDE
DATA ON SAVE
END
-EXIT
-RUN

EX XX50LOAD
-EXIT
-RUN

-TYPE Starting HP50OLD
EX XX50OLD

-RUN

-TYPE Starting BLDKEY50
EX XXXKEY50

-RUN

-TYPE Starting H50_TAG
EX XX50_TAG
-EXIT
-RUN

-GUIU50

-RUN

-TYPE Starting Temp Seg Build
EX TSEGBLD
-RUN

-TYPE Starting AIRTAG50
EX AIRTAG50
-RUN

-TYPE Starting Temp Car Build
EX TCARBLD
-RUN

-TYPE Starting CARTAG50
EX CARTAG50
-RUN

-TYPE Starting Temp Htl Build
EX THTLBLD
-RUN

-TYPE Starting HTLTAG50
EX HTLTAG50
-RUN

-* Copy updated files back to the Server
-SET &COPY3 = &&TEMP_PATH || 'COPY3.BAT';
FILEDEF COPY3 DISK &COPY3
-RUN
-WRITE COPY3 COPY &CPYT_AH.EVAL &CPYF_AH.EVAL
-WRITE COPY3 COPY &CPYT_CH.EVAL &CPYF_CH.EVAL
-WRITE COPY3 COPY &CPYT_HH.EVAL &CPYF_HH.EVAL
-WRITE COPY3 COPY &CPYT_HP.EVAL &CPYF_HP.EVAL
-WRITE COPY3 COPY &CPYT_HX.EVAL &CPYF_HX.EVAL
-RUN
-* Execute the DOS Bat file to copy the files
DOS COPY3.BAT
-RUN

-EXIT

-RUN

-DELF50

-EXIT
