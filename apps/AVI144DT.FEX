-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-*                     FOCEXEC: AIRRPT
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*6/2/98         JK                 INCLUDE AIRLEVM INSTEAD OF AIRLEVT
-*7/31/00     IBISTL-KR             ADDED DEFINE FOR NOWTOD WHICH IS
-*                                  USED IN FOOTERDT
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*2/05/01      TANDT-SS             ADD BASE_FARE, DEPT_MONTH
-*
-*6/26/01      TANDT-JK             ADDED A DEFINE FOR AMILES FOR THE
-*                                  COST PER MILE COMPUTE IN SETFILES
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-* 4/8/14    DEB                ADDED LONHI TO NOEXL ROUTINE
-*4/16/14    DEB                 ADDED NOHTL_RSN DEFINE
-*11/4/14    JOY                UPDATED NORECORDS LOGIC FOR ABCDNH DUE TO ERRORS
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*5/21/2015 DEB - S-09179   - Corrected POTENTIAL AIR TKT HTL NGTS FOOTER =
-*  10/30/2015  REJ  S-12492 Added special code for AVIW56 because the parameters in the subfoot
-*                           were not always showing correctly.  This stream is written a little
-*                           different where the Hotel extract is really happening in the Summary
-*                           and Detail report focexecs.
-*12/09/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*11/21/2016 RSB - S-23625 Create new standard hotel attachment report - Summary by Ticket
-*                          Created new report section: -ABHTLTKTD
**************************************************************************
SET ASNAMES=ON
-RUN
 
-INCLUDE SETECHO
-IF '&&SETF.EVAL' EQ 'ABHTLRSB' THEN GOTO SKIP_HOTELD;
-* 
-INCLUDE NOHTLDT
-RUN
-*
-***********
-SKIP_HOTELD
-*********** 
-IF &&FROMAVRP NE 'Y' GOTO :AVSFS1;
-INCLUDE AVRP_SUBFOOT
-:AVSFS1
 
-IF &&SETF NE 'ABCDNH' GOTO NONORECCHK;
 
-IF '&&NOHDTREC.EVAL' EQ 'Y' THEN GOTO NORECORDS;
 
-NONORECCHK;
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HDRNOHD' ELSE 'HDREXACH';
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN
-*
-IF '&&SETF.EVAL' EQ 'ABHTLRSB' THEN GOTO ABHTLTKTD;
-* 
 
DEFINE FILE HRPTHOLD
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
NOHTL_RSN/A40 = IF NHDESC EQ ' ' THEN 'NONE GIVEN' ELSE NHDESC;
-* NOHTL_RSN/A10 = IF NOHTL_KEY EQ ' ' THEN 'NONE GIVEN' ELSE NOHTL_KEY;
 
XTS_FLAG/A1 = ' ';
END
 
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
 
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-*-SET &&DRILLRPT = '&&RPT_HOLD';
-SET &&DRILLRPT = 'HRPTHOLD';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL
 
TABLE FILE HRPTHOLD
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
 
-IF '&&SETF.EVAL' NE 'PRNHD' OR 'LONHI' GOTO NOEXL;
-* WHERE NOHOTEL NE 0
-NOEXL;
-*********************************************************************
-*DATE           NAME               DESCRIPTION
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
 
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&BREAKOPTION
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
FOOTING BOTTOM
-IF '&&SETF.EVAL' EQ 'BZNYCP' OR 'BZNNYCP' OR 'BZCTP' GOTO SKIPFT;
" "
" "
"AIR TKT HTL NGTS NOT BKD = AIR TKT STAY - AIR TKT HTL NGTS BKD"
"AIR TKT HTL NGTS + NON-AIR TKT HTL NGTS = TTL HTL NGTS ON TRAVEL SUMMARY"
"POTENTIAL AIR TKT HTL NGTS = AIR TKT HTL NGTS BKD + AIR TKT HTL NGTS NOT BKD"
-SKIPFT;
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
 
-GOTO XXIT;
 

-*********** 
-ABHTLTKTD
-*********** 
-*
DEFINE FILE AIRHLDH
 NOWTOD     /A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
 HTL_FLG    /A1 = IF NET_TKT_CNT GT 0 THEN HOTEL_FLAG ELSE ' ';
 NOHTL_TXT  /A40= IF HTL_FLG EQ 'N' THEN NOHTL_KEY ELSE ' ';
 HCNT       /I9S= IF HTL_FLG EQ 'Y' THEN 1 ELSE 0;
 HNCNT      /I9S= IF HTL_FLG EQ 'N' THEN 1 ELSE 0;
-*
-* Defines to fix display problem when there is only a single row in the report and the format is Excel
 MDYY_DPT_DPT/MDYY  = XDPT_DT;
 A8DPT_DPT   /A8MDYY= MDYY_DPT_DPT; 
 XDPT_DTA    /A10   = IF A8DPT_DPT NE ' ' THEN EDIT(A8DPT_DPT,'99/99/9999') ELSE ' ';
 MDYY_TRN_TRN/MDYY  = XTRAN_DT;
 A8TRN_TRN   /A8MDYY= MDYY_TRN_TRN; 
 XTRN_DTA    /A10   = IF A8TRN_TRN NE ' ' THEN EDIT(A8TRN_TRN,'99/99/9999') ELSE ' ';
-*
-INCLUDE STDTIME
END

-SET &&PAHDR  = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-* 
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;

-* Uncomment to change report title
-*-SET &&RPT_TTL1 = '                               ';
-* 
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-*-SET &&DRILLRPT = '&&RPT_HOLD';
-SET &&DRILLRPT = 'AIRHLD';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL
 
TABLE FILE AIRHLDH
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-*******
-NOSPC;
-*******
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
 
-*********************************************************************
-*DATE           NAME               DESCRIPTION
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-********* 
-SKIP_WHR
-*********
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&BREAKOPTION
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10

-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
FOOTING BOTTOM
" "
" "
"Hotel Attachment determined by looking at dates of airlines tickets and comparing it with any hotel booked during that date range."
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE * 
-INCLUDE &&PASTYD
TYPE=DATA,
     COLUMN=NCHT_TOT,
     COLOR=WHITE,
$
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT; 
 
-NORECORDS
-SET &&RPTSUF = 'MSG';
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
 
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HDRNOH
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERNR
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
 
-XXIT
