-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT

-INCLUDE SETECHO
SET ASNAMES = ON

-TYPE '&&ROLL.EVAL'

-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED
-*========================================================================
-SET &&EXTRACT = 'CR_50';

-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

DEFINE FILE &&EXTRACT
CBOOK/P8 = IF DAILY_RATE GE 0 THEN 1 ELSE (-1);
END

TABLEF FILE &&EXTRACT
PRINT
 CBOOK
 AGENT_NUM
 TKT_NUM
-INCLUDE &CARDATES
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
WHERE TKT_NUM EQ '0000000000'
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCCH1
END
-RUN


-IF &LINES EQ 0 THEN GOTO NEXTONE;


-*========================================================================
-*   PROCESS EXTRACTED DATA FROM ABOVE
-*========================================================================
DEFINE FILE TCCH1
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCCH1
SUM CBOOK
BY ROLLCD
BY TKT_NUM
BY AGENT_NUM
ON TABLE HOLD AS TCCH2
END
-RUN

TABLE FILE TCCH2
PRINT AGENT_NUM CBOOK
BY ROLLCD
BY TKT_NUM
ON TABLE HOLD AS TCCH3
END
-RUN



MODIFY FILE TC_NCC
LOG DUPL MSG OFF
FIXFORM FROM TCCH3
MATCH ROLLCD TKT_NUM
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON TCCH3
END
-RUN


-NEXTONE;