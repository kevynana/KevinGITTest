-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* ADDED TRANTYPE INCLUDE - JK 12/18/14 STORY ID S-06492

-INCLUDE SETECHO

-DEFAULT &&MFLAG ='XXX';
-DEFAULT &&FIELD = 'XX';
-* -DEFAULT &&LVL_DSC = 'AROLL_DSC1';
-DEFAULT &&LSEL = 'XX';
-DEFAULT &&SETF = 'XX';
-DEFAULT &&FDATE = ' ';
-DEFAULT &&TDATE = ' ';
-DEFAULT &&ALN_KEY = ' ';
-DEFAULT &&CHG_CAT = ' ';
-DEFAULT &&EMP_LVL = ' ';


-SET &&FIELD = &ROW_LABEL;
-* -SET &&LVL_DSC =  '&LSEL.EVAL';
-SET &&LSEL = &LSEL;
-SET &&ALN_KEY = &ALN_KEY;
-SET &&CHG_CAT = &CHG_CAT;
-SET &&EMP_LVL = &EMP_LVL;
-* -SET &&LVL_DSC = &LSEL;
-SET &&FLAG = &PARM1;
-SET &&FDATE = &FDATE;
-SET &&TDATE = &TDATE;
-SET &FMM=EDIT(&&FDATE,'$$$$$99');
-SET &FMD=EDIT(&&FDATE,'$$$$$$$$99');
-SET &FMY=EDIT(&&FDATE,'9999');
-SET &TOM=EDIT(&&TDATE,'$$$$$99');
-SET &TOD=EDIT(&&TDATE,'$$$$$$$$99');
-SET &TOY=EDIT(&&TDATE,'9999');


-**********************************************************************
-* EX RPTRESET TO RESET PARAMS
-**********************************************************************
-SET &&ROLLUP = &ROLUP;
-* -SET &&UNAME = &UID;
-SET &&UNAME = &user;
-**** the following two lines added 10/31/2003 ****
-DEFAULT &FPARM = ' ';
-SET &&FIPARM = &FPARM;
-SET &&DRILLED_RUN = 'Y';

EX RPTRESET
-RUN
EX RESET
-RUN

-**********************************************************************
-* CHECK FOR PRESENCE OF ORIGINAL SET FILE
-*********************************************************************
-*****  USE VALUE PASSED AS &SETFNM TO DETERMINE FILE NAME
-IF &&DEPLOY EQ 'W' GOTO SETWEB;
-SET &&LOCPATH = '&&DATASRV.EVAL' || '\TT\ '|| &&ROLLUP || '\ '||&&UNAME.EVAL||'\';
-SET &FILEXIST = &&LOCPATH || &SETFNM || '.FTM';
-GOTO CHKFILE;

-SETWEB
-SET &&WEBPATH = '&&WEBSRV.EVAL' || '\TTWEB\ ' || &&ROLLUP || '\ '||&&UNAME.EVAL||'\';
-SET &FILEXIST = &&WEBPATH || &SETFNM || '.FTM';

-GOTO CONT;

-CHKFILE
STATE &FILEXIST
-RUN
-IF &RETCODE NE 0 GOTO NOFILE;
-GOTO CONT;

-*
-*
-**********************************************************************
-*
-**********************************************************************
-CONT

-SET &TMPDRIL = &&WEB_PATH || 'TEMPDRIL.FEX' ;
COPY &FILEXIST &TMPDRIL
-SET &&SETF='TEMPDRIL';
-RUN

EX SETDBLS SETFILE=&&SETF
-RUN
-INCLUDE GetForDrillDown
-RUN

-SET &&OUTLINE1 = 'ON TABLE SET ONLINE-FMT';
-SET &&OUTLINE2 = IF &&OUTLINE2 CONTAINS 'PDF' THEN 'PDF' ELSE
-          IF &&OUTLINE2 CONTAINS 'EXCEL' THEN 'EXCEL' ELSE
-          IF &&OUTLINE2 CONTAINS 'EXL2K' THEN 'EXL2K' ELSE 'PDF';   

-SET &LCHK= ' ';


-****
-* &&FLAG WILL EQUAL ONE OF THE FOLLOWING: 
-* 0, F, B, C, D, U
-****
-* &&FIELD WILL EQUAL ONE OF THE FIELD NAMES WITHIN THE REPORT
-****
-SET &&DEPARTD = 'XDPT_DT AS DPT,DTE';
-SET &&DEPARTT = 'DPT_TIME AS TIME';
-SET &&NTCOUNT = 'NET_TKT_CNT AS NET,TKT,CNT';
-SET &&TICOUNT = 'TTKT_ISS AS TKT,ISS';
-SET &&LSTSVGS = 'LOST_TOT AS LOST,SVGS';
-SET &&LSAVECHK = ' ';
-SET &&DISCOUNT = ' ';
-SET &&DICHK = ' ';
-SET &&LOWEST = ' ';
-SET &&ATP = 'COMPUTE ATP/D12.2CS = IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE FARE_AMT/NET_TKT_CNT; AS AVG,TKT,PRICE';

-IF &&CHG_CAT EQ ' ' GOTO NOCC;
-SET &&CC = 'WHERE CHG_CAT EQ ''&&CHG_CAT.EVAL''';
-GOTO NXEL;
-NOCC
-SET &&CC = ' ';
-NXEL;
-IF &&EMP_LVL EQ ' ' GOTO NOEL;
-SET &&EL = 'WHERE AROLL_DSC6 EQ ''&&EMP_LVL.EVAL''';
-GOTO ARCK;
-NOEL
-SET &&EL = ' ';

-ARCK
-IF &&ALN_KEY EQ 'Air' THEN GOTO AIR ELSE GOTO RAIL;

-AIR;
-SET &&ARCHK = 'WHERE ALN_KEY EQ ''Air''';
-GOTO NXCK;

-RAIL
-SET &&ARCHK = 'WHERE ALN_KEY EQ ''Rail''';
-GOTO NXCK;


-NXCK;
-IF &&FLAG EQ 'F' THEN GOTO FCLASS
-  ELSE IF &&FLAG EQ 'B' THEN GOTO BUSINESS
-  ELSE IF &&FLAG EQ 'P' THEN GOTO PECONOMY
-  ELSE IF &&FLAG EQ 'E' THEN GOTO ECONOMY
-  ELSE IF &&FLAG EQ 'U' THEN GOTO UP 
-  ELSE IF &&FLAG EQ 'D' THEN GOTO DEFAULT ELSE GOTO ALL;


-FCLASS
-SET &&CHK='WHERE CAT EQ ''FIRST''';
-SET &&SUBHEAD = 'First';
-GOTO ENDCAT

-BUSINESS
-SET &&CHK='WHERE CAT EQ ''BUSINESS''';
-SET &&SUBHEAD = 'Business';
-GOTO ENDCAT

-PECONOMY
-SET &&CHK='WHERE CAT EQ ''PREMIUM ECONOMY''';
-SET &&SUBHEAD = 'Premium Economy';
-GOTO ENDCAT

-ECONOMY
-SET &&CHK='WHERE CAT EQ ''ECONOMY''';
-SET &&SUBHEAD = 'Economy';
-GOTO ENDCAT

-UP
-SET &&CHK='WHERE CAT EQ ''UPGRADE''';
-SET &&SUBHEAD = 'Upgrade';
-GOTO ENDCAT

-DEFAULT
-SET &&CHK='WHERE CAT EQ ''DEFAULT''';
-SET &&SUBHEAD = 'Default';
-GOTO ENDCAT

-ALL
-SET &&CHK=' ';
-SET &&SUBHEAD = ' ';
-GOTO ENDCAT


-ENDCAT

 
-FIELDS
-IF &&FIELD EQ 'NOCAT' THEN GOTO NOCAT ELSE
-IF &&FIELD EQ '< 4 HOURS'  THEN GOTO UNDER4 ELSE GOTO OVER8;
-* -IF &&FIELD EQ '4 - 6 HOURS' THEN GOTO 4TO6 ELSE
-* -IF &&FIELD EQ '6 - 8 HOURS' THEN GOTO 6TO8 ELSE GOTO OVER8;
-* -

-* -GOTO OUTSIDE

-UNDER4
-SET &&RPT_TTL1 = '                     LESS THAN 4 HOURS DETAIL     ';
-SET &&FDCHK = 'WHERE FLT_LEN EQ ''< 4 HOURS'' ';
-SET &&LSTSVGS= ' ';
-SET &&FAREAMT = 'FARE_AMT AS FARE,PAID';
-SET &&ONLCHK = ' ';
-GOTO OUTSIDE

-OVER8
-SET &&RPT_TTL1 = '                  OVER 4 HOURS DETAIL  ';
-SET &&FDCHK = 'WHERE FLT_LEN EQ ''> 4 HOURS'' ';
-SET &&LSTSVGS= ' ';
-SET &&FAREAMT = 'FARE_AMT AS FARE,PAID';
-GOTO OUTSIDE

-NOCAT
-SET &&RPT_TTL1 = '                FLIGHT DURATION DETAIL  ';
-SET &&FDCHK = ' ';
-SET &&LSTSVGS= ' ';
-SET &&FAREAMT = 'FARE_AMT AS FARE,PAID';
-GOTO OUTSIDE




-OUTSIDE


TABLE FILE BRPTINST
BY HIGHEST BREAK_LEVELS
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE
END
-RUN


-READ SAVE &LEVEL.2.

-SET &AROLL_DSC = IF &LEVEL GT '10' THEN 'AROLL_DSC' | &LEVEL ELSE 'AROLL_DSC' | EDIT(&LEVEL,'$9');
-SET &LCHK='WHERE ' | &AROLL_DSC.EVAL | ' CONTAINS ' | '''&&LSEL.EVAL''';



FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN

-*****************************************************************
-*DATE           NAME                 DESCRIPTION OF CHANGE
-*9/13/00      IBISTL-KR              Drill Down functionality
-*****************************************************************
-SET &&RPTTYP = ' ';

EX TS_JAMS
-RUN
-INCLUDE SELCATQT
-RUN

EX &&CATQTRPR
-RUN

FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN

-SET &&SMD = 'S';

EX AIRUSE
-RUN

-SET &&RPTGRP = 'AIR';
EX UDIDGEN
-RUN

-TYPE Before Extract
SET ASNAMES = ON 
-SET HOLDATTR = ON;
-RUN

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';



DEFINE FILE SR_50
  ALN_KEY/A4 = IF AIRLINE EQ '2V' THEN 'Rail' ELSE 'Air';
 
  CHG_CD/A1 = EDIT(LEVEL1, '9');
  CHG_CAT/A10 = IF CHG_CD EQ 'B' THEN 'B' ELSE
                IF CHG_CD EQ 'G' THEN 'G' ELSE
               IF CHG_CD EQ 'M' THEN 'M' ELSE 'NON-BMG'; 
               
                
  CLS_CAT/A1 = IF TKT_CL_CAT EQ 'F' THEN 'F' ELSE
               IF TKT_CL_CAT EQ 'U' THEN 'U' ELSE
               IF TKT_CL_CAT EQ 'B' THEN 'B' ELSE
               IF TKT_CL_CAT EQ 'P' THEN 'P' ELSE
               IF TKT_CL_CAT EQ 'E' THEN 'E' ELSE 'D';             

  LEVEL_DESC/A60 = &&LDESC;

  FARE_PAID/D11.2CS   = SEG_AMT + SEG_TAX;
  NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  REF_EXCH_CNT/D8CS   = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 0 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN 1 ELSE 0;
  SAVINGS/D11.2CS     = SEG_STANDARD - FARE_PAID;
  TKT_PURCH/D8CS      = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 0;
  TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                          (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
  TRP_LEN/D9CS        = TRIP_LENGTH * SEG_COUNT;
  VASAVINGS/D11.2CS   = SEG_DISCOUNT - FARE_PAID;
  XARR_DOW/W           = ARR_DATE;
  XARR_DT/MDYY         = ARR_DATE;
  XDPT_DT/MDYY         = DPT_DATE;
  XPSNGR_NM/A15        = 
  EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  XTRAN_DT/MDYY        = TRN_DATE;
-* ****DEFINES ON PREVIOUS DEFINES****
  CAT/A15 = DECODE CLS_CAT ('F' 'FIRST'     'P' 'PREMIUM ECONOMY'   
    			    'D' 'DEFAULT'   'B' 'BUSINESS'
    			    'E' 'ECONOMY'   'U'  'UPGRADE' 
                            ' ' 'DEFAULT'); 
    
  DISSAVINGS/D11.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
  FLT_LEN1A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 1, '-', 5, FLT_LEN1A);
  FLT_LEN2A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 2, '-', 5, FLT_LEN2A);
  FLT_LEN3A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 3, '-', 5, FLT_LEN3A);
  FLT_LEN4A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 4, '-', 5, FLT_LEN4A);
  FLT_LEN5A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 5, '-', 5, FLT_LEN5A);
  FLT_LEN6A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 6, '-', 5, FLT_LEN6A);
  FLT_LEN7A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 7, '-', 5, FLT_LEN7A);
  FLT_LEN8A/A5 = GETTOK(FLIGHT_DURATIONS, 72 , 8, '-', 5, FLT_LEN8A);
  FLEN1D/D9.2 = ATODBL(FLT_LEN1A,  '5', FLEN1D);
  FLEN2D/D9.2 = ATODBL(FLT_LEN2A,  '5', FLEN2D);
  FLEN3D/D9.2 = ATODBL(FLT_LEN3A,  '5', FLEN3D);
  FLEN4D/D9.2 = ATODBL(FLT_LEN4A,  '5', FLEN4D);
  FLEN5D/D9.2 = ATODBL(FLT_LEN5A,  '5', FLEN5D);
  FLEN6D/D9.2 = ATODBL(FLT_LEN6A,  '5', FLEN6D);
  FLEN7D/D9.2 = ATODBL(FLT_LEN7A,  '5', FLEN7D);
  FLEN8D/D9.2 = ATODBL(FLT_LEN8A,  '5', FLEN8D);
  FLT_LEN1/D5 = FLEN1D;
  FLT_LEN2/D5 = FLEN2D;
  FLT_LEN3/D5 = FLEN3D;
  FLT_LEN4/D5 = FLEN4D;
  FLT_LEN5/D5 = FLEN5D;
  FLT_LEN6/D5 = FLEN6D;
  FLT_LEN7/D5 = FLEN7D;
  FLT_LEN8/D5 = FLEN8D;
MAX_FLT/D5 = IF FLT_LEN1 GE FLT_LEN2 AND FLT_LEN1 GE FLT_LEN3 AND FLT_LEN1 GE FLT_LEN4 AND FLT_LEN1 GE FLT_LEN5 AND FLT_LEN1 GE FLT_LEN6 AND
   FLT_LEN1 GE FLT_LEN7 AND FLT_LEN1 GE FLT_LEN8 THEN FLT_LEN1 ELSE
 IF FLT_LEN2 GE FLT_LEN1 AND FLT_LEN2 GE FLT_LEN3 AND FLT_LEN2 GE FLT_LEN4 AND FLT_LEN2 GE FLT_LEN5 AND FLT_LEN2 GE FLT_LEN6 AND
   FLT_LEN2 GE FLT_LEN7 AND FLT_LEN2 GE FLT_LEN8 THEN FLT_LEN2 ELSE   
 IF FLT_LEN3 GE FLT_LEN1 AND FLT_LEN3 GE FLT_LEN2 AND FLT_LEN3 GE FLT_LEN4 AND FLT_LEN3 GE FLT_LEN5 AND FLT_LEN3 GE FLT_LEN6 AND
   FLT_LEN3 GE FLT_LEN7 AND FLT_LEN3 GE FLT_LEN8 THEN FLT_LEN3 ELSE   
 IF FLT_LEN4 GE FLT_LEN1 AND FLT_LEN4 GE FLT_LEN2 AND FLT_LEN4 GE FLT_LEN3 AND FLT_LEN4 GE FLT_LEN5 AND FLT_LEN4 GE FLT_LEN6 AND
   FLT_LEN4 GE FLT_LEN7 AND FLT_LEN4 GE FLT_LEN8 THEN FLT_LEN4 ELSE        
IF FLT_LEN5 GE FLT_LEN1 AND FLT_LEN5 GE FLT_LEN2 AND FLT_LEN5 GE FLT_LEN3 AND FLT_LEN5 GE FLT_LEN4 AND FLT_LEN5 GE FLT_LEN6 AND
   FLT_LEN5 GE FLT_LEN7 AND FLT_LEN5 GE FLT_LEN8 THEN FLT_LEN5 ELSE    
IF FLT_LEN6 GE FLT_LEN1 AND FLT_LEN6 GE FLT_LEN2 AND FLT_LEN6 GE FLT_LEN3 AND FLT_LEN6 GE FLT_LEN4 AND FLT_LEN6 GE FLT_LEN6 AND
   FLT_LEN6 GE FLT_LEN7 AND FLT_LEN6 GE FLT_LEN8 THEN FLT_LEN6 ELSE   
IF FLT_LEN7 GE FLT_LEN1 AND FLT_LEN7 GE FLT_LEN2 AND FLT_LEN7 GE FLT_LEN3 AND FLT_LEN7 GE FLT_LEN4 AND FLT_LEN7 GE FLT_LEN7 AND
   FLT_LEN7 GE FLT_LEN6 AND FLT_LEN7 GE FLT_LEN8 THEN FLT_LEN7 ELSE FLT_LEN8;   
-*DEFINES ON PREVIOUS DEFINES

FLT_LEN/A16 = IF MAX_FLT LT 239 THEN '< 4 HOURS' ELSE '> 4 HOURS';  
  
KEY/A1 = IF FLT_LEN EQ '< 4 HOURS' THEN 'A' ELSE 'B';

KEY1/A1 = IF CLS_CAT EQ 'F' THEN 'A' ELSE
          IF CLS_CAT EQ 'B' THEN 'B' ELSE
          IF CLS_CAT EQ 'U' THEN 'C' ELSE
          IF CLS_CAT EQ 'P' THEN 'D' ELSE 
          IF CLS_CAT EQ 'E' THEN 'E' ELSE 'F';   

-INCLUDE TRANTYPE

END
-RUN

 

TABLEF FILE SR_50
-* Report column elements
  PRINT ALN_KEY 
        AROLL_DSC6
        ARR_TIME
        AIR_MAIN.INTL_DOM	
        AIRLINE	
        CAT
        CHG_CAT
        CITYPAIR.EMBARK      AS 'EMB_APT_CD'	
        CITYPAIR.ROUTE       AS 'RTE_APT_CD'	
        CLASS	
        CLS_CAT
        CL_CAT
        CLIENT_NAME
        CONJ_REL	
        CREDIT_CARD
        DISSAVINGS	
        DOC_TYPE	
        DPT_TIME
        DST_APC
        EMB_APT.AIRPORT_NAME AS 'EMB_APT_NM'	
        EMB_CTY.CITY_NAME    AS 'EMB_CTY_NM'	
        EMB_CTY.EMB_CITY     AS 'EMB_CTY_CD'	
        FARE_BAS	
        FARE_PAID 
        FLIGHT	
        FLIGHT_DURATIONS
        FLT_LEN
        FLT_LEN1
        FLT_LEN2
        FLT_LEN3
        FLT_LEN4
        FLT_LEN5
        FLT_LEN6
        FLT_LEN7
        FLT_LEN8  
        KEY
        KEY1
        LEVEL_DESC	
        NET_TKT_CNT
        REF_EXCH_CNT	
        REFUSE_CODE
        RTE_APT.AIRPORT_NAME AS 'RTE_APT_NM'	
        RTE_CTY.CITY_NAME    AS 'RTE_CTY_NM'	
        RTE_CTY.RTE_CITY     AS 'RTE_CTY_CD'	
        SAVINGS	
        SEG_AMT	
        SEG_DESIG	
        SEG_DISCOUNT	
        SEG_LOWEST	
        SEG_NBR	
        SEG_STANDARD	
        SEG_TAX	
        STAY	
        TICKET_BRANCH	
        TKT_NUM	
        TKT_PURCH	
        TKT_SORT	
        TKT_TYPE
        TRN_DATE	
        TRP_LEN	
        VASAVINGS	
        XARR_DT	
        XDPT_DT	
        XPSNGR_NM	
        XTRAN_DT	
                
-INCLUDE &AIRDATES

WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
&&CHK
&&FDCHK
&LCHK
&&CC
&&EL
&&ARCHK
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHLD
END
-RUN

-IF &RECORDS EQ 0 THEN GOTO NORECORDS;
-RUN


TABLE FILE RPTHLD
SUM NET_TKT_CNT AS 'TTKT'
    FARE_PAID AS 'TFARE'
BY ALN_KEY
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN

TABLE FILE RPTHLD
PRINT AROLL_DSC6 
      AIRLINE
      CHG_CAT
      CAT
      CLASS
      EMB_APT_NM
      FLIGHT_DURATIONS
      FLT_LEN
      KEY
      KEY1
      NET_TKT_CNT
      SEG_AMT
      SEG_STANDARD
      SEG_LOWEST
      SEG_DISCOUNT
      FARE_BAS
      FARE_PAID 
      REFUSE_CODE 
      RTE_APT_NM  
      TKT_NUM     
      TKT_TYPE	
      DPT_TIME
      XDPT_DT
      XTRAN_DT 
BY ALN_KEY      
BY LEVEL_DESC      
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AROLL_DSC6
      AIRLINE 
      CHG_CAT
      CAT
      CLASS
      EMB_APT_NM
      FLIGHT_DURATIONS
      FLT_LEN
      KEY
      KEY1
      NET_TKT_CNT
      SEG_AMT
      SEG_STANDARD
      SEG_LOWEST
      SEG_DISCOUNT
      FARE_BAS
      FARE_PAID 
      REFUSE_CODE 
      RTE_APT_NM  
      TKT_NUM     
      TKT_TYPE	
      DPT_TIME
      XDPT_DT
      XTRAN_DT
BY ALN_KEY      
BY LEVEL_DESC      
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT TFARE
      TTKT 
BY ALN_KEY      
BY LEVEL_DESC      
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

TABLE FILE AIRHOLD2
PRINT ALN_KEY 
      AROLL_DSC6 
      AIRLINE
      CHG_CAT
      CAT
      CLASS
      EMB_APT_NM
      FLIGHT_DURATIONS
      FLT_LEN
      KEY
      KEY1
      EMB_APT_NM
      LEVEL_DESC
      NET_TKT_CNT
      SEG_AMT
      SEG_STANDARD
      SEG_LOWEST
      SEG_DISCOUNT
      FARE_BAS
      FARE_PAID 
      XPSNGR_NM
      REFUSE_CODE 
      RTE_APT_NM
      TFARE
      TKT_NUM     
      TKT_TYPE	
      TRN_DATE
      TTKT
      XDPT_DT     
      DPT_TIME
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN 

JOIN ROLL WITH TKT_SORT IN AIRHOLD3 TO ROLLUP_CODE IN ROLLUP AS J1.
-RUN 
 
DEFINE FILE AIRHOLD3
NET_TKT_CNT/D9S = IF (SEG_NBR EQ '01') THEN  TTKT ELSE 0;
PASNGR_NAME/A33 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
REASON_CD/A2 =  IF TKT_NUM NE LAST TKT_NUM THEN REFUSE_CODE ELSE ' ';
TICKET_NMBR/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_NUM ELSE ' ';
XT_DTE/A8 = EDIT(TRN_DATE);
XTKT_SRT/A10 = EDIT(TKT_SORT,'9999999999$');
XTRAN_DTE/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN XTRAN_DT ELSE 0;

-* ****DEFINES ON PREVIOUS DEFINES****
SRT_DT/A100 = TKT_SORT||XT_DTE||XPSNGR_NM;
FARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TFARE ELSE 0;

-* SEG_TOT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TSEG ELSE 0;
-* LOST_TOT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TDSV ELSE 0;
-* LOW_TOT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TLOW ELSE 0;
NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
ROLL/A8='&&ROLLUP.EVAL';
LVL/A60='&&LVL_DSC.EVAL';
RPHONE/A15=EDIT(ROLL_PHONE,'9-999-999-9999');
RN/A60=TRIM('B', '&&RPT_TTL1.EVAL', 60, ' ', 1, 'A60');
TDATE1/A8MDYY='&MDYY';
TDATE2/A10=EDIT(TDATE1,'99/99/9999');
TIME1/A8=HHMMSS('A8');
TIME2/A8=EDIT(TIME1,'99$:99$:99');
RD/A10 = 'Run Date:';
RT/A10 = 'Run Time:';
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE AIRHOLD3
HEADING
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-*******************************************************************
-* Print statement with fields passed from the user profile database
-*******************************************************************
-*
PRINT
REASON_CD AS 'RSN,CDE'
&&DEPARTD
&&DEPARTT
EMB_APT_NM AS 'ORIGIN'
RTE_APT_NM AS 'DESTINATION'
AIRLINE AS 'CR'
CLASS AS 'CLS,OF,SVC'
FARE_BAS AS 'FARE,BASIS'
-*FLIGHT_DURATIONS AS 'FLT,DURATIONS'
&&FAREAMT
&&NTCOUNT
-* &&LOWEST
-*&&LSTSVGS
-*&&VSVAMT
-*&&ATP

-******************************************************************
-* By statements (one per field)
-******************************************************************
-*
BY ALN_KEY NOPRINT
BY LEVEL_DESC NOPRINT
BY CHG_CAT AS 'CHARGE,CAT'
BY AROLL_DSC6 AS 'EMP,LVL'
BY KEY1 NOPRINT
BY FLT_LEN NOPRINT
BY CAT NOPRINT
BY XPSNGR_NM AS 'PASSENGER,NAME'
BY XTKT_SRT NOPRINT
BY TKT_SORT NOPRINT BY TRN_DATE NOPRINT
BY SEG_NBR NOPRINT
BY XDPT_DT NOPRINT BY DPT_TIME NOPRINT
BY TKT_NUM AS 'TKT,NUM'
BY TKT_TYPE AS 'TKT,TYPE'

-* &&CHK
-*
-******************************************************************
-* On Table statements for code appropriate to On Table commands
-******************************************************************
-*
-* ON TABLE COLUMN-TOTAL;
-* ON XPSNGR_NM RECOMPUTE MULTILINES AS 'TOTAL FOR'

ON ALN_KEY RECOMPUTE AS 'Total For'
ON LEVEL_DESC RECOMPUTE AS 'Total For'
ON CAT RECOMPUTE MULTILINES AS 'Total For'

ON XTKT_SRT SKIP-LINE
ON TABLE SET PAGE-NUM OFF
 

FOOTING BOTTOM
-INCLUDE CRIGHT_FOOTER
"</4"
"<15 &M1.EVAL"
ON TABLE PAGE-BREAK AND SUBFOOT
" "
-INCLUDE SBFOOT
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE SET STYLE *
-INCLUDE &&PASTYD

ENDSTYLE
   

-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-*
-TYPE After Report
-GOTO XXIT;


-FIRST
-HTMLFORM BEGIN
<HTML>
<HEAD>

</HEAD>
<BODY>


<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>THIS FIELD IS NOT DRILLABLE!!!</H2></CENTER>

<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER> 

</BODY>
</HTML>
-HTMLFORM END
-GOTO XXIT;

-NOFILE
-HTMLFORM BEGIN
<HTML>
<HEAD>

</HEAD>
<BODY>


<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>THE REPORT IS NO LONGER DRILLABLE!!!</H2></CENTER>

<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER> 

</BODY>
</HTML>
-HTMLFORM END

-GOTO XXIT;

-NORECORDS


-HTMLFORM BEGIN
<HTML>
<HEAD>

</HEAD>
<BODY>


<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>NO RECORDS FOUND FOR THIS SELECTION!!!</H2></CENTER>

<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER> 

</BODY>
</HTML>
-HTMLFORM END

-XXIT;
