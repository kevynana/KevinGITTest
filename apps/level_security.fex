-* File level_security.fex

-DEFAULT &&ROLLUP='ABCD-R';
-DEFAULT &CUSER='XXXXXX';
-DEFAULT &WHERE900='';
-DEFAULT &WHERE901='';
-DEFAULT &WHERE902='';
 
-* Get the Current User's ID
-*-SET &CUSER=CNCTUSR('A10');
-* User userid of person that ran the original report
-SET &CUSER='&&UNAME.EVAL';
 
TABLE FILE USERLEVELSECURITY
PRINT ACCESS_LEVEL ACCESS_VALUE
WHERE USER_NAME EQ '&CUSER.EVAL';
WHERE CLIENT_ID_ROLLUP EQ '&&ROLLUP.EVAL';
ON TABLE HOLD AS HLEVSEC1 FORMAT ALPHA
END
-RUN
-SET &LEVSEC = IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
-IF &RECORDS EQ 0 GOTO :NOLSEC;
 
DEFINE FILE HLEVSEC1
LID/A6='LEVEL' | ACCESS_LEVEL;
END
TABLE FILE  HLEVSEC1
SUM LID
ON TABLE HOLD AS HLEVSEC2 FORMAT ALPHA
END
-RUN
 
-READ HLEVSEC2 &LEVID.6
 
TABLE FILE HLEVSEC1
PRINT ACCESS_VALUE
ON TABLE HOLD AS HLEVSEC3 FORMAT ALPHA
END
-RUN
 
-SET &CNT = 1;
-SET &WHERE900='WHERE ' | '&LEVID.EVAL' | ' EQ ';
 
-REPEAT LSEC01 &LINES TIMES
-READ HLEVSEC3 NOCLOSE &V2.A60.
 
-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(62, &V3, 'I2');
-SET &V1 = SUBSTR(62, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 4 AND &CNT LE 7 THEN GOTO Lbl901;
-IF &CNT GE 8  THEN GOTO Lbl902;
-IF &V1 EQ '' THEN GOTO LSEC01NEXT;
 
-SET &WHERE900 = IF &CNT EQ &LINES THEN &WHERE900 | &V1
-   ELSE &WHERE900 | &V1 | ' OR ';
 
-GOTO LSEC01NEXT;
 
 
-***********
-Lbl901
-***********
-SET &WHERE901 = IF &WHERE900 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE901 | &V1
-    ELSE &WHERE901 | &V1 | ' OR ';
 
-GOTO LSEC01NEXT;
-***********
-Lbl902
-***********
-SET &WHERE902 = IF &WHERE900 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE902 | &V1
-    ELSE &WHERE902 | &V1 | ' OR ';
 
-LSEC01NEXT
-SET &CNT = &CNT + 1;
 
-LSEC01
-CLOSE HLEVSEC3
-RUN
 
-:NOLSEC
