-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 5/11/04 - DEB - ADDED EXCH_MCO DEFINE SO EXCHANGE AMT WOULD BALANCE TO 
-*                 TRANSACTION SUMMARY
-*                 CHANGED REFUND_TOTAL DEFINE DUE TO BALANCING ISSUES
-*                 CHANGED AMT DEFINES TO 12.2 UNTIL FINAL REPORT PRODUCED
-* 10/26/2004 - STEVE - Changed VOIDS define to include a voided MCO to match
-*              the transaction summary
-*12/28/04  - DEB ADDED DOD_TYPE 'J' TO CONL AND PONL DEFINE
-* ADDED TRANTYPE INCLUDE - JK 12/30/14 STORY ID S-06492



-SET &&Q_REV = &&WEB_PATH || 'Q_REV.FOC';
-RUN
FILEDEF Q_REV DISK &&Q_REV
-RUN

CREATE FILE Q_REV
-RUN

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

DEFINE FILE SR_50  
  FARE_PAID/D12.2C = IF (VOID_DATE EQ 0) THEN SEG_AMT + SEG_TAX ELSE 0;
  NET_TKT_CNT/D8CS  =   IF (VOID_DATE EQ 0) AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) THEN 1 ELSE 
                        IF (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') AND (SEG_COUNT EQ -1)
			   THEN (-1) ELSE 
                        IF (DOC_TYPE NE '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') AND
			   (SEG_COUNT EQ -1)
		           THEN (-1) ELSE 0;
NEW_SEG_MILES/D8CS = SEG_MILES;

TKT_PURCH/D15CS     = IF (TICKET_CODE EQ '1') AND
                             (SEG_NBR EQ '01') AND
                             (FARE_PAID GE 0) AND
                             (SEG_COUNT EQ 1) AND 
                             (CONJ_REL EQ 1) THEN 1 ELSE 0;

-* Defines on Previous Defines
  DISSAVINGS/D12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
  VASAVINGS/D12.2 = SEG_DISCOUNT - FARE_PAID;
-* Defines on Previously Defined Defines
-INCLUDE TRANTYPE  
END
-RUN

TABLEF FILE SR_50
PRINT AIR_MAIN.INTL_DOM AS 'INTL_DOM'
  DISSAVINGS
  DOC_TYPE	
  DOD_TYPE
  DPT_DATE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE
  FARE_PAID	
  NET_TKT_CNT
  NEW_SEG_MILES
  REFUSE_CODE
  RF_FLAG
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 
  TKT_NUM
  TKT_PURCH	
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	

WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3



-INCLUDE RPTPARMS
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN

DEFINE FILE &&RPT_HOLD
TRAN_M/MT = TRN_DATE;
TRAN_Y/Y = TRN_DATE;
TRAN_Y1/A4 = EDIT(TRAN_Y);
PERIOD2/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND
                TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';

PERIOD1/A1 =  IF TRN_DATE GE &&FXDATE.EVAL AND
                 TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
PERIOD/A2 = IF PERIOD1 EQ 'Y' THEN 'P2' ELSE 'P1';
QTRA/A6 = IF (PERIOD1 EQ 'Y') AND (TRAN_M EQ 'JAN' OR 'FEB' OR 'MAR') THEN
              'Q1'||TRAN_Y1 ELSE 
           IF (PERIOD1 EQ 'Y') AND (TRAN_M EQ 'APR' OR 'MAY' OR 'JUN') THEN
              'Q2'||TRAN_Y1 ELSE
           IF (PERIOD1 EQ 'Y') AND (TRAN_M EQ 'JUL' OR 'AUG' OR 'SEP') THEN
              'Q3'||TRAN_Y1 ELSE
           IF (PERIOD1 EQ 'Y') AND (TRAN_M EQ 'OCT' OR 'NOV' OR 'DEC') THEN
              'Q4'||TRAN_Y1 ELSE
           IF (PERIOD2 EQ 'Y') AND (TRAN_M EQ 'JAN' OR 'FEB' OR 'MAR') THEN
              'Q1'||TRAN_Y1 ELSE 
           IF (PERIOD2 EQ 'Y') AND (TRAN_M EQ 'APR' OR 'MAY' OR 'JUN') THEN
              'Q2'||TRAN_Y1 ELSE
           IF (PERIOD2 EQ 'Y') AND (TRAN_M EQ 'JUL' OR 'AUG' OR 'SEP') THEN
              'Q3'||TRAN_Y1 ELSE
           IF (PERIOD2 EQ 'Y') AND (TRAN_M EQ 'OCT' OR 'NOV' OR 'DEC') THEN
              'Q4'||TRAN_Y1 ELSE ' ';
      
           
              
END

-GOTO AROUND

TABLE FILE &&RPT_HOLD
PRINT DISSAVINGS
  DOC_TYPE	
  DOD_TYPE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE	
  FARE_PAID
  INTL_DOM
  NET_TKT_CNT
  NEW_SEG_MILES
  PERIOD
  QTRA
  REFUSE_CODE
  RF_FLAG
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 	
  TKT_NUM
  TKT_PURCH
  TRN_DATE
  TRAN_M
  TRAN_Y
  TRAN_Y1
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS TRANONE 
END
-RUN

-AROUND
-SET &&RPTSUF = 'QREV';
-INCLUDE FDEFRPTS
-RUN

-* -GOTO SKIP

-* AIR VOLUME AND NET TICKETS
GRAPH FILE &&RPT_HOLD
SUM FARE_PAID AS 'Total,Volume'
    NET_TKT_CNT AS 'Net Tickets'
BY QTRA AS ' '
ON GRAPH SET LOOKGRAPH VBAR2AX
ON GRAPH SET BARNUMB OFF
ON GRAPH SET 3D OFF
ON GRAPH SET VZERO ON
ON GRAPH SET GRID ON
ON GRAPH HOLD AS VOLNET1 FORMAT GIF
ON GRAPH SET GRAPHSTYLE *
setSeriesFillColor(0, new Color, 0 64 128));
setSeriesFillColor(1, new Color, 128 255 128));
setMarkerDisplay(true);
setUseSeriesShapes(true);
setConnectLineMarkers(true);
setConnectScatterMarkers(true);
setO1LabelDisplay(true);
setO1LabelRotate(0);
setAxisAssignment(0,0);
setSeriesType(0,1);
setAxisAssignment(1,1);
setSeriesType(1,2);
setY2TitleString("Net Tickets");
setTextFormatPreset(getY1Label(),5);
setTextFormatPreset(getY2Label(),-1);
setTextFormatPattern(getY2Label(),"#,###");
setPieFeelerTextDisplay(1);
setPieLabelDisplay(0);
setTextFormatPreset(getPieSliceLabel(),1);
setRiserBorderMode(1);
setSeriesDefaultTransparentBorderColor(true);
setUseSeriesBorderDefaults(true);
setLegendDisplay(true);
setLegendPosition(2);
setTitleString("Air Volume and Net Tickets");
setFontSizeAbsolute(getTitle(),true);
setFontSizeAbsolute(getLegendText(),true);
setFontSizeAbsolute(getY1Title(),true);
setFontSizeAbsolute(getY1Label(),true);
setFontSizeAbsolute(getY2Title(),true);
setFontSizeAbsolute(getY2Label(),true);
setFontSizeAbsolute(getO1Title(),true);
setPlace(true);
ENDSTYLE
END
-RUN

-SET &&N1_SVG=IF &LINES GT 0 THEN 'Y' ELSE 'N';

-SKIP
SET COMPOUND='OPEN NOBREAK'
TABLE FILE &&RPT_HOLD
SUM FARE_PAID
    NET_TKT_CNT
BY QTRA
HEADING CENTER
"</20"
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', 
LEFTMARGIN=0.050000, RIGHTMARGIN=0.050000,
      TOPMARGIN=0.250000, BOTTOMMARGIN=0.250000, SQUEEZE=OFF,
      ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FOCEXEC=NONE, FONT=TIMES NEW ROMAN, SIZE=9, COLOR=BLACK,
    BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=REPORT, FOCEXEC=NONE, FONT=TIMES NEW ROMAN, SIZE=9, COLOR=BLACK,
    BACKCOLOR=NONE, STYLE=NORMAL, $

TYPE=HEADING, LINE=6, OBJECT=TEXT, STYLE=BOLD, $
TYPE=HEADING, LINE=7, OBJECT=TEXT, ITEM=2, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=7, OBJECT=TEXT, ITEM=3, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=8, OBJECT=TEXT, ITEM=2, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=8, OBJECT=TEXT, ITEM=3, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=9, OBJECT=TEXT, ITEM=2, STYLE=BOLD, $
TYPE=HEADING, LINE=9, OBJECT=TEXT, ITEM=3, STYLE=BOLD, $

TYPE=HEADING, LINE=10, OBJECT=TEXT, ITEM=2, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=10, OBJECT=TEXT, ITEM=3, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=10, OBJECT=TEXT, ITEM=4, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC, $

TYPE=SUBHEAD, BY=1, LINE=1, OBJECT=FIELD, ITEM=1, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=1, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=2, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=3, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=4, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=FOOTING, FONT=TIMES NEW ROMAN, SIZE=9, COLOR=BLUE, $
-IF &&N1_SVG EQ 'N' GOTO SKIP_A1;
TYPE=REPORT,
IMAGE=VOLNET1.GIF,
      POSITION=(.5 .2), SIZE=(4.0 2.5), $
-SKIP_A1
ENDSTYLE
ON TABLE SET PAGE-NUM OFF
ON TABLE PCHOLD FORMAT PDF 
END
-RUN

-* -GOTO SKIP1
-* 2ND HOLD FILE
-* AIR VOLUME AND NET TICKETS
GRAPH FILE &&RPT_HOLD
SUM FARE_PAID AS 'Total,Volume'
    NET_TKT_CNT AS 'Net Tickets'
BY QTRA AS ' '
ON GRAPH SET LOOKGRAPH VBAR2AX
ON GRAPH SET BARNUMB OFF
ON GRAPH SET 3D OFF
ON GRAPH SET VZERO ON
ON GRAPH SET GRID ON
ON GRAPH HOLD AS VOLNET2 FORMAT GIF
ON GRAPH SET GRAPHSTYLE *
setSeriesFillColor(0, new Color, 0 64 128));
setSeriesFillColor(1, new Color, 128 255 128));
setMarkerDisplay(true);
setUseSeriesShapes(true);
setConnectLineMarkers(true);
setConnectScatterMarkers(true);
setO1LabelDisplay(true);
setO1LabelRotate(0);
setAxisAssignment(0,0);
setSeriesType(0,1);
setAxisAssignment(1,1);
setSeriesType(1,2);
setY2TitleString("Net Tickets");
setTextFormatPreset(getY1Label(),5);
setTextFormatPreset(getY2Label(),-1);
setTextFormatPattern(getY2Label(),"#,###");
setPieFeelerTextDisplay(1);
setPieLabelDisplay(0);
setTextFormatPreset(getPieSliceLabel(),1);
setRiserBorderMode(1);
setSeriesDefaultTransparentBorderColor(true);
setUseSeriesBorderDefaults(true);
setLegendDisplay(true);
setLegendPosition(2);
setTitleString("Air Volume and Net Tickets");
setFontSizeAbsolute(getTitle(),true);
setFontSizeAbsolute(getLegendText(),true);
setFontSizeAbsolute(getY1Title(),true);
setFontSizeAbsolute(getY1Label(),true);
setFontSizeAbsolute(getY2Title(),true);
setFontSizeAbsolute(getY2Label(),true);
setFontSizeAbsolute(getO1Title(),true);
setPlace(true);
ENDSTYLE
END
-RUN

-SET &&N2_SVG=IF &LINES GT 0 THEN 'Y' ELSE 'N';

-SKIP1
SET COMPOUND=CLOSE
TABLE FILE &&RPT_HOLD
SUM FARE_PAID
    NET_TKT_CNT
BY QTRA
HEADING CENTER
" "
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=5.500000, RIGHTMARGIN=0.050000,
      TOPMARGIN=-1.500000, BOTTOMMARGIN=0.250000, SQUEEZE=OFF,
      ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FOCEXEC=NONE, FONT=TIMES NEW ROMAN, SIZE=9, COLOR=BLACK,
    BACKCOLOR=NONE, STYLE=NORMAL, $

TYPE=HEADING, LINE=6, OBJECT=TEXT, STYLE=BOLD, $
TYPE=HEADING, LINE=7, OBJECT=TEXT, ITEM=2, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=7, OBJECT=TEXT, ITEM=3, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=8, OBJECT=TEXT, ITEM=2, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=8, OBJECT=TEXT, ITEM=3, FONT=COURIER NEW,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=9, OBJECT=TEXT, ITEM=2, STYLE=BOLD, $
TYPE=HEADING, LINE=9, OBJECT=TEXT, ITEM=3, STYLE=BOLD, $

TYPE=HEADING, LINE=10, OBJECT=TEXT, ITEM=2, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=10, OBJECT=TEXT, ITEM=3, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC, $
TYPE=HEADING, LINE=10, OBJECT=TEXT, ITEM=4, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC, $

TYPE=SUBHEAD, BY=1, LINE=1, OBJECT=FIELD, ITEM=1, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+ITALIC+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=1, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=2, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=3, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=SUBHEAD, BY=1, LINE=3, OBJECT=FIELD, ITEM=4, FONT=ARIAL, SIZE=10,
    STYLE=BOLD+UNDERLINE, $
TYPE=FOOTING, FONT=TIMES NEW ROMAN, SIZE=9, COLOR=BLUE, $
-IF &&N2_SVG EQ 'N' GOTO SKIP_A2;
TYPE=REPORT,
IMAGE=VOLNET2.GIF,
      POSITION=(5.5 .2), SIZE=(4.0 2.5), $
-SKIP_A2
ENDSTYLE
ON TABLE PCHOLD FORMAT PDF 
END
-RUN

