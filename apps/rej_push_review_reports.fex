-INCLUDE SETECHO
-* File push_review_reports.fex
-*   This Focexec will check for scheduled Reports that need to be pushed
-*   each week and each month.
SET BASEURL='&&SRVR.EVAL'
SET EMPTYREPORT=ON
SET BYDISPLAY=ON
SET LINES=99999
 
-INCLUDE CLASSPATH
 
-SET &&WPATH1=TEMPPATH(50,'A50');
-SET &&JPATH=STRREP(50,'&&WPATH1.EVAL',1,'\',2,'\\',150,'A150');
 
-SET &TDATE=&YYMD;
-*-SET &TDATE=20080627;
-SET &TDATE=20080801;
 
-* Get Reports where the Total Set was scheduled
-*
JOIN CLEAR *
JOIN SET_KEY IN PUSH_REPORTS TO ALL SET_KEY IN RPT_INST AS J1
JOIN ROLLUP_CODE IN PUSH_REPORTS TO ROLLUP_CODE IN ROLLUP AS J2
-RUN
 
DEFINE FILE PUSH_REPORTS CLEAR
OUTTO/A2='TC';
-* Today's Date
-*TDATE1/YYMD=&TDATE;
TDATE1/YYMD=END_DATE + 1;
P_MONTH/MDYY=TDATE1;
P_BOW/MDYY=DATEMOV(P_MONTH, 'BOW');
P_EOW/MDYY=DATEMOV(P_MONTH, 'EOW');
 
AFM_DATE/MDYY=DATEADD(P_BOW, 'D', (-7));
ATO_DATE/MDYY=DATEADD((P_EOW + 2), 'D', (-7));
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'D', (-7));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'D', (-7));
ATX_DATE/MDYY=ATX_DATE0;
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
ACYFM_DATE/MDYY=AFM_DATE;
ACYTO_DATE/MDYY=ATO_DATE;
APYFM_DATE/MDYY=AFM_DATE;
APYTO_DATE/MDYY=ATO_DATE;
 
EXFEX/A10=IF RPT_TYPE EQ 'QTR' THEN 'RUN_QTR' ELSE 'WRUNINDV';
RPT_NAMEX/A60='Weekly-' || RPT_NAME;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      RPT_INST.INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_W EQ '1'
WHERE PUSH_REPORTS.INST_KEY EQ 0
 
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_WEEKLY_PROCESS_DATE AND
      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDWS FORMAT FOCUS
END
-RUN
 
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
 
AFM_DATE/MDYY=IF SCHED_M EQ '1' THEN P_BOM ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='Monthly-' || RPT_NAME;
 
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      RPT_INST.INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
      END_DATE
 
   LAST_PROCESS_DATE
      ATO_DATE
 
BY SCHED_OWNER
WHERE SCHED_M EQ '1'
WHERE PUSH_REPORTS.INST_KEY EQ 0
 
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ROLLUP.ROLLUP.END_DATE GE ATO_DATE AND
      ATO_DATE GT LAST_PROCESS_DATE
 
ON TABLE SET ASNAMES ON
-*ON TABLE HOLD AS HLDMS FORMAT FOCUS
END
-RUN
-EXIT
 
-* Get list of Monthly YTD Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
 
AFM_DATE/MDYY=IF SCHED_MYTD EQ '1' THEN ANNUAL_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='MYTD-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      RPT_INST.INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_MYTD EQ '1'
WHERE PUSH_REPORTS.INST_KEY EQ 0
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDMYTDS FORMAT FOCUS
END
-RUN
 
-* Get list of Quarterly Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
AFM_DATE/MDYY=IF SCHED_Q EQ '1' AND CUR_QTR EQ '1' THEN Q1_BEGIN ELSE
              IF SCHED_Q EQ '1' AND CUR_QTR EQ '2' THEN Q2_BEGIN ELSE
              IF SCHED_Q EQ '1' AND CUR_QTR EQ '3' THEN Q3_BEGIN ELSE
              IF SCHED_Q EQ '1' AND CUR_QTR EQ '4' THEN Q4_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='Quarterly-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      RPT_INST.INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_Q EQ '1'
WHERE PUSH_REPORTS.INST_KEY EQ 0
WHERE RUN_EOM EQ Q1E OR
      RUN_EOM EQ Q2E OR
      RUN_EOM EQ Q3E OR
      RUN_EOM EQ Q4E
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDQS FORMAT FOCUS
END
-RUN
 
-* Get list of Quarterly YTD Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
AFM_DATE/MDYY=IF SCHED_QYTD EQ '1' THEN Q1_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='QYTD-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      RPT_INST.INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_QYTD EQ '1'
WHERE PUSH_REPORTS.INST_KEY EQ 0
WHERE RUN_EOM EQ Q1E OR
      RUN_EOM EQ Q2E OR
      RUN_EOM EQ Q3E OR
      RUN_EOM EQ Q4E
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDQYTDS FORMAT FOCUS
END
-RUN
 
-* Get list of Annual Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
AFM_DATE/MDYY=IF SCHED_A EQ '1' THEN ANNUAL_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='Annual-' || RPT_NAME;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      RPT_INST.INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_A EQ '1'
WHERE PUSH_REPORTS.INST_KEY EQ 0
WHERE RUN_EOM EQ ANNUAL
 
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDAS FORMAT FOCUS
END
-RUN
 
-***************************************************************************
-* Get Individual Reports that were scheduled
-*
JOIN CLEAR *
JOIN INST_KEY IN PUSH_REPORTS TO INST_KEY IN RPT_INST AS J1
JOIN ROLLUP_CODE IN PUSH_REPORTS TO ROLLUP_CODE IN ROLLUP AS J2
-RUN
 
DEFINE FILE PUSH_REPORTS CLEAR
OUTTO/A2='TC';
-* Today's Date
-*TDATE1/YYMD=&TDATE;
TDATE1/YYMD=END_DATE + 1;
P_MONTH/MDYY=TDATE1;
P_BOW/MDYY=DATEMOV(P_MONTH, 'BOW');
P_EOW/MDYY=DATEMOV(P_MONTH, 'EOW');
 
AFM_DATE/MDYY=DATEADD(P_BOW, 'D', (-7));
ATO_DATE/MDYY=DATEADD((P_EOW + 2), 'D', (-7));
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'D', (-7));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'D', (-7));
ATX_DATE/MDYY=ATX_DATE0;
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
ACYFM_DATE/MDYY=AFM_DATE;
ACYTO_DATE/MDYY=ATO_DATE;
APYFM_DATE/MDYY=AFM_DATE;
APYTO_DATE/MDYY=ATO_DATE;
 
EXFEX/A10=IF RPT_TYPE EQ 'QTR' THEN 'RUN_QTR' ELSE 'WRUNINDV';
RPT_NAMEX/A60='Weekly-' || RPT_NAME;
END
-* Get list of Weekly Scheduled Reports
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_W EQ '1'
 
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_WEEKLY_PROCESS_DATE AND
      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
 
ON TABLE HOLD AS HLDW FORMAT FOCUS
END
 
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
 
AFM_DATE/MDYY=IF SCHED_M EQ '1' THEN P_BOM ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='Monthly-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_M EQ '1'
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDM FORMAT FOCUS
END
-RUN
 
-* Get list of Monthly YTD Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
 
AFM_DATE/MDYY=IF SCHED_MYTD EQ '1' THEN ANNUAL_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='MYTD-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_MYTD EQ '1'
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDMYTD FORMAT FOCUS
END
-RUN
 
-* Get list of Quarterly Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
AFM_DATE/MDYY=IF SCHED_Q EQ '1' AND CUR_QTR EQ '1' THEN Q1_BEGIN ELSE
              IF SCHED_Q EQ '1' AND CUR_QTR EQ '2' THEN Q2_BEGIN ELSE
              IF SCHED_Q EQ '1' AND CUR_QTR EQ '3' THEN Q3_BEGIN ELSE
              IF SCHED_Q EQ '1' AND CUR_QTR EQ '4' THEN Q4_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='Quarterly-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_Q EQ '1'
WHERE RUN_EOM EQ Q1E OR
      RUN_EOM EQ Q2E OR
      RUN_EOM EQ Q3E OR
      RUN_EOM EQ Q4E
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDQ FORMAT FOCUS
END
-RUN
 
-* Get list of Quarterly YTD Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
AFM_DATE/MDYY=IF SCHED_QYTD EQ '1' THEN Q1_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='QYTD-' || RPT_NAME;
LPM/YYM=DATEADD(LAST_PROCESS_DATE, 'M', (-1));
 
ATD/YYM=ATO_DATE;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_QYTD EQ '1'
WHERE RUN_EOM EQ Q1E OR
      RUN_EOM EQ Q2E OR
      RUN_EOM EQ Q3E OR
      RUN_EOM EQ Q4E
 
-*WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
-*      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ATD GT LPM
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDQYTD FORMAT FOCUS
END
-RUN
 
-* Get list of Annual Scheduled Reports
DEFINE FILE PUSH_REPORTS CLEAR
-INCLUDE PUSH_DATE_DEFINES
AFM_DATE/MDYY=IF SCHED_A EQ '1' THEN ANNUAL_BEGIN ELSE 0;
ATO_DATE/MDYY=P_EOM;
AFX_DATE/MDYY=DATEADD(AFM_DATE, 'Y', (-1));
ATX_DATE0/MDYY=DATEADD(ATO_DATE, 'Y', (-1));
ATX_DATE/MDYY=DATEMOV(ATX_DATE0, 'EOM');
 
ACMFM_DATE/MDYY=AFM_DATE;
ACMTO_DATE/MDYY=ATO_DATE;
APMFM_DATE/MDYY=AFX_DATE;
APMTO_DATE/MDYY=ATX_DATE;
 
ACYFM_DATE/MDYY=ANNUAL_BEGIN;
ACYTO_DATE/MDYY=P_EOM;
APYFM_DATE/MDYY=DATEADD(ACYFM_DATE, 'Y', (-1));
APYTO_DATE0/MDYY=DATEADD(ACYTO_DATE, 'Y', (-1));
APYTO_DATE/MDYY=DATEMOV(APYTO_DATE0, 'EOM');
 
RPT_NAMEX/A60='Annual-' || RPT_NAME;
END
TABLE FILE PUSH_REPORTS
PRINT SET_KEY
      INST_KEY
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAMEX AS RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
   END_DATE
BY SCHED_OWNER
WHERE SCHED_A EQ '1'
WHERE RUN_EOM EQ ANNUAL
 
WHERE ROLLUP.ROLLUP.END_DATE GT LAST_PROCESS_DATE AND
      ROLLUP.ROLLUP.END_DATE GE ATO_DATE
 
ON TABLE SET ASNAMES ON
ON TABLE HOLD AS HLDA FORMAT FOCUS
END
-RUN
 
-* Put the files together and eliminate duplicates based on the
-* date ranges the reports are running for.
-*
USE CLEAR *
USE
HLDWS.FOC AS HLDA
HLDMS.FOC AS HLDA
HLDMYTDS.FOC AS HLDA
HLDQS.FOC AS HLDA
HLDQYTDS.FOC AS HLDA
HLDAS.FOC AS HLDA
HLDW.FOC AS HLDA
HLDM.FOC AS HLDA
HLDMYTD.FOC AS HLDA
HLDQ.FOC AS HLDA
HLDQYTD.FOC AS HLDA
HLDA.FOC AS HLDA
END
-RUN
 
TABLE FILE HLDA
SUM
      OUTTO
      OUTPUT_FORMAT
      DATETYPE
      RPT_NAME
      AFM_DATE
      ATO_DATE
      AFX_DATE
      ATX_DATE
      ACMFM_DATE
      ACMTO_DATE
      APMFM_DATE
      APMTO_DATE
      ACYFM_DATE
      ACYTO_DATE
      APYFM_DATE
      APYTO_DATE
      EXFEX
      ROLLUP_CODE
      PUSH_EADDRS
 
   END_DATE
 
 
BY SCHED_OWNER
BY SET_KEY
BY INST_KEY
BY AFM_DATE NOPRINT
BY ATO_DATE NOPRINT
BY AFX_DATE NOPRINT
BY ATX_DATE NOPRINT
ON TABLE SET HOLDLIST PRINTONLY
-*ON TABLE HOLD AS RCPARMS1
END
-RUN
