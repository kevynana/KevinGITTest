-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-*04/18/16 - DLV - S-16819  Carried through LEVEL1 LEVEL2 LEVEL3 LEVEL4 LEVEL5
-*                          LEVEL6 INVOICE_DATE for NSDHTL
-*07/15/16   RSB   S-20630 - New Employee ID database field
-*                           Added EMP_ID
-*   
-*02/22/17   DLV    S-30846 - Added routine for NSDHTL so records that net to 0 are excluded
-*                            Carried through PNR_LOCATOR RESV_STATUS

 
-INCLUDE SETECHO

SET ASNAMES=ON
-RUN

-IF '&&SETF.EVAL' EQ 'NSDHTL' THEN GOTO SKIPcur;
-HRC;
-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &CROOM_CUR = 'ROOM,RATE, (' | &&CURRENCY || ')';
-SET &&PRINT3 ='RATE_ROOM1/D16.2CS AS ' | '''&CROOM_CUR.EVAL''';
-SET &&PRINT4 ='AMT_TOTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''';

-SKIPcur;

TABLE FILE HTLHLD
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC
  EMP_ID
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PNR_LOCATOR
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5
  RATE_ROOM1
  RESV_STATUS
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY COUNTRY
ON TABLE HOLD AS HC1 
END
-RUN

TABLE FILE COUNTRY
PRINT COUNTRY_NAME
BY COUNTRY_CODE
ON TABLE HOLD AS HC2
END
-RUN

-IF '&&SETF.EVAL' EQ 'NSDHTL' THEN GOTO NORD;


MATCH FILE HC1
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC	
  EMP_ID
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PNR_LOCATOR
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5	
  RATE_ROOM1
  RESV_STATUS
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY COUNTRY
ON TABLE HOLD
RUN 
FILE HC2
SUM COUNTRY_NAME
BY COUNTRY_CODE
AFTER MATCH HOLD AS HC3 OLD-AND-NEW
END
-RUN 

-GOTO ContRpt;


-NORD;
 


MATCH FILE HC1
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC	
  EMP_ID
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PNR_LOCATOR
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5	
  RATE_ROOM1
  RESV_STATUS
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY COUNTRY
ON TABLE HOLD
RUN 
FILE HC2
SUM COUNTRY_NAME
BY COUNTRY_CODE
AFTER MATCH HOLD AS XONE OLD-AND-NEW
END
-RUN



DEFINE FILE XONE
RSV_ST/A1 = EDIT(RESV_STATUS, '9');
END
TABLE FILE XONE
SUM INV_DATE
    PASSNGR_NAME
    EMP_ID
    PROP_CITY
    PROP_STATE_CD
    COUNTRY
    COUNTRY_NAME
    IN_DATE
    OUT_DATE
    NNROOMS NUM_ROOMS
    LEVEL2
    LEVEL3
    LEVEL5
    PROP_NAME
BY PNR_LOCATOR
BY PASSNGR_NAME
BY PROP_CITY
BY PROP_NAME
BY IN_DATE
BY OUT_DATE
BY RSV_ST
ON TABLE HOLD AS HOLD3
END
-RUN



 
TABLE FILE HOLD3
SUM INV_DATE
    PASSNGR_NAME
    EMP_ID
    PROP_CITY
    PROP_STATE_CD
    COUNTRY
    COUNTRY_NAME
    IN_DATE
    OUT_DATE
    NNROOMS NUM_ROOMS
    LEVEL2
    LEVEL3
    LEVEL5
    PROP_NAME
BY PNR_LOCATOR
BY PASSNGR_NAME
BY PROP_CITY
BY IN_DATE
BY OUT_DATE
ON TABLE HOLD AS HOLD4
END
-RUN
  
 
DEFINE FILE HOLD4
FLAG/A1 = IF NNROOMS EQ 0 AND NUM_ROOMS EQ 0 THEN 'N' ELSE 'Y';
END
TABLE FILE HOLD4
SUM INV_DATE
    PASSNGR_NAME
    EMP_ID
    PROP_CITY
    PROP_STATE_CD
    COUNTRY
    COUNTRY_NAME
    IN_DATE
    OUT_DATE
    NNROOMS NUM_ROOMS
    LEVEL2
    LEVEL3
    LEVEL5
    PROP_NAME
BY PNR_LOCATOR
BY PASSNGR_NAME
BY PROP_CITY
BY IN_DATE
BY OUT_DATE
BY FLAG
WHERE FLAG EQ 'Y'
ON TABLE HOLD AS HC3
END
-RUN
 

-ContRpt;


-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = HC3;
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
DEFINE FILE HC3 ADD
NOWTOD/A8 WITH COUNTRY_NAME = HHMMSS (NOWTOD);
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE HC3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR



-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10


-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT




-AROUND2

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = CLCHOLD1;
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
DEFINE FILE CLCHOLD1 ADD
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE CLCHOLD1
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR


-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT
