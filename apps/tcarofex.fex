-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT
-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE

-INCLUDE SETECHO
SET ASNAMES = ON

-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED
-*========================================================================
-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';
DEFINE FILE &&EXTRACT
FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                      IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                      IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
IFLAG/A11 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE 'TRADITIONAL';
TRAD_FARE/D12.2CS = IF IFLAG EQ 'TRADITIONAL' THEN FARE_PAID ELSE 0;
TRAD_CNT/D8CS = IF IFLAG EQ 'TRADITIONAL' THEN NET_TKT_CNT ELSE 0;
ONL_FARE/D12.2CS = IF IFLAG EQ 'ONLINE' THEN FARE_PAID ELSE 0;
ONL_CNT/D8CS = IF IFLAG EQ 'ONLINE' THEN NET_TKT_CNT ELSE 0;

END

TABLE FILE &&EXTRACT
PRINT 
  FARE_PAID
  IFLAG
  NET_TKT_CNT
  ONL_FARE
  ONL_CNT
  TKT_NUM
  TRAD_FARE
  TRAD_CNT
BY AIR_KEY  
-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCOF 
END
-RUN


-INCLUDE TCUDAUSE
-RUN

TABLE FILE &&EXTRACT2
PRINT AUD_DATA AS 'OF_TCH' 
BY AIR_KEY
WHERE UDID EQ 'OFT'
ON TABLE HOLD AS TCUDH1 
END
-RUN




MATCH FILE TCOF
PRINT FARE_PAID
  IFLAG
  NET_TKT_CNT
  ONL_FARE
  ONL_CNT
  TKT_NUM
  TRAD_FARE
  TRAD_CNT
BY AIR_KEY
ON TABLE HOLD
RUN 
FILE TCUDH1
SUM OF_TCH
BY AIR_KEY
AFTER MATCH HOLD AS TCOF1 OLD
END
-RUN

DEFINE FILE TCOF1
OF_CNT/D8CS = IF OF_TCH EQ 'Y' THEN ONL_CNT ELSE 0;
OF_FARE/D12.2CS = IF OF_TCH EQ 'Y' THEN ONL_FARE ELSE 0;
END
TABLE FILE TCOF1
SUM FARE_PAID
  IFLAG
  NET_TKT_CNT
  ONL_FARE
  ONL_CNT
  OF_TCH
  TRAD_FARE
  TRAD_CNT
  OF_CNT
  OF_FARE
BY TKT_NUM
ON TABLE HOLD AS TCOF2
END
-RUN
 


-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACTED DATA FROM ABOVE
-*========================================================================
DEFINE FILE TCOF2
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCOF2
SUM FARE_PAID/D14.2CS
  NET_TKT_CNT
  TRAD_FARE
  TRAD_CNT
  ONL_FARE
  ONL_CNT
  OF_FARE
  OF_CNT
BY ROLLCD
ON TABLE HOLD AS TCOF3
END
-RUN



DEFINE FILE TCOF3
 NMB/I5 = NMB + 1;
END

TABLE FILE TCOF3
PRINT FARE_PAID
      NET_TKT_CNT
      TRAD_FARE
      TRAD_CNT
      ONL_FARE
      ONL_CNT
      OF_FARE
      OF_CNT
BY ROLLCD
BY NMB
ON TABLE HOLD AS TCOF4
END
-RUN

MODIFY FILE TCBKGOF
FIXFORM FROM TCOF4
MATCH ROLLCD NMB
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON TCOF4
END
-RUN


 



-NEXTONE
