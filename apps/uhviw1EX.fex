
-*4/18/14 - DEB -   ADDED HHL_CONFIRM CC_NUM LEVEL1 LEVEL3
-*4/23/14 - DEB - ADDED TRIP PURPOSE
-*2/19/15 - DEB - S-07532 ADDED LEVEL4 LEVEL5 LEVEL6 
-*9/28/15 JM S-11327 created for new report AVTHFILE which includes APP UDID
-*12/14/15 - DLV - S-13284   Updated to allow reports to sort/subtotal by id-levels
-* 02/23/16 - DLV - S-15155 - ADDED DAILY_RATE PREF_NON CHAIN_GROUP CITY_CODE
-*2/29/16-JEM - S-15155 ADDED CITY_NAME
-*4/12/16-JEM-S-17290 Carried through inv_date for new report TMHTLTEM 
-*4/14/16-JEM-S-17789 Carried through AROLL_DSC7 for RDFLHCH 
-*7/11/16 S-20630 DLV  Added EMP_ID to extract
-*08/11/17 - S-33540    DLV - ADDED PROP_CODE1 DEFINE 
-* 10/25/17     JEM         S-39364 Carrying thru new field TRAVELER_EMAIL

-INCLUDE SETECHO
-* Created for the UDID reports
 SET ASNAMES = ON
-SET HOLDATTR = ON;   
-RUN

-SET &&IDLEVELBREAK = ''; 
-RUN

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
  CHG_COD/A47 = IF LEVEL3 NE ' ' AND LEVEL2 NE ' ' THEN
                 LEVEL1  || '-' || LEVEL2 || '-' ||LEVEL3 ELSE
                 IF LEVEL3 EQ ' ' AND LEVEL2 NE ' ' THEN
                 LEVEL1  || '-' || LEVEL2 ELSE
                 IF LEVEL3 EQ ' ' AND LEVEL2 EQ ' ' THEN LEVEL1;
  CHN_GRP/A3 = CHAIN_GROUP;
  CITY_ST/A35 = PROP_CITY||(', '| PROP_STATE);
  LEVEL_DESC1/A60  = &&LDESC;
  ID_FLAG/A1 = IF CITY.INTL_DOM EQ 'D' THEN 'D' ELSE 'I';
  
  IN_DATE/MDYY = CHKIN_DATE;
  INV_DATE/MDYY = INVOICE_DATE;
  MIR_SEQ1/A1 = EDIT(MIR_SEQ, '9$$$$$');
  NBR_DAYS/D12 =  NUM_DAYS;
  NBR_ROOMS/D12 = NUM_ROOMS;
  NEW_ROOM_RATE/D14.2C = ROOM_RATE;
  NEW_STD_RATE/D14.2C = STD_RATE;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  OUT_DATE/MDYY = CHKOUT_DATE;
  REASON_CD/A2=EDIT(REFUSE_KEY,'$$$$$$$$99');
  REFUSE_CD/A2=EDIT(REFUSE_KEY,'$$$$$$$$99');
 RES_SYS/A1 = IF MIR_SEQ1 EQ 'X' THEN 'S' ELSE 'A';
  
  RSNCDE/A48=REASON_CD|| '-' ||REFUSAL_DESC;
  XPSNGR_NM/A15 =EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  PROP_ZIP5/A5=EDIT(PROP_ZIP, '99999$$$$$');
 PNP_FLAG/A1 = EDIT(EXCLUDE_FLAGS, '$9');
 PNP_IE/A1 = EDIT(EXCLUDE_FLAGS, '$$9');
 PREF_NON/A15 = IF PNP_FLAG EQ 'I'  THEN 'PREFERRED' ELSE 'NON-PREFERRED';
 -* ****DEFINES ON PREVIOUS DEFINES****
   BOOKINGS/D8 = IF NEW_TOTAL_AMT GT 0 THEN 1 ELSE (-1);
PROP_CODE1/A7 = IF RES_SYS EQ 'S' THEN PROP_SABRE_CODE ELSE PROP_APOLLO_CODE;
  
   TOTAL_STD/D12.2C = IF ((NNROOMS LT 0) AND (NEW_STD_RATE LT 0))
                      THEN ((NNROOMS * NEW_STD_RATE) * (-1))
                      ELSE NNROOMS * NEW_STD_RATE;

-* ****DEFINES ON PREVIOUS DEFINED DEFINES***
   TOTAL_SLSAV/D12.2C = TOTAL_STD - NEW_TOTAL_AMT;

-INCLUDE IDLEVDEFINE 
END
-RUN

TABLEF FILE &&EXTRACT
PRINT AROLL_DSC7
  BOOKINGS	
  BR_CL_IDX
  CC_NUM
  CHAIN_CODE
  CHAIN_NAME
  CHG_COD
  CHN_GRP
  CITY_CODE
  CITY_ST
  CITY_NAME
  DAILY_RATE
  DOD_TYPE
  EMP_ID
  HHL_CONFIRM
  HOTEL_PHONE 	
  HTL_KEY
  ID_FLAG
  IN_DATE 
  INV_DATE
  INVOICE_DATE 	
  INVOICE_NUM 	
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5 
  LEVEL6
  LEVEL7
  NBR_DAYS	
  NBR_ROOMS
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT	
  NNROOMS	
  NUM_ROOMS
  OUT_DATE 
  PASSNGR_NAME 
  PNR_LOCATOR 
  PREF_NON
  PROP_ADDRESS 	
  PROP_CITY
  PROP_CODE1 AS 'PROP_CODE'
  PROP_NAME 
  PROP_STATE_CD
  PROP_ZIP5
  RESV_STATUS
  REFUSAL_DESC	 
  REFUSE_CD
  REFUSE_CODE
  RESV_STATUS
  RSNCDE
  TRAVELER_EMAIL
  TRIP_PURPOSE
  TOTAL_SLSAV
  TOTAL_STD 
  XPSNGR_NM
  
-INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

-* ON TABLE HOLD AS HTLHOLD1
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


 

 
 