-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*4/24/14  DEB  ADDED LEVEL4
-*4/25/2017-JEM-S-33318-updated logic for no records report

-INCLUDE SETECHO

-INCLUDE SETECHO
-SET ASNAMES = ON;
-SET HOLDATTR = ON;
-RUN

-SET &&OCFLG = 'N';
-SET &&OCFLG2 = 'N';
-SET &&ACFLG = 'N';

DEFINE FILE &&EXTRACT
BKD_ONLINE/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';
-* BKD_ONLINE/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';
CLIENTCODE/A8 = '&&ROLLUP.EVAL';
  XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  PAX/A5 = EDIT(XPSNGR_NM, '99999$$$$$$$$$$');
  LINE_DESC/A38 = XPSNGR_NM||TKT_NUM||PNR_LOCATOR|' '|'C';
  FEE/P5.2S = IF BKD_ONLINE EQ 'Y'  AND TKT_NUM EQ '0000000000' AND PNR_LOCATOR NE LAST PNR_LOCATOR THEN 5 ELSE 0;
  VND_NAME/A30 = VENDOR_NAME;
  PHONE/A15 = '               ';
  ADDRESS/A30 = '                              ';
END
-RUN

TABLEF FILE &&EXTRACT
PRINT ADDRESS
  AGENT_NUM
  AR_BRANCH
  CCR_CONFIRM AS 'CONFIRM'
  CLIENTCODE AS 'ROLLUP'
  CLIENT_NUM
  DROP_DATE AS 'DO_CKOUT_DT'
  GRAND_MSTR_CODE
  MSTR_GRP_CODE
  GROUP_CODE
  TICKET_BRANCH
  MIR_SEQ
  ACCT_TYPE
  LEVEL1
  LEVEL3
  LEVEL4
  INVOICE_NUM
  PMT_TYPE
  CREDIT_CARD
  RESV_BRANCH
  RENTAL_AMT AS 'AMOUNT'
  RESV_STATUS  
  INVOICE_DATE
  LEVEL2
  LINE_DESC
  PAX
  PICKUP_CITY AS 'CITY'
  PICKUP_DATE AS 'PCKUP_CKIN_DT'
  PICK_CTY.CITY_NAME/A25 AS 'CTY_NAME'	
  PICK_CTY.STATE_CODE AS 'STATE_CODE'
  PHONE
  PNR_LOCATOR
  TKT_NUM
  VND_NAME AS 'VCHN_NAME'
  VENDOR_CODE AS 'VCHN_CODE'
  XPSNGR_NM


WHERE (INVOICE_DATE GE &&FXDATE.EVAL) AND (INVOICE_DATE LE &&TXDATE.EVAL)
-* WHERE TKT_NUM EQ '0000000000'
WHERE BKD_ONLINE EQ 'Y'

-********************************************************************
-* Where statements to select data specified in user profile
-* *******************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10




-INCLUDE RPTPARMS
ON TABLE HOLD AS CARHLD
END
-RUN


-SET &&CARREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
-IF &LINES EQ 0 THEN GOTO NOCar;

DEFINE FILE CARHLD
FEE/A1 = 'N';
FLAG/A1 = 'C';
END
TABLE FILE CARHLD
PRINT ADDRESS
   ACCT_TYPE
   AGENT_NUM
   AR_BRANCH
   CONFIRM
   CLIENT_NUM
   CREDIT_CARD
   DO_CKOUT_DT
   FEE
   FLAG
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   CTY_NAME
   CITY
   PHONE
   PCKUP_CKIN_DT
   PMT_TYPE
   PNR_LOCATOR
   AMOUNT
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY PNR_LOCATOR
ON TABLE HOLD AS CARHLD2
END
-RUN


-IF &&OAFLG EQ 'Y' THEN GOTO NOAIR;

MATCH FILE CARHLD2
PRINT ADDRESS
   ACCT_TYPE
   AGENT_NUM
   AR_BRANCH
   CONFIRM
   CLIENT_NUM
   CREDIT_CARD
   DO_CKOUT_DT
   FEE
   FLAG
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   CTY_NAME
   CITY
   PHONE
   PCKUP_CKIN_DT
   PMT_TYPE
   PNR_LOCATOR
   AMOUNT
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY PNR_LOCATOR
ON TABLE HOLD
RUN
FILE ONLAIRT
SUM AIR
BY PNR_LOCATOR
AFTER MATCH HOLD AS CARTRN OLD-AND-NEW
END
-RUN

DEFINE FILE CARTRN
CAR/A1 = 'Y';
END
TABLE FILE CARTRN
PRINT ADDRESS
   ACCT_TYPE
   AGENT_NUM
   AIR
   AR_BRANCH
   CAR
   CONFIRM
   CLIENT_NUM
   CREDIT_CARD
   DO_CKOUT_DT
   FEE
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   CTY_NAME
   CITY
   PHONE
   PCKUP_CKIN_DT
   PMT_TYPE
   PNR_LOCATOR
   AMOUNT
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY FLAG
ON TABLE HOLD AS CARTRN1 FORMAT FOCUS
END
-RUN


DEFINE FILE CARHLD
FEE/A1 = IF TKT_NUM EQ '0000000000' AND PNR_LOCATOR NE LAST PNR_LOCATOR THEN 'Y' ELSE 'N';
FLAG/A1 = 'C';
END

TABLE FILE CARHLD
PRINT ADDRESS
   ACCT_TYPE
   AGENT_NUM
   AR_BRANCH
   CONFIRM
   CLIENT_NUM
   CREDIT_CARD
   DO_CKOUT_DT
   FEE
   FLAG
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   CTY_NAME
   CITY
   PHONE
   PCKUP_CKIN_DT
   PMT_TYPE
   PNR_LOCATOR
   AMOUNT
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY PNR_LOCATOR
ON TABLE HOLD AS CARHLD3
END
-RUN



MATCH FILE CARHLD3
PRINT ADDRESS
   ACCT_TYPE
   AGENT_NUM
   AR_BRANCH
   CONFIRM
   CLIENT_NUM
   CREDIT_CARD
   DO_CKOUT_DT
   FEE
   FLAG
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   CTY_NAME
   CITY
   PHONE
   PCKUP_CKIN_DT
   PMT_TYPE
   PNR_LOCATOR
   AMOUNT
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY PNR_LOCATOR
ON TABLE HOLD
RUN
FILE ONLAIRT
SUM AIR
BY PNR_LOCATOR
AFTER MATCH HOLD AS CARTRN2 OLD-NOT-NEW
END
-RUN

DEFINE FILE CARTRN2
AIR/A1 = IF AIR EQ ' ' THEN 'N' ELSE 'Y';
CAR/A1 = 'Y';
END
TABLE FILE CARTRN2
PRINT ADDRESS
   ACCT_TYPE
   AGENT_NUM
   AIR
   AR_BRANCH
   CAR
   CONFIRM
   CLIENT_NUM
   CREDIT_CARD
   DO_CKOUT_DT
   FEE
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   CTY_NAME
   CITY
   PHONE
   PCKUP_CKIN_DT
   PMT_TYPE
   PNR_LOCATOR
   AMOUNT
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY FLAG
ON TABLE HOLD AS CARTRN3 FORMAT FOCUS
END
-RUN


-SET &&OCFLG2 = IF &LINES EQ 0 THEN 'Y' ELSE 'N';
-SET &&ACFLG = IF &&OAFLG EQ 'N' AND &&OCFLG2 EQ 'N' THEN 'Y' ELSE 'N';
-IF &LINES EQ 0 THEN GOTO ONLYCar;


TABLE FILE CARTRN3
SUM PNR_LOCATOR CAR
BY PNR_LOCATOR NOPRINT
ON TABLE HOLD AS ONCAR
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HA=&HLDPATH || 'CARTRN1.FOC';
-SET &HC=&HLDPATH || 'CARTRN3.FOC';

-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN 

USE ADD 
&HA AS CARTRN1
&HC AS CARTRN1
END
-RUN


-ONLYCar

TABLE FILE CARTRN1
PRINT   
   ACCT_TYPE
   ADDRESS
   AGENT_NUM
   AIR
   AMOUNT
   AR_BRANCH
   CAR
   CITY
   CLIENT_NUM
   CONFIRM
   CREDIT_CARD
   CTY_NAME
   DO_CKOUT_DT
   FEE
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   PCKUP_CKIN_DT
   PHONE
   PMT_TYPE
   PNR_LOCATOR
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY FLAG
ON TABLE HOLD AS ONLNCAR FORMAT FOCUS
END
-RUN


-GOTO END;


-NOAIR

DEFINE FILE CARHLD2
AIR/A1 = 'N';
CAR/A1 = 'Y';
FEE/A1 = IF TKT_NUM EQ '0000000000' AND PNR_LOCATOR NE LAST PNR_LOCATOR THEN 'Y' ELSE 'N;
END
TABLE FILE CARHLD2
PRINT   
   ACCT_TYPE
   ADDRESS
   AGENT_NUM
   AIR
   AMOUNT
   AR_BRANCH
   CAR
   CITY
   CLIENT_NUM
   CONFIRM
   CREDIT_CARD
   CTY_NAME
   DO_CKOUT_DT
   FEE
   GRAND_MSTR_CODE
   GROUP_CODE
   INVOICE_DATE
   INVOICE_NUM
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LINE_DESC
   MIR_SEQ
   MSTR_GRP_CODE
   PAX
   PCKUP_CKIN_DT
   PHONE
   PMT_TYPE
   PNR_LOCATOR
   RESV_BRANCH
   RESV_STATUS
   ROLLUP
   STATE_CODE
   TICKET_BRANCH
   TKT_NUM
   VCHN_CODE
   VCHN_NAME
   XPSNGR_NM
BY FLAG
ON TABLE HOLD AS ONLNCAR FORMAT FOCUS
END
-RUN

-NOCar

-END



