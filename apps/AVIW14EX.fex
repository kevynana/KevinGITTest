-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AVIW23EX.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*
-* This program extracts data for the series of basic ticket listing
-* reports.  Based on the user profile selected, one of many report
-* formats will be produced.  
-* 12/29/04 - DEB - ADDED FILEDEF FOR FUJI REPORT - DEB
-* 1/25/05  - DEB - ADDED CODE FOR GLOBAL CURRENCY
-* ADDED TRANTYPE INCLUDE - JK 12/9/14 STORY ID S-06492
-*7/15/16 -DLV -  S-20630   Added EMP_ID commented out EMP_NBR
-*09/25/2017 - DLV - S-37268 - Added defines for ND_ORG_CD ND_DST_CD

-********************************************************************

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
-SET &RPARM = &&WEB_PATH || 'RPTPARMS.fex';

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';



DEFINE FILE &&EXTRACT
DEPT/A3 = IF TKT_DATE GE '2009/02/17' THEN EDIT(LEVEL1, '999') ELSE '000';
-*EMPNBR/A4 = EDIT(LEVEL2, '9999');
-*EMP_NBR/A4 = IF EMPNBR EQ '0000' THEN '9000' ELSE EMPNBR;
PROJ_NBR2/A8 = EDIT(LEVEL1, '$$$99999999');
PROJ_NUM/I2 = ARGLEN(8, PROJ_NBR2, PROJ_NUM);
PROJ_NBR3/A8 = IF PROJ_NUM EQ 1 THEN '00000000' ELSE PROJ_NBR2;
PROJ_NBR/A8 = IF PROJ_NBR3 CONTAINS 'PPPP' THEN '00000000' ELSE PROJ_NBR3;
FUND_SRC2/A4 = EDIT(LEVEL1, '$$$$$$$$$$$9999');
FUND_SCE/I2 = ARGLEN(4, FUND_SRC2, FUND_SCE);
FUND_SRC/A4 = IF FUND_SCE EQ 0 THEN '0000' ELSE 
              IF FUND_SRC2 CONTAINS 'FFFF' THEN '0000' ELSE FUND_SRC2;
FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
LEVEL_DESC/A60      = &&LDESC;
MRK_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
 NEW_SEG_MILES/D9= SEG_MILES;
 TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                           (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                         IF (SEG_COUNT LE 0) AND 
                           (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                         IF (SEG_COUNT LE 0) AND 
                           (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                         IF (SEG_COUNT LE 0) AND 
                           (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';

 XDPT_DT/MDYY         = DPT_DATE;
 XDPT_DATE/MDY        = DPT_DATE;
 XPSNGR_NM/A14        = 
    EDIT(PASSNGR_NAME,'99999999999999$$$$$$$$$$$$$$$$$$');
 XTRAN_DT/MDYY        = TRN_DATE;
ND_ORG_CD/A3 = ND_ORG;
ND_DST_CD/A3 = ND_DST; 
-INCLUDE TRANTYPE 
END
-RUN


TABLEF FILE &&EXTRACT
PRINT 
  AIR_KEY	
  AIRLINE	
  AIRLINE_NAME
  CITYPAIR.EMBARK AS 'DIR_APT_CDO'
  CITYPAIR.ROUTE AS 'DIR_APT_CDD'
  DPT_TIME
  DEPT
  EMB_CTY.CITY_NAME    AS 'EMB_CTY_NM'
  EMP_ID
-*  EMP_NBR
  FST_DPT_DATE
  FARE_PAID
  INT_CODE
  LEVEL_DESC
  LEVEL1
  LEVEL2
  MRK_TKT_CNT
  ND_ORG_CD
  ND_DST_CD
  NEW_SEG_MILES
  PASSNGR_NAME
  PROJ_NBR  
  FUND_SRC
  XPSNGR_NM
  REFUSE_CODE	
  RTE_CTY.CITY_NAME    AS 'RTE_CTY_NM'	
  SEG_COUNT	
  SEG_NBR	
  TKT_NUM
  TKT_SORT
  TKT_TYPE
  TRN_DATE	
  XDPT_DT	
  XDPT_DATE
  XPSNGR_NM
  XTRAN_DT	


-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


