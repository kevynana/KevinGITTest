-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-*-INCLUDE SETECHO
-* File BZLIMHF.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*
-* This program extracts data for the series of basic LIMO verndor listing
-* reports.  Based on the user profile selected, one of many report
-* formats will be produced.  
-* 04/09/12 - DV - CREATED FROM TKTLIM
-*1/28/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE

-********************************************************************
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN


 

-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

DEFINE FILE &&EXTRACT
  BLANK4/A4 ='    ';
  BLANK3/D12.2CS= IF LIM_MAIN.CONTRACT_RATE GT 0 THEN 0 ELSE 0;
  BLANK/A4 = '    ';
  BLANK2/A11 = '           ';
  CCA_CARD/A7 = EDIT(CREDIT_CARD, '99$$$$$$$$$$99999');
  CC/A2 = EDIT(CREDIT_CARD, '99$$$$$$$$$$$$$$$$');
  CC_NUM1/A6 = EDIT(CREDIT_CARD, '999999$$$$$$$$$$$$');
  CCNUM2/A4 = IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$9999$')
             ELSE EDIT(CREDIT_CARD, '$$$$$$$$$$$$$$9999');
  CC_NUM/A18 = IF CREDIT_CARD EQ ' ' THEN ' ' ELSE CC_NUM1|'XXXXXXXX'|CCNUM2; 
  CHG_COD/A47 = IF LEVEL3 NE ' ' AND LEVEL2 NE ' ' THEN
                    LEVEL1  || '-' || LEVEL2 || '-' ||LEVEL3 ELSE
                    IF LEVEL3 EQ ' ' AND LEVEL2 NE ' ' THEN
                    LEVEL1  || '-' || LEVEL2 ELSE
                    IF LEVEL3 EQ ' ' AND LEVEL2 EQ ' ' THEN LEVEL1;
  CLASS/A2 = '  ';
  DISSAVINGS/D11.2CS = 0;                    
  LEVEL_DESC/A60 = &&LDESC;
  OTFLAG/A15 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE 'TRADITIONAL';
  SEG/A2 = '  ';
  DROP_OFF_DT/MDYY = DROP_DATE;	
  INV_DATE/MDYY = INVOICE_DATE;
  NBR_DAYS/D12 = NUM_DAYS;
  NEW_RENTAL_AMT/D12.2CS = RENTAL_AMT;
  PICK_UP_DT/MDYY = PICKUP_DATE;
  RENTAL_DAYS/D12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
  VENDR_NM/A30 = VENDOR_NAME;
  TRIP_PURPOSE/A2 = ' ';
  PADV/P9S = 0;
  LOW_AMT/D12.2CS = 0;
  VASAV/D12.2CS = 0;
  FDATE/MDYY = PICK_UP_DT;
  HOME_F1/D12.2CS = 0;
  
-* ****DEFINES ON PREVIOUS DEFINES****


 
END
-RUN

TABLEF FILE &&EXTRACT
PRINT  
  BLANK3 AS 'FEE' 
  BLANK AS 'TYPE'
  BLANK2 AS 'TSORT'
  BLANK4 AS 'AIRT'
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CLASS
  CURR_DATE
  DISSAVINGS AS 'LOST_AMT'
  DROP_CTY.CITY_NAME AS 'CITY2'  
  INV_DATE AS 'TRAN_DATE'
  INVOICE_DATE
  FDATE
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LOW_AMT
  NEW_RENTAL_AMT
  OTFLAG
  PADV
  PASSNGR_NAME
  REFUSE_CODE
  PICK_CTY.CITY_NAME AS 'CITY1'
  PICK_UP_DT AS 'DATE'
  PNR_LOCATOR
  SEG
  RENTAL_DAYS AS 'TTL_COUNT'
  TKT_NUM
  TRIP_PURPOSE
  VENDR_NM AS 'NAME'
  PICK_CTY.GEO_ZONE AS 'GEO_ZONE'
  VASAV
  HOME_F1
-INCLUDE &CARDATES
-********************************************************************
-* Where statements to select data specified in user profile
-* *******************************************************************
-* &&WHERE1
-* &&WHERE2
-* &&WHERE3
-* &&WHERE4
 &&WHERE5
 &&WHERE6
-* &&WHERE7
-* &&WHERE8
-* &&WHERE9
-* &&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS LIMHOLD
END
-RUN



TABLE FILE LIMHOLD
PRINT AIRT
  CHG_COD
  CCA_CARD
  CC_NUM
  CCNUM2
  FEE 
  TYPE
  TSORT
  CITY2 
  CLASS
  TRAN_DATE
  INVOICE_DATE
  FDATE
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LOST_AM
  LOW_AMT 
-* NEW_RENTAL_AMT AS 'AMOUNT'
  NEW_RENTAL_AMT
  OTFLAG
  PADV
  PASSNGR_NAME
  REFUSE_CODE
  CITY1
  DATE
  PNR_LOCATOR
  SEG
  TTL_COUNT
  TKT_NUM
  NAME
  GEO_ZONE
  TRIP_PURPOSE
  VASAV
  HOME_F1
BY CURR_DATE
ON TABLE HOLD AS LIMHOLD1 FORMAT FOCUS INDEX CURR_DATE
END
-RUN

-* Global Reporting JOIN
JOIN LIMHOLD1.CURR_DATE IN LIMHOLD1 TO GLOBAL.DATE IN GLOBAL AS J1
END

DEFINE FILE LIMHOLD1

 NAMEC/A30 = CNAME;


-******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;

-* DEFINES ON PREVIOUS DEFINES
AMT_RENTALX/D20.6 = NEW_RENTAL_AMT * CURR1X;
FEEX/D20.6 = FEE * CURR1X;

END 

TABLE FILE LIMHOLD1
PRINT AIRT
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CLASS
  CURR_DATE 
  FEE
  FEEX/D16.2CS 
  TYPE
  TSORT
  CITY2  
  TRAN_DATE
  INVOICE_DATE
  FDATE
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LOST_AMT
  LOW_AMT
  NEW_RENTAL_AMT AS 'AMOUNT'
  OTFLAG
  PADV
  PASSNGR_NAME
  REFUSE_CODE
  CITY1
  DATE
  PNR_LOCATOR
  SEG
  TTL_COUNT
  TKT_NUM
  NAME
  NAMEC
  AMT_RENTALX/D16.2CS AS 'GAMOUNT'
  GEO_ZONE
  TRIP_PURPOSE
  VASAV
  HOME_F1
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS LIMHOLD3
END
-RUN
 

DEFINE FILE LIMHOLD3
FLAG/A1 = 'L';
END

TABLE FILE LIMHOLD3
PRINT 
  PASSNGR_NAME
  PNR_LOCATOR
  TRAN_DATE
  TKT_NUM
  TSORT
  TYPE
  SEG      
  NAME
  DATE
  AIRT
  CITY1
  CITY2
  AMOUNT
  FDATE
  GAMOUNT
  FEE
  FEEX  
  TTL_COUNT
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LOST_AMT
  LOW_AMT
  NAMEC
  GEO_ZONE
  TRIP_PURPOSE
  CHG_COD
  PADV
  OTFLAG
  CCA_CARD
  CC_NUM
  REFUSE_CODE
  VASAV
  CLASS
  CCNUM2
  HOME_F1
BY FLAG
ON TABLE HOLD AS HOLDL FORMAT FOCUS
END
-RUN

-Skipit;

