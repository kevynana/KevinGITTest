-*04/15/2008 - Data Vault Reports
-* 5/10/10 - changed Level1 to be handled like all other Levels - Deb
-* 5/1/14 - tested to find error on Expense Report - JK
-*7/31/14 - un commented out DEFAULT &GETPROFEXP - DEB
-*  06/26/2015  REJ  S-08389 Latest changes for ER5 Available Reports.
-*7/13/16 -DLV -  S-20630   Added &EMPID variable to be available on final report
-* 08/01/2016 - DLV - S-21658 Added 'Not Available' to variable &LV1 &LV2 &LV3
-*                                   &LV4 &LV5 &LV6 &LV7
-INCLUDE SETECHO
-*SET TEMPERASE = OFF
 
EX SETDBLS SETFILE=&&SETF 
-RUN
-INCLUDE OTHPARMS
-SET &&DRILLABLE = 'N';
-SET &&RPT_HOLD = 'RPTHOLD';
-SET &OUTDEST = EDIT('&&OUTTO.EVAL','9$');
 
-SET &&OUTLINE1 = IF '&OUTDEST.EVAL' EQ 'E' OR '&OUTDEST.EVAL' EQ 'T'
- THEN 'ON TABLE SAVE AS SAVREP FORMAT EXL2K'
- ELSE 'ON TABLE PCHOLD FORMAT EXL2K';
-SET &&OUTLINE2 = '';
 
-INCLUDE SETPARMTIME
-SET &&RPTSUF = 'DVR';
-INCLUDE FDEFRPTS
-RUN
 
-SETWEB
-SET &&WEBPATH = '&&WEBSRV.EVAL' || '\TTWEB\ ' || &&ROLLUP || '\ '||&&UNAME.EVAL|| '\';
-SET &&SETFNM = &&WEBPATH || &&DTTMSTRM ||'.FTM';
 
COPY &&VARFWEB &&SETFNM
-*-INCLUDE SetBDBsForDrill
-RUN
 
FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN
 
-INCLUDE SELCATQT
-RUN
 
EX &&CATQTRPR
-RUN
 
FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN
 
SET EMPTYREPORT = ON
DEFINE FILE ROLLUP
LV1/A20 = UPCASE(20, LEV1, LV1);
LV2/A20 = UPCASE(20, LEV2, LV2);
LV3/A20 = UPCASE(20, LEV3, LV3);
LV4/A20 = UPCASE(20, LEV4, LV4);
LV5/A20 = UPCASE(20, LEV5, LV5);
LV6/A20 = UPCASE(20, LEV6, LV6);
LV7/A20 = UPCASE(20, LEV7, LV7);
EMPID/A20 =  UPCASE(20, EMPID_DESC, EMPID);
END
TABLE FILE ROLLUP
PRINT LV1 LV2 LV3 LV4 LV5 LV6 LV7 EMPID COMP QTR_ENABLE ROLL_NAME
WHERE ROLLUP EQ '&&ROLLUP.EVAL'
ON TABLE SAVE AS ROLLLEV
END
-RUN
 
 
-READ ROLLLEV &&LV1.A20. &&LV2.A20. &&LV3.A20. &&LV4.A20. &&LV5.A20. &&LV6.A20. &&LV7.A20. &&EMPID.A20. &&COMPNY.6. &&QTRENAB.1. &&ROLLNAME.25.
-CLOSE ROLLLEV
 
-SET &LEV1 = '&&LV1.EVAL';
-SET &LEV2 = '&&LV2.EVAL';
-SET &LEV3 = '&&LV3.EVAL';
-SET &LEV4 = '&&LV4.EVAL';
-SET &LEV5 = '&&LV5.EVAL';
-SET &LEV6 = '&&LV6.EVAL';
-SET &LEV7 = '&&LV7.EVAL';
-SET &EMP_ID = '&&EMPID.EVAL';
 
-SET &&LV1 = IF '&LEV1.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE' THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV1.EVAL''';
-SET &&LV2 = IF '&LEV2.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE'  THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV2.EVAL''';
-SET &&LV3 = IF '&LEV3.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE'  THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV3.EVAL''';
-SET &&LV4 = IF '&LEV4.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE'  THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV4.EVAL''';
-SET &&LV5 = IF '&LEV5.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE'  THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV5.EVAL''';
-SET &&LV6 = IF '&LEV6.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE'  THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV6.EVAL''';
-SET &&LV7 = IF '&LEV7.EVAL' EQ 'NOT USED' OR 'NOT AVAILABLE' OR 'GLOBAL DATA KEY' THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&LEV7.EVAL''';
-SET &EMPID = IF '&EMP_ID.EVAL' EQ ' ' THEN 'NOPRINT' ELSE 'AS' | ' ' | '''&EMP_ID.EVAL'''; 
 
-SET &&TRIPPRP = IF '&&ROLLUP.EVAL' NE 'SURGIC-R' THEN 'NOPRINT' ELSE 'AS' | ' ' | '''TRIP,PURPOSE''';
-SET &&TRIPRSN = IF '&&ROLLUP.EVAL' NE 'SURGIC-R' THEN 'NOPRINT' ELSE 'AS' | ' ' | '''TRIP,DESC''';
 
 
 

-INCLUDE CODEDVR
-RUN
 
-*set default value for pro fee
-SET &AIRPROF =  'N';
-SET &CARPROF =  'N';
-SET &HTLPROF =  'N';
-SET &MISCPROF = 'N';
-DEFAULT &GETPROFEXP = 'Y';
 
 

-IF &GETPROFEXP EQ 'N' THEN GOTO CHKAIREXP;
-*get professional fee
-INCLUDE DVRPFUSE
-RUN


 

-CHKAIREXP
-*Expense Report
-Expense
 
 
-IF &&FROMAVRP NE 'Y' GOTO :DV01;
-SET &&RPTGRP_OVERRIDE='AIR';
EX CODEGEN
-RUN
-:DV01
 
EX AIRUSE
-RUN
-SET &&RPTGRP = 'AIR';
 
-INCLUDE DVRAIREX
-RUN
 
 
-CHKCAREXP
 
-IF &&FROMAVRP NE 'Y' GOTO :DV02;
-SET &&RPTGRP_OVERRIDE='CAR';
EX CODEGEN
-RUN
-:DV02
 
EX CARUSE
-RUN
 
-SET &&RPTGRP = 'CAR';
-INCLUDE DVRCAREX
-RUN
 
EX LIMUSE
-RUN
 
 
-INCLUDE DVRLIMEX
-RUN
 
 
-CHKHTLEXP
 
-IF &&FROMAVRP NE 'Y' GOTO :DV03;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-RUN
-:DV03
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
-INCLUDE DVRHTLEX
-RUN
 
 
 
-MergerEXP
-*Merger Air, Car, Hotel and Pro fee hold files together for expense report
-INCLUDE DVREXPHLD
-RUN
 
 

-*EX DVSUM
-*EX DVREXPENSE
-*-RUN
 
-*Cost Savings Report
-CostSavings
-SET &&RPTGRP = 'AIR';
 
-IF &&FROMAVRP NE 'Y' GOTO :DV04;
-SET &&RPTGRP_OVERRIDE='AIR';
EX CODEGEN
-RUN
-:DV04
 
EX AIRUSE
-RUN
 
-INCLUDE AVI128EX
-RUN
 
-*using different branches in the AVI128DT than Air Detail
-*EX AVI128DT
-*-RUN
 
-INCLUDE DVRAIRHLD
-RUN
 
-SET &&SETF = 'DVCSAV';
-*generate two hold files DVRAIRCS for Cost Savings, AIRHOLD3 for Air Detail
-INCLUDE DVRAIRCS1
-*-RUN
-*Air Detail
-AirDetail
-*EX AIRUSE
-*-RUN
 
-*EX AVI128EX
-*-RUN
 
-*EX AVI128DT
-*-INCLUDE DVRAIRHLD
-*-RUN
 
-*-INCLUDE DVRAIRDT
-* -RUN
 
-*Car Detail
-CatDetail
 
-IF &&FROMAVRP NE 'Y' GOTO :DV05;
-SET &&RPTGRP_OVERRIDE='CAR';
EX CODEGEN
-RUN
-:DV05
 
-SET &&RPTGRP = 'CAR';
EX CARUSE
-RUN
 
-INCLUDE CVIW14EX
-RUN
 
-*EX CVIW14DT
-*EX DVRCARDT
-*-RUN
 
-*Hotel Detail
-HtlDetail
 
-IF &&FROMAVRP NE 'Y' GOTO :DV06;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-RUN
-:DV06
 
-SET &&RPTGRP = 'HTL';
EX HTLUSE
-RUN
 
-INCLUDE HVIW22EX
-RUN
 
-*EX HVIW22DT
-*EX DVRHTLDT
-*-RUN
 
-*Exchange
-Exchange
 
-IF &&FROMAVRP NE 'Y' GOTO :DV07;
-SET &&RPTGRP_OVERRIDE='AIR';
EX CODEGEN
-RUN
-:DV07
 
EX AIRUSE
-RUN
 
-SET &&RPTGRP = 'AIR';
-SET &&SETF = 'DVEXCHG';
-INCLUDE AVI129EX
-RUN
-*-INCLUDE AVI129DT
 
 
-INCLUDE DVREXCHGHLD
-RUN
 
-*-INCLUDE DVREXCHG
-*-RUN
 
-*HOLD AIRHOLD3 FOR AIR DETAIL
-INCLUDE DVRAIRHLD3
-RUN
 
-*HOLD CARHOLD3 FOR CAR DETAIL
-INCLUDE DVRCARHOLD3
-RUN
 
-SET &&SAVEDXLS = &&WEB_PATH || 'DVR.xls';
FILEDEF SAVEXLS DISK &&SAVEDXLS
-RUN
-SET &&SAVEDXLS2 = &&WEB_PATH || 'DVR2.xls';
FILEDEF SAVEXLS2 DISK &&SAVEDXLS2
-RUN
 
-*Unused Tickets
-TYPE &&OUTLINE1
-TYPE &&OUTTO
 
 
 
 
 
 
-IF '&&OUTTO.EVAL' NE 'XB' THEN GOTO EXTEMP ELSE GOTO EXCOMP;
 
-*Compound Excel2k
-*DVRMULTIS does not work with ReportCaster
-EXCOMP
 
-INCLUDE DVRMULTIS
-GOTO FINCOMP;
 
 
-EXTEMP
 
 
 
-INCLUDE DVRTemplate
-RUN
 
-FINCOMP
 
-*if email or server is selected, resave the file to excel97 format.
-SET &OUTDEST = EDIT('&&OUTTO.EVAL','9$');
-IF '&OUTDEST.EVAL' EQ 'E' OR '&OUTDEST.EVAL' EQ 'T' THEN GOTO RESAVEIT ELSE GOTO XXXIT;
-RESAVEIT
-SET &FILEFMT02 = &&SAVSUM;
-SET &FILEFMT97 = '"'| &&TEMPPATH || &DTTMIID ||  '_97' || &&XTN.EVAL || '"' ;
-*-DOS COPY &&SAVEDXLS &FILEFMT97;
-DOS COPY &&SAVEDXLS &&SAVSUM
 
-*-SET &FILEFMT02 = &&SAVEDXLS;
-*-SET &FILEFMT97 = &&SAVEDXLS2;
-*-SET &FILEFMT97 = &&SAVSUM;
 
-*-DOS D:\tnt\Mnt\PushTeck\ReSaveXLS.vbs &FILEFMT02 &FILEFMT97
-*-DOS D:\ibi\apps\PushTeck\ReSaveXLS.vbs &FILEFMT02 &FILEFMT97
-*-DOS COPY &FILEFMT97 &&SAVSUM;
 
 
-RUN
 
-XXXIT
