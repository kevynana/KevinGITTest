-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-*2/05/01      TANDT-SS             ADD BASE_FARE, DEPT_MONTH, SEG_DESIG 
-*                                  AND TOUR_CODE.
-*5/10/01      TANDT-SS             ADD EMB_APT_CD AND RTE_APT_CD.
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*11/12/04    DEB               ADDED CODE FOR GLOBAL CURRENCY 
-**********************************************************************

SET ASNAMES = ON
-RUN

-IF &&CURRENCY EQ 'USD' THEN GOTO NEXT;

-SET &&SUBHEAD = <NAMEC;
-SET &FPAID_CUR = 'FARE PAID, (' | &&CURRENCY || ')';
-SET &GCPK_CUR= 'COST,/KLMTR, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2='PAID_MFAREX/D16.2CS AS ' | '''&FPAID_CUR.EVAL'''  ;
-SET &&S_SUBJ4='PCT.PAID_MFAREX/D8.2 AS ''% OF,FARE,PAID''';
-SET &&S_SUBJ5='PAID_YFAREX/D16.2CS AS ' | '''&FPAID_CUR.EVAL'''  ;
-SET &&S_SUBJ6='PCT.PAID_YFAREX/D8.2 AS ''% OF,FARE,PAID''';

-NEXT;
-IF '&&SETF.EVAL' EQ 'MXAVDYYR' THEN GOTO METX2;


TABLE FILE YRAIRCLS
SUM BASE_FARE/D12.CS AS 'TBASE'
    DISSAVINGS/D12.2CS AS 'TLOSS'	
    FARE_PAID/D12.2CS AS 'TFARE'
    PAID_FAREX/D16.2CS AS 'GTFARE'	
    GROSS_DSAVE AS 'GDSAV'	
    GROSS_FARE AS 'GFARE'	
    MFARE_PAID/D12.2CS AS 'MFARE'
    PAID_MFAREX/D16.2CS AS 'GMFARE'
    MTKT_CNT/D8CS AS 'MTKT'
    NET_TKT_CNT AS 'NTTKT'	
    NET_TKT_CNT1 AS 'NTTKT1'	
    NEW_ADV_PURCH AS 'TADV'	
    NEW_SEG_COUNT/D8CS AS 'TSEG'	
    REF_E_CNT AS 'TREX'	
    REF_EXCH_CNT AS 'TRFEX'	
    SAVINGS/D12.2CS AS 'TSVGS'	
    SEG_LOWEST/D12.2CS AS 'TLOW'	
    SEG_STANDARD/D12.2CS AS 'TSTD'	
    TKT_PURCH AS 'TTKT'	
    YFARE_PAID/D12.2CS AS 'YFARE'
    PAID_YFAREX/D16.2CS AS 'GYFARE'
    YTKT_CNT/D8CS AS 'YTKT'
 BY LEVEL_DESC    
ON TABLE HOLD AS HOLDONE
END
-RUN


TABLE FILE YRAIRCLS
PRINT ABOOK_CNT
  ABOOK_FARE
  AIR_KEY	
  AIRLINE_FEE
  AIRLINE_NAME	
  AR_BRANCH
  AROLL_DSC5
  AUX_NON_MIR
  BASE_FARE	
  BOOK_DT
  BR_CL_IDX	
  CCARD6
  CLASS	
  CLASS_CAT	
  CLIENT_NAME
  CLIENT_NUM
  COUNTRY_CODE
  CREDIT_CARD
  DEPT_MONTH
  DEPT_YEAR	
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DOD_PAX_CAT
  DPT_DAY
  EMB_APT_CD
  EMB_APT_NM
  EMB_STATE
  EMB_CTY_NM	
  FARE_BAS
  FARE_PAID	
  GROUP_CODE
  GROSS_DSAVE	
  GROSS_FARE	
  IBOOK
  IBOOK_CNT
  IBOOK_FARE
  INT_CODE
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL_HIE
  NAMEC	
  MFARE_PAID
  MLST_SV
  MON_TKT
  MONL_CNT
  MONL_FARE
  MTRAD_CNT
  MTRAD_FARE  
  MTKT_CNT
  MRK_TKT_CNT	
  MTG_NUM
  ND_CITY_NM
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  ORG_DST
  PAID_FAREX/D16.2CS
  PAID_MFAREX/D16.2CS
  PAID_YFAREX/D16.2CS
  PASSNGR_NAME
  PNR_LOCATOR	
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH	
  RTE_APT_CD
  RTE_CTY_NM
  SAVINGS	
  SEG_AMT
  SEG_DESIG	
  SEG_LOWEST	
  SEG_STANDARD
  SEG_TAX
  STAY
  TKT_NUM	
  TKT_PURCH
  TOUR_CODE	
  TRIPS
  TRIP_LENGTH
  VAL_AIRLINE	
  YFARE_PAID
  YLST_SV
  YONL_CNT
  YONL_FARE
  YTRAD_CNT
  YTRAD_FARE    
  YTKT_CNT
  XDPT_DT
  XPSNGR_NM	
  XTRAN_DT	
BY LEVEL_DESC
BY AIRLINE
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT ABOOK_CNT
  ABOOK_FARE
  AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  AROLL_DSC5
  AUX_NON_MIR	
  BASE_FARE
  BOOK_DT
  BR_CL_IDX	
  CCARD6
  CLASS	
  CLASS_CAT	
  CLIENT_NAME	
  CLIENT_NUM
  COUNTRY_CODE
  CREDIT_CARD	
  DEPT_MONTH
  DEPT_YEAR
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DOD_PAX_CAT	
  DPT_DAY
  EMB_APT_CD
  EMB_APT_NM
  EMB_STATE
  EMB_CTY_NM
  FARE_BAS
  FARE_PAID	
  GROSS_DSAVE	
  GROSS_FARE	
  GROUP_CODE
  IBOOK	
  IBOOK_CNT
  IBOOK_FARE
  INT_CODE	
  INVOICE_NUM
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL_HIE
  MFARE_PAID
  MLST_SV
  MON_TKT
  MONL_CNT
  MONL_FARE
  MTRAD_CNT
  MTRAD_FARE  
  MTKT_CNT
  MRK_TKT_CNT	
  MTG_NUM
  NAMEC
  ND_CITY_NM
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT	
  ORG_DST
  PAID_FAREX
  PAID_MFAREX
  PAID_YFAREX
  PASSNGR_NAME
  PNR_LOCATOR
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH	
  RTE_APT_CD
  RTE_CTY_NM
  SAVINGS	
  SEG_AMT
  SEG_DESIG
  SEG_LOWEST	
  SEG_STANDARD	
  SEG_TAX
  STAY
  TKT_NUM	
  TKT_PURCH
  TOUR_CODE	
  TRIPS
  TRIP_LENGTH
  VAL_AIRLINE	
  YFARE_PAID
  YLST_SV
  YONL_CNT
  YONL_FARE
  YTRAD_CNT
  YTRAD_FARE    
  YTKT_CNT
  XDPT_DT
  XPSNGR_NM	
  XTRAN_DT	
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDONE
SUM GDSAV
    GFARE
    GTFARE
    GMFARE
    GYFARE
    MFARE
    MTKT
    NTTKT
    NTTKT1
    TADV
    TBASE
    TFARE
    TLOSS
    TLOW
    TREX
    TRFEX
    TSEG
    TSTD
    TSVGS
    TTKT
    YFARE
    YTKT 
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN


-NEXTstep
DEFINE FILE XTHREE
  LSAVPCT/D8.1S=IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0
                ELSE ((TLOSS/TFARE)*100);	
  PCDSAVE/D8.1S=IF ((FARE_PAID LT 1) AND (FARE_PAID GT (-1))) THEN 0
                ELSE (DISSAVINGS/FARE_PAID);	
  PCTDSAVE/D8.1S=IF ((TLOSS LT 1) AND (TLOSS GT (-1))) THEN 0
                 ELSE ((DISSAVINGS/TLOSS)*100);	
  PCTFARE/D8.1S=IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0 
                ELSE ((FARE_PAID/TFARE)*100);	
  PCTNETTKT/D8.1S=IF ((NTTKT LT 1) AND (NTTKT GT (-1))) THEN 0 
                  ELSE ((NET_TKT_CNT/NTTKT)*100);	
  PCTRFEX/D8.1S=IF ((TRFEX LT 1) AND (TRFEX GT (-1))) THEN 0
                ELSE ((REF_EXCH_CNT/TRFEX)*100);	
  PCTSAVE/D8.1S=IF ((TSVGS LT 1) AND (TSVGS GT (-1))) THEN 0
                ELSE ((SAVINGS/TSVGS)*100);	
  PCTTKT/D8.1S=IF ((TTKT LT 1) AND (TTKT GT (-1))) THEN 0
               ELSE ((TKT_PURCH/TTKT)*100);	
  SAVPCT/D8.1S=IF ((TSTD LT 1) AND (TSTD GT (-1))) THEN 0
               ELSE ((TSVGS/TSTD)*100);	
  SAVPCT1/D8.1S=IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0
                ELSE ((TSVGS/TFARE)*100);	
  TKTSAV/D12.2CS=IF ((NTTKT LT 1) AND (NTTKT GT (-1))) THEN 0
                 ELSE (TSVGS/NTTKT);	

  BLANK/A1 = '';
  

-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END


-GOTO FinishRpt;

-METX2
TABLE FILE YRAIRCLS

SUM MTRIPLEN AS 'MTRIPD'
    YTRIPLEN AS 'YTRIPD'
    CNT.XPSNGR_NM AS 'PSNGR_CNT'
BY LEVEL_DESC
BY NEW_TRIP_LENGTH
ON TABLE HOLD AS HOLDONE
END
-RUN

TABLE FILE HOLDONE
SUM MTRIPD YTRIPD
    PSNGR_CNT
COMPUTE MTRIPS/D9 = IF ((NEW_TRIP_LENGTH LT 1) AND (NEW_TRIP_LENGTH GT (-1))) 
                   THEN 0 ELSE (MTRIPD/NEW_TRIP_LENGTH);
COMPUTE YTRIPS/D9 = IF ((NEW_TRIP_LENGTH LT 1) AND (NEW_TRIP_LENGTH GT (-1))) 
                   THEN 0 ELSE (YTRIPD/NEW_TRIP_LENGTH);                   
BY LEVEL_DESC
BY NEW_TRIP_LENGTH
ON TABLE HOLD AS HOLDTWO
END
-RUN

TABLE FILE HOLDTWO
SUM MTRIPD AS 'TMTRIPD'
    YTRIPD AS 'TYTRIPD'
    MTRIPS AS 'TOTMTRP'
    YTRIPS AS 'TOTYTRP'
BY LEVEL_DESC
ON TABLE HOLD AS HOLDTHREE
END
-RUN
 
MATCH FILE HOLDTWO
PRINT MTRIPD
      YTRIPD
      PSNGR_CNT
      MTRIPS
      YTRIPS
      NEW_TRIP_LENGTH
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDTHREE
SUM TMTRIPD
    TYTRIPD
    TOTMTRP
    TOTYTRP
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN


-GOTO METX3;
 



DEFINE FILE XTHREE
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END
-GOTO METX3;



-FinishRpt

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADERDD' ELSE 'HDREXLSDD'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE XTHREE
HEADING
-INCLUDE &&PAHDR

-IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' THEN GOTO NOSUB;
-IF '&&SETF.EVAL' EQ 'CCYRONL' OR 'CCONLYR' THEN GOTO SUBHEAD;
-* " <27 ***PERIOD 1*** <48 ***PERIOD 2*** "
-* " <27 ______________ <48 ______________"
-SUBHEAD
"&&SUBHEAD"
" </1"
-NOSUB;

    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT;

-METX3

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADERDD' ELSE 'HDREXLSDD'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE XTHREE
HEADING
-INCLUDE &&PAHDR
"&&SUBHEAD"
" </1"

    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE * 
-INCLUDE &&PASTYS
-GOTO JKK;

TYPE=REPORT, WRAP=1,$
TYPE=REPORT, COLUMN=N1,  WRAP= 2.0,$
TYPE=REPORT, COLUMN=N2, WRAP=  .50,$
TYPE=REPORT, COLUMN=N3, WRAP=  .75,$
TYPE=REPORT, COLUMN=N4, WRAP=  .75,$
TYPE=REPORT, COLUMN=N5, WRAP=  .75,$
TYPE=REPORT, COLUMN=N6, WRAP=  .75,$
TYPE=REPORT, COLUMN=N7, WRAP=  .75,$
TYPE=REPORT, COLUMN=N8, WRAP=  .75,$
TYPE=REPORT, COLUMN=N9, WRAP=  .75,$
TYPE=REPORT, COLUMN=N10, WRAP= 1.0,$
TYPE=REPORT, COLUMN=N11, WRAP= .75,$
TYPE=REPORT, COLUMN=N12, WRAP= 1.0,$
TYPE=REPORT, COLUMN=N13, WRAP= .75,$



TYPE=HEADING, LINE=4, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=5, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=6, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=7, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=8, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=10, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=11, SIZE=9, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=12, SIZE=9, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=13, SIZE=9, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $

TYPE=FOOTING, SIZE=7, STYLE=BOLD, COLOR=GREY, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=8, STYLE=BOLD,$
-*TYPE=SUBTOTAL, SIZE=8, STYLE=BOLD, N=10, BACKCOLOR=RGB(128 255 255),$
TYPE=GRANDTOTAL, SIZE=8, STYLE=BOLD,$
TYPE=REPORT, IMAGE=&&TNTPIC,  POSITION=(&&TNTDTPOS), SIZE=(&&TNTDTSIZ), $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLDTPOS), SIZE=(&&ROLDTSIZ), $
-JKK;
ENDSTYLE


&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-XXIT