-* ADDED TRANTYPE INCLUDE - JK 12/29/14 STORY ID S-06492

SET ASNAMES=ON

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';


-TYPE "BEFORE JOIN"

JOIN AIR_KEY IN AIR_MAIN TO ALL AIR_KEY IN MR_50 AS J1
-RUN


-TYPE "AFTER JOIN"

DEFINE FILE AIR_MAIN
XDPT/MDYY = DPT_DATE;
XARR/MDYY = ARR_DATE;
-INCLUDE TRANTYPE
END
TABLE FILE AIR_MAIN 
PRINT AIR_KEY TKT_NUM TKT_SORT DOC_TYPE SEG_NBR SEG_COUNT PNR_LOCATOR XDPT XARR STAY
      PASSNGR_NAME LEVEL2
BY AIR_KEY NOPRINT
-INCLUDE &AIRDATES
-INCLUDE RPTPARMS
WHERE AIR_MAIN.INTL_DOM EQ 'I'
WHERE VOID_DATE EQ 0
WHERE SEG_COUNT NE 0
ON TABLE HOLD AS AIRC FORMAT FOCUS INDEX AIR_KEY
END
-RUN

TABLE FILE TKT_MAIN
PRINT DST_APC ORG_APC
BY AIR_KEY
ON TABLE HOLD AS AIRT FORMAT FOCUS INDEX AIR_KEY
END
-RUN

-TYPE "BEFORE TKT_MAIN JOIN"
JOIN AIR_KEY IN AIRC TO ALL AIR_KEY IN AIRT AS J2
-RUN

-TYPE "AFTER TKT_MAIN JOIN"

TABLE FILE AIRC
PRINT TKT_NUM SEG_NBR SEG_COUNT PNR_LOCATOR
PASSNGR_NAME LEVEL2 DST_APC XDPT XARR STAY AIR_KEY
BY ORG_APC
ON TABLE HOLD AS AIRC FORMAT FOCUS INDEX ORG_APC
END
-RUN

-TYPE "BEFORE ORG_APC JOIN"
JOIN AIRC.ORG_APC IN AIRC TO AIRPORT.AIRPORT_CODE IN AIRPORT AS J3
-RUN
-TYPE "AFTER ORG_APC JOIN"


TABLE FILE AIRC
PRINT TKT_NUM SEG_NBR SEG_COUNT PNR_LOCATOR
PASSNGR_NAME LEVEL2 ORG_APC AIRPORT_NAME AS 'OARPT' XDPT XARR STAY AIR_KEY 
BY DST_APC
ON TABLE HOLD AS AIRC1 FORMAT FOCUS INDEX DST_APC
END
-RUN

-TYPE "BEFORE DST_APC JOIN"
JOIN AIRC1.DST_APC IN AIRC1 TO AIRPORT.AIRPORT_CODE IN AIRPORT AS J4
-TYPE "AFTER DST_APC JOIN1"
JOIN AIRPORT.COUNTRY_CODE IN AIRC1 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J5
-TYPE "AFTER DST_APC JOIN2"
-RUN

TABLE FILE AIRC1
PRINT TKT_NUM SEG_NBR SEG_COUNT PNR_LOCATOR 
PASSNGR_NAME LEVEL2 OARPT AIRPORT_NAME AS 'DARPT' XDPT XARR STAY COUNTRY_NAME
BY TKT_NUM NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS AIRC2
END
-RUN


TABLE FILE AIRC2
PRINT LEVEL2 PASSNGR_NAME XDPT XARR OARPT DARPT STAY COUNTRY_NAME
BY PNR_LOCATOR
BY TKT_NUM 
BY SEG_COUNT 
BY SEG_NBR 
ON TABLE HOLD AS AIRC3
END
-RUN

DEFINE FILE AIRC3
NOWTOD/A8 WITH PNR_LOCATOR = HHMMSS (NOWTOD);
END

-SET &&RPTSUF = 'DTL';

-INCLUDE FDEFRPTS
-RUN


TABLE FILE AIRC3
PRINT LEVEL2 PNR_LOCATOR AS 'PNR' TKT_NUM AS 'TICKET NUMBER' SEG_COUNT AS 'SEGMENT COUNT' SEG_NBR AS 'SEGMENT NUMBER' 
      PASSNGR_NAME AS 'PASSENGER NAME' XDPT AS 'DEPARTURE DATE' OARPT AS 'ORIGIN' 
      XARR AS 'ARRIVAL DATE' DARPT AS 'DESINATION' STAY AS 'STAY' COUNTRY_NAME AS 'COUNTRY'
BY PNR_LOCATOR NOPRINT
BY TKT_NUM NOPRINT
BY HIGHEST SEG_COUNT NOPRINT
BY SEG_NBR NOPRINT
HEADING
-INCLUDE HEADAIR
FOOTING
-INCLUDE FOOTERDT
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT;
