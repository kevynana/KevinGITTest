-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File TCEXHTL1.FEX
-*************************************************************************
-*DATE          NAME            DESCRIPTION
-* 7/2/04      DEB              THIS PROGRAM EXTRACTS HOTEL DATA USED
-*                              FOR TOTAL COMPANY REPORTING TRAVEL SUMMARY
-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT
-*************************************************************************
-* -INCLUDE SETECHO
SET ASNAMES = ON

DEFINE FILE HR_50
INTL_DOM/A1 =IF (CITY.INTL_DOM EQ 'I') THEN 'I' ELSE 'D';
 CM/A1 = IF INVOICE_DATE GE &&CMFMDT.EVAL AND 
INVOICE_DATE LE &&CMTODT.EVAL THEN 'Y' ELSE 'N';
 CY/A1 = IF INVOICE_DATE GE &&CYFMDT.EVAL AND 
INVOICE_DATE LE &&CYTODT.EVAL THEN 'Y' ELSE 'N';
 PM/A1 = IF INVOICE_DATE GE &&PMFMDT.EVAL AND 
INVOICE_DATE LE &&PMTODT.EVAL THEN 'Y' ELSE 'N';
 PY/A1 = IF INVOICE_DATE GE &&PYFMDT.EVAL AND 
INVOICE_DATE LE &&PYTODT.EVAL THEN 'Y' ELSE 'N';


-*DOMESTIC PERIOD
-* CURRENT HOTEL AMOUNT DOMESTIC CALCULATION
      CDM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS DOMESTIC CALCULATION
      CDM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (CM EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0) 
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (CM EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS DOMESTIC CALCULATION
      CDM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*INT'L PERIOD
-* CURRENT HOTEL AMOUNT INT'L CALCULATION
      CIM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS INT'L CALCULATION
      CIM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (CM EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (CM EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS INT'L CALCULATION
      CIM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*DOMESTIC PERIOD
-* PRIOR HOTEL AMOUNT DOMESTIC CALCULATION
      PDM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;
-* PRIOR HOTEL DAYS DOMESTIC CALCULATION
      PDM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (PM EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (PM EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR HOTEL ROOMS DOMESTIC CALCULATION
      PDM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*INT'L PERIOD
-* PRIOR HOTEL AMOUNT INT'L CALCULATION
      PIM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* PRIOR HOTEL DAYS INT'L CALCULATION
      PIM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (PM EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (PM EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR HOTEL ROOMS INT'L CALCULATION
      PIM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*DOMESTIC YTD 
-* CURRENT HOTEL AMOUNT DOMESTIC CALCULATION
      CDY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS DOMESTIC CALCULATION
      CDY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (CY EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (CY EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS DOMESTIC CALCULATION
      CDY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*INT'L YTD
-* CURRENT HOTEL AMOUNT INT'L CALCULATION
      CIY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS INT'L CALCULATION
      CIY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (CY EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (CY EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS INT'L CALCULATION
      CIY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*DOMESTIC YTD
-* PRIOR HOTEL AMOUNT DOMESTIC CALCULATION
      PDY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;
-* PRIOR HOTEL DAYS DOMESTIC CALCULATION
      PDY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (PY EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (PY EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;
-* PRIOR HOTEL ROOMS DOMESTIC CALCULATION
      PDY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-*INT'L YTD
-* PRIOR HOTEL AMOUNT INT'L CALCULATION
      PIY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* PRIOR HOTEL DAYS INT'L CALCULATION
      PIY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (PY EQ 'Y')
                      AND (HTL_MAIN.NUM_DAYS LT 0)
                      AND (HTL_MAIN.NUM_ROOMS LT 0))
                      THEN ((HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (PY EQ 'Y'))
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR HOTEL ROOMS INT'L CALCULATION
      PIY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;
MIR_SEQ1/A1 = EDIT(MIR_SEQ, '9$$$$$');
RES_SYS/A1 = IF MIR_SEQ1 EQ 'X' THEN 'S' ELSE 'A';                      
END
-RUN

TABLEF FILE HR_50
SUM
CDM1HTL_AMT/D15 CDM1HTL_DAY/D15 CDM1HTL_RMS/D15 
CIM1HTL_AMT/D15 CIM1HTL_DAY/D15 CIM1HTL_RMS/D15
PDM1HTL_AMT/D15 PDM1HTL_DAY/D15 PDM1HTL_RMS/D15 
PIM1HTL_AMT/D15 PIM1HTL_DAY/D15 PIM1HTL_RMS/D15
CDY1HTL_AMT/D15 CDY1HTL_DAY/D15 CDY1HTL_RMS/D15 
CIY1HTL_AMT/D15 CIY1HTL_DAY/D15 CIY1HTL_RMS/D15
PDY1HTL_AMT/D15 PDY1HTL_DAY/D15 PDY1HTL_RMS/D15 
PIY1HTL_AMT/D15 PIY1HTL_DAY/D15 PIY1HTL_RMS/D15
AND COMPUTE 
-* CDM1AVG_RATE/D15=IF CDM1HTL_AMT LT 0 AND CDM1HTL_DAY LT 0
-*                 THEN ((CDM1HTL_AMT/CDM1HTL_DAY) * (-1)) ELSE
-*                  IF ((CDM1HTL_DAY LT 1) AND (CDM1HTL_DAY GT (-1))) THEN 0 ELSE
-*                     (CDM1HTL_AMT/CDM1HTL_DAY);
-* CIM1AVG_RATE/D15=IF CIM1HTL_AMT LT 0 AND CIM1HTL_DAY LT 0
-*                  THEN ((CIM1HTL_AMT/CIM1HTL_DAY) * (-1)) ELSE
-*                  IF ((CIM1HTL_DAY LT 1) AND (CIM1HTL_DAY GT (-1))) THEN 0 ELSE
-*                     (CIM1HTL_AMT/CIM1HTL_DAY);
-* PDM1AVG_RATE/D15=IF PDM1HTL_AMT LT 0 AND PDM1HTL_DAY LT 0
-*                 THEN ((PDM1HTL_AMT/PDM1HTL_DAY) * (-1)) ELSE
-*                 IF ((PDM1HTL_DAY LT 1) AND (PDM1HTL_DAY GT (-1))) THEN 0 ELSE
-*                    (PDM1HTL_AMT/PDM1HTL_DAY);
-*PIM1AVG_RATE/D15=IF PIM1HTL_AMT LT 0 AND PIM1HTL_DAY LT 0
-*                 THEN ((PIM1HTL_AMT/PIM1HTL_DAY) * (-1)) ELSE
-*                 IF ((PIM1HTL_DAY LT 1) AND (PIM1HTL_DAY GT (-1))) THEN 0 ELSE
-*                    (PIM1HTL_AMT/PIM1HTL_DAY);
-*CDY1AVG_RATE/D15=IF CDY1HTL_AMT LT 0 AND CDY1HTL_DAY LT 0
-*                 THEN ((CDY1HTL_AMT/CDY1HTL_DAY) * (-1)) ELSE
-*                 IF ((CDY1HTL_DAY LT 1) AND (CDY1HTL_DAY GT (-1))) THEN 0 ELSE
-*                    (CDY1HTL_AMT/CDY1HTL_DAY);
-*CIY1AVG_RATE/D15=IF CIY1HTL_AMT LT 0 AND CIY1HTL_DAY LT 0
-*                 THEN ((CIY1HTL_AMT/CIY1HTL_DAY) * (-1)) ELSE
-*                 IF ((CIY1HTL_DAY LT 1) AND (CIY1HTL_DAY GT (-1))) THEN 0 ELSE
-*                    (CIY1HTL_AMT/CIY1HTL_DAY);
-*PDY1AVG_RATE/D15=IF PDY1HTL_AMT LT 0 AND PDY1HTL_DAY LT 0
-*                 THEN ((PDY1HTL_AMT/PDY1HTL_DAY) * (-1)) ELSE
-*                 IF ((PDY1HTL_DAY LT 1) AND (PDY1HTL_DAY GT (-1))) THEN 0 ELSE
-*                    (PDY1HTL_AMT/PDY1HTL_DAY);
-*PIY1AVG_RATE/D15=IF PIY1HTL_AMT LT 0 AND PIY1HTL_DAY LT 0
-*                 THEN ((PIY1HTL_AMT/PIY1HTL_DAY) * (-1)) ELSE
-*                 IF ((PIY1HTL_DAY LT 1) AND (PIY1HTL_DAY GT (-1))) THEN 0 ELSE
-*                    (PIY1HTL_AMT/PIY1HTL_DAY);
&&WHERE1
&&WHERE2
&&WHERE3
WHERE (HTL_MAIN.INVOICE_DATE GE &&CYFMDT.EVAL
      AND HTL_MAIN.INVOICE_DATE LE &&CYTODT.EVAL)
 OR (HTL_MAIN.INVOICE_DATE GE &&PYFMDT.EVAL
      AND HTL_MAIN.INVOICE_DATE LE &&PYTODT.EVAL)
 OR (HTL_MAIN.INVOICE_DATE GE &&CMFMDT.EVAL 
      AND HTL_MAIN.INVOICE_DATE LE &&CMTODT.EVAL) 
 OR (HTL_MAIN.INVOICE_DATE GE &&PMFMDT.EVAL 
      AND HTL_MAIN.INVOICE_DATE LE &&PMTODT.EVAL);

-INCLUDE RPTPARMS

ON TABLE HOLD AS TCHTLH
END
-RUN
-IF &LINES EQ 0 THEN GOTO NEXTONE;
-* ========================================================================
-*                <---------------- STEP5 ---------------->
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TC_TRVL       
-*========================================================================

DEFINE FILE TCHTLH
ROLLCD/A8 = '&&ROLL';
END
TABLEF FILE TCHTLH
PRINT
CDM1HTL_AMT CDM1HTL_DAY CDM1HTL_RMS
CIM1HTL_AMT CIM1HTL_DAY CIM1HTL_RMS
PDM1HTL_AMT PDM1HTL_DAY PDM1HTL_RMS
PIM1HTL_AMT PIM1HTL_DAY PIM1HTL_RMS
CDY1HTL_AMT CDY1HTL_DAY CDY1HTL_RMS
CIY1HTL_AMT CIY1HTL_DAY CIY1HTL_RMS
PDY1HTL_AMT PDY1HTL_DAY PDY1HTL_RMS
PIY1HTL_AMT PIY1HTL_DAY PIY1HTL_RMS
-* CDM1AVG_RATE
-* CIM1AVG_RATE
-* PDM1AVG_RATE
-* PIM1AVG_RATE
-* CDY1AVG_RATE
-* CIY1AVG_RATE
-* PDY1AVG_RATE
-* PIY1AVG_RATE
BY ROLLCD
ON TABLE HOLD AS TCHTLH2
END
-RUN

DEFINE FILE TCHTLH2
  NMB/I5 = NMB + 1;  
END
TABLE FILE TCHTLH2
PRINT
CDM1HTL_AMT CDM1HTL_DAY CDM1HTL_RMS
CIM1HTL_AMT CIM1HTL_DAY CIM1HTL_RMS
PDM1HTL_AMT PDM1HTL_DAY PDM1HTL_RMS
PIM1HTL_AMT PIM1HTL_DAY PIM1HTL_RMS
CDY1HTL_AMT CDY1HTL_DAY CDY1HTL_RMS
CIY1HTL_AMT CIY1HTL_DAY CIY1HTL_RMS
PDY1HTL_AMT PDY1HTL_DAY PDY1HTL_RMS
PIY1HTL_AMT PIY1HTL_DAY PIY1HTL_RMS
-* CDM1AVG_RATE
-* CIM1AVG_RATE
-* PDM1AVG_RATE
-* PIM1AVG_RATE
-* CDY1AVG_RATE
-* CIY1AVG_RATE
-* PDY1AVG_RATE
-* PIY1AVG_RATE
BY ROLLCD
BY NMB
ON TABLE HOLD AS TCHTL
END
-RUN

MODIFY FILE TC_TSHTL
FIXFORM FROM TCHTL
MATCH ROLLCD NMB
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON TCHTL
END
-RUN

-NEXTONE


