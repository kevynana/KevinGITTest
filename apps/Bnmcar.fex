-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 1/24/05 - DEB - ADDED CODE FOR GLOBAL CURRENCY
-* File CVIEW1EX.FEX
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK
-*  03/31/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-*12/29/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*4/20/2017-JEM-S-33318-updated logic for no records report

-********************************************************************
-* MODIFICAIONS:
-*SET &ECHO=ALL;
-INCLUDE SETECHO
SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &&IDLEVELBREAK = '';

-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
BOOKINGS/D12 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
  LEVEL_DESC1/A80 = &&LDESC;
  NBR_DAYS/D12S = NUM_DAYS;
  RENTAL_DAYS/D12S = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
  TRAN_MY/MTYY = INVOICE_DATE;
 
-* ****DEFINES ON PREVIOUS DEFINES****
  MIDBOOK/D12S = IF (DAILY_RATE GE 0) AND
                  (CAR_CAT EQ 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                  OR 'COMPACT') THEN 1
                  ELSE IF (DAILY_RATE LT 0) AND
                  (CAR_CAT EQ 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                  OR 'COMPACT') THEN (-1) ELSE 0;
  MIDAMT/D12S = IF (CAR_CAT EQ 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                   OR 'COMPACT') THEN RENTAL_AMT ELSE 0;
  MIDDAYS/D12S = IF (CAR_CAT EQ 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                   OR 'COMPACT') THEN RENTAL_DAYS ELSE 0;
 
  NOMID_DAYS/D12S = IF (CAR_CAT NE 'INTERMEDIATE' OR 'MIDSIZE' OR 'ECONOMY'
                   OR 'COMPACT') THEN RENTAL_DAYS ELSE 0;
                   
-INCLUDE IDLEVDEFINE 
 
END
-RUN
 
TABLEF FILE &&EXTRACT
PRINT AROLL_DSC3
  BOOKINGS
  CAR_CAT
  CAR_DESC
  CAR_KEY
  CAR_RATE
  CAR_TYPE
  CURR_DATE
  DAILY_RATE
  INVOICE_DATE
  INT_DOM
  LEVEL_DESC
  MIDBOOK
  MIDAMT
  MIDDAYS
  NOMID_DAYS
  NBR_DAYS
  RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
-IF &&FROMAVRP EQ 'Y' GOTO :BC1;
WHERE (INVOICE_DATE GE '&&FROMDT.EVAL') AND (INVOICE_DATE LE '&&TODT.EVAL') OR
      (INVOICE_DATE GE '&&FXDATE.EVAL') AND (INVOICE_DATE LE '&&TXDATE.EVAL')
-GOTO :BC1_CONT;
-:BC1
WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL) OR
      (INVOICE_DATE GE &&FXDATE.EVAL) AND (INVOICE_DATE LE &&TXDATE.EVAL)
-:BC1_CONT
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
-* &&WHERE1
-* &&WHERE2
-* &&WHERE3
-* &&WHERE4
-* &&WHERE5
-* &&WHERE6
&&WHERE7
&&WHERE8
-* &&WHERE9
-* &&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS BNACHOLD
END
-RUN
 
TABLE FILE BNACHOLD
PRINT AROLL_DSC3
  BOOKINGS
  CAR_CAT
  CAR_DESC
  CAR_KEY
  CAR_RATE
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE
  INT_DOM
  LEVEL_DESC
  MIDBOOK
  MIDAMT
  MIDDAYS
  NOMID_DAYS
  NBR_DAYS
  RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
BY CURR_DATE
ON TABLE HOLD AS BNACHLD FORMAT FOCUS INDEX CURR_DATE
END
-RUN


 
 
-* Global Reporting JOIN
JOIN BNACHLD.CURR_DATE IN BNACHLD TO GLOBAL.DATE IN GLOBAL AS J1
END
 
DEFINE FILE BNACHLD
 
 NAMEC/A30 = CNAME;
 
 
-******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;
 
-* DEFINES ON PREVIOUS DEFINES
AMT_RENTALX/D20.6 = RENTAL_AMT * CURR1X;
RATE_CARX/D20.6 = CAR_RATE * CURR1X;
AMTMIDX/D20.6 = MIDAMT * CURR1X;
 
END
 
TABLE FILE BNACHLD
PRINT AROLL_DSC3
  BOOKINGS
  CAR_CAT
  CAR_DESC
  CAR_KEY
  CAR_RATE
  CAR_TYPE
  CURR_DATE
  DAILY_RATE
  INVOICE_DATE
  INT_DOM
  LEVEL_DESC
  MIDBOOK
  MIDAMT
  MIDDAYS
  NOMID_DAYS
  NBR_DAYS
  RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
  NAMEC
  AMT_RENTALX/D16.2CS
  RATE_CARX/D16.2CS
  AMTMIDX/D16.2CS
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS CARHOLD
END
-RUN
 
 
 
 
 
DEFINE FILE CARHOLD
 
-IF &&FROMAVRP EQ 'Y' GOTO :BC2;
CURRENT/A1 = IF INVOICE_DATE GE '&&FROMDT.EVAL' AND
                INVOICE_DATE LE '&&TODT.EVAL' THEN 'Y' ELSE 'N';
PRIOR/A1 =  IF INVOICE_DATE GE '&&FXDATE.EVAL' AND
               INVOICE_DATE LE '&&TXDATE.EVAL' THEN 'Y' ELSE 'N';
-GOTO :BC2_CONT;
-:BC2
CURRENT/A1 = IF INVOICE_DATE GE &&FROMDT.EVAL AND
                INVOICE_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PRIOR/A1 =  IF INVOICE_DATE GE &&FXDATE.EVAL AND
               INVOICE_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
-:BC2_CONT
END
 
TABLE FILE CARHOLD
PRINT AMT_RENTALX/D16.2CS
  AMTMIDX/D16.2CS
  AROLL_DSC3
  BOOKINGS
  CAR_DESC
  CAR_KEY
  CAR_RATE
  CAR_TYPE
  CURRENT
  DAILY_RATE
  MIDAMT
  MIDBOOK
  MIDDAYS
  NOMID_DAYS
  NBR_DAYS
  PRIOR
  RATE_CARX/D16.2CS
  RENTAL_AMT
  RENTAL_DAYS
-*   TRAN_MY
-* BY TRAN_MY
BY LEVEL_DESC
ON TABLE HOLD AS CARTWO
END
-RUN
 
DEFINE FILE CARTWO
CRENTAL/D12S = IF CURRENT EQ 'Y' THEN RENTAL_DAYS ELSE 0;
CNOMID_DAYS/D12S = IF CURRENT EQ 'Y' THEN NOMID_DAYS ELSE 0;
CRENTALA/D12.2CS = IF CURRENT EQ 'Y' THEN MIDAMT ELSE 0;
CRENTALD/D12 = IF CURRENT EQ 'Y' THEN MIDDAYS ELSE 0;
GCRENTALA/D12.2CS = IF CURRENT EQ 'Y' THEN AMTMIDX ELSE 0;
CRENTALT/D12.2CS = IF CURRENT EQ 'Y' THEN AMT_RENTALX ELSE 0;
END
 
-IF &&SETF EQ 'MXBNM2' THEN GOTO METXcar;
 
TABLE FILE CARTWO
SUM CRENTAL
    CNOMID_DAYS
COMPUTE PCTNOMID/P12.2 = IF ((CRENTAL LT 1) AND (CRENTAL GT (-1))) THEN 0 ELSE
                            ((CNOMID_DAYS/CRENTAL)*100);
COMPUTE AVGMID/D12.2CS = IF ((CRENTALD LT 1) AND (CRENTALD GT (-1))) THEN 0
                         ELSE (CRENTALA/CRENTALD);
COMPUTE GAVGMID/D16.2CS = IF ((CRENTALD LT 1) AND (CRENTALD GT (-1))) THEN 0
                         ELSE (GCRENTALA/CRENTALD);
-* BY TRAN_MY
BY LEVEL_DESC
-* ON TABLE HOLD AS CARTHREE FORMAT FOCUS INDEX TRAN_MY
ON TABLE HOLD AS CARTHREE FORMAT FOCUS INDEX LEVEL_DESC
END
-RUN

-GOTO XXITcar;
 
 
-METXcar
TABLE FILE CARTWO
SUM CRENTAL
    CNOMID_DAYS CRENTALT
COMPUTE PCTNOMID/P12.2 = IF ((CRENTAL LT 1) AND (CRENTAL GT (-1))) THEN 0 ELSE
                            ((CNOMID_DAYS/CRENTAL)*100);
COMPUTE AVGMID/D12.2CS = IF ((CRENTALD LT 1) AND (CRENTALD GT (-1))) THEN 0
                         ELSE (CRENTALA/CRENTALD);
COMPUTE GAVGMID/D16.2CS = IF ((CRENTALD LT 1) AND (CRENTALD GT (-1))) THEN 0
                         ELSE (GCRENTALA/CRENTALD);
-* BY TRAN_MY
BY LEVEL_DESC
-* ON TABLE HOLD AS CARTHREE FORMAT FOCUS INDEX TRAN_MY
ON TABLE HOLD AS CARTHREE FORMAT FOCUS INDEX LEVEL_DESC
END
-RUN
 
 

 
 
 
 
-XXITcar
 
-SET &&CARREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
 
 
 
 
 
 
 
 
 
 
 
