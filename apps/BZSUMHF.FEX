-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File BZSUMNF.FEX

-*04/09/12  - DV - CREATED FROM TKTSUM
-**********************************************************************

-**********************************************************************

SET ASNAMES=ON


DEFINE FILE HOLDA
TKTNUMP/A14 = ''''||TKT_NUM||'''';
END
-RUN
TABLE FILE HOLDA
SUM TKTNUMP
BY TKT_NUM NOPRINT
ON TABLE SAVE AS TKTNUMF 
END
-RUN 
 
TABLE FILE BRPTINST
BY BREAK_LEVELS  
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE  
END
-RUN

-READ SAVE &BL.18.
-SET &LEN = ARGLEN(60, '&BL.EVAL', 'I2');
-SET &NBRLVL = &LEN / 3;
-SET &NR1 = 2 + &NBRLVL.EVAL;
-SET &RL1 = 'N' || '&NR1.EVAL';
-SET &NR2 = 4 + &NBRLVL.EVAL;
-SET &RL2 = 'N' || '&NR2.EVAL';
-SET &NR3 = 5 + &NBRLVL.EVAL;
-SET &RL3 = 'N' || '&NR3.EVAL';
-SET &NR4 = 11 + &NBRLVL.EVAL;
-SET &RL4 = 'N' || '&NR4.EVAL';
-SET &NR5 =  13 + &NBRLVL.EVAL; 
-SET &RL5 = 'N' || '&NR5.EVAL';
-SET &NR6 = 14 + &NBRLVL.EVAL;
-SET &RL6 = 'N' || '&NR6.EVAL';  
-SET &NR7 = 15 + &NBRLVL.EVAL;
-SET &RL7 = 'N' || '&NR7.EVAL';
-SET &NR8 = 16 + &NBRLVL.EVAL;
-SET &RL8 = 'N' || '&NR8.EVAL';
-SET &NR9 = 17 + &NBRLVL.EVAL;
-SET &RL9 = 'N' || '&NR9.EVAL';
-SET &NR10 = 18 + &NBRLVL.EVAL;
-SET &RL10 = 'N' || '&NR10.EVAL';
-SET &NR11 = 19 + &NBRLVL.EVAL;
-SET &RL11 = 'N' || '&NR11.EVAL';
-SET &NR12 = 20 + &NBRLVL.EVAL;
-SET &RL12 = 'N' || '&NR12.EVAL';
-SET &NR13 = 21 + &NBRLVL.EVAL;
-SET &RL13 = 'N' || '&NR13.EVAL';
-SET &NR14 = 22 + &NBRLVL.EVAL;
-SET &RL14 = 'N' || '&NR14.EVAL';
-SET &NR15 = 23 + &NBRLVL.EVAL;
-SET &RL15 = 'N' || '&NR15.EVAL';
-SET &NR16 = 24 + &NBRLVL.EVAL;
-SET &RL16 = 'N' || '&NR16.EVAL';
-CLOSE SAVE




-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'HOLDA.FOC';
-SET &HNKB=&HLDPATH || 'HOLDH.FOC';
-SET &HNKC=&HLDPATH || 'HOLDC.FOC';
-SET &HNKL=&HLDPATH || 'HOLDL.FOC';

-RUN


-SET &FILENAME = 'HOLDA'; 
-RUN

-DOS STATE &HNKA
-SET &HOLDFILEA = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKB
-SET &HOLDFILEH = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKC
-SET &HOLDFILEC = IF &RETCODE.EVAL EQ 0 THEN &HNKC | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKL
-SET &HOLDFILEL = IF &RETCODE.EVAL EQ 0 THEN &HNKL | ' AS ' | &FILENAME ELSE ' ';

USE ADD 
&HOLDFILEA
&HOLDFILEH
&HOLDFILEC
&HOLDFILEL
END


TABLE FILE HOLDA
PRINT
  AMOUNT
  GAMOUNT
  TTL_COUNT
  FEE
  FEEX
  GEO_ZONE
  PADV
  LOST_AMT
  LOW_AMT
  VASAV
  HOME_F1
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TRAN_DATE
BY FDATE
BY TKT_NUM
BY TSORT
BY SEG
BY TYPE
BY NAME 
BY DATE
BY AIRT
BY CITY1
BY CITY2
BY FLAG
BY LEVEL1
BY LEVEL2
BY LEVEL3
BY LEVEL4
BY REFUSE_CODE
BY NAMEC
BY TRIP_PURPOSE
BY CHG_COD
BY CCA_CARD
BY CC_NUM
BY CLASS
BY CCNUM2
WHERE TKT_NUM IN FILE TKTNUMF
ON TABLE HOLD AS HOLDE 
END
-RUN





-IF &RECORDS EQ 0 THEN GOTO xxit;



-SET &&RPTSUF = 'DTL';
-INCLUDE FDEFRPTS
-RUN

-SET &FMM=EDIT(&&FROMDT,'$$$$$$99');
-SET &FMD=EDIT(&&FROMDT,'$$$$$$$$$99');
-SET &FMY=EDIT(&&FROMDT,'$9999');
-SET &TOM=EDIT(&&TODT,'$$$$$$99');
-SET &TOD=EDIT(&&TODT,'$$$$$$$$$99');
-SET &TOY=EDIT(&&TODT,'$9999');
-SET &&SP = '|';
-SET &&SP3 = IF &&ROLLCNCT EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP4 = IF &&ROLLPHN EQ ' ' THEN ' ' ELSE &&SP;




-**************************************************************************
DEFINE FILE HOLDE
COUNT1/D12CS = IF (FLAG EQ 'A') THEN TTL_COUNT ELSE 0;
COUNT2/D12CS = IF (FLAG EQ 'C') THEN TTL_COUNT ELSE 0;
COUNT3/D12CS = IF (FLAG EQ 'H') THEN TTL_COUNT ELSE 0;
COUNT4/D12CS = IF (FLAG EQ 'L') THEN TTL_COUNT ELSE 0;
AMT1/D12.2CS = IF (FLAG EQ 'A') THEN AMOUNT ELSE 0;
AMT2/D12.2CS = IF (FLAG EQ 'C') THEN AMOUNT ELSE 0;
AMT3/D12.2CS = IF (FLAG EQ 'H') THEN AMOUNT ELSE 0;
AMT4/D12.2CS = IF (FLAG EQ 'L') THEN AMOUNT ELSE 0;
A_AMT1/D12.2CS = IF FLAG EQ 'A' THEN AMOUNT ELSE 0;
ACH_AMT/D12.2CS = IF FLAG NE 'A' THEN AMOUNT ELSE 0;
FLAGA/A5 = DECODE FLAG ('A' 'AIR'   'C' 'CAR'  'H' 'HTL' 'L' 'LIM');                         
XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
TICKET_NMBR/A10 = IF (TKT_NUM EQ '0000000000') THEN ' ' ELSE
                  TKT_NUM;
-* CUR_DESC/A95 = LEVEL_DESC||'-'||NAMEC;
CUR_DESC/A50 = NAMEC;
  
                 
-*DEFINES ON PREVIOUS DEFINES 
PASNGR_NAME/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
LVL1/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL1 ELSE ' ';
TRAN_MYA/I6MTYY = TRAN_DATE;
NOWTOD/A8 WITH TKT_NUM = HHMMSS (NOWTOD);
HOME_F3/D12.2S = IF HOME_F1 EQ 99999 THEN 0 ELSE HOME_F1;
HFAMT/D12.2CS = IF CITY1 CONTAINS 'FORFEIT/PENALTY' THEN 0 ELSE
                 IF HOME_F1 EQ 0 THEN 0 ELSE 
                 IF HOME_F1 EQ 99999 THEN 0 ELSE GAMOUNT - HOME_F1;
A_AMT/D12.2CS = IF CITY1 CONTAINS 'FORFEIT/PENALTY' THEN 0 ELSE 
                IF A_AMT1 LT 0 AND HFAMT EQ 0 THEN 0 ELSE A_AMT1;
                
               
-INCLUDE DefineSubtotalFields  
END



-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'HOLDE';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************


-IF &&CURRENCY EQ 'USD' THEN GOTO NEXT;

-SET &&SUBHEAD = <CUR_DESC;
-SET &GFAR_CUR = 'AMOUNT, (' | &&CURRENCY || ')';
-SET &GFEE_CUR = 'ARLN, FEE, (' | &&CURRENCY || ')';
-SET &&PRINT3='CITY1/A20 AS ''ORG'' CITY2/A18 AS ''DST'' ';
-SET &&PRINT4='GAMOUNT/D16.2CS AS ' | '''&GFAR_CUR.EVAL''';
-SET &&PRINT5='FEEX/D16.2CS AS ' | '''&GFEE_CUR.EVAL''';
-SET &&PRINT7='COUNT2 AS ''CAR,DAY'' ';

-NEXT;

 

-Report


TABLE FILE HOLDE
"</5"
"&&DTDESC &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  <75 &&ROLLNME <+0> &&SP <+0> &&ROLLCS <+0> &&SP3 <+0> &&ROLLCNCT <+0> &&SP4 <+0> &&ROLLPHN"
"Page:<TABPAGENO"
" "
"<35 &&RPT_TTL1"
"<35 &&RPT_TTL2"
-*"&&SUBHEAD"
"</2"
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10

-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
-IF &&MULTIBREAK NE 'Y' OR &&ALTHIER NE 'Y' THEN GOTO :NOMULTBREAK;
-INCLUDE LevelNOPRINT
-:NOMULTBREAK
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
-IF &&MULTIBREAK NE 'Y' OR &&ALTHIER NE 'Y' THEN GOTO :NOMULTOTAL;

-GOTO SKIPBREAKOPT;
-:NOMULTOTAL
&&BREAKOPTION
-SKIPBREAKOPT
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10


-FOOTER 
FOOTING BOTTOM
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

-IF '&&SETF.EVAL' EQ 'BZACHDCC' AND &&OUTFMT EQ 'EXL2K' THEN GOTO BOOZ;
-IF &&CURRENCY EQ 'TRL' THEN GOTO SMALLER;
-INCLUDE &&DTSTY 
-* -INCLUDE &&SMSTY
-GOTO FINFONT;
-SMALLER
-INCLUDE DT7
-FINFONT


-* -INCLUDE &&DTSTY
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO xxit




-BOOZ
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.250000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=REPORT, WRAP=1,$
TYPE=REPORT, COLUMN=&RL1,  WRAP= 1.5,$
TYPE=REPORT, COLUMN=&RL2,  WRAP= .60,$
TYPE=REPORT, COLUMN=&RL3,  WRAP= .50,$
TYPE=REPORT, COLUMN=&RL4,  WRAP= .50,$
TYPE=REPORT, COLUMN=&RL5,  WRAP= .65,$
TYPE=REPORT, COLUMN=&RL6,  WRAP= .65,$
TYPE=REPORT, COLUMN=&RL7,  WRAP= 1.75,$
TYPE=REPORT, COLUMN=&RL8,  WRAP= 1.25,$
TYPE=REPORT, COLUMN=&RL9,  WRAP= .65,$
TYPE=REPORT, COLUMN=&RL10, WRAP= 1.15,$
TYPE=REPORT, COLUMN=&RL11, WRAP= 1.15,$
TYPE=REPORT, COLUMN=&RL12, WRAP= 1.0,$
TYPE=REPORT, COLUMN=&RL13, WRAP= .65,$
TYPE=REPORT, COLUMN=&RL14, WRAP= .65,$
TYPE=REPORT, COLUMN=&RL15, WRAP= .65,$
TYPE=REPORT, COLUMN=&RL16, WRAP= .65,$


TYPE=HEADING, LINE=4, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=5, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=6, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=7, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=8, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=10, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=11, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=12, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=13, SIZE=10, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $

TYPE=FOOTING, SIZE=7, STYLE=BOLD, COLOR=GREY, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=8, STYLE=BOLD,$
-*TYPE=SUBTOTAL, SIZE=8, STYLE=BOLD, N=10, BACKCOLOR=RGB(128 255 255),$
TYPE=GRANDTOTAL, SIZE=8, STYLE=BOLD,$
TYPE=REPORT, IMAGE=&&TNTPIC,  POSITION=(&&TNTDTPOS), SIZE=(&&TNTDTSIZ), $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLDTPOS), SIZE=(&&ROLDTSIZ), $

ENDSTYLE

&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN







-xxit
