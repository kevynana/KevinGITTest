-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AVIW23EX.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*
-* This program extracts data for the series of basic ticket listing
-* reports.  Based on the user profile selected, one of many report
-* formats will be produced.  
-*
-* DATE     INITIALS           DESCRIPTION
-* 3/15/01  TANDT-SS           ADDED GEOAREA AND AGENT_NUM FOR USE
-*                             IN KIMBERLY CLARK TRANS SUMMARY
-*4/18/01      TANDT-JK             ADDED A JOIN TO THE AGENT FILE
-*                                  SO THAT WE COULD REPORT ON AGENT_NAME
-* ADDED TRANTYPE INCLUDE - JK 12/15/14 STORY ID S-06492

-********************************************************************

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

DEFINE FILE &&EXTRACT
  MTG_CODE/A2=EDIT(CLIENT_NUM, '99'); 
  FARE_PAID/D12.2=SEG_AMT + SEG_TAX;
  LEVEL_DESC/A60 = &&LDESC;
  KBLEVEL1/A3 = EDIT (LEVEL1, '999');
  GEOAREA/A6 = IF (KBLEVEL1 EQ '265' OR '274' OR '283') THEN
               'CANADA' ELSE 'US';
  MCOS/D9CS           = IF (DOC_TYPE EQ '1') AND
                           (EX_FLAG EQ ' ')  AND
                           (EXCHG_SALE NE ' ') THEN 1 ELSE 0;
  NET_TKT_CNT/D8CS    = IF (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0)  AND
                           (SEG_COUNT EQ 1)  AND
                           (EXCHG_SALE EQ ' ') THEN 1 ELSE
                        IF (DOC_TYPE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (EXCHG_SALE EQ ' ') AND
                           (VOID_DATE EQ 0) THEN 1 ELSE 0; 
  TKT_CNT/D9CS        = IF (SEG_NBR EQ '01') AND 
                           (FARE_PAID GE 0) AND 
                           (SEG_COUNT EQ 1) THEN 1 ELSE 0;                         
  TKT_TYPE/A4         = IF (SEG_COUNT LE 0) AND
                           (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                           (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                           (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                           (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
  VOIDS/D9CS          = IF (VOID_DATE NE 0) AND
                           (SEG_COUNT EQ 1) AND
                           (SEG_NBR EQ '01') THEN 1 ELSE
                        IF (DOC_TYPE EQ '1') AND 
                           (VOID_DATE NE 0) THEN 1 ELSE 0;
                           
  XDPT_DT/MDYY=DPT_DATE;
  XPSNGR_NM/A15=EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  XTRAN_DT/MDYY=TRN_DATE;
-* ******* DEFINES ON PREVIOUS DEFINES ******
EXCHGS/D9CS = IF (EX_FLAG EQ 'F' OR 'P') AND
                 (SEG_COUNT LE 0) AND
                 (EMBARK NE 'DT1' OR 'RF1' OR 'FP3') THEN 
                  TKT_CNT ELSE
              IF (DOC_TYPE EQ '1') AND
                 (EXCHG_SALE EQ 'E') THEN 0 ELSE
              IF (SEG_COUNT GE 0) AND
                 (EXCHG_SALE NE ' ') THEN TKT_CNT ELSE 0;

-INCLUDE TRANTYPE                 
                 
END
-RUN

TABLE FILE &&EXTRACT
PRINT
  AGENT_NUM 
  AIR_KEY	
  AIRLINE
  BR_CL_IDX	
  CITYPAIR.EMBARK      AS 'EMB_APT_CD'	
  CITYPAIR.ROUTE       AS 'RTE_APT_CD'	
  CLASS	
  CLIENT_NUM
  DOC_TYPE	
  DOD_TYPE
  DPT_DATE	
  DPT_TIME
  EMBARK	
  EX_FLAG	
  EXCHG_SALE
  EXCHGS
  FARE_PAID	
  FLIGHT
  GEOAREA
  GRAND_MSTR_CODE	
  GROUP_CODE
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL_DESC
  MCOS
  MTG_CODE	
  MSTR_GRP_CODE	
  NET_TKT_CNT
  PASSNGR_NAME
  REFUSE_KEY	
  RESV_BRANCH	
  RF_FLAG
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 	
  TKT_NUM
  TKT_SORT
  TKT_TYPE
  TRN_DATE	
  VAL_AIRLINE
  VOIDS	
  VOID_DATE 	
  VOID_STATUS 
  XDPT_DT
  XPSNGR_NM
  XTRAN_DT	
BY TKT_SORT NOPRINT
WHERE TRN_DATE GE &&FROMDT.EVAL AND TRN_DATE LE &&TODT.EVAL
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD
END

-*-EXIT


