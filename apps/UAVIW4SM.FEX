-* Udid Detail Report

-* 8/23/06 - DEB - Added udid BPAY_AMT BUS_FAR PAY_AMT TIER

-INCLUDE RETUDID
-RUN



SET ASNAMES=ON
-RUN



TABLE FILE &&RPT_HOLD
SUM DISSAVINGS AS 'DTSAVE'
    FARE_PAID AS 'TFARE'
    NEW_SEG_MILES AS 'TMILE'
    NET_TKT_CNT AS 'TTKT'
    SEG_LOWEST AS 'TLOW'
BY LEVEL_DESC
ON TABLE HOLD AS AIRHOLD1
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT AIR_KEY   
  INTL_DOM	
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT   
  DOC_TYPE
  DPT_TIME	
  EMB_APT_NM
  EMB_CTY_NM
  EMB_APT_CD
  EX_FLAG
  FARE_PAID
  FLIGHT   	
  INVOICE_NUM
  LEVEL1
  NET_TKT_CNT
  NEW_ADV_PURCH	
  NEW_SEG_MILES   
  REFUSAL_DESC	
  REFUSE_CODE	
  REFUSE_KEY  
  RF_FLAG
  RTE_APT_CD    	
  RTE_APT_NM	
  RTE_CTY_NM   
  SEG_COUNT	
  SEG_NBR
  TKT_DATE	
  TKT_NUM
  TKT_SORT
  TKT_TYPE   
  TRN_DATE   
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
BY AIRLINE_NAME
ON TABLE HOLD AS XTWO
END
-RUN


MATCH FILE XTWO
PRINT AIR_KEY   
  INTL_DOM	
  AIRLINE	
  AIRLINE_FEE	
  ARR_TIME
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT   
  DOC_TYPE
  DPT_TIME	
  EMB_APT_NM
  EMB_CTY_NM
  EMB_APT_CD	
  EX_FLAG
  FARE_PAID
  FLIGHT   	
  INVOICE_NUM
  LEVEL1
  NET_TKT_CNT
  NEW_ADV_PURCH	
  NEW_SEG_MILES   
  REFUSAL_DESC	
  REFUSE_CODE	
  REFUSE_KEY 
  RF_FLAG
  RTE_APT_CD    	
  RTE_APT_NM	
  RTE_CTY_NM   
  SEG_COUNT	
  SEG_NBR
  TKT_DATE	
  TKT_NUM
  TKT_SORT
  TKT_TYPE   
  TRN_DATE   
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
BY AIRLINE_NAME
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TFARE
      TLOW
      TMILE
      TTKT
BY LEVEL_DESC
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

-GOTO DEB;
DEFINE FILE AIRHOLD2
FLAG/A1 = IF SEG_NBR EQ '01' OR RF_FLAG EQ 'P' OR EX_FLAG EQ 'P'
          OR DOC_TYPE EQ '1' THEN 'Y' ELSE 'N';
END
-RUN


TABLE FILE AIRHOLD2
PRINT XDPT_DT AS 'ODPT_DT'
      AIRLINE
BY LEVEL_DESC
BY TKT_NUM
IF FLAG EQ 'Y'
WHERE AIRLINE NE ' '
ON TABLE HOLD AS ONEHLD FORMAT ALPHA
END
-RUN


TABLE FILE AIRHOLD2
PRINT AIR_KEY   
  INTL_DOM	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  ARR_TIME
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT   
  DPT_TIME	
  EMB_APT_NM
  EMB_CTY_NM
  EMB_APT_CD	
  FARE_PAID
  FLIGHT   	
  INVOICE_NUM
  LEVEL1
  LEVEL_DESC	
  NET_TKT_CNT
  NEW_ADV_PURCH	
  NEW_SEG_MILES   
  REFUSAL_DESC	
  REFUSE_CODE	
  REFUSE_KEY    
  RTE_APT_CD    	
  RTE_APT_NM	
  RTE_CTY_NM   
  SEG_COUNT
  SEG_NBR
  TKT_DATE	
  TKT_SORT
  TKT_TYPE   
  TRN_DATE   
  XDPT_DT
  XFST_DPT
  XTRAN_DT
  XPSNGR_NM	
  DTSAVE
  TFARE
  TLOW
  TMILE
  TTKT
BY LEVEL_DESC
BY TKT_NUM
ON TABLE HOLD AS TWOHLD
END
-RUN

MATCH FILE TWOHLD
PRINT AIR_KEY
   INTL_DOM	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  ARR_TIME
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT   
  DPT_TIME	
  EMB_APT_NM
  EMB_CTY_NM
  EMB_APT_CD	
  FARE_PAID
  FLIGHT   	
  INVOICE_NUM
  LEVEL1
  LEVEL_DESC	
  NET_TKT_CNT
  NEW_ADV_PURCH	
  NEW_SEG_MILES   
  REFUSAL_DESC	
  REFUSE_CODE	
  REFUSE_KEY    
  RTE_APT_CD    	
  RTE_APT_NM	
  RTE_CTY_NM   
  SEG_COUNT
  SEG_NBR
  TKT_DATE	
  TKT_SORT
  TKT_TYPE   
  TRN_DATE   
  XDPT_DT
  XFST_DPT
  XTRAN_DT
  XPSNGR_NM	
  DTSAVE
  TFARE
  TLOW
  TMILE
  TTKT
BY LEVEL_DESC
BY TKT_NUM
ON TABLE HOLD
RUN
FILE ONEHLD
SUM ODPT_DT
BY LEVEL_DESC
BY TKT_NUM
AFTER MATCH HOLD AS AIRHOLD3 OLD-AND-NEW
END
-RUN


-DEB 
TABLE FILE AIRHOLD2
PRINT 
   INTL_DOM	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  ARR_TIME
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT   
  DPT_TIME	
  EMB_APT_NM
  EMB_CTY_NM
  EMB_APT_CD	
  FARE_PAID
  FLIGHT   	
  INVOICE_NUM
  LEVEL1
  LEVEL_DESC	
  NET_TKT_CNT
  NEW_ADV_PURCH	
  NEW_SEG_MILES   
  REFUSAL_DESC	
  REFUSE_CODE	
  REFUSE_KEY    
  RTE_APT_CD    	
  RTE_APT_NM	
  RTE_CTY_NM   
  SEG_COUNT
  SEG_NBR
  TKT_DATE
  TKT_NUM
  TKT_SORT
  TKT_TYPE   
  TRN_DATE   
  XDPT_DT
  XFST_DPT
  XTRAN_DT
  XPSNGR_NM	
  DTSAVE
  TFARE
  TLOW
  TMILE
  TTKT
-*  ODPT_DT
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD4
END
-RUN



-IF '&&ROLLUP.EVAL' EQ 'TENAS-R' THEN GOTO EXTENAS;

-EXTENAS

EX UDTENAS
-RUN


-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD5';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE AIRHOLD5
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-* -INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-*-*-EXIT




