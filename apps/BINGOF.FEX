-* 4/2/14 - DV - CREATED FOR SETFILE BNINTERH


-INCLUDE SETECHO


-SET ASNAMES = ON;
DEFINE FILE BOOKSUM
LEVEL_DESC_CENTERED/A60 = CTRFLD(LEVEL_DESC, 60, 'A60');
END
TABLE FILE BOOKSUM
PRINT 
  ABOOK_CNT
  ABOOK_FARE
  ABOOK_DSAVE
  ABOOK_SAV
  ABOOK_CNT2
  ABOOK_FARE2
  AIR_KEY
  AIRLINE
  ARR_TIME
  BB_CNT
  BB_FARE
  CLASS_CAT
  CTRY_FLAG
  CTRY_FLAG2
  DPT_TIME
  EMB_CTY_NM
  EXC_CNT
  EXC_FARE
  FARE_PAID
  FARE_IBOOKX
  FARE_ABOOKX
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IBOOK_SAV
  KWLEV
  LEVEL_DESC
  LEVEL_DESC_CENTERED
  LEVEL1
  LEVEL2
  LEVEL3
  NAMEC
  NB_CNT
  NB_FARE
  OA_CNT
  NET_TKT_CNT
  PAID_FAREX
  RTE_CTY_NM
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_NBR
  TKT_NUM
  TKT_SORT
  TKT_TYPE
  TRAN_MY
  TRN_DATE
  WBOOK_CNT
  WBOOK_FARE
  XARR_DT
  XDPT_DT
  XDPT_DATE
  XPSNGR_NM
  XTRAN_DT
  LEVEL_DESC
  
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3 FORMAT FOCUS INDEX AIR_KEY
END
-RUN

TABLE FILE ROLLUP
PRINT COMP
IF ROLLUP EQ '&&ROLLUP.EVAL'
ON TABLE HOLD AS ROLLHOLD
END
-RUN

-READ ROLLHOLD &&COMP.A6
-SET &&COMPNY = &&COMP.EVAL;
 
-SET &&COMPUA = 'D:\TNT\TTRACKER\DATA\UA'|| '&&COMPNY.EVAL' ||'.FOC';
-RUN



 

USE CLEAR *
USE 
&&COMPUA AS UDAIR
D:\TNT\TTRACKER\SYSTEM\DATA\UDID_DSC.FOC AS UDID_DSC
END

 
TABLE FILE UDAIR
PRINT AUD_DATA AS 'OF_TOUCH'
BY AIR_KEY
IF UDID EQ OFT
ON TABLE HOLD AS UDIDHOLD2 FORMAT FOCUS INDEX AIR_KEY
END
-RUN

JOIN AIR_KEY IN AIRHOLD3 TO AIR_KEY IN UDIDHOLD2 AS J1
-RUN


DEFINE FILE AIRHOLD3
OF_CNT/D12 = IF OF_TOUCH EQ 'Y' THEN IBOOK_CNT ELSE 0;
OF_FARE/D12.2CS = IF OF_TOUCH EQ 'Y' THEN IBOOK_FARE ELSE 0;
 
END
TABLE FILE AIRHOLD3
PRINT  ABOOK_CNT
  ABOOK_FARE
  ABOOK_DSAVE
  ABOOK_SAV
  ABOOK_CNT2
  ABOOK_FARE2
  AIR_KEY
  AIRLINE
  ARR_TIME
  BB_CNT
  BB_FARE
  CLASS_CAT
  CTRY_FLAG
  CTRY_FLAG2
  DPT_TIME
  EMB_CTY_NM
  EXC_CNT
  EXC_FARE
  FARE_PAID
  FARE_IBOOKX
  FARE_ABOOKX
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IBOOK_SAV
  KWLEV
  LEVEL_DESC
  LEVEL_DESC_CENTERED
  LEVEL1
  LEVEL2
  LEVEL3
  NAMEC
  NB_CNT
  NB_FARE
  OA_CNT
  NET_TKT_CNT
  PAID_FAREX
  RTE_CTY_NM
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_NBR
  TKT_NUM
  TKT_SORT
  TKT_TYPE
  TRAN_MY
  TRN_DATE
  WBOOK_CNT
  WBOOK_FARE
  XARR_DT
  XDPT_DT
  XDPT_DATE
  XPSNGR_NM
  XTRAN_DT
  OF_TOUCH
  OF_CNT
  OF_FARE
BY  LEVEL_DESC
ON TABLE HOLD AS XTHREE
END
-RUN
 

 



-SET &&NORECALL = IF &RECORDS EQ 0 THEN 'Y' ELSE 'N';
 
 
-GOTO XXITA;

 
-XXITA 