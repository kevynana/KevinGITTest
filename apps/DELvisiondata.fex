-* File DELVISIONDATA.FEX
-* THIS PROGRAM DELETES DATA FOR A CERTAIN TIME PERIOD FROM
-* AIR, CAR, HOTEL, SEGMENT, MARKET, DESTINATION, TKT_MAIN
-*

-* hold for delete - Segment


TABLE FILE S5KIEW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR TRN_DATE
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
WHERE (TRN_DATE GE '20080101') AND (TRN_DATE LE '20080131')
WHERE AIR_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS HOLDS
END
-RUN

-* SEGMENT
MODIFY FILE S5KIEW
FIXFORM FROM HOLDS
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLDS
END
-RUN

-* hold for delete - Market

TABLE FILE M5KIEW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR TRN_DATE
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
WHERE (TRN_DATE GE '20080101') AND (TRN_DATE LE '20080131')
WHERE AIR_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS HOLDM
END
-RUN

-* MARKET
MODIFY FILE M5KIEW
FIXFORM FROM HOLDM
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLDM
END
-RUN

-* hold for delete - Market

TABLE FILE D5KIEW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR TRN_DATE
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
WHERE (TRN_DATE GE '20080101') AND (TRN_DATE LE '20080131')
WHERE AIR_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS HOLDD
END
-RUN

-* Destination
MODIFY FILE D5KIEW
FIXFORM FROM HOLDD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLDD
END
-RUN

-* hold for delete - Ticket

TABLE FILE T5KIEW
PRINT AIR_KEY 
BY AIR_KEY NOPRINT
WHERE AIR_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS HOLDT
END
-RUN

-* Ticket
MODIFY FILE T5KIEW
FIXFORM FROM HOLDT
MATCH AIR_KEY 
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLDT
END
-RUN


-* Air_main
TABLE FILE A5KIEW
PRINT AIR_KEY
BY AIR_KEY
WHERE AIR_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS HOLDA
END
-RUN

MODIFY FILE A5KIEW
FIXFORM FROM HOLDA
MATCH AIR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLDA
END
-RUN


-* CAR

TABLE FILE C5KIEW
PRINT CAR_KEY
BY CAR_KEY NOPRINT
WHERE CAR_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS CHOLD
END
-RUN

MODIFY FILE C5KIEW
FIXFORM FROM CHOLD
MATCH CAR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON CHOLD
END
-RUN

-* HOTEL

TABLE FILE H5KIEW
PRINT HTL_KEY
BY HTL_KEY NOPRINT
WHERE HTL_KEY CONTAINS 'KW999999'
ON TABLE HOLD AS HHOLD
END
-RUN

MODIFY FILE H5KIEW
FIXFORM FROM HHOLD
MATCH HTL_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HHOLD
END
-RUN


JOIN CLEAR *
-EXIT
