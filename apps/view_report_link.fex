-* File view_report_link.fex
-*
-*  01/11/2017  REJ  S-24224 Added logging to the viewing of the Report links.
 
-DEFAULT &RURL='';
-DEFAULT &ETEKUSER='';
-DEFAULT &REMOTE_ADDR='';
-DEFAULT &IKEY=0;
-DEFAULT &RNAME='';
-DEFAULT &DTOKEN='';
 
-*SQL SQLMSS
-*TRUNCATE TABLE Review.dbo.report_view_log;
-*END
-*-RUN
-*-EXIT
-*TABLE FILE REPORT_VIEW_LOG
-*PRINT *
-*END
-*-RUN
-*-EXIT
JOIN CLEAR *
JOIN RPT_INST_KEY WITH USER_ID IN CONTROL TO INST_KEY IN RPT_INST AS J1
-RUN
DEFINE FILE CONTROL
RPT_INST_KEY/I11=&IKEY;
END
TABLE FILE CONTROL
SUM
COMPUTE RPT_NAME/A100='&RNAME';
COMPUTE RPT_LINK/A255='&RURL';
 FST.RPT_INST_KEY
 GLOBAL_PARM
COMPUTE DB_TOKEN/A72='&DTOKEN';
COMPUTE VIEWED_DATE/HYYMDs = HGETC(10, 'HYYMDs');
COMPUTE VIEWED_BY_USER/A50V='&ETEKUSER';
COMPUTE VIEWED_BY_IP/A50V='&REMOTE_ADDR';
BY USER_ID NOPRINT
ON TABLE SET ASNAMES ON
ON TABLE SET HOLDLIST PRINTONLY
ON TABLE HOLD AS HLD0001
END
-RUN
 
MODIFY FILE REPORT_VIEW_LOG
FIXFORM FROM HLD0001
MATCH *
 ON MATCH REJECT
 ON NOMATCH INCLUDE
DATA ON HLD0001
END
-RUN
 
-HTMLFORM BEGIN
 
<html>
<head>
<script>
location.href="&RURL.EVAL";
</script>
</head>
<body>
</body>
</html>
 
-HTMLFORM END
