-* File DrillToRep.fex
SET ASNAMES=ON
-*SET TEMPERASE = OFF
JOIN CHAIN_CODE IN HYMETX TO ALL CHAIN_CODE IN HOTL_CHN
END

DEFINE FILE HYMETX
  NBR_DAYS/D12 =  NUM_DAYS;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  REFUSE_CD/A2 = EDIT(REFUSE_KEY,'$$$$$$$$99');
  
  
   BOOKINGS/D8 = IF TOTAL_AMT GE 0 THEN 1 ELSE (-1);
   PREF_NON/A15 = IF REFUSE_CD EQ 'A' OR 'T' OR 'R' THEN 'Preferred'
                  ELSE 'Non-Preferred';  
   NEW_TOTAL_AMT/D12.2CS = TOTAL_AMT;
END
-RUN

TABLE FILE HYMETX
SUM BOOKINGS AS 'BOOKINGS' NNROOMS AS 'NUMBER,NIGHTS' 
    NEW_TOTAL_AMT AS 'TOTAL,SPEND'
COMPUTE AVR/D12.2 = NEW_TOTAL_AMT/NNROOMS; AS 'AVERAGE,DAILY,RATE'
-* BY CHAIN_NAME
BY PASSNGR_NAME
WHERE CHAIN_NAME EQ '&CHAIN_NAME.EVAL'
WHERE INVOICE_DATE GE '20060901' AND INVOICE_DATE LE '20060930'
-* WHERE RECORDLIMIT EQ 10
ON TABLE PCHOLD FORMAT PDF
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.500000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, STYLE=NORMAL, $
TYPE=TITLE, FONT=TIMES NEW ROMAN, SIZE=8, STYLE=BOLD, $
TYPE=GRANDTOTAL, FONT=TIMES NEW ROMAN, SIZE=8, STYLE=BOLD, $
$
TYPE=DATA,
     GRID=OFF,
     FONT='TIMES NEW ROMAN',
     SIZE=7,
     COLOR='BLACK',
     BACKCOLOR='NONE',
     STYLE=NORMAL,
$

ENDSTYLE
END
-RUN


