-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO
-* File ABLIMEX.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*8/11/16-JEM-S-21166-Created for new report abachlfl
-********************************************************************
-*SET &ECHO=ALL;
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
 
-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';
 
DEFINE FILE &&EXTRACT
LDDATE/MDYY = DROP_DATE;
LDRATE/D12.2CS=DAILY_RATE;
LEVEL_DESC/A60 = &&LDESC;
NBR_DAYS/D12CS = NUM_DAYS;
LRENTALA/P12.2CS = RENTAL_AMT;
  LRENTAL_DAYS/D12CS = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
 LPDATE/MDYY = PICKUP_DATE;
 
  XPSNGR_NM/A15        =
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
RSTAT/A1 = EDIT(RESV_STATUS, '$9');
LRES_DSC/A10 = DECODE RSTAT (O 'OPEN' C 'CANCELLED' X 'CHANGED');
LFLAG/A1='L';
END
 
 
TABLEF FILE &&EXTRACT
PRINT CAR_KEY
  LDDATE
  LDRATE
  DROP_CTY.CITY_NAME/A14 AS 'LD_CITY'
  LFLAG
  LPDATE
  LRENTALA
  LRENTAL_DAYS
  LRES_DSC
  INVOICE_DATE
  LEVEL_DESC
  LEVEL1
  PASSNGR_NAME
  PICK_CTY.CITY_NAME/A14 AS 'LP_CITY'
  PNR_LOCATOR
  RESV_STATUS
  TKT_NUM
  VENDOR_NAME
  XPSNGR_NM
-*WHERE INVOICE_DATE GE '&&FROMDT.EVAL' AND INVOICE_DATE LE '&&TODT.EVAL'
-INCLUDE &CARDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
 
-INCLUDE RPTPARMS
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
ON TABLE HOLD AS LIM_HOLD
END
-RUN
 
DEFINE FILE LIM_HOLD
LKEYR/A82=REVERSE(82, CAR_KEY, LKEYR);
LKEYR1/A81=EDIT(LKEYR, '$999999999999999999999999999999999999999999999999999999999999999999999999999999999');
LKEY1/A82=REVERSE(82, LKEYR1, LKEY1);
END
 
TABLE FILE LIM_HOLD
SUM PNR_LOCATOR TKT_NUM LDRATE LRENTALA LRENTAL_DAYS PASSNGR_NAME LFLAG LD_CITY LDDATE LEVEL_DESC
    LPDATE LRES_DSC LP_CITY VENDOR_NAME LEVEL_DESC
BY LKEY1
ON TABLE HOLD AS LIM_HOLD1
END
 
TABLE FILE LIM_HOLD1
PRINT PNR_LOCATOR TKT_NUM LDRATE LRENTALA LRENTAL_DAYS PASSNGR_NAME LFLAG LD_CITY LDDATE LEVEL_DESC
      LPDATE LRES_DSC LP_CITY VENDOR_NAME LEVEL_DESC
BY PNR_LOCATOR
BY TKT_NUM
WHERE LRENTALA NE 0
ON TABLE HOLD AS LIM_HOLD2
END
 
 
 
DEFINE FILE LIM_HOLD2
LKEY/A20=PNR_LOCATOR||TKT_NUM;
END
TABLE FILE LIM_HOLD2
PRINT LDRATE LRENTALA LRENTAL_DAYS PASSNGR_NAME LFLAG LD_CITY LDDATE LEVEL_DESC
      LPDATE LRES_DSC LP_CITY VENDOR_NAME LEVEL_DESC
COMPUTE CNTRA/D9=1;
COMPUTE CNTR2/D9=IF LKEY NE LAST LKEY THEN 1 ELSE LAST CNTR2 + 1;
BY PNR_LOCATOR
BY TKT_NUM
ON TABLE HOLD AS ABLIM1
END
 
-* LIMO1 FIELDS
TABLE FILE ABLIM1
PRINT CNTR2
      LDDATE AS 'L1_LDATE'
      LDRATE AS 'L1_LDRATE'
      LD_CITY AS 'L1_LD_CITY'
      LFLAG AS 'LFLAG1'
      LPDATE AS 'L1_LPDATE'
      LRENTALA AS 'L1_LRENTALA'
      LRENTAL_DAYS AS 'L1_LRENTAL_DAYS'
      LRES_DSC AS 'L1_RES_DSC'
      LP_CITY AS 'L1_LP_CITY'
      VENDOR_NAME AS 'L1_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 1
ON TABLE HOLD AS ABLIMH1
END
-RUN
 
-*LIMO 2 FIELDS
TABLE FILE ABLIM1
PRINT CNTR2
      LDDATE AS 'L2_LDATE'
      LDRATE AS 'L2_LDRATE'
      LD_CITY AS 'L2_LD_CITY'
      LFLAG AS 'LFLAG2'
      LPDATE AS 'L2_LPDATE'
      LRENTALA AS 'L2_LRENTALA'
      LRENTAL_DAYS AS 'L2_LRENTAL_DAYS'
      LRES_DSC AS 'L2_RES_DSC'
      LP_CITY AS 'L2_LP_CITY'
      VENDOR_NAME AS 'L2_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 2
ON TABLE HOLD AS ABLIMH2
END
 
-*LIMO 3 FIELDS
TABLE FILE ABLIM1
PRINT CNTR2
      LDDATE AS 'L3_LDATE'
      LDRATE AS 'L3_LDRATE'
      LD_CITY AS 'L3_LD_CITY'
      LFLAG AS 'LFLAG3'
      LPDATE AS 'L3_LPDATE'
      LRENTALA AS 'L3_LRENTALA'
      LRENTAL_DAYS AS 'L3_LRENTAL_DAYS'
      LRES_DSC AS 'L3_RES_DSC'
      LP_CITY AS 'L3_LP_CITY'
      VENDOR_NAME AS 'L3_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 3
ON TABLE HOLD AS ABLIMH3
END
 
-*LIMO 4 FIELDS
TABLE FILE ABLIM1
PRINT CNTR2
      LDDATE AS 'L4_LDATE'
      LDRATE AS 'L4_LDRATE'
      LD_CITY AS 'L4_LD_CITY'
      LFLAG AS 'LFLAG4'
      LPDATE AS 'L4_LPDATE'
      LRENTALA AS 'L4_LRENTALA'
      LRENTAL_DAYS AS 'L4_LRENTAL_DAYS'
      LRES_DSC AS 'L4_RES_DSC'
      LP_CITY AS 'L4_LP_CITY'
      VENDOR_NAME AS 'L4_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 4
ON TABLE HOLD AS ABLIMH4
END
 
-*LIMO 5 FIELDS
TABLE FILE ABLIM1
PRINT CNTR2
      LDDATE AS 'L5_LDATE'
      LDRATE AS 'L5_LDRATE'
      LD_CITY AS 'L5_LD_CITY'
      LFLAG AS 'LFLAG5'
      LPDATE AS 'L5_LPDATE'
      LRENTALA AS 'L5_LRENTALA'
      LRENTAL_DAYS AS 'L5_LRENTAL_DAYS'
      LRES_DSC AS 'L5_RES_DSC'
      LP_CITY AS 'L5_LP_CITY'
      VENDOR_NAME AS 'L5_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 5
ON TABLE HOLD AS ABLIMH5
END
 
-*MATCH FILES
MATCH FILE ABLIMH1
PRINT L1_LDATE L1_LDRATE L1_LD_CITY LFLAG1 L1_LPDATE L1_LRENTALA L1_LRENTAL_DAYS L1_RES_DSC L1_LP_CITY L1_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABLIMH2
PRINT L2_LDATE L2_LDRATE L2_LD_CITY LFLAG2 L2_LPDATE L2_LRENTALA L2_LRENTAL_DAYS L2_RES_DSC L2_LP_CITY L2_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABLIMH12 OLD-OR-NEW
END
 
MATCH FILE ABLIMH12
PRINT L1_LDATE L1_LDRATE L1_LD_CITY LFLAG1 L1_LPDATE L1_LRENTALA L1_LRENTAL_DAYS L1_RES_DSC L1_LP_CITY L1_VENDOR
      L2_LDATE L2_LDRATE L2_LD_CITY LFLAG2 L2_LPDATE L2_LRENTALA L2_LRENTAL_DAYS L2_RES_DSC L2_LP_CITY L2_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABLIMH3
PRINT L3_LDATE L3_LDRATE L3_LD_CITY LFLAG3 L3_LPDATE L3_LRENTALA L3_LRENTAL_DAYS L3_RES_DSC L3_LP_CITY L3_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABLIMH123 OLD-OR-NEW
END
 
MATCH FILE ABLIMH123
PRINT L1_LDATE L1_LDRATE L1_LD_CITY LFLAG1 L1_LPDATE L1_LRENTALA L1_LRENTAL_DAYS L1_RES_DSC L1_LP_CITY L1_VENDOR
      L2_LDATE L2_LDRATE L2_LD_CITY LFLAG2 L2_LPDATE L2_LRENTALA L2_LRENTAL_DAYS L2_RES_DSC L2_LP_CITY L2_VENDOR
      L3_LDATE L3_LDRATE L3_LD_CITY LFLAG3 L3_LPDATE L3_LRENTALA L3_LRENTAL_DAYS L3_RES_DSC L3_LP_CITY L3_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABLIMH4
PRINT L4_LDATE L4_LDRATE L4_LD_CITY LFLAG4 L4_LPDATE L4_LRENTALA L4_LRENTAL_DAYS L4_RES_DSC L4_LP_CITY L4_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABLIMH1234 OLD-OR-NEW
END
 
MATCH FILE ABLIMH1234
PRINT L1_LDATE L1_LDRATE L1_LD_CITY LFLAG1 L1_LPDATE L1_LRENTALA L1_LRENTAL_DAYS L1_RES_DSC L1_LP_CITY L1_VENDOR
      L2_LDATE L2_LDRATE L2_LD_CITY LFLAG2 L2_LPDATE L2_LRENTALA L2_LRENTAL_DAYS L2_RES_DSC L2_LP_CITY L2_VENDOR
      L3_LDATE L3_LDRATE L3_LD_CITY LFLAG3 L3_LPDATE L3_LRENTALA L3_LRENTAL_DAYS L3_RES_DSC L3_LP_CITY L3_VENDOR
      L4_LDATE L4_LDRATE L4_LD_CITY LFLAG4 L4_LPDATE L4_LRENTALA L4_LRENTAL_DAYS L4_RES_DSC L4_LP_CITY L4_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABLIMH5
PRINT L5_LDATE L5_LDRATE L5_LD_CITY LFLAG5 L5_LPDATE L5_LRENTALA L5_LRENTAL_DAYS L5_RES_DSC L5_LP_CITY L5_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABLIMH12345 OLD-OR-NEW
END
 
 
 
TABLE FILE ABLIMH12345
PRINT L1_LDATE L1_LDRATE L1_LD_CITY LFLAG1 L1_LPDATE L1_LRENTALA L1_LRENTAL_DAYS L1_RES_DSC L1_LP_CITY L1_VENDOR
      L2_LDATE L2_LDRATE L2_LD_CITY LFLAG2 L2_LPDATE L2_LRENTALA L2_LRENTAL_DAYS L2_RES_DSC L2_LP_CITY L2_VENDOR
      L3_LDATE L3_LDRATE L3_LD_CITY LFLAG3 L3_LPDATE L3_LRENTALA L3_LRENTAL_DAYS L3_RES_DSC L3_LP_CITY L3_VENDOR
      L4_LDATE L4_LDRATE L4_LD_CITY LFLAG4 L4_LPDATE L4_LRENTALA L4_LRENTAL_DAYS L4_RES_DSC L4_LP_CITY L4_VENDOR
      L5_LDATE L5_LDRATE L5_LD_CITY LFLAG5 L5_LPDATE L5_LRENTALA L5_LRENTAL_DAYS L5_RES_DSC L5_LP_CITY L5_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD AS ABLIM
END
 
 
 
 
 
