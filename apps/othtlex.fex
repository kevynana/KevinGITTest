-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*  03/31/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-* 5/1/2015 - DEB - S-08674 CARRIED THROUGH NNROOMS IN FINAL HOLD FILE
-*10/16/15 - S-11851 Added logic for ABACHLOD (DOMESTIC ONLY) ABACHLOI (INTERNATIONAL ONLY) - JM
-*12/30/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
 

 
-INCLUDE SETECHO
 
FILEDEF RPTPARMS CLEAR
-RUN
  
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
FIXFORM INST_KEY/7 RPT_GROUP/3
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :OTH1;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-GOTO :OTH2;
-:OTH1
EX CODEGEN
-RUN
-:OTH2

-SET &&IDLEVELBREAK = '';
 
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN
 
DEFINE FILE &&EXTRACT
HBOOK/P8CS = IF TOTAL_AMT GE 0 THEN 1 ELSE (-1);
LEVEL_DESC1/A80      = &&LDESC;
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/P12CS = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
HTL_DT/MDYY         = CHKIN_DATE;
HTL_AMT/D12.2 = TOTAL_AMT;
TRN_DATE/YYMD = INVOICE_DATE;
OTFLAG/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';
 
HTKTN/A10 = IF TKT_NUM EQ '0000000000' THEN 'HTL ONLY' ELSE TKT_NUM;
 
HI_AMT/D12.2CS = IF OTFLAG EQ 'Y' THEN HTL_AMT ELSE 0;
HIBOOK_CNT/D8CS = IF OTFLAG EQ 'Y' THEN HBOOK ELSE 0;
HT_AMT/D12.2CS = IF OTFLAG EQ 'N' THEN HTL_AMT ELSE 0;
HTBOOK_CNT/D8CS = IF OTFLAG EQ 'N' THEN HBOOK ELSE 0;
HIDAYS/D8CS = IF OTFLAG EQ 'Y' THEN NNROOMS ELSE 0;
HTDAYS/D8CS = IF OTFLAG EQ 'N' THEN NNROOMS ELSE 0;
FLAG/A5 = 'HOTEL';
-INCLUDE IDLEVDEFINE 
END
TABLE FILE &&EXTRACT
SUM HBOOK HTL_AMT HI_AMT HIBOOK HT_AMT HTBOOK HIDAYS HTDAYS NNROOMS AS 'TROOMS'
BY LEVEL_DESC
BY FLAG
-INCLUDE &HTLDATES
-INCLUDE RPTPARMS

-IF '&&SETF.EVAL' EQ 'ABACHLD' GOTO INTD;
-IF '&&SETF.EVAL' EQ 'ABACHLI' GOTO INTI;
-GOTO INTDONE;
-INTD;
WHERE CITY.INTL_DOM EQ 'D'
-GOTO INTDONE;
-INTI;
WHERE CITY.INTL_DOM EQ 'I'
-GOTO INTDONE;
-INTDONE;
ON TABLE HOLD AS HTLHLD
END
-RUN

