-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO
-* File SUBMIT00.FEX - ONLY TRAVEL SUMMARY DATES YYMD - ALL OTHERS MDYY
-****************************************************************************
-* This program will automate the running of management cycle reports
-* through Report Broker.  It is designed to set up date variables and
-* determine which report sets (MONTHLY, QUARTERLY, ANNUAL, etc) need to
-* run.
-*
-* DATE           NAME             DESCRIPTION
-* 4/18/01        TANDT-SS         NEW PROGRAM
-* 7/10/02        STEVE/DEB        CHANGED FT03 DEFINE TO
-*                                 (FT01 + 2) - USED TO BE (FT01 + 1)
-*10/14/02        STEVE            ADDED CODE FOR ETS - EXECUTIVE OVERVIEW
-*10/24/02        STEVE            ADDED FT03A DEFINE AND CHANGED FP01/FP02
-****************************************************************************
-TYPE SUBMIT00
-RUN

SET ASNAMES=ON
SET YRTHRESH=30
SET DEFCENT=19
SET WARNING=OFF

FILEDEF * CLEAR
-* JOIN CLEAR *
USE CLEAR *

-* FILEDEF RUNCOS  DISK  c:\FOCTEMP\RUNCOS.FTM
-* FILEDEF XDATES  DISK  c:\FOCTEMP\XDATES.FTM
-* FILEDEF SET1    DISK  c:\FOCTEMP\SET1.FTM
-* FILEDEF SET2    DISK  c:\FOCTEMP\SET2.FTM
-* FILEDEF SETA    DISK  c:\FOCTEMP\SETA.FTM
-* FILEDEF INST1   DISK  c:\FOCTEMP\INST1.FTM
-* FILEDEF INST3   DISK  c:\FOCTEMP\INST3.FTM

EX SUUSES
-RUN

-*------------------------------------
-* Find Rollup-Codes to run reports
-*------------------------------------
-AUTOSTART

-* Create Time Stamp for RPT_QUE file
-SET &&TSTAMPT1=EDIT(&TOD,'99$99$99');

TABLE FILE ROLLUP
PRINT ROLL_FY
      UPD_STAT
      PR_STAMP
      RUN_RPT
BY ROLLUP_CODE
IF UPD_STAT EQ ' '
IF PR_STAMP EQ 'R'
IF RUN_RPT EQ 'X'
-* IF ROLLUP EQ 'KOHLS-R'
ON TABLE HOLD AS RUNCOS
END
-RUN
-IF &RECORDS EQ 0 GOTO NODATA;

DEFINE FILE RUNCOS
 XL01/MDYY = &MDYY;
 XL02/I8MDYY=XL01;
 XL03/A8MDYY=EDIT(XL02);
 XL04/A8=XL03;
 XL05/A2=EDIT(XL04,'99$$$$$$');
 XL06/A4=EDIT(XL04,'$$$$9999');
 XL07/A3=IF XL05 EQ '01' THEN 'DEC' ELSE
         IF XL05 EQ '02' THEN 'JAN' ELSE
         IF XL05 EQ '03' THEN 'FEB' ELSE
         IF XL05 EQ '04' THEN 'MAR' ELSE
         IF XL05 EQ '05' THEN 'APR' ELSE
         IF XL05 EQ '06' THEN 'MAY' ELSE
         IF XL05 EQ '07' THEN 'JUN' ELSE
         IF XL05 EQ '08' THEN 'JUL' ELSE
         IF XL05 EQ '09' THEN 'AUG' ELSE
         IF XL05 EQ '10' THEN 'SEP' ELSE
         IF XL05 EQ '11' THEN 'OCT' ELSE
         IF XL05 EQ '12' THEN 'NOV' ;
 XL08/A7=XL07||XL06;
 DT01/YYMD = &YMD ;
 DT02/YM   = DT01 ;
 DT03/YM   = DT02 - 1;
 DT04T/YYMD = DT03;
 DT04/MDYY = DT03;
 DT05/YYMD = DT02;
 DT06T/YYMD = DT05 - 1;
 DT06/MDYY = DT05 - 1;
 DT07/M = DT03;
 TS01/I8MDYY = DT04;
 TS02/I8MDYY = TS01 - 1;
-*  TS03/YYMD = TS02;
 TS03/MDYY = TS02;
 TS04/YY = TS03;
-*  TS05/YYMD = TS04;
 TS05/MDYY = TS04;
 TS06/YY = TS01;
-*  TS07/YYMD = TS06;
 TS07/MDYY = TS06;
 TS08/I8MDYY = DT06;
 TS09/I8MDYY = TS08 - 1;
 TS10/MDYY = TS09;
 QT01/YM = DT02 - 3;
 QT02/MDYY = QT01;
 QT03/MDYY = QT02;
 QT04/I8MDYY = QT02;
 QT05/I8MDYY = QT04 - 1;
 QT06/MDYY = QT05;
 KFY/YYM = IF ROLL_FY EQ '01' THEN 1 ELSE
           IF ROLL_FY EQ '02' THEN 2 ELSE
           IF ROLL_FY EQ '03' THEN 3 ELSE
           IF ROLL_FY EQ '04' THEN 4 ELSE
           IF ROLL_FY EQ '05' THEN 5 ELSE
           IF ROLL_FY EQ '06' THEN 6 ELSE
	   IF ROLL_FY EQ '07' THEN 7 ELSE
	   IF ROLL_FY EQ '08' THEN 8 ELSE
	   IF ROLL_FY EQ '09' THEN 9 ELSE
	   IF ROLL_FY EQ '10' THEN 10 ELSE
	   IF ROLL_FY EQ '11' THEN 11 ELSE
	   IF ROLL_FY EQ '12' THEN 12 ELSE 0;
FT01/I8MDYY = KFY;
FT02/M = FT01;
FT03A/I8MDYY = FT01 + 1;
FT03/I8MDYY = FT01 + 2;
FT04/YYMD = FT03;
FT05/MDYY = IF FT02 GE DT07 THEN FT01 ELSE FT04;
FP01/I8MDYY = FT03A - 1;
FP02/MDYY = IF FT02 GE DT07 THEN FP01 ELSE FT03A;
END

TABLE FILE RUNCOS
PRINT ROLLUP_CODE ROLL_FY XL07 DT04 DT04T DT06 DT06T TS03 TS05 TS07 TS10
QT02 QT04 QT05 QT06 FT03 FT05 FP02
-* FT01 FT02 DT07 FP01 KFY XL05 XL06 XL08 DT01 DT02 DT03
BY ROLLUP_CODE NOPRINT
IF RECORDLIMIT EQ 1
ON TABLE SAVE AS XDATES
END
-IF &RECORDS EQ 0 GOTO NODATA;
-RUN
-READ XDATES &&ROLL.A8. &&ROLL_FY.A2. &&XL07.A3. &&DT04.A8.,
-,&&DT04T.A8. &&DT06.A8. &&DT06T.A8. &&TS03.A8. &&TS05.A8.,
-,&&TS07.A8. &&TS10.A8. &&QT02.A8. &&QT04.A8. &&QT05.A8. &&QT06.A8.,
-,&&FT03.A8. &&FT05.A8. &&FP02.A8.
-RUN

-SET &&MONTH      = &&XL07;
-SET &&ROLL       = &&ROLL;
-SET &&FY         = &&ROLL_FY;
-SET &&FM_DATE    = &&DT04;
-SET &&TO_DATE    = &&DT06;
-SET &&FX_DATE    = &&TS03;
-SET &&TX_DATE    = &&TS10;
-SET &&CMFM_DATE  = &&DT04;
-SET &&CMTO_DATE  = &&DT06;
-SET &&PMFM_DATE  = &&TS03;
-SET &&PMTO_DATE  = &&TS10;
-SET &&CYFM_DATE  = &&TS07;
-SET &&CYTO_DATE  = &&DT06;
-SET &&PYFM_DATE  = &&TS05;
-SET &&PYTO_DATE  = &&TS10;
-SET &&YFM_DATE   = &&FT03;
-SET &&YTO_DATE   = &&DT06;
-SET &&YCMFM_DATE = &&TS07;
-SET &&YCMTO_DATE = &&DT06;
-SET &&YPMFM_DATE = &&TS05;
-SET &&YPMTO_DATE = &&TS10;
-SET &&YCYFM_DATE = &&TS07;
-SET &&YCYTO_DATE = &&DT06;
-SET &&YPYFM_DATE = &&TS05;
-SET &&YPYTO_DATE = &&TS10;
-SET &&QFM_DATE   = &&QT04;
-SET &&QTO_DATE   = &&DT06;
-SET &&QCMFM_DATE = &&QT02;
-SET &&QCMTO_DATE = &&DT06;
-SET &&QPMFM_DATE = &&QT06;
-SET &&QPMTO_DATE = &&TS10;
-SET &&QCYFM_DATE = &&TS07;
-SET &&QCYTO_DATE = &&DT06;
-SET &&QPYFM_DATE = &&TS05;
-SET &&QPYTO_DATE = &&TS10;
-SET &&KFM_DATE   = &&FT03;
-SET &&KCMFM_DATE = &&FT05;
-SET &&KCYFM_DATE = &&FT05;
-SET &&KPMFM_DATE = &&FP02;
-SET &&KPYFM_DATE = &&FP02;
-RUN
EX SUBMIT10
-RUN
EX SUBMIT20
-RUN
-*==========================================================================
-*                      Determine Quarterly runs
-*==========================================================================
-* -SET &&CHK1=IF &&MONTH = 'MAR' OR 'JUN' OR 'SEP' OR 'DEC' THEN 'A' ELSE ' ';
-* -SET &&CHK2=IF &&FY = '01' OR '04' OR '07' OR '10' THEN 'A' ELSE ' ' ;
-* -SET &&CHK3=&&CHK1||&&CHK2 ;
-* -SET &&CHK4=IF &&MONTH = 'APR' OR 'JUL' OR 'OCT' OR 'JAN' THEN 'B' ELSE ' ';
-* -SET &&CHK5=IF &&FY EQ '02' OR '05' OR '08' OR '11' THEN 'B' ELSE ' ';
-* -SET &&CHK6=&&CHK4||&&CHK4 ;
-* -SET &&CHK7=IF &&MONTH = 'MAY' OR 'AUG' OR 'NOV' OR 'FEB' THEN 'C' ELSE ' ';
-* -SET &&CHK8=IF &&FY EQ '03' OR '06' OR '09' OR '12' THEN 'C' ELSE ' ';
-* -SET &&CHK9=&&CHK7||&&CHK8 ;
-* -IF &&CHK3 = 'AA' THEN GOTO SUBQTR ELSE
-* -IF &&CHK6 = 'BB' THEN GOTO SUBQTR ELSE
-* -IF &&CHK9 = 'CC' THEN GOTO SUBQTR ELSE GOTO ANNUAL;
-IF (&&MONTH='MAR' OR 'JUN' OR 'SEP' OR 'DEC') AND
-(&&FY EQ '01' OR '04' OR '07' OR '10') THEN GOTO SUBQTR
- ELSE IF (&&MONTH='APR' OR 'JUL' OR 'OCT' OR 'JAN') AND
-(&&FY EQ '02' OR '05' OR '08' OR '11') THEN GOTO SUBQTR
- ELSE IF (&&MONTH='MAY' OR 'AUG' OR 'NOV' OR 'FEB') AND
-(&&FY EQ '03' OR '06' OR '09' OR '12') THEN GOTO SUBQTR
- ELSE GOTO ANNUAL;

-*==========================================================================
-*Submit Quarterly Reports
-*==========================================================================
-SUBQTR
EX SUBMIT30
-RUN
-*==========================================================================
-*Submit Quarterly YTD Reports
-*==========================================================================
EX SUBMIT40
-RUN
-*==========================================================================
-*Determine annual runs
-*==========================================================================
-ANNUAL
-IF &&MONTH='DEC' AND &&FY EQ '01' THEN GOTO SUBANN ;
-IF &&MONTH='JAN' AND &&FY EQ '02' THEN GOTO SUBANN ;
-IF &&MONTH='FEB' AND &&FY EQ '03' THEN GOTO SUBANN ;
-IF &&MONTH='MAR' AND &&FY EQ '04' THEN GOTO SUBANN ;
-IF &&MONTH='APR' AND &&FY EQ '05' THEN GOTO SUBANN ;
-IF &&MONTH='MAY' AND &&FY EQ '06' THEN GOTO SUBANN ;
-IF &&MONTH='JUN' AND &&FY EQ '07' THEN GOTO SUBANN ;
-IF &&MONTH='JUL' AND &&FY EQ '08' THEN GOTO SUBANN ;
-IF &&MONTH='AUG' AND &&FY EQ '09' THEN GOTO SUBANN ;
-IF &&MONTH='SEP' AND &&FY EQ '10' THEN GOTO SUBANN ;
-IF &&MONTH='OCT' AND &&FY EQ '11' THEN GOTO SUBANN ;
-IF &&MONTH='NOV' AND &&FY EQ '12' THEN GOTO SUBANN ;
-RUN
-GOTO CLEANUP
-RUN
-*==========================================================================
-*                         Submit Annual Reports
-*==========================================================================
-SUBANN
EX SUBMIT50
-RUN
-*==========================================================================
-*                        CLEAN UP JOB ENVIRONMENT
-*==========================================================================
-CLEANUP

DEFINE FILE ROLLUP
PR/A1 = 'A';
END
TABLE FILE ROLLUP
PRINT ROLLUP_CODE PR
BY ROLLUP_CODE NOPRINT
IF PR_STAMP EQ 'R'
IF ROLLUP EQ &&ROLL
ON TABLE SAVE AS ENDJOB
END
MODIFY FILE ROLLUP
FIXFORM ROLLUP_CODE/8 PR_STAMP/1
MATCH ROLLUP_CODE
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON ENDJOB
END
-GOTO AUTOSTART
-RUN

-TYPE SUBMIT PROCESS COMPLETED ..............
-EXIT

-NODATA
-TYPE THERE IS NO DATA TO PROCESS ...........
-EXIT

