-* JK added code to select only tnt_company eq 1 or 2 2/21/05
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK

-INCLUDE SETECHO
SET ASNAMES = ON

DEFINE FILE LR_50
BOOKINGS/D8 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
-*  LEVEL_DESC/A60 = &&LDESC;
  NBR_CARS/D12 = NUM_CARS;	
  NBR_DAYS/D12 =  IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                  ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;  
END

TABLEF FILE LR_50
PRINT
  BOOKINGS
  NBR_DAYS 	
  NBR_CARS
  PICK_CTY.CITY_NAME AS 'PICK_CTY_NAME'	
  RENTAL_AMT/D12.2CS	
  VENDOR_NAME 
  VENDOR_CODE
 WHERE INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS

ON TABLE HOLD AS TC_LHOLD1

END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACT DATA FROM ABOVE - HOLD TO FOCUS DATABASE TCTRNK       
-*========================================================================

DEFINE FILE TC_LHOLD1
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TC_LHOLD1
SUM BOOKINGS
  NBR_DAYS 	
  NBR_CARS
  RENTAL_AMT	
BY ROLLCD
BY PICK_CTY_NAME
BY VENDOR_NAME
WHERE VENDOR_CODE NE ' ' AND RENTAL_AMT NE 0
ON TABLE HOLD AS TCL1 
END
-RUN


DEFINE FILE TCL1
NMB/I5    = NMB + 1;
END
TABLE FILE TCL1
SUM BOOKINGS
  NBR_DAYS 	
  NBR_CARS
  RENTAL_AMT	
BY ROLLCD
BY NMB
BY PICK_CTY_NAME
BY VENDOR_NAME
ON TABLE HOLD AS TCL2 
END
-RUN

MODIFY FILE TCLRNK
FIXFORM FROM TCL2
DATA ON TCL2
END
-RUN

-NEXTONE
