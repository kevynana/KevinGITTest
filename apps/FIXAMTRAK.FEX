-INCLUDE SETECHO
-SET &&DRV = 'd:\';
-SET &DATAPATH='&&DATASRV.EVAL' || '\TNT\TTRACKER\DATA\';

-*'&&DRV.EVAL' | 'TNT\TTRACKER\DATA\'
SET ASNAMES = ON
TABLE FILE ROLLUP
PRINT COMP QTR_ENABLE
BY ROLLUP_CODE
WHERE ROLLUP_CODE GT 'TZ$*'

WHERE ROLLUP_CODE OMITS 'ABCD2-R'
WHERE LOAD_GRP OMITS 'X' OR 'Z' OR 'N' OR ' '
-*WHERE ROLLUP_CODE GE 'O$*'
ON TABLE SAVE AS ALLROLL
END
-RUN




-SET &TOTROLLS = &LINES;
-REPEAT END001 &TOTROLLS TIMES
 
-SET &UPDATED='N';
 
-READ ALLROLL NOCLOSE &ROLL.8. &COMP.6. &QTR.1.
 
 
-TYPE *** Updating ROLLUP: &ROLL;
 
-IF '&QTR.EVAL' EQ 'X' THEN GOTO QUARTED;
-SINGLEDB

-SET &&COMPT = 'T_' || '&COMP.EVAL' || '.FOC';
-SET &&COMPT1 = 'T_' ||&COMP;

USE

D:\TNT\TTRACKER\DATA\&&COMPT AS &&COMPT1 
END
-GOTO SKIP_Q;
 
-QUARTED
-SET &&COMPT1 = 'T1' ||&COMP;
-SET &&COMPT2 = 'T2' ||&COMP;
-SET &&COMPT3 = 'T3' ||&COMP;
-SET &&COMPT4 = 'T4' ||&COMP;
-SET &&COMPT5 = 'T5' ||&COMP;
-SET &&COMPT6 = 'T6' ||&COMP;
-SET &&COMPT7 = 'T7' ||&COMP;
-SET &&COMPT8 = 'T8' ||&COMP;
-SET &&COMPT9 = 'T9' ||&COMP;
-SET &&COMPT0 = 'T0' ||&COMP;
-SET &&COMPTY = 'TY' ||&COMP;
-SET &&COMPTZ = 'TZ' ||&COMP;


-SET &&COMP1T = 'T1' || '&COMP.EVAL' || '.FOC';

-SET &&COMP2T = 'T2' || '&COMP.EVAL' || '.FOC';

-SET &&COMP3T = 'T3' || '&COMP.EVAL' || '.FOC';

-SET &&COMP4T = 'T4' || '&COMP.EVAL' || '.FOC';

-SET &&COMP5T = 'T5' || '&COMP.EVAL' || '.FOC';

-SET &&COMP6T = 'T6' || '&COMP.EVAL' || '.FOC';

-SET &&COMP7T = 'T7' || '&COMP.EVAL' || '.FOC';

-SET &&COMP8T = 'T8' || '&COMP.EVAL' || '.FOC';

-SET &&COMP9T = 'T9' || '&COMP.EVAL' || '.FOC';

-SET &&COMP0T = 'T0' || '&COMP.EVAL' || '.FOC';

-SET &&COMPYT = 'TY' || '&COMP.EVAL' || '.FOC';

-SET &&COMPZT = 'TZ' || '&COMP.EVAL' || '.FOC';

USE

D:\TNT\TTRACKER\DATA\&&COMP1T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP2T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP3T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP4T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP5T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP6T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP7T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP8T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP9T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMP0T AS &&COMPT1

D:\TNT\TTRACKER\DATA\&&COMPYT AS &&COMPT1
D:\TNT\TTRACKER\DATA\&&COMPZT AS &&COMPT1
END
-SKIP_Q

DEFINE FILE &&COMPT1
GEO1/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO2/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO3/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO4/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO5/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO6/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO7/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO8/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO9/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO10/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO11/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO12/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$');
GEO13/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$');
GEO14/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$');
GEO15/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$');
GEO16/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$');
GEO17/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$');
CTRY_LEN/I2 = ARGLEN(68, CTRY_COD, CTRY_LEN);
GEO_LEN/I2 =  ARGLEN(68, TKT_MAIN.GEO_ZONE, GEO_LEN);
NEW_GEO/A68 = IF GEO_LEN LE 7 THEN 'USA-USA' ELSE IF GEO_LEN LE 11 THEN 'USA-USA-USA' ELSE
              IF GEO_LEN LE 14 THEN 'USA-USA-USA-USA' ELSE 'USA-USA-USA-USA-USA';
NEW_CTRY/A68 = IF CTRY_LEN LE 5 THEN 'US-US' ELSE
               IF CTRY_LEN LE 8 THEN 'US-US-US' ELSE
               IF CTRY_LEN LE 11 THEN 'US-US-US-US' ELSE 'US-US-US-US-US';
2VFLAG/A1 = IF ADIR_ALL CONTAINS '/2V' THEN 'Y' ELSE 'N';
END
TABLE FILE &&COMPT1
PRINT AIR_KEY   NEW_GEO AS 'GEO_ZONE' NEW_CTRY AS 'CTRY_COD'
BY AIR_KEY NOPRINT
WHERE GEO1 NE 'USA' OR GEO2 NE 'USA' OR GEO3 NE 'USA' OR GEO4 NE 'USA' OR GEO5 NE 'USA' OR GEO6 NE 'USA'
WHERE 2VFLAG EQ 'Y'
ON TABLE HOLD AS HLD001
END
-RUN

-IF &RECORDS EQ 0 THEN GOTO Done;


USE CLEAR *
-RUN

 
 
MODIFY FILE &&COMPT1
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

-IF '&QTR.EVAL' NE 'X' THEN GOTO NoMore;

MODIFY FILE &&COMPT2
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN


MODIFY FILE &&COMPT3
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPT4
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN
MODIFY FILE &&COMPT5
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPT6
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN 

MODIFY FILE &&COMPT7
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPT8
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPT9
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPT0
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPTY
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN

MODIFY FILE &&COMPTZ
FIXFORM FROM HLD001
LOG NOMATCH MSG OFF
MATCH AIR_KEY
ON MATCH UPDATE GEO_ZONE
ON MATCH UPDATE CTRY_COD
ON NOMATCH REJECT
DATA ON HLD001
END
-RUN
 
-Done

USE CLEAR *
-RUN

-NoMore

-END001
