-INCLUDE SETECHO
-* WRRIUPD.FEX - Used to update the Batch Report Instance file with the
-*               dates selected.
-*
-IF &&ER5_ADHOC NE 'Y' THEN GOTO :WRRIUPD1; 
-INCLUDE WRRIUPD_ER5
-RUN
-GOTO :WRRIUPD2

-:WRRIUPD1
MODIFY FILE BRPTINST
FREEFORM INST_KEY FM_DATE TO_DATE FXDATE TXDATE DISTRB_FLAG
FREEFORM CMFM_DATE CMTO_DATE PMFM_DATE PMTO_DATE CYFM_DATE
FREEFORM CYTO_DATE PYFM_DATE PYTO_DATE OUTPUT_FORMAT DATETYPE ORIENTATION
COMPUTE ID/I1 = 1;
MATCH INST_KEY
 ON NOMATCH REJECT
 ON MATCH CONTINUE
MATCH ID
 ON NOMATCH INCLUDE
 ON MATCH UPDATE FM_DATE TO_DATE FXDATE TXDATE DISTRB_FLAG
 ON MATCH UPDATE CMFM_DATE CMTO_DATE PMFM_DATE PMTO_DATE 
 ON MATCH UPDATE CYFM_DATE CYTO_DATE PYFM_DATE PYTO_DATE OUTPUT_FORMAT DATETYPE ORIENTATION
DATA
&&IKEY,
&&FM_PM, &&TO_PM, &&FX_PM, &&TX_PM, &&OUTTO,
&&CMFM, &&CMTO, &&PMFM, &&PMTO, &&CYFM, &&CYTO,
&&PYFM, &&PYTO,'&&OUTFMT.EVAL', '&&DATETYPE.EVAL','&&ORIENTATION.EVAL', $
END
-RUN

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET
TABLE FILE BRPTINST
PRINT RPT_STREAM GLOBAL_PARM RPT_TYPE RPT_NAME SET_NAME 
-*BY INST_KEY 
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE
END
-RUN
-READ SAVE &&STREAM.8. &&SETF.8. &&RPTTYP.3. &&RN.50.  &&RS.40.

-SET &&IDKEY = &&IKEY;
-SET &&FOOTR = '&&SETF.EVAL' || '/' | '&&IKEY.EVAL';


-TYPE &&SETF &&STREAM

-:WRRIUPD2

-*the following variables not passed from asp, but get from database.
-*-SET &&STREAM=&st_pm;
-*-SET &&SETF=&se_pm;
-*-SET &&RPTTYP=&rp_pm;
-*-SET &&RN=&rt_pm;
-*-SET &&RS=&sn_pm;
-*-SET &&IDKEY=&ix_pm;