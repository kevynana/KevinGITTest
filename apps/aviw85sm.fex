-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* This was created for Conagra's Adv Purchase reports that only
-* show the dpt_dt and airline from the first segment
-* JK 10/30/02
-* 3/17/03  DEB  CARRIED THROUGH PNR_LOCATOR
-* 11/19/03 jk   Commented out -include &&DTSTY
-* 5/19/04  DEB  ADDED FLAG DEFINE DUE TO BALANCING ISSUES WITH TRVL SUM
-* 5/04/05  DEB  ADDED CODE FOR GLOBAL CURRENCY
-**********************************************************************

-INCLUDE SETECHO

SET ASNAMES = ON
-RUN


-IF &&CURRENCY EQ 'USD' THEN GOTO SKIPTHIS;

-SET &&SUBHEAD = <NAMEC;
-SET &FPAID_CUR = 'FARE PAID, (' | &&CURRENCY || ')';
-SET &MKTF_CUR= 'MARKET,FARE, (' | &&CURRENCY || ')';
-SET &LSTSV_CUR ='LOST,SAVINGS, (' | &&CURRENCY || ')';
-SET &VASV_CUR ='VALUE,ADDED,SAVINGS, (' | &&CURRENCY || ')';
-SET &&S_SUBJ4='DISSAVE1/D16.2CS AS ' | '''&LSTSV_CUR.EVAL''' ;
-SET &&S_SUBJ6='PAID_FARE1/D16.2S AS ' | '''&FPAID_CUR.EVAL''';
-SET &&S_SUBJ7='NEWSEG_DISC1/D16.2CS AS ' | '''&MKTF_CUR.EVAL''';
-SET &&S_SUBJ10='VASAVE1/D16.2CS AS ' | '''&VASV_CUR.EVAL''';
-SET &&S_SUBJ11='COMPUTE VPCT/D8.1S= IF ((NET_TKT_CNT LT 1) AND' ;
-SET &&S_SUBJ12='(NET_TKT_CNT GT (-1))) THEN 0 ELSE';
-SET &&S_SUBJ13='(VASAVE1/NEW_SEG_DISC)*100; AS ''VALUE ADDED SAVINGS %''';






-SKIPTHIS;










TABLE FILE RPTHOLD2

SUM DISSAVINGS AS 'DTSAVE'
    FARE_PAID/D12.2CS AS 'TFARE'
    NEW_SEG_DISC AS 'TSDISC'
    REF_EXCH_CNT AS 'TRFEX'
    SEG_LOWEST AS 'TLOW'
    TKT_PURCH AS 'TTKT'
    VASAVINGS AS 'VASAV'
    NET_TKT_CNT AS 'NTTKT'
    DISSAVE1/D16.2CS AS 'GDTSAVE'
    PAID_FARE1/D16.2CS AS 'GTFARE'
    NEWSEG_DISC1/D16.2CS AS 'GTSDISC'
    VASAVE1/D16.2CS AS 'GVASAV'
    BY LEVEL_DESC  
    ON TABLE HOLD AS HOLDONE
END
-RUN

TABLE FILE RPTHOLD2
PRINT AIRLINE
  ADV_PURCH
  AIRLINE_FEE
  BR_CL_IDX
  COMM_SEG
  DISSAVE1/D16.2CS
  DISSAVINGS
  DOC_TYPE
  EX_FLAG
  FARE_BAS
  FARE_PAID
  INT_CODE
  NAMEC
  NET_FARE
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_DISC
  NEWSEG_DISC1/D16.2CS
  PAID_FARE1/D16.2CS
  PNR_LOCATOR
  SEG_DESIG
  REFUSE_CODE
  REF_EXCH_CNT
  RESV_BRANCH
  RF_FLAG
  SEG_DESIG
  SEG_LOWEST
  SEG_NBR
  TAX
  TKT_NUM
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  TOUR_CODE
  VASAVINGS
  VASAVE1/D16.2CS
  XDPT_DT
  XPSNGR_NM
  XTRAN_DT
BY LEVEL_DESC
BY AIRLINE_NAME
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIRLINE
  AIRLINE_FEE
  ADV_PURCH
  AIRLINE_FEE
  BR_CL_IDX
  COMM_SEG
  DISSAVE1
  DISSAVINGS
  DOC_TYPE
  EX_FLAG
  FARE_BAS
  FARE_PAID
  INT_CODE
  NAMEC
  NET_FARE
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_DISC
  NEWSEG_DISC1
  PAID_FARE1
  PNR_LOCATOR
  SEG_DESIG
  SEG_LOWEST
  REFUSE_CODE
  REF_EXCH_CNT
  RF_FLAG
  RESV_BRANCH
  SEG_DESIG
  SEG_LOWEST
  SEG_NBR
  TAX
  TKT_NUM
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  TOUR_CODE
  VASAVINGS
  VASAVE1
  XDPT_DT
  XPSNGR_NM
  XTRAN_DT
BY LEVEL_DESC
BY AIRLINE_NAME 
ON TABLE HOLD
RUN
FILE HOLDONE
SUM DTSAVE
    GDTSAVE
    GTFARE
    GTSDISC
    GVASAV
    NTTKT
    TFARE
    TLOW
    TRFEX
    TSDISC
    TTKT
    VASAV
 BY LEVEL_DESC
 AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
 END
-RUN

DEFINE FILE XTHREE
FLAG/A1 = IF SEG_NBR EQ '01' OR RF_FLAG EQ 'P' OR EX_FLAG EQ 'P'
          OR DOC_TYPE EQ '1' THEN 'Y' ELSE 'N';
END
-RUN

TABLE FILE XTHREE
PRINT XDPT_DT
      AIRLINE
BY LEVEL_DESC
BY TKT_NUM
-*IF SEG_NBR EQ '01'
IF FLAG EQ 'Y'
-* WHERE XDPT_DT NE ' '
WHERE AIRLINE NE ' '
ON TABLE HOLD AS ONEHLD FORMAT ALPHA
END
-RUN

TABLE FILE XTHREE
PRINT AIRLINE
  ADV_PURCH
  AIRLINE_FEE
  BR_CL_IDX
  COMM_SEG
  DISSAVINGS
  DISSAVE1
  FARE_BAS
  FARE_PAID
  INT_CODE
  NAMEC
  NET_FARE
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_DISC
  NEWSEG_DISC1
  PAID_FARE1
  PNR_LOCATOR
  SEG_DESIG
  SEG_LOWEST
  REFUSE_CODE
  REF_EXCH_CNT
  RESV_BRANCH
  SEG_DESIG
  SEG_NBR
  TAX
  TKT_NUM
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  TOUR_CODE
  VASAVINGS
  VASAVE1
  XDPT_DT
  XPSNGR_NM
  XTRAN_DT
  DTSAVE
  GDTSAVE
  GTFARE
  GTSDISC
  GVASAV
  NTTKT
  TFARE
  TLOW
  TRFEX
  TSDISC
  TTKT
  VASAV
BY LEVEL_DESC
ON TABLE HOLD AS TWOHLD
END
-RUN

MATCH FILE TWOHLD
PRINT 
  ADV_PURCH
  AIRLINE_FEE
  BR_CL_IDX
  COMM_SEG
  DISSAVINGS
  DISSAVE1
  FARE_BAS
  FARE_PAID
  INT_CODE
  NAMEC
  NET_FARE
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_DISC
  NEWSEG_DISC1
  PAID_FARE1
  PNR_LOCATOR
  SEG_DESIG
  REFUSE_CODE
  REF_EXCH_CNT
  RESV_BRANCH
  SEG_DESIG
  SEG_LOWEST
  SEG_NBR
  TAX
  TKT_NUM
  TKT_PURCH
  TKT_SORT
  TKT_TYPE
  TOUR_CODE
  VASAVINGS
  VASAVE1
  XPSNGR_NM
  XTRAN_DT
  DTSAVE
  GDTSAVE
  GTFARE
  GTSDISC
  GVASAV
  NTTKT
  TFARE
  TLOW
  TRFEX
  TSDISC
  TTKT
  VASAV
BY LEVEL_DESC
BY TKT_NUM
ON TABLE HOLD
RUN
FILE ONEHLD
SUM XDPT_DT
    AIRLINE
BY LEVEL_DESC
BY TKT_NUM
AFTER MATCH HOLD AS XFOUR OLD-AND-NEW
END
-RUN


DEFINE FILE XFOUR
  PCTFARE/D8.1S = IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0
                  ELSE ((FARE_PAID/TFARE)*100);
  PCTNETTKT/D8.1S = IF ((NTTKT LT 1) AND (NTTKT GT (-1))) THEN 0
                    ELSE ((NET_TKT_CNT/NTTKT)*100);
  PCTRFEX/D8.1S = IF ((TRFEX LT 1) AND (TRFEX GT (-1))) THEN 0
                  ELSE ((REF_EXCH_CNT/TRFEX)*100);
  PCTTKT/D8.1S = IF ((TTKT LT 1) AND (TTKT GT (-1))) THEN 0
                 ELSE ((TKT_PURCH/TTKT)*100);
  RADV_PURCH/I8CS = IF (TKT_TYPE EQ 'P-RF' OR 'P-EX') THEN 0 ELSE 
                    IF (FARE_PAID GE 0) THEN NEW_ADV_PURCH ELSE
                    IF (FARE_PAID LT 0) THEN NEW_ADV_PURCH * (-1) ELSE 0;
  ADV_PUR/I8CS = IF SEG_NBR EQ '01' THEN RADV_PURCH ELSE 0;
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END

TABLE FILE XFOUR
-INCLUDE HEADER
"&&SUBHEAD"
"</2"
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
    
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM
-* ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

-INCLUDE &&SMSTY

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-* -INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
 

