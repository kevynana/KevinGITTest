-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-*                     FOCEXEC: CVIW14DT
-* CREATED FOR DATA VAULT CAR DETAIL REPORTS
-* CREATED FROM CVIEW1DT
-* 5/10/10 - changed Level1 to be handled like all other Levels - Deb
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*7/11/16 -DLV -  S-20630  Carried through EMP_ID  added to final report

-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE

-**************************************************************************

-INCLUDE SETECHO

SET ASNAMES=ON
-RUN



TABLE FILE CARHLD
PRINT 
  AGENT_NUM	
  AIRPORT_CODE	
  AIRPORT_NAME
  AR_BRANCH
  AVG_DLY_RATE
  BOOKINGS
  BR_CL_IDX	
  CAR_CAT	
  CAR_DESC
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE 	
  CCR_CONFIRM 	
  DAILY_RATE 	
  DOD_TYPE	
  DROP_CITY	
  DROP_CTY_NAME	
  DROP_DATE 	
  DROP_OFF_DT
  DV_NUM
  EMP_ID  
  GROSS_BOOK
  INV_DATE
  INV_MONTH
  INV_MY	
  INVOICE_DATE	
  INVOICE_NUM 
  LEVEL1 	
  LEVEL2	
  LEVEL3 
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NBR_DAYS
  NEW_RENTL_AMT
  NUM_CARS 	
  NUM_DAYS	
  PASSNGR_NAME
  PICK_CTY_NAME	
  PICK_UP_DT	
  PICKUP_CITY	
  PICKUP_DATE	
  PNR_LOCATOR 	
  RENTAL_AMT/D12.2
  RENTAL_DAYS	
  RESV_BRANCH
  STATE_CODE
  STD_RATE 	
  TICKET_BRANCH	
  TOTAL_STD
  TKT_NUM	
  VENDOR_CODE	
  VENDOR_NAME 
BY LEVEL_DESC
-INCLUDE CARRATE
ON TABLE HOLD AS CARHOLD3
END
-RUN

 

-IF &RECORDS EQ 0 THEN GOTO NORECORDS;

-INCLUDE DATAVROLL


DEFINE FILE CARHOLD3 ADD
NOWTOD/A8 WITH AIRPORT_CODE = HHMMSS (NOWTOD);
XPSNGR_NM/A20=EDIT(PASSNGR_NAME,'99999999999999999999$$$$$$$$$$$$$');
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN
 
TABLE FILE CARHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
SUM BR_CL_IDX AS 'ACCT'
LEVEL1 &LV1
XPSNGR_NM AS 'TRAVELER'
EMP_ID &EMPID
INV_DATE AS 'INVOICED'
PICK_UP_DT AS 'PICK-UP'
DROP_OFF_DT AS 'DROP-OFF'
INVOICE_NUM AS 'INVOICE'
DV_NUM AS 'GUARANTEED TO'
VENDOR_NAME AS 'VENDOR'
PICK_CTY_NAME AS 'CITY'
CAR_TYPE AS 'CAR TYPE'
NBR_DAYS AS 'DAYS'
DAILY_RATE/D12.2CS AS 'RATE'
NEW_RENTL_AMT AS 'AMOUNT'
LEVEL2 &LV2
LEVEL3 &LV3
LEVEL4 &LV4
LEVEL5 &LV5
LEVEL6 &LV6
LEVEL7 &LV7
BY BR_CL_IDX NOPRINT
BY XPSNGR_NM NOPRINT
BY INVOICE_DATE NOPRINT 
BY PICK_UP_DT NOPRINT
BY DROP_OFF_DT NOPRINT
BY INVOICE_NUM NOPRINT
BY DV_NUM NOPRINT
BY VENDOR_NAME NOPRINT

ON BR_CL_IDX COMPUTE AVG/P8.2= IF ((NBR_DAYS LT 1) AND  
  (NBR_DAYS GT (-1))) THEN 0 ELSE (NEW_RENTL_AMT/NBR_DAYS); 

ON BR_CL_IDX SUMMARIZE NBR_DAYS NEW_RENTL_AMT AS 'TOTAL'


 



-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD
TYPE=DATA,
     BACKCOLOR=('WHITE' RGB(239 239 239)),
ENDSTYLE
-*
&&OUTLINE1 
&&OUTPUTDEST
&&OUTLINE2
END 
-RUN

-GOTO XXIT

-NORECORDS
-SET &&RPTSUF = 'MSG';
-INCLUDE FDEFRPTS
-RUN
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADAIR
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT

