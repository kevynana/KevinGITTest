-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AVIW17EX.FEX

-****************************************************************************
-* DATE       INITIAL        DESCRIPTION
-* 3/16/01    TANDT-SS       ADD DOD_TYPE TO SELECT INTERNET/NON-INTERNET
-* 6/7/01     TANDT-DB       CHANGED DEFINE DUE TO BALACING ISSUES
-*                           (EX1-EX1)
-* 10/8/01    TANDT-JK       ADDED DOD_TYPE
-* 11/20/01   TANDT-JK       ADDED 0440_RUF DEFINE
-* 4/29/02    TANDT-SC DB    CHANGED NET_TKT_CNT DEFINE TO CORRECTLY BACK OUT
-*                           PARTIAL REFUNDS AND EXCHANGES  
-* 5/29/02    TANDT-DB       ADDED CGBOOK DEFINE
-* 7/10/02    Tandt-JK       Changed ibook define to reflect new standards
-*5/23/14     DEB            ADDED EX5 TO CTY_PR DEFINE
-* ADDED TRANTYPE INCLUDE - JK 12/15/14 STORY ID S-06492

-****************************************************************************
-INCLUDE SETECHO
-TYPE EXTRACT1
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
COMM_SEG/D12.2S   = SEG_COM;
-* CP_CL_CAT/A8 = DECODE CL_CAT ('F' 'FIRST'     'C' 'COACH'   
-*                               'D' 'DISCOUNT'  'B' 'BUSINESS');
CP_CL_CAT/A15 = DECODE CL_CAT ('F' 'FIRST'     'P' 'PREMIUM ECONOMY'   
		               'D' 'DEFAULT'   'B' 'BUSINESS'
		               'E' 'ECONOMY'   'U'  'UPGRADE' 
                               ' ' 'DEFAULT'); 
                               
CTY_PR/A1 = IF ORG_DST EQ 'FP2FP2' THEN 'Y' ELSE
            IF ORG_DST EQ 'FP3FP3' THEN 'Y' ELSE
            IF ORG_DST EQ 'EX1EX1' THEN 'Y' ELSE
            IF ORG_DST EQ 'DT1DT1' THEN 'Y' ELSE 
            IF ORG_DST EQ 'EX5EX5' THEN 'Y' ELSE 'N';
DEMB_APT/A21=EDIT(EMB_APT.AIRPORT_NAME,'999999999999999999999$$$$');
DIR_CITY_CD/A50 = EMB_CTY.EMB_CITY || '-' || RTE_CTY.RTE_CITY;
DIR_CITY_NM/A50 = EMB_CTY.CITY_NAME | RTE_CTY.CITY_NAME; 
DIR_CP_CD/A50 = CITYPAIR.EMBARK || '-' || CITYPAIR.ROUTE;
DIR_CP_NM/A50 = EMB_APT.AIRPORT_NAME | RTE_APT.AIRPORT_NAME;
DRTE_APT/A21=EDIT(RTE_APT.AIRPORT_NAME,'999999999999999999999$$$$');
EMB_APT/A21=EDIT(NDO_APT.AIRPORT_NAME,'999999999999999999999$$$$');
FARE_PAID/D12.2S  = SEG_AMT;
LEVEL_DESC/A60 = &&LDESC;
ND_CITY_CD/A50 = NDO_CTY.NDO_CITY || '-' || NDD_CTY.NDD_CITY;
ND_CITY_NM/A50 = NDO_CTY.CITY_NAME | NDD_CTY.CITY_NAME;
ND_CP_CD/A50  = NDO_APT.ND_ORG || '-' || NDD_APT.ND_DST;
NET_COMM/D12.2S   = (SEG_AMT - SEG_COM);
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
NET_FARE/D12.2S  = IF (EX_FLAG EQ ' ') AND (RF_FLAG EQ ' ')
                         THEN SEG_AMT ELSE 0;
NEW_SEG_COUNT/D8CS = SEG_COUNT;
RTE_APT/A21=EDIT(NDD_APT.AIRPORT_NAME,'999999999999999999999$$$$');
TOTAL_FARE/D12.2S = SEG_AMT + SEG_TAX;
VASAVINGS/D11.2CS = SEG_DISCOUNT - TOTAL_FARE;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
XTRAN_DT/MDYY = TRN_DATE;
XDPT_DOW/W = DPT_DATE;

-* ****DEFINES ON PREVIOUS DEFINES****

DISSAVINGS/D11.2CS= IF EMBARK EQ 'DT1' THEN 0 ELSE
                         TOTAL_FARE - SEG_LOWEST;
DPT_DAY/A3 = DECODE XDPT_DOW (1 'MON' 2 'TUE' 3 'WED'
                              4 'THU' 5 'FRI' 6 'SAT' 7 'SUN');

ND_CP_NM/A50 = EMB_APT|'        '|RTE_APT;
ORGDST/A50 = &&ORGDST;
SAVINGS/D11.2CS   = SEG_STANDARD - TOTAL_FARE; 
-******** NEW DEFINES TO CORRECT CITY/AIRPORT NAME/CODE ISSUE JK ******

-******* PRODUCES DIRECTIONAL CITY CODES ***************
DIR_CTY_CDO/A25 = EMB_CTY.EMB_CITY;
DIR_CTY_CDD/A25 = RTE_CTY.RTE_CITY;

-******* PRODUCES DIRECTIONAL CITY NAMES ***************
DIR_CTY_NMO/A25 = EMB_CTY.CITY_NAME;
DIR_CTY_NMD/A25 = RTE_CTY.CITY_NAME;

-********* PRODUCES DIRECTIONAL AIRPORT CODES ********
DIR_APT_CDO/A25 = CITYPAIR.EMBARK;
DIR_APT_CDD/A25 = CITYPAIR.ROUTE;

-********* PRODUCES DIRECTIONAL AIRPORT NAMES ********
DIR_APT_NMO/A25 = EMB_APT.AIRPORT_NAME;
DIR_APT_NMD/A25 = RTE_APT.AIRPORT_NAME;

-********* PRODUCES NON-DIRECTIONAL CITY CODES ********
ND_CTY_CDO/A25 = NDO_CTY.NDO_CITY;
ND_CTY_CDD/A25 = NDD_CTY.NDD_CITY;

-********* PRODUCES NON-DIRECTIONAL CITY NAMES ********
ND_CTY_NMO/A25 = NDO_CTY.CITY_NAME;
ND_CTY_NMD/A25 = NDD_CTY.CITY_NAME;

-******** PRODUCES NON-DIRECTIONAL AIRPORT CODES ****
ND_APT_CDO/A25 = NDO_APT.ND_ORG;
ND_APT_CDD/A25 = NDD_APT.ND_DST;

-******** PRODUCES NON-DIRECTIONAL AIRPORT NAMES ****
ND_APT_NMO/A25 = EDIT(NDO_APT.AIRPORT_NAME, '999999999999999999999$$$$');
ND_APT_NMD/A25 = EDIT(NDD_APT.AIRPORT_NAME, '999999999999999999999$$$$');  

-INCLUDE TRANTYPE 

END
-RUN

TABLEF FILE &&EXTRACT
PRINT 
  AIR_KEY   
  AIRLINE   
  AIRLINE.AIRLINE AS 'AIR_LINE' 
  AIRLINE.AIRLINE_NAME  
  AR_BRANCH
  CITYPAIR.AIRLINE AS 'CP_AIRLINE'  
  CITYPAIR.CLASS AS 'CP_CLASS'  
  CITYPAIR.EMBARK AS 'CP_EMB'           
  CITYPAIR.INTL_DOM AS 'INTL_DOM'   
  CITYPAIR.NET_COMM AS 'NET_COMM'   
  CITYPAIR.ROUTE AS 'CP_RTE'    
  CITYPAIR.SEG_MILES/D9C AS 'MILES' 
  CLASS 
  CLS_CAT.CAT_DESC AS 'CAT_DESC'    
  COMM_SEG  
  CP_CL_CAT
  CTY_PR
  DEMB_APT  
  DISSAVINGS 
  DPT_DAY   
  DOC_TYPE
  DOD_TYPE
  DRTE_APT  
  EMB_APT
  FARE_PAID  AS 'CP_FARE_PD'
  FARE_PAID 
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC
  ND_CP_CD
  ND_CP_NM
  NET_FARE  
  NET_TKT_CNT
  NEW_SEG_COUNT 
  ORGDST    
  PASSNGR_NAME
  REFUSE_KEY    
  RTE_APT   
  SAVINGS   
  SEG_COUNT 
  SEG_NBR   
  TKT_NUM   
  TOTAL_FARE    
  TRN_DATE      
  VASAVINGS     
  XPSNGR_NM 
  XTRAN_DT      
-******* NEW FIELDS *********
  DIR_CTY_CDO
  DIR_CTY_CDD
  DIR_CTY_NMO
  DIR_CTY_NMD
  DIR_APT_CDO
  DIR_APT_CDD
  DIR_APT_NMO
  DIR_APT_NMD
  ND_CTY_CDO
  ND_CTY_CDD
  ND_CTY_NMO
  ND_CTY_NMD
  ND_APT_CDO
  ND_APT_CDD
  ND_APT_NMO
  ND_APT_NMD            
-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0
   
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD

END
-RUN


