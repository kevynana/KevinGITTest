-* 02/24/2017 - DLV - S-22486 CHANGED ettek Review to Post-trip Reporting
-* 09/15/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = logic
-*
-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO

SET ASNAMES = ON
-RUN


TABLE FILE CNTRYHLD
PRINT AIRLINE
  AIR_KEY
  FARE_PAID
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT
  NEW_SEG_MILES
  NEW_STAY	
  PASSNGR_NAME	
  DST_APC
  SEG_NBR
  TKT_DATE
  TKT_NUM
  TKT_SORT
  TKT_TYPE	
  TRIPS
  TRIP_LENGTH
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT
BY DST_APC AS 'AIRPORT_CODE'
ON TABLE HOLD AS CNTRY1 FORMAT FOCUS INDEX DST_APC
END
-RUN


JOIN AIRPORT_CODE IN CNTRY1 TO AIRPORT_CODE IN AIRPORT
END

TABLE FILE CNTRY1
PRINT AIRLINE
  AIR_KEY
  AIRPORT_CODE AS 'DEST'
  FARE_PAID
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT
  NEW_SEG_MILES
  NEW_STAY	
  PASSNGR_NAME	
  DST_APC
  SEG_NBR
  TKT_DATE
  TKT_NUM
  TKT_SORT
  TKT_TYPE	
  TRIPS
  TRIP_LENGTH
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT
BY COUNTRY_CODE
ON TABLE HOLD AS CNTRY2 FORMAT FOCUS INDEX COUNTRY_CODE
END
-RUN

JOIN COUNTRY_CODE IN CNTRY2 TO COUNTRY_CODE IN COUNTRY
END

TABLE FILE CNTRY2
PRINT AIRLINE
      AIR_KEY
  DEST
  FARE_PAID
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT
  NEW_SEG_MILES
  NEW_STAY	
  PASSNGR_NAME	
  SEG_NBR
  TKT_DATE
  TKT_NUM
  TKT_SORT
  TKT_TYPE	
  TRIPS
  TRIP_LENGTH
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT
BY COUNTRY_NAME
ON TABLE HOLD AS CNTRY3
END
-RUN
DEFINE FILE CNTRY3
FLAG/A1 = 'A';
END
-RUN
TABLE FILE CNTRY3
SUM NEW_STAY AS 'TSTAY'
BY FLAG
ON TABLE HOLD AS CNTT
END
-RUN

DEFINE FILE CNTRY3
FLAG/A1 = 'A';
END
-RUN
TABLE FILE CNTRY3
SUM FARE_PAID 
    MRK_TKT_CNT
    NEW_STAY
    TRIPS
BY FLAG
BY COUNTRY_NAME
ON TABLE HOLD AS CNT1
END
-RUN

MATCH FILE CNT1
PRINT FARE_PAID
      MRK_TKT_CNT
      NEW_STAY
      COUNTRY_NAME
      TRIPS
BY FLAG
ON TABLE HOLD
RUN
FILE CNTT
SUM TSTAY
BY FLAG
AFTER MATCH HOLD AS CNT2 OLD-AND-NEW
END
-RUN

TABLE FILE CNT2
SUM FARE_PAID
    MRK_TKT_CNT
    NEW_STAY
    TSTAY
    TRIPS
BY COUNTRY_NAME
ON TABLE HOLD AS CNT3
END
-RUN
 
DEFINE FILE CNT3
  NOWTOD/A8 WITH COUNTRY_NAME = HHMMSS (NOWTOD);
END
-RUN

TABLE FILE CNT3
-INCLUDE HEADER
-* "&&SUBHEAD"
"</2"
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
   
 -IF &&SETF NE 'ABACARBN' OR 'ABTCARBN' THEN GOTO NotThis;
WHERE MRK_TKT_CNT GE 1

-NotThis
  
-IF &&SETF EQ 'ABACARBN' THEN GOTO CARBON1 ELSE 
-IF &&SETF EQ 'ABTCARBN' THEN GOTO CARBON2 ELSE GOTO SkipCarbn;
-*******
-CARBON1
-*******
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
"EXCLUDES AMTRAK"
-*
-GOTO SkipCarbn;
-*
-*******
-CARBON2
-*******
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
"INCLUDES ONLY AMTRAK"
-*
-*********
-SkipCarbn   
-*********
-INCLUDE FOOTERSM
-*
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&SMSTY

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&SETF EQ 'ABACARBN' THEN GOTO SKIP_DRILL;

-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-*-*-EXIT




