-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT

-INCLUDE SETECHO
SET ASNAMES = ON

-TYPE '&&ROLL.EVAL'

-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED
-*========================================================================
-SET &&EXTRACT = 'HR_50';

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

DEFINE FILE &&EXTRACT
NBR_DAYS/P12 =  NUM_DAYS;
NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                 ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
                 
NNROOMS1/P12C = IF TKT_NUM NE '0000000000' THEN NNROOMS ELSE 0; 
NNROOMS2/P12C = IF TKT_NUM EQ '0000000000' THEN NNROOMS ELSE 0;  
-* HNOHTL_KEY/A40 = IF TKT_NUM EQ '0000000000' THEN 'HOTEL ONLY' ELSE 'BKD AFTER TKTING/UNMATCHING DATES';
NOHTL_KEY/A40 = IF TKT_NUM EQ '0000000000' THEN 'HOTEL ONLY' ELSE 'BKD AFTER TKTING/UNMATCHING DATES';
ROLLCD/A8 = '&&ROLL';
END

TABLE FILE &&EXTRACT
PRINT NNROOMS1 NNROOMS2
BY ROLLCD
BY TKT_NUM
BY NOHTL_KEY
-INCLUDE &HTLDATES
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCANH1
END
-RUN


-IF &LINES EQ 0 THEN GOTO NEXTONE;

-*========================================================================
-*   PROCESS EXTRACTED DATA FROM ABOVE
-*========================================================================
TABLE FILE TCANH1
SUM NNROOMS1 NNROOMS2 
BY ROLLCD
BY TKT_NUM
BY NOHTL_KEY
ON TABLE HOLD AS TCNH3
END
-RUN

MODIFY FILE TC_NHD
LOG NOMATCH MSG OFF
FIXFORM FROM TCNH3
MATCH ROLLCD TKT_NUM 
ON NOMATCH INCLUDE
ON MATCH UPDATE NNROOMS1
DATA ON TCNH3
END
-RUN




-NEXTONE
