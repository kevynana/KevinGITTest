-INCLUDE SETECHO
-DEFAULT &QUEDONE='N';
-RUN

TABLE FILE RPT_QUE
PRINT INTIME USER_NAME SET_KEY
BY INTIME NOPRINT 
BY ROLL_SEQ NOPRINT
BY SET_SEQ NOPRINT
BY SET_KEY NOPRINT
BY INST_KEY
WHERE RPT_SEQ EQ 999
WHERE EX_FLAG NE 'M'
ON TABLE SAVE AS SETHOLD
END
-RUN

-IF &LINES GT 0 GOTO CONT_QUE;
-SET &QUEDONE='Y';
-GOTO QUE_DONE;

-CONT_QUE
-READ SETHOLD &INSTKEY.7 &ITIME.18 &UN.20 &&SETKEY.7.
-RUN

TABLE FILE RPT_QUE
PRINT *
WHERE INST_KEY EQ &INSTKEY
WHERE INTIME EQ '&ITIME'
WHERE USER_NAME EQ '&UN'
WHERE RPT_SEQ EQ 999
WHERE EX_FLAG NE 'M'
ON TABLE HOLD AS SRPTQUE1 
END
-RUN

MODIFY FILE RPT_QUE
FIXFORM FROM SRPTQUE1
MATCH INST_KEY INTIME
  ON MATCH COMPUTE EX_FLAG='M';
  ON MATCH UPDATE EX_FLAG
  ON NOMATCH REJECT
DATA ON SRPTQUE1
END
-RUN
CREATE FILE BRPT_QUE
-RUN
MODIFY FILE BRPT_QUE
FIXFORM FROM SRPTQUE1
MATCH INST_KEY INTIME
  ON MATCH REJECT
  ON NOMATCH INCLUDE
DATA ON SRPTQUE1
END
-RUN

-QUE_DONE