-*1/13/15     S-06926 Changed placement of footer remarks- DEB
 
-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
 
-INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-*2/05/01      TANDT-SS             ADD BASE_FARE, DEPT_MONTH, SEG_DESIG
-*                                  AND TOUR_CODE.
-*5/10/01      TANDT-SS             ADD EMB_APT_CD AND RTE_APT_CD.
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*6/10/13      Joy                  Added NORECORDS logic
-* 4/8/14      DEB                    ADDED LONHI TO ABCDNH ROUTINE
-*4/16/14      DEB                 ADDED NOHTL_RSN DEFINE
-*8/6/14       JOY                 ADDED LOGIC FOR PHYNH REPORT
-*11/4/14    JOY                UPDATED NORECORDS LOGIC FOR ABCDNH DUE TO ERRORS
-*1/8/15     DEB                S-06898 corrected issue in Excel format report failing
-*                              added cout to -SET &&DRILLABLE
-*1/12/15   DEB                 S-06926 Updated placement of footers
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*5/21/2015 DEB - S-09179   - Corrected POTENTIAL AIR TKT HTL NGTS FOOTER =
-*  10/30/2015  REJ  S-12492 Added special code for AVIW56 because the parameters in the subfoot
-*                           were not always showing correctly.  This stream is written a little
-*                           different where the Hotel extract is really happening in the Summary
-*                           and Detail report focexecs.
-*12/09/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*9/14/16-JEM-S-24753-Updated PHYNH to no allow drilldown as there is no code for it in detail
-*10/4/16-JEM-S-25410-Added BBSDQNH to goto so report will run
-*11/21/2016 RSB - S-23625 Create new standard hotel attachment report - Summary by Ticket
-*                          Added logic to bypass hotel data.
-*                          Created new report section: -ABHTLTKTS
-*
-**********************************************************************
 
SET ASNAMES = ON
-RUN
-*
-IF '&&SETF.EVAL' EQ 'ABHTLCTY' THEN GOTO HTL_CITY;

-IF '&&SETF.EVAL' EQ 'ABHTLRSB' THEN GOTO SKIP_HOTELS;
-*
-INCLUDE NOHTLSM
-RUN
-*

-HTL_CITY

TABLE FILE AIRHLD
SUM STAY    
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
BY TRN_DATE
WHERE STAY NE 0
WHERE EMBARK OMITS 'DT1'
ON TABLE HOLD AS AIRSTAY
END
-RUN
-*
TABLE FILE AIRSTAY
PRINT STAY AS 'TSTAY' 
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
BY TRN_DATE
WHERE STAY NE 0
ON TABLE HOLD AS AIRSTAY1
END
-RUN
-*
-* Get data for summary report
MATCH FILE AIRHLD
PRINT *
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
BY TRN_DATE
ON TABLE HOLD
RUN
FILE AIRSTAY1
PRINT TSTAY
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
BY TRN_DATE
AFTER MATCH HOLD AS AIRHLD2 OLD-AND-NEW
END
-RUN

TABLE FILE AIRHLD2
PRINT EMBARK SEG_HFLAG CITY_CODE STAY STOP_CON   XFST_DPT
    XDPT_DT  XARR_DT   
  

  XFST_DPT
BY LEVEL_DESC
BY XPSNGR_NM
BY PNR_LOCATOR
BY TKT_NUM
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
BY RTE_CTY_NM
ON TABLE HOLD AS HOLD3
END
-RUN


TABLE FILE HOLD3
COUNT STAY AS 'POT_STAY'
BY RTE_CTY_NM  
WHERE STOP_CON NE 'X'
ON TABLE HOLD AS P
END
-RUN 
-QUIT




-GOTO SKIP_HOTELS;

-***********
-SKIP_HOTELS
-***********
-IF &&FROMAVRP NE 'Y' GOTO :AVSFS1;
-INCLUDE AVRP_SUBFOOT
-:AVSFS1
 
-IF &&SETF NE 'ABCDNH' GOTO NONORECCHK;
 
-IF '&&NOHSMREC.EVAL' EQ 'Y' THEN GOTO NORECORDS;
 
-NONORECCHK;
-* -IF &RECORDS EQ 0 GOTO XXIT;
 
-INCLUDE SETECHO
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HDRNOH' ELSE 'HDREXACH';
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-SET &&DRILLABLE= IF '&&OUTFMT.EVAL' NE 'EXCEL' THEN 'Y' ELSE 'N';
-RUN
 
 
-IF '&&SETF.EVAL' EQ 'ABHTLRSB' THEN GOTO ABHTLTKTS; 
-IF '&&SETF.EVAL' EQ 'ABCDNH' OR 'BAIRNHD' OR 'MCNH' OR 'ORSGNH' OR 'WRNH' OR 'TTNH' OR 'LONHI' OR 'SPGNH' OR 'BBSDQNH' THEN GOTO ABCDNH;
-IF '&&SETF.EVAL' EQ 'PHYNH' THEN GOTO PHYNH ELSE GOTO ABNHD;
 
 
-ABCDNH
 
 
 
DEFINE FILE TTLHLD1
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
  NOHTL_RSN/A10 = IF NOHR_KEY EQ ' ' THEN 'NONE GIVEN' ELSE NOHR_KEY;
END
TABLE FILE TTLHLD1
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-* &&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
-IF '&&SETF.EVAL' NE 'LONHI' THEN GOTO NoWhere;
WHERE NOHOTEL NE 0
 
 
-NoWhere
 
 
FOOTING BOTTOM
 
-INCLUDE FOOTERSM
" "
" "
"AIR TKT HTL NGTS NOT BKD = AIR TKT STAY - AIR TKT HTL NGTS BKD"
"AIR TKT HTL NGTS + NON-AIR TKT HTL NGTS = TTL HTL NGTS ON TRAVEL SUMMARY"
"POTENTIAL AIR TKT HTL NGTS = AIR TKT HTL NGTS BKD + AIR TKT HTL NGTS NOT BKD"
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYS
 
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY
 
-SKIP_DRILL
 
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;
 
EX REPORT_3
 
-SKIP_R3
-GOTO XXIT;
 
-ABNHD
DEFINE FILE TTLHLD3
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END
TABLE FILE TTLHLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-* &&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
 
FOOTING BOTTOM
 
-INCLUDE FOOTERSM
" "
" "
"AIR TKT HTL NGTS NOT BKD = AIR TKT STAY - AIR TKT HTL NGTS BKD"
"AIR TKT HTL NGTS + NON-AIR TKT HTL NGTS = TTL HTL NGTS ON TRAVEL SUMMARY"
"POTENTIAL AIR TKT HTL NGTS = AIR TKT HTL NGTS BKD + AIR TKT HTL NGTS NOT BKD"
 
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYS
 
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY
 
-SKIP_DRILL
 
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;
 
EX REPORT_3
 
-SKIP_R3
-GOTO XXIT;
 
-PHYNH;
DEFINE FILE TTLHLD3 ADD
  NOWTOD/A8 WITH PAX_NAME = HHMMSS (NOWTOD);
END
TABLE FILE TTLHLD3
-INCLUDE &&PAHDR
-* "&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-* &&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
 
FOOTING BOTTOM
 
-INCLUDE FOOTERSM
"/<3"
" "
" "
"AIR TKT HTL NGTS NOT BKD = AIR TKT STAY - AIR TKT HTL NGTS BKD"
"AIR TKT HTL NGTS + NON-AIR TKT HTL NGTS = TTL HTL NGTS ON TRAVEL SUMMARY"
"POTENTIAL AIR TKT HTL NGTS = AIR TKT STAY - AIR TKT HTL NGTS BKD"
 
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYS
 
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-* -INCLUDE &&DSTY
 
-SKIP_DRILL
 
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-*-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;
 
-* EX REPORT_3
 
-* -SKIP_R3
-GOTO XXIT;

-*
-*********
-ABHTLTKTS
-*********
-SET &&PAHDR  = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-*
-* Uncomment to change report title
-* -SET &&RPT_TTL1 = 'Ticket Summary with Hotel Attachment';
-*  
DEFINE FILE AIRHLDH1
  NOWTOD/A8 WITH PASSNGR_NAME = HHMMSS (NOWTOD);
END
-*
TABLE FILE AIRHLDH1
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-* &&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
-*
FOOTING BOTTOM
-* 
-INCLUDE FOOTERSM
" "
" "
"Hotel Attachment determined by looking at dates of airlines tickets and comparing it with any hotel booked during that date range."
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
-* 
ON TABLE SET STYLE *
-* 
-INCLUDE &&PASTYS
-* 
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY
-*
-***********
-SKIP_DRILL
-*********** 
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-* 
-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R4;
-* 
EX REPORT_3
-*
-********
-SKIP_R4
-********
-GOTO XXIT; 
-*

-NORECORDS
-SET &&RPTSUF = 'MSG';
-RUN
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
 
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HDRNOH
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERNR
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&SMSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
 
 
 
 
-XXIT;
