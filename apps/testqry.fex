SET ASNAMES=ON

JOIN SET_KEY IN RPT_INST TO SET_KEY IN RPT_SET
END

TABLE FILE RPT_INST
PRINT RPT_NAME
BY INST_KEY
BY USER_NAME
BY SET_NAME
WHERE ROLLUP_CODE EQ 'CH2M-R'
WHERE USER_NAME NE ' ' OR 'master' OR 'steve' OR 'joy' OR 'deb' 
                OR 'wtorres' OR 'tarnold' OR 'gracec' OR 'margiec'
WHERE SET_NAME OMITS 'Special'
ON TABLE HOLD AS JOY
END

JOIN INST_KEY IN JOY TO INST_KEY IN RPT_FLDS
END

TABLE FILE JOY
COUNT RPT_NAME
BY INST_KEY 
BY USER_NAME
BY SET_NAME
BY HIEORG1.ID AS 'ID'
BY HIEORG1.SEL_LEVEL AS 'SEL_LEVEL'
ON TABLE HOLD AS JOY1
END

TABLE FILE JOY
COUNT RPT_NAME
BY INST_KEY
BY USER_NAME
BY SET_NAME
BY HIEORG2.SEQ_NO AS 'SEQ_NO'
BY HIEORG2.MEMBER AS 'MEMBER'
ON TABLE HOLD AS JOY2
END

MATCH FILE JOY1
PRINT RPT_NAME USER_NAME SET_NAME ID SEL_LEVEL
BY INST_KEY
ON TABLE HOLD
RUN
FILE JOY2
SUM RPT_NAME USER_NAME SET_NAME SEQ_NO MEMBER
BY INST_KEY
AFTER MATCH HOLD AS JOY3 OLD-AND-NEW
END


TABLE FILE JOY3
COUNT RPT_NAME
BY USER_NAME
BY SET_NAME
BY ID
BY SEL_LEVEL
BY SEQ_NO
BY MEMBER
END





