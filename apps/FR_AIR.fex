 
-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
 
-* 1/23/03     STEVE AND DEB   CHANGED TO INCLUDE ONLY POSITIVE MCO AMOUNTS -
-* 10/27/04    DEB             ADDED CODE FOR GLOBAL CURRENCY
-* 1/15/07     DEB             ADDED SORT BY VAL_AIRLINE
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*  01/06/2016  REJ  S-13202 ER5 changes so the selection criteria would show on the subfoot page.
-*5/04/2017-JEM-S-33318-updated logic for no records report

-*******************************************************************
 
-INCLUDE SETECHO
SET ASNAMES=ON
SET ALL=OFF
 
EX SETDBLS SETFILE=&&SETF
-RUN
-INCLUDE OTHPARMS
 
-INCLUDE SETPARMTIME
-RUN
 
-TYPE &&OUTPUTDEST
-IF &&OUTLINE2 EQ 'OFFLINE' THEN GOTO XOFFLINE ELSE GOTO XONLINE;
 
-XONLINE
-TYPE Before ONLINE
ONLINE
-TYPE After ONLINE
-RUN
-GOTO CONT
 
-XOFFLINE
-SET &&OUTLINE2 = '';
-TYPE Before OFFLINE
OFFLINE
-TYPE After OFFLINE
-RUN
-GOTO CONT
 
-CONT
-SET &&RPT_HOLD = 'RPTHOLD';
 
FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN
 
 
 
-*****************************************************************
-*DATE           NAME                 DESCRIPTION OF CHANGE
-*9/13/00      IBISTL-KR              Drill Down functionality
-*****************************************************************
-INCLUDE SELCATQT
-RUN
 
-*EX CATQTR
EX &&CATQTRPR
-RUN
 
FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN
 
EX AIRUSE
-RUN
 
EX &&EXPARM
-RUN
-IF &RECORDS EQ 0 GOTO NORECORDS;
 
-* REJ ADDED TO TRAP ERRORS
-SET &&FEXNOW=&&EXPARM;
-INCLUDE ERRORCHK
-IF &&RET GT 1 GOTO XXIT;
-* REJ ADDED TO TRAP ERRORS
 
-IF &RECORDS GT 0 THEN GOTO DOIT;
 
-NORECORDS
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF2;
-INCLUDE OTHPARMS
-INCLUDE AVRP_SUBFOOT
-:AVSF2

-INCLUDE NORECRPT
-RUN
-GOTO XXIT
 
-DOIT
 
-IF &&SETF EQ 'ABFR' AND &&CURRENCY NE 'USD' THEN GOTO FR
-ELSE GOTO NEXT;
 
-FR;
 
-SET &&SUBHEAD = <NAMEC;
-SET &ORIG_CUR = 'ORIGINAL FARE, (' | &&CURRENCY || ')';
-SET &EXCH_CUR = 'EXCHANGE FARE, (' | &&CURRENCY || ')';
-SET &MCO_CUR  = 'MCO FARE, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2 = 'GTFARE/D16.2CS AS ' | '''&ORIG_CUR.EVAL''';
-SET &&S_SUBJ4 = 'GTFARE_PAID/D16.2CS AS ' | '''&EXCH_CUR.EVAL''';
-SET &&S_SUBJ6 = 'GTMFARE/D16.2CS AS ' | '''&MCO_CUR.EVAL''';
 
-NEXT;
 
TABLE FILE EXAIRHLD
PRINT FARE_PAID PAID_FARE1/D16.2CS TKT_NUM XPSNGR_NM NAMEC VAL_AIRLINE
BY DOC_NUMBER AS 'TKTN'
WHERE REFUSE_CODE EQ 'FR'
ON TABLE HOLD AS FRHLD1
END
-RUN
 
TABLE FILE EXAIRHLD
PRINT FARE_PAID AS 'FARE' PAID_FARE1/D16.2CS AS 'GFARE' TKT_NUM AS 'TICKET'
NAMEC
BY TKT_NUM AS 'TKTN'
BY VAL_AIRLINE
IF FARE_PAID LT 0
ON TABLE HOLD AS FRHLD2
END
-RUN
 
 
 
MATCH FILE FRHLD1
PRINT FARE_PAID PAID_FARE1 TKT_NUM XPSNGR_NM NAMEC
BY TKTN
BY VAL_AIRLINE
ON TABLE HOLD
RUN
FILE FRHLD2
PRINT FARE GFARE TICKET
BY TKTN
BY VAL_AIRLINE
AFTER MATCH HOLD AS FRMATCH1 OLD-AND-NEW
END
-RUN
 
TABLE FILE EXAIRHLD
PRINT FARE_PAID AS 'MFARE' PAID_FARE1/D16.2CS AS 'GMFARE' TKT_NUM AS 'TKTM'
BY DOC_NUMBER AS 'TKTN'
BY VAL_AIRLINE
WHERE DOC_TYPE EQ '1'
WHERE FARE_PAID GE 0
ON TABLE HOLD AS FRMCO
END
-RUN
 
 
MATCH FILE FRMATCH1
PRINT FARE_PAID FARE PAID_FARE1 GFARE TKT_NUM TICKET XPSNGR_NM NAMEC
BY TKTN
BY VAL_AIRLINE
ON TABLE HOLD
RUN
FILE FRMCO
PRINT MFARE TKTM GMFARE
BY TKTN
BY VAL_AIRLINE
AFTER MATCH HOLD AS TTLFR OLD-AND-NEW
END
-RUN
 
TABLE FILE TTLFR
PRINT FARE GFARE MFARE GMFARE FARE_PAID PAID_FARE1 TKTM XPSNGR_NM NAMEC VAL_AIRLINE
BY TKTN
ON TABLE HOLD AS JOYH1
END
-RUN
 
TABLE FILE EXAIRHLD
PRINT TKT_NUM AS 'TTKT'
BY DOC_NUMBER AS 'TKTN'
BY VAL_AIRLINE
WHERE DOC_TYPE NE '1'
ON TABLE HOLD AS JOYH2
END
-RUN
 
MATCH FILE JOYH1
PRINT FARE GFARE MFARE GMFARE FARE_PAID PAID_FARE1 TKTM XPSNGR_NM NAMEC
BY TKTN
BY VAL_AIRLINE
ON TABLE HOLD
RUN
FILE JOYH2
PRINT TTKT
BY TKTN
BY VAL_AIRLINE
AFTER MATCH HOLD AS JOYH3 OLD-AND-NEW
END
-RUN
 
 
TABLE FILE JOYH3
SUM FARE AS 'TFARE' MFARE/D16.2CS AS 'TMFARE' FARE_PAID AS 'TFARE_PAID'
    NAMEC GFARE/D16.2CS AS 'GTFARE' GMFARE/D16.2CS AS 'GTMFARE'
    PAID_FARE1/D16.2CS AS 'GTFARE_PAID' VAL_AIRLINE
BY TKTN
ON TABLE HOLD AS FHOLD
END
-RUN
 
 
 
MATCH FILE JOYH3
PRINT TKTM TTKT XPSNGR_NM
BY TKTN
BY VAL_AIRLINE
ON TABLE HOLD
RUN
FILE FHOLD
PRINT TFARE GTFARE TMFARE GTMFARE TFARE_PAID GTFARE_PAID NAMEC
BY TKTN
BY VAL_AIRLINE
AFTER MATCH HOLD AS LASTMATCH OLD-AND-NEW
END
-RUN
 
DEFINE FILE LASTMATCH
PAX_NAME/A30 = IF TKTN NE LAST TKTN THEN XPSNGR_NM ELSE ' ';
END
TABLE FILE LASTMATCH
PRINT TKTN TFARE GTFARE TTKT TFARE_PAID GTFARE_PAID TKTM TMFARE GTMFARE NAMEC VAL_AIRLINE
BY PAX_NAME
ON TABLE HOLD AS FINALHOLD
END
-RUN
 
-* REJ ADDED TO TRAP ERRORS
-SET &&FEXNOW=&&EXPARM;
-INCLUDE ERRORCHK
-IF &&RET GT 1 GOTO XXIT;
-* REJ ADDED TO TRAP ERRORS
 
-IF &RECORDS GT 0 THEN GOTO DOIT1;
 
-NORECORDS
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF2;
-INCLUDE OTHPARMS
-INCLUDE AVRP_SUBFOOT
-:AVSF2

-INCLUDE NORECRPT
-RUN
-GOTO XXIT
 
-DOIT1
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF2;
-INCLUDE AVRP_SUBFOOT
-:AVSF2
 
-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN
 
 
DEFINE FILE FINALHOLD
NOWTOD/A8 WITH TTKT = HHMMSS (NOWTOD);
END
 
TABLE FILE FINALHOLD
-INCLUDE HEADER
"&&SUBHEAD </1"
   &&S_SUBJ1
   &&S_SUBJ2
   &&S_SUBJ3
   &&S_SUBJ4
   &&S_SUBJ5
   &&S_SUBJ6
   &&S_SUBJ7
   &&S_SUBJ8
   &&S_SUBJ9
   &&S_SUBJ10
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
WHERE PAX_NAME NE ' '
WHERE TTKT NE ' '
WHERE TKTM NE ' '
WHERE TKTN NE ' '
-INCLUDE FOOTERSM
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
 
-INCLUDE &&SMSTY
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-* REJ ADDED TO TRAP ERRORS
-SET &&FEXNOW='FR_AIR';
-INCLUDE ERRORCHK
-IF &&RET GT 1 GOTO XXIT;
-* REJ ADDED TO TRAP ERRORS
 
-XXIT
