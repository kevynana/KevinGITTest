-***************************************************************
-* Modification History
-*==============================================================
-* Date       Author     Modification
-*--------------------------------------------------------------
-* 01/20/2012 GSE        Removed parens from around OLIMIT to
-*                       prevent error in 7.7.03
-*  08/23/2016  REJ  S-17914 Changes for ER5.
-*  12/29/2016  REJ  S-28553 Move ER5 My Reports to production.

-***************************************************************
 
 
-INCLUDE SETECHO
 
CREATE FILE TCTRNK
-RUN
 
-INCLUDE TCGETROLL
-RUN
 
-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT;
EX TCHTLDB
-RUN
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop2;
 
EX TCH103EX
-RUN
-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE AVRP_SUBFOOT
-:AVSF0
 
-INCLUDE SetParmtime
-RUN
 
-**************************************************************
-* GET THE FINAL REPORT
-**************************************************************
-SET &&CTY_LMT = &&RANK_LIMIT;
-SET &&HTL_LMT = &&RANK_LIMIT2;
-SET &&RANK_METH = IF &&RANK_METH EQ 'ROOM_AMT' THEN 'ROOM_AMT'
- ELSE IF &&RANK_METH EQ 'NMBR_DAYS' THEN 'NMBR_DAYS'
- ELSE 'NMBR_DAYS';
 
-SET &&RANK_METH = 'ROOM_AMT';
 
-SET &&RANKLIM = 25;
-SET &&RANK_LIMIT = 25;
-SET &&RANK_LIMIT2 = 25;
 
 
JOIN CHAIN_GROUP IN TCTRNK TO CHAIN_GROUP IN HTL_CGRP
 
DEFINE FILE TCTRNK
CHN_GRP/A3 = IF CHAIN_GROUP EQ ' ' THEN 'XX' ELSE CHAIN_GROUP;
GRC_NAME/A30 = IF GCHN_NAME EQ ' ' THEN 'ALL OTHER' ELSE GCHN_NAME;
GCHN_NM/A30 = LCWORD (30, GRC_NAME, GCHN_NM);
END
TABLE FILE TCTRNK
SUM BOOKINGS
    NNROOMS
    NNROOMS/D8 AS 'NMBR_DAYS'
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'
    TOTAL_AMT/D12.2
   CHN_GRP
BY GCHN_NM
BY ROLLCD
ON TABLE HOLD AS HOLD1
END
-RUN
 
 
TABLE FILE HOLD1
PRINT BOOKINGS
    NNROOMS
    NMBR_DAYS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
BY GCHN_NM
RANKED BY HIGHEST &&RANK_METH
BY ROLLCD
ON TABLE HOLD AS HOLD2
END
-RUN
 
-SET &&RANK_LIMIT = 50;
 
DEFINE FILE HOLD2
  DRANK/D5      = RANK ;
  ARANKX/A6     = FTOA(DRANK, '(D5)', 'A6');
  ARANK/A5      = EDIT(ARANKX,'$99999');
  RANK_LIMIT/I5 = &&RANK_LIMIT2 ;
  RNK_VAL/A5 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                 IF RANK GT RANK_LIMIT THEN 'OTHER' ELSE ARANK;
END
 
 
TABLE FILE HOLD2
PRINT ROLLCD
    BOOKINGS
    NNROOMS
    NMBR_DAYS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
BY GCHN_NM
BY RNK_VAL
ON TABLE HOLD AS HOLD3
END
-RUN
 
DEFINE FILE HOLD3
 
ROLL_PRINT/A8 = IF RNK_VAL LE '&&RANK_LIMIT2'
        THEN ROLLCD ELSE 'OTHER';
 
END
 
 
TABLE FILE HOLD3
SUM ROLLCD
    BOOKINGS
    NNROOMS
    NMBR_DAYS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
BY GCHN_NM
BY RNK_VAL
BY ROLL_PRINT
ON TABLE HOLD AS HOLD4
END
-RUN
 
 
TABLE FILE HOLD1
SUM &&RANK_METH
BY GCHN_NM
ON TABLE HOLD AS RHOLD1
END
-RUN
 
TABLE FILE RHOLD1
PRINT &&RANK_METH
RANKED BY HIGHEST &&RANK_METH AS 'DAYS_RANK'
BY GCHN_NM
ON TABLE HOLD AS RHOLD2
END
-RUN
 
 
MATCH FILE HOLD4
PRINT ROLLCD
    BOOKINGS
    NNROOMS
    NMBR_DAYS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
    RNK_VAL
    ROLL_PRINT
BY GCHN_NM
ON TABLE HOLD
RUN
FILE RHOLD2
SUM DAYS_RANK
BY GCHN_NM
AFTER MATCH HOLD AS HOLD5 OLD-OR-NEW
END
-RUN
 
 
TABLE FILE HOLD5
PRINT ROLLCD
    BOOKINGS
    NNROOMS
    NMBR_DAYS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
    RNK_VAL
    ROLL_PRINT
    GCHN_NM
RANKED BY HIGHEST DAYS_RANK
ON TABLE HOLD AS HOLD6
END
-RUN
 
DEFINE FILE HOLD6
  ORG_LIMIT/I3 = &&RANK_LIMIT ;
  OLIMIT/A3    = EDIT(ORG_LIMIT) ;
  CRANK/D5     = RANK;
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF GCHN_NM NE LAST GCHN_NM THEN (LAST LIST + 1)
    ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6  = EDIT(FRANKX,'$999999');
  ORG_VALUE/A6 = IF ORG_LIMIT EQ 0 THEN BRANK ELSE
               IF LIST GT ORG_LIMIT THEN 'OTHER' ELSE FRANK;
END
 
TABLE FILE HOLD6
SUM ROLLCD
    BOOKINGS
    NNROOMS
    NMBR_DAYS
    ROOM_AMT
    TOTAL_AMT
    CHN_GRP
    RNK_VAL
    ROLL_PRINT
 
     OLIMIT
    ORG_LIMIT
BY ORG_VALUE
BY GCHN_NM
BY RNK_VAL
BY ROLL_PRINT
ON TABLE HOLD AS HOLD7
END
-RUN
 
 
 
 
 
 
-GOTO report;
 
TABLE FILE HOLD7
SUM NMBR_DAYS AS 'NMBR,NIGHTS'
ROOM_AMT AS 'TOTAL,ROOM,AMT'
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0) THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE
    IF ((NMBR_DAYS LT 1) AND (NMBR_DAYS GT (-1))) THEN 0 ELSE
    ROOM_AMT/NMBR_DAYS; AS  'AVG,DAILY,RATE'
BOOKINGS AS 'NET,BOOKINGS'
COMPUTE AVGSTAY/D9=IF (NMBR_DAYS LT 0) AND (BOOKINGS LT 0) THEN ((NMBR_DAYS/BOOKINGS)*(-1)) ELSE
          IF ((BOOKINGS LT 1) AND (BOOKINGS GT (-1))) THEN 0 ELSE
           NMBR_DAYS/BOOKINGS; AS  'AVG,STAY'
 BY ORG_VALUE AS 'RANK'
 BY GCHN_NM AS 'GROUP CHAIN'
 BY RNK_VAL
 BY ROLL_PRINT AS 'ROLLUP'
 
ON GCHN_NM RECOMPUTE MULTILINES AS 'TOTAL FOR'
END
-RUN
-QUIT
 
 
 
 
 
 
-report
 
-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN
 
 
DEFINE FILE HOLD7
GRPCHN_NM/A30 = IF ORG_VALUE LT OLIMIT THEN GCHN_NM ELSE 'ALL OTHER';
NOWTOD/A8 WITH ORG_VALUE = HHMMSS (NOWTOD);
END
 
 
TABLE FILE HOLD7
-INCLUDE HEADER
"&&SUBHEAD"
"</2"
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
 
 
 
-INCLUDE FOOTERSM
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&SMSTY
ENDSTYLE
 
 
 
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-IF &LINES GT 0 THEN GOTO XXIT;
EX TCEMPTY
-RUN
-XXIT
