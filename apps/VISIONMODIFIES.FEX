-* Vision2k data modifies
-* Company ID/BR_CL_IDX needing updated until program is fixed
-* CH2M DE999999
-* KIEW KW999999
-* COMPUT CC999999
-* TLTECH DE999997
-* GETRON GT999999


SET ASNAMES=ON

-SET &&FILEA = 'A9TLTECH';
-SET &&FILES = 'S9TLTECH';
-SET &&FILEM = 'M9TLTECH';
-SET &&FILED = 'D9TLTECH';
-SET &&FILEC = 'C9TLTECH';
-SET &&FILEH = 'H9TLTECH';
-SET &&BC = 'DE999997';

-****  Segment

JOIN AIR_KEY IN &&FILEA TO ALL AIR_KEY IN &&FILES
END
TABLE FILE &&FILEA
PRINT RF_FLAG
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
WHERE RF_FLAG EQ 'N'
WHERE BR_CL_IDX EQ '&&BC.EVAL'
ON TABLE HOLD
END
MODIFY FILE &&FILES
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE RF_FLAG = ' ';
ON MATCH UPDATE RF_FLAG
DATA ON HOLD
END 

-************ Market

JOIN AIR_KEY IN &&FILEA TO ALL AIR_KEY IN &&FILEM
END
TABLE FILE &&FILEA
PRINT RF_FLAG
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
WHERE RF_FLAG EQ 'N'
WHERE BR_CL_IDX EQ '&&BC.EVAL'
ON TABLE HOLD
END
MODIFY FILE &&FILEM
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE RF_FLAG = ' ';
ON MATCH UPDATE RF_FLAG
DATA ON HOLD
END 

-************ Destination

JOIN AIR_KEY IN &&FILEA TO ALL AIR_KEY IN &&FILED
END
TABLE FILE &&FILEA
PRINT RF_FLAG
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
WHERE RF_FLAG EQ 'N'
WHERE BR_CL_IDX EQ '&&BC.EVAL'
ON TABLE HOLD
END
MODIFY FILE &&FILED
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE RF_FLAG = ' ';
ON MATCH UPDATE RF_FLAG
DATA ON HOLD
END 


-* CAR DATA CURRENCY DATE UPDATE WITH INVOICE DATE

TABLE FILE &&FILEC
PRINT INVOICE_DATE 
BY CAR_KEY
WHERE CURR_DATE EQ ' '
WHERE BR_CL_IDX EQ '&&BC.EVAL'
ON TABLE HOLD AS CURRHLD
END
TABLE FILE CURRHLD
PRINT INVOICE_DATE AS 'CURR_DATE'
BY CAR_KEY
ON TABLE HOLD
END
MODIFY FILE &&FILEC
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH UPDATE CURR_DATE
DATA ON HOLD
END

-* Hotel Data Currency Date Update with Invoice Date

TABLE FILE &&FILEH
PRINT INVOICE_DATE 
BY HTL_KEY
WHERE CURR_DATE EQ ' '
WHERE BR_CL_IDX EQ '&&BC.EVAL'
ON TABLE HOLD AS CURRHLD
END
TABLE FILE CURRHLD
PRINT INVOICE_DATE AS 'CURR_DATE'
BY HTL_KEY
ON TABLE HOLD
END
MODIFY FILE &&FILEH
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH UPDATE CURR_DATE
DATA ON HOLD
END
