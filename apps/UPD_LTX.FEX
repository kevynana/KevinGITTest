-INCLUDE SETECHO
SET ASNAMES = ON

FILEDEF LTX_HIER DISK D:\AS400\LTX_HIER.TXT

TABLE FILE LTX_HIER
PRINT LVL1 LVL2
BY LVL1 NOPRINT
ON TABLE HOLD AS FIXLV1
END
-RUN


-GOTO DEB; 
-*-GOTO AIR;

JOIN AIR_KEY IN S_LTX TO ALL AIR_KEY IN A_LTX AS J1
TABLE FILE S_LTX
PRINT LEVEL2 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL2 NOPRINT
ON TABLE HOLD AS DEBHOLD
END
-RUN



JOIN CLEAR *
-RUN
JOIN LEVEL2 IN  DEBHOLD TO LVL1 IN FIXLV1 AS J1
TABLE FILE DEBHOLD
PRINT LEVEL2 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR LVL1 LVL2
ON TABLE HOLD AS DEBHLD
END
-RUN
 


DEFINE FILE DEBHLD
XL01/A15 = IF LEVEL2 EQ LVL1 THEN LEVEL2 ELSE 'DEFCC';
XL02/A15 = IF XL01 EQ 'DEFCC' THEN 'DEFDIV' ELSE LVL2;
END
TABLE FILE DEBHLD
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR XL01 AS 'AROLL_LEV4' XL02 AS 'AROLL_LEV3'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXSEG
END
-RUN


MODIFY FILE S_LTX
FIXFORM FROM FIXSEG
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXSEG
END
-RUN


 
TABLE FILE FIXSEG
SUM AROLL_LEV4 AS 'LEVEL1'
BY AIR_KEY
ON TABLE HOLD AS FIXAIR
END
-RUN

MODIFY FILE A_LTX
FIXFORM FROM FIXAIR
MATCH AIR_KEY
ON MATCH UPDATE LEVEL1
ON NOMATCH REJECT
DATA ON FIXAIR
END
-RUN


 

JOIN CLEAR *
-RUN

 
JOIN AIR_KEY IN M_LTX TO ALL AIR_KEY IN A_LTX AS J1
TABLE FILE M_LTX
PRINT LEVEL2 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL2 NOPRINT
ON TABLE HOLD AS DEBHOLD2
END
-RUN



JOIN CLEAR *
-RUN



JOIN LEVEL2 IN  DEBHOLD2 TO LVL1 IN FIXLV1 AS J1
TABLE FILE DEBHOLD2
PRINT LEVEL2 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR LVL1 LVL2
ON TABLE HOLD AS DEBHLD2
END
-RUN


JOIN LEVEL2 IN  DEBHLD2 TO LVL1 IN FIXLV1 AS J1
DEFINE FILE DEBHLD2
XL01/A15 = IF LEVEL2 EQ LVL1 THEN LEVEL2 ELSE 'DEFCC';
XL02/A15 = IF XL01 EQ 'DEFCC' THEN 'DEFDIV' ELSE LVL2;
END
TABLE FILE DEBHLD2
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR XL01 AS 'AROLL_LEV4' XL02 AS 'AROLL_LEV3'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXMKT
END
-RUN

MODIFY FILE M_LTX
FIXFORM FROM FIXMKT
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXMKT
END
-RUN


JOIN CLEAR *
-RUN

 
JOIN AIR_KEY IN D_LTX TO ALL AIR_KEY IN A_LTX AS J1
TABLE FILE D_LTX
PRINT LEVEL2 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL2 NOPRINT
ON TABLE HOLD AS DEBHOLD3
END
-RUN



JOIN CLEAR *
-RUN

JOIN LEVEL2 IN  DEBHOLD3 TO LVL1 IN FIXLV1 AS J1
TABLE FILE DEBHOLD3
PRINT LEVEL2 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR LVL1 LVL2
ON TABLE HOLD AS DEBHLD3
END
-RUN



JOIN LEVEL2 IN  DEBHLD3 TO LVL1 IN FIXLV1 AS J1
DEFINE FILE DEBHLD3
XL01/A15 = IF LEVEL2 EQ LVL1 THEN LEVEL2 ELSE 'DEFCC';
XL02/A15 = IF XL01 EQ 'DEFCC' THEN 'DEFDIV' ELSE LVL2;
END
TABLE FILE DEBHLD3
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR XL01 AS 'AROLL_LEV4' XL02 AS 'AROLL_LEV3'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXDST
END
-RUN




MODIFY FILE D_LTX
FIXFORM FROM FIXDST
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXDST
END
-RUN




JOIN CLEAR *
-RUN

 
 
TABLE FILE C_LTX
PRINT LEVEL2 CAR_KEY  
BY LEVEL2 NOPRINT
ON TABLE HOLD AS CARHLD
END
-RUN

JOIN LEVEL2 IN  CARHLD TO LVL1 IN FIXLV1 AS J1
TABLE FILE CARHLD
PRINT LEVEL2 CAR_KEY LVL1 LVL2
ON TABLE HOLD AS CARHLD3
END
-RUN

 
 
DEFINE FILE CARHLD3
XL01/A15 = IF LEVEL2 EQ LVL1 THEN LEVEL2 ELSE 'DEFCC';
XL02/A15 = IF XL01 EQ 'DEFCC' THEN 'DEFDIV' ELSE LVL2;
END
TABLE FILE CARHLD3
PRINT CAR_KEY XL01 AS 'LEVEL1'  XL01 AS 'AROLL_LEV4' XL02 AS 'AROLL_LEV3'
BY CAR_KEY NOPRINT
ON TABLE HOLD AS FIXCAR
END
-RUN

MODIFY FILE C_LTX
FIXFORM FROM FIXCAR
MATCH CAR_KEY  
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXCAR
END
-RUN


JOIN CLEAR *
-RUN

 
 
TABLE FILE H_LTX
PRINT LEVEL2 HTL_KEY  
BY LEVEL2 NOPRINT
ON TABLE HOLD AS HTLHLD
END
-RUN


JOIN LEVEL2 IN  HTLHLD TO LVL1 IN FIXLV1 AS J1
TABLE FILE HTLHLD
PRINT LEVEL2 HTL_KEY  LVL1 LVL2
ON TABLE HOLD AS HTLHLD3
END
-RUN


 
 DEFINE FILE HTLHLD3
XL01/A15 = IF LEVEL2 EQ LVL1 THEN LEVEL2 ELSE 'DEFCC';
XL02/A15 = IF XL01 EQ 'DEFCC' THEN 'DEFDIV' ELSE LVL2;
END
TABLE FILE HTLHLD3
PRINT HTL_KEY XL01 AS 'LEVEL1'  XL01 AS 'AROLL_LEV4' XL02 AS 'AROLL_LEV3'
BY HTL_KEY NOPRINT
ON TABLE HOLD AS FIXHTL
END
-RUN

MODIFY FILE H_LTX
FIXFORM FROM FIXHTL
MATCH HTL_KEY  
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXHTL
END
-RUN

 
-QUIT



-DEB

JOIN AIR_KEY IN S_LTX TO AIR_KEY IN A_LTX AS J1
TABLE FILE S_LTX
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF LEVEL1 EQ 'LTXB'
ON TABLE HOLD
END
-RUN

MODIFY FILE S_LTX
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE AROLL_LEV3='DEFDIV';
ON MATCH COMPUTE AROLL_LEV4='DEFCC';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN


JOIN AIR_KEY IN M_LTX TO AIR_KEY IN A_LTX AS J1
TABLE FILE M_LTX
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF LEVEL1 EQ 'LTXB'
ON TABLE HOLD AS HOLDM
END
-RUN

MODIFY FILE M_LTX
FIXFORM FROM HOLDM
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE AROLL_LEV3='DEFDIV';
ON MATCH COMPUTE AROLL_LEV4='DEFCC';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON HOLDM
END
-RUN


JOIN AIR_KEY IN D_LTX TO AIR_KEY IN A_LTX AS J1
TABLE FILE D_LTX
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF LEVEL1 EQ 'LTXB'
ON TABLE HOLD AS HOLDD
END
-RUN

MODIFY FILE D_LTX
FIXFORM FROM HOLDD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE AROLL_LEV3='DEFDIV';
ON MATCH COMPUTE AROLL_LEV4='DEFCC';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON HOLDD
END
-RUN




TABLE FILE HOLD
PRINT AIR_KEY
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE A_LTX
FIXFORM FROM HOLD1
MATCH AIR_KEY
ON MATCH COMPUTE LEVEL1='DEFCC';
ON MATCH UPDATE LEVEL1
ON NOMATCH REJECT
DATA ON HOLD1
END
-RUN


TABLE FILE C_LTX
PRINT CAR_KEY
BY CAR_KEY NOPRINT
IF LEVEL1 EQ 'LTXB'
ON TABLE HOLD AS CARHOLD
END
-RUN

MODIFY FILE C_LTX
FIXFORM FROM CARHOLD
MATCH CAR_KEY
ON MATCH COMPUTE LEVEL1='DEFCC';
ON MATCH COMPUTE AROLL_LEV3='DEFDIV';
ON MATCH COMPUTE AROLL_LEV4='DEFCC';
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON CARHOLD
END
-RUN

TABLE FILE H_LTX
PRINT HTL_KEY
BY HTL_KEY NOPRINT
IF LEVEL1 EQ 'LTXB'
ON TABLE HOLD AS HTLHOLD
END
-RUN

MODIFY FILE H_LTX
FIXFORM FROM HTLHOLD
MATCH HTL_KEY
ON MATCH COMPUTE LEVEL1='DEFCC';
ON MATCH COMPUTE AROLL_LEV3='DEFDIV';
ON MATCH COMPUTE AROLL_LEV4='DEFCC';
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON HTLHOLD
END
-RUN
