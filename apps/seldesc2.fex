-****************************************************************************
-* Functions: This program is used to generate the footer page which is saved
-*   in sbfoot. This program contains three steps.  First, it is to extract
-*   selection criteria from RPT_flds files, and construct to the appropriate
-*   printlines and where statements; secondly it retrieves code + desc from
-*   code tables; the last step is to write to sbfoot.fex
-* Date: March 4, 2003   - LS
-* Added &rpttyp of ETS to only allow 50 lines JK 5/29/03
-* Changed AVIW23 to be 52 lines - Steve (06/05/03)
-* Changed the ELSE to be 60 lines - Steve (06/05/03)
-* 10/22/03 LS - made changes as SU databases changes.
-* 02/23/04 LS - added changes for total company reporting.
-* 08/26/04 LS - added Trip Purpose and No Hotel Reason
-* 09/17/05 LS - added UDID
-* 11/03/06 added Booking type,region/country/state and origin airport
-* 05/07/08 REJ - Added LEVEL4 and Security on Levels
-* 02/25/09 LS - allowed to have 25 selections for ID_levels, therefore
-*       re-arrange the footer lines for ID_levels starting from FT1100.
-* 01/20/12 GSE - Removed double semicolon as this causes errors in 7.7.03 
-* 01/27/12 LSI - Added ID Level 5, 6, 7
-* 05/01/2013 LSI - change class category C -> P (Coach to Premium Economy),
-* D -> E (Discount Coach to Economy), add D (default) and U (upgrade)
-* LS 2014/04/18 changed from A15 to A60 for ID level4
-* 03/09/2015 LSI - S-07673 ALL-R Program UI and database fields for SLT member selection
-*  03/31/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-* 06/24/2015 LSI this is a bug fixed which was found in S-09727 for total-r
-*   Line -SET &NBRLINES = &FOOTLINES; changed to -SET &NBRLINES=&TOTALLINES - 7;
-*  06/26/2015  REJ  S-08389 Latest changes for ER5 Available Reports.
-*  08/04/2015  REJ  S-10079 Latest changes for ER5 Available Reports.  Added the
-*                           setfile name to the footer page.
-*  10/06/2015 JM    S-11866 Updated &&footr to write the correct setfile name instead of showing tempdril
-* 11/10/15 - DLV - S-12670 - ADDED UAVIW1 TO &FOOTLINES
-* 02/22/16 - DLV - S-14918 added pca_rpt to &FOOTLINES 
-* 08/20/2016 LSI S-23536 Add EMP_ID selection to Post Report            
-****************************************************************************
-INCLUDE SETECHO
SET USERFCHK= OFF
-*SET TEMPERASE = OFF
 
-DEFAULT &&USEPARM='X';
-DEFAULT &&STREAM='X';
-DEFAULT &SLTMEM='';

-* -SET &&FOOTR = '&&SETF.EVAL' || '/' | '&&IKEY.EVAL';
-SET &&FOOTR = '&&SETFILE.EVAL' || '/' | '&&IKEY.EVAL';

 
FILEDEF SBFOOT CLEAR
FILEDEF SBFOOT DISK SBFOOT.FEX
FILEDEF SBFOOTHIER DISK SBFOOTHIER.FEX
FILEDEF SBFOOTALL DISK SBFOOTALL.FEX
-*FILEDEF SBFOOTA DISK SBFOOTA.FEX
-*FILEDEF SBFOOTC DISK SBFOOTC.FEX
-*FILEDEF SBFOOTH DISK SBFOOTH.FEX
FILEDEF SBFOOTR DISK SBFOOTR.FEX
-RUN
-IF &&FROMAVRP EQ 'Y' GOTO :SD2AVRP;
 
 
-SET &FOOTLINES=IF &&STREAM EQ 'TRVLSUMK' THEN 41 ELSE
-   IF &&RPTTYPE EQ 'OTH' THEN 41 ELSE
-   IF &&RPTTYPE EQ 'EXC' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW23' OR 'AVIW48' OR 'AVI124' THEN 30 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW83' OR 'AVIW86' THEN 41 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW74' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW48' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW90' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW98' OR 'AVIW53' OR 'AVIEW1' OR 'AVIEW9' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIEW3' OR 'UAVIW3' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW22' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'CVIEW1' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIEW1' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIEW8' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW51' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI100' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI107' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI108' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIEW8' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIEW6' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'HVIW25' THEN 47 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI101' THEN 40 ELSE
-   IF &&STREAM EQ 'SMP_FAR' THEN 82 ELSE
-   IF &&STREAM EQ 'HTL_PREF' OR 'LIM_PLCY' THEN 45 ELSE
-   IF &&STREAM EQ 'SUMHIER'  THEN 40 ELSE
-   IF &&SETFILE EQ 'MXCAP' THEN 40 ELSE
-   IF &&STREAM EQ 'QTR_REV'  OR 'TC_QREV' THEN 40 ELSE
-   IF &&STREAM EQ 'TCTRVLS' OR 'TC_AIRS' THEN 40 ELSE
-   IF &&STREAM EQ 'PCA_RPT' THEN 40 ELSE
-   IF &&STREAM EQ 'TVLSV_SM' THEN 40 ELSE
-   IF &&STREAM EQ 'TBR_MAIN' THEN 47 ELSE
-   IF &&STREAM EQ 'TOP_ACH'  THEN 45 ELSE
-   IF &&STREAM EQ 'MXCAPRPT'  THEN 47 ELSE
-   IF &&STREAM EQ 'CAP_RPTN'  THEN 47 ELSE
-   IF &&STREAM EQ 'TCHTL103' THEN 45 ELSE
-   IF &&STREAM EQ 'FR_AIR' THEN 45 ELSE
-   IF &&STREAM EQ 'EXCH_RPT' THEN 45 ELSE
-   IF &&STREAM EQ 'TKCAPRPT' THEN 13 ELSE
-   IF &&USEPARM.EVAL EQ 'CVIEW2' OR 'AVIW16' OR 'AVIEW5' OR 'HVIEW3' OR 'AVIW99' OR 'AVI109' OR 'AVIW70' OR 'AVIW20' OR 'AVIW11' OR 'HVIEW7' OR 'AVIW75' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'CVIEW9' OR 'HVIW18' OR 'AVI132' OR 'AVIW49' OR 'AVI113' OR 'AVIEW1' OR 'AVIW84' OR 'AVIEW4' OR 'HVIW12' OR 'HVIEW1' OR 'AVIW25' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW56' OR 'AVIW62' OR 'AVIW80' OR 'AVIW83' OR 'AVIW94' OR 'AVIW31' OR 'AVIW95' OR 'AVIEW6' OR 'UHVIW2' OR 'AVIW40' OR 'AVI133' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVI134' OR 'AVIW52' OR 'AVIW61' OR 'AVIW18' OR 'AVIW17' OR 'AVIEW7' OR 'HVIW21' OR 'AVI105' OR 'AVI106' OR 'AVIW65' OR 'AVIW39' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW19' OR 'AVIW63' OR 'AVIW34' OR 'HVIEW4' OR 'AVI111' OR 'AVIW37' OR 'CVIEW7' OR 'UCVIW2' OR 'AVIW41' OR 'UAVIW5' OR 'UAVIW1' THEN 45 ELSE
-   IF &&USEPARM.EVAL EQ 'AVIW48' THEN 41 ELSE
-   IF &&STREAM EQ 'TSM_ABC' OR 'TKT_ACH' OR 'AB_NONC' OR 'AIR_BNM' OR 'CH_BOOK' THEN 41 ELSE 50;
 
-IF &&DRILLED_RUN EQ 'Y' GOTO NXT;
-SET &FOOTLINES = IF '&&OUTFMT.EVAL' EQ 'PPT' THEN (&FOOTLINES - 2) ELSE &FOOTLINES;
-NXT
-*initializa 200 lines in total
-SET &STARTNO = 10;
-SET &TOTALLINES = 200;
 
-SET &LINENO = &STARTNO;
-REPEAT ENDFORMAT &TOTALLINES TIMES
-SET &FT.&LINENO = ' ';
-SET &LINENO = &LINENO + 1;
-ENDFORMAT
 
-SET &LINENO = &STARTNO;
-SET &MAXLEN = 160;
-SET &TEMPLINE = '';
 
-IF &&ROLLUP EQ 'TOTAL-R' THEN GOTO CHKBOOKINGS;
-***************************************************************************************************
-* Hierarchy, client and category selections
-***************************************************************************************************
TABLE FILE BRPTFLDS
PRINT SEG HIEORG1.ID
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS HDES1
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO NOHIEORG1;
 
-READ HDES1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &LEVEL.A2. &SLTMEM.A64.
-SET &SLTMEM = IF '&SLTMEM.EVAL' NE '' THEN SUBSTR(64, '&SLTMEM.EVAL', 5, 64, 60, 'A60') ELSE '';
 
-CLOSE HDES1
-GOTO AFTERSETH1;
 
-NOHIEORG1
-SET &INCL1=0;
-SET &INCL2=0;
-SET &INCL3=0;
-SET &LEVEL=' ';
 
-AFTERSETH1
-*Hierarchy selection headings
 
-SET &TEMPLINE = IF &INCL3 EQ 1
-   THEN '** HIERARCHY SELECTION - INCLUDED **'
-  ELSE IF &INCL3 EQ 2
-   THEN '** HIERARCHY SELECTION - EXCLUDED **'
-  ELSE '** HIERARCHY SELECTION CRITERIA **';
-SET &FT.&LINENO = &TEMPLINE;
-SET &LINENO = &LINENO + 1;
 
-SET &TEMPLINE = IF &INCL3 EQ 0 THEN 'NO SELECTION' ELSE ' ';
-SET &FT.&LINENO = &TEMPLINE;
-SET &LINENO = IF &INCL3 EQ 0 THEN &LINENO + 1 ELSE &LINENO;
 
-*IF &INCL1,2,3 are all zero, that means no selections.
-IF &INCL1 EQ 0 AND &INCL2 EQ 0  AND &INCL3 EQ 0 THEN GOTO NoHDES;
-IF &INCL3 EQ 0 THEN GOTO CHK_CLIENT;
 
TABLE FILE BRPTFLDS
PRINT MEMBER LEVEL
BY MEMBER NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE HOLD AS ORGMEM1 FORMAT FOCUS INDEX MEMBER
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO CHK_CLIENT;
 
-*-INCLUDE GETHRMEM
JOIN ROLL_LEV IN HIERORG TO MEMBER IN ORGMEM1
TABLE FILE HIERORG
PRINT DEPTNAME
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL' AND
  HIERORG.LEVEL EQ ORGMEM1.LEVEL
  AND ROLL_LEV EQ ORGMEM1.MEMBER
ON TABLE SAVE AS MEMBER1
END
-RUN
 
-READMEM
 
-SET &LOOPTIME = INT((&LINES + 1)/2);
 
-REPEAT EndMember &LOOPTIME TIMES
 
-SET &MEM = '';
-SET &MEM2 = '';
-READ MEMBER1 NOCLOSE &MEM.A60.
-READ MEMBER1 NOCLOSE &MEM2.A60.
 
-SET &FT.&LINENO = '&MEM.EVAL' || '<55 &MEM2.EVAL';
-SET &LINENO = &LINENO + 1;
 
-EndMember
 
-CHK_CLIENT
-IF &&SETF EQ 'TCBMNBV' OR 'TCBMNBV2' THEN GOTO CHK_CAT;
-IF &INCL1 EQ 0 THEN GOTO CHK_CAT;
 
TABLE FILE BRPTFLDS
PRINT CLIENT
IF INST_KEY EQ &&IKEY
WHERE CLIENT NE ' '
ON TABLE SAVE AS CLIENT1
END
-RUN
 
-*Client selection headings
-SET &FT.&LINENO=IF &INCL1 EQ 0 THEN ' '
- ELSE IF &INCL1 EQ 1 THEN '** CLIENT NUMBER SELECTION CRITERIA - INCLUDED **'
- ELSE IF &INCL1 EQ 2 THEN '** CLIENT NUMBER SELECTION CRITERIA - EXCLUDED **';
-SET &LINENO = IF &INCL1 EQ 0 THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT ClientEnd &LINES TIMES
-READ CLIENT1 NOCLOSE &VAL.A8
-SET &VAL2=&FT.&LINENO;
-SET &LINENO = IF &VAL2.LENGTH GT &MAXLEN THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO = IF &VAL2.LENGTH GT &MAXLEN THEN '  ' | &VAL
-  ELSE &VAL2 || ' ' | &VAL;
-ClientEnd
-CLOSE CLIENT1
 
-CHK_CAT
-IF &INCL2 EQ 0 THEN GOTO NoHDES;
TABLE FILE BRPTFLDS
PRINT CATG
IF INST_KEY EQ &&IKEY
WHERE CATG NE ' '
ON TABLE SAVE AS CATG1
END
-RUN
 
-*Category selection headings
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
 
-SET &FT.&LINENO = IF &INCL2 EQ 0  THEN ' '
- ELSE IF &INCL2 EQ 1
-   THEN '** CATEGORY SELECTION CRITERIA - INCLUDED **'
- ELSE IF &INCL2 EQ 2
-   THEN '** CATEGORY SELECTION CRITERIA - EXCLUDED **';
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
 
-REPEAT CATGEnd &LINES TIMES
-READ CATG1 NOCLOSE &VAL.A15
-SET &VAL2=&FT.&LINENO;
-SET &LINENO = IF &VAL2.LENGTH GT &MAXLEN THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO = IF &VAL2.LENGTH GT &MAXLEN THEN '  ' | &VAL
-  ELSE &VAL2 || ' ' | &VAL;
-CATGEnd
-CLOSE CATG1
 
-NoHDES
 
-*************************************************************************
-* Booking types
-*************************************************************************
-CHKBOOKINGS
DEFINE FILE BRPTFLDS
TEST/A1='X';
END
TABLE FILE BRPTFLDS
PRINT SEG BOOKTYPE_A
ON TABLE SAVE AS BOOKTYPE
END
-RUN
-IF &LINES EQ 0 THEN GOTO NOBT;
-READ BOOKTYPE &X.10. &BT1.1. &BT2.1. &BT3.1. &BT4.1. &BT5.1. &BT6.1. &BT7.1. &BT8.1. &BT9.1. &BT10.1. &BT11.1. &BT12.1.
-SET &ALLSEL = IF &BT1 EQ 1 AND &BT2 EQ 1 AND &BT3 EQ 1 AND &BT4 EQ 1 AND &BT5 EQ 1 AND &BT6 EQ 1 AND
- &BT7 EQ 1 AND &BT8 EQ 1 AND &BT9 EQ 1 AND &BT10 EQ 1 AND &BT11 EQ 1 AND &BT12 EQ 1 THEN 'Y' ELSE 'N';
 
-IF &ALLSEL EQ 'Y' THEN GOTO NOBT;
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &TEMPLINE = IF &ALLSEL EQ 'Y' THEN ' '  ELSE '** Booking Types Selected: ';
 
-SET &TEMPLINE = IF &BT1 EQ 1 THEN '&TEMPLINE.EVAL' | 'Agent' ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &BT1 EQ 1 THEN 'N' ELSE 'Y';
 
-SET &TEMPLINE = IF &TEMPLINE NE ' ' AND &BT2 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Executive Agent'
- ELSE IF '&TEMPLINE.EVAL' NE ' ' AND &BT2 EQ 1 THEN '&TEMPLINE.EVAL' | 'Executive Agent'  ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT2 EQ 1 THEN 'N' ELSE 'Y';
 
-SET &TEMPLINE = IF &TEMPLINE NE ' ' AND &BT3 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Online'
- ELSE IF '&TEMPLINE.EVAL' NE ' ' AND &BT3 EQ 1 THEN '&TEMPLINE.EVAL' | 'Online'  ELSE &TEMPLINE;
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT3 EQ 1 THEN 'Y' ELSE &FIRST;
 
-SET &TEMPLINE = IF &TEMPLINE NE ' ' AND &BT4 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Executive Online'
- ELSE IF '&TEMPLINE.EVAL' NE ' ' AND &BT4 EQ 1 THEN '&TEMPLINE.EVAL' | 'Executive Online'  ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT4 EQ 1 THEN 'Y' ELSE &FIRST;
 
-SET &TEMPLINE = IF &TEMPLINE NE ' ' AND &BT5 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Web'
- ELSE IF '&TEMPLINE.EVAL' NE ' ' AND &BT5 EQ 1 THEN '&TEMPLINE.EVAL' | 'Web'  ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT5 EQ 1 THEN 'Y' ELSE &FIRST;
 
-SET &TEMPLINE = IF '&TEMPLINE.EVAL' NE ' ' AND &BT6 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Executive Web'
- ELSE IF '&TEMPLINE.EVAL' NE ' ' AND &BT6 EQ 1 THEN '&TEMPLINE.EVAL' | 'Executive Web'  ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT6 EQ 1 THEN 'Y' ELSE &FIRST;
 
-SET &TEMPLINE = IF &TEMPLINE NE ' ' AND &BT7 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Agency Web'
- ELSE IF '&TEMPLINE.EVAL' NE ' ' AND &BT7 EQ 1 THEN '&TEMPLINE.EVAL' | 'Agency Web'  ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT7 EQ 1 THEN 'Y' ELSE &FIRST;
 
-SET &TEMPLINE = IF &TEMPLINE NE ' ' AND &BT8 EQ 1  AND &FIRST EQ 'N'
- THEN '&TEMPLINE.EVAL' | ';Executive Agency Web'
- ELSE IF &TEMPLINE NE ' ' AND &BT8 EQ 1 THEN '&TEMPLINE.EVAL' | 'Executive Agency Web'  ELSE '&TEMPLINE.EVAL';
-SET &FIRST = IF &FIRST EQ 'N' THEN 'N' ELSE IF &BT8 EQ 1 THEN 'Y' ELSE &FIRST;
 
-SET &FT.&LINENO = &TEMPLINE;
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
 
-SET &TEMPLINE = IF &BT9 EQ 1 THEN 'Exchange from Online' ELSE '';
-SET &TEMPLINE = IF '&TEMPLINE.EVAL' NE ' ' AND &BT10 EQ 1 THEN '&TEMPLINE.EVAL' | ';Executive Exchange from Online'
- ELSE IF '&TEMPLINE.EVAL' EQ ' ' AND &BT10 EQ 1 THEN 'Executive Exchange from Online'  ELSE '&TEMPLINE.EVAL';
-SET &TEMPLINE = IF '&TEMPLINE.EVAL' NE ' ' AND &BT11 EQ 1 THEN '&TEMPLINE.EVAL' | ';Consolidator'
- ELSE IF '&TEMPLINE.EVAL' EQ ' ' AND &BT11 EQ 1 THEN 'Consolidator'  ELSE '&TEMPLINE.EVAL';
-SET &TEMPLINE = IF '&TEMPLINE.EVAL' NE ' ' AND &BT12 EQ 1 THEN '&TEMPLINE.EVAL' | ';Executive Consolidator'
- ELSE IF '&TEMPLINE.EVAL' EQ ' ' AND &BT12 EQ 1 THEN 'Executive Consolidator'  ELSE '&TEMPLINE.EVAL';
 
-SET &FT.&LINENO = &TEMPLINE;
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
 
-NOBT
 
-TYPE &&UDIDUSED
 
-IF &&ROLLUP EQ 'TOTAL-R' THEN GOTO TotalTandT;
-IF &&UDIDUSED NE 'Y' THEN GOTO FINUDID;
-******************************************************************************
-* the start of UDID changes
-******************************************************************************
 
-SET &UFILE = 'UF' | '&&COMPNY.EVAL' || '';
JOIN CLEAR *
JOIN UDID IN BRPTFLDS TO UDID IN &UFILE
 
-*Retrieve from and to values
TABLE FILE BRPTFLDS
PRINT UDID UD_DESC FROMVAL TOVAL
BY UDID NOPRINT
WHERE UINCL EQ 9
ON TABLE SAVE AS UDID9
END
-RUN
 
 
-IF &LINES EQ 0 THEN GOTO CHKUDID2;
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &PrevUDID='';
-REPEAT TOUDID1 &LINES TIMES
-READ UDID9 NOCLOSE &VUDID.A3. &VUDDESC.A40. &VFROM.16. &VTO.16.
 
-SET &LEN=ARGLEN(40,'&VUDDESC.EVAL','I2');
-SET &VUDDESC = TRIM('T','&VUDDESC.EVAL', 40, ' ', 1, 'A&LEN.EVAL');
 
-SET &VFROM = TRIM('B','&VFROM.EVAL', 16, ' ', 1, 'A16');
-SET &LEN=ARGLEN(16,'&VFROM.EVAL','I2');
-SET &VFROM = TRIM('B','&VFROM.EVAL', 16, ' ', 1, 'A&LEN.EVAL');
 
-SET &VTO = TRIM('B','&VTO.EVAL', 16, ' ', 1, 'A16');
-SET &LEN=ARGLEN(16,'&VTO.EVAL','I2');
-SET &VTO = TRIM('B','&VTO.EVAL', 16, ' ', 1, 'A&LEN.EVAL');
 
-IF &PrevUDID EQ &VUDID THEN GOTO SameUDID1;
-SET &PrevUDID='&VUDID.EVAL';
-SET &FT.&LINENO = '** ' | '&VUDDESC.EVAL' || ' from ' | '&VFROM.EVAL' || ' to ' | '&VTO.EVAL';
 
-GOTO IncUDID1;
-SameUDID1
-SET &FT.&LINENO = &FT.&LINENO || ', from ' | '&VFROM.EVAL' || ' to ' | '&VTO.EVAL';
-GOTO TOUDID1;
-IncUDID1
-SET &LINENO = &LINENO + 1;
-TOUDID1
-CLOSE UDID9
 
-CHKUDID2
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
TABLE FILE BRPTFLDS
PRINT UDID UINCL UD_DESC UDDATA
BY UDID NOPRINT
BY UINCL NOPRINT
WHERE UINCL NE 9
ON TABLE SAVE AS UDID2
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO FINUDID;
 
-SET &PrevUDID='';
-SET &PrevIncl='';
-SET &CNT = 1;
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
 
-REPEAT TOUDID2 &LINES TIMES
-READ UDID2 &VUDID.3. &VINCL.1. &VUDDESC.40. &VUDDATA.64.
 
-TYPE &VUDID &VINCL &VUDDESC &VUDDATA
 
-SET &LEN=ARGLEN(40,'&VUDDESC.EVAL','I2');
-SET &VUDDESC = TRIM('T', '&VUDDESC.EVAL', 40, ' ', 1, 'A&LEN.EVAL');
-SET &LEN=ARGLEN(64,'&VUDDATA.EVAL','I2');
-SET &VUDDATA2 = TRIM('T','&VUDDATA.EVAL', 64, ' ', 1, 'A&LEN.EVAL');
 
-SET &OP = IF &VINCL EQ 1 THEN ' equal to:'
-     ELSE IF &VINCL EQ 2 THEN ' not equal to:'
-     ELSE IF &VINCL EQ 3 THEN ' contains:' ELSE ' omits: ';
 
-IF &PrevUDID NE &VUDID AND &PrevIncl NE &VINCL THEN GOTO aNewUDID2 ;
 
-SameUDID2
-SET &VAL = &FT.&LINENO;
-SET &LINENO = IF &VAL.LENGTH GT &MAXLEN THEN &LINENO+1 ELSE &LINENO ;
-SET &FT.&LINENO = IF &FT.&LINENO EQ ' ' THEN '&VUDDATA2.EVAL' ELSE &FT.&LINENO || ', ' | '&VUDDATA2.EVAL';
-GOTO KeepPrvVal;
 
-aNewUDID2
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO = '** ' | '&VUDDESC.EVAL' || ' &OP.EVAL ' | '&VUDDATA2.EVAL';
 
-KeepPrvVal
-SET &PrevUDID='&VUDID.EVAL';
-SET &PrevIncl = '&VINCL.EVAL';
-SET &CNT = &CNT + 1;
-TOUDID2
 
-FINUDID
-GOTO EndTotal;
-******************************************************************************
-* the end of UDID changes
-******************************************************************************
-* Added total company reporting
-******************************************************************************
-TotalTandT
TABLE FILE BRPTFLDS
PRINT SEG ROLL1.ID
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS ROLL11
END
-RUN
 
-SET &IN1 = 0;
-SET &IN2 = 0;
-SET &IN3 = 0;
-SET &IN4 = 0;
-SET &IN5 = 0;
-SET &IN6 = 0;
-SET &OFACCT = 0;
-SET &CTD = 0;
-IF &LINES EQ 0 THEN GOTO NoReadRoll11;
-READ ROLL11 &X.1. &IN1.1. &IN2.1. &IN3.1. &IN4.1. &IN5.1. &IN6.1. &OFACCT.1. &CTD.1.
 
-NoReadRoll11
 
 
-*leave 15 lines for each selections, 30 lines for rollup
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &LINENO1 = &LINENO;
-SET &LINENO2 = &LINENO + 30;
-SET &LINENO3 = &LINENO + 45;
-SET &LINENO4 = &LINENO + 60;
-SET &LINENO5 = &LINENO + 75;
 
 
-SET &LINENO1 = &LINENO1 + 1;
-SET &FT.&LINENO1 = IF &CTD EQ 1
-   THEN '** CTD (Corporate Travel Department) Included **'
-   ELSE '** CTD (Corporate Travel Department) Excluded **';
-SET &LINENO1 = &LINENO1 + 1;
 
-SET &FT.&LINENO1 = IF &IN1 EQ 1 AND &OFACCT EQ 0
-   THEN '** COMPANY SELECTION - INCLUDED **'
-        ELSE IF &IN1 NE 2 AND &OFACCT EQ 1
-   THEN '** OF ACCOUNT COMPANY SELECTION - INCLUDED **'
-        ELSE IF &IN1 EQ 2 AND &OFACCT EQ 0
-   THEN '** COMPANY SELECTION - EXCLUDED **'
-        ELSE IF &IN1 EQ 2 AND &OFACCT EQ 1
-   THEN '** OF ACCOUNT COMPANY SELECTION - EXCLUDED **'
-        ELSE '** COMPANY SELECTION CRITERIA **';
-SET &LINENO1 = &LINENO1 + 1;
-SET &FT.&LINENO1=' ----------------------------------------------------------';
-SET &LINENO1 = &LINENO1 + 1;
-SET &FT.&LINENO1 = IF &IN1 EQ 0 AND &OFACCT EQ 0 THEN 'All Companies selected'
-        ELSE IF &IN1 EQ 0 AND &OFACCT EQ 1 THEN 'All OF Account Companies selected' ELSE ' ';
 
-IF &LINES EQ 0 THEN GOTO EndTotal;
 
-*client branch selections
-SET &FT.&LINENO2=IF &IN2 EQ 0 THEN ' '
- ELSE IF &IN2 EQ 1 THEN '** CLIENT BRANCHES - INCLUDED ** '
- ELSE IF &IN2 EQ 2 THEN '** CLIENT BRANCHES - EXCLUDED ** ';
-SET &LINENO2 = &LINENO2 + 1;
-SET &FT.&LINENO2=IF &IN2 EQ 0 THEN ' '
- ELSE ' ----------------------------------------------------------';
 
-*Reservation branch selections
-SET &FT.&LINENO3=IF &IN3 EQ 0 THEN ' '
- ELSE IF &IN3 EQ 1 THEN '** RESERVATION BRANCHES - INCLUDED ** '
- ELSE IF &IN3 EQ 2 THEN '** RESERVATION BRANCHES - EXCLUDED ** ';
-SET &LINENO3 = &LINENO3 + 1;
-SET &FT.&LINENO3=IF &IN3 EQ 0 THEN ' '
- ELSE ' ----------------------------------------------------------';
 
-*Ticketing branch selections
-SET &FT.&LINENO4=IF &IN4 EQ 0 THEN ' '
- ELSE IF &IN4 EQ 1 THEN '** TICKETING BRANCHES - INCLUDED **'
- ELSE IF &IN4 EQ 2 THEN '** TICKETING BRANCHES - EXCLUDED **';
-SET &LINENO4 = &LINENO4 + 1;
-SET &FT.&LINENO4=IF &IN4 EQ 0 THEN ' '
- ELSE ' ----------------------------------------------------------';
 
-CheckClient
-*Client/category selection headings
-SET &FT.&LINENO5=IF &IN5 EQ 0 AND &IN6 EQ 0 THEN ' '
- ELSE IF &IN6 EQ 1
-  THEN '** CLIENT SELECTION CRITERIA - INCLUDED **'
- ELSE IF &IN6 EQ 2
-  THEN '** CLIENT SELECTION CRITERIA - EXCLUDED **'
- ELSE IF &IN5 EQ 1
-   THEN '** CATEGORY SELECTION CRITERIA - INCLUDED **'
- ELSE IF &IN5 EQ 2
-   THEN '** CATEGORY SELECTION CRITERIA - EXCLUDED **';
-SET &LINENO5 = &LINENO5 + 1;
-SET &FT.&LINENO5=IF &IN5 EQ 0 AND &IN6 EQ 0 THEN  ' ' ELSE
- ' ----------------------------------------------------------';
-SET &LINENO5 = &LINENO5 + 1;
-SET &FT.&LINENO5=' ';
 
 
TABLE FILE BRPTFLDS
PRINT ROLLUP BRANCH_CODE RESV_BRANCH TKT_BRANCH CATG2 BR_CL_IDX
IF INST_KEY EQ &&IKEY
ON TABLE SAVE AS ROLL22
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO EndTotal;
 
-*Defines the first printline for a particular field
-SET &LINENO1 = &LINENO1 + 1;
-SET &LINENO2 = &LINENO2 + 1;
-SET &LINENO3 = &LINENO3 + 1;
-SET &LINENO4 = &LINENO4 + 1;
-SET &LINENO5 = &LINENO5 + 1;
 
-REPEAT ENDROLL2 &LINES TIMES
-READ ROLL22 NOCLOSE &ROLL.8. &CB.2. &RB.2. &TB.2. &CATG.15. &CL.8.
-SET &VAL=&FT.&LINENO1;
-SET &LINENO1 = IF &ROLL EQ ' ' THEN &LINENO1
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &LINENO1+1 ELSE &LINENO1;
-SET &FT.&LINENO1 = IF &&SETF EQ 'TCBMNBV' THEN ''
- ELSE IF &IN1 EQ 0 THEN &FT.&LINENO
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &ROLL
- ELSE IF &VAL.LENGTH LT 8 THEN &ROLL
- ELSE IF &ROLL EQ ' ' THEN &VAL
- ELSE &VAL || ' ' | &ROLL;
 
-*client branch selections
-SET &VAL = &FT.&LINENO2;
-SET &LINENO2 = IF &VAL.LENGTH GT &MAXLEN THEN &LINENO2+1 ELSE &LINENO2;
-SET &FT.&LINENO2 = IF &IN2 EQ 0 THEN &FT.&LINENO2
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &CB
- ELSE IF &VAL.LENGTH LT 2 THEN &CB
- ELSE IF &CB EQ ' ' THEN &VAL
- ELSE &VAL || ' ' | &CB;
 
-*Reservation branch selections
-SET &VAL = &FT.&LINENO3;
-SET &LINENO3 = IF &VAL.LENGTH GT &MAXLEN THEN &LINENO3+1 ELSE &LINENO3;
-SET &FT.&LINENO3 = IF &IN3 EQ 0 THEN &FT.&LINENO3
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &RB
- ELSE IF &VAL.LENGTH LT 2 THEN &RB
- ELSE &VAL || ' ' | &RB;
 
-*Ticketing branch selections
-SET &VAL = &FT.&LINENO4;
-SET &LINENO4 = IF &VAL.LENGTH GT &MAXLEN THEN &LINENO4+1 ELSE &LINENO4;
-SET &FT.&LINENO4 = IF &IN4 EQ 0 THEN &FT.&LINENO4
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &TB
- ELSE IF &VAL.LENGTH LT 2 THEN &TB
- ELSE &VAL || ' ' | &TB;
 
-IF &IN6 EQ 0 THEN GOTO CHKROLLCAT;
-SET &VAL = &FT.&LINENO5;
-SET &LINENO5 = IF &VAL.LENGTH GT &MAXLEN THEN &LINENO5+1 ELSE &LINENO5;
-SET &FT.&LINENO5 = IF &IN6 EQ 0 THEN &FT.&LINENO5
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &CL
- ELSE IF &VAL.LENGTH LT 8 THEN &CL
- ELSE &VAL || ' ' | &CL;
 
-CHKROLLCAT
-IF &IN5 EQ 0 THEN GOTO ENDROLL2;
-SET &VAL = &FT.&LINENO5;
-SET &LINENO5 = IF &CATG EQ ' ' THEN &LINENO5
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &LINENO5+1 ELSE &LINENO5;
-SET &FT.&LINENO5 = IF &IN5 EQ 0 THEN &FT.&LINENO5
- ELSE IF &VAL.LENGTH GT &MAXLEN THEN &CATG
- ELSE IF &VAL.LENGTH LT 15 THEN &CATG
- ELSE IF &CATG EQ ' ' THEN &VAL
- ELSE &VAL || ' ' | &CATG;
 
-ENDROLL2
 
-SET &LINENO5 = IF &FT.&LINENO5 EQ ' ' THEN &LINENO5 ELSE &LINENO5 + 1;
-SET &LINENO = &LINENO5;
 
-EndTotal
 
-**************************************************
-* the following portion of subfoot come from BRPTFLDS database
-* Date: 02/27/03 level descriptives from rollup file
-**************************************************
-*========================================================================
-* GET DESCRIPTIVE VALUES FROM ROLLUP
-*========================================================================
 
-SET &VIEW = &&VIEW;
-SET &RPTGRP = &&RPTGRP;
-SET &ROLLUP = &&ROLLUP;
-SET &VIEWTYPE = EDIT(&VIEW,'9');
 
-IF &&ROLLUP EQ 'TOTAL-R' THEN GOTO LevSecurity;
 
TABLE FILE ROLLUP
PRINT LEV1 LEV2 LEV3 LEV4 TP_DESC LEV5 LEV6 LEV7 EMPID_DESC
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
ON TABLE SAVE AS LEVINFO
END
-RUN
 
-READ LEVINFO &LEVEL1.A20. &LEVEL2.A20. &LEVEL3.A20. &LEVEL4.A20. &TRIPDESC.A20. &LEVEL5.A20. &LEVEL6.A20. &LEVEL7.A20. &EMPID_DESC.A15.
-CLOSE LEVINFO
 
-SET &Temp1='''' || &LEVEL1 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL1 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL2 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL2 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL3 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL3 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL4 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL4 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL5 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL5 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL6 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL6 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &Temp1='''' || &LEVEL7 || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &LEVEL7 =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');

-SET &Temp1='''' || &EMPID_DESC || '''';
-SET &LEN =
- ARGLEN(22, &Temp1, 'I2') - 1;
-SET &EMPID_DESC =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &TRIPDESC = IF '&TRIPDESC.EVAL' NE ' '  THEN  &TRIPDESC
- ELSE 'Trip Purpose';
 
-*========================================================================
-* GET VALUES FROM COMMON1 SEGMENT - DATA FILE: BRPTFLDS.FOC
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.COMMON1.INCL1
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS COMMON1
END
-RUN
-SET &COM1A = 0;
-SET &COM1B = 0;
-SET &COM1C = 0;
-SET &INCL4 = 0;
-SET &INCL5 = 0;
-SET &COM1D = 0;
-SET &COM5 = 0;
-SET &COM6 = 0;
-SET &COM7 = 0;
-SET &COMEMP = 0;

-SET &REG = 0;
 
-IF &LINES EQ 0 THEN GOTO :COMMON2;
-READ COMMON1 &COM1A.A1. &COM1B.A1. &COM1C.A1. &INCL4.1. &INCL5.1. &COM1D.A1. &REG.1. &COM5.A1. &COM6.A1. &COM7.A1. &COMEMP.1.
-CLOSE COMMON1
 
-*REGION,COUNTRY AND STATE
-:COMMON2
TABLE FILE BRPTFLDS
PRINT REGION_CODE COUNTRY_CODE STATE_CODE
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
ON TABLE SAVE AS CNST
END
-RUN
-IF &LINES EQ 0 THEN GOTO ChkLevel1;
 
-SET &LINENO1 = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &LINENO2 = &LINENO1 + 1;
-SET &LINENO3 = &LINENO1 + 2;
 
-SET &FT.&LINENO1 = IF &REG EQ 0 THEN '' ELSE IF &REG EQ 1 THEN '** Geo Region Included: ' ELSE ' ** Geo Region Excluded: ';
-SET &FT.&LINENO2 = IF &INCL4 EQ 0 THEN '' ELSE IF &INCL4 EQ 1 THEN '** Countries Included: ' ELSE '** Countries Excluded: ';
-SET &FT.&LINENO3 = IF &INCL5 EQ 0 THEN '' ELSE IF &INCL5 EQ 1 THEN '** States Included: ' ELSE '** States Excluded: ';
 
-SET &CNT = 1;
-REPEAT ALLstates &LINES TIMES
-READ CNST NOCLOSE &RC.A3. &CC.A3. &SC.A2.
-SET &FT.&LINENO1 = IF &RC NE ' ' AND &CNT EQ 1 THEN &FT.&LINENO1 | '&RC.EVAL'
- ELSE IF &RC NE ' ' THEN &FT.&LINENO1 | ';' | '&RC.EVAL' ELSE &FT.&LINENO1;
 
 
-SET &FT.&LINENO2 = IF &INCL4 EQ 0 THEN ' '
- ELSE IF &CC NE ' ' AND &CNT EQ 1 THEN &FT.&LINENO2 | '&CC.EVAL'
- ELSE IF &CC NE ' ' THEN &FT.&LINENO2 | ';' | '&CC.EVAL' ELSE &FT.&LINENO2 ;
 
-SET &FT.&LINENO3 = IF &INCL5 EQ 0 THEN ' '
- ELSE IF &SC NE ' '  AND &CNT EQ 1  THEN &FT.&LINENO3 | '&SC.EVAL'
- ELSE IF &SC NE ' ' THEN &FT.&LINENO3 | ';' | '&SC.EVAL' ELSE &FT.&LINENO3;
-SET &CNT = &CNT + 1;
-ALLstates
-SET &LINENO = IF &FT.&LINENO3 EQ '' AND &FT.&LINENO2 EQ '' THEN &LINENO1 ELSE IF &FT.&LINENO3 EQ '' THEN &LINENO2 ELSE &LINENO3;
-CLOSE CNST
 
-************
-ChkLevel1
-************
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-IF &COM1A EQ 0 THEN GOTO ChkLevel2;
-SET &FT.&LINENO= IF &COM1A EQ 1 THEN
- '**  &LEVEL1.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1A EQ 2 THEN
- '**  &LEVEL1.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE  IF &COM1A EQ 3 THEN
- '**  &LEVEL1.EVAL Selection Criteria CONTAINS  ** '
- ELSE '**  &LEVEL1.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT ID_LEVEL1
WHERE INST_KEY EQ &&IKEY
WHERE COMMON2.ID_LEVEL1 NE ' '
BY INST_KEY NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &CNT = 0;
-REPEAT A100 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT EQ 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
 
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCREMENT1 ELSE GOTO A100;
-INCREMENT1
-SET &LINENO = &LINENO + 1;
-*****
-A100
-*****
-CLOSE COMMON2
 
-************
-ChkLevel2
-************
-IF &COM1B EQ 0 THEN GOTO ChkLevel3;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-SET &FT.&LINENO= IF &COM1B EQ 1 THEN
- '**  &LEVEL2.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1B EQ 2 THEN
- '**  &LEVEL2.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM1B EQ 3 THEN
- '**  &LEVEL2.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &LEVEL2.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL2
WHERE INST_KEY EQ &&IKEY
WHERE COMMON2.ID_LEVEL2 NE ' '
BY INST_KEY NOPRINT
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &LINENO = &LINENO + 1;
-SET &CNT = 0;
-REPEAT A200 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCREMENT2 ELSE GOTO A200;
-INCREMENT2
-SET &LINENO = &LINENO + 1;
-*****
-A200
-*****
-CLOSE COMMON2
 
-************
-ChkLevel3
-************
-IF &COM1C EQ 0 THEN GOTO ChkLevel4;
-SET &LINENO = &LINENO + 1;
-SET &FT.&LINENO= IF &COM1C EQ 1 THEN
- '**  &LEVEL3.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1C EQ 2 THEN
- '**  &LEVEL3.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM1C EQ 3 THEN
- '**  &LEVEL3.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &LEVEL3.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL3
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL3 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &CNT = 0;
-SET &LINENO = &LINENO + 1;
-REPEAT A300 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCREMENT3 ELSE GOTO A300;
 
-INCREMENT3
-SET &LINENO = &LINENO + 1;
-*****
-A300
-*****
-CLOSE COMMON2
 
-************
-ChkLevel4
-************
-IF &COM1D EQ 0 THEN GOTO ChkLevel5;
-SET &LINENO = &LINENO + 1;
-SET &FT.&LINENO= IF &COM1D EQ 1 THEN
- '**  &LEVEL4.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM1D EQ 2 THEN
- '**  &LEVEL4.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM1D EQ 3 THEN
- '**  &LEVEL4.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &LEVEL4.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL4
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL4 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &CNT = 0;
-SET &LINENO = &LINENO + 1;
-REPEAT A400 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A60.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(62, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(62, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCREMENT4 ELSE GOTO A400;
 
-INCREMENT4
-SET &LINENO = &LINENO + 1;
-*****
-A400
-*****
-CLOSE COMMON2
 
-* LSI 01/27/2012 added id level 5, 6, 7 ********************************
-************
-ChkLevel5
-************
-IF &COM5 EQ 0 THEN GOTO ChkLevel6;
-SET &LINENO = &LINENO + 1;
-SET &FT.&LINENO= IF &COM5 EQ 1 THEN
- '**  &LEVEL5.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM5 EQ 2 THEN
- '**  &LEVEL5.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM5 EQ 3 THEN
- '**  &LEVEL5.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &LEVEL5.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL5
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL5 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &CNT = 0;
-SET &LINENO = &LINENO + 1;
-REPEAT IDLVL500 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A20.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(22, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCIDLVL5 ELSE GOTO IDLVL500;
 
-INCIDLVL5
-SET &LINENO = &LINENO + 1;
-*****
-IDLVL500
-*****
-CLOSE COMMON2
 
-************
-ChkLevel6
-************
-IF &COM6 EQ 0 THEN GOTO ChkLevel7;
-SET &LINENO = &LINENO + 1;
-SET &FT.&LINENO= IF &COM6 EQ 1 THEN
- '**  &LEVEL6.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM6 EQ 2 THEN
- '**  &LEVEL6.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM6 EQ 3 THEN
- '**  &LEVEL6.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &LEVEL6.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL6
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL6 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &CNT = 0;
-SET &LINENO = &LINENO + 1;
-REPEAT IDLVL600 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A20.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(22, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(22, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCIDLVL6 ELSE GOTO IDLVL600;
 
-INCIDLVL6
-SET &LINENO = &LINENO + 1;
-*****
-IDLVL600
-*****
-CLOSE COMMON2
 
-************
-ChkLevel7
-************
-IF &COM7 EQ 0 THEN GOTO ChkEMPID2;
-SET &LINENO = &LINENO + 1;
-SET &FT.&LINENO= IF &COM7 EQ 1 THEN
- '**  &LEVEL7.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COM7 EQ 2 THEN
- '**  &LEVEL7.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COM7 EQ 3 THEN
- '**  &LEVEL7.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &LEVEL7.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.ID_LEVEL7
WHERE INST_KEY EQ &&IKEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL7 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &CNT = 0;
-SET &LINENO = &LINENO + 1;
-REPEAT IDLVL700 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A50.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(52, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(52, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCIDLVL7 ELSE GOTO IDLVL700;
 
-INCIDLVL7
-SET &LINENO = &LINENO + 1;
-*****
-IDLVL700
-*****
-CLOSE COMMON2
 
-* LSI 01/27/2012 added id level 5, 6, 7 ********************************

-*LSI 08/17/2016 ADDED FOR EMP_ID
-************
-ChkEMPID2
-************
-IF &COMEMP EQ 0 THEN GOTO LevSecurity;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-SET &FT.&LINENO= IF &COMEMP EQ 1 THEN
- '**  &EMPID_DESC.EVAL Selection Criteria IS EQUAL TO  **'
- ELSE IF &COMEMP EQ 2 THEN
- '**  &EMPID_DESC.EVAL Selection Criteria IS NOT EQUAL TO  **'
- ELSE IF &COMEMP EQ 3 THEN
- '**  &EMPID_DESC.EVAL Selection Criteria CONTAINS  **'
- ELSE '**  &EMPID_DESC.EVAL Selection Criteria OMITS  ** ';
 
TABLE FILE BRPTFLDS
PRINT COMMON2.EMP_ID
WHERE INST_KEY EQ &&IKEY
WHERE COMMON2.EMP_ID NE ' '
BY INST_KEY NOPRINT
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN
 
-SET &LINENO = &LINENO + 1;
-SET &CNT = 0;
-REPEAT EMP200 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ COMMON2 NOCLOSE &V1.A15.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || '; ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCEMPID2 ELSE GOTO EMP200;
-INCEMPID2
-SET &LINENO = &LINENO + 1;
-*****
-EMP200
-*****
-CLOSE COMMON2
 
-************
-LevSecurity
-************
TABLE FILE USERLEVELSECURITY
PRINT ACCESS_LEVEL ACCESS_VALUE
WHERE USER_NAME EQ '&&UNAME.EVAL';
WHERE CLIENT_ID_ROLLUP EQ '&&ROLLUP.EVAL';
ON TABLE HOLD AS HLEVSEC1 FORMAT ALPHA
END
-RUN
 
-IF &RECORDS EQ 0 GOTO :NOLSEC0;
 
DEFINE FILE HLEVSEC1
LID/A4='LEV' | ACCESS_LEVEL;
END
TABLE FILE  HLEVSEC1
SUM LID
ON TABLE HOLD AS HLEVSEC2 FORMAT ALPHA
END
-RUN
 
-READ HLEVSEC2 &LEVID.4
 
TABLE FILE ROLLUP
PRINT &LEVID
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE HOLD AS HLEVSEC4 FORMAT ALPHA
END
-RUN
 
-READ HLEVSEC4 &LEVDESC.A20.
 
TABLE FILE HLEVSEC1
PRINT ACCESS_VALUE
ON TABLE HOLD AS HLEVSEC3 FORMAT ALPHA
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO='**  Level Security Applied to &LEVDESC.EVAL' || '  **';
-SET &LINENO = &LINENO + 1;
-SET &CNT = 0;
 
-REPEAT A401 &LINES TIMES
-SET &CNT = &CNT + 1;
-READ HLEVSEC3 NOCLOSE &V1.A15.
-SET &Temp1 = '''' || &V1 || '''';
-SET &LEN = ARGLEN(17, &Temp1, 'I2') - 1;
-SET &V1A =
- SUBSTR(17, &Temp1, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &CNT = 1 THEN &V1A
- ELSE &FT.&LINENO || ' or ' | &V1A;
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN
- THEN GOTO INCREMENT5 ELSE GOTO A401;
 
-INCREMENT5
-SET &LINENO = &LINENO + 1;
-*****
-A401
-*****
-CLOSE COMMON2
 
-:NOLSEC0
-*********************
-ChkViewType
-*********************
-IF ((&RPTGRP EQ 'CAR' OR 'CDD' OR &VIEWTYPE EQ 'C') OR (&RPTGRP EQ 'LIM' OR 'LDD' OR &VIEWTYPE EQ 'L')) THEN GOTO CarReport
-  ELSE IF &RPTGRP EQ 'HTL' OR 'HDD' OR &VIEWTYPE EQ 'H' THEN GOTO HtlReport
-    ELSE GOTO AirReport;
 
-**********
-AirReport
-**********
-*========================================================================
-* GET VALUES FROM AIR SEGMENT
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.AIR.ID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS AIR1
END
-RUN
 
-IF &LINES EQ 0 AND  ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO CarReport;
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
 
-*change class category C -> P, D -> E, add D (default) and U (upgrade)
-READ AIR1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &INCL4.1. &INCL5.1. ,
-   &INCL6.1. &INCL7.1. &INCL8.1. &INCL9.1. &INCL10.1. &INCL11.1. &INCL12.1. ,
-   &INTDOMT.1. &INTDOMS.1. &&RANK_LIMIT.5. &RankMeth.1. ,
-   &ClassA.1. &ClassF.1. &ClassB.1. &ClassC.1. &ClassD.1. &ClassDef.1. &ClassUpg.1.,
-   &TransS.1. &TransE.1. &TransR.1. &TransV.1. ,
-   &AdvA.1. &Adv0.1. &Adv7.1. &Adv14.1. &Adv21.1. &&RANK_LIMIT2.5. &CPfld.1. &&AIRFORECAST.3. &INCL13.1.
-CLOSE AIR1
 
-SET &FT.&LINENO = IF &INTDOMT EQ 0 THEN ' '
- ELSE IF &VIEW EQ 'AVIW16' OR &VIEW EQ 'AVIW18' OR &VIEW EQ 'AVIW38' THEN ' '
- ELSE IF &INTDOMT EQ 1 THEN '** Intl/Dom/All Ticket Selection: ALL  **'
- ELSE IF &INTDOMT EQ 2 THEN '** Intl/Dom/All Ticket Selection: DOMESTIC  **'
- ELSE '** Intl/Dom/All Ticket selection: INTERNATIONAL  **';
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO = IF &INTDOMS EQ 0 THEN ' '
- ELSE IF &INTDOMS EQ 1 THEN '** Intl/Dom/All CityPair Selection: ALL  **'
- ELSE IF &INTDOMS EQ 2 THEN '** Intl/Dom/All CityPair Selection: DOMESTIC  **'
- ELSE '** Intl/Dom/All CityPair selection: INTERNATIONAL  **'
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO=IF &ClassA EQ 0 AND &ClassF EQ 0 AND &ClassB EQ 0 AND &ClassC EQ 0
-   AND &ClassD EQ 0 AND &ClassDef EQ 0 AND &ClassUpg EQ 0 THEN ' '
- ELSE '** Class Category Selection(s): ';
-SET &FT.&LINENO = IF &ClassF NE 0 THEN &FT.&LINENO | 'FIRST; '    ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &ClassB NE 0
- THEN &FT.&LINENO | 'BUSINESS; ' ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &ClassC NE 0
- THEN &FT.&LINENO | 'PREMIUM ECONOMY; '    ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &ClassD NE 0
- THEN &FT.&LINENO | 'ECONOMY; ' ELSE &FT.&LINENO;
 
-SET &FT.&LINENO = IF &ClassDef NE 0
- THEN &FT.&LINENO | 'DEFAULT; ' ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &ClassUpg NE 0
- THEN &FT.&LINENO | 'UPGRADE ' ELSE &FT.&LINENO;
 
-SET &FT.&LINENO = IF &ClassA NE 0
- THEN &FT.&LINENO | 'ALL **'
-  ELSE IF &FT.&LINENO NE ' ' THEN &FT.&LINENO | '**' ELSE &FT.&LINENO;
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO=IF &TransS EQ 0 AND &TransE EQ 0 AND &TransR EQ 0 AND &TransV EQ 0
-   THEN ' '
- ELSE '** Transaction Type Selection(s): ';
-SET &FT.&LINENO = IF &TransS NE 0 THEN &FT.&LINENO | 'SALES '     ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &TransE NE 0 THEN &FT.&LINENO | 'EXCHANGES ' ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &TransR NE 0
- THEN &FT.&LINENO | 'REFUNDS '   ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &TransV NE 0
- THEN &FT.&LINENO | 'VOIDS '     ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &FT.&LINENO EQ ' ' THEN ' '
- ELSE &FT.&LINENO | '**';
 
-IF &AdvA EQ 0 AND &Adv0 EQ 0 AND &Adv7 EQ 0 AND &Adv14 EQ 0 AND
-   &Adv21 EQ 0 THEN GOTO chkAirPass;
 
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO = IF &AdvA EQ 0 AND &Adv0 EQ 0 AND &Adv7 EQ 0 AND &Adv14 EQ 0 AND
-   &Adv21 EQ 0 THEN ' '
- ELSE '** Advanced Purchase Selection(s): ';
-SET &FT.&LINENO = IF &Adv0  NE 0 THEN &FT.&LINENO | '0-6 Days '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Adv7  NE 0 THEN &FT.&LINENO | '7-13 Days '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Adv14 NE 0 THEN &FT.&LINENO | '14-20 Days '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Adv21 NE 0 THEN &FT.&LINENO | '21+ Days '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &AdvA  EQ 1 THEN &FT.&LINENO | 'ALL  **'
- ELSE IF &FT.&LINENO NE ' ' THEN
- &FT.&LINENO | '**' ELSE &FT.&LINENO;
 
-*========================================================================
-* GET VALUES FROM AIRFLDS SEGMENT
-*========================================================================
-chkAirPass
-IF &INCL1 EQ 0 THEN GOTO ChkTicket;
-SET &LINENO = IF &FT.&LINENO NE ' ' THEN &LINENO + 1 ELSE &LINENO;
-SET &FT.&LINENO= IF &INCL1 EQ 1 THEN
- '**  Air Travel Passenger Selection Criteria CONTAINS  **'
- ELSE '**  Air Travel Passenger Selection Criteria OMITS  **'
 
-*Get Passengers
TABLE FILE BRPTFLDS
PRINT AIRFLDS.PASSENGER
BY AIRFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
WHERE AIRFLDS.PASSENGER NE ' '
ON TABLE SAVE AS CUSTFILE
END
-RUN
 
-SET &LINENO = &LINENO + 1;
 
-REPEAT A400X &LINES TIMES
-READ CUSTFILE NOCLOSE &V1.A33.
-SET &V1B = '''' || &V1 || '''';
-SET &LEN = ARGLEN(35, &V1B, 'I2') - 1;
-SET &V1A =
- SUBSTR(35, &V1B, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE IF &FT.&LINENO EQ '' THEN &V1A
- ELSE &FT.&LINENO || ';' | &V1A;
 
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN THEN GOTO Increment40 ELSE GOTO A400X;
-Increment40
-SET &LINENO = &LINENO + 1;
-*****
-A400X
-*****
-CLOSE CUSTFILE
 
-**********
-ChkTicket
-**********
-IF &INCL2 EQ 0 THEN GOTO ChkPNRLOC;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-SET &FT.&LINENO= IF &INCL2 EQ 1 THEN
- '**  Ticket Number Selection Criteria CONTAINS  **'
- ELSE '**  Ticket Number Selection Criteria OMITS  **';
 
-*Get Tickets
TABLE FILE BRPTFLDS
PRINT TICKET_NO
WHERE INST_KEY EQ &&IKEY
WHERE TICKET_NO NE ' '
ON TABLE SAVE AS TICKFILE
END
-RUN
 
-SET &CNT = 1;
-SET &LINENO = &LINENO + 1;
-SET &LINENO2 = &LINENO + 1;
 
-REPEAT A410 &LINES TIMES
-READ TICKFILE NOCLOSE &V1.A10.
-SET &V1A = '''' || &V1 || '''';
 
-IF &CNT LE 12 THEN WRITE120 ELSE GOTO WRITE121;
-WRITE120
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO ELSE &FT.&LINENO || ' ' | &V1A;
-GOTO ADDCNTA410;
-WRITE121
-SET &FT.&LINENO2 = IF &V1A EQ ' ' THEN &FT.&LINENO2 ELSE &FT.&LINENO2 || ' ' | &V1A;
-ADDCNTA410
-SET &CNT = &CNT + 1;
-*****
-A410
-*****
-CLOSE TICKFILE
 
 
-**********
-ChkPNRLOC
-**********
-IF &INCL13 EQ 0 THEN GOTO ChkAirCodes;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-SET &FT.&LINENO= IF &INCL13 EQ 1 THEN
- '**  PNR LOCATOR Selection Criteria CONTAINS  **'
- ELSE '** PNR LOCATOR Selection Criteria OMITS  **';
 
-*Get Tickets
TABLE FILE BRPTFLDS
PRINT PNR_LOCATOR
WHERE INST_KEY EQ &&IKEY
WHERE PNR_LOCATOR NE ' '
ON TABLE SAVE AS PNRLFILE
END
-RUN
 
-SET &CNT = 1;
-SET &LINENO = &LINENO + 1;
-SET &LINENO2 = &LINENO + 1;
 
-REPEAT PNRL410 &LINES TIMES
-READ PNRLFILE NOCLOSE &V1.A6.
-SET &V1A = '''' || &V1 || '''';
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO ELSE &FT.&LINENO || ' ' | &V1A;
-PNRL410
-CLOSE PNRLFILE
 
-********
-ChkAirCodes
-********
 
-SET &Temp1 = IF &INCL3 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';
-SET &Temp2 = IF &VIEW EQ 'AVIW56' AND &INCL4 NE 0 THEN 'WHERE CITY_CODE EQ '
-        ELSE IF &INCL4 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';
-SET &Temp3 = IF &INCL5 NE 0 THEN 'WHERE AIRLINE EQ ' ELSE ' ';
-SET &Temp4 = IF &INCL6 NE 0 THEN 'WHERE AIRLINE EQ ' ELSE ' ';
-SET &Temp5 = IF &INCL7 NE 0 THEN 'WHERE REFUSE_CODE EQ ' ELSE ' ';
-SET &Temp6 = IF &INCL9 NE 0 THEN 'WHERE TRP_KEY EQ ' ELSE ' ';
-SET &Temp7 = IF &INCL10 NE 0 THEN 'WHERE NHR_KEY EQ ' ELSE ' ';
-SET &Temp8 = IF &INCL11 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';
-SET &Temp9 = IF &INCL12 NE 0 THEN 'WHERE AIRPORT_CODE EQ ' ELSE ' ';
 
-***********************************************************************************************************
-*INCL8: CP_AIRPORT, which does not need AIRPORT NAME as IT'S CITYPAIR
-***********************************************************************************************************
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL8 EQ 0 THEN ' ' ELSE IF &INCL8 EQ 1 THEN '**  CityPair Airport Code INCLUDED **'
- ELSE '**  CityPair Airport Code EXCLUDED **';
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
TABLE FILE BRPTFLDS
PRINT DPT_AIRPORT RTE_AIRPORT VAL_AIR FLOWN_AIR AIRFLDS.REFUSE_CODE
  CP_AIRPORT TRIP_CODE NHTL_CODE ORG_APC DST_APC
BY AIRFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS AIRCODES
END
-RUN
 
-IF &LINES EQ 0 AND  ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO CarReport;
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &CNT = 1;
-REPEAT AirEnd3 &LINES TIMES
-READ AIRCODES NOCLOSE &V0A.A3. &V1A.A3. &V2A.A3. &V3A.A3. &V4A.A2. &V5A.A6. ,
-, &V6A.A2. &V7A.A2. &V8A.A3. &V9A.A3.
 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &V1= IF &V1A EQ ' ' THEN ' ' ELSE '''' | &V1A || '''';
-SET &V2= IF &V2A EQ ' ' THEN ' ' ELSE '''' | &V2A || '''';
-SET &V3= IF &V3A EQ ' ' THEN ' ' ELSE '''' | &V3A || '''';
-SET &V4= IF &V4A EQ ' ' THEN ' ' ELSE '''' | &V4A || '''';
-SET &V5= IF &V5A EQ ' ' THEN ' ' ELSE '''' | &V5A || '''';
-SET &V6= IF &V6A EQ ' ' THEN ' ' ELSE '''' | &V6A || '''';
-SET &V7= IF &V7A EQ ' ' THEN ' ' ELSE '''' | &V7A || '''';
-SET &V8= IF &V8A EQ ' ' THEN ' ' ELSE '''' | &V8A || '''';
-SET &V9= IF &V9A EQ ' ' THEN ' ' ELSE '''' | &V9A || '''';
 
-SET &Temp1 = IF &V0 EQ ' '  THEN &Temp1
- ELSE IF &CNT EQ 1 THEN &Temp1 | &V0
- ELSE &Temp1 | ' OR ' | &V0;
 
-SET &Temp2 = IF &V1 EQ ' '  THEN &Temp2
- ELSE IF &CNT EQ 1 THEN &Temp2 | &V1
- ELSE &Temp2 | ' OR ' | &V1;
 
-SET &Temp3 = IF &V2 EQ ' '  THEN &Temp3
- ELSE IF &CNT EQ 1 THEN &Temp3 | &V2
- ELSE &Temp3 | ' OR ' | &V2;
 
-SET &Temp4 = IF &V3 EQ ' '  THEN &Temp4
- ELSE IF &CNT EQ 1 THEN &Temp4 | &V3
- ELSE &Temp4 | ' OR ' | &V3;
 
-SET &Temp5 = IF &V4 EQ ' '  THEN &Temp5
- ELSE IF &CNT EQ 1 THEN &Temp5 | &V4
- ELSE &Temp5 | ' OR ' | &V4;
 
-SET &FT.&LINENO = IF &V5 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V5;
 
-SET &PRINTLINE = &FT.&LINENO;
-SET &LINENO = IF &PRINTLINE.LENGTH LT &MAXLEN THEN &LINENO ELSE &LINENO + 1;
 
-SET &Temp6 = IF &V6 EQ ' '  THEN &Temp6
- ELSE IF &CNT EQ 1 THEN &Temp6 | '''' | &&ROLLUP | &V6A | ''''
- ELSE &Temp6 | ' OR ' |  '''' | &&ROLLUP | &V6A | '''';
 
-SET &Temp7 = IF &V7 EQ ' '  THEN &Temp7
- ELSE IF &CNT EQ 1 THEN &Temp7 | '''' | &&ROLLUP | &V7A | ''''
- ELSE &Temp7 | ' OR ' | '''' | &&ROLLUP | &V7A | '''';
 
-SET &Temp8 = IF &V8 EQ ' '  THEN &Temp8
- ELSE IF &CNT EQ 1 THEN &Temp8 | &V8
- ELSE &Temp8 | ' OR ' | &V8;
 
-SET &Temp9 = IF &V9 EQ ' '  THEN &Temp9
- ELSE IF &CNT EQ 1 THEN &Temp9 | &V9
- ELSE &Temp9 | ' OR ' | &V9;
 
-SET &CNT = &CNT + 1;
-AirEnd3
-CLOSE AIRCODES
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-********************************************************************
-* Get Depart Airport Code + name
-********************************************************************
-IF &INCL3 EQ 0 THEN GOTO RTE_AIR;
-SET &FT.&LINENO = IF &INCL3 EQ 1 THEN '**  Depart Airport INCLUDED **'
- ELSE '**  Depart Airport EXCLUDED **';
 
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp1
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO RTE_AIR;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT AirEnd4 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd4;
-SET &LINENO = &LINENO + 1;
-AirEnd4
-CLOSE VCODE
 
-RTE_AIR
-********************************************************************
-* Get Return Airport Code + name
-********************************************************************
-IF &VIEW EQ 'AVIW56' THEN GOTO OVERNIGHT;
-IF &INCL4 EQ 0 THEN GOTO Validating;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO =
- IF &VIEW EQ 'AVIW56' AND &INCL4 EQ 1 THEN '** Overnight City INCLUDED **'
- ELSE IF &VIEW EQ 'AVIW56' AND &INCL4 EQ 2
- THEN '** Overnight City EXCLUDED **'
- ELSE IF &INCL4 EQ 1 THEN '**  Arrival Airport INCLUDED **'
- ELSE '**  Arrival Airport EXCLUDED **';
 
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp2
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO Validating;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT AirEnd5 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd5;
-SET &LINENO = &LINENO + 1;
-AirEnd5
 
-CLOSE VCODE
-GOTO Validating
 
-OVERNIGHT
-IF &INCL4 EQ 0 THEN GOTO Validating;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO =
- IF &VIEW EQ 'AVIW56' AND &INCL4 EQ 1 THEN '** Overnight City INCLUDED **'
- ELSE IF &VIEW EQ 'AVIW56' AND &INCL4 EQ 2
- THEN '** Overnight City EXCLUDED **'
- ELSE IF &INCL4 EQ 1 THEN '**  Arrival Airport INCLUDED **'
- ELSE '**  Arrival Airport EXCLUDED **';
 
DEFINE FILE CITY
  CNAME/A30 = CITY_CODE | '-' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
-*&Temp3
&Temp2
ON TABLE SAVE AS VCODE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT AirEnd5A &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO AirEnd5A;
-SET &LINENO = &LINENO + 1;
 
-AirEnd5A
-CLOSE VCODE
 
-Validating
-********************************************************************
-* Get Validating Airline Code + name
-********************************************************************
-IF &INCL5 EQ 0 THEN GOTO FlownAir;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL5 EQ 1 THEN '**  Validating Airline INCLUDED **'
- ELSE '**  Validating Airline EXCLUDED **';
 
DEFINE FILE AIRLINE
  DESC/A16 = AIRLINE | '-' | AIRLINE_NAME;
END
TABLE FILE AIRLINE
PRINT DESC
BY AIRLINE NOPRINT
&Temp3
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO FlownAir;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT AirEnd6 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A16.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd6;
-SET &LINENO = &LINENO + 1;
-AirEnd6
 
-CLOSE VCODE
 
-FlownAir
-********************************************************************
-* Get Flown Airline Code + name
-********************************************************************
-IF &INCL6 EQ 0 THEN GOTO Air_ref;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL6 EQ 1 THEN '**  Airline Flown INCLUDED **'
- ELSE '**  Airline Flown EXCLUDED **';
 
DEFINE FILE AIRLINE
  DESC/A16 = AIRLINE | '-' | AIRLINE_NAME;
END
TABLE FILE AIRLINE
PRINT DESC
BY AIRLINE NOPRINT
&Temp4
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO Air_ref;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT AirEnd7 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A16.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd7;
-SET &LINENO = &LINENO + 1;
-AirEnd7
 
-CLOSE VCODE
-**************************************************************************
-* Get Air Refuse Code + Description
-* Check Reason table to see if the client uses the standard code or not
-**************************************************************************
-Air_ref
-IF &INCL7 EQ 0 THEN GOTO TripCode;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL7 EQ 1 THEN '**  Reason Code and Description INCLUDED **'
- ELSE '**  Reason Code and Description EXCLUDED **';
 
TABLE FILE AIR_REF
PRINT *
IF REFUSE_KEY CONTAINS '&ROLLUP.EVAL'
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-SET &STANDARD = IF &LINES EQ 0 THEN 'Y' ELSE 'N';
 
DEFINE FILE AIR_REF
  REFUSE_CODE/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
  ROLLUP_CODE/A8 = EDIT(REFUSE_KEY, '99999999$$');
  DESC/A45 = REFUSE_CODE | ' - ' | REFUSAL_DESC;
 
END
TABLE FILE AIR_REF
PRINT DESC
BY REFUSE_KEY NOPRINT
&Temp5
-IF &STANDARD EQ 'Y' THEN GOTO AirStandand;
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
-GOTO DONEair
-AirStandand
WHERE ROLLUP_CODE EQ ' '
-DONEair
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO TripCode;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &CNT = 1;
 
-REPEAT AirEnd8 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A45.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE IF (&CNT/2 - &CNT/2*2) EQ 0 THEN &V1 ELSE &FT.&LINENO || ' ' | &V1;
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO IncACnt8;
-SET &LINENO = &LINENO + 1;
 
-IncACnt8
-SET &CNT = &CNT + 1;
-AirEnd8
-CLOSE VCODE
 
 
-**** 08/24/2004 ****************************************************
-TripCode
-********************************************************************
-* Get Trip Purpose Code + Description
-********************************************************************
-IF &INCL9 EQ 0 THEN GOTO NohtlCode;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL9 EQ 1 THEN '**  ' | &TRIPDESC | ' INCLUDED **'
- ELSE '**  ' | &TRIPDESC | ' EXCLUDED **';
 
DEFINE FILE TRP_REF
  TRP_CODE/A2 = EDIT(TRP_KEY,'$$$$$$$$99');
  DESC/A43 = TRP_CODE | '-' | TRP_DESC;
END
TABLE FILE TRP_REF
PRINT DESC
BY TRP_KEY NOPRINT
&Temp6
ON TABLE SAVE AS VCODE
END
-RUN
-IF &LINES EQ 0 THEN GOTO NohtlCode;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT AirEnd9 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A43.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd9;
-SET &LINENO = &LINENO + 1;
-AirEnd9
-CLOSE VCODE
 
-NohtlCode
-********************************************************************
-* Get No Hotel Reason Code + Description
-********************************************************************
-IF &INCL10 EQ 0 THEN GOTO ORGAPC;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL10 EQ 1 THEN '**  No Hotel Reason Code INCLUDED **'
- ELSE '**  No Hotel Reason Code EXCLUDED **';
 
 
DEFINE FILE NHR_REF
  NHT_CODE/A2 = EDIT(NHR_KEY,'$$$$$$$$99');
  DESC/A43 = NHT_CODE | '-' | NHR_DESC;
END
TABLE FILE NHR_REF
PRINT DESC
BY NHR_KEY NOPRINT
&Temp7
ON TABLE SAVE AS VCODE
END
-RUN
-IF &LINES EQ 0 THEN GOTO ORGAPC;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT AirEnd10 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A43.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd10;
-SET &LINENO = &LINENO + 1;
-AirEnd10
 
-CLOSE VCODE
 
-********************************************************************
-*11/03/2006 origin airport
-* Get Origin Airport Code + name
-********************************************************************
-ORGAPC
-IF &INCL11 EQ 0 THEN GOTO DSTAPC;
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp8
ON TABLE SAVE AS VCODE11
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO =IF &INCL11 EQ 1 THEN '** Origin Airport Included **' ELSE '** Origin Airport Excluded **';
-SET &LINENO = &LINENO + 1;
 
-REPEAT AirEnd11 &LINES TIMES
-READ VCODE11 NOCLOSE &V0A.A30.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd11;
-SET &LINENO = &LINENO + 1;
-AirEnd11
-CLOSE VCODE11
 
-********************************************************************
-* Get Destination Airport Code + name
-********************************************************************
-DSTAPC
-IF &INCL12 EQ 0 AND ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO CarReport;
-IF &INCL12 EQ 0 THEN GOTO WriteFooter;
 
DEFINE FILE AIRPORT
  DESC/A30 = AIRPORT_CODE | '-' | AIRPORT_NAME;
END
TABLE FILE AIRPORT
PRINT DESC
BY AIRPORT_CODE NOPRINT
&Temp9
ON TABLE SAVE AS VCODE12
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO =IF &INCL12 EQ 1 THEN '** Destination Airport Included **' ELSE '** Destination Airport Excluded **';
-SET &LINENO = &LINENO + 1;
 
-REPEAT AirEnd12 &LINES TIMES
-READ VCODE12 NOCLOSE &V0A.A30.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO AirEnd12;
-SET &LINENO = &LINENO + 1;
-AirEnd12
-CLOSE VCODE12
 
-IF '&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL' THEN GOTO CarReport;
-GOTO WriteFooter
-**********
-CarReport
-**********
-*========================================================================
-* GET VALUES FROM CAR SEGMENT
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.CAR.ID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS CAR1
END
-RUN
 
-IF &LINES EQ 0 AND ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO HtlReport;
-IF &LINES EQ 0 THEN GOTO WriteFooter;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-READ CAR1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &INCL4.1. &INCL5.1. &INCL6.1. ,
-     &&RANK_LIMIT.5. &RankMeth.1. &RateAll.1. &Rate1.1. &Rate2.1. ,
-     &Rate3.1. &Rate4.1. &Rate5.1.  &Rate6.1. &INTDOMC.1. &&CARFORECAST.3. &CINCL7.1.
-CLOSE CAR1
 
-SET &FT.&LINENO = IF &RateAll EQ 0 AND &Rate1 EQ 0 AND &Rate2 EQ 0 AND &Rate2 EQ 0
- AND &Rate4 EQ 0 AND &Rate5 EQ 0  AND &Rate6 EQ 0  THEN ' '
- ELSE '** Car Rental Rate Selection(s) ** ';
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &Rate1 NE 0 THEN &FT.&LINENO | '$00.00-19.99 '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Rate2 NE 0 THEN &FT.&LINENO | '$20.00-34.99 '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Rate3 NE 0 THEN &FT.&LINENO | '$35.00-49.99 '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Rate4 NE 0 THEN
- &FT.&LINENO | '$50.00-64.99 '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Rate5 NE 0 THEN
- &FT.&LINENO | '$65.00-79.99 '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &Rate6 NE 0 THEN &FT.&LINENO | '$80.00+ '
- ELSE &FT.&LINENO;
-SET &FT.&LINENO = IF &RateAll NE 0 THEN 'ALL '
- ELSE &FT.&LINENO;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INTDOMC EQ 0 THEN ' '
- ELSE IF &INTDOMC EQ 1 THEN '** Intl/Dom Car Rental Selection: ALL  **'
- ELSE IF &INTDOMC EQ 2 THEN '** Intl/Dom Car Rental Selection: DOMESTIC  **'
- ELSE '** Intl/Dom Car Rental  selection: INTERNATIONAL  **';
 
-*========================================================================
-* GET VALUES FROM CARFLDS SEGMENT
-*========================================================================
-*Get Passengers
-IF &INCL1 EQ 0  THEN GOTO ChkCarCodes;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL1 EQ 1 THEN '**  Car Rental Passenger Selection Criteria CONTAINS  **'
- ELSE '**  Car Rental Passenger Selection Criteria OMITS  **';
TABLE FILE BRPTFLDS
PRINT CARFLDS.PASSENGER
WHERE INST_KEY EQ &&IKEY
WHERE CARFLDS.PASSENGER NE ' '
ON TABLE SAVE AS CUSTFILE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT A500 &LINES TIMES
-READ CUSTFILE NOCLOSE &V1.A33.
 
-SET &V1B = '''' || &V1 || '''';
-SET &LEN = ARGLEN(35, &V1B, 'I2') - 1;
-SET &V1A =
- SUBSTR(35, &V1B, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE &FT.&LINENO || ';' | &V1A;
 
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN THEN GOTO INCREMENT50 ELSE GOTO A500;
-INCREMENT50
-SET &LINENO = &LINENO + 1;
-*****
-A500
-*****
-CLOSE CUSTFILE
 
-****************
-ChkCarCodes
-****************
-SET &Temp1 = IF &INCL2 NE 0 THEN 'WHERE VENDOR_CODE EQ ' ELSE ' ';
-SET &Temp2 = IF &INCL3 NE 0 THEN 'WHERE REFUSE_CODE EQ ' ELSE ' ';
-SET &Temp3 = IF &INCL4 NE 0 THEN 'WHERE CITY_CODE EQ ' ELSE ' ';
-SET &Temp4 = IF &INCL5 NE 0 THEN 'WHERE CITY_CODE EQ ' ELSE ' ';
-SET &Temp5 = IF &INCL6 NE 0 THEN 'WHERE CAR_TYPE EQ ' ELSE ' ';
-SET &Temp6 = IF &CINCL7 NE 0 THEN 'WHERE TRP_KEY EQ ' ELSE ' ';
 
TABLE FILE BRPTFLDS
PRINT VENDOR_CODE CARFLDS.REFUSE_CODE PICKUP_CITY DROPOFF_CITY CAR_TYPE CTRIP_CODE
BY CARFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS CarCODES
END
-RUN
 
-IF &LINES EQ 0 AND ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO HtlReport;
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &CNT = 1;
-REPEAT CarEnd3 &LINES TIMES
-READ CarCODES NOCLOSE &V0A.A2. &V1A.A2. &V2A.A3. &V3A.A3. &V4A.A7. &V5A.A2.
 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &V1= IF &V1A EQ ' ' THEN ' ' ELSE '''' | &V1A || '''';
-SET &V2= IF &V2A EQ ' ' THEN ' ' ELSE '''' | &V2A || '''';
-SET &V3= IF &V3A EQ ' ' THEN ' ' ELSE '''' | &V3A || '''';
-SET &V4= IF &V4A EQ ' ' THEN ' ' ELSE '''' | &V4A || '''';
-SET &V5= IF &V5A EQ ' ' THEN ' ' ELSE '''' | &V5A || '''';
 
-SET &Temp1 = IF &V0 EQ ' '  THEN &Temp1
- ELSE IF &CNT EQ 1 THEN &Temp1 | &V0
- ELSE &Temp1 | ' OR ' | &V0;
 
-SET &Temp2 = IF &V1 EQ ' '  THEN &Temp2
- ELSE IF &CNT EQ 1 THEN &Temp2 | &V1
- ELSE &Temp2 | ' OR ' | &V1;
 
-SET &Temp3 = IF &V2 EQ ' '  THEN &Temp3
- ELSE IF &CNT EQ 1 THEN &Temp3 | &V2
- ELSE &Temp3 | ' OR ' | &V2;
 
-SET &Temp4 = IF &V3 EQ ' '  THEN &Temp4
- ELSE IF &CNT EQ 1 THEN &Temp4 | &V3
- ELSE &Temp4 | ' OR ' | &V3;
 
-SET &Temp5 = IF &V4 EQ ' '  THEN &Temp5
- ELSE IF &CNT EQ 1 THEN &Temp5 | &V4
- ELSE &Temp5 | ' OR ' | &V4;
 
-*Added for car trip code
-SET &Temp6 = IF &V5 EQ ' '  THEN &Temp6
- ELSE IF &CNT EQ 1 THEN &Temp6 | '''' | &&ROLLUP | &V5A | ''''
- ELSE &Temp6 | ' OR ' |  '''' | &&ROLLUP | &V5A | '''';
 
-SET &CNT = &CNT + 1;
-CarEnd3
-CLOSE CarCODES
 
-********************************************************************
-* Get Car Vendor Code + Description
-********************************************************************
-IF &INCL2 EQ 0 THEN GOTO CAR_REF;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL2 EQ 1 THEN '**  Vendor Code and Name INCLUDED **'
- ELSE '**  Vendor Code and Name EXCLUDED **';
 
DEFINE FILE CAR_VEND
  DESC/A15 = VENDOR_CODE | '-' | VENDOR_NAME;
END
TABLE FILE CAR_VEND
PRINT DESC
BY VENDOR_CODE NOPRINT
&Temp1
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO CAR_REF;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT CarEnd4 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A15.
 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO CarEnd4;
-SET &LINENO = &LINENO + 1;
-CarEnd4
-CLOSE VCODE
-**************************************************************************
-* Get Car Refuse Code + Description
-* Check Reason table to see if the client uses the standard code or not
-**************************************************************************
-CAR_REF
-IF &INCL3 EQ 0 THEN GOTO PickUpCity;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL3 EQ 1 THEN '**  Reason Code and Description INCLUDED **'
- ELSE '**  Reason Code and Description EXCLUDED **';
 
TABLE FILE CAR_REF
PRINT *
IF REFUSE_KEY CONTAINS '&ROLLUP.EVAL'
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-SET &STANDARD = IF &LINES EQ 0 THEN 'Y' ELSE 'N';
 
DEFINE FILE CAR_REF
  REFUSE_CODE/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
  ROLLUP_CODE/A8 = EDIT(REFUSE_KEY, '99999999$$');
  DESC/A45 = REFUSE_CODE | ' - ' | REFUSAL_DESC;
 
END
TABLE FILE CAR_REF
PRINT DESC
BY REFUSE_KEY NOPRINT
&Temp2
-IF &STANDARD EQ 'Y' THEN GOTO CarStandand;
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
-GOTO DONEROLL
-CarStandand
WHERE ROLLUP_CODE EQ ' '
-DONEROLL
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO PickUpCity;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &CNT = 1;
-REPEAT CarEnd5 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A45.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE IF (&CNT/2 - &CNT/2*2) EQ 0 THEN &V1 ELSE &FT.&LINENO || ' ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO IncCCnt5;
-SET &LINENO = &LINENO + 1;
 
-IncCCnt5
-SET &CNT = &CNT + 1;
-CarEnd5
-CLOSE VCODE
 
-PickUpCity
-IF &INCL4 EQ 0 THEN GOTO DropOffCity;
 
-IF &INCL4 EQ 0 THEN GOTO A540;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL4 EQ 1 THEN '**  PickUp City Code and Name INCLUDED **'
- ELSE '**  PickUp City Code and Name EXCLUDED **';
 
DEFINE FILE CITY
  CNAME/A30 = CITY_CODE | '-' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
&Temp3
ON TABLE SAVE AS VCODE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT CarEnd6 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO CarEnd6;
-SET &LINENO = &LINENO + 1;
 
-CarEnd6
-CLOSE VCODE
 
-DropOffCity
-IF &INCL5 EQ 0 THEN GOTO CarType;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL5 EQ 1 THEN '**  Drop off City Code and Name INCLUDED **'
- ELSE '**  Drop off City Code and Name EXCLUDED **';
 
DEFINE FILE CITY
  CNAME/A30 = CITY_CODE | '-' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
&Temp4
ON TABLE SAVE AS VCODE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT CarEnd7 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A30.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT 80 THEN GOTO CarEnd7;
-SET &LINENO = &LINENO + 1;
-CarEnd7
-CLOSE VCODE
 
-CarType
-IF &INCL6 EQ 0 THEN GOTO CarTripCode;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL6 EQ 1
-   THEN '**  Car Type Code and Description INCLUDED **'
- ELSE '**  Car Type Code and Description EXCLUDED **';
 
 
DEFINE FILE CAR_TYPE
  CAR_INFO/A40 = CAR_TYPE | ' - ' | CAR_DESC;
END
TABLE FILE CAR_TYPE
PRINT CAR_INFO
BY CAR_TYPE NOPRINT
&Temp5
ON TABLE SAVE AS VCODE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT CarEnd8 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A40.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO | '  ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO CarEnd8;
-SET &LINENO = &LINENO + 1;
-CarEnd8
-CLOSE VCODE
 
-**** 01/16/2013 ****************************************************
-CarTripCode
-********************************************************************
-* Get Trip Purpose Code + Description
-********************************************************************
-IF &CINCL7 EQ 0 AND ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO HtlReport;
-IF &CINCL7 EQ 0 THEN GOTO WriteFooter;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &CINCL7 EQ 1 THEN '**  ' | &TRIPDESC | ' INCLUDED **'
- ELSE '**  ' | &TRIPDESC | ' EXCLUDED **';
 
DEFINE FILE TRP_REF
  TRP_CODE/A2 = EDIT(TRP_KEY,'$$$$$$$$99');
  DESC/A43 = TRP_CODE | '-' | TRP_DESC;
END
TABLE FILE TRP_REF
PRINT DESC
BY TRP_KEY NOPRINT
&Temp6
ON TABLE SAVE AS VCODE
END
-RUN
-IF &LINES EQ 0 THEN GOTO DoneWithCar;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT CarEnd7 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A43.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO CarEnd7;
-SET &LINENO = &LINENO + 1;
-CarEnd7
-CLOSE VCODE
 
-DoneWithCar
-IF '&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL' THEN GOTO HtlReport;
-GOTO WriteFooter
-**********
-HtlReport
-**********
-*========================================================================
-* GET VALUES FROM HTL SEGMENT
-*========================================================================
TABLE FILE BRPTFLDS
PRINT SEG.HTL.ID
BY INST_KEY NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS HTL1
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-READ HTL1 &ID.1. &INCL1.1. &INCL2.1. &INCL3.1. &INCL4.1. ,
-     &&RANK_LIMIT.5. &RankMeth.1. &&RANK_LIMIT2.5. &INTDOMH.1. &&HTLFORECAST.3. &HINCL5.1.
-CLOSE HTL1
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INTDOMH EQ 0 THEN ' '
- ELSE IF &INTDOMH EQ 1 THEN '** Intl/Dom Hotel Selection: ALL  **'
- ELSE IF &INTDOMH EQ 2 THEN '** Intl/Dom Hotel Selection: DOMESTIC  **'
- ELSE '** Intl/Dom Hotel selection: INTERNATIONAL  **';
 
-*========================================================================
-* GET VALUES FROM HTLFLDS SEGMENT
-*========================================================================
-*Get Passengers
-IF &INCL1 EQ 0  THEN GOTO ChkHtlCodes;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO= IF &INCL1 EQ 1 THEN '**  Hotel Passenger Selection Criteria CONTAINS  **'
- ELSE '**  Hotel Passenger Selection Criteria OMITS  **';
TABLE FILE BRPTFLDS
PRINT HTLFLDS.PASSENGER
WHERE INST_KEY EQ &&IKEY
WHERE HTLFLDS.PASSENGER NE ' '
ON TABLE SAVE AS CUSTFILE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT A600 &LINES TIMES
-READ CUSTFILE NOCLOSE &V1.A33.
-SET &V1B = '''' || &V1 || '''';
-SET &LEN = ARGLEN(35, &V1B, 'I2') - 1;
-SET &V1A =
- SUBSTR(35, &V1B, 2, &LEN, &LEN, 'A&LEN.EVAL');
 
-SET &FT.&LINENO = IF &V1A EQ ' ' THEN &FT.&LINENO
- ELSE &FT.&LINENO || ';' | &V1A;
 
-SET &TEMPLINE = &FT.&LINENO;
-IF &TEMPLINE.LENGTH GT &MAXLEN THEN GOTO Increment60 ELSE GOTO A600;
 
-Increment60
-SET &LINENO = &LINENO + 1;
-*****
-A600
-*****
-CLOSE CUSTFILE
 
-************
-ChkHtlCodes
-************
-SET &Temp1 = IF &INCL2 NE 0 THEN 'WHERE CHAIN_CODE EQ ' ELSE ' ';
-SET &Temp2 = IF &INCL3 NE 0 THEN 'WHERE CITY_CODE EQ ' ELSE ' ';
-SET &Temp3 = IF &INCL4 NE 0 THEN 'WHERE REFUSE_CODE EQ ' ELSE ' ';
-SET &Temp4 = IF &HINCL5 NE 0 THEN 'WHERE TRP_KEY EQ ' ELSE ' ';
 
TABLE FILE BRPTFLDS
PRINT CHAIN_CODE HTL_CITY HTLFLDS.REFUSE_CODE HTRIP_CODE
BY HTLFLDS.SEQ_NO NOPRINT
WHERE INST_KEY EQ &&IKEY
ON TABLE SAVE AS HtlCODES
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &CNT = 1;
-REPEAT HtlEnd3 &LINES TIMES
-READ HtlCODES NOCLOSE &V0A.A2. &V1A.A3. &V2A.A2. &V3A.A2.
 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &V1= IF &V1A EQ ' ' THEN ' ' ELSE '''' | &V1A || '''';
-SET &V2= IF &V2A EQ ' ' THEN ' ' ELSE '''' | &V2A || '''';
-SET &V3= IF &V3A EQ ' ' THEN ' ' ELSE '''' | &V3A || '''';
 
-SET &Temp1 = IF &V0 EQ ' '  THEN &Temp1
- ELSE IF &CNT EQ 1 THEN &Temp1 | &V0
- ELSE &Temp1 | ' OR ' | &V0;
 
-SET &Temp2 = IF &V1 EQ ' '  THEN &Temp2
- ELSE IF &CNT EQ 1 THEN &Temp2 | &V1
- ELSE &Temp2 | ' OR ' | &V1;
 
-SET &Temp3 = IF &V2 EQ ' '  THEN &Temp3
- ELSE IF &CNT EQ 1 THEN &Temp3 | &V2
- ELSE &Temp3 | ' OR ' | &V2;
 
-*Added for htl trip code
-SET &Temp4 = IF &V3 EQ ' '  THEN &Temp4
- ELSE IF &CNT EQ 1 THEN &Temp4 | '''' | &&ROLLUP | &V3A | ''''
- ELSE &Temp4 | ' OR ' |  '''' | &&ROLLUP | &V3A | '''';
 
-SET &CNT = &CNT + 1;
-HtlEnd3
-CLOSE HtlCODES
 
-********************************************************************
-* Get HTL CHAIN Code + name
-********************************************************************
-IF &INCL2 EQ 0 THEN GOTO HTL_CITY;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL2 EQ 1 THEN '**  Hotel Chain Code and Name INCLUDED **'
- ELSE '**  Hotel Chain Code and Name EXCLUDED **';
 
DEFINE FILE HOTL_CHN
  DESC/A35 = CHAIN_CODE | ' - ' | CHAIN_NAME;
END
TABLE FILE HOTL_CHN
PRINT DESC
BY CHAIN_CODE NOPRINT
&Temp1
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO HTL_CITY;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT HtlEnd4 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A35.
 
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO HtlEnd4;
-SET &LINENO = &LINENO + 1;
-HtlEnd4
-CLOSE VCODE
 
-HTL_CITY
-********************************************************************
-* Get HTL City Code + name
-********************************************************************
-IF &INCL3 EQ 0 THEN GOTO HTL_REF;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL3 EQ 1 THEN '**  Hotel City Code and Name INCLUDED **'
- ELSE '**  Hotel City Code and Name EXCLUDED **';
 
DEFINE FILE CITY
  CNAME/A32 = CITY_CODE | ' - ' | CITY_NAME;
END
TABLE FILE CITY
PRINT CNAME
BY CITY_CODE NOPRINT
&Temp2
ON TABLE SAVE AS VCODE
END
-RUN
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
 
-REPEAT HtlEnd5 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A32.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO HtlEnd5;
-SET &LINENO = &LINENO + 1;
 
-HtlEnd5
-CLOSE VCODE
 
-HTL_REF
-**************************************************************************
-* Get HTL_REF Code + Description
-* Check Reason table to see if the client uses the standard code or not
-**************************************************************************
-IF &INCL4 EQ 0 THEN GOTO HtlTripCode;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &INCL4 EQ 1 THEN '**  Reason Code and Description INCLUDED **'
- ELSE '**  Reason Code and Description EXCLUDED **';
 
TABLE FILE HTL_REF
PRINT *
IF REFUSE_KEY CONTAINS '&ROLLUP.EVAL'
IF RECORDLIMIT EQ 1
ON TABLE SAVE
END
-RUN
-SET &STANDARD = IF &LINES EQ 0 THEN 'Y' ELSE 'N';
 
DEFINE FILE HTL_REF
  REFUSE_CODE/A2 = EDIT(REFUSE_KEY, '$$$$$$$$99');
  ROLLUP_CODE/A8 = EDIT(REFUSE_KEY, '99999999$$');
  DESC/A45 = REFUSE_CODE | ' - ' | REFUSAL_DESC;
 
END
TABLE FILE HTL_REF
PRINT DESC
BY REFUSE_KEY NOPRINT
&Temp3
-IF &STANDARD EQ 'Y' THEN GOTO HtlStandand;
WHERE ROLLUP_CODE EQ '&ROLLUP.EVAL'
-GOTO DONEHtl
-HtlStandand
WHERE ROLLUP_CODE EQ ' '
-DONEHtl
ON TABLE SAVE AS VCODE
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO WriteFooter;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &CNT = 1;
 
-REPEAT HtlEnd6 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A45.
 
-SET &V1= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
 
-SET &FT.&LINENO = IF &V1 EQ ' '  THEN &FT.&LINENO
- ELSE IF (&CNT/2 - &CNT/2*2) EQ 0 THEN &V1 ELSE &FT.&LINENO || ' ' | &V1;
-*- ELSE IF IMOD(&CNT/2)      EQ 0 THEN &V1 ELSE &FT.&LINENO || ' ' | &V1;
 
-SET &LINE = &FT.&LINENO;
-IF &LINE.LENGTH LT &MAXLEN THEN GOTO IncHCnt6;
-SET &LINENO = &LINENO + 1;
 
-IncHCnt6
-SET &CNT = &CNT + 1;
-HtlEnd6
-CLOSE VCODE
 
 
 
-**** 01/16/2013 ****************************************************
-HtlTripCode
-********************************************************************
-* Get Trip Purpose Code + Description
-********************************************************************
-*-IF &HINCL5 EQ 0 AND ('&&STREAM.EVAL' EQ 'TKT_ACH' OR &&SETFILE EQ 'MX_CADD' OR &&SETFILE EQ 'ABPAXTVL') THEN GOTO DoneWithHtl;
-IF &HINCL5 EQ 0 THEN GOTO WriteFooter;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &HINCL5 EQ 1 THEN '**  ' | &TRIPDESC | ' INCLUDED **'
- ELSE '**  ' | &TRIPDESC | ' EXCLUDED **';
 
DEFINE FILE TRP_REF
  TRP_CODE/A2 = EDIT(TRP_KEY,'$$$$$$$$99');
  DESC/A43 = TRP_CODE | '-' | TRP_DESC;
END
TABLE FILE TRP_REF
PRINT DESC
BY TRP_KEY NOPRINT
&Temp4
ON TABLE SAVE AS VCODE
END
-RUN
-IF &LINES EQ 0 THEN GOTO DoneWithHtl;
 
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-REPEAT HtlEnd7 &LINES TIMES
-READ VCODE NOCLOSE &V0A.A43.
-SET &V0= IF &V0A EQ ' ' THEN ' ' ELSE '''' | &V0A || '''';
-SET &FT.&LINENO = IF &V0 EQ ' '  THEN &FT.&LINENO
- ELSE &FT.&LINENO || ' ' | &V0;
-SET &PRINTLINE = &FT.&LINENO;
-IF &PRINTLINE.LENGTH LT &MAXLEN THEN GOTO HtlEnd7;
-SET &LINENO = &LINENO + 1;
-HtlEnd7
-CLOSE VCODE
 
-DoneWithHtl
 
-**********************************************************************
-WriteFooter
-**********************************************************************
-IF &&SETFILE NE 'MX_CADD' THEN GOTO NoForeCast;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = '** Forecast % - Air: &&AIRFORECAST.EVAL ; Car: &&CARFORECAST.EVAL ; Hotel:  &&HTLFORECAST.EVAL **';
-NoForeCast
 
-IF '&SLTMEM.EVAL' EQ '' THEN GOTO NoSLTMem;
-SET &TEMPLINE = '** SLT Member Selection: ' | '&SLTMEM.EVAL' || ' **';
-SET &FT.&LINENO = &TEMPLINE;
-SET &LINENO = &LINENO + 1;
-NoSLTMem
 
TABLE FILE ROLLSET_MASTER
PRINT DESC3 DESC4
WHERE GLOBAL_PARM EQ '&&SETF.EVAL' AND (DESC3 NE '' OR DESC4 NE '')
ON TABLE SAVE AS SAVEFTER
END
-RUN
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-SET &FT.&LINENO = IF &LINES EQ 0 THEN ' ' ELSE '** Additional Selection Criteria in The Report Program **';
 
-IF &LINES EQ 0 THEN GOTO :WritFooter;
-SET &LINENO = IF &FT.&LINENO EQ ' ' THEN &LINENO ELSE &LINENO + 1;
-READ SAVEFTER &DESC3.120. &DESC4.120.
-CLOSE SAVEFTER;
-SET &FT.&LINENO = IF '&DESC3.EVAL' EQ ' ' THEN '&DESC4.EVAL' ELSE '&DESC3.EVAL';
-SET &LINENO = &LINENO + 1;
-SET &FT.&LINENO = IF '&DESC3.EVAL' EQ ' ' THEN '' ELSE '&DESC4.EVAL';
 
-:WritFooter
 
-SET &FTLINES = &FOOTLINES;
-IF &&STREAM EQ 'QTR_REV' GOTO QREV;
-WRITE SBFOOT "</6"
-GOTO NOQRV;
-QREV;
-WRITE SBFOOT "</4"
-NOQRV
-WRITE SBFOOT "** THIS REPORT IS BASED ON THE FOLLOWING SELECTION CRITERIA **"
-WRITE SBFOOT "================================================================"
-SET &FOOTLINES=&FOOTLINES - 7;
-*-SET &NBRLINES = &FOOTLINES;
-SET &NBRLINES=&TOTALLINES - 7;
 
-SET &CNT = &STARTNO;
-REPEAT TOFOOT1 &NBRLINES TIMES
-IF &FT.&CNT EQ ' ' GOTO AddOne;
-SET &LINE = &FT.&CNT;
 
-SET &FIRSTTWO = SUBSTR(&LINE.LENGTH, &LINE, 1, 2, 2, 'A2');
-IF &FIRSTTWO NE '**' THEN GOTO WRLINE1;
-WRITE SBFOOT " "
-WRLINE1
-WRITE SBFOOT "&LINE"
-SET &FOOTLINES=&FOOTLINES - 1;
-AddOne
-SET &CNT = &CNT + 1;
-TOFOOT1
-ENDREPEAT1
 
-SET &FOOTLINES = IF &FOOTLINES LT 0 THEN 0 ELSE &FOOTLINES;
-WRITE SBFOOT "</&FOOTLINES.EVAL"
-SET &SPOTNUM=IF &&USEPARM.EVAL EQ 'AVIEW3' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'UAVIW3' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'AVIW74' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'AVIW90' THEN 52 ELSE
- IF &&USEPARM.EVAL EQ 'AVIW53' THEN 52 ELSE
- IF &&STREAM EQ 'TC_TRAN2' OR 'TCTRVLS' THEN 52 ELSE
- IF &&STREAM EQ 'TC_TRAN1' THEN 52 ELSE
- IF &&STREAM EQ 'HTL_PREF' THEN 52 ELSE
- IF &&STREAM EQ 'SUMHIER'  THEN 52 ELSE
- IF &&STREAM EQ 'TVLSV_SM' OR 'QTR_REV' THEN 52 ELSE
- IF &&STREAM EQ 'MXCAPRPT' THEN 52 ELSE
- IF &&STREAM EQ 'TBR_MAIN' THEN 52 ELSE 64;
- IF &&STREAM EQ 'TBR_MAIN' OR 'NWCAPRPT' OR 'TKCAPRPT' THEN GOTO TBR;
-WRITE SBFOOT "<&SPOTNUM.EVAL &&FOOTR"
-* -WRITE SBFOOT "eTTek Review &DATE AT <NOWTOD  <&SPOTNUM.EVAL &&FOOTR"
-* -WRITE SBFOOT "&&CRIGHT.EVAL"
-TBR
 
-GOTO :SD2DONE;
 
-:SD2AVRP
 
-WRITE SBFOOT NOCLOSE "</7"
-WRITE SBFOOT NOCLOSE "** THIS REPORT (&&FOOTR) IS BASED ON THE FOLLOWING SELECTION CRITERIA **"
-WRITE SBFOOT NOCLOSE "==========================================================================="
-WRITE SBFOOT NOCLOSE -INCLUDE SBFOOTHIER.FEX
-WRITE SBFOOT NOCLOSE -INCLUDE SBFOOTALL.FEX
-*-WRITE SBFOOT NOCLOSE -INCLUDE SBFOOTA.FEX
-*-WRITE SBFOOT NOCLOSE -INCLUDE SBFOOTH.FEX
-*-WRITE SBFOOT NOCLOSE -INCLUDE SBFOOTC.FEX
-WRITE SBFOOT NOCLOSE -INCLUDE SBFOOTR.FEX
-RUN
 
 
TABLE FILE ROLLSET_MASTER
PRINT DESC3 DESC4
WHERE GLOBAL_PARM EQ '&&SETF.EVAL' AND (DESC3 NE '' OR DESC4 NE '')
ON TABLE SET HNODATA ''
ON TABLE SAVE AS SAVEFTER
END
-RUN
-IF &LINES EQ 0 THEN GOTO :SD2DONE;
-WRITE SBFOOT NOCLOSE "</2"
-WRITE SBFOOT NOCLOSE "** Additional Selection Criteria in The Report Program **"
-READ SAVEFTER &DESC3.120. &DESC4.120.
-RUN
-IF &DESC3 EQ '' GOTO :CHK4;
-WRITE SBFOOT NOCLOSE "&DESC3.EVAL"
-:CHK4
-IF &DESC4 EQ '' GOTO :SD2DONE;
-WRITE SBFOOT NOCLOSE "&DESC4.EVAL"
 
 
-:SD2DONE
 
-CLOSE SBFOOT
 
-TYPE ENDING SELDESC2
-TYPE &&USEPARM
 
-IF &&UNAME NE 'lusheng' THEN GOTO CHKFTPAGE;
 
-*-QUIT
 
-CHKFTPAGE
