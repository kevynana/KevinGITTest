-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* This program extracts data for the Airline Segment Analysis
-********************************************************************
-* MODIFICATIONS
-* ADDED TRANTYPE INCLUDE - JK 12/15/14 STORY ID S-06492

-********************************************************************

SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
-* CLASS_CAT/A8 = DECODE CL_CAT ('F' 'FIRST'     'C' 'COACH'   
-*                               'D' 'DISCOUNT'  'B' 'BUSINESS'
-*                               ' ' 'OTHER');

CLASS_CAT/A15 = DECODE CL_CAT ('F' 'FIRST'     'P' 'PREMIUM ECONOMY'   
			       'D' 'DEFAULT'   'B' 'BUSINESS'
			       'E' 'ECONOMY'   'U'  'UPGRADE' 
                               ' ' 'DEFAULT'); 

CLS_CAT/A15 = IF TKT_MAIN.ADIR_ALL CONTAINS 'U' THEN 'UPGRADE'
             IF TKT_MAIN.ADIR_ALL CONTAINS 'F' THEN 'FIRST' ELSE
             IF TKT_MAIN.ADIR_ALL CONTAINS 'P' THEN 'PREMIUM ECONOMY' ELSE
             IF TKT_MAIN.ADIR_ALL CONTAINS 'B' THEN 'BUSINESS' ELSE
             IF TKT_MAIN.ADIR_ALL CONTAINS 'E' THEN 'ECONOMY' ELSE 'DEFAULT';
             
FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
LEVEL_DESC/A60 = &&LDESC;

GEO1/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO2/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO3/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO4/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO5/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO6/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO7/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO8/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO9/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO10/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
GEO11/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$$$$$');
GEO12/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$$$$$');
GEO13/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$$$$$');
GEO14/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$$$$$');
GEO15/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$$$$$');
GEO16/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999$$$$');
GEO17/A3 =  EDIT(TKT_MAIN.GEO_ZONE, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$999');

MRK_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                          (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                           (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' '; 
XDPT_DT/MDYY         = DPT_DATE;
XPSNGR_NM/A15        = 
  EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
XTRAN_DT/MDYY        = TRN_DATE;
-* DEFINES ON PREVIOUS DEFINES
GEO_FLAG/A1 = IF (GEO1 EQ 'USA' OR 'EUR') AND 
  (GEO2 EQ 'USA' OR 'EUR' OR ' ') AND 
  (GEO3 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO4 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO5 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO6 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO7 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO8 EQ 'USA' OR 'EUR' OR ' ') AND 
  (GEO9 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO10 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO11 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO12 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO13 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO14 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO15 EQ 'USA' OR 'EUR' OR ' ') AND
  (GEO16 EQ 'USA' OR 'EUR' OR ' ') AND 
  (GEO17 EQ 'USA' OR 'EUR' OR ' ') THEN 'Y' ELSE 'N';

GEO_1/A6=GEO1||GEO2;
GEO_2/A6=GEO2||GEO3;
GEO_3/A6=GEO3||GEO4;
GEO_4/A6=GEO4||GEO5;
GEO_5/A6=GEO5||GEO6;

-INCLUDE TRANTYPE

END

TABLEF FILE &&EXTRACT
PRINT
  CITYPAIR.INTL_DOM AS 'INTDOM'
  CLASS
  CLASS_CAT
  CLS_CAT
  DPT_TIME
  DPT_DATE
  EMB_APT.AIRPORT_NAME AS 'EMB_APT_NM'	
  FARE_PAID
  GEO_1
  GEO_2
  GEO_3
  GEO_4
  GEO_5
  LEVEL_DESC
  NET_TKT_CNT
  RTE_APT.AIRPORT_NAME AS 'RTE_APT_NM'	
  SEG_NBR
  TKT_NUM	
  TKT_SORT
  TKT_TYPE	
  TRN_DATE	
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT	
  
-INCLUDE &AIRDATES

WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

ON TABLE HOLD AS &&RPT_HOLD

END
-RUN

-GOTO XXIT


TABLE FILE &&RPT_HOLD
PRINT GEO_1 GEO_2 GEO_3 GEO_4 GEO_5 
BY LEVEL_DESC
BY CLASS_CAT
BY CLS_CAT
BY SEG_NBR 
WHERE INTDOM EQ 'I'
ON TABLE HOLD AS JOYHOLD
END
-RUN


DEFINE FILE JOYHOLD
GEOL1/A15 = IF GEO_1 EQ 'USAEUR' OR 'EURUSA' THEN CLASS_CAT||SEG_NBR ELSE 
           IF GEO_2 EQ 'USAEUR' OR 'EURUSA' THEN CLASS_CAT||SEG_NBR ELSE
           IF GEO_3 EQ 'USAEUR' OR 'EURUSA' THEN CLASS_CAT||SEG_NBR ELSE
           IF GEO_4 EQ 'USAEUR' OR 'EURUSA' THEN CLASS_CAT||SEG_NBR ELSE
           IF GEO_5 EQ 'USAEUR' OR 'EURUSA' THEN CLASS_CAT||SEG_NBR ELSE ' ';
END


TABLE FILE JOYHOLD
SUM GEOL1
BY LEVEL_DESC
BY SEG_NBR
END
ON TABLE HOLD AS JOYHOLD1
END
-RUN




-XXIT



