-INCLUDE SETECHO
SET ASNAMES = ON


FILEDEF CCA_LVL DISK D:\AS400\CCA_LVL.TXT

TABLE FILE CCA_LVL
PRINT NEW_LEV1 NEW_LEV2 NEW_LEV3 NEW_LEV4 NEW_LEV5 NEW_LEV6 NEW_LEV7 NEW_LEV8
BY NW_LV1
ON TABLE HOLD AS FIXCCA
END
-RUN
 
JOIN AIR_KEY IN SYCCA TO ALL AIR_KEY IN AYCCA AS J1
DEFINE FILE SYCCA
NEWLEV/A15 = IF ICODEX OMITS '.' THEN GETTOK(ICODEX, 36, -1, '.', 15, NEWLEV) ELSE GETTOK(ICODEX, 36, -2, '.', 15, NEWLEV);
END
TABLE FILE SYCCA
PRINT ICODEX AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY NEWLEV
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS DEBHOLD
END
-RUN


JOIN CLEAR *
-RUN

JOIN NEWLEV IN DEBHOLD TO NW_LV1 IN FIXCCA AS J2

TABLE FILE DEBHOLD
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
      NW_LV1 AS 'LEVEL1' NEW_LEV1 AS 'AROLL_LEV1' NEW_LEV2 AS 'AROLL_LEV2' NEW_LEV3 AS 'AROLL_LEV3' NEW_LEV4 AS 'AROLL_LEV4'
      NEW_LEV5 AS 'AROLL_LEV5' NEW_LEV6 AS 'AROLL_LEV6' NEW_LEV7 AS 'AROLL_LEV7' NEW_LEV8 AS 'AROLL_LEV8'       
BY NEWLEV  
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS DEBHOLD2
END
-RUN

TABLE FILE DEBHOLD2
PRINT AIR_KEY LEVEL1
BY AIR_KEY NOPRINT
ON TABLE HOLD AS FIXAIR
END
-RUN

TABLE FILE DEBHOLD2
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR AROLL_LEV1 AROLL_LEV2 AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 AROLL_LEV6 AROLL_LEV7 AROLL_LEV8
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXSEG
END
-RUN

MODIFY FILE AYCCA
FIXFORM FROM FIXAIR
MATCH AIR_KEY
ON MATCH UPDATE LEVEL1
ON NOMATCH REJECT
DATA ON FIXAIR
END
-RUN

MODIFY FILE SYCCA
FIXFORM FROM FIXSEG
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV1 
ON MATCH UPDATE AROLL_LEV2
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_LEV6
ON MATCH UPDATE AROLL_LEV7
ON MATCH UPDATE AROLL_LEV8
ON NOMATCH REJECT
DATA ON FIXSEG
END
-RUN
-QUIT


DEFINE FILE AYCCA
NEW_LV1/A15 = GETTOK(LEVEL1, 15, -2, '.', 15, NW_LV1);
END
TABLE FILE AYCCA
PRINT NEW_LV1 
BY AIR_KEY
ON TABLE HOLD
END
-RUN


-QUIT

FILEDEF KIEW_LVL DISK D:\AS400\KIEW_LVL.TXT

TABLE FILE KIEW_LVL
PRINT NW_LVL1
BY LEVEL1
ON TABLE HOLD AS FIXLV1
END
-RUN

 
-*-GOTO AIR;

JOIN AIR_KEY IN SZKIEW TO ALL AIR_KEY IN AZKIEW AS J1
TABLE FILE SZKIEW
PRINT LEVEL1 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL1 NOPRINT
ON TABLE HOLD AS DEBHOLD
END
-RUN



JOIN CLEAR *
-RUN

JOIN LEVEL1 IN FIXLV1 TO ALL LEVEL1 IN DEBHOLD AS J1
TABLE FILE FIXLV1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NW_LVL1 AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXSEG
END
-RUN

JOIN CLEAR *
-RUN

 
JOIN AIR_KEY IN SZKIEW TO ALL AIR_KEY IN AZKIEW AS J1
TABLE FILE SZKIEW
PRINT AROLL_LEV4 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY AROLL_LEV4 NOPRINT
ON TABLE HOLD AS DEBHOLD2
END
-RUN

JOIN CLEAR *
-RUN

JOIN LEVEL1 IN FIXLV1 TO ALL AROLL_LEV4 IN DEBHOLD2 AS J1
TABLE FILE FIXLV1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NW_LVL1 AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXSEG2
END
-RUN


JOIN CLEAR *
-RUN


MODIFY FILE SZKIEW
FIXFORM FROM FIXSEG
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXSEG
END
-RUN


MODIFY FILE SZKIEW
FIXFORM FROM FIXSEG2
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXSEG2
END
-RUN

  
-* Market
JOIN AIR_KEY IN MZKIEW TO ALL AIR_KEY IN AZKIEW AS J1
TABLE FILE MZKIEW
PRINT LEVEL1 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL1 NOPRINT
ON TABLE HOLD AS DEBHOLDM
END
-RUN

JOIN CLEAR *
-RUN

JOIN AIR_KEY IN MZKIEW TO ALL AIR_KEY IN AZKIEW AS J1
TABLE FILE MZKIEW
PRINT AROLL_LEV4 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY AROLL_LEV4 NOPRINT
ON TABLE HOLD AS DEBHOLDM2
END
-RUN

JOIN CLEAR *
-RUN


JOIN LEVEL1 IN FIXLV1 TO ALL LEVEL1 IN DEBHOLDM AS J1
TABLE FILE FIXLV1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NW_LVL1 AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXMKT
END
-RUN


JOIN CLEAR *
-RUN


JOIN LEVEL1 IN FIXLV1 TO ALL AROLL_LEV4 IN DEBHOLDM2 AS J1
TABLE FILE FIXLV1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NW_LVL1 AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXMKT2
END
-RUN

JOIN CLEAR *
-RUN

MODIFY FILE MZKIEW
FIXFORM FROM FIXMKT
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXMKT
END
-RUN

MODIFY FILE MZKIEW
FIXFORM FROM FIXMKT2
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXMKT2
END
-RUN

-*Destination 
JOIN AIR_KEY IN DZKIEW TO ALL AIR_KEY IN AZKIEW AS J1
TABLE FILE DZKIEW
PRINT LEVEL1 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY LEVEL1 NOPRINT
ON TABLE HOLD AS DEBHOLDD
END
-RUN

JOIN CLEAR *
-RUN

JOIN AIR_KEY IN DZKIEW TO ALL AIR_KEY IN AZKIEW AS J1
TABLE FILE DZKIEW
PRINT AROLL_LEV4 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  
BY AROLL_LEV4 NOPRINT
ON TABLE HOLD AS DEBHOLDD2
END
-RUN

JOIN CLEAR *
-RUN



JOIN LEVEL1 IN FIXLV1 TO ALL LEVEL1 IN DEBHOLDD AS J1
TABLE FILE FIXLV1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NW_LVL1 AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXDST
END
-RUN

JOIN CLEAR *
-RUN



JOIN LEVEL1 IN FIXLV1 TO ALL AROLL_LEV4 IN DEBHOLDD2 AS J1
TABLE FILE FIXLV1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR NW_LVL1 AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXDST2
END
-RUN

JOIN CLEAR *
-RUN

MODIFY FILE DZKIEW
FIXFORM FROM FIXDST
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXDST
END
-RUN


MODIFY FILE DZKIEW
FIXFORM FROM FIXDST2
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXDST2
END
-RUN
 
-*Air
TABLE FILE AZKIEW
PRINT AIR_KEY
BY LEVEL1
ON TABLE HOLD AS DEBHOLDA
END
-RUN

JOIN LEVEL1 IN DEBHOLDA TO LEVEL1 IN FIXLV1 AS J1
DEFINE FILE DEBHOLDA
XL01/A36 = NW_LVL1;
END
TABLE FILE DEBHOLDA
PRINT NW_LVL1 AS 'LEVEL1' XL01 AS 'ICODEX'
BY AIR_KEY
WHERE XL01 NE ' '
ON TABLE HOLD AS FIXAIR

END
-RUN



MODIFY FILE AZKIEW
FIXFORM FROM FIXAIR
MATCH AIR_KEY
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE ICODEX
ON NOMATCH REJECT
DATA ON FIXAIR
END
-RUN

JOIN CLEAR *
-RUN

-*Car

TABLE FILE CZKIEW
PRINT LEVEL1 CAR_KEY  
BY LEVEL1 NOPRINT
ON TABLE HOLD AS DEBHOLDC
END
-RUN

TABLE FILE CZKIEW
PRINT AROLL_LEV4 CAR_KEY  
BY AROLL_LEV4 NOPRINT
ON TABLE HOLD AS DEBHOLDC2
END
-RUN



JOIN LEVEL1 IN FIXLV1 TO ALL LEVEL1 IN DEBHOLDC AS J1
DEFINE FILE FIXLV1
XL01/A36 = NW_LVL1;
END
TABLE FILE FIXLV1
PRINT CAR_KEY NW_LVL1 AS 'LEVEL1' XL01 AS 'ICODEX' NW_LVL1 AS 'AROLL_LEV4'
BY CAR_KEY NOPRINT
ON TABLE HOLD AS FIXCAR
END
-RUN

JOIN CLEAR *
-RUN

JOIN LEVEL1 IN FIXLV1 TO ALL AROLL_LEV4 IN DEBHOLDC2 AS J1
DEFINE FILE FIXLV1
XL01/A36 = NW_LVL1;
END
TABLE FILE FIXLV1
PRINT CAR_KEY NW_LVL1 AS 'LEVEL1' XL01 AS 'ICODEX' NW_LVL1 AS 'AROLL_LEV4'
BY CAR_KEY NOPRINT
ON TABLE HOLD AS FIXCAR2
END
-RUN

JOIN CLEAR *
-RUN



MODIFY FILE CZKIEW
FIXFORM FROM FIXCAR
MATCH CAR_KEY
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE ICODEX
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXCAR
END
-RUN

MODIFY FILE CZKIEW
FIXFORM FROM FIXCAR2
MATCH CAR_KEY
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE ICODEX
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXCAR2
END
-RUN

-* Hotel

TABLE FILE HZKIEW
PRINT LEVEL1 HTL_KEY  
BY LEVEL1 NOPRINT
ON TABLE HOLD AS DEBHOLDH
END
-RUN

TABLE FILE HZKIEW
PRINT AROLL_LEV4 HTL_KEY  
BY AROLL_LEV4 NOPRINT
ON TABLE HOLD AS DEBHOLDH2
END
-RUN



JOIN LEVEL1 IN FIXLV1 TO ALL LEVEL1 IN DEBHOLDH AS J1
DEFINE FILE FIXLV1
XL01/A36 = NW_LVL1;
END
TABLE FILE FIXLV1
PRINT HTL_KEY NW_LVL1 AS 'LEVEL1' XL01 AS 'ICODEX' NW_LVL1 AS 'AROLL_LEV4'
BY HTL_KEY NOPRINT
ON TABLE HOLD AS FIXHTL
END
-RUN

JOIN CLEAR *
-RUN



JOIN LEVEL1 IN FIXLV1 TO ALL AROLL_LEV4 IN DEBHOLDH2 AS J1
DEFINE FILE FIXLV1
XL01/A36 = NW_LVL1;
END
TABLE FILE FIXLV1
PRINT HTL_KEY NW_LVL1 AS 'LEVEL1' XL01 AS 'ICODEX' NW_LVL1 AS 'AROLL_LEV4'
BY HTL_KEY NOPRINT
ON TABLE HOLD AS FIXHTL2
END
-RUN

JOIN CLEAR *
-RUN


MODIFY FILE HZKIEW
FIXFORM FROM FIXHTL
MATCH HTL_KEY 
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE ICODEX
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXHTL
END
-RUN


MODIFY FILE HZKIEW
FIXFORM FROM FIXHTL2
MATCH HTL_KEY 
ON MATCH UPDATE LEVEL1
ON MATCH UPDATE ICODEX
ON MATCH UPDATE AROLL_LEV4
ON NOMATCH REJECT
DATA ON FIXHTL2
END
-RUN
-XXIT