-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Carried through non_tkts ref_tkts JK 9/29/04
-* ADDED CODE FOR GLOBAL CURRENCY - DEB 11/9/04
-* CARRIED THROUGH AA_TKT DL_TKT NW_TKT OTH_TKT UA_TKT - DEB 11/17/04
-* CREATED FOR TOP TICKET EXCHANGE SUMMARY REPORT - DEB 6/8/05
-* ADDED REF_EXCH_CNT2 FOR ABTPEXCA - STEVE 08/04/2006
-*2/10/15   DEB S-07357 ADDED NORECORDS ROUTINE
-*8/12/15   JEM S-10868 Updated norecords to correct report failure error 
-*4/26/2017-JEM-S-33318-updated logic for no records report

-INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-**********************************************************************

-INCLUDE SETECHO

SET ASNAMES = ON
-RUN

-IF '&&SETF.EVAL' EQ 'ABEXRRSN' OR 'ALEXRRSN' THEN GOTO SKIPthis;

-INCLUDE RETUDID
-RUN


-SKIPthis;


TABLE FILE &&RPT_HOLD
SUM 
    REF_EXCH_CNT AS 'TREX'
    FARE_PAID/D12.2CS AS 'TFARE'
BY LEVEL_DESC
ON TABLE HOLD AS HOLDONE
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT   AIR_KEY
        AIRLINE
        AIRLINE_FEE 
        EXCHGS
        FARE_PAID
        IFLAG
        LEVEL_DESC      
        NET_TKT_CNT       
BY LEVEL_DESC
ON TABLE HOLD AS TOPTVL2
END
-RUN


MATCH FILE TOPTVL2
PRINT  AIR_KEY
        AIRLINE
        AIRLINE_FEE 
        EXCHGS
        FARE_PAID
        IFLAG
        LEVEL_DESC      
        NET_TKT_CNT     
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDONE
SUM TREX
    TFARE
BY LEVEL_DESC
AFTER MATCH HOLD AS HOLD2 OLD-OR-NEW
END
-RUN



TABLE FILE HOLD2
PRINT AIR_KEY
      AIRLINE
      AIRLINE_FEE 
      EXCHGS
      FARE_PAID
      IFLAG
      LEVEL_DESC      
      NET_TKT_CNT     
      TREX
      TFARE
 BY AIR_KEY 
 ON TABLE HOLD AS AIRHOLD3
 END
 -RUN
 
 

-IF '&&SETF.EVAL' EQ 'ABEXRRSN' OR 'ALEXRRSN' THEN GOTO ALL ELSE GOTO NextChk;

-ALL

EX UDALEXR
-RUN


-IF &&NRALL EQ 'Y' THEN GOTO NORECORDS; 


-GOTO Continue


-NextChk;

-IF '&&SETF.EVAL' EQ 'JCEXRSN' THEN GOTO JOINT;

-JOINT

EX UDJCEXR
-RUN

-Continue

-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
DEFINE FILE AIRHOLD5 

NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);

END

 
-IF '&&SETF.EVAL' NE 'ALEXRRSN' THEN GOTO NotThis;

-SET &&BREAKOPTION =  'ON LEVEL_DESC RECOMPUTE AS ''TOTAL FOR'' ';

-NotThis;


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE AIRHOLD5
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
   
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM


 -* ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-IF '&&ROLLUP.EVAL' EQ 'KIEWIT-R' AND '&&SETF.EVAL' EQ 'ABEXRRSN' THEN GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE


&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-GOTO XXIT
-*-*-EXIT


-NORECORDS


-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT


