-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 1/24/05 - DEB - ADDED CODE FOR GLOBAL CURRENCY
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK

-* File CVIEW1EX.FEX
-********************************************************************
-* MODIFICAIONS:
-INCLUDE SETECHO

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
-SET &RPARM = &&WEB_PATH || 'RPTPARMS.fex';

-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';
DEFINE FILE &&EXTRACT
BOOKINGS/D12 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
  CHG_COD/A47 = IF LEVEL3 NE ' ' AND LEVEL2 NE ' ' THEN
                  LEVEL1  || '-' || LEVEL2 || '-' || LEVEL3 ELSE
                  IF LEVEL3 EQ ' ' AND LEVEL2 NE ' ' THEN
                  LEVEL1  || '-' || LEVEL2 ELSE
                  IF LEVEL3 EQ ' ' AND LEVEL2 EQ ' ' THEN LEVEL1;
  CC1/A1 = EDIT(LEVEL1, '9');
  CC2/A1 = EDIT(LEVEL2, '9');
  CC3/A1 = EDIT(LEVEL3, '9');
  CHG_TYPE/A15 = IF CC1 EQ 'B' THEN 'BCHG' ELSE
                   IF CC1 EQ 'G' THEN 'GCHG' ELSE
                   IF CC1 EQ 'M' THEN 'MCHG' ELSE
                   IF CC1 EQ 'P' THEN 'PCHG' ELSE
                   IF CC1 EQ '1' THEN 'DEF PARTNERS' 
                   ELSE 'DEF ALL OTHER';
  CHG_TYPE2/A15 = IF CC2 EQ 'B' THEN 'BCHG' ELSE
                   IF CC2 EQ 'G' THEN 'GCHG' ELSE
                   IF CC2 EQ 'M' THEN 'MCHG' ELSE
                   IF CC2 EQ 'P' THEN 'PCHG' ELSE
                   IF CC2 EQ '1' THEN 'DEF PARTNERS' 
                   ELSE 'DEF ALL OTHER';
  CHG_TYPE3/A15 = IF CC3 EQ 'B' THEN 'BCHG' ELSE
                   IF CC3 EQ 'G' THEN 'GCHG' ELSE
                   IF CC3 EQ 'M' THEN 'MCHG' ELSE
                   IF CC3 EQ 'P' THEN 'PCHG' ELSE
                   IF CC3 EQ '1' THEN 'DEF PARTNERS' 
               ELSE 'DEF ALL OTHER';               
  LEVEL_DESC/A60 = &&LDESC;
  NEW_RENTAL_AMT/D12.2CS = RENTAL_AMT;
  NBR_DAYS/D12S = NUM_DAYS;
  RENTAL_DAYS/D12S = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
  TRAN_MY/MTYY = INVOICE_DATE;
 
NEW_CHG_TYPE/A15 = IF CHG_TYPE2 EQ 'BCHG' OR CHG_TYPE3 EQ 'BCHG' THEN 'BCHG' ELSE CHG_TYPE;

END
-RUN

TABLEF FILE &&EXTRACT
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  CHG_TYPE
  CHG_TYPE2
  CHG_TYPE3
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  CURR_DATE 	
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
  NEW_CHG_TYPE
-INCLUDE BYHIERARCHY
-INCLUDE &CARDATES  

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
-* &&WHERE1
-* &&WHERE2
-* &&WHERE3
-* &&WHERE4
-* &&WHERE5
-* &&WHERE6
&&WHERE7
&&WHERE8
-* &&WHERE9
-* &&WHERE10

-INCLUDE &RPARM
ON TABLE HOLD AS BZCHOLD
END
-RUN

TABLE FILE BZCHOLD
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  NEW_CHG_TYPE AS 'CHG_TYPE'
  CHG_TYPE2
  CHG_TYPE3  
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
-*  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
  NEW_CHG_TYPE
  CAR_KEY
-INCLUDE BYHIERARCHY
BY LEVEL_DESC
ON TABLE HOLD AS BZHOLD2
END
-RUN

TABLE FILE BZHOLD2
SUM RENTAL_DAYS
    NEW_RENTAL_AMT
-INCLUDE BYHIERARCHY
BY LEVEL_DESC
BY CHG_TYPE
BY CHG_COD
WHERE CAR_KEY CONTAINS 'TURNER'
-*ON TABLE HOLD AS BOOZCAR
END
-RUN 
-QUIT


TABLE FILE BZHOLD2
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
-INCLUDE BYHIERARCHY
BY CHG_TYPE
ON TABLE HOLD AS CHOLD1 FORMAT FOCUS
END
-RUN


TABLE FILE BZCHOLD
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  CHG_TYPE2 AS 'CHG_TYPE'
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
-INCLUDE BYHIERARCHY
BY LEVEL2
WHERE LEVEL2 NE ' '
WHERE CHG_TYPE2 NE CHG_TYPE
ON TABLE HOLD AS BZHOLD3
END
-RUN
 
TABLE FILE BZHOLD3
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
-INCLUDE BYHIERARCHY
BY CHG_TYPE
ON TABLE HOLD AS CHOLD2 FORMAT FOCUS
END
-RUN
 
TABLE FILE BZCHOLD
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  CHG_TYPE3 AS 'CHG_TYPE'
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
-INCLUDE BYHIERARCHY
BY LEVEL3
WHERE LEVEL3 NE ' '
WHERE CHG_TYPE2 NE CHG_TYPE3
WHERE CHG_TYPE NE CHG_TYPE3
ON TABLE HOLD AS BZHOLD4
END
-RUN

TABLE FILE BZHOLD4
PRINT AROLL_DSC3
  BOOKINGS
  CC1
  CC2
  CC3
  CHG_COD
  CAR_CAT	
  CAR_DESC	
  CAR_KEY	
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE
  INVOICE_DATE 	
  INT_DOM
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL_DESC  
  NBR_DAYS 
  NEW_RENTAL_AMT
  RENTAL_DAYS
  TRAN_MY
-INCLUDE BYHIERARCHY
BY CHG_TYPE
ON TABLE HOLD AS CHOLD3 FORMAT FOCUS
END
-RUN


  
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'CHOLD1.FOC';
-SET &HNKB=&HLDPATH || 'CHOLD2.FOC';
-SET &HNKC=&HLDPATH || 'CHOLD3.FOC';
-RUN
  
  
-SET &FILENAME = 'CHOLD1'; 
-RUN
  
-DOS STATE &HNKA
-SET &CHOLDFILE1 = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';
  
-DOS STATE &HNKB
-SET &CHOLDFILE2 = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';
  
-DOS STATE &HNKC
-SET &CHOLDFILE3 = IF &RETCODE.EVAL EQ 0 THEN &HNKC | ' AS ' | &FILENAME ELSE ' ';
  
USE ADD 
  &CHOLDFILE1
  &CHOLDFILE2
  &CHOLDFILE3
END

TABLE FILE CHOLD1
SUM RENTAL_DAYS
    NEW_RENTAL_AMT
-INCLUDE BYHIERARCHY
BY LEVEL_DESC
BY CHG_TYPE
BY CHG_COD
ON TABLE HOLD AS BOOZCAR
END
-RUN
 
 

