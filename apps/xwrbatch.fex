-INCLUDE SETECHO

-GOTO CNTL
-* WRBATCH.FEX - load the Instance Key for the report that is executing
-*               into the BRPT_QUE file so that the LOADBINS.FEX can execute.

-*DEFINE FILE RPT_INST
-*INTIME/A18='WRUNINDV          ';
-*END
-*TABLE FILE RPT_INST
-*PRINT INST_KEY INTIME ROLLUP_CODE
-*WHERE INST_KEY EQ 
-*'&&IKEY.EVAL'
-*ON TABLE HOLD AS HLDRI
-*WHERE RECORDLIMIT EQ 1
-*END
-*-RUN
-*-IF &RECORDS EQ 0 THEN GOTO NOKEY ;

-CNTL

-*************TESTING **************************
-IF &&IKEY EQ 
- 'METX-R  METX  ro20001213100404SPCAIRMaster        METX  jo20030729100555' 
- THEN GOTO CNTL2;
-*************TESTING **************************


SET ASNAME = ON
-SET &LEN=POSIT('&&IKEY.EVAL', 72, '-R', 2, 'I1');
-SET &LEN = &LEN + 1;
-SET &RC = SUBSTR(72, '&&IKEY.EVAL', 1, &LEN, &LEN, 'A&LEN.EVAL');
DEFINE FILE CONTROL
INTIME/A18 WITH ROLLUP_CODE = 'WRUNINDV          ';
INST_KEY/A72 WITH ROLLUP_CODE = '&&IKEY.EVAL';
RC/A8 = '&RC.EVAL';
END
TABLE FILE CONTROL
PRINT INST_KEY INTIME RC AS 'ROLLUP_CODE'
BY ROLLUP_CODE NOPRINT
IF RECORDLIMIT EQ 1
ON TABLE HOLD AS HLDRI
END
-RUN

-*************TESTING **************************
-GOTO MOD2
-CNTL2
TABLE FILE CONTROL
PRINT INST_KEY INTIME ROLLUP_CODE
BY ROLLUP_CODE NOPRINT
IF RECORDLIMIT EQ 1
ON TABLE HOLD AS HLDRI
END
-RUN
-MOD2
-*************TESTING **************************

MODIFY FILE BRPT_QUE
FIXFORM FROM HLDRI
MATCH INST_KEY INTIME
 ON MATCH REJECT
 ON NOMATCH INCLUDE
DATA ON HLDRI
END
-RUN
-GOTO OK

-NOKEY
-HTMLFORM BEGIN
<HTML>
<HEAD>

</HEAD>
<BODY>

<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>THIS REPORT INSTANCE HAS BEEN DELETED FROM THE DATABASE</H2></CENTER>

<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER> 

</BODY>
</HTML>

-HTMLFORM END

-OK


