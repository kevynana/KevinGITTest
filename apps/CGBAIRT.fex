-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Created to show department and responsibility center for Patti JK 7/19/04
-* 12/21/2004 - DEB - CHANGED CONL AND CONGONL DEFINE TO INCLUDE DOD_TYPE J
-* 10/11/2005 - DEB - CHANGED CONL AND CONGONL DEFINE TO INCLUDE DOD_TYPE H
-*1/28/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*4/20/2017-JEM-S-33318-updated logic for no records report


SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-IF &&SETF EQ 'CGBNMR' THEN GOTO RETAIL;

DEFINE FILE SR_50
  CARD/A8 = EDIT (CREDIT_CARD, '99999999$$$$$$$$$$');
  CCARD2/A6 =EDIT(CREDIT_CARD, '$$999999$$$$$$$$$$');
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE 
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';   
  CRD_CRD/A2=EDIT(CREDIT_CARD, '99$$$$$$$$$$$$$$$'); 
  LEVEL_DESC/A60 = &&LDESC;
  FARE_PAID/D12 = SEG_AMT + SEG_TAX;
  FLAG/A1 = 'A';
  NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  RCODE/A5 = GETTOK(LEVEL3, 15, 1, '*', 5, RCODE);
  SAVINGS/D11.2CS     = SEG_STANDARD - FARE_PAID;
  NEW_SEG_MILES/D9 = SEG_MILES;
  TKT_AMOUNT/D12.2CS = TICKET_AMT + TAX_AMT;
  TKT_PURCH/D8.2CS      = IF (TICKET_CODE EQ '1') AND
                             (SEG_NBR EQ '01') AND
                             (FARE_PAID GE 0) AND
                             (SEG_COUNT EQ 1) AND 
                             (CONJ_REL EQ 1) THEN 1 ELSE 0;
EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') THEN 1 ELSE 0;
-* Defines on Previous Defines
  DISSAVINGS/D12 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                   FARE_PAID-SEG_LOWEST;
  DECLINE_AMT/D12.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         TKT_AMOUNT - LOWEST_AMT;
  VASAVINGS/D12 = SEG_DISCOUNT - FARE_PAID;
-* Defines on Previously Defined Defines
  
END
-RUN

TABLEF FILE SR_50
PRINT AROLL_DSC3
  BR_CL_IDX
  CARD
  CCARD2
  CGADV
  CRD_CRD
  CREDIT_CARD
  DECLINE_AMT
  DISSAVINGS
  DOC_TYPE	
  DOD_TYPE
  DPT_DATE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE
  AIR_MAIN.INTL_DOM AS 'INTDOM'
  CITYPAIR.INTL_DOM AS 'ITDOM'
  FARE_PAID
  FLAG	
  LEVEL_DESC
  LEVEL2
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  RCODE
  REFUSE_CODE
  RF_FLAG
  SAVINGS
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 
  TKT_NUM
  TKT_PURCH	
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	

WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


DEFINE FILE &&RPT_HOLD
CURRENT/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND
                TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PRIOR/A1 =  IF TRN_DATE GE &&FXDATE.EVAL AND
               TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
END

TABLE FILE &&RPT_HOLD
PRINT BR_CL_IDX
  CARD
  CCARD2
  CGADV
  CRD_CRD
  CREDIT_CARD
  DECLINE_AMT
  DISSAVINGS
  CURRENT
  DOC_TYPE	
  DOD_TYPE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE	
  FARE_PAID
  FLAG
  INTDOM
  ITDOM
  LEVEL_DESC
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  PRIOR	
  REFUSE_CODE
  RF_FLAG
  SAVINGS
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 	
  TKT_NUM
  TKT_PURCH
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 
BY LEVEL_DESC	
BY LEVEL2
BY RCODE
ON TABLE HOLD AS TRANONE 
END
-RUN


DEFINE FILE TRANONE
CAVOL/D12.2CS = IF CURRENT EQ 'Y' THEN FARE_PAID ELSE 0;
CDAVOL/D12.2CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN FARE_PAID ELSE 0;
CMILES/D9 = IF CURRENT EQ 'Y' THEN NEW_SEG_MILES;
PAVOL/D12.2CS = IF PRIOR EQ 'Y' THEN FARE_PAID ELSE 0;
CVSAV/D12.2CS = IF CURRENT EQ 'Y' THEN VASAVINGS ELSE 0;
CNTKT/D8CS = IF CURRENT EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CNTP/D8CS = IF CURRENT EQ 'Y' THEN TKT_PURCH ELSE 0;
CNTP1/D8CS = IF (CURRENT EQ 'Y') AND (RF_FLAG EQ ' ') AND (EX_FLAG EQ ' ') AND
                (ITDOM EQ 'D') THEN NET_TKT_CNT ELSE 0;
CLSAV/D12.2CS = IF CURRENT EQ 'Y' THEN DISSAVINGS ELSE 0;
-* CNVSA1/D12.2CS=IF (CURRENT EQ 'Y') AND (RF_FLAG EQ ' ') AND (EX_FLAG EQ ' ')
-*                  THEN FARE_PAID ELSE 0;
CNVSA/D12.2CS= IF (CURRENT EQ 'Y') AND 
                  (CREDIT_CARD OMITS '424604' OR '473077' OR 'TP') AND
                  (BR_CL_IDX NE 'RF892075' OR 'RF740019' OR 'RF891788') AND
                  (RF_FLAG EQ ' ') AND (EX_FLAG EQ ' ') THEN FARE_PAID ELSE 0;
     

CDFARE/D12.2CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN
                    FARE_PAID ELSE 0;
CDTKT/P8CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN
                NET_TKT_CNT ELSE 0;
CDLS/D12.2CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN
                   DISSAVINGS ELSE 0;
PDFARE/D12.2CS = IF (PRIOR EQ 'Y') AND (INTDOM EQ 'D') THEN 
                    FARE_PAID ELSE 0;
PDTKT/P8CS = IF (PRIOR EQ 'Y') AND (INTDOM EQ 'D') THEN
                 NET_TKT_CNT ELSE 0;
CADVT/P8CS = IF (CURRENT EQ 'Y') AND 
                (CGADV EQ '0-6') THEN NET_TKT_CNT ELSE 0;
CADVTP/P8CS = IF (CURRENT EQ 'Y') AND 
                (CGADV EQ '0-6') THEN TKT_PURCH ELSE 0;
CADVT1/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN NET_TKT_CNT ELSE 0;
CADVT2/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '14-20') THEN NET_TKT_CNT ELSE 0;
CADVT3/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '21+') THEN NET_TKT_CNT ELSE 0;
CADVTPX/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN TKT_PURCH ELSE 0;
CLS1/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'CX') THEN
                  DISSAVINGS ELSE 0;
CLS2/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'TS') THEN
                  DISSAVINGS ELSE 0;
CLS3/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'AS') THEN
                  DISSAVINGS ELSE 0;
CLS4/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'NR') THEN
                  DISSAVINGS ELSE 0;
CLS5/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'SS') THEN
                  DISSAVINGS ELSE 0;
CSAV1/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'NF') THEN 
                  SAVINGS ELSE 0;
CSAV/D12.2CS = IF (CURRENT EQ 'Y') THEN SAVINGS ELSE 0;
CLS200/D12.2CS = IF ((DECLINE_AMT GE 100) OR (DECLINE_AMT LE (-100))) THEN
                    CLS1 ELSE 0;
CLS2001/D12.2CS = IF ((DECLINE_AMT GE 100) OR (DECLINE_AMT LE (-100))) THEN
                    CLSAV ELSE 0;
CONL/P8CS = IF (CURRENT EQ 'Y') AND (ONLINE_TRADITIONAL EQ 'ONLINE') THEN 
                NET_TKT_CNT ELSE 0;
CONGONL/P8CS = IF (CURRENT EQ 'Y') AND (ONLINE_TRADITIONAL EQ 'ONLINE') AND 
                 (ITDOM EQ 'D') THEN NET_TKT_CNT ELSE 0;
CNR/P8CS = IF (CURRENT EQ 'Y') AND (NONREF_FLAG EQ 'N') THEN 
              NET_TKT_CNT ELSE 0;
                
END
-RUN

TABLE FILE TRANONE
SUM CAVOL
    CDAVOL
    CDLS
    CLSAV
    CLS1
    CLS2
    CLS3
    CLS4
    CLS5
    CMILES
    CSAV
    CSAV1
    CNTKT
    CNVSA
    CVSAV
    PAVOL  
    CLS200  
    CLS2001
COMPUTE CAVAR/D12.2C = CAVOL - PAVOL; 
        CAVAR1/D12.2C = IF ((PAVOL LT 1) AND (PAVOL GT (-1))) THEN 0 ELSE
                           (((CAVOL-PAVOL)/PAVOL)*100);
        CTAVGT/D12.2C = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE
                            (CAVOL/CNTKT);
        CAVGT/D12.2C = IF ((CDTKT LT 1) AND (CDTKT GT (-1))) THEN 0 ELSE
                           (CDFARE/CDTKT);
        PAVGT/D12.2C = IF ((PDTKT LT 1) AND (PDTKT GT (-1))) THEN 0 ELSE
                           (PDFARE/PDTKT);
        AAVGV/D12.2C = CAVGT - PAVGT;
        AAVGV1/D12.2C = IF ((PAVGT LT 1) AND (PAVGT GT (-1))) THEN 0 ELSE
                           (((CAVGT-PAVGT)/PAVGT)*100);
        CADVP1/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT/CNTKT)*100);
        CADVP2/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT1/CNTKT)*100);
        CADVP3/P12.2 = IF ((CNTP LT 1) AND (CNTP GT (-1))) THEN 0
                          ELSE ((CADVTP/CNTP)*100);
        CADVP4/P12.2 = IF ((CNTP LT 1) AND (CNTP GT (-1))) THEN 0
                          ELSE ((CADVTPX/CNTP)*100);
        CADVP5/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT2/CNTKT)*100);
        CADVP6/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT3/CNTKT)*100);
        CLSP/P12.2 = IF ((CLS2001 LT 1) AND (CLS2001 GT (-1))) THEN 0
                         ELSE ((CLS200/CLS2001)*100);
        CONLP/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 
                         ELSE ((CONL/CNTKT)*100);
        CONLP1/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 
                         ELSE ((CONGONL/CNTKT)*100);
        CNRP/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                         ELSE ((CNR/CNTKT)*100);
        CNFSV/P12.2 = IF ((CSAV LT 1) AND (CSAV GT (-1))) THEN 0
                         ELSE ((CSAV1/CSAV)*100);
        CTLS/P12.2 =  IF ((CAVOL LT 1) AND (CAVOL GT (-1))) THEN 0
                         ELSE ((CLSAV/CAVOL)*100);
        CCLS1/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS1/CLSAV)*100);
        CCLS2/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS2/CLSAV)*100);
        CCLS3/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS3/CLSAV)*100);
        CCLS4/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS4/CLSAV)*100);
        CCLS5/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS5/CLSAV)*100);
        CPMILE/P12.2C = IF ((NEW_SEG_MILES LT 1) AND (NEW_SEG_MILES GT (-1)))
                         THEN 0 ELSE (FARE_PAID/NEW_SEG_MILES);
        CTLSV/P12.2 = IF ((CDAVOL LT 1) AND (CDAVOL GT (-1))) THEN 0 ELSE
                          ((CDLS/CDAVOL)*100);
        CLS100P/P12.2 = IF ((CAVOL LT 1) AND (CAVOL GT (-1))) THEN 0 ELSE
                           ((CLS2001/CAVOL)*100);
 
BY LEVEL_DESC
BY LEVEL2
BY RCODE
ON TABLE HOLD AS TRANT 
END
-RUN

TABLE FILE TRANT
PRINT CAVOL
    CDAVOL
    CDLS
    CLSAV
    CLS1
    CLS2
    CLS3
    CLS4
    CLS5
    CMILES
    CSAV
    CSAV1
    CNTKT
    CNVSA
    CVSAV
    PAVOL  
    CLS200  
    CLS2001
    CAVAR
    CAVAR1  
    CTAVGT
    CAVGT
    PAVGT
    AAVGV
    AAVGV1
    CADVP1
    CADVP2
    CADVP3
    CADVP4
    CADVP5
    CADVP6
    CLSP
    CONLP
    CONLP1
    CNRP
    CNFSV
    CTLS
    CCLS1
    CCLS2
    CCLS3
    CCLS4
    CCLS5
    CPMILE
    CTLSV
    CLS100P
BY LEVEL_DESC
BY LEVEL2
BY RCODE
ON TABLE HOLD AS TRANTWO
END
-RUN
-GOTO XXIT

-RETAIL
DEFINE FILE SR_50
  CARD/A8 = EDIT (CREDIT_CARD, '99999999$$$$$$$$$$');
  CCARD2/A6 =EDIT(CREDIT_CARD, '$$999999$$$$$$$$$$');
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE 
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';   
  CRD_CRD/A2=EDIT(CREDIT_CARD, '99$$$$$$$$$$$$$$$'); 
  LEVEL_DESC/A60 = &&LDESC;
  FARE_PAID/D12 = SEG_AMT + SEG_TAX;
  FLAG/A1 = 'A';
  NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  RCODE/A5 = GETTOK(LEVEL3, 15, 1, '*', 5, RCODE);
  SAVINGS/D11.2CS     = SEG_STANDARD - FARE_PAID;
  NEW_SEG_MILES/D9 = SEG_MILES;
  TKT_AMOUNT/D12.2CS = TICKET_AMT + TAX_AMT;
  TKT_PURCH/D8.2CS      = IF (TICKET_CODE EQ '1') AND
                             (SEG_NBR EQ '01') AND
                             (FARE_PAID GE 0) AND
                             (SEG_COUNT EQ 1) AND 
                             (CONJ_REL EQ 1) THEN 1 ELSE 0;
EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') THEN 1 ELSE 0;
-* Defines on Previous Defines
  DISSAVINGS/D12 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                   FARE_PAID-SEG_LOWEST;
  DECLINE_AMT/D12.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         TKT_AMOUNT - LOWEST_AMT;
  VASAVINGS/D12 = SEG_DISCOUNT - FARE_PAID;
  RETAIL_DSC/A25 = IF RCODE EQ '00005' OR '00000' OR '00027' OR '00029' OR
                               '00028' OR '00036' THEN 'Retail Sales Admin' ELSE
                   IF RCODE EQ '00007' OR '00367' OR '00368' OR 
                               '00369' OR '00370' THEN 'National Accounts East' ELSE
                   IF RCODE EQ '00008' OR '00371' OR '00372' OR '00373' OR 
                               '00386' OR '00374' THEN 'National Accounts West' ELSE
                   IF RCODE EQ '00384' OR '00376' OR '00378' OR '00346' 
                               THEN 'Eastern Region Team' ELSE
                   IF RCODE EQ '00339' OR '00379' OR '00338' OR '00341' OR 
                               '00343' OR '00377' THEN 'Western Region Team' ELSE
                   IF RCODE EQ '00366' THEN 'RFC, Wal-Mart Team' ELSE
                   IF RCODE EQ '00006' OR '00004' OR '00380' OR '00381' OR
                               '00382' OR '00389' THEN 'Channels' ELSE 'Other';
                               
-* Defines on Previously Defined Defines
  
END
-RUN

TABLEF FILE SR_50
PRINT AROLL_DSC3
  BR_CL_IDX
  CARD
  CCARD2
  CGADV
  CRD_CRD
  CREDIT_CARD
  DECLINE_AMT
  DISSAVINGS
  DOC_TYPE	
  DOD_TYPE
  DPT_DATE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE
  AIR_MAIN.INTL_DOM AS 'INTDOM'
  CITYPAIR.INTL_DOM AS 'ITDOM'
  FARE_PAID
  FLAG	
  LEVEL_DESC
  LEVEL2
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  RETAIL_DSC
  RCODE
  REFUSE_CODE
  RF_FLAG
  SAVINGS
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 
  TKT_NUM
  TKT_PURCH	
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 	

WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN


DEFINE FILE &&RPT_HOLD
CURRENT/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND
                TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PRIOR/A1 =  IF TRN_DATE GE &&FXDATE.EVAL AND
               TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
END

TABLE FILE &&RPT_HOLD
PRINT BR_CL_IDX
  CARD
  CCARD2
  CGADV
  CRD_CRD
  CREDIT_CARD
  DECLINE_AMT
  DISSAVINGS
  CURRENT
  DOC_TYPE	
  DOD_TYPE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE	
  FARE_PAID
  FLAG
  INTDOM
  ITDOM
  LEVEL_DESC
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  PRIOR	
  REFUSE_CODE
  RF_FLAG
  SAVINGS
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX 	
  TKT_NUM
  TKT_PURCH
  TRN_DATE
  VASAVINGS
  VOID_DATE 	
  VOID_STATUS 
BY LEVEL_DESC	
BY RETAIL_DSC
ON TABLE HOLD AS TRANONE 
END
-RUN


DEFINE FILE TRANONE
CAVOL/D12.2CS = IF CURRENT EQ 'Y' THEN FARE_PAID ELSE 0;
CDAVOL/D12.2CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN FARE_PAID ELSE 0;
CMILES/D9 = IF CURRENT EQ 'Y' THEN NEW_SEG_MILES;
PAVOL/D12.2CS = IF PRIOR EQ 'Y' THEN FARE_PAID ELSE 0;
CVSAV/D12.2CS = IF CURRENT EQ 'Y' THEN VASAVINGS ELSE 0;
CNTKT/D8CS = IF CURRENT EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CNTP/D8CS = IF CURRENT EQ 'Y' THEN TKT_PURCH ELSE 0;
CNTP1/D8CS = IF (CURRENT EQ 'Y') AND (RF_FLAG EQ ' ') AND (EX_FLAG EQ ' ') AND
                (ITDOM EQ 'D') THEN NET_TKT_CNT ELSE 0;
CLSAV/D12.2CS = IF CURRENT EQ 'Y' THEN DISSAVINGS ELSE 0;
-* CNVSA1/D12.2CS=IF (CURRENT EQ 'Y') AND (RF_FLAG EQ ' ') AND (EX_FLAG EQ ' ')
-*                  THEN FARE_PAID ELSE 0;
CNVSA/D12.2CS= IF (CURRENT EQ 'Y') AND 
                  (CREDIT_CARD OMITS '424604' OR '473077' OR 'TP') AND
                  (BR_CL_IDX NE 'RF892075' OR 'RF740019' OR 'RF891788') AND
                  (RF_FLAG EQ ' ') AND (EX_FLAG EQ ' ') THEN FARE_PAID ELSE 0;
     

CDFARE/D12.2CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN
                    FARE_PAID ELSE 0;
CDTKT/P8CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN
                NET_TKT_CNT ELSE 0;
CDLS/D12.2CS = IF (CURRENT EQ 'Y') AND (INTDOM EQ 'D') THEN
                   DISSAVINGS ELSE 0;
PDFARE/D12.2CS = IF (PRIOR EQ 'Y') AND (INTDOM EQ 'D') THEN 
                    FARE_PAID ELSE 0;
PDTKT/P8CS = IF (PRIOR EQ 'Y') AND (INTDOM EQ 'D') THEN
                 NET_TKT_CNT ELSE 0;
CADVT/P8CS = IF (CURRENT EQ 'Y') AND 
                (CGADV EQ '0-6') THEN NET_TKT_CNT ELSE 0;
CADVTP/P8CS = IF (CURRENT EQ 'Y') AND 
                (CGADV EQ '0-6') THEN TKT_PURCH ELSE 0;
CADVT1/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN NET_TKT_CNT ELSE 0;
CADVT2/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '14-20') THEN NET_TKT_CNT ELSE 0;
CADVT3/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '21+') THEN NET_TKT_CNT ELSE 0;
CADVTPX/P8CS = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN TKT_PURCH ELSE 0;
CLS1/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'CX') THEN
                  DISSAVINGS ELSE 0;
CLS2/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'TS') THEN
                  DISSAVINGS ELSE 0;
CLS3/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'AS') THEN
                  DISSAVINGS ELSE 0;
CLS4/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'NR') THEN
                  DISSAVINGS ELSE 0;
CLS5/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'SS') THEN
                  DISSAVINGS ELSE 0;
CSAV1/D12.2CS = IF (CURRENT EQ 'Y') AND (REFUSE_CODE EQ 'NF') THEN 
                  SAVINGS ELSE 0;
CSAV/D12.2CS = IF (CURRENT EQ 'Y') THEN SAVINGS ELSE 0;
CLS200/D12.2CS = IF ((DECLINE_AMT GE 100) OR (DECLINE_AMT LE (-100))) THEN
                    CLS1 ELSE 0;
CLS2001/D12.2CS = IF ((DECLINE_AMT GE 100) OR (DECLINE_AMT LE (-100))) THEN
                    CLSAV ELSE 0;
CONL/P8CS = IF (CURRENT EQ 'Y') AND (DOD_TYPE EQ 'H' OR 'I' OR 'J') THEN NET_TKT_CNT ELSE 0;
CONGONL/P8CS = IF (CURRENT EQ 'Y') AND (DOD_TYPE EQ 'H' OR 'I' OR 'J') AND (ITDOM EQ 'D')
               THEN NET_TKT_CNT ELSE 0;
CNR/P8CS = IF (CURRENT EQ 'Y') AND (NONREF_FLAG EQ 'N') THEN 
              NET_TKT_CNT ELSE 0;
                
END
-RUN

TABLE FILE TRANONE
SUM CAVOL
    CDAVOL
    CDLS
    CLSAV
    CLS1
    CLS2
    CLS3
    CLS4
    CLS5
    CMILES
    CSAV
    CSAV1
    CNTKT
    CNVSA
    CVSAV
    PAVOL  
    CLS200  
    CLS2001
COMPUTE CAVAR/D12.2C = CAVOL - PAVOL; 
        CAVAR1/D12.2C = IF ((PAVOL LT 1) AND (PAVOL GT (-1))) THEN 0 ELSE
                           (((CAVOL-PAVOL)/PAVOL)*100);
        CTAVGT/D12.2C = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE
                            (CAVOL/CNTKT);
        CAVGT/D12.2C = IF ((CDTKT LT 1) AND (CDTKT GT (-1))) THEN 0 ELSE
                           (CDFARE/CDTKT);
        PAVGT/D12.2C = IF ((PDTKT LT 1) AND (PDTKT GT (-1))) THEN 0 ELSE
                           (PDFARE/PDTKT);
        AAVGV/D12.2C = CAVGT - PAVGT;
        AAVGV1/D12.2C = IF ((PAVGT LT 1) AND (PAVGT GT (-1))) THEN 0 ELSE
                           (((CAVGT-PAVGT)/PAVGT)*100);
        CADVP1/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT/CNTKT)*100);
        CADVP2/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT1/CNTKT)*100);
        CADVP3/P12.2 = IF ((CNTP LT 1) AND (CNTP GT (-1))) THEN 0
                          ELSE ((CADVTP/CNTP)*100);
        CADVP4/P12.2 = IF ((CNTP LT 1) AND (CNTP GT (-1))) THEN 0
                          ELSE ((CADVTPX/CNTP)*100);
        CADVP5/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT2/CNTKT)*100);
        CADVP6/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                          ELSE ((CADVT3/CNTKT)*100);
        CLSP/P12.2 = IF ((CLS2001 LT 1) AND (CLS2001 GT (-1))) THEN 0
                         ELSE ((CLS200/CLS2001)*100);
        CONLP/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 
                         ELSE ((CONL/CNTKT)*100);
        CONLP1/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 
                         ELSE ((CONGONL/CNTKT)*100);
        CNRP/P12.2 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0
                         ELSE ((CNR/CNTKT)*100);
        CNFSV/P12.2 = IF ((CSAV LT 1) AND (CSAV GT (-1))) THEN 0
                         ELSE ((CSAV1/CSAV)*100);
        CTLS/P12.2 =  IF ((CAVOL LT 1) AND (CAVOL GT (-1))) THEN 0
                         ELSE ((CLSAV/CAVOL)*100);
        CCLS1/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS1/CLSAV)*100);
        CCLS2/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS2/CLSAV)*100);
        CCLS3/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS3/CLSAV)*100);
        CCLS4/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS4/CLSAV)*100);
        CCLS5/P12.2 = IF ((CLSAV LT 1) AND (CLSAV GT (-1))) THEN 0 
                         ELSE ((CLS5/CLSAV)*100);
        CPMILE/P12.2C = IF ((NEW_SEG_MILES LT 1) AND (NEW_SEG_MILES GT (-1)))
                         THEN 0 ELSE (FARE_PAID/NEW_SEG_MILES);
        CTLSV/P12.2 = IF ((CDAVOL LT 1) AND (CDAVOL GT (-1))) THEN 0 ELSE
                          ((CDLS/CDAVOL)*100);
        CLS100P/P12.2 = IF ((CAVOL LT 1) AND (CAVOL GT (-1))) THEN 0 ELSE
                           ((CLS2001/CAVOL)*100);
 
BY LEVEL_DESC
BY RETAIL_DSC
ON TABLE HOLD AS TRANT 
END
-RUN

TABLE FILE TRANT
PRINT CAVOL
    CDAVOL
    CDLS
    CLSAV
    CLS1
    CLS2
    CLS3
    CLS4
    CLS5
    CMILES
    CSAV
    CSAV1
    CNTKT
    CNVSA
    CVSAV
    PAVOL  
    CLS200  
    CLS2001
    CAVAR
    CAVAR1  
    CTAVGT
    CAVGT
    PAVGT
    AAVGV
    AAVGV1
    CADVP1
    CADVP2
    CADVP3
    CADVP4
    CADVP5
    CADVP6
    CLSP
    CONLP
    CONLP1
    CNRP
    CNFSV
    CTLS
    CCLS1
    CCLS2
    CCLS3
    CCLS4
    CCLS5
    CPMILE
    CTLSV
    CLS100P
BY LEVEL_DESC
BY RETAIL_DSC
WHERE RETAIL_DSC NE 'Other'
ON TABLE HOLD AS TRANTWO
END
-RUN



-XXIT

-SET &&AIRREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';










