-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Removed Conagra Special from here so that they could have the standard
-* report as well as their specialized version JK 10/16/03
-* Added Current Total Average Ticket Price per Patti JK 2/24/04
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-INCLUDE SETECHO
SET ASNAMES=ON


-SET &&RPTSUF = 'P2P';

-SET &FMM=EDIT(&&FROMDT,'$$$$$99');
-SET &FMD=EDIT(&&FROMDT,'$$$$$$$$99');
-SET &FMY=EDIT(&&FROMDT,'9999');
-SET &TOM=EDIT(&&TODT,'$$$$$99');
-SET &TOD=EDIT(&&TODT,'$$$$$$$$99');
-SET &TOY=EDIT(&&TODT,'9999');

-SET &&SP = '|';
-SET &&SP3 = IF &&ROLLCNCT EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP4 = IF &&ROLLPHN EQ ' ' THEN ' ' ELSE &&SP;
-SET &&RCNCT = &&ROLLCNCT.LENGTH;
-SET &&CSL = &&ROLLCS.LENGTH;
-SET &&CSLP = IF &&RCNCT.EVAL GE 10 OR &&CSL.EVAL GE 10 THEN 60 ELSE 68;
-SET &&ROLLCS11 = TRUNCATE(&&ROLLCS);
-SET &&RCNCT1 = TRUNCATE(&&ROLLCNCT);
-RUN


TABLE FILE AIRHLD
PRINT 14ADV
      C_ITIN
      FARE_PAID
      DISSAVINGS
      LS
      ONLA
      PNR_LOCATOR
      STAY
      XTRAN_DT
      TVL_DTE
      VAL_ALN
      PREF_ALN
      PREF_CC
      NET_TKT_CNT
      ROLLUP_CODE
      RO_FLAG
BY UID_DSC      
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TRN_DATE
BY TKT_NUM
BY TKT_SORT
BY FLAG
ON TABLE HOLD AS AHLD
END
-RUN

TABLE FILE CARHLD
PRINT CPREF
      ONLC
      PREF_CC
      RENT_AMT
      VENDOR_CODE
      XTRAN_DTC
      TVL_DTC
      FLAG
      ROLLCDC
BY UID_DSC     
BY PASSNGR_NAME AS 'PAXC'           
BY PNR_LOCATOR
BY TKT_NUM
BY FLAG
ON TABLE HOLD AS CHLD
END
-RUN


TABLE FILE HTLHLD
PRINT CHAIN_CODE
      HPREF
      HTL_AMT
      ONLH
      PREF_CC
      XTRAN_DTH
      TVL_DTH
      UID
      FLAG
      ROLLCDH
      PROP_CODE
BY UID_DSC     
BY PASSNGR_NAME AS 'PAXH'     
BY PNR_LOCATOR
BY TKTN
BY FLAG
ON TABLE HOLD AS HHLD
END
-RUN

MATCH FILE AHLD
PRINT 14ADV
    C_ITIN
    FARE_PAID
    DISSAVINGS
    LS
    ONLA
    STAY
    XTRAN_DT
    TVL_DTE
    VAL_ALN
    PREF_ALN
    PREF_CC
    NET_TKT_CNT
    ROLLUP_CODE
    TKT_SORT
    RO_FLAG
    TRN_DATE
BY UID_DSC
BY PASSNGR_NAME    
BY PNR_LOCATOR
BY TKT_NUM
BY FLAG
ON TABLE HOLD
RUN
FILE CHLD
PRINT XTRAN_DTC
    TVL_DTC
    VENDOR_CODE
    CPREF
    PAXC
    RENT_AMT
    ONLC
    PREF_CC
    ROLLCDC
BY UID_DSC
BY PAXC    
BY PNR_LOCATOR
BY TKT_NUM
BY FLAG
AFTER MATCH HOLD AS ACHLD OLD-OR-NEW
END
-RUN

DEFINE FILE ACHLD
PAXN/A33 = IF PASSNGR_NAME EQ ' ' THEN PAXC ELSE PASSNGR_NAME;
TRVL/MDYY = IF TVL_DTE EQ ' ' THEN TVL_DTC ELSE TVL_DTE;
TKTN/A10 = IF TKT_NUM EQ '0000000000' THEN 'CAR ONLY' ELSE TKT_NUM;
ROLLCD1/A8 = IF ROLLUP_CODE EQ ' ' THEN ROLLCDC ELSE ROLLUP_CODE;
END
TABLE FILE ACHLD
PRINT 14ADV
      C_ITIN
      FARE_PAID
      DISSAVINGS
      LS
      ONLA
      ONLC
      STAY
      TRVL
      VAL_ALN
      PREF_ALN
      VENDOR_CODE
      CPREF
      RENT_AMT
      PREF_CC
      NET_TKT_CNT      
      ROLLCD1     
      RO_FLAG
      TRN_DATE
BY UID_DSC
BY PAXN 
BY PNR_LOCATOR
BY TKTN
BY TKT_SORT
BY FLAG
ON TABLE HOLD AS ACHLD1
END
-RUN

MATCH FILE ACHLD1
PRINT 14ADV
      C_ITIN
      FARE_PAID
      CPREF
      DISSAVINGS 
      LS
      ONLA
      ONLC
      STAY
      TRVL
      VAL_ALN
      VENDOR_CODE
      RENT_AMT
      PREF_ALN
      PREF_CC
      NET_TKT_CNT
      ROLLCD1
      TKT_SORT
      RO_FLAG
      TRN_DATE
BY UID_DSC
BY PAXN      
BY PNR_LOCATOR
BY TKTN
BY FLAG
ON TABLE HOLD
RUN
FILE HHLD
PRINT XTRAN_DTH
    TVL_DTH
    CHAIN_CODE
    HPREF
    PAXH 
    HTL_AMT
    ONLH
    PREF_CC
    ROLLCDH
    PROP_CODE
BY UID_DSC
BY PAXH    
BY PNR_LOCATOR
BY TKTN
BY FLAG
AFTER MATCH HOLD AS ACHHLD OLD-OR-NEW
END
-RUN


DEFINE FILE ACHHLD
-* LSF1/A1 = IF DISSAVINGS LE 0 AND VAL_ALN NE ' ' THEN 'Y' ELSE 'N';
LSF/A1 = IF FLAG EQ 'A' THEN LS ELSE ' ';
HTL/A1 = IF FLAG EQ 'A' AND STAY NE 0 AND CHAIN_CODE NE ' ' THEN 'Y' ELSE 'N';
PAX/A33 = IF PAXN EQ ' ' THEN PAXH ELSE PAXN;
TRV_DT/MDYY = IF TRVL EQ ' ' THEN TVL_DTH ELSE TRVL;
FLAG1/A3 = IF FLAG EQ 'A' THEN 'AIR' ELSE 
           IF FLAG EQ 'C' THEN 'CAR' ELSE
           IF FLAG EQ 'H' THEN 'HTL' ELSE ' ';
FARE/D12.2CSM = FARE_PAID;      
H_AMT/D12.2CSM = HTL_AMT;
C_AMT/D12.2CSM = RENT_AMT;
PM_FLAG/A1 = IF FLAG EQ 'A' AND NET_TKT_CNT GE 1 THEN '+' ELSE 
             IF FLAG EQ 'A' AND NET_TKT_CNT LT 1 THEN '-' ELSE 
             IF FLAG EQ 'C' AND RENT_AMT GE 1 THEN '+' ELSE
             IF FLAG EQ 'C' AND RENT_AMT LT 1 THEN '-' ELSE
             IF FLAG EQ 'H' AND HTL_AMT GE 1 THEN '+' ELSE
             IF FLAG EQ 'H' AND HTL_AMT LT 1 THEN '-' ELSE ' ';
ROLLCD/A8 = IF ROLLCD1 EQ ' ' THEN ROLLCDH ELSE ROLLCD1;             
END
TABLE FILE ACHHLD
PRINT 
      DISSAVINGS
      TRV_DT
      VAL_ALN
      C_ITIN
      14ADV AS 'FRTNADV'
      LSF
      ONLA
      ONLC
      ONLH
      FARE
      FLAG1
      CHAIN_CODE
      STAY
      HTL
      HPREF
      H_AMT
      HTL_AMT
      VENDOR_CODE
      CPREF
      C_AMT
      RENT_AMT
      PREF_ALN
      PREF_CC
      NET_TKT_CNT
      PM_FLAG
      ROLLCD
      PROP_CODE
      RO_FLAG
BY UID_DSC
BY PAX
BY PNR_LOCATOR
BY TRN_DATE
BY TKTN
BY TKT_SORT
BY FLAG
ON TABLE HOLD AS TRANTWO
END
-RUN


-INCLUDE FDEFRPTSP2P
-RUN


-SET &&OUTLINE2='FORMAT COMT';
-RUN

DEFINE FILE TRANTWO
NOWTOD/A8 WITH PAX = HHMMSS (NOWTOD);
UNID/I9 = UNID + 1;
END
TABLE FILE TRANTWO
PRINT ROLLCD AS 'ROLLUP,CODE'
    UID_DSC AS 'USER ID'
    PAX AS 'PASSENGER,NAME'
    PNR_LOCATOR AS 'PNR'
    TKTN AS 'TICKET,NUMBER'
    TRV_DT AS 'TRAVEL,DATE'
    FLAG1 AS 'TYPE'
    VAL_ALN AS 'VAL,ALN'
    FRTNADV AS '14 DAY,ADV PUR'
    LSF AS '$0 LOST,SVGS'
    ONLA AS 'AIR,BKD,ONL'
    PREF_ALN AS 'BKD,PREF,ALN'
    RO_FLAG AS 'RT/OW,FLAG'
-*     PREF_CC AS 'CORP,CARD,USED'
-*    FARE AS 'AIR,TKT,AMT'
-*    NET_TKT_CNT AS 'NET,TKT'
    CHAIN_CODE AS 'CHAIN,CODE'
    PROP_CODE AS 'PROP,CODE'
-*     HTL AS 'HTL,BKD'
    ONLH AS 'HTL,BKD,ONL'
    HPREF AS 'PREF,HTL'
-*    HTL_AMT AS 'HTL,AMT'
    VENDOR_CODE AS 'VENDOR,CODE'
    CPREF AS 'PREF,CAR'
    ONLC AS 'CAR,BKD,ONL'
-*    RENT_AMT AS 'RENTAL,AMNT'
    PM_FLAG AS '+/-'
BY ROLLCD NOPRINT
BY PAX NOPRINT
BY FLAG1 NOPRINT
BY PNR_LOCATOR NOPRINT
BY TRN_DATE NOPRINT
BY TKTN NOPRINT 
BY TKT_SORT NOPRINT
-* BY FLAG1 NOPRINT
HEADING
 "&&DTDESC &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
"<&&CSLP &&ROLLNME <+0> &&SP <+0> &&ROLLCS11 <+0> &&SP3 <+0> &&RCNCT1 <+0> &&SP4 <+0> &&ROLLPHN"
"</2"
"<10 &&RPT_TTL1"
"<10 &&RPT_TTL2"
"</2"
FOOTING BOTTOM
"eTTek Review &DATE AT <NOWTOD <60 &&FOOTR"
-* ON TABLE SET LINES 60000
ON TABLE SET PAGE-NUM OFF
ON TABLE NOTOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=1.250000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=1.000000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
-* TYPE=REPORT, TITLETEXT=EXLOVER, ROWOVERFLOW=ON,$   
TYPE=REPORT,FONT=ARIAL, SIZE=8, COLOR=BLACK, 
    BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=REPORT, COLUMN=N6, WRAP=2.0,$
TYPE=REPORT, COLUMN=N7, WRAP=2.0, $
TYPE=REPORT, COLUMN=N8, WRAP=.75,$
TYPE=REPORT, COLUMN=N9, WRAP=.60, $
TYPE=REPORT, COLUMN=N10, WRAP=.75,$
TYPE=REPORT, COLUMN=N11, WRAP=1.0,$
TYPE=REPORT, COLUMN=N12, WRAP=.50,$
TYPE=REPORT, COLUMN=N13, WRAP=.50,$
TYPE=REPORT, COLUMN=N14, WRAP=.50,$
TYPE=REPORT, COLUMN=N15, WRAP=.50,$
TYPE=REPORT, COLUMN=N16, WRAP=.50,$
TYPE=REPORT, COLUMN=N17, WRAP=1.00,$
TYPE=REPORT, COLUMN=N18, WRAP=.50,$
TYPE=REPORT, COLUMN=N19, WRAP=2.00,$
TYPE=REPORT, COLUMN=N20, WRAP=.50,$
TYPE=REPORT, COLUMN=N21, WRAP=.50,$
TYPE=REPORT, COLUMN=N22, WRAP=.50,$
TYPE=REPORT, COLUMN=N23, WRAP=1.0,$
TYPE=REPORT, COLUMN=N24, WRAP=1.0,$
TYPE=REPORT, COLUMN=N25, WRAP=.50,$
TYPE=REPORT, COLUMN=N26, WRAP=.50,$
TYPE=REPORT, COLUMN=N27, WRAP=1.0,$






TYPE=FOOTING, SIZE=7, FONT=ARIAL, COLOR=RGB(70 136 177), $
TYPE=TABFOOTING,SIZE=7, FONT=ARIAL, COLOR=RGB(70 136 177), $

TYPE=TITLE, SIZE=8, FONT=ARIAL, JUSTIFY=LEFT, STYLE=BOLD, $
TYPE=HEADING, SIZE=9, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=HEADING, LINE=6, SIZE=10, FONT=ARIAL, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=HEADING, LINE=7, SIZE=10, FONT=ARIAL, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=REPORT, IMAGE=&&TNTPIC, POSITION=(&&TNTTRPOS), SIZE=(&&TNTTRSIZ), $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLTRPOS), SIZE=(&&ROLTRSIZ), $
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO JOY


-SET &&SAVEDXLS = '"'| &&TEMPPATH ||&DTTMIID || '.XLS' || '"' ;
-SET &&SAVEDCSV = '"'| &&TEMPPATH ||&DTTMIID || '.CSV' || '"' ;
-RUN

-* assume you have && USERNAME setup already
-* -SET &DESTFILE = "D:\TE\||'&&UNAME.EVAL'|| '\'|'SAVEREP.XLS';
-SET &DESTFILE = '"D:\TE\ |"&&UNAME.EVAL" || "\" | "SAVREP.XLS"';
-* -SET &DESTFILE = &&WEB_PATH || 'SAVREP.XLS';
-RUN

-SET &DESTFILE2 = '"D:\TE\ |"&&UNAME.EVAL" || "\" | "SAVREP.CSV"';
-* -SET &DESTFILE2 = &&WEB_PATH || 'SAVREP.CSV';
-* I think you may use copy command as well
-RUN
-DOS COPY &DESTFILE2
-RUN
-DOS RENAME &DESTFILE &DESTFILE2
-RUN
-DOS COPY &&SAVEDCSV &DESTFILE
-QUIT

-JOY

-IF &RECORDS EQ 0 THEN GOTO NORECORDS ELSE GOTO XXIT;


-NORECORDS
-SET &&RPTSUF = 'MSG';
-INCLUDE FDEFRPTS
-RUN
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADERDD
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT;