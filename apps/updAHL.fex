-GOTO BAIR

-AIR
-SET &&DATPATH = 'D:\TNT\TTRACKER\DATA\';
-SET &&DBUSEA = '';
-SET &&DBUSEC = '';
-SET &&DBUSEH = '';
-SET &&ROLLTARG = '                ';

-UPDLOOP
-TYPE "AIR"

-* This is the trigger file containing the target rollups for update
-*   action - each rollup shall be identified by a single entry
-*   consisting of the company id - e.g. METX or
-*   BAIR - the last record in this trigger file must be END
FILEDEF ROLLLIST DISK D:\TNT\TTRACKER\TEMP\ROLLLIST.TXT (LRECL 80
-RUN
FILEDEF ROLLNEW DISK D:\TNT\TTRACKER\TEMP\ROLLNEW.TXT (LRECL 80
-RUN

-READ ROLLLIST &&ROLLTARG
-IF &&ROLLTARG EQ 'END' THEN GOTO XFER;
-TYPE ROLLTARG &&ROLLTARG

-REPEAT BNEW WHILE &IORETURN EQ 0;
-READ ROLLLIST &&SLINE.80
-IF &IORETURN NE 0 THEN GOTO BNEW;
-WRITE ROLLNEW &&SLINE
-BNEW

FILEDEF ROLLLIST CLEAR
-RUN
FILEDEF ROLLNEW CLEAR
-RUN

COPY D:\TNT\TTRACKER\TEMP\ROLLNEW.TXT D:\TNT\TTRACKER\TEMP\ROLLLIST.TXT
-RUN

-TYPE ROLLTARG &&ROLLTARG

-SET &&TOTLEV = SUBSTR(16, &&ROLLTARG, 7, 7, 1, 'A1');
-SET &&ROLLLEV = SUBSTR(16, &&ROLLTARG, 8, 8, 1, 'A1');
-SET &&ROLLCOMP = SUBSTR(16, &&ROLLTARG, 1, 6, 6, 'A6');
-SET &&ROLLROLL = SUBSTR(16, &&ROLLTARG, 9, 16, 8, 'A8');
-SET &&LEVEL = 'LEVEL' || &&ROLLLEV;

-TYPE ROLLLEV &&ROLLLEV
-TYPE ROLLCOMP &&ROLLCOMP
-TYPE ROLLUP &&ROLLROLL
-TYPE LEVEL &&LEVEL

-SET &&ROLLAIR = 'A_' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR = 'C_' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL = 'H_' || &&ROLLCOMP || '.FOC';
-SET &&ALFILE = 'AL' || &&ROLLCOMP;
-SET &&CLFILE = 'CL' || &&ROLLCOMP;
-SET &&HLFILE = 'HL' || &&ROLLCOMP;
-SET &&ALPATH = &&DATPATH || &&ALFILE || '.MAS';
-SET &&CLPATH = &&DATPATH || &&CLFILE || '.MAS';
-SET &&HLPATH = &&DATPATH || &&HLFILE || '.MAS';

-SET &&AIRIF = 'IF AROLL_LEV1 EQ ''' || &&ROLLROLL || '''';
-* -SET &&CARIF = 'IF CROLL_LEV1 EQ ''' || &&ROLLROLL || '''';
-* -SET &&HTLIF = 'IF HROLL_LEV1 EQ ''' || &&ROLLROLL || '''';
-SET &&AROLL = '''AROLL_LEV' || &&TOTLEV || '''';
-* -SET &&CROLL = '''CROLL_LEV' || &&TOTLEV || '''';
-* -SET &&HROLL = '''HROLL_LEV' || &&TOTLEV || '''';

-TYPE ROLLAIR &&ROLLAIR
-TYPE ROLLCAR &&ROLLCAR
-TYPE ROLLHTL &&ROLLHTL
-TYPE ALPATH &&ALPATH
-TYPE CLPATH &&CLPATH
-TYPE HLPATH &&HLPATH
-TYPE AIRIF &&AIRIF
-* -TYPE CARIF &&CARIF
-* -TYPE HTLIF &&HTLIF
-TYPE AROLL &&AROLL

-SET &&DBUSEA = &&DATPATH || &&ROLLAIR;
USE
&&DBUSEA AS AIR_MAIN
END
-RUN

SET ASNAMES=ON

TABLE FILE AIR_MAIN
PRINT AIR_KEY &&LEVEL AS &&AROLL
BY &&LEVEL NOPRINT
ON TABLE HOLD AS ALHOLD
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK D:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT *
BY &&AROLL NOPRINT
&&AIRIF
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE ALHOLD
PRINT AIR_KEY
BY &&AROLL NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY &&AROLL NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

COPY D:\TNT\TTRACKER\DATA\ALSYSTEM.MAS &&ALPATH
-RUN

CREATE FILE &&ALFILE
END
-RUN

MODIFY FILE &&ALFILE
FIXFORM FROM HOLD
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON HOLD2
END
-RUN

-CAR
-TYPE "CAR"

-SET &&DBUSEC = &&DATPATH || &&ROLLCAR;
USE
&&DBUSEC AS CAR_MAIN
END
-RUN

SET ASNAMES=ON

TABLE FILE CAR_MAIN
PRINT CAR_KEY &&LEVEL AS &&AROLL
BY &&LEVEL NOPRINT
ON TABLE HOLD AS CLHOLD
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
-* FI TTPHIERC DISK D:\AS400\TTPHIERC.TXT

-* TABLE FILE TTPHIERC
-* PRINT *
-* BY &&AROLL NOPRINT
-* &&AIRIF
-* ON TABLE HOLD AS TMPHOLDC
-* END
-* -RUN

MATCH FILE CLHOLD
PRINT CAR_KEY
BY &&AROLL NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY &&AROLL NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY CAR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

COPY D:\TNT\TTRACKER\DATA\CLSYSTEM.MAS &&CLPATH
-RUN

CREATE FILE &&CLFILE
END
-RUN

MODIFY FILE &&CLFILE
FIXFORM FROM HOLD
MATCH CAR_KEY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON HOLD2
END
-RUN

-HOTEL
-TYPE "HOTEL"

-SET &&DBUSEH = &&DATPATH || &&ROLLHTL;
USE
&&DBUSEH AS HTL_MAIN
END
-RUN

SET ASNAMES=ON

TABLE FILE HTL_MAIN
PRINT HTL_KEY &&LEVEL AS &&AROLL
BY &&LEVEL NOPRINT
ON TABLE HOLD AS HLHOLD
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
-* FI TTPHIERH DISK D:\AS400\TTPHIERH.TXT

-* TABLE FILE TTPHIERH
-* PRINT *
-* BY &&AROLL NOPRINT
-* &&AIRIF
-* ON TABLE HOLD AS TMPHOLDH
-* END
-* -RUN

MATCH FILE HLHOLD
PRINT HTL_KEY
BY &&AROLL NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY &&AROLL NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY HTL_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

COPY D:\TNT\TTRACKER\DATA\HLSYSTEM.MAS &&HLPATH
-RUN

CREATE FILE &&HLFILE
END
-RUN

MODIFY FILE &&HLFILE
FIXFORM FROM HOLD
MATCH HTL_KEY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON HOLD2
END
-RUN

-GOTO UPDLOOP

-XFER
-TYPE PROGRAM COMPLETED.......
-EXIT

-BAIR

TABLE FILE HLBAIR
PRINT HTL_KEY 
BY HTL_KEY NOPRINT
IF AROLL_LEV1 EQ ' '
ON TABLE HOLD
END
-RUN

MODIFY FILE HLBAIR
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_LEV1='BAIRD-R';
ON MATCH COMPUTE AROLL_DSC1='(BAIRD-R) R W  BAIRD COMPANY';
ON MATCH COMPUTE AROLL_LEV2='GROUPS';
ON MATCH COMPUTE AROLL_DSC2='(GROUPS) GROUPS';
ON MATCH COMPUTE AROLL_LEV3='DEFGRP3';
ON MATCH COMPUTE AROLL_DSC3='(DEFGRP3) DEFAULT GROUPS TRAVEL LEVEL3';
ON MATCH UPDATE AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 
ON MATCH UPDATE AROLL_DSC3
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT
