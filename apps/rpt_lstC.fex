-* Added Client Selection and Include/Exclude for Client and Category 
-* Steve (03/03/2005)
-* CHANGED PROGRAM TO USE JOIN DUE TO RECORD LIMITATION ON IN FILE COMMAND
-* DEB 4/14/05


-* -INCLUDE SETECHO
SET ASNAMES=ON
-*SET TEMPERASE = OFF
-*FILEDEF XUSER DISK D:\FOCTEMP\XUSER.FTM
SET PAGE-NUM=OFF
SET EMPTYREPORT=ON

-GOTO DEB;
TABLE FILE CONTROL
PRINT USER_ID
BY ROLLUP_CODE
BY SECURITY_LEVEL
ON TABLE SAVE AS XUSER
END
-RUN
-READ XUSER &&RLUP.A8. &&SEC.I1.
-RUN
 



TABLE FILE ROLLUPX
PRINT LOGO_2 
BY ROLLUP_CODE NOPRINT
WHERE ROLLUP_CODE EQ '&&RLUP.EVAL'
ON TABLE SAVE
END
-RUN
-READ SAVE &LOGO2.8.
-SET &LOGO2 = '&LOGO2.EVAL' || '.GIF'; 
-DEB

-SET &&RLUP = 'ABCD-R';
-SET &&SEC = 7;



-IF &&SEC GE 7 THEN GOTO SEC9 ELSE GOTO NORECORDS;





-SEC9




TABLE FILE ROLLSET
SUM GLOBAL_PARM
BY GLOBAL_PARM NOPRINT
WHERE GLOBAL_PARM OMITS 'AB'
IF ROLLUP_CODE EQ '&&RLUP'
ON TABLE HOLD AS DEBHOLD
END
-RUN


TABLE FILE ROLLSET
SUM GLOBAL_PARM
BY GLOBAL_PARM NOPRINT
IF ROLLUP_CODE NE '&&RLUP'
WHERE GLOBAL_PARM OMITS 'AB'
ON TABLE HOLD AS DEBHOLD1
END
-RUN


MATCH FILE DEBHOLD
PRINT GLOBAL_PARM NOPRINT
BY GLOBAL_PARM 
ON TABLE HOLD
RUN
FILE DEBHOLD1
PRINT GLOBAL_PARM NOPRINT
BY GLOBAL_PARM 
AFTER MATCH HOLD AS DEBHOLD2 NEW-NOT-OLD
END
-RUN



TABLE FILE DEBHOLD2
SUM GLOBAL_PARM
BY GLOBAL_PARM   
ON TABLE HOLD AS DEBHOLD3 FORMAT FOCUS INDEX GLOBAL_PARM
END
-RUN


TABLE FILE ROLLSET
PRINT *
BY GLOBAL_PARM
WHERE ROLLUP NE '&&RLUP'
ON TABLE HOLD AS DEBHOLD4 FORMAT FOCUS INDEX GLOBAL_PARM
END
-RUN

JOIN DEBHOLD3.GLOBAL_PARM IN DEBHOLD3 TO DEBHOLD4.GLOBAL_PARM IN DEBHOLD4 AS J3

DEFINE FILE DEBHOLD3
SMRY/A8 = IF SMRY_DTL EQ 'S' THEN 'SUMMARY' ELSE
          IF SMRY_DTL EQ 'D' THEN 'DETAIL' ELSE 'BOTH';
DRILL/A3 = IF DRILLABLE EQ 'Y' THEN 'YES' ELSE 'NO';
PAIR/A11 = IF PAIR_DB EQ 'S' THEN 'SEGMENT' ELSE 
          IF PAIR_DB EQ 'M' THEN 'MARKET' ELSE
          IF PAIR_DB EQ 'D' THEN 'DESTINATION' ELSE ' ';
GROUP/A20 = IF RPT_GROUP EQ 'OTH' OR 'OTM' THEN 'TRAVEL SUMMARY' ELSE
            IF RPT_GROUP EQ 'ADD' THEN 'AIR DUAL DATE' ELSE
            IF RPT_GROUP EQ 'HDD' THEN 'HOTEL DUAL DATE' ELSE
            IF RPT_GROUP EQ 'CDD' THEN 'CAR DUAL DATE' ELSE
            IF RPT_GROUP EQ 'EXC' THEN 'EXECUTIVE OVERVIEW' ELSE
            IF RPT_GROUP EQ 'AIR' THEN 'AIR' ELSE
            IF RPT_GROUP EQ 'CAR' THEN 'CAR' ELSE
            IF RPT_GROUP EQ 'HTL' THEN 'HOTEL' ELSE
            IF RPT_GROUP EQ 'QTR' THEN 'NEW QUARTERLY REVIEW' ELSE ' ';
           
            
          
                        
END
-RUN



TABLE FILE DEBHOLD3
HEADING
" "
" "
" "
"eTTek Review"
"&DATE ........ &TOD        REPORT LISTING FOR : &&RLUP"
"REPORT NAME:  RPT_LSTC.FEX"
" "
" "
BY ROLLUP          AS 'ROLLUP CODE'
BY GROUP           AS 'REPORT GROUP'
-* BY GLOBAL_PARM      AS 'REPORT ID'
PRINT GLOBAL_PARM AS 'REPORT ID'
      PAIR        AS 'FILE TYPE'
      SMRY        AS 'REPORT TYPE'
      DRILL       AS 'DRILLABLE'        
      DESC1       AS 'DESCRIPTION1'
      DESC2       AS 'DESCRIPTION2'
ON ROLLUP SKIP-LINE
ON TABLE SET ONLINE-FMT PDF
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.200000, RIGHTMARGIN=0.200000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=6, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, OBJECT=TEXT, SIZE=8, COLOR=BLACK, STYLE = BOLD ,$
TYPE=HEADING, LINE=4, SIZE=8, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=5, SIZE=8, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=6, SIZE=8, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=7, SIZE=8, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=8, SIZE=8, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=10, SIZE=8, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=11, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=12, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=FOOTING, SIZE=7, STYLE=BOLD, COLOR=GREY, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBFOOT, SIZE=14, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=9, STYLE=BOLD, $
TYPE=GRANDTOTAL, SIZE=9, STYLE=BOLD, $
-* TYPE=REPORT, IMAGE=&&TNTPIC, POSITION=(.5 .5 ), SIZE=(1.5 .4), $
-* TYPE=REPORT, IMAGE=&LOGO2, POSITION=(.5 .5 ), SIZE=(1.5 .4), $
END

-GOTO DONE;











-NORECORDS

DEFINE FILE ROLLSET
FLAG/A1 = IF &&SEC LT 7 THEN 'Y' ELSE 'N';
FLAG1/A70 = IF FLAG EQ 'Y' THEN 
'THIS OPTION NOT AVAILABLE TO USER WITH SECURITY LEVEL OF 5 OR BELOW' ELSE ' ';
END



TABLE FILE ROLLSET
PRINT FLAG1 AS '&&RLUP.EVAL' 
BY ROLLUP NOPRINT 
WHERE ROLLUP EQ '&&RLUP'
WHERE RECORDLIMIT EQ 1
ON TABLE SET ONLINE-FMT PDF
ON TABLE SET STYLE *
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=12, BACKCOLOR=NONE, STYLE=NORMAL, $
-* TYPE=REPORT, IMAGE=&&TNTPIC, POSITION=(.2 .2 ), SIZE=(1.5 .4), $
-* TYPE=REPORT, IMAGE=&LOGO2, POSITION=(.5 .5 ), SIZE=(1.5 .4), $
END
-RUN


-DONE
