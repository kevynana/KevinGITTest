-********************************************************************
-* DRILWHRS.FEX
-********************************************************************
-INCLUDE SETECHO
-TYPE RUNNING DRILWHRS


-SET &&HLDAFIL = &&WEB_PATH ||'HOLDA.FTM';
-SET &&HLDBFIL = &&WEB_PATH ||'HOLDB.FTM';
-SET &&HLDDFIL = &&WEB_PATH ||'HOLDD.FTM';

-IF &&DEPLOY EQ 'W' GOTO SETWEB;
-*-SET &&LOCPATH = 'D:\TT\ '|| &&ROLLUP || '\ '||&&UNAME.EVAL||'\';
-*-SET &&DRILLBYS = &&LOCPATH || 'DRILLBYS.FTM';
-SET &FILEXIST = &&LOCPATH ||&&DTTMSTRM ||'DRILLBYS.FTM';
-SET &&DRILLBYS = &&LOCPATH ||&&DTTMSTRM ||'DRILLBYS.FTM';
-GOTO CHKFORMAT;

-SETWEB
-*-SET &&WEBPATH = 'D:\TTWEB\ ' || &&ROLLUP || '\ '||&&UNAME.EVAL||'\';
-*-SET &&DRILLBYS = &&WEBPATH || 'DRILLBYS.FTM';
-SET &FILEXIST = &&WEBPATH ||&&DTTMSTRM ||'DRILLBYS.FTM';
-SET &&DRILLBYS = &&WEBPATH ||&&DTTMSTRM ||'DRILLBYS.FTM';

-CHKFORMAT
STATE &FILEXIST
-RUN
-IF &RETCODE NE 0 GOTO NOFILE;

FILEDEF DRILLBYS DISK &&DRILLBYS 
FILEDEF HOLDA DISK &&HLDAFIL 
-RUN

TABLE FILE DRILLBYS
PRINT DRIL_COL DRIL_FLD
ON TABLE HOLD AS HOLDA FORMAT ALPHA
END
-RUN

-SET &CNT = 1;
-SET &NCNT = 0;
-SET &COL1 = '';
-SET &COL2 = '';
-SET &COL3 = '';
-SET &LOOPVAR = 1;
-DEFAULT &DCOL = '';
-DEFAULT &DFLD = '';
-SET &DCOL = &DCOL;
-SET &DFLD = &DFLD;
-RUN

FILEDEF HOLDA DISK &&HLDAFIL 
-RUN

-COLLOOP
-REPEAT LOOPER WHILE &LOOPVAR EQ 1; 
-READ HOLDA &DCOL.A3. &DFLD.A50.
-SET &LOOPVAR = IF &DCOL EQ 'EOF' THEN 0 ELSE 1;
-IF &DCOL EQ 'EOF' THEN GOTO ENDLOOP;
-SET &NCNT = &NCNT+1;
-IF &CNT EQ 1 GOTO SET1;
-IF &CNT EQ 2 THEN GOTO SET2;
-IF &CNT EQ 3 THEN GOTO SET3;

-SET1
-SET &COL1 = &DFLD;
-SET &CNT = &CNT+1;
-GOTO ENDLOOP;

-SET2 
-SET &COL2 = &DFLD;
-SET &CNT = &CNT+1;
-GOTO ENDLOOP;

-SET3
-SET &COL3 = &DFLD;
-SET &CNT = &CNT+1;
-GOTO ENDLOOP;

-ENDLOOP
-LOOPER
-RUN

-SET &COLCOMB = &COL1 || ' &COL2.EVAL' || ' &COL3.EVAL';

-TYPE DRILLRPT IS &&DRILLRPT

FILEDEF HOLDB DISK &&HLDBFIL 
FILEDEF HOLDD DISK &&HLDDFIL 
-RUN

TABLE FILE &&DRILLRPT
PRINT &COLCOMB
ON TABLE HOLD AS HOLDB
END
-RUN

CHECK FILE HOLDB HOLD 

TABLE FILE HOLD
PRINT FORMAT ACTUAL FIELDNAME
ON TABLE HOLD AS HOLDD FORMAT ALPHA
END
-RUN


-SET &CNT = 1;
-SET &FRMT1 = '';
-SET &FRMT2 = '';
-SET &FRMT3 = '';
-DEFAULT &DFORMAT = '';
-SET &DFORMAT = &DFORMAT;
-RUN

FILEDEF HOLDD DISK &&HLDDFIL
-RUN

-REPEAT READLOOP &NCNT TIMES;
-READ HOLDD &DFORMAT.A1.
-IF &CNT EQ 1 GOTO RSET1;
-IF &CNT EQ 2 THEN GOTO RSET2;
-IF &CNT EQ 3 THEN GOTO RSET3;

-RSET1
-SET &FRMT1 = &DFORMAT;
-SET &CNT = &CNT+1;
-GOTO ENDLOOP2;

-RSET2 
-SET &FRMT2 = &DFORMAT;
-SET &CNT = &CNT+1;
-GOTO ENDLOOP2;

-RSET3
-SET &FRMT3 = &DFORMAT;
-SET &CNT = &CNT+1;
-GOTO ENDLOOP2;

-ENDLOOP2
-READLOOP

-**********************************************************************
-* GENERATE SELECTION CRITERIA FOR DETAIL REPORT - WHERE STATEMENTS
-**********************************************************************
-* CREATE &&DRILLWHR TO BE INCLUDED IN THE DETAIL FEXS
-**********************************************************************
-IF &&DEPLOY EQ 'W' GOTO WEBWHR;
-SET &&DRILLWHR = &&WEB_PATH || 'DRILLWHR.FTM';
-GOTO CONTD;

-WEBWHR
-SET &&DRILLWHR = &&WEB_PATH || 'DRILLWHR.FTM';

-CONTD
FILEDEF DRILLWHR DISK &&DRILLWHR
-RUN

-SET &BYCNT = 0;
-SET &SCNT = 0;

-****************************************************
-* CREATE BLANK 'WHERE STATEMENT' FOR HEADER DRILL
-****************************************************
-IF &&COLNBR GT 0 GOTO WHRLOOP;
-SET &WHRPARM = ' ';
-WRITE DRILLWHR NOCLOSE &WHRPARM
-GOTO ENDWHRLOOP;

-WHRLOOP 
-SET &CNT = 1;

-REPEAT LOOPER2 &&COLNBR TIMES;
-SET &FFRMT = IF &CNT EQ 1 THEN &FRMT1 
- ELSE IF &CNT EQ 2 THEN &FRMT2 
- ELSE IF &CNT EQ 3 THEN &FRMT3;  
-SET &CNT = &CNT+1;
-SET &BYCNT = &BYCNT + 1;
-SET &SCNT = &SCNT + 1;
-SET &CRBFLD = '&&' | 'BYFLD' | &BYCNT;
-SET &CRSFLD = '&&' | 'SFLD' | &SCNT;
-IF &FFRMT EQ 'A' GOTO SETA;

-SETN
-SET &WHRPARM1 = ' WHERE ' | &CRSFLD.EVAL;
-SET &WHRPARM2 =' EQ ';
-SET &WHRPARM3 = &CRBFLD.EVAL;
-SET &WHRPARM = &WHRPARM1 | &WHRPARM2 | &WHRPARM3.EVAL | ';';
-GOTO WRITWHR;

-SETA
-SET &WHRPARM1 = ' WHERE ' | &CRSFLD.EVAL;
-SET &WHRPARM2 =' EQ ';
-SET &WHRPARM3 = &CRBFLD.EVAL;
-SET &WHRPARM = &WHRPARM1 | &WHRPARM2 | '''&WHRPARM3.EVAL''' | ';';

-WRITWHR
-WRITE DRILLWHR NOCLOSE &WHRPARM

-LOOPER2
-RUN

-ENDWHRLOOP

FILEDEF DRILLWHR DISK CLEAR
-RUN
FILEDEF DRILLWHR DISK &&DRILLWHR
-RUN
-GOTO SKIP_HFORM;

-NOFILE
-HTMLFORM BEGIN
<HTML>
<HEAD>

</HEAD>
<BODY>


<TITLE> TRAVEL & TRANSPORT</TITLE>
<CENTER><H2>THE REPORT IS NO LONGER DRILLABLE!!!</H2></CENTER>

<CENTER><H4>PLEASE GO BACK TO THE PREVIOUS PAGE USING </H4></CENTER>
<CENTER><H3>BACK BUTTON OF THE BROWSER</H3></CENTER> 

</BODY>
</HTML>
-HTMLFORM END

-EXIT
-SKIP_HFORM
