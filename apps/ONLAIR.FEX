-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* This was created for the WWF Transaction detail

-*04/20/10   DEB                CHANGED ORIG_SALE DEFINE
-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-* ADDED TRANTYPE INCLUDE - JK 12/30/14 STORY ID S-06492
-*4/25/2017-JEM-S-33318-updated logic for no records report


-INCLUDE SETECHO

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &&OAFLG = 'N';



DEFINE FILE &&EXTRACT    
FARE_PAID/D12.2CS= SEG_AMT + SEG_TAX;
LEVEL_DESC/A60 = &&LDESC;
TKT_CNT/D8CS = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT 
  EQ 1) THEN 1 ELSE 0;
BKD_ONLINE/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';
-* BKD_ONLINE/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';

XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
XTRAN_DT/MDYY        = TRN_DATE;   
-* DEFINES ON PREVIOUS DEFINES
-*ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT 
-* EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE IF (DOC_TYPE EQ '1') AND
-* (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') THEN 1 ELSE 0;


ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND 
     (SEG_COUNT EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE 
     IF (DOC_TYPE EQ '1') AND (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') AND
     (RF_FLAG EQ ' ') THEN 1 ELSE 0;	



-* PAX/A5 = EDIT(XPSNGR_NM, '99999$$$$$$$$$$');
EXCHGS/D9 = IF (EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK 
  NE 'DT1' OR 'RF1' OR 'FP3') THEN TKT_CNT ELSE
  IF (DOC_TYPE EQ '1') AND (EXCHG_SALE EQ 'E') THEN 0 ELSE
  IF (SEG_COUNT GE 0) AND (EXCHG_SALE NE ' ') THEN TKT_CNT ELSE 0;
EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') THEN 1 ELSE 0; 
PAX/A5 = EDIT(XPSNGR_NM, '99999$$$$$$$$$$');


FEE/P5.2S = IF BKD_ONLINE EQ 'N' THEN 38 ELSE 12;
LINE_DESC/A38 = XPSNGR_NM||TKT_NUM||PNR_LOCATOR|' '|'A';          
XDPT_DT/MDYY=DPT_DATE;
-INCLUDE TRANTYPE
END

TABLEF FILE &&EXTRACT
PRINT PNR_LOCATOR
     
WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) 
WHERE ORIG_SALE NE 0 OR EXMCOS NE 0 OR EXCHGS NE 0
WHERE BKD_ONLINE EQ 'Y'

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10



-INCLUDE RPTPARMS

ON TABLE HOLD AS AIRHOLD
END
-RUN


-SET &&AIRREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';
-IF &LINES EQ 0 THEN GOTO NOAIR;

DEFINE FILE AIRHOLD
AIR/A1 = 'Y';
END
TABLE FILE AIRHOLD
SUM PNR_LOCATOR AIR 
BY PNR_LOCATOR NOPRINT
ON TABLE HOLD AS ONLAIRT
END
-RUN



-NOAIR