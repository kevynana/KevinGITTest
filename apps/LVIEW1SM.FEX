-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File LVIEW1SM.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-* 6/2/09        DEB               CREATED FROM CVIEW1SM 
-*10/02/2017 JEM S-35468 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets

-**********************************************************************


SET ASNAMES = ON
-RUN
-INCLUDE SETECHO

-IF &&SETF EQ 'ABLIMVDR' AND &&CURRENCY NE 'USD' THEN GOTO LVNDR ELSE GOTO NEXT;

-LVNDR;

-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &CAVG_CUR = 'AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &&S_SUBJ3='AMT_RENTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''' ;
-SET &&S_SUBJ4='PCT.AMT_RENTL1/D8.1 AS ''% OF,TOTAL,RENTAL,AMOUNT''';
-SET &&S_SUBJ5='COMPUTE GAVGDR/D16.2CS=IF ((RENTAL_DAYS LT 0) AND';
-SET &&S_SUBJ6='(AMT_RENTL1 LT 0)) THEN ((AMT_RENTL1/RENTAL_DAYS)*(-1)) ELSE';
-SET &&S_SUBJ7='IF ((RENTAL_DAYS LT 1) AND (RENTAL_DAYS GT (-1))) THEN 0 ELSE';
-SET &&S_SUBJ8='AMT_RENTL1/RENTAL_DAYS; AS ' | '''&CAVG_CUR.EVAL''';


-NEXT


TABLE FILE LIMHOLD2
SUM AVG_DLY_RATE/D12.2CS AS 'CAVG'
    BOOKINGS/D8 AS 'CBOOK'
    GROSS_BOOK/D8 AS 'GBOOK'
    BKGS2/D8 AS 'GBOOK2'
    DAILY_RATE/D12.2CS AS 'CDRTE'
    MIDBOOK/D8 AS 'CMBOOK'
    MID_DAYS/D8 AS 'CMDAYS'
    MID_AMT/D12.2CS AS 'CMAMT'
    NBR_DAYS AS 'CNDAY'
    NONMIDBOOK/D8 AS 'CNMBOOK'
    NONMID_AMT/D12.2CS AS 'CNMAMT'
    NONMID_DAYS/D8 AS 'CNMDAYS'
    NONZE_AMT/D12.2CS AS 'CNZEAMT'
    NONZEBOOK/D8 AS 'CNZEBK'
    NONZE_DAYS/D8 AS 'CNZDAYS'
    RATE_DLY1/D16.2CS AS 'GCDRTE'
    RENTAL_AMT/D12.2CS AS 'CRAMT'
    RENTAL_DAYS/D12.2CS AS 'CRDAYS'
    RESV_BRANCH
    STD_RATE/D12.2CS AS 'CSTD'
    ZE_AMT/D12.2CS AS 'CZEAMT'
    ZEBOOK/D8 AS 'CZEBOOK'
    ZE_DAYS/D8 AS 'CZDAYS'
    AMT_RENTL1/D16.2CS AS 'GCRAMT'
    
    COMPUTE AVGDR/D12.2CS=IF (RENTAL_AMT LT 0) AND (NBR_DAYS LT 0)
	THEN ((RENTAL_AMT/NBR_DAYS) * (-1)) 
	ELSE RENTAL_AMT/NBR_DAYS; AS 'AVG,DAILY,RATE'
-INCLUDE BYHIERARCHY
  
BY LEVEL_DESC    
-INCLUDE OTHPARMS
ON TABLE HOLD AS HOLDONE
END
-RUN


DEFINE FILE LIMHOLD2
ABSRD/D8 = ABS(RENTAL_DAYS);
END
TABLE FILE LIMHOLD2
PRINT ABSRD 
  AGENT_NUM
  AIRPORT_CODE	
  AIRPORT_NAME
  AMT_RENTL1	
  AVG_DLY_RATE
  AVGDR
  BKGS2
  BOOKINGS
  BR_CL_IDX
  BZ_SRC
  CAR	
  CAR_CAT
  CAR_DESC
  CAR_TOT
  CAR_TYPE	
  COUNTRY_NAME
  CC_NUM	
  DAILY_RATE
  DOD_TYPE
  DROP_CTY_NAME	
  DROP_DAY
  DROP_OFF_DT
  GROSS_BOOK	
  IBOOK
  INVOICE_NUM
  INV_MY
  KB_AGT
  LEVEL1
  LEVEL2
  LEVEL3
  MIDBOOK
  MID_AMT
  MID_DAYS
  NAMEC
  NEW_RENTL_AMT
  NEW_STD_RATE 
  NBR_DAYS
  NMBR_DAYS
  NODAYS	
  NONMIDBOOK
  NONMID_AMT
  NONMID_DAYS
  NONZE_AMT
  NONZEBOOK
  NONZE_DAYS
  NUM_CARS
  PASSNGR_NAME	
  PICK_DAY
  PICK_UP_DT
  PICK_CTY_NAME	
  PNR_LOCATOR
  RATE_DLY1
  RENTAL_AMT
  RENTAL_DAYS	
  RESV_BRANCH
  RNTL_TYP
  RSNCDE
  STD_RATE
  TOTAL_STD
  VENDOR_CODE	
  VENDOR_NAME
  VENDOR_NM
  XSPACE	
  ZE_AMT
  ZEBOOK
  ZE_DAYS
  XLEVEL3
  XLEV_3
  XLVL3
  ZE_VNDR 
COMPUTE AVGDR/D12.2CS=IF (RENTAL_AMT LT 0) AND (NBR_DAYS LT 0)
	THEN ((RENTAL_AMT/NBR_DAYS) * (-1)) 
	ELSE RENTAL_AMT/NBR_DAYS; AS 'AVG,DAILY,RATE'

-INCLUDE BYHIERARCHY
BY LEVEL_DESC
BY REFUSE_CD

-INCLUDE CARRATE

ON TABLE HOLD AS XTWO
END
-RUN



MATCH FILE XTWO
PRINT ABSRD 
  AGENT_NUM
  AIRPORT_CODE	
  AIRPORT_NAME
  AMT_RENTL1	
  AVG_DLY_RATE	
  AVGDR
  BKGS2
  BOOKINGS
  BR_CL_IDX
  BZ_SRC
  CAR
  CAR_CAT
  CAR_DESC	
  CAR_TOT
  CAR_TYPE
  COUNTRY_NAME	
  CC_NUM	
  DAILY_RATE
  DOD_TYPE
  DROP_CTY_NAME	
  DROP_DAY
  DROP_OFF_DT
  GROSS_BOOK
  IBOOK
  INV_MY
  INVOICE_NUM
  KB_AGT
  LEVEL1
  LEVEL2
  LEVEL3
  MIDBOOK
  MID_AMT
  MID_DAYS
  NBR_DAYS
  NAMEC
  NEW_RENTL_AMT
  NEW_STD_RATE
  NMBR_DAYS
  NODAYS	
  NONMIDBOOK
  NONMID_AMT
  NONMID_DAYS
  NONZE_AMT
  NONZEBOOK
  NONZE_DAYS
  NUM_CARS
  PASSNGR_NAME	
  PICK_CTY_NAME
  PICK_DAY
  PICK_UP_DT
  PNR_LOCATOR
  RATE_DLY1	
  RENTAL_AMT
  RENTAL_DAYS	
  RESV_BRANCH
  RNTL_TYP
  RSNCDE
  STD_RATE
  TOTAL_STD
  VENDOR_CODE	
  VENDOR_NAME
  VENDOR_NM
  XSPACE	
  ZE_AMT
  ZEBOOK
  ZE_DAYS
  XLEVEL3
  XLEV_3 
  XLVL3
  ZE_VNDR
-INCLUDE BYHIERARCHY
BY LEVEL_DESC
BY REFUSE_CD
ON TABLE HOLD
RUN
FILE HOLDONE
SUM 
    CAVG 
    CBOOK
    CDRTE
    CMAMT
    CMBOOK
    CMDAYS
    CNDAY
    CNMAMT
    CNMBOOK
    CNMDAYS
    CNZEAMT
    CNZEBK
    CNZDAYS
    CRAMT
    CRDAYS
    CSTD
    CZEAMT
    CZEBOOK
    CZDAYS
    GBOOK
    GBOOK2
    GCDRTE
    GCRAMT
-INCLUDE BYHIERARCHY
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN
 


DEFINE FILE XTHREE
-*   PCTCRAMT/D8.1S=IF (RENTAL_AMT LT 0) AND (CRAMT LT 0) THEN
-*                  ((RENTAL_AMT/CRAMT)*(-100)) ELSE ((RENTAL_AMT/CRAMT)*100);
  PCTCRAMT/D8.1S = IF ((CRAMT LT 1) AND (CRAMT GT (-1))) THEN 0
                   ELSE ((RENTAL_AMT/CRAMT)*100);
  PCTBK/D8.1S=IF ((CBOOK LT 1) AND (CBOOK GT (-1))) THEN 0
                 ELSE ((BOOKINGS/CBOOK)*100);	
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
-INCLUDE DefineSubtotalFields
END

-*-IF '&&SETF.EVAL' NE 'ABLIMVDR' THEN GOTO Report;

-*-SET &&BREAKOPTION =  '                                      ';

-*-Report

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE XTHREE
-INCLUDE &&PAHDR
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
  
-*BY
-IF &&MULTIBREAK NE 'Y' THEN GOTO :NOMULTBREAK;
-INCLUDE LevelNOPRINT
-:NOMULTBREAK
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-IF &&MULTIBREAK NE 'Y' OR &&ALTHIER NE 'Y' THEN GOTO :NOMULTOTAL;
-INCLUDE TOTALBYHIERARCHY
-GOTO SKIPBREAKOPT;
-:NOMULTOTAL
&&BREAKOPTION
-SKIPBREAKOPT
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-* FOOTING BOTTOM
-INCLUDE FOOTERSM
-* ON TABLE COLUMN-TOTAL
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&SETF EQ 'ABCCARBN' OR 'BZLIMSRC' THEN GOTO SKIP_DRILL;

-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT



-XXIT
