 
-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-********************************************************************
-* Modifications:
-* CREATED FOR DATA VAULT AIR DETAIL REPORT CREATED FROM AVIW74DT
-* Carried through EX_IND and changed FARE calculation for EVEN exchanges
-* 
-* Deb 3/18/14A
-* 4/7/14 - Deb - Added code for no records for MZEXCH 
-* 5/6/14 - Deb - Corrected code for no records for MZEXCH 
-*                if report had records did not return to screen or email
-*5/20/14 - Deb - corrected no html error for ABADMIN carrying through
-*                RTOW_FLAG
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 6/9/2015  JEK S-07984 Added fare paid and updated titles for ABADMIN Report
-* 6/11/15   JEK S-09618 Added fare paid and updated titles for ABADMIN1 Report
-*12/28/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*2/5/16 - JEM - S-15339 -Added logic new report EJADMIN and carried through cgbook1 flag
-*6/27/16-JEM-S-20491-Added AROLL_DSC7 and logic for new report cryadmin
-*7/11/16 -DLV -  S-20630  Carried through EMP_ID  
-* 01/24/2017 - DLV - S-26061 - Added NXCSAV to DVCSAV routine and added LEVEL5 LEVEL6 LEVEL7 
-*03/03/2017 - JEM - S-31478 Updated LOW_AMT define to not account for ADD_C and EX_IND just use the TLOW also added lost_sav_amt1 compute 
-*4/21/2017-JEM-S-33318-updated logic for no records report
-* 09/15/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = 
-********************************************************************

SET ASNAMES=ON
-RUN
-INCLUDE SETECHO

-SET &LV1 = ' ';
-SET &LV2 = ' '; 
-SET &LV3 = ' ';
-SET &LV4 = ' ';
-SET &&SUBHEAD = IF '&&ROLLUP.EVAL' EQ 'THOMCO-R' THEN <MV_CCNUM ELSE ' ';
 

TABLE FILE &&RPT_HOLD
SUM DISSAVINGS AS 'DTSAVE' 
    FARE_PAID AS 'TFARE'
    TSFARE_PAID AS 'TSFARE'
    MRK_TKT_CNT AS 'TMKT'
    NET_COMM AS 'NCOMM'
    NEW_SEG_AMT AS 'TBASE'
    SAVINGS AS 'TSAVE'
    SEG_COM AS 'TSCOM'
    SEG_DISCOUNT AS 'TDISC'
    SEG_LOWEST AS 'TLOW'
    SEG_STANDARD AS 'TSTD'
    VASAVINGS AS 'TVSV'
    NEW_SEG_MILES/D9CS AS 'TMILE'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
-IF &&SETF NE 'TSAADMIN' OR 'TSUNITED' OR 'ABADMIN' OR 'SKADMIN' THEN GOTO NoWhere;
WHERE EX_FLAG EQ ' '
-NoWhere
ON TABLE HOLD AS AIRHOLD1
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT ACCT
  ADDCOLLECT
  AGENT_NUM
  AIR
  AIR_KEY	
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NAME
  AIRLINE_NUM
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  AROLL_DSC7
  AUX_TYPE
  BR_CL_IDX
  CGBOOK
  CGBOOK1
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DST_APC
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  EX_FLAG
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_ARR_DATE
  FST_DPT_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  MV_CCNUM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME 
  PENALTY_AMT
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTN_DATE
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TRAN_MONTH
  TRAN_MY	
  TRN_DATE
  TRIP_PURPOSE
  TRIP_RSN
  TRIPRSN
  TRP_DESC 
  TSFARE_PAID
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
-IF &&SETF NE 'TSAADMIN' OR 'TSUNITED' OR 'ABADMIN' OR 'SKADMIN' OR 'EJADMIN' OR 'CRYADMIN' THEN GOTO NoWhere2;
WHERE EX_FLAG EQ ' '
-NoWhere2
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT ACCT
  AGENT_NUM
  AIR
  AIR_KEY	
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NAME
  AIRLINE_NUM
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  AROLL_DSC7
  AUX_TYPE
  BR_CL_IDX
  CGBOOK
  CGBOOK1
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DST_APC
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  EX_FLAG
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_ARR_DATE
  FST_DPT_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  MV_CCNUM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PENALTY_AMT
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTN_DATE
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRN_DATE
  TRIP_RSN
  TRIPRSN
  TRP_DESC 
  TSFARE_PAID
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TBASE
      TDISC
      TFARE
      TLOW
      TMKT
      TSFARE
      NCOMM
      TSCOM
      TMILE
      TSAVE
      TSTD
      TVSV
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN



 


-IF &&SETF EQ 'TSAADMIN' OR 'TSUNITED' OR 'HHARDTL' OR 'ABADMIN' OR 'ABADMIN1' OR 'SKADMIN' OR 'EJADMIN' OR 'CRYADMIN' THEN GOTO 'TSAdmin';
-IF &&SETF EQ 'DVCSAV' OR 'NXCSAV' THEN GOTO 'CostSav';
-IF &&SETF EQ 'MVCCLST' OR 'VTAIRDTL' OR 'HRGCCLST' OR 'HMHCCLST' OR 'SNKCCLST'
- OR 'CFCCLST' OR 'ARCEXCH' OR 'MZEXCH' OR 'ABACTIVY' OR 'WELACTIV' OR 
- 'PRACTIV' OR 'CLACTIVY' THEN GOTO 'MEVENT';
-IF &&SETF EQ 'TAAIR' THEN GOTO 'TELECA';


TABLE FILE AIRHOLD2
PRINT ACCT
  AGENT_NUM
  AIR_KEY	
  AIRLINE	
  AIRLINE_NAME
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_DPT_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTN_DATE
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRP_DESC
  TRN_DATE
  TSAVE
  TSCOM	
  TSTD
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  TVSV
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN


-GOTO Skipit;

-CostSav


TABLE FILE AIRHOLD2
PRINT ACCT
  AGENT_NUM
  AIRLINE	
  AIRLINE_NAME
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7  
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRN_DATE
  TRIP_RSN
  TRIPRSN
  TRP_DESC 
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
BY AIR_KEY
ON TABLE HOLD AS AIRDATAV
END
-RUN


-INCLUDE RETUDID
-RUN


EX UDDATAV
-RUN

-Skipit;

-INCLUDE DATAVROLL

-GOTO Continue;

-TSAdmin

 


DEFINE FILE XTWO
 REC_CNT/D8CS = IF NET_TKT_CNT EQ 1 THEN 1 ELSE 0;
  TTLDAYS/D8 = NEW_ADV_PURCH*REC_CNT;
  
END                    
TABLE FILE XTWO
SUM NET_TKT_CNT AS 'PTTKT'
REC_CNT
TTLDAYS
COMPUTE PADV/P8 = IF ((REC_CNT LT 1) AND (REC_CNT GT (-1))) THEN 0 ELSE 
            (TTLDAYS/REC_CNT); 
BY LEVEL_DESC 
BY XPSNGR_NM

BY TKT_NUM
BY AIR_KEY
ON TABLE HOLD AS PHOLDONE
END
-RUN

MATCH FILE AIRHOLD2
PRINT ACCT
  AGENT_NUM
  AIRLINE	
  AIRLINE_NAME
  AROLL_DSC7
  AUX_TYPE
  BR_CL_IDX
  CGBOOK
  CGBOOK1
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TRP_DESC
  TSFARE_PAID
  TSAVE
  TSCOM
  TSFARE
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY AIR_KEY
RUN
FILE PHOLDONE
PRINT PADV
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY AIR_KEY
AFTER MATCH HOLD AS MATCHTWO OLD-OR-NEW
END
-RUN

-INCLUDE TSACITY
-RUN


MATCH FILE MATCHTWO
PRINT ACCT
  AGENT_NUM
  AIR_KEY	
  AIRLINE	
  AIRLINE_NAME
  AROLL_DSC7
  AUX_TYPE
  BR_CL_IDX
  CGBOOK
  CGBOOK1
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TRP_DESC
  TSFARE_PAID
  TSFARE
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  PADV
BY AIR_KEY
RUN 
FILE DEBTEST2
SUM CITYS
BY AIR_KEY
AFTER MATCH HOLD AS XTHREE OLD-AND-NEW
END
-RUN



-IF '&&SETF.EVAL' NE 'HHARDTL' THEN GOTO Tsa2;

 
EX UDHARTE
-RUN

-GOTO Continue;

-Tsa2

 

-INCLUDE TSAEXCH
-RUN


-IF '&TSAEXFLG.EVAL' EQ 'N' THEN GOTO NoUse;

-INCLUDE TSAUDID
-RUN



 
MATCH FILE XTHREE
PRINT ACCT
  AGENT_NUM
  AIRLINE	
  AIRLINE_NAME
  AROLL_DSC7
  BR_CL_IDX
  CGBOOK
  CGBOOK1
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TSFARE_PAID
  TSFARE
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  PADV
  CITYS
BY AIR_KEY
RUN
FILE TSAHOLD3
SUM ADD_COLL EX_IND TRP_RSN
BY AIR_KEY
AFTER MATCH HOLD AS XFOUR OLD-OR-NEW
END
-RUN



TABLE FILE XFOUR
PRINT ACCT
  AGENT_NUM
  AIRLINE	
  AIRLINE_NAME
  AROLL_DSC7
  BR_CL_IDX
  CGBOOK
  CGBOOK1
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TSFARE_PAID
  TSFARE
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  PADV
  CITYS
 ADD_COLL
 EX_IND
 TRP_RSN
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3
END
-RUN



-GOTO Continue;



-NoUse
 

DEFINE FILE XTHREE
ADD_COLL/D12.2C  = 0;
-* EX_IND/A1 = ' ';
TRP_RSN/A2 = '  ';
END
TABLE FILE XTHREE
PRINT ACCT
  AGENT_NUM
  AIRLINE	
  AIRLINE_NAME
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CTY_CD
  EMB_CNTRY_CODE
  EMP_ID
  FARE_BAS
  FARE_PAID
  FLIGHT
  FREQ_FLYER
  FF_MILES
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MRK_TKT_CNT
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  RTOW_FLAG
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TSFARE_PAID
  TSFARE
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  PADV
  CITYS
  ADD_COLL
  EX_IND
  TRP_RSN
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3 
END
-RUN




-GOTO Continue;
  
-MEVENT;

-INCLUDE PFXUSE
-RUN

DEFINE FILE AIRHOLD2
FLAG/A1 = 'A';
END
TABLE FILE AIRHOLD2
PRINT ACCT
  AGENT_NUM
  AIR
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NAME
  AIRLINE_NUM
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLAG
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_ARR_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  MV_CCNUM
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PENALTY_AMT
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRN_DATE
  TRP_DESC  
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT  
BY AIR_KEY 
ON TABLE HOLD AS AIRHOLD4  
END
-RUN




TABLE FILE &&RPT_HOLD
SUM FARE_PAID/D12.2CS AS 'TOTAMT'
BY LEVEL_DESC
ON TABLE HOLD AS AIRHOLD5
END
-RUN


MATCH FILE AIRHOLD4
PRINT AIR
  AIR_KEY
  AGENT_NUM
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NUM
  AIRLINE_NAME
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLAG
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_ARR_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  MV_CCNUM
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PENALTY_AMT
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRN_DATE
  TRP_DESC
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE AIRHOLD5
SUM TOTAMT
BY LEVEL_DESC
AFTER MATCH HOLD AS MATCHONE OLD-OR-NEW
END
-RUN


-TYPE before join

JOIN AIR_KEY IN AIRHOLD4 TO ALL AIR_KEY IN PFHOLDA
-RUN


DEFINE FILE AIRHOLD4
FEE/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF TKT_TYPE NE ' ' THEN 0 ELSE
              IF TKT_SORT NE LAST TKT_SORT THEN FEE_AMT ELSE 0;
FLAG/A1 = 'A';
END
TABLE FILE AIRHOLD4
PRINT AIR
  AIR_KEY 
  ACCT
  AGENT_NUM
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NAME
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLAG
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_ARR_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  MV_CCNUM
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRN_DATE
  TRP_DESC
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  FEE AS 'FEE_AMT'
BY FLAG
BY PASSNGR_NAME
WHERE AIRHOLD4.AIR_KEY EQ PFHOLDA.AIR_KEY
ON TABLE HOLD AS HOLDFEE
END
-RUN




MATCH FILE MATCHONE
 PRINT  AIR
   AGENT_NUM
   AIRLINE
   AIRLINE_FEE
   AIRLINE_NAME
   AIRLINE_NUM
   AROLL_DSC3
   AROLL_DSC4
   AROLL_DSC5
   BR_CL_IDX
   CGBOOK
   C_ITIN
   CL_CAT	
   CLASS	
   CLASS_CAT
   DISSAVINGS
   DOC_NUMBER
   DST_APC
   DTSAVE
   DV_NUM
   EMB_APT_CD
   EMB_APT_NM	
   EMB_CTY_NM
   EMB_CNTRY_CODE
   EMP_ID
   EX_IND
   FARE_BAS
   FARE_PAID
   FLAG
   FLIGHT
   FREQ_FLYER
   FF_MILES
   FST_ARR_DATE
   INTL_DOM
   INVOICE_NUM
   LEVEL_DESC
   LEVEL1
   LEVEL2
   LEVEL3
   LEVEL4
   LEVEL5
   LEVEL6
   LEVEL7
   MRK_TKT_CNT
   MV_CCNUM
   NCOMM
   NET_COMM
   NET_TKT_CNT
   NEW_ADV_PURCH
   NEW_SEG_AMT
   NEW_SEG_MILES
   ORG_APC
   PASSNGR_NAME
   PENALTY_AMT
   PNR_LOCATOR
   REFUSE_CODE
   REFUSAL_DESC
   RTE_APT_CD
   RTE_APT_NM	
   RTE_CTY_NM
   SAVINGS
   SEG_COUNT
   SEG_LOWEST
   SEG_MILES
   SEG_NBR
   SEG_STANDARD
   TBASE
   TDISC
   TFARE
   TLOW
   TMILE
   TMKT
   TKT_NUM
   TKT_SORT
   TKT_TYPE
   TRAN_MONTH
   TRAN_MY
   TRIP_PURPOSE
   TRN_DATE
   TRP_DESC
   TSAVE
   TSCOM	
   TSTD
   TVSV
   VAL_AIRLINE
   XPSNGR_NM
   XDPT_DT
   XFST_DPT
   XTRAN_DT
   TOTAMT
BY AIR_KEY
RUN
FILE HOLDFEE
PRINT  
  FEE_AMT
BY AIR_KEY  
AFTER MATCH HOLD AS XMATCH OLD-OR-NEW
END
-RUN



DEFINE FILE XMATCH
FLAG2/A1 = IF ((AIRLINE_FEE EQ 0) AND (FEE_AMT EQ 0)) THEN 'N' ELSE 'Y';
FLAG3/A1 = IF DOC_NUMBER OMITS '0000000000' THEN 'Y' ELSE 'N';
AIR_TNUM/A15 = AIRLINE_NUM || '-' || TKT_NUM;
FEE/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF TKT_TYPE NE ' ' THEN 0 ELSE
              IF TKT_SORT NE LAST TKT_SORT THEN FEE_AMT ELSE 0;
END
TABLE FILE XMATCH
PRINT AIR 
  AIR_TNUM
  AGENT_NUM
  AIRLINE
  AIRLINE_FEE
  AIRLINE_NAME
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  BR_CL_IDX
  CGBOOK
  C_ITIN
  CL_CAT	
  CLASS	
  CLASS_CAT
  DISSAVINGS
  DOC_NUMBER
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_BAS
  FARE_PAID
  FLAG
  FLIGHT
  FREQ_FLYER
  FF_MILES
  FST_ARR_DATE
  INTL_DOM
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  MRK_TKT_CNT
  MV_CCNUM
  NCOMM
  NET_COMM
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_AMT
  NEW_SEG_MILES
  ORG_APC
  PASSNGR_NAME
  PENALTY_AMT
  PNR_LOCATOR
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  SAVINGS
  SEG_COUNT
  SEG_LOWEST
  SEG_MILES
  SEG_NBR
  SEG_STANDARD
  TBASE
  TDISC
  TFARE
  TKT_NUM
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRIP_PURPOSE
  TRN_DATE
  TRP_DESC
  TSAVE
  TSCOM	
  TSTD
  TVSV
  VAL_AIRLINE
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT
  FEE_AMT 
  TOTAMT
  FLAG2
  FLAG3
  FEE
BY AIR_KEY
BY FLAG  
BY LEVEL1
BY LEVEL2 
-IF '&&SETF.EVAL' NE 'ARCEXCH' OR 'MZEXCH' THEN GOTO SkipWhere;
-*-IF '&&SETF.EVAL' NE 'ARCEXCH' THEN GOTO SkipWhere;
WHERE FLAG2 EQ 'Y'
-SkipWhere 
ON TABLE HOLD AS AIRHOLD3
END
-RUN

-IF '&&SETF.EVAL' NE 'MZEXCH' THEN GOTO SkipCheck;

TABLE FILE AIRHOLD3
PRINT *
WHERE DOC_NUMBER OMITS '000000000'
ON TABLE HOLD
END
-RUN

-SET &&NOREC = IF &RECORDS EQ 0 THEN 'Y' ELSE 'N';

 

-SkipCheck;

-INCLUDE Datavroll

-GOTO Continue;
  
-TELECA;

-INCLUDE PFXUSE
-RUN

DEFINE FILE AIRHOLD2
FLAG/A1 = 'A';
END
TABLE FILE AIRHOLD2
PRINT ACCT
  AIRLINE	
  AIRLINE_NAME
  C_ITIN
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_PAID
  FLAG
  FREQ_FLYER
  FF_MILES
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MV_CCNUM
  NCOMM
  NET_TKT_CNT
  ORG_APC
  PASSNGR_NAME
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  SEG_COUNT
  SEG_NBR
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TSAVE
  TSCOM	
  TSTD
  TVSV
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT  
BY AIR_KEY 
ON TABLE HOLD AS AIRHOLD4  
END
-RUN

JOIN AIR_KEY IN AIRHOLD4 TO ALL AIR_KEY IN PFHOLDA
-RUN


DEFINE FILE AIRHOLD4
FEE/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF TKT_TYPE NE ' ' THEN 0 ELSE
              IF TKT_SORT NE LAST TKT_SORT THEN FEE_AMT ELSE 0;
FLAG/A1 = 'A';
END
TABLE FILE AIRHOLD4
PRINT AIR_KEY
  ACCT
  AIRLINE	
  AIRLINE_NAME
  C_ITIN
  DST_APC
  DTSAVE
  DV_NUM
  EMB_APT_CD
  EMB_APT_NM	
  EMB_CTY_NM
  EMB_CNTRY_CODE
  EMP_ID
  EX_IND
  FARE_PAID
  FLAG
  FREQ_FLYER
  FF_MILES
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  MV_CCNUM
  NCOMM
  NET_TKT_CNT
  ORG_APC
  PASSNGR_NAME
  RTE_APT_CD
  RTE_APT_NM	
  RTE_CTY_NM
  SEG_COUNT
  SEG_NBR
  TBASE
  TDISC
  TFARE
  TKT_NUM	
  TKT_SORT
  TKT_TYPE
  TLOW
  TMILE
  TMKT
  TRAN_MONTH
  TRAN_MY
  TRN_DATE
  TSAVE
  TSCOM	
  TSTD
  TVSV
  XDPT_DT
  XFST_DPT
  XPSNGR_NM
  XTRAN_DT  
  FEE AS 'FEE_AMT'
BY FLAG
BY PASSNGR_NAME
WHERE AIRHOLD4.AIR_KEY EQ PFHOLDA.AIR_KEY
ON TABLE HOLD AS HOLDFEE
END
-RUN


MATCH FILE AIRHOLD4
 PRINT  
   ACCT
     AIRLINE	
     AIRLINE_NAME
     C_ITIN
     DST_APC
     DTSAVE
     DV_NUM
     EMB_APT_CD
     EMB_APT_NM	
     EMB_CTY_NM
     EMB_CNTRY_CODE
     EMP_ID
     EX_IND
     FARE_PAID
     FLAG
     FREQ_FLYER
     FF_MILES
     INVOICE_NUM
     LEVEL_DESC
     LEVEL1
     LEVEL2
     LEVEL3
     LEVEL4
     MV_CCNUM
     NCOMM
     NET_TKT_CNT
     ORG_APC
     PASSNGR_NAME
     RTE_APT_CD
     RTE_APT_NM	
     RTE_CTY_NM
     SEG_COUNT
     SEG_NBR
     TBASE
     TDISC
     TFARE
     TKT_NUM	
     TKT_SORT
     TKT_TYPE
     TLOW
     TMILE
     TMKT
     TRAN_MONTH
     TRAN_MY
     TRN_DATE
     TSAVE
     TSCOM	
     TSTD
     TVSV
     XDPT_DT
     XFST_DPT
     XPSNGR_NM
  XTRAN_DT  
BY AIR_KEY
RUN
FILE HOLDFEE
PRINT  
  FEE_AMT
BY AIR_KEY  
AFTER MATCH HOLD AS XMATCH OLD-OR-NEW
END
-RUN


TABLE FILE XMATCH
PRINT ACCT
    AIRLINE	
    AIRLINE_NAME
    C_ITIN
    DST_APC
    DTSAVE
    DV_NUM
    EMB_APT_CD
    EMB_APT_NM	
    EMB_CTY_NM
    EMB_CNTRY_CODE
    EMP_ID
    EX_IND
    FARE_PAID
    FLAG
    FREQ_FLYER
    FF_MILES
    INVOICE_NUM
    LEVEL_DESC
    LEVEL1
    LEVEL2
    LEVEL3
    LEVEL4
    MV_CCNUM
    NCOMM
    NET_TKT_CNT
    ORG_APC
    PASSNGR_NAME
    RTE_APT_CD
    RTE_APT_NM	
    RTE_CTY_NM
    SEG_COUNT
    SEG_NBR
    TBASE
    TDISC
    TFARE
    TKT_NUM	
    TKT_SORT
    TKT_TYPE
    TLOW
    TMILE
    TMKT
    TRAN_MONTH
    TRAN_MY
    TRN_DATE
    TSAVE
    TSCOM	
    TSTD
    TVSV
    XDPT_DT
    XFST_DPT
    XPSNGR_NM
  XTRAN_DT  
  FEE_AMT 
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3A
END
-RUN


TABLE FILE UATELECA
PRINT AUD_DATA AS 'CUS_NBR'
BY AIR_KEY
IF UDID EQ 'CSN'
ON TABLE HOLD AS TELCSN
END
-RUN

TABLE FILE UATELECA
PRINT AUD_DATA AS 'PROJ_NBR'
BY AIR_KEY
IF UDID EQ 'PRN'
ON TABLE HOLD AS TELPRN
END
-RUN


MATCH FILE AIRHOLD3A
PRINT ACCT
    AIRLINE	
    AIRLINE_NAME
    C_ITIN
    DST_APC
    DTSAVE
    DV_NUM
    EMB_APT_CD
    EMB_APT_NM	
    EMB_CTY_NM
    EMB_CNTRY_CODE
    EMP_ID
    EX_IND
    FARE_PAID
    FLAG
    FREQ_FLYER
    FF_MILES
    INVOICE_NUM
    LEVEL_DESC
    LEVEL1
    LEVEL2
    LEVEL3
    LEVEL4
    MV_CCNUM
    NCOMM
    NET_TKT_CNT
    ORG_APC
    PASSNGR_NAME
    RTE_APT_CD
    RTE_APT_NM	
    RTE_CTY_NM
    SEG_COUNT
    SEG_NBR
    TBASE
    TDISC
    TFARE
    TKT_NUM	
    TKT_SORT
    TKT_TYPE
    TLOW
    TMILE
    TMKT
    TRAN_MONTH
    TRAN_MY
    TRN_DATE
    TSAVE
    TSCOM	
    TSTD
    TVSV
    XDPT_DT
    XFST_DPT
    XPSNGR_NM
  XTRAN_DT  
  FEE_AMT 
BY AIR_KEY
ON TABLE HOLD
RUN
FILE TELCSN
SUM CUS_NBR 
BY AIR_KEY
AFTER MATCH HOLD AS AIRHOLD3A OLD
END
-RUN

MATCH FILE AIRHOLD3A
PRINT ACCT
    AIRLINE	
    AIRLINE_NAME
    C_ITIN
    CUS_NBR
    DST_APC
    DTSAVE
    DV_NUM
    EMB_APT_CD
    EMB_APT_NM	
    EMB_CTY_NM
    EMB_CNTRY_CODE
    EMP_ID
    EX_IND
    FARE_PAID
    FLAG
    FREQ_FLYER
    FF_MILES
    INVOICE_NUM
    LEVEL_DESC
    LEVEL1
    LEVEL2
    LEVEL3
    LEVEL4
    MV_CCNUM
    NCOMM
    NET_TKT_CNT
    ORG_APC
    PASSNGR_NAME
    RTE_APT_CD
    RTE_APT_NM	
    RTE_CTY_NM
    SEG_COUNT
    SEG_NBR
    TBASE
    TDISC
    TFARE
    TKT_NUM	
    TKT_SORT
    TKT_TYPE
    TLOW
    TMILE
    TMKT
    TRAN_MONTH
    TRAN_MY
    TRN_DATE
    TSAVE
    TSCOM	
    TSTD
    TVSV
    XDPT_DT
    XFST_DPT
    XPSNGR_NM
    XTRAN_DT  
    FEE_AMT 
BY AIR_KEY
ON TABLE HOLD
RUN
FILE TELPRN
SUM PROJ_NBR 
BY AIR_KEY
AFTER MATCH HOLD AS AIRHOLD3B OLD
END
-RUN    
    

TABLE FILE AIRHOLD3B
PRINT ACCT
    AIRLINE	
    AIRLINE_NAME
    C_ITIN
    CUS_NBR
    DST_APC
    DTSAVE
    DV_NUM
    EMB_APT_CD
    EMB_APT_NM	
    EMB_CTY_NM
    EMB_CNTRY_CODE
    EMP_ID
    EX_IND
    FARE_PAID
    FLAG
    FREQ_FLYER
    FF_MILES
    INVOICE_NUM
    LEVEL_DESC
    LEVEL1
    LEVEL2
    LEVEL3
    LEVEL4
    MV_CCNUM
    NCOMM
    NET_TKT_CNT
    ORG_APC
    PASSNGR_NAME
    PROJ_NBR
    RTE_APT_CD
    RTE_APT_NM	
    RTE_CTY_NM
    SEG_COUNT
    SEG_NBR
    TBASE
    TDISC
    TFARE
    TKT_NUM	
    TKT_SORT
    TKT_TYPE
    TLOW
    TMILE
    TMKT
    TRAN_MONTH
    TRAN_MY
    TRN_DATE
    TSAVE
    TSCOM	
    TSTD
    TVSV
    XDPT_DT
    XFST_DPT
    XPSNGR_NM
    XTRAN_DT  
    FEE_AMT 
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3
END
-RUN





-Continue;


DEFINE FILE AIRHOLD3
-INCLUDE GENDEFINE
LVL4/A20 = EDIT(LEVEL4, '99999999999999999999');

-IF '&&SETF.EVAL' NE 'MVCCLST' THEN GOTO Check2; 
MLEV1/A30 = 'Client:' | ' ' | LEVEL1;
MLEV2/A30 = 'Event:' | ' ' | LEVEL2;
 
TTAMT/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF LEVEL1 NE LAST LEVEL1 THEN TOTAMT ELSE 0;
TTAMT2/D12.2CS =  IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF LEVEL2 NE LAST LEVEL2 THEN TOTAMT ELSE 0;

-Check2
-IF '&&SETF.EVAL' NE 'TSAADMIN' OR 'TSUNITED' OR 'ABADMIN' OR 'ABADMIN1' OR 'SKADMIN' OR 'EJADMIN' OR 'CRYADMIN' THEN GOTO Check3;
TSFARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TSFARE ELSE 0; 
TSFARE2/D12.2CS = IF EX_IND NE 'E' THEN TSFARE ELSE 0;
-*NET_TKT_CNT2/D8CS = IF EX_IND NE 'E' THEN NET_TKT_CNT ELSE 0;
ADD_C/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN ADD_COLL ELSE 0;
-* FARE/D12.2CS = IF ADD_COLL EQ 0 THEN TSFARE_AMT ELSE ADD_C;
FARE/D12.2CS = IF ADD_COLL EQ 0 AND EX_IND EQ ' ' THEN TSFARE_AMT ELSE ADD_C;

-* LOW_AMT/D10.2CS = IF TKT_NUM NE LAST TKT_NUM AND ADD_COLL EQ 0 AND EX_IND EQ ' ' THEN TLOW ELSE FARE;
LOW_AMT/D10.2CS = IF TKT_NUM NE LAST TKT_NUM THEN TLOW ELSE FARE;

LEV4/A28 = EDIT(LEVEL4, '9999999999999999999999999999');
EXIND2/A4 = EX_IND || '-' || TRP_RSN;
EXIND3/A4 = IF EX_IND NE ' ' THEN EXIND2 ELSE '    ';
FLAG/A1 = 'A';
-Check3
-IF &&SETF.EVAL NE 'HRGCCLST' THEN GOTO Check4;
HRG3/A72 = 'Department:'| ' ' | AROLL_DSC3;
HRG4/A68 = 'Client:'| ' ' | AROLL_DSC4;
HRG5/A70 = 'Employee:'| ' ' | AROLL_DSC5;
TTAMT3/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF AROLL_DSC3 NE LAST AROLL_DSC3 THEN TOTAMT ELSE 0;
TTAMT4/D12.2CS =  IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF AROLL_DSC4 NE LAST AROLL_DSC4 THEN TOTAMT ELSE 0;
TTAMT5/D12.2CS =  IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
              IF AROLL_DSC5 NE LAST AROLL_DSC5 THEN TOTAMT ELSE 0; 
              
FLAG1/A5 = 'Total'; 
-Check4
-IF &&SETF.EVAL NE 'HMHCCLST' THEN GOTO Check5;
HMH2/A27 = 'Job Number:'| ' ' | LEVEL2;
HMH3/A28 = 'Trip Number:'| ' ' | LEVEL3;
TTAMT2/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
                 IF LEVEL2 NE LAST LEVEL2 THEN TOTAMT ELSE 0;
TTAMT3/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
                 IF LEVEL3 NE LAST LEVEL3 THEN TOTAMT ELSE 0;              
FLAG1/A5 = 'Total'; 
-Check5;
-IF &&SETF.EVAL NE 'CLACTIVY' OR 'SNKCCLST' OR 'CFCCLST' OR 'ARCEXCH' OR 
- 'MZEXCH' THEN GOTO Check6;
BLANK/A22 = '                      ';
PAX_NM/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
CL_LEV5/A20 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL5 ELSE ' ';
TICKET_NUM/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_NUM ELSE ' ';
SNK2/A37 = IF '&&ROLLUP.EVAL' EQ 'SINKO-R' THEN 'Client Matter Number:'|' '|LEVEL2 ELSE 
           IF '&&ROLLUP.EVAL' EQ 'AVIONS-R' THEN 
           EDIT(LEVEL7,'9999999999999999999999999999999999999') ELSE LEVEL2 || BLANK;
TTAMT2/D12.2CS = IF EMB_APT_CD EQ 'FP2' OR 'FP1' OR 'DT1' THEN 0 ELSE  
                 IF LEVEL2 NE LAST LEVEL2 THEN TOTAMT ELSE 0;
TEST/A8 = FST_ARR_DATE;
TST1/A4 = EDIT(TEST, '9999');
TST2/A2 = EDIT(TEST, '$$$$99');
TST3/A2 = EDIT(TEST, '$$$$$$99');
FST_ARDT/A10 = TST2 || '/' || TST3 || '/' || TST1;
LEV4/A10= EDIT(LEVEL4, '9999999999');
LEV5/A10= EDIT(LEVEL5, '9999999999');
AIRLN_FEE/D12.2CS = IF '&&ROLLUP.EVAL' EQ 'ARCAPI-R' AND TRN_DATE GE '2012/01/31' THEN AIRLINE_FEE ELSE
                    IF '&&ROLLUP.EVAL' NE 'ARCAPI-R' THEN AIRLINE_FEE ELSE
                    IF '&&ROLLUP.EVAL' EQ 'ARCAPI-R' AND TRN_DATE LE '2012/01/31' AND
                        TKT_NUM NE LAST TKT_NUM THEN PENALTY_AMT ELSE 0;
CL_SNK2/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL2 ELSE ' ';

-Check6;
END
-RUN



-IF '&&SETF.EVAL' EQ 'TSAADMIN' THEN GOTO TSA; 
-IF '&&SETF.EVAL' EQ 'ABADMIN' THEN GOTO ABCD;
-IF '&&SETF.EVAL' EQ 'EJADMIN' THEN GOTO EJONES;
-IF '&&SETF.EVAL' EQ 'CRYADMIN' THEN GOTO CRAY;
-IF '&&SETF.EVAL' EQ 'ABADMIN1' THEN GOTO ABCD1;
-IF '&&SETF.EVAL' EQ 'HHARDTL' THEN GOTO HHAirRail;
-SET &TRIPRSN = IF '&&SETF.EVAL' EQ 'ABACTIVY' AND '&&ROLLUP.EVAL' EQ 'ABCD-R' THEN 
- 'AS' | ' ' | 'TRIP,DESC' ELSE 'NOPRINT'  ;


-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD3';
-INCLUDE DRILWHRS
-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
-IF '&&SETF.EVAL' EQ 'DVCSAV' OR 'NXCSAV' THEN GOTO COSTSAV;
-IF '&&SETF.EVAL' EQ 'MVCCLST' THEN GOTO CCLIST;
-IF '&&SETF.EVAL' EQ 'VTAIRDTL' THEN GOTO VECTOR;
-IF '&&SETF.EVAL' EQ 'HRGCCLST' THEN GOTO CCLIST1;
-IF '&&SETF.EVAL' EQ 'TAAIR'    THEN GOTO TELAIR;
-IF '&&SETF.EVAL' EQ 'TSUNITED'  THEN GOTO TSA2;
-IF '&&SETF.EVAL' EQ 'HMHCCLST' THEN GOTO HMHAIR;
-IF '&&SETF.EVAL' EQ 'SNKCCLST' THEN GOTO SNKAIR;
-IF '&&SETF.EVAL' EQ 'CFCCLST' THEN GOTO CNFAIR;
-IF '&&SETF.EVAL' EQ 'ARCEXCH' THEN GOTO ARC;
-IF '&&SETF.EVAL' EQ 'MZEXCH' THEN GOTO MILZEL;
-IF '&&SETF.EVAL' EQ 'UNVMAIR' THEN GOTO UNVM;
-IF '&&SETF.EVAL' EQ 'ABACTIVY' THEN GOTO ACTIVITY;
-IF '&&SETF.EVAL' EQ 'WELACTIV' THEN GOTO WELLSTAR;
-IF '&&SETF.EVAL' EQ 'PRACTIV' THEN GOTO PRESTO;
-IF '&&SETF.EVAL' EQ 'SKADMIN' THEN GOTO SKECH;

-IF '&&SETF.EVAL' EQ 'CLACTIVY' THEN GOTO ClarkNex2;

SUM BR_CL_IDX AS 'ACCT'
  LEVEL1 &LV1
  XPSNGR_NM AS 'TRAVELER'
  EMP_ID &EMPID
  XTRAN_DT AS 'INVOICED'
  XDPT_DT AS 'TRAVEL' 
  INVOICE_NUM AS 'INVOICE'  
  PNR_LOCATOR AS 'PNR'
  DV_NUM AS 'BILLED TO'
  TKT_NUM AS 'TICKET'
  AIRLINE AS 'A/L'
  SEG_NBR AS 'LEG' 
  EMB_APT_CD AS 'ORIG' 
  RTE_APT_CD AS 'DEST'
  CLASS AS 'CLASS'
  FREQ_FLYER AS 'FF NUMBER'
  FF_MILES AS 'FF MILES'
  FARE_PAID AS 'FARE'
  LEVEL2 &LV2
  LEVEL3 &LV3
  LEVEL4 &LV4
  LEVEL5 &LV5
  LEVEL6 &LV6
  LEVEL7 &LV7
  TRIP_PURPOSE &TRIPPRP
  TRP_DESC &TRIPRSN 
BY BR_CL_IDX NOPRINT
BY XPSNGR_NM NOPRINT BY XTRAN_DT NOPRINT
BY TKT_SORT NOPRINT BY TRN_DATE NOPRINT
BY XDPT_DT NOPRINT
BY SEG_NBR NOPRINT
BY TKT_NUM NOPRINT
BY PNR_LOCATOR NOPRINT
ON TABLE COLUMN-TOTAL
 

-GOTO FinishRpt;


-COSTSAV

SUM BR_CL_IDX AS 'ACCT'
  LEVEL1 &LV1
  XPSNGR_NM AS 'TRAVELER'
  EMP_ID &EMPID
  XTRAN_DT AS 'INVOICE'
  XFST_DPT AS 'TRAVEL' 
  RADV_PURCH AS 'ADV'
  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  C_ITIN AS 'ITINERARY'
  DISC_FARE AS 'PUBLISHED'
  FARE_AMT AS 'TRAVEL AND TRANSPORT'
  SAVE_AMT AS 'SAVINGS'
  REFUSE_CODE AS 'METHOD'
-*DVLOW AS 'DEC'L'
-*DVLST AS 'LOST'
  TLOW AS 'DEC'L'
  DTSAVE AS 'LOST'
  REF_AL AS 'A/L'
  REF_RSN AS 'REASON' 
  NET_TKT_CNT NOPRINT 
   LEVEL2 &LV2
   LEVEL3 &LV3
   LEVEL4 &LV4
   LEVEL5 &LV5
   LEVEL6 &LV6
   LEVEL7 &LV7
   TRIP_PURPOSE &TRIPPRP
   TRP_DESC &TRIPRSN
-IF &&SETF.EVAL NE 'NXCSAV' THEN GOTO NoINTDOM;
   INTL_DOM AS 'DOM/INTL'
-NoINTDOM;
BY BR_CL_IDX NOPRINT
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
ON BR_CL_IDX COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
  IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (RADV_PURCH/NET_TKT_CNT) ;  
ON TABLE RECOMPUTE DISC_FARE FARE_AMT SAVE_AMT TLOW DTSAV  AS 'TOTAL FOR'




-GOTO FinishRpt;

-CCLIST


PRINT    EMB_APT_NM AS 'FROM'
  RTE_APT_NM AS 'TO'
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'CARR'
  FLIGHT AS 'FLT #'
  NET_TKT_CNT AS 'TKT,CNT'
  FARE_AMT AS 'FARE'
  FEE_AMT AS 'FEE'
  TTAMT NOPRINT   
  TTAMT2 NOPRINT
  TFARE NOPRINT

BY FLAG NOPRINT
-*BY LEVEL1 NOPRINT
-*BY LEVEL2 NOPRINT
BY MLEV1 NOPRINT  
BY MLEV2 NOPRINT 
BY INVOICE_NUM AS 'INVOICE'
BY XTRAN_DT AS 'INV,DATE'
BY TKT_NUM AS 'TICKET,NUMBER'
BY XPSNGR_NM AS 'PASSENGER,NAME'
BY MV_CCNUM AS 'CREDIT,CARD'
ON INVOICE_NUM SKIP-LINE


ON MLEV1 COMPUTE CLIENT_TPCT/P8.2= IF ((TTAMT LT 1) AND 
 (TTAMT GT (-1))) THEN 0 ELSE (TFARE/TTAMT)*100; AS  '% of Total'
ON MLEV2 COMPUTE EVENT_PCT/P8.2= IF ((TTAMT2 LT 1) AND 
 (TTAMT2 GT (-1))) THEN 0 ELSE (TFARE/TTAMT2)*100; AS '% of Total' 
 
ON MLEV1 RECOMPUTE MULTILINES AS 'Sub-Total for'
ON MLEV2 RECOMPUTE MULTILINES AS 'Sub-Total for'

ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT) ;  



-GOTO FinishRpt;

-CCLIST1


PRINT EMB_APT_NM AS 'FROM'
  RTE_APT_NM AS 'TO'
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'CARR'
  FLIGHT AS 'FLT #'
  NET_TKT_CNT AS 'TKT,CNT'
  FARE_AMT AS 'FARE'
  FEE_AMT AS 'FEE'
  TTAMT3 NOPRINT   
  TTAMT4 NOPRINT
  TTAMT5 NOPRINT
  TFARE NOPRINT


BY FLAG NOPRINT
BY HRG3 NOPRINT  
BY HRG4 NOPRINT 
BY HRG5 NOPRINT
BY INVOICE_NUM AS 'INVOICE'
BY XTRAN_DT AS 'INV,DATE'
BY TKT_NUM AS 'TICKET,NUMBER'
BY XPSNGR_NM AS 'PASSENGER,NAME'
BY MV_CCNUM AS 'CREDIT,CARD'

ON INVOICE_NUM SKIP-LINE

ON HRG3 COMPUTE DEPARTMENT_PCT/P12.2= IF ((TTAMT3 LT 1) AND 
 (TTAMT3 GT (-1))) THEN 0 ELSE (TFARE/TTAMT3)*100; AS  '% of Total'
ON HRG4 COMPUTE CLIENT_PCT/P12.2= IF ((TTAMT4 LT 1) AND 
 (TTAMT4 GT (-1))) THEN 0 ELSE (TFARE/TTAMT4)*100; AS '% of Total' 
ON HRG5 COMPUTE EMPLOYEE_PCT/P12.2= IF ((TTAMT5 LT 1) AND 
 (TTAMT5 GT (-1))) THEN 0 ELSE (TFARE/TTAMT5)*100; AS '% of Total'  
 
 
ON HRG3 RECOMPUTE MULTILINES AS 'Sub-Total for'
ON HRG4 RECOMPUTE MULTILINES AS 'Sub-Total for'
ON HRG5 RECOMPUTE MULTILINES AS 'Sub-Total for'

ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT) ; 
  
 
 
-GOTO FinishRpt;
-HMHAIR


PRINT EMB_APT_NM AS 'FROM'
  RTE_APT_NM AS 'TO'
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'A/L'
-*  FLIGHT AS 'FLT #'
  NET_TKT_CNT AS 'TKT,CNT'
  FARE_AMT AS 'FARE'
-*  FEE_AMT AS 'FEE'
  LOW_AMT AS 'LOW,AMT'
  LOST_SAV_AMT AS 'LOST,SAVINGS'
  SAVE_AMT AS 'CONTRACT,SAVINGS'
  TTAMT2 NOPRINT   
  TTAMT3 NOPRINT
  TFARE NOPRINT


BY FLAG NOPRINT
BY HMH2 NOPRINT  
BY HMH3 NOPRINT 
BY INVOICE_NUM AS 'INVOICE'
BY XTRAN_DT AS 'INV,DATE'
BY TKT_NUM AS 'TICKET,NUMBER'
BY TKT_TYPE AS 'TKT,TYP'
BY XPSNGR_NM AS 'PASSENGER,NAME'
-*BY MV_CCNUM AS 'CREDIT,CARD'

ON INVOICE_NUM SKIP-LINE
ON HMH3 UNDER-LINE
-*ON HMH2 COMPUTE JOB_NUMBER_PCT/P12.2= IF ((TTAMT2 LT 1) AND 
-* (TTAMT2 GT (-1))) THEN 0 ELSE (TFARE/TTAMT2)*100; AS  '% of Total'
-*ON HMH3 COMPUTE TRIP_NUMBER_PCT/P12.2= IF ((TTAMT3 LT 1) AND 
-* (TTAMT3 GT (-1))) THEN 0 ELSE (TFARE/TTAMT3)*100; AS '% of Total' 
 
 
 
ON HMH2 RECOMPUTE MULTILINES AS 'Sub-Total for'
ON HMH3 RECOMPUTE MULTILINES AS 'Sub-Total for'

-*ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
-* (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  




-GOTO FinishRpt;

-SNKAIR

-IF '&&ROLLUP.EVAL' EQ 'CLARKN-R'  THEN GOTO ClarkNex;

PRINT EMB_APT_NM AS 'FROM'
  RTE_APT_NM AS 'TO'
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'CARR'
  FLIGHT AS 'FLT #'
  NET_TKT_CNT AS 'TKT,CNT'
  FARE_AMT AS 'FARE'
  TTAMT2 NOPRINT 
  TFARE NOPRINT 
-IF '&&ROLLUP.EVAL' NE 'SINKO-R' THEN GOTO SkipFee;  
  FEE_AMT AS 'FEE'
-SkipFee
-IF '&&ROLLUP.EVAL' NE 'FRONTL-R' THEN GOTO NoTripRsn;
  LEVEL4 AS 'REASON,FOR,TRAVEL'
-NoTripRsn
BY FLAG NOPRINT

BY SNK2 NOPRINT
-IF '&&ROLLUP.EVAL' EQ 'SINKO-R' THEN GOTO NoPaxSort;
BY XPSNGR_NM NOPRINT
-NoPaxSort
BY INVOICE_NUM AS 'INVOICE'
BY XTRAN_DT AS 'INV,DATE'
BY TKT_NUM AS 'TICKET,NUMBER'
BY XPSNGR_NM AS 'PASSENGER,NAME'
BY MV_CCNUM AS 'CREDIT,CARD'

ON INVOICE_NUM SKIP-LINE
-IF '&&ROLLUP.EVAL' NE 'SINKO-R' THEN GOTO NoPctTotal;
ON SNK2 COMPUTE CLIENT_MATTER_PCT/P12.2= IF ((TTAMT2 LT 1) AND 
 (TTAMT2 GT (-1))) THEN 0 ELSE (TFARE/TTAMT2)*100; AS  '% of Total'
-NoPctTotal 

ON SNK2 RECOMPUTE MULTILINES AS 'Sub-Total for'

ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
 
 
 

-GOTO FinishRpt;

-ClarkNex
 

PRINT 
EMB_APT_NM/A17 AS 'FROM'
  RTE_APT_NM/A17 AS 'TO'
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'CARR'
  FLIGHT AS 'FLT #'
  NET_TKT_CNT NOPRINT
  FARE_AMT AS 'FARE'
  LEVEL4 AS 'REASON,FOR,TRAVEL'
  TFARE NOPRINT
BY FLAG NOPRINT
BY XTRAN_DT NOPRINT

BY INVOICE_NUM AS 'Invoice'
BY XTRAN_DT AS 'Inv,Date'
BY XFST_DPT AS 'Dept,Date'
BY TKT_NUM AS 'TICKET,NUMBER'
BY SNK2 AS 'Acct'
BY LEV5 AS 'PO'
BY XPSNGR_NM AS 'PASSENGER,NAME'
BY MV_CCNUM AS 'CREDIT,CARD'

ON INVOICE_NUM SKIP-LINE
ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
ON TABLE COLUMN-TOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-INCLUDE FOOTERDT
-*
ON TABLE SET STYLE *
-INCLUDE DTLEGAL2
-*
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT;
-ClarkNex2
 

PRINT 
  PAX_NM AS 'PASSENGER,NAME'
  CL_SNK2 AS 'Acct'
  CL_LEV5 AS 'PO'
  TICKET_NUM AS 'Ticket,Number'
  TKT_TYPE AS 'TKT,TYPE'
  EMB_APT_NM/A17 AS 'FROM'
  RTE_APT_NM/A17 AS 'TO'
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'CARR'
  FLIGHT AS 'FLT #'
  NET_TKT_CNT AS 'TKT,CNT'
  FARE_AMT AS 'FARE'
  LEVEL4 AS 'REASON,FOR,TRAVEL'
  TFARE NOPRINT
BY FLAG NOPRINT
BY XPSNGR_NM NOPRINT
BY SNK2 NOPRINT
BY LEV5 NOPRINT
BY TKT_NUM NOPRINT
-*BY MV_CCNUM AS 'CREDIT,CARD'
ON TKT_NUM SKIP-LINE
ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
ON TABLE COLUMN-TOTAL

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-INCLUDE FOOTERDT
-*
ON TABLE SET STYLE *
-INCLUDE DTLEGAL2

ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT;

 
-CNFAIR
SUM LEVEL1 AS 'Dept'
  XTRAN_DT AS 'Inv Date'
  INVOICE_NUM AS 'Invoice'
  MV_CCNUM AS 'Credit Card'
  XPSNGR_NM AS 'Passenger Name'
  ORG_APC AS 'Dep City'
  DST_APC AS 'Arr City'
  FST_ARDT AS 'Arrival,Date' 
  AIRLINE_NAME AS 'Airline Flown Name'
  TKT_NUM AS 'Ticket,Number'
  STD_FARE AS 'Client Fare'
  LOW_AMT AS 'BTC Fare'
  FARE_AMT AS 'Conference Solutions Fare'
  LOST_SAV_AMT AS 'Markup'
  FEE_AMT AS 'Fee'


BY FLAG NOPRINT  
BY LEVEL1 NOPRINT
BY XTRAN_DT NOPRINT
BY INVOICE_NUM NOPRINT
BY MV_CCNUM NOPRINT
BY XPSNGR_NM NOPRINT
BY TKT_NUM NOPRINT
 



-GOTO FinishRpt;
 
-ARC
SUM LEVEL2 AS 'Dept'
  XPSNGR_NM AS 'Passenger Name'
  XTRAN_DT AS 'Inv Date'
  C_ITIN AS 'Routing'
  INVOICE_NUM AS 'Invoice'
  TKT_NUM AS 'Ticket,Number'
  DOC_NUMBER AS 'Original,Ticket'
-*  AIRLINE_FEE/D12.2 AS 'Airline fee'
  AIRLN_FEE/D12.2 AS 'Airline fee'
  FEE_AMT AS 'Svcfee'
  FLAG2 AS 'Exchange'
  LEVEL6 AS 'Reason_for'
  LEVEL5 AS 'Authorizer'
  PNR_LOCATOR AS 'Recloc'

BY LEVEL2 NOPRINT
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY C_ITIN NOPRINT
BY INVOICE_NUM NOPRINT
BY TKT_NUM NOPRINT
WHERE DOC_NUMBER OMITS '000000000'
ON LEVEL2 SUMMARIZE AS 'Total for'
ON TABLE COLUMN-TOTAL

 

-GOTO FinishRpt;

-MILZEL

-IF '&&NOREC.EVAL' EQ 'Y' THEN GOTO NORECORDS;

SUM  

  C_ITIN AS 'Routing'
  LEVEL2 AS 'Account'
-IF '&&ROLLUP.EVAL' EQ 'CLARKN-R' THEN GOTO POLev5
  LEVEL3 AS 'PO Info'
-GOTO NOLEV5  
-POLev5
  LEVEL5 &LV5
-NOLEV5
  TKT_NUM AS 'Ticket,Number'
  DOC_NUMBER AS 'Original,Ticket'
  FLAG3 AS 'Exchange'

  FARE_AMT/D12.2 AS 'Trip Air Chg'

BY    XPSNGR_NM AS 'Passenger Name'
BY  INVOICE_NUM AS 'Invoice'

BY  XTRAN_DT AS 'Inv Date'
BY FLAG NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT

ON XPSNGR_NM RECOMPUTE  AS 'Sub-Total for'
WHERE DOC_NUMBER OMITS '000000000'
 



 
-GOTO FinishRpt;

-WELLSTAR

SUM XPSNGR_NM AS 'PASSENGER NAME'
    XTRAN_DT AS 'INV,DATE'
    INVOICE_NUM AS 'INVOICE#'
    AIR_TNUM AS 'TICKET#'
    FARE_AMT AS 'TRIP AIR CHG'
    FEE_AMT AS 'FEE'
    LEVEL4 AS 'DEPT-PHONE#-NAME PERSON BOOKING'
BY XPSNGR_NM NOPRINT
BY XTRAN_DT NOPRINT
BY INVOICE_NUM NOPRINT
BY AIR_TNUM NOPRINT
ON TABLE COLUMN-TOTAL
ON INVOICE_NUM SKIP-LINE
WHERE XPSNGR_NM NE ' '
 


-GOTO FinishRpt;


-PRESTO

PRINT  
    XTRAN_DT AS 'INV,DATE'
    XDPT_DT AS 'DEPT,DATE' 
    EMB_APT_CD AS 'FROM'
    RTE_APT_CD AS 'TO'
    INVOICE_NUM AS 'INVOICE#'
    TKT_NUM AS 'TICKET#'
    TKT_TYPE AS 'TYPE'
    FARE_AMT AS 'TRIP AIR CHG'
    FEE_AMT AS 'FEE'
    LEVEL5 AS 'PO#'
BY XPSNGR_NM AS 'PASSENGER NAME'
BY XTRAN_DT NOPRINT
BY INVOICE_NUM NOPRINT
BY TKT_NUM NOPRINT
BY TKT_TYPE NOPRINT
ON TABLE COLUMN-TOTAL
ON INVOICE_NUM SKIP-LINE
WHERE XPSNGR_NM NE ' '
 



-GOTO FinishRpt;

-ACTIVITY
-*-IF '&&ROLLUP.EVAL' EQ 'LLGLOB-R'  THEN GOTO Activity2;
-IF '&&ROLLUP.EVAL' EQ 'REFORM-R'  THEN GOTO Activity4;

-IF '&&ROLLUP.EVAL' EQ 'HIVVAC-R'  THEN GOTO HIVVAC;
-IF '&&ROLLUP.EVAL' EQ 'DATASH-R' THEN GOTO DATASH;
-IF '&&ROLLUP.EVAL' EQ 'THOMCO-R' THEN GOTO THOMCO;
-IF '&&ROLLUP.EVAL' EQ 'LLGLOB-R' THEN GOTO LLGLOB;
-IF '&&ROLLUP.EVAL' EQ 'CLARKN-R' THEN GOTO CLARKN;
-IF '&&ROLLUP.EVAL' EQ 'ANGELO-R' OR 'BEECHE-R' OR 'INTERR-R' OR 'JOHNMA-R' OR 
- 'LECTRA-R' OR 'NFICON-R' OR 'QUADRE-R' OR 'RAMPAR-R' OR 'RIMASY-R' OR 
- 'RTPCON-R' OR 'TUGTEC-R' OR 'EVOLUT-R' THEN GOTO NOsort; 

PRINT
  EMB_APT_NM/A18 AS 'Origin,Airport'
  RTE_APT_NM/A18 AS 'Destination,Airport'
  XDPT_DT AS 'Dept,Date'
  AIRLINE AS 'AC'
  FLIGHT AS 'FLT #'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'
  LEVEL4 &LV4
  TFARE NOPRINT
BY FLAG NOPRINT 
BY LEVEL2 &LV2
-*BY LEVEL2 NOPRINT
BY XPSNGR_NM NOPRINT
BY INVOICE_NUM AS 'Invoice'
BY XTRAN_DT AS 'Inv Date' 
BY  XPSNGR_NM AS 'Passenger Name'
BY TKT_NUM AS 'Ticket,Number'
BY TKT_SORT NOPRINT 
BY SEG_NBR  NOPRINT
BY XDPT_DT NOPRINT
BY MV_CCNUM AS 'Credit Card'

ON LEVEL2 RECOMPUTE MULTILINES AS 'Total for'
ON TKT_NUM SKIP-LINE
ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
ON TABLE COLUMN-TOTAL




-GOTO FinishRpt;

-NOsort
PRINT
  EMB_APT_NM AS 'Origin,Airport'
  RTE_APT_NM AS 'Destination,Airport'
  XDPT_DT AS 'Dept,Date'
  AIRLINE AS 'AC'
  FLIGHT AS 'FLT #'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'
  LEVEL4 &LV4
  TFARE NOPRINT
BY FLAG NOPRINT 
BY XPSNGR_NM NOPRINT

BY INVOICE_NUM AS 'Invoice'
BY XTRAN_DT AS 'Inv Date' 
BY  XPSNGR_NM AS 'Passenger Name'
BY TKT_NUM AS 'Ticket,Number'
BY MV_CCNUM AS 'Credit Card'
BY TKT_SORT NOPRINT 
BY SEG_NBR  NOPRINT
BY XDPT_DT NOPRINT
WHERE XPSNGR_NM NE ' '

ON TKT_NUM SKIP-LINE
ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
ON TABLE COLUMN-TOTAL




-GOTO FinishRpt;



-Activity2

PRINT
  INVOICE_NUM AS 'Invoice'
  XTRAN_DT AS 'Inv Date' 
  XDPT_DT AS 'Dept,Date'
  MV_CCNUM AS 'Credit Card'
  EMB_APT_NM AS 'Origin,Airport'
  RTE_APT_NM AS 'Destination,Airport'
  AIRLINE AS 'AC'
  FLIGHT AS 'FLT #'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'

BY FLAG NOPRINT 
-*BY XPSNGR_NM NOPRINT
BY LEVEL2 NOPRINT
BY  XPSNGR_NM AS 'Passenger Name'
BY TKT_NUM AS 'Ticket,Number'  
BY TKT_SORT NOPRINT 
BY SEG_NBR  NOPRINT
BY XDPT_DT NOPRINT
ON LEVEL2 RECOMPUTE MULTILINES AS 'Total for'

ON TKT_NUM SKIP-LINE
ON TABLE COLUMN-TOTAL

 
-GOTO FinishRpt;

-Activity4

PRINT
  INVOICE_NUM AS 'Invoice'
  XTRAN_DT AS 'Inv Date' 
  XDPT_DT AS 'Dept,Date'
  MV_CCNUM AS 'Credit Card'
  EMB_APT_NM AS 'Origin,Airport'
  RTE_APT_NM AS 'Destination,Airport'
  AIRLINE AS 'AC'
  FLIGHT AS 'FLT #'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'

BY FLAG NOPRINT 
-*BY XPSNGR_NM NOPRINT
BY LEVEL4 NOPRINT
BY  XPSNGR_NM AS 'Passenger Name'
BY TKT_NUM AS 'Ticket,Number'  
BY TKT_SORT NOPRINT 
BY SEG_NBR  NOPRINT
BY XDPT_DT NOPRINT
ON LEVEL4 RECOMPUTE MULTILINES AS 'Total for'

ON TKT_NUM SKIP-LINE
ON TABLE COLUMN-TOTAL

 
-GOTO FinishRpt;

-HIVVAC

SUM
FARE_AMT AS 'Fare,Paid'
FEE_AMT AS 'Fee'
BY LEVEL1 &LV1
BY XPSNGR_NM AS 'Traveler'
BY INVOICE_NUM AS 'Inv#'
BY XTRAN_DT AS 'Inv Date' 
BY XFST_DPT AS 'Dep,Date'
BY C_ITIN AS 'Itinerary'
BY TKT_NUM AS 'Ticket#'
BY VAL_AIRLINE AS 'Airline'
ON TABLE NOTOTAL
 
-GOTO FinishRpt;

-LLGLOB
PRINT
  EMB_APT_NM/A18 AS 'Origin,Airport'
  RTE_APT_NM/A18 AS 'Destination,Airport'
  XDPT_DT AS 'Dept,Date'
  AIRLINE AS 'AC'
  FLIGHT AS 'FLT #'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'
  TFARE NOPRINT
BY FLAG NOPRINT 
BY LEVEL1 &LV1
-*BY LEVEL2 NOPRINT
BY XPSNGR_NM NOPRINT
BY INVOICE_NUM AS 'Invoice'
BY XTRAN_DT AS 'Inv Date' 
BY  XPSNGR_NM AS 'Passenger Name'
BY TKT_NUM AS 'Ticket,Number'
BY TKT_SORT NOPRINT 
BY SEG_NBR  NOPRINT
BY XDPT_DT NOPRINT
BY MV_CCNUM AS 'Credit Card'

ON LEVEL1 RECOMPUTE MULTILINES AS 'Total for'
ON TKT_NUM SKIP-LINE
ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
ON TABLE COLUMN-TOTAL




-GOTO FinishRpt;

  
-THOMCO
 
SUM TKT_NUM AS 'MCO/Ticket#'
      INVOICE_NUM AS 'Inv#'
      AIR AS 'Airline'
      XTRAN_DT AS 'Inv Date' 
      XPSNGR_NM AS 'Traveler'
      C_ITIN AS 'Routing/Description'
      FARE_AMT AS 'Amount'
      FEE_AMT AS 'Fee'
BY   MV_CCNUM NOPRINT
BY TKT_NUM NOPRINT
BY XTRAN_DT NOPRINT
BY XPSNGR_NM NOPRINT


ON MV_CCNUM SUMMARIZE AS 'Total for'
ON MV_CCNUM PAGE-BREAK
ON TABLE COLUMN-TOTAL
ON TKT_NUM SKIP-LINE
WHERE MV_CCNUM NE ' '
 


-GOTO FinishRpt;


-DATASH
SUM LEVEL3 &LV3
  INVOICE_NUM AS 'Invoice'
  XTRAN_DT AS 'Inv Date'
  XPSNGR_NM AS 'Passenger Name' 
  TKT_NUM AS 'Ticket,Number'
  MV_CCNUM AS 'Credit Card'
  C_ITIN AS 'Itinerary'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'
  LEVEL5 &LV5
BY FLAG NOPRINT 
BY LEVEL3 NOPRINT
BY XPSNGR_NM NOPRINT
BY INVOICE_NUM NOPRINT
BY XTRAN_DT NOPRINT
BY  XPSNGR_NM NOPRINT
BY TKT_NUM NOPRINT
BY MV_CCNUM NOPRINT

ON TKT_NUM SKIP-LINE

ON TABLE COLUMN-TOTAL
 


-GOTO FinishRpt;
 
-VECTOR



PRINT LEVEL2 AS 'DEPT'   
  XDPT_DT AS 'DATE' 
  AIRLINE AS 'CR'
  CLASS AS 'CL'
  EMB_APT_NM/A18 AS 'FROM'
  RTE_APT_NM/A18 AS 'TO'
  NET_TKT_CNT AS 'TKT,CNT'
  FARE_AMT AS 'FARE'
  FEE_AMT AS 'FEE'

COMPUTE TOT/D12.2CS = FARE_AMT + FEE_AMT; AS 'TOTAL,AMT' 
BY FLAG NOPRINT
 

BY XPSNGR_NM AS 'PASSENGER,NAME'
BY XTRAN_DT AS 'INV,DATE'
BY TKT_NUM AS 'TICKET,NUMBER'
BY INVOICE_NUM AS 'INVOICE'
BY MV_CCNUM AS 'CREDIT,CARD'
ON INVOICE_NUM SKIP-LINE
ON XPSNGR_NM RECOMPUTE FARE_AMT FEE_AMT TOT AS 'Total for'



 
-GOTO FinishRpt;

-TELAIR;


SUM  
  XPSNGR_NM AS 'TRAVELER'
  EMP_ID AS 'EMPLOYEE,ID'
  LEVEL2 AS 'DEPARTMENT'
  LEVEL3 AS 'APPROVAL,CODE'
  PROJ_NBR AS 'PROJECT,NUMBER'
  CUS_NBR AS 'CUSTOMER,NUMBER'
  XTRAN_DT AS 'INVOICE.DATE'
  XFST_DPT AS 'TRAVEL,DATE' 
  TKT_NUM AS 'TICKET,NUMBER'
  AIRLINE_NAME AS 'CARRIER'
  C_ITIN AS 'ITINERARY'
  FARE_AMT AS 'FARE,PAID'
  FEE_AMT AS 'FEE,AMT'
 
BY XPSNGR_NM NOPRINT
BY LEVEL1 NOPRINT
BY LEVEL2 NOPRINT
BY LEVEL3 NOPRINT
BY PROJ_NBR NOPRINT
BY CUS_NBR NOPRINT
BY XTRAN_DT NOPRINT
BY TKT_NUM NOPRINT
ON TABLE COLUMN-TOTAL

 
-GOTO FinishRpt; 

-CLARKN
PRINT
  EMB_APT_NM/A18 AS 'Origin,Airport'
  RTE_APT_NM/A18 AS 'Destination,Airport'
  XDPT_DT AS 'Dept,Date'
  AIRLINE AS 'AC'
  FLIGHT AS 'FLT #'
  FARE_AMT AS 'Trip Air,Charge'
  NET_TKT_CNT AS 'Tkt,Cnt'
  LVL4 &LV4
  TFARE NOPRINT
BY FLAG NOPRINT 
BY LEVEL2 &LV2
-*BY LEVEL2 NOPRINT
BY XPSNGR_NM NOPRINT
BY INVOICE_NUM AS 'Invoice'
BY XTRAN_DT AS 'Inv Date' 
BY  XPSNGR_NM AS 'Passenger Name'
BY TKT_NUM AS 'Ticket,Number'
BY TKT_SORT NOPRINT 
BY SEG_NBR  NOPRINT
BY XDPT_DT NOPRINT
BY MV_CCNUM AS 'Credit Card'

ON LEVEL2 RECOMPUTE MULTILINES AS 'Total for'
ON TKT_NUM SKIP-LINE
ON FLAG COMPUTE AVG_TKT_PRICE/D12.2CS = IF ((NET_TKT_CNT LT 1) AND   
 (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TFARE/NET_TKT_CNT);  
ON TABLE COLUMN-TOTAL

-GOTO FinishRpt; 

-TSA2


SUM
  XPSNGR_NM AS 'TRAVELER'
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'DEPART'   
  TKT_NUM AS 'TICKET'
  AIRLINE AS 'A/L'
  CITYS/A50 AS 'ITINERARY'
  EXIND3 AS 'EX,IND'
  INTL_DOM AS 'INTL,IND'
  FARE AS 'FARE'
  TSFARE2 NOPRINT 
  NET_TKT_CNT  AS 'TKT,CNT'
BY FLAG NOPRINT
BY LEV4 AS 'COST,CENTER,DEPARTMENT'
BY EX_IND NOPRINT 
BY XPSNGR_NM NOPRINT BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT
WHERE XPSNGR_NM NE ' '

ON LEV4 UNDER-LINE

-*ON LEV4 RECOMPUTE FARE NET_TKT_CNT AS 'Sub-total for' 

ON TABLE COLUMN-TOTAL

-GOTO FinishRpt; 




-SKECH
SUM
  XPSNGR_NM AS 'PASSENGER NAME'
  XTRAN_DT AS 'INVOICE DATE'
-*  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  XFST_DPT AS 'DEPART DATE'   
  CITYS/A50 AS 'CITY NAMES'
  FARE AS 'TOTAL FARE'

BY FLAG NOPRINT 

BY LEVEL2 AS 'DEPT'
BY XPSNGR_NM NOPRINT

 BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT 
-*WHERE XPSNGR_NM NE ' '
 
ON LEVEL2 UNDER-LINE
ON LEVEL2 RECOMPUTE FARE  AS 'Sub-total for' 
 



-GOTO FinishRpt; 



-HHAirRail

-SET &ATP1 = ' ';
-SET &AAP1 = ' ';
TABLE FILE AIRHOLD3
SUM NET_TKT_CNT
    PADV
    FARE_AMT
COMPUTE ATP/D12.2CS=   IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0
                             ELSE (FARE_AMT/NET_TKT_CNT) ; 
COMPUTE AAP/D12 =     IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0
                             ELSE (PADV/NET_TKT_CNT) ;                          
BY FLAG
ON TABLE HOLD AS TOTAVG
END
-RUN
 
TABLE FILE TOTAVG
PRINT ATP AAP
ON TABLE SAVE AS TOTAVG1
END
-RUN
 
- IF &LINES EQ 0 THEN GOTO NoAVGR;

-READ TOTAVG1 NOCLOSE &ATP.12. &AAP.12.  

EX FMTNUMBER VALUE=&ATP ,DOLLAR='Y',LEN = 6
-RUN
-SET &ATP1 = '&&RETVAL.EVAL'; 
-RUN
EX FMTNUMBER VALUE=&AAP ,DOLLAR='N',LEN = 6
-RUN
-SET &AAP1 = '&&RETVAL.EVAL';
-RUN

 
DEFINE FILE AIRHOLD3 ADD
JOBCC/A10 = EDIT (JOB_CC, '9999999999');
END
-RUN
TABLE FILE AIRHOLD3
-INCLUDE HEADTSA
"&&SUBHEAD"
"</1"

SUM    
  TRP_DESC/A10 AS 'PURPOSE,OF TRIP'
-*BIL_NON AS 'BILLABLE,NON BILLABLE'
  BIL_NON/A1 AS 'B/,N'
  JOBCC AS 'JOB,COST,CODE'
  INVOICE_NUM AS 'INVOICE'
  TKT_NUM AS 'TICKET'
  AIRLINE AS 'A/L'
  CITYS/A35 AS 'ROUTING'
  XFST_DPT AS 'DEPART,DATE'   
  PADV AS 'DAY,ADV'
-*  AUX_TYPE AS 'E-,TKT'
  LOW_AMT/D12.2CS AS 'LOW,FARE'
  FARE_AMT AS 'FARE,PAID'
  LOST_SAV_AMT/D12.2CS AS 'LOST,SVGS'
  REFUSE_CODE AS 'RSN,CD'
  NET_TKT_CNT AS 'TKT,CNT' 
BY LEV1 AS 'UNIT,CODE'
BY XPSNGR_NM AS 'TRAVELER'
BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT
ON LEV1 COMPUTE UNIT_AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (FARE_AMT/NET_TKT_CNT) ;   
ON XPSNGR_NM COMPUTE AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (FARE_AMT/NET_TKT_CNT) ;   
-*ON XPSNGR_NM COMPUTE TRANSACTIONS/D12 = NET_TKT_CNT;
ON XPSNGR_NM UNDER-LINE
ON LEV1 RECOMPUTE FARE_AMT LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Total for' 

ON XPSNGR_NM RECOMPUTE FARE_AMT LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for' 

-*ON LEVEL1 SUMMARIZE AS 'Total for'





-GOTO Rpt2;


-TSA


-SET &ATP1 = ' ';
-SET &AAP1 = ' ';
TABLE FILE AIRHOLD3
SUM NET_TKT_CNT
    PADV
    FARE
COMPUTE ATP/D12.2CS=   IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0
                             ELSE (FARE/NET_TKT_CNT) ; 
COMPUTE AAP/D12 =     IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0
                             ELSE (PADV/NET_TKT_CNT) ;                          
BY FLAG
ON TABLE HOLD AS TOTAVG
END
-RUN
 
TABLE FILE TOTAVG
PRINT ATP AAP
ON TABLE SAVE AS TOTAVG1
END
-RUN
 
- IF &LINES EQ 0 THEN GOTO NoAVGR;

-READ TOTAVG1 NOCLOSE &ATP.12. &AAP.12.  

EX FMTNUMBER VALUE=&ATP ,DOLLAR='Y',LEN = 6
-RUN
-SET &ATP1 = '&&RETVAL.EVAL'; 
-RUN
EX FMTNUMBER VALUE=&AAP ,DOLLAR='N',LEN = 6
-RUN
-SET &AAP1 = '&&RETVAL.EVAL';
-RUN
-*FOOTING BOTTOM

-*"Average ticket price  - &ATP1.EVAL "
-*"Average advance purchase - &AAP1.EVAL " 



-CLOSE TOTAVG1
-NoAVGR





TABLE FILE AIRHOLD3
-INCLUDE HEADTSA
"&&SUBHEAD"
"</1"


SUM
  XPSNGR_NM AS 'TRAVELER'
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'DEPART'   
  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  CITYS/A50 AS 'ITINERARY'
  EXIND3 AS 'EX,IND'
  INTL_DOM AS 'INTL,IND'
  PADV AS 'DAYS,ADV'
  FARE AS 'FARE'
  TSFARE2 NOPRINT 
  LOW_AMT AS 'LOW,FARE'
COMPUTE LOST_SAV_AMT/D12.2CS = FARE - LOW_AMT; AS 'LOST,SVGS'
-*  LOST_SAV_AMT AS 'LOST,SVGS'
  NET_TKT_CNT  AS 'TKT,CNT'
BY FLAG NOPRINT
BY LEV4 AS 'COST,CENTER,DEPARTMENT'
BY EX_IND NOPRINT 
BY XPSNGR_NM NOPRINT BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT
WHERE XPSNGR_NM NE ' '
-*IF EXIND3 CONTAINS 'E-' THEN 0 ELSE  
ON LEV4 COMPUTE AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TSFARE2/NET_TKT_CNT) ;   
-* IF EXIND3 CONTAINS 'E-' THEN 0 ELSE
ON LEV4 COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
  IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (PADV/NET_TKT_CNT) ;  

ON LEV4 UNDER-LINE

ON LEV4 RECOMPUTE FARE LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for' 




-*-INCLUDE FOOTERDT
-Rpt2

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-SET &FTR_AddlLines = 5;
FOOTING BOTTOM
"</2"
"<95 Total Average ticket price  - &ATP1.EVAL "
"<95 Total Average advance purchase - &AAP1.EVAL "
-*
-INCLUDE FOOTERDT
-*
ON TABLE SET STYLE *
-INCLUDE DTLEGAL
-*
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-ABCD

-SET &&PAHDR  = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADTSA' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL'   ELSE 'DTLEGAL';
-RUN

TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</1"
-NOSPC;


SUM
  XPSNGR_NM AS 'TRAVELER'
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'DEPART'   
  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  CITYS/A50 AS 'ITINERARY'
  RTOW_FLAG AS 'RT/OW,FLAG'
  EXIND3 AS 'EX,IND'
  INTL_DOM AS 'INTL,IND'
  PADV AS 'DAYS,ADV'
  FARE_PAID AS 'FARE,PAID'
  FARE AS 'NET,FARE'
  TSFARE2 NOPRINT 
  LOW_AMT AS 'LOW,FARE'
COMPUTE LOST_SAV_AMT/D12.2CS = FARE - LOW_AMT; AS 'LOST,SVGS'
  NET_TKT_CNT  AS 'TKTS,ISSD'
BY FLAG NOPRINT 
BY LEVEL_DESC NOPRINT
BY EX_IND NOPRINT
BY XPSNGR_NM NOPRINT BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT 
WHERE XPSNGR_NM NE ' '
ON LEVEL_DESC COMPUTE AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TSFARE2/NET_TKT_CNT) ;   
ON LEVEL_DESC COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
  IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (PADV/NET_TKT_CNT) ;  

ON LEVEL_DESC UNDER-LINE

ON LEVEL_DESC RECOMPUTE FARE_PAID FARE LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for' 
 

 
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-INCLUDE FOOTERDT
-*
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=TITLE, JUSTIFY=LEFT, $

ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-ABCD1;


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADTSA' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE DTLEGAL;
-SET &&RANK_LIMIT = 9999;
-RUN

TABLE FILE AIRHOLD3
SUM NET_TKT_CNT AS 'NTTKT'
BY LEVEL_DESC
BY PASSNGR_NAME
ON TABLE HOLD AS RNK1
END
-RUN

MATCH FILE AIRHOLD3
PRINT XTRAN_DT
      TRN_DATE
      XFST_DPT
      TKT_NUM
      PNR_LOCATOR
      VAL_AIRLINE
      NOWTOD
      CITYS
      RTOW_FLAG
      INTL_DOM
      PADV
      FARE
      FARE_PAID
      TSFARE2
      LEVEL_DESC
      LOW_AMT
      NET_TKT_CNT
BY LEVEL_DESC
BY PASSNGR_NAME
ON TABLE HOLD 
RUN
FILE RNK1
SUM NTTKT
BY LEVEL_DESC
BY PASSNGR_NAME
AFTER MATCH HOLD AS TAHLD1 OLD-OR-NEW
END
-RUN

TABLE FILE TAHLD1
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</1"
-NOSPC;

SUM
  PASSNGR_NAME AS 'TRAVELER'
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'DEPART'   
  TKT_NUM AS 'TICKET'
  PNR_LOCATOR AS 'PNR'
  VAL_AIRLINE AS 'A/L'
  CITYS/A65 AS 'ITINERARY'
  RTOW_FLAG AS 'RT/OW,FLAG'
-*   EXIND3 AS 'EX,IND'
  INTL_DOM AS 'INTL,IND'
  PADV AS 'DAYS,ADV'
  FARE_PAID AS 'FARE,PAID'
  FARE AS 'NET,FARE'
  TSFARE2 NOPRINT 
  LOW_AMT AS 'LOW,FARE'
COMPUTE LOST_SAV_AMT/D12.2CS = FARE_PAID - LOW_AMT; NOPRINT
COMPUTE LOST_SAV_AMT1/D12.2CS = IF NET_TKT_CNT LT 0 THEN LOST_SAV_AMT * (-1) ELSE LOST_SAV_AMT; AS 'LOST,SVGS'
  NET_TKT_CNT  AS 'TKTS,ISSD'
-* BY FLAG NOPRINT 
BY LEVEL_DESC NOPRINT
BY HIGHEST NTTKT NOPRINT
-* BY EX_IND NOPRINT
BY PASSNGR_NAME NOPRINT 
BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT 
BY PNR_LOCATOR NOPRINT
-* WHERE XPSNGR_NM NE ' '
ON LEVEL_DESC COMPUTE AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (FARE_PAID/NET_TKT_CNT) ;   
ON LEVEL_DESC COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
  IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (PADV/NET_TKT_CNT) ;  

ON LEVEL_DESC UNDER-LINE

ON LEVEL_DESC RECOMPUTE FARE_PAID FARE LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for' 
 
ON PASSNGR_NAME RECOMPUTE MULTILINES FARE_PAID FARE LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for'


ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-INCLUDE FOOTERDT

ON TABLE SET STYLE *
-INCLUDE &&PASTYD
TYPE=REPORT, COLUMN=P7, SQUEEZE=5.00, $

ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT


-EJONES;

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADTSA' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE DTLEGAL;
-RUN

TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</1"
-NOSPC;



SUM
  XPSNGR_NM AS 'TRAVELER'
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'DEPART'   
  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  CITYS/A50 AS 'ITINERARY'
  RTOW_FLAG AS 'RT/OW,FLAG'
  CGBOOK1 AS 'ONL/,TRAD,FLAG'
  EXIND3 AS 'EX,IND'
  INTL_DOM AS 'INTL,IND'
  PADV AS 'DAYS,ADV'
  FARE_PAID AS 'FARE,PAID'
  FARE AS 'NET,FARE'
  TSFARE2 NOPRINT 
  LOW_AMT AS 'LOW,FARE'
COMPUTE LOST_SAV_AMT/D12.2CS = FARE - LOW_AMT; AS 'LOST,SVGS'
  NET_TKT_CNT  AS 'TKTS,ISSD'
BY FLAG NOPRINT 
BY LEVEL_DESC NOPRINT
BY EX_IND NOPRINT
BY XPSNGR_NM NOPRINT BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT 
WHERE XPSNGR_NM NE ' '
ON LEVEL_DESC COMPUTE AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TSFARE2/NET_TKT_CNT) ;   
ON LEVEL_DESC COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
  IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (PADV/NET_TKT_CNT) ;  

ON LEVEL_DESC UNDER-LINE

ON LEVEL_DESC RECOMPUTE FARE_PAID FARE LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for' 
 

 
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-INCLUDE FOOTERDT

ON TABLE SET STYLE *
-INCLUDE &&PASTYD
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=TITLE, JUSTIFY=LEFT, $

ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-CRAY;

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADTSA' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE DTLEGAL;
-RUN

TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</1"
-NOSPC;



SUM
  XPSNGR_NM AS 'TRAVELER'
  AROLL_DSC7 AS 'MANAGER ID'
  XTRAN_DT AS 'INVOICED'
  XFST_DPT AS 'DEPART'   
  TKT_NUM AS 'TICKET'
  VAL_AIRLINE AS 'A/L'
  CITYS/A50 AS 'ITINERARY'
  RTOW_FLAG AS 'RT/OW,FLAG'
  CGBOOK1 AS 'ONL/,TRAD,FLAG'
  EXIND3 AS 'EX,IND'
  INTL_DOM AS 'INTL,IND'
  PADV AS 'DAYS,ADV'
  FARE_PAID AS 'FARE,PAID'
  FARE AS 'NET,FARE'
  TSFARE2 NOPRINT 
  LOW_AMT AS 'LOW,FARE'
COMPUTE LOST_SAV_AMT/D12.2CS = FARE - LOW_AMT; AS 'LOST,SVGS'
  NET_TKT_CNT  AS 'TKTS,ISSD'
BY FLAG NOPRINT 
BY LEVEL_DESC NOPRINT
BY EX_IND NOPRINT
BY XPSNGR_NM NOPRINT 
BY AROLL_DSC7 NOPRINT
BY XTRAN_DT NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT 
WHERE XPSNGR_NM NE ' '
ON LEVEL_DESC COMPUTE AVERAGE_TICKET_PRICE/D12.2CS = 
       IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (TSFARE2/NET_TKT_CNT) ;   
ON LEVEL_DESC COMPUTE AVERAGE_ADVANCE_PURCHASE/D9CS=
  IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE (PADV/NET_TKT_CNT) ;  

ON LEVEL_DESC UNDER-LINE

ON LEVEL_DESC RECOMPUTE FARE_PAID FARE LOW_AMT LOST_SAV_AMT NET_TKT_CNT AS 'Sub-total for' 
 

 
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
-*
-INCLUDE FOOTERDT

ON TABLE SET STYLE *
-INCLUDE &&PASTYD
TYPE=DATA, JUSTIFY=LEFT, $
TYPE=TITLE, JUSTIFY=LEFT, $

ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT



-UNVM
SUM  VAL_AIRLINE AS 'VALIDATING,AIRLINE'
    XTRAN_DT AS 'TRANSACTION,DATE'
    C_ITIN AS 'ITINERARY'
    FST_DPT_DATE AS 'DEPART_DATE'
    RTN_DATE AS 'RETURN,DATE'
    FARE_PAID AS 'FARE'
BY VAL_AIRLINE NOPRINT
BY XTRAN_DT NOPRINT
BY C_ITIN NOPRINT

ON TABLE COLUMN-TOTAL

-*********
-FinishRpt
-*********
-IF '&&SETF.EVAL' EQ 'ABACTIVY' THEN GOTO NOspace;
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
" "
-*********
-NOspace
-*********
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
-*ON TABLE HOLD

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 

ON TABLE SET STYLE *

-INCLUDE &&PASTYD

ENDSTYLE
-*


&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN



-XXIT
