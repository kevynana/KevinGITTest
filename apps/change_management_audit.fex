-*======================================================================
-*  PROGRAM : change_management_audit.fex               DATE: 12/11/2013
-*======================================================================
-*  DESCRIPTION: This program identifies changed files in application
-*               directories.  .foc, .ftm, .txt, and .csv files are
-*               excluded
-*
-*  PROGRAMMER: GSE                               REQUESTOR: STEVE CORDS
-*  DATE        PROGRAMMER  CHANGE
-*  ----        ----------  ---------------------------------
-*  12/04/2014  GSE         Changed &FROMDATE calculation to look 7 days
-*                          prior.  This is a temporary change.
-*======================================================================
-* File change_management_audit.fex
-DEFAULT &THRU='';
-DEFAULT &FROM='';
 
-SET &RUNDAY = EDIT(&YYMD,'$$$$$$99');
-SET &RUNYYM = EDIT(&YYMD,'999999');
-SET &FSTYMD = &RUNYYM | '01';
-SET &LSTYMD = AYMD(&FSTYMD, -1, 'I8');
-SET &LSTYYM = EDIT(&LSTYMD,'999999');
 
-SET &FROMDATE = IF '&FROM.EVAL' GT '' THEN '&FROM.EVAL' ELSE
-                   AYMD(&YYMD,-7,'I8');
-*                IF '&RUNDAY.EVAL' EQ '01' THEN '&LSTYYM.EVAL' | '15' ELSE
-*                IF '&RUNDAY.EVAL' EQ '15' THEN '&RUNYYM.EVAL' | '01' ELSE
-*                   AYMD(&YYMD,-15,'I8');
-SET &THRUDATE = IF '&THRU.EVAL' GT '' THEN '&THRU.EVAL' ELSE
-                   &YYMD;
-*                IF '&RUNDAY.EVAL' EQ '01' THEN '&LSTYMD.EVAL' ELSE
-*                IF '&RUNDAY.EVAL' EQ '15' THEN '&RUNYYM.EVAL' | '14' ELSE &YYMD;
-*
-*
FILEDEF FILEAUDIT DISK FILEAUDIT (APPEND
-*
APP LIST HOLD
TABLE FILE FOCAPPL
BY APPNAME
WHERE APPNAME OMITS 'load_executes'
ON TABLE HOLD AS APPLIST FORMAT ALPHA
END
-RUN
-*
-REPEAT :LAB1 &LINES TIMES
-READFILE APPLIST
-RUN
-*
-SET &APPQ = '&APPNAME.EVAL' || (' ' | 'HOLD');
-SET &SEL_NAME = IF '&APPNAME.EVAL' CONTAINS 'dbrdata' THEN 'E$*' ELSE 'FOC_NONE';
-RUN
 
APP QUERY &APPNAME HOLD
-RUN
DEFINE FILE FOCAPPQ
APP_PATH/A100 = '&APPNAME.EVAL';
DATE_FMTD/A8DMYY = EDIT(DATE,'99$99$9999');
YYMD_DATE/YYMD = DATE_FMTD;
FILE_FLAG/A1 = IF FILENAME EQ 'E$*' THEN 'Y' ELSE 'N';
END
-*
TABLE FILE FOCAPPQ
PRINT
      YYMD_DATE
	  TIME
BY APP_PATH
BY FILENAME
WHERE YYMD_DATE GE &FROMDATE AND YYMD_DATE LE &THRUDATE
WHERE FILENAME OMITS '.foc' OR '.FOC' OR '.txt' OR '.TXT' OR '.CSV' OR '.csv' OR '.FTM' OR '.ftm'
WHERE FILENAME NE '&SEL_NAME.EVAL'
WHERE FILENAME CONTAINS '.'
ON TABLE HOLD AS FILEAUDIT
END
-RUN
-*
-:LAB1
-*
APP MAP SRV77ETC "D:\IBI\SRV77\WFS\ETC"
-RUN
APP QUERY SRV77ETC HOLD
-RUN
DEFINE FILE FOCAPPQ
APP_PATH/A100 = '\IBI\SRV77\WFS\ETC\';
DATE_FMTD/A8DMYY = EDIT(DATE,'99$99$9999');
YYMD_DATE/YYMD = DATE_FMTD;
END
-*
TABLE FILE FOCAPPQ
PRINT
      YYMD_DATE
	  TIME
BY APP_PATH
BY FILENAME
WHERE YYMD_DATE GE &FROMDATE AND YYMD_DATE LE &THRUDATE
WHERE FILENAME OMITS '.url'
ON TABLE HOLD AS FILEAUDIT
END
-RUN
-*
APP MAP SRV77BIN "D:\IBI\SRV77\WFS\BIN"
-RUN
APP QUERY SRV77BIN HOLD
-RUN
DEFINE FILE FOCAPPQ
APP_PATH/A100 = '\IBI\SRV77\WFS\BIN\';
DATE_FMTD/A8DMYY = EDIT(DATE,'99$99$9999');
YYMD_DATE/YYMD = DATE_FMTD;
END
-*
TABLE FILE FOCAPPQ
PRINT
      YYMD_DATE
	  TIME
BY APP_PATH
BY FILENAME
WHERE YYMD_DATE GE &FROMDATE AND YYMD_DATE LE &THRUDATE
WHERE FILENAME OMITS '.url'
ON TABLE HOLD AS FILEAUDIT
END
-RUN
-*
APP MAP SRV76ETC "D:\IBI\SRV76\WFS\ETC"
-RUN
APP QUERY SRV76ETC HOLD
-RUN
DEFINE FILE FOCAPPQ
APP_PATH/A100 = '\IBI\SRV76\WFS\ETC\';
DATE_FMTD/A8DMYY = EDIT(DATE,'99$99$9999');
YYMD_DATE/YYMD = DATE_FMTD;
END
-*
TABLE FILE FOCAPPQ
PRINT
      YYMD_DATE
	  TIME
BY APP_PATH
BY FILENAME
WHERE YYMD_DATE GE &FROMDATE AND YYMD_DATE LE &THRUDATE
WHERE FILENAME OMITS '.url'
ON TABLE HOLD AS FILEAUDIT
END
-RUN
-*
APP MAP SRV76BIN "D:\IBI\SRV76\WFS\BIN"
-RUN
APP QUERY SRV76BIN HOLD
-RUN
DEFINE FILE FOCAPPQ
APP_PATH/A100 = '\IBI\SRV76\WFS\BIN\';
DATE_FMTD/A8DMYY = EDIT(DATE,'99$99$9999');
YYMD_DATE/YYMD = DATE_FMTD;
END
-*
TABLE FILE FOCAPPQ
PRINT
      YYMD_DATE
	  TIME
BY APP_PATH
BY FILENAME
WHERE YYMD_DATE GE &FROMDATE AND YYMD_DATE LE &THRUDATE
WHERE FILENAME OMITS '.url'
ON TABLE HOLD AS FILEAUDIT
END
-RUN
-*
-GOTO AUDRPT
APP QUERY DBR HOLD
-RUN
-*
DEFINE FILE FOCAPPQ
APP_PATH/A100 = '\TNT\DBR\';
DATE_FMTD/A8DMYY = EDIT(DATE,'99$99$9999');
YYMD_DATE/YYMD = DATE_FMTD;
END
-*
TABLE FILE FOCAPPQ
PRINT
      YYMD_DATE
	  TIME
BY APP_PATH
BY FILENAME
WHERE YYMD_DATE GE &FROMDATE AND YYMD_DATE LE &THRUDATE
WHERE FILENAME OMITS '.url'
ON TABLE HOLD AS FILEAUDIT
END
-RUN
-*
-AUDRPT
-SET &HDFROM = EDIT(&FROMDATE,'$$$$99/99/') | EDIT(&FROMDATE,'9999');
-SET &HDTHRU = EDIT(&THRUDATE,'$$$$99/99/') | EDIT(&THRUDATE,'9999');
TABLE FILE FILEAUDIT
PRINT
      YYMD_DATE AS 'DATE,OF,CHANGE'
	  TIME AS 'TIME,OF,CHANGE'
BY APP_PATH AS 'APPLICATION'
BY FILENAME
HEADING
"Changed files by application directory"
"From: &HDFROM To &HDTHRU "
FOOTING
"Run Date: &DATEMDYY &TOD"
ON TABLE PCHOLD FORMAT EXL2K
END
 
