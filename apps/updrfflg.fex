SET ASNAMES=ON


USE CLEAR *
USE
    K:\TNT\TTRACKER\SUDATA\ROLLUP.FOC
END

  FI CUSTS DISK K:\LOAD\FOCTEMP\CUSTS.DAT
SET MESSAGE=ON
-*=======================================================================
SET ASNAMES=ON
DEFINE FILE ROLLUP
XL01/A1 = 'W' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP AS 'ROLLUP_CODE'
      XL01   AS 'PR_STAMP'
IF UPD_ENABLE NE ' '
IF QTR_ENABLE EQ ' '
-* IF ROLLUP EQ 'METX-R'
ON TABLE HOLD
END
-RUN


MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-*======================================================================
USE CLEAR *
-RUN
SET TEMPDIR=K:\FOCTEMP
SET MESSAGE=ON
SET WARNING=OFF
SET YRTHRESH=30
SET DEFCENT=19
-RUN
-*=======================================================================

-SET &CNT=0;

-TOP
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP COMP
BY ROLLUP_CODE NOPRINT
IF UPD_ENABLE NE ' '
IF RECORDLIMIT EQ 1
IF QTR_ENABLE EQ ' '
IF PR_STAMP EQ 'W'
-* IF ROLLUP EQ 'METX-R'
ON TABLE SAVE AS CUSTS
END
-RUN

-READ CUSTS &&ROLLUP.A8 &&COMP.A6.
-RUN

-IF &RECORDS EQ 0 THEN GOTO STOP;
-RUN


-* -SET &&SMD = 'S';

-* EX AIRXUSEX
-* -RUN

-* SEGMENT FILES
-SET &&FOCSNAME = 'S_'||&&COMP;





-TYPE DEBTEST &&FOCSNAME

TABLE FILE &&FOCSNAME
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF EMBARK EQ 'RF1'
IF RF_FLAG EQ ' '
ON TABLE HOLD AS DEBHOLD
END
-RUN

TABLE FILE &&FOCSNAME
-* PRINT AIR_KEY RF_FLAG AS 'XL02'
SUM AIR_KEY RF_FLAG AS 'XL02'
BY AIR_KEY NOPRINT
IF RF_FLAG NE ' '
IF EMBARK NE 'RF1'
ON TABLE HOLD AS HLD1
END
-RUN

MATCH FILE DEBHOLD
PRINT EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY
ON TABLE HOLD
RUN
FILE HLD1
SUM XL02
BY AIR_KEY
AFTER MATCH HOLD AS HOLD2 OLD
END
-RUN

TABLE FILE HOLD2
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR XL02 AS 'RF_FLAG'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE &&FOCSNAME
FIXFORM FROM HOLD3
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
-* ON MATCH COMPUTE RF_FLAG = RF_FLAG;
ON MATCH UPDATE RF_FLAG
ON NOMATCH REJECT
DATA ON HOLD3
END
-RUN





TABLE FILE &&FOCSNAME
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF EMBARK EQ 'EX1'
IF EX_FLAG EQ ' '
ON TABLE HOLD AS DEBHOLD2
END
-RUN

TABLE FILE &&FOCSNAME
SUM AIR_KEY EX_FLAG AS 'XL03'
BY AIR_KEY NOPRINT
IF EX_FLAG NE ' '
IF EMBARK NE 'EX1'
ON TABLE HOLD AS EXHLD
END
-RUN

MATCH FILE DEBHOLD2
PRINT EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY
ON TABLE HOLD
RUN
FILE EXHLD
SUM XL03
BY AIR_KEY
AFTER MATCH HOLD AS EXHOLD2 OLD
END
-RUN

TABLE FILE EXHOLD2
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR XL03 AS 'EX_FLAG'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS EXHOLD3
END
-RUN


MODIFY FILE &&FOCSNAME
FIXFORM FROM EXHOLD3
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
-* ON MATCH COMPUTE EX_FLAG = EX_FLAG;
ON MATCH UPDATE EX_FLAG
ON NOMATCH REJECT
DATA ON EXHOLD3
END
-RUN









DEFINE FILE ROLLUP
XL01/A1 = 'Z' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP AS 'ROLLUP_CODE'
      XL01   AS 'PR_STAMP'
WHERE ROLLUP_CODE EQ '&&ROLLUP.EVAL'
ON TABLE HOLD
END
MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-GOTO TOP
-RUN
-*======================================================================
-STOP

-XFER
-TYPE PROGRAM COMPLETED.......
-EXIT

-XXIT
-EXIT





