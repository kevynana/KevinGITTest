-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Updated hierloop filedef to look at system data JK 3/24/14
-*3/2/16 - JEM -S-16367 Updated hard coded d:\ to use &&WFSRV1.EVAL
-*10/24/16-JEM-S-26246-Updated hold file name on line 103 to correct report error
-* 07/03/2017 - RSB - S-35420 Report view to be updated with standard footer (part 3)
-* 08/30/2017 - RSB - S-38398 JOINT-R Current Level Details is not a link
-*                             Backed out footer changes for S-35420
-*

SET ASNAMES=ON


TABLE FILE RPTHOLD
SUM DISSAVINGS AS 'DTSAVE'
    FARE_PAID AS 'TFARE'
    NEW_SEG_MILES AS 'TMILE'
    SAVINGS AS 'TSAVE'    
    NET_TKT_CNT AS 'TTKT'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN

DEFINE FILE RPTHOLD
ROLL/A50 = CTRAN (50, LEVEL_DESC, 40, 95, 'A50');
ROLL1/A60 = CTRAN (50, ROLL, 41, 95, 'A60');
ROLL1A/A60 = CTRAN (50, ROLL1, 58, 95, 'A60');
ROLLA/A60 = CTRAN (60, ROLL1A, 47, 95, 'A60');
END

TABLE FILE RPTHOLD
PRINT AIR_KEY
  AIRLINE	
  ARR_TIME
  DISSAVINGS	
  DPT_TIME	
  EMB_CTY_NM
  FARE_PAID	
  NET_TKT_CNT	
  NEW_ADV_PURCH	
  REFUSE_CODE
  ROLLA
  RTE_CTY_NM
  SAVINGS	
  SEG_COUNT	
  SEG_NBR	
  TKT_NUM	
  TKT_TYPE	
  XARR_DT	
  XDPT_DT	
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN


MATCH FILE XTWO
PRINT AIR_KEY 
  AIRLINE	
  ARR_TIME
  DISSAVINGS	
  DPT_TIME	
  EMB_CTY_NM
  FARE_PAID	
  NET_TKT_CNT	
  NEW_ADV_PURCH	
  REFUSE_CODE	
  ROLLA
  RTE_CTY_NM
  SAVINGS	
  SEG_COUNT	
  SEG_NBR	
  TKT_NUM	
  TKT_TYPE	
  XARR_DT	
  XDPT_DT	
  XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TFARE
      TMILE
      TSAVE
      TTKT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN


TABLE FILE AIRHOLD2
PRINT AIRLINE	
  ARR_TIME
  DISSAVINGS	
  DPT_TIME	
  EMB_CTY_NM
  FARE_PAID	
  LEVEL_DESC
  NET_TKT_CNT	
  NEW_ADV_PURCH	
  REFUSE_CODE	
  ROLLA
  RTE_CTY_NM
  SAVINGS	
  SEG_COUNT	
  SEG_NBR	
  TKT_NUM	
  TKT_TYPE
  TRN_DATE	
  XARR_DT	
  XDPT_DT
  XPSNGR_NM	
  XTRAN_DT
  DTSAVE
  TFARE
  TMILE
  TSAVE
  TTKT	
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN


FILEDEF HIERLOOP DISK &&WFSRV1.EVAL\TNT\TTRACKER\SYSTEM\DATA\HIERLOOP.TXT
-RUN

TABLE FILE AIRHOLD3
SUM ROLLA
BY ROLLA
ON TABLE SAVE AS HIERLOOP 
END
-RUN

-TYPE "PRIOR TO LOOP"
-SET &CNT = &LINES;
-SET &INDEX = 1;
-REPEAT TOEND1 &CNT TIMES
-READ HIERLOOP NOCLOSE &ROLLA.&INDEX.A60.
-TYPE &ROLLA.&INDEX
-SET &INDEX = &INDEX + 1;
-TOEND1
-RUN

-TYPE "AFTER LOOP"
-SET &INDEX = 1;
-REPEAT TOEND2 &CNT TIMES
-SET &ROLLA=&ROLLA.&INDEX;


DEFINE FILE AIRHOLD3
-INCLUDE STDTIME
LOST_SAV_AMT/D9.2CS = IF TKT_SORT NE LAST TKT_SORT THEN DTSAVE ELSE 0;
RREFUSE_CODE/A2 = IF TKT_SORT NE LAST TKT_SORT THEN REFUSE_CODE ELSE ' ';
TICKET_NMBR/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_NUM ELSE ' ';
XT_DTE/A8 = EDIT(TRN_DATE);
XTKT_SRT/A10 = EDIT(TKT_SORT,'9999999999$');
-* ****DEFINES ON PREVIOUS DEFINES****
SRT_DT/A100 = TKT_SORT||XT_DTE||LEVEL_DESC||XPSNGR_NM;
FARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TFARE ELSE 0;
SAVE_AMT/D10.2CS = IF SRT_DT NE LAST SRT_DT THEN TSAVE ELSE 0;
NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
END

-SET &&RPTSUF = 'DTL';
-* -INCLUDE FDEFJOY1
-INCLUDE FDEFRPTS
-RUN
-*
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN
-*
TABLE FILE AIRHOLD3
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-* -INCLUDE HDMUL
-* "&&SUBHEAD"
-* "</2"
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10

&&BREAKOPTION
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
WHERE ROLLA EQ '&ROLLA.EVAL'
-*
-INCLUDE FOOTERDT
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-* ON TABLE SET HTMLCSS ON
-INCLUDE SBFOOT

-GOTO AROUND

TYPE=DATA,
     COLUMN=N1,
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='multidrill2' Lvl1=N1), $

UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.250000, RIGHTMARGIN=0.250000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, OBJECT=TEXT, SIZE=8, COLOR=BLACK, $
TYPE=HEADING, LINE=4, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=5, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=6, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=7, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=8, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=10, SIZE=9, STYLE=BOLD, COLOR=GREY, $
TYPE=HEADING, LINE=11, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=HEADING, LINE=12, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=FOOTING, SIZE=7, STYLE=BOLD, COLOR=GREY, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=8, STYLE=BOLD, $
TYPE=GRANDTOTAL, SIZE=8, STYLE=BOLD, $
TYPE=REPORT, IMAGE=&&TNTPIC,  POSITION=(&&TNTDTPOS), SIZE=(&&TNTDTSIZ), $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&ROLDTPOS), SIZE=(&&ROLDTSIZ), $
-AROUND
-* ON LEVEL_DESC RECOMPUTE AS 'TOTAL FOR'
-* ON ROLL1 RECOMPUTE AS 'TOTAL FOR'
ON TABLE SET STYLE *
-*
-INCLUDE &&DTSTY
-*
ENDSTYLE
&&OUTLINE1
&&OUTLINE2
END
-RUN

-SET &INDEX = &INDEX + 1;
-TOEND2
-RUN

-SET &&SET_DONE = 'Y';

-EXIT


