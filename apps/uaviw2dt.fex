-* Udid Online/Traditional Analysis
-*4/7/14 - DEB - added code to skip RETUDID to speed up report
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 7/8/15-JEK-STORY ID-S-10107-Added logic for new request to add RBT- udid to report
-* 2/4/16-JEM S-15215 - Added logic for new request to add GN- udid to EJUDOT
-*02/05/16 - DLV - S-13286  Updated to allow reports to sort/subtotal by id-levels
-*06/21/17 - DLV - S-34926 - Carried through FLAG added routine for NYINTER
-*08/14/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = #;
-*
SET ASNAMES=ON 
-RUN

-IF '&&SETF.EVAL' EQ 'ABUCTRP' THEN GOTO NOudid; 

-INCLUDE RETUDID


-NOudid


 
-IF &&CURRENCY EQ 'USD' THEN GOTO NEXT;
 
-SET &&SUBHEAD = <NAMEC;
-SET &GFAR_CUR = 'FARE, (' | &&CURRENCY || ')';
-SET &&PRINT6='GFARE_AMT/D16.2CS AS ' | '''&GFAR_CUR.EVAL''';

-NEXT

TABLE FILE &&RPT_HOLD
SUM BASE_FARE AS 'TBASE'
    FARE_PAID AS 'TFARE'
    PAID_FAREX/D16.2CS AS 'GTFARE'
    NET_TKT_CNT AS 'TTKT'
    NEW_SEG_MILES AS 'TMILE'
    SEG_LOWEST AS 'TLOW'
    DISSAVINGS AS 'DTSAVE'
    ABOOK_DSAVE AS 'TADSAV'
    IBOOK_DSAVE AS 'TIDSAV'
    DSAV_ABOOKX/D16.2CS AS 'GTADSAV'
    DSAV_IBOOKX/D16.2CS AS 'GTIDSAV'  
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT AGENT_NUM
  ABOOK_CNT
  ABOOK_DSAVE
  ABOOK_FARE
  AIBOOK_CNT
  AIR_KEY
  INTL_DOM	
  AIRLINE	
  ARR_TIME
  CLASS
  DISSAVINGS
  DPT_TIME	
  EMB_APT_CD
  EMB_APT_NM
  EMB_CTY_NM	
  FARE_PAID
  FLAG
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IEBOOK_CNT
  IEBOOK_FARE
  INVOICE_NUM
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_MILES
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM
  RTE_CTY_NM
  SEG_COUNT
  SEG_LOWEST	
  SEG_NBR	
  SIBOOK_CNT
  TKT_DATE
  TKT_NUM	
  TKT_SORT	
  TKT_TYPE	
  TRAN_MY
  TRN_DATE
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT
  NAMEC
  PAID_FAREX
  FARE_ABOOKX
  FARE_IBOOKX
  FARE_IEBOOKX
  DSAV_IBOOKX
  DSAV_ABOOKX
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN


MATCH FILE XTWO
PRINT AGENT_NUM
  ABOOK_CNT
  ABOOK_DSAVE
  ABOOK_FARE
  AIBOOK_CNT
  AIR_KEY
  INTL_DOM	
  AIRLINE	
  ARR_TIME
  CLASS
  DISSAVINGS
  DPT_TIME	
  EMB_APT_CD
  EMB_APT_NM
  EMB_CTY_NM	
  FARE_PAID
  FLAG
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IEBOOK_CNT
  IEBOOK_FARE
  INVOICE_NUM
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_MILES
  REFUSE_CODE
  REFUSAL_DESC
  RTE_APT_CD
  RTE_APT_NM
  RTE_CTY_NM
  SEG_COUNT
  SEG_LOWEST	
  SEG_NBR	
  SIBOOK_CNT
  TKT_DATE
  TKT_NUM	
  TKT_SORT	
  TKT_TYPE	
  TRAN_MY
  TRN_DATE
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT
  NAMEC
  PAID_FAREX
  FARE_ABOOKX
  FARE_IBOOKX
  FARE_IEBOOKX
  DSAV_IBOOKX
  DSAV_ABOOKX
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      GTFARE
      GTADSAV
      GTIDSAV
      TADSAV
      TBASE
      TIDSAV
      TFARE
      TTKT
      TLOW
      TMILE
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

TABLE FILE AIRHOLD2
PRINT AGENT_NUM
  ABOOK_CNT
  ABOOK_DSAVE
  ABOOK_FARE
  AIBOOK_CNT
  INTL_DOM	
  AIRLINE	
  ARR_TIME
  CLASS
  DISSAVINGS
  DPT_TIME
  EMB_APT_CD
  EMB_APT_NM
  EMB_CTY_NM	
  FARE_PAID
  FLAG
  IBOOK
  IBOOK_CNT
  IBOOK_DSAVE
  IBOOK_FARE
  IEBOOK_CNT
  IEBOOK_FARE
  INVOICE_NUM
  LEVEL_DESC	
  LEVEL1	
  LEVEL2	
  LEVEL3
  NEW_ADV_PURCH
  NET_TKT_CNT
  NEW_SEG_MILES
  REFUSAL_DESC
  REFUSE_CODE
  RTE_APT_CD
  RTE_APT_NM
  RTE_CTY_NM
  SEG_COUNT
  SEG_LOWEST	
  SEG_NBR	
  SIBOOK_CNT
  TKT_DATE
  TKT_NUM	
  TKT_SORT	
  TKT_TYPE	
  TRAN_MY
  TRN_DATE
  XDPT_DT	
  XPSNGR_NM
  XTRAN_DT
  NAMEC
  PAID_FAREX
  FARE_ABOOKX
  FARE_IBOOKX
  FARE_IEBOOKX
  DSAV_IBOOKX
  DSAV_ABOOKX
  DTSAVE
  GTFARE
  GTADSAV
  GTIDSAV
  TADSAV
  TBASE
  TIDSAV
  TFARE
  TTKT
  TLOW
  TMILE
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3
END
-RUN


-IF '&&SETF.EVAL' EQ 'TUUDOT' THEN GOTO EXTEMPU;
-IF '&&SETF.EVAL' EQ 'EJUDOT' THEN GOTO EXEJONES;
-IF '&&SETF.EVAL' EQ 'PBUDOT' THEN GOTO EXPUBLIC;
-IF '&&SETF.EVAL' EQ 'NYUDOT' OR 'ABUDOT' THEN GOTO EXNYL;
-IF '&&SETF.EVAL' EQ 'KMCUDOT' THEN GOTO EXKMC;
-IF '&&SETF.EVAL' EQ 'NYINTER' THEN GOTO EXNYLRBT;
-RBT


EX UDRBTDTL
-RUN

-IF &&NRBTREC EQ 'Y' THEN GOTO NORECORDS;

-GOTO FinishRpt;
-EXTEMPU

EX UDTEMPU  
-RUN

-GOTO FinishRpt;

-EXEJONES

EX UDEJGN 
-RUN

-GOTO FinishRpt;


-EXWWF

EX UDWWF2
-RUN

-IF &&NOWWF2 EQ 'Y' THEN GOTO NORECORDS;
-GOTO FinishRpt;

-EXNYL
EX UDNYL2
-RUN

-GOTO FinishRpt;

-EXKMC
 

EX UDKMC
-RUN
-GOTO FinishRpt;


-EXPUBLIC

EX UDPBRBTDT 
-RUN

-GOTO FinishRpt;

-EXNYLRBT

EX UDNYLRBTD
-RUN


-FinishRpt;




-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD4';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE AIRHOLD4
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-IF '&&SETF.EVAL' NE 'NYINTER' THEN GOTO NOfoot;

-SET &FTR_AddlLines = 4;
FOOTING BOTTOM
" "
" "
"includes RBT udid "
"excludes RBT udid containing MSD, T24, and VIP"
-*******
-NOfoot
-*******
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD

ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-GOTO XXIT

-NORECORDS
-SET &&RPTSUF = 'MSG';
-INCLUDE FDEFRPTS
-RUN
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADAIR
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT

