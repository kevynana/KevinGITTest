-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-* 1/21/02     TANDT-JK             ADDED SUMMATION FOR DISSAVINGS
-* 1/21/02     TANDT-JK             ADDED SUMMARTION FOR TKT_PURCH AND
-*                                  REF_EXCH_CNT
-* 5/06/02     TANDT-DB             CARRIED THROUGH PRIN_TKT 
-* 5/15/02     TANDT-DB             CARRIED THROUGH ISU_TKT
-* 9/02/03      TANDT-DV             CARRIED THROUGH PRIN_BASE
-* 12/08/03    TANDT-DV SC          CARRIED THROUGH CCNTR1 
-* 5/3/05      DEB                  ADDED CODE FOR GLOBAL CURRENCY
-*08/30/05     DEB                  ADDED SUMMATION FOR FARE_PAID
-*05/16/06     STEVE                ADDED NW_INCNTV DEFINE
-**********************************************************************

SET ASNAMES = ON
-RUN

-IF &&CURRENCY EQ 'USD' THEN GOTO SKIPTHIS;


-SET &&SUBHEAD = <NAMEC;
-SET &FPAID_CUR = 'FARE PAID, (' | &&CURRENCY || ')';
-SET &GDISV_CUR= 'LOST,SAVINGS, (' | &&CURRENCY || ')';
-SET &GAIRF_CUR ='FEES, (' | &&CURRENCY || ')';
-SET &&S_SUBJ6='PAID_FARE1/D16.2CS AS ' | '''&FPAID_CUR.EVAL''' ;
-SET &&S_SUBJ7='GDIS_SAVE1/D16.2S AS ' | '''&GDISV_CUR.EVAL''';
-SET &&S_SUBJ8='PCT.GDIS_SAVE1/P9.1 AS ''% OF,LOST SVGS''';
-SET &&S_SUBJ9='GAIR_FEE1/D16.2CS AS ' | '''&GAIRF_CUR.EVAL''';



-SKIPTHIS;

TABLE FILE RPTHOLD2
SUM NET_TKT_CNT AS 'NTTKT'
    BASE_FAR2 AS 'TBASE'
    DISSAVINGS AS 'TLOSS'
    GDIS_SAVE1/D16.2CS AS 'GTLOSS'
    REF_EXCH_CNT AS 'TRFEX'
    TKT_PURCH AS 'TPURCH'
    FARE_PAID AS 'TFARE'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS HOLDONE
END
-RUN




TABLE FILE RPTHOLD2
PRINT AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  ARR_DAY
  ARR_TIME
  AUX_NON_MIR
  BASE_FAR2	
  BR_CL_IDX
  CASH_CRDT	
  CLASS	
  CLASS_CAT	
  CLIENT_NAME
  CLIENT_NUM	
-*   COSTCNTR
  CCNTR
  CREDIT_CARD
  DEPT_MONTH
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DPT_DAY
  DPT_TIME
  DST_APC
  FARE_BAS	
  FARE_PAID
  GAIR_FEE1/D16.2CS
  GDIS_SAVE1/D16.2CS
  GROUP_CODE
  GROSS_DSAVE	
  GROSS_FARE
  INT_CODE
  INTL_DOM
  ISU_TKT
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT
  NAMEC
  ND_CITY_NM	
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  ORG_APC
  PAID_FARE1/D16.2CS
  PRIN_BASE
  PRIN_TKT	
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH
  RND_TRP
  SAVINGS	
  SEG_AMT	
  SEG_LOWEST	
  SEG_STANDARD
  SEG_TAX	
  STAY
  TKT_NUM	
  TKT_PURCH	
  VAL_AIRLINE
  XARR_DOW
  XPSNGR_NM	
  XTRAN_DT
  XDPT_DOW	
  XDPT_DT
  REFUSE_CODE
  REFUSAL_DESC
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  ARR_DAY
  ARR_TIME
  AUX_NON_MIR
  BASE_FAR2	
  BR_CL_IDX
  CASH_CRDT	
  CLASS	
  CLASS_CAT	
  CLIENT_NAME	
  CLIENT_NUM	
-*   COSTCNTR
  CCNTR
  CREDIT_CARD
  DEPT_MONTH
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DPT_DAY
  DPT_TIME
  DST_APC
  FARE_BAS	
  FARE_PAID
  GAIR_FEE1
  GDIS_SAVE1
  GROSS_DSAVE	
  GROSS_FARE	
  GROUP_CODE
  INT_CODE
  INTL_DOM
  ISU_TKT
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT
  NAMEC
  ND_CITY_NM	
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  ORG_APC
  PAID_FARE1
  PRIN_BASE
  PRIN_TKT	
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH
  RND_TRP
  SAVINGS	
  SEG_AMT	
  SEG_LOWEST	
  SEG_STANDARD
  SEG_TAX	
  STAY
  TKT_NUM	
  TKT_PURCH	
  VAL_AIRLINE
  XARR_DOW
  XPSNGR_NM	
  XTRAN_DT
  XDPT_DOW	
  XDPT_DT
  REFUSE_CODE
  REFUSAL_DESC
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD
RUN
FILE HOLDONE
SUM GTLOSS
    NTTKT
    TLOSS
    TRFEX
    TPURCH
    TBASE
    TFARE
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN



DEFINE FILE XTHREE ADD
PCTDSAVE/D8.1S= IF ((TLOSS LT 1) AND (TLOSS GT (-1))) THEN 0
                ELSE ((DISSAVINGS/TLOSS)*100);	
PCTRFEX/D8.1S=  IF ((TRFEX LT 1) AND (TRFEX GT (-1))) THEN 0
                ELSE ((REF_EXCH_CNT/TRFEX)*100);	
PCTTKT/D8.1S=   IF ((TPURCH LT 1) AND (TPURCH GT (-1))) THEN 0
                ELSE ((TKT_PURCH/TPURCH)*100);	
                
                

-*OW_INCNTV/A15= IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE LT 125) OR (TBASE GT -125))) THEN 'LESS THAN 125' ELSE
-*                   IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GE 125) AND (TBASE LE 225)) OR
-*                      ((TBASE LE -125) AND (TBASE GE -225)))
-*                                       THEN '125 - 224' ELSE
-*                   IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GE 225) OR (TBASE LE -225))) THEN
-*                                      '225 AND ABOVE' ELSE ' ';
                                      
                                      
-*RT_INCNTV/A15=  IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LT 250) OR (TBASE GT -250))) THEN 'LESS THAN 250' ELSE
-*                  IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GE 250) AND (TBASE LE 449)) OR
-*                     ((TBASE LE -250) AND (TBASE GE -449)))
-*                                       THEN '250 - 449' ELSE
-*                  IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GE 450) OR (TBASE LE -450))) THEN
-*                                      '450 AND ABOVE' ELSE ' ';  


YX_INCNTV/A15= IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE LT 125) AND (TBASE GT -125))) THEN '124 AND UNDER' ELSE
               IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GT 124) AND (TBASE LT 225))) OR
                  ((RND_TRP EQ 'ONE WAY') AND ((TBASE LT -125) AND (TBASE GT -225))) THEN '125 - 224' ELSE          
               IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GT 224) OR (TBASE LT -224))) THEN '225 AND ABOVE' ELSE                
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LT 250) AND (TBASE GT -250))) THEN '249 AND UNDER' ELSE
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GT 249) AND (TBASE LT 450))) OR
                  ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LT -250) AND (TBASE GT -449)))
                                       THEN '250 - 449' ELSE
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GT 449) OR (TBASE LT -450))) THEN
                                      '450 AND ABOVE' ELSE ' ';  
                                      
BD_YXIC/A15= IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE LT 150) AND (TBASE GT -150))) THEN ' UNDER 150' ELSE
               IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GE 150) AND (TBASE LE 250))) OR
                  ((RND_TRP EQ 'ONE WAY') AND ((TBASE LE -150) AND (TBASE GE -250))) THEN '150 - 250' ELSE          
               IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GT 250) OR (TBASE LT -250))) THEN 'OVER 250' ELSE                
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LT 300) AND (TBASE GT -300))) THEN ' UNDER 300' ELSE
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GE 300) AND (TBASE LE 500))) OR
                  ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LE -300) AND (TBASE GE -500)))
                                       THEN '300 - 500' ELSE
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GT 500) OR (TBASE LT -500))) THEN
                                      'OVER 500' ;                                        
                                      
BD_YXIC2/A15= IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE LT 200) AND (TBASE GT -200))) THEN ' UNDER 200' ELSE
               IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GE 200) AND (TBASE LE 300))) OR
                  ((RND_TRP EQ 'ONE WAY') AND ((TBASE LE -200) AND (TBASE GE -300))) THEN '200 - 300' ELSE          
               IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE GT 300) OR (TBASE LT -300))) THEN 'OVER 300' ELSE                
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LT 400) AND (TBASE GT -400))) THEN ' UNDER 400' ELSE
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GE 399) AND (TBASE LE 599))) OR
                  ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE LE -399) AND (TBASE GE -599)))
                                       THEN '400 - 599' ELSE
               IF ((RND_TRP EQ 'ROUND TRIP') AND ((TBASE GE 600) OR (TBASE LT -600))) THEN                                      
                                      '600 OR OVER' ;                                        
                                                                            
                                      
                                      
                                      
                                      
                                      
NW_INCNTV/A21= IF ((RND_TRP EQ 'ONE WAY') AND ((TBASE LT 300) AND (TBASE GT -300))) THEN 'ONE WAY 299 AND UNDER' 
               ELSE 'ALL OTHER';
                                                  
-* YX_KEY/A1 = IF YX_INCNTV EQ 'LESS THAN 125' THEN 'A' ELSE
-*                IF YX_INCNTV EQ '125 - 224' THEN 'B' ELSE
-*                IF YX_INCNTV EQ '225 AND ABOVE' THEN 'C' ELSE
-*                IF YX_INCNTV EQ 'LESS THAN 250' THEN 'D' ELSE
-*                IF YX_INCNTV EQ '250 - 449' THEN 'E' ELSE 'F';
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
END


 

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

   
ON TABLE COLUMN-TOTAL
-INCLUDE FOOTERSM
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
