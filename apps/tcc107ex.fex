-* JK added code to select only tnt_company eq 1 or 2 2/21/05
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK

-INCLUDE SETECHO
SET ASNAMES = ON

DEFINE FILE CR_50
BOOKINGS/D8 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
-*  LEVEL_DESC/A60 = &&LDESC;
  NBR_CARS/D12 = NUM_CARS;	
  NBR_DAYS/D12 =  IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                  ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;  
  REFUSE_CD/A2 = EDIT(REFUSE_KEY,'$$$$$$$$99'); 
                  
END

TABLEF FILE CR_50
PRINT
  BOOKINGS
  NBR_DAYS AS 'RENTAL_DAYS'	
  NBR_CARS
  RENTAL_AMT/D12.2CS	
  REFUSE_CD 		
 WHERE INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS

ON TABLE HOLD AS TC_HOLD1

END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACT DATA FROM ABOVE - HOLD TO FOCUS DATABASE TCTRNK       
-*========================================================================

DEFINE FILE TC_HOLD1
ROLLCD/A8 = '&&ROLL';
NMB/I5    = NMB + 1;
END
TABLE FILE TC_HOLD1
SUM BOOKINGS
  RENTAL_DAYS 	
  NBR_CARS
  RENTAL_AMT	
BY ROLLCD
BY NMB
BY REFUSE_CD

ON TABLE HOLD AS TCH1 
END
-RUN

MODIFY FILE TCCRSN
FIXFORM FROM TCH1
DATA ON TCH1
END
-RUN

-NEXTONE
