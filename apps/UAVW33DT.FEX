-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-*                     FOCEXEC: AIRRPT
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*6/2/98         JK                 INCLUDE AIRLEVM INSTEAD OF AIRLEVT
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*06/12/03   DEB                    CARRIED THROUGH UPCOST
-*12/30/04   DEB                     CARRIED THROUGH AROLL_LEV4
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-**************************************************************************
SET ASNAMES=ON;

-INCLUDE RETUDID
-RUN



TABLE FILE &&RPT_HOLD
SUM DISSAVINGS AS 'DTSAVE'
    EXCHGS AS 'TEXCH'
    SEG_DISCOUNT AS 'TDISC'
    FARE_PAID AS 'TFARE'
    SEG_LOWEST AS 'TLOW'
    NEW_SEG_MILES AS 'TMILE'
    TKT_PURCH AS 'TPURCH'
    REF_EXCH_CNT AS 'TRFEX'
    SAVINGS AS 'TSAVE'
    SEG_AMT AS 'TSEG'
    SEG_STANDARD AS 'TSTD'
    SEG_TAX AS 'TTAX'
    NET_TKT_CNT AS 'TTKT'
    BASE_FARE AS 'TBASE'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN


TABLE FILE &&RPT_HOLD
PRINT AIR_KEY
      AIRLINE	
      AROLL_LEV1
      AROLL_LEV2
      AROLL_LEV3
      AROLL_LEV4
      AROLL_LEV5
      AROLL_LEV6
      AROLL_LEV7
      AROLL_LEV8
      AROLL_LEV9
      AROLL_LEV10
      AROLL_LEV11
      AROLL_LEV12
      AROLL_LEV13
      AROLL_LEV14
      AROLL_DSC5
      BOOK_DT
      C_ITIN
      CG_CLT
      DISSAVINGS
      DOC_TYPE
      DOD_TYP2
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EMAIL_ADR
      EX_FLAG
      FARE_BAS	
      FARE_PAID
      HIGH_CAT
      INTL_DOM
      LEVEL1
      NET_TKT_CNT
      NEW_ADV_PURCH
      NEW_SEG_MILES
      PASSNGR_NAME
      PNR_LOCATOR
      REFUSE_CODE
      REFUSAL_DESC	
      RF_FLAG
      RTE_APT_CD	
      RTE_APT_NM	
      RTE_CTY_NM	
      SAVINGS	
      SEG_COUNT	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_STANDARD	
      STAY
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TRIP_LENGTH
      USVISA
      VAL_AIRLINE
      VOID_DATE
      XARR_DT	
      XDPT_DT
      XFST_DPT
      XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIR_KEY
      AIRLINE	
      AROLL_LEV1
      AROLL_LEV2
      AROLL_LEV3
      AROLL_LEV4
      AROLL_LEV5
      AROLL_LEV6
      AROLL_LEV7
      AROLL_LEV8
      AROLL_LEV9
      AROLL_LEV10
      AROLL_LEV11
      AROLL_LEV12
      AROLL_LEV13
      AROLL_LEV14
      AROLL_DSC5
      BOOK_DT
      C_ITIN
      CG_CLT
      DISSAVINGS
      DOC_TYPE
      DOD_TYP2
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EMAIL_ADR
      EX_FLAG
      FARE_BAS	
      FARE_PAID	
      HIGH_CAT
      INTL_DOM
      LEVEL1
      NET_TKT_CNT
      NEW_ADV_PURCH
      NEW_SEG_MILES
      PASSNGR_NAME
      PNR_LOCATOR
      REFUSE_CODE
      REFUSAL_DESC
      RF_FLAG
      RTE_APT_CD	
      RTE_APT_NM	
      RTE_CTY_NM	
      SAVINGS	
      SEG_COUNT	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_STANDARD	
      STAY
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TRIP_LENGTH
      USVISA
      VAL_AIRLINE
      VOID_DATE
      XARR_DT	
      XDPT_DT
      XFST_DPT
      XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TDISC
      TEXCH
      TFARE
      TLOW
      TMILE
      TPURCH
      TRFEX
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      TBASE
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

DEFINE FILE AIRHOLD2
FLAG/A1 = IF SEG_NBR EQ '01' OR RF_FLAG EQ 'P' OR EX_FLAG EQ 'P'
          OR DOC_TYPE EQ '1' THEN 'Y' ELSE 'N';
END

TABLE FILE AIRHOLD2
PRINT XDPT_DT AS 'ODPT_DT'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
WHERE FLAG EQ 'Y'
ON TABLE HOLD AS AIRHOLD3
END
-RUN



MATCH FILE AIRHOLD2
PRINT AIR_KEY
      AIRLINE	
      AROLL_LEV1
      AROLL_LEV2
      AROLL_LEV3
      AROLL_LEV4
      AROLL_LEV5
      AROLL_LEV6
      AROLL_LEV7
      AROLL_LEV8
      AROLL_LEV9
      AROLL_LEV10
      AROLL_LEV11
      AROLL_LEV12
      AROLL_LEV13
      AROLL_LEV14
      AROLL_DSC5
      BOOK_DT
      C_ITIN
      CG_CLT
      DISSAVINGS
      DOD_TYP2	
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EMAIL_ADR
      FARE_BAS	
      FARE_PAID
      HIGH_CAT
      INTL_DOM
      LEVEL1
      NEW_ADV_PURCH  
      NEW_SEG_MILES
      NET_TKT_CNT
      PASSNGR_NAME
      PNR_LOCATOR
      REFUSE_CODE
      REFUSAL_DESC	
      RTE_APT_CD	
      RTE_APT_NM	
      RTE_CTY_NM	
      SAVINGS	
      SEG_COUNT	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST
      SEG_NBR	
      SEG_STANDARD	
      STAY
      TKT_AMOUNT	
      TKT_SORT	
      TKT_TYPE	
      TRIP_LENGTH
      TRN_DATE
      USVISA
      VAL_AIRLINE
      VOID_DATE
      XARR_DT	
      XDPT_DT
      XFST_DPT
      XTRAN_DT
      DTSAVE
      TBASE
      TDISC
      TEXCH
      TFARE
      TLOW
      TMILE
      TPURCH
      TRFEX
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD  
RUN
FILE AIRHOLD3
SUM ODPT_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
AFTER MATCH HOLD AS AIRHOLD4 OLD-OR-NEW
END
-RUN





-IF '&&SETF.EVAL' EQ 'CGAIRFIL' THEN GOTO CONG;

-CONG
EX UDCONG
-RUN


-IF &&CGNOREC EQ 'Y' THEN GOTO NORECORDS;


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE FINALHLD
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-IF &&SETF EQ 'CGAIRFIL' GOTO CONGPRINT ELSE GOTO NOCONGPRINT;
-CONGPRINT
&&PRINT11
&&PRINT12
&&PRINT13
&&PRINT14
&&PRINT15
&&PRINT16
&&PRINT17
&&PRINT18
&&PRINT19
&&PRINT20
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
-NOCONGPRINT
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10

-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10


-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYD


ENDSTYLE

&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-NORECORDS
-SET &&RPTSUF = 'MSG';
-INCLUDE FDEFRPTS
-RUN
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADAIR
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT
