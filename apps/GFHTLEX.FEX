-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 7/24/14 - DEB - CREATED FOR GLOFO-R
-* 8/20/14 - DEB- UPDATED DUE TO BALANCING ISSUES
-*09/07/2017 - DLV - S-37268 - Added DEFINE NEW_PROP_CTY_CD to expand DST_APCX to A7
-*                             updated BLANK4 to A7

-SET &HDTDESC = IF &&DATETYPE EQ 'I' THEN 'INVOICE_DATE' ELSE 'CHKIN_DATE';
 
-SET &&HTLDATA = ' ';

-INCLUDE SETECHO

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-DEFAULT &&HTLDATA = 'Y';

DEFINE FILE &&EXTRACT
  BLANK3/A3 = '   ';
  BLANK_2/A2 = '  ';
  BLANK20/A20 = ' ';
  BLANK25/A25 = ' ';
  BLANKITIN/A67 = ' ';
  BLANK4/A7 = '    ';
  CHKIN_DT/MDYY = CHKIN_DATE;
  CHKOUT_DT/MDYY = CHKOUT_DATE;
  FLAG/A1 = 'H';
  IFLAG/A8 = IF DOD_TYPE EQ 'H' OR 'I' OR 'J' THEN 'ONLINE' ELSE 'OFFLINE';
 
  LEVEL_DESC/A60  = &&LDESC;
  NBR_DAYS/D12CS=NUM_DAYS;
  NBR_ROOMS/D12CS = NUM_ROOMS;
  NEW_TOTAL_AMT/D12.2CS = TOTAL_AMT;
  NNROOMS/D12CS = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  TKTN/A10 = IF TKT_NUM EQ '0000000000' THEN ' ' ELSE  TKT_NUM;    
  TKT_TYPE/A8 = ' ';

  TRAN_MY/MTYY = INVOICE_DATE;
  TRAN_TYPE/A13 = ' ';
  NAME/A30 = PROP_NAME;
  XPROP_CITY/A3 = EDIT(PROP_CITY_CD, '999');  
  PADV/P8 = 0;
  NEW_ROOM_RATE/D12.2CS = ROOM_RATE;
  NEW_PROP_CTY_CD/A7 = PROP_CITY_CD;
END
-RUN

TABLEF FILE &&EXTRACT
PRINT BLANK_2
  BLANK20 AS 'BLANK' 
  BLANK3
  BLANK25
  CLIENT_NAME AS 'BR_CL_IDX'
  BLANKITIN AS 'C_ITIN'
-*  PROP_CITY_CD AS 'DST_APCX'
  NEW_PROP_CTY_CD AS 'DST_APCX'
  PROP_CNTRY AS 'DCTY_CCOD'
  PROP_CITY AS 'DCTY_NAME'
  NEW_TOTAL_AMT  
  FLAG
  IFLAG
  INT_CODE
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  BLANK4 AS 'ORG_APCX'
  PADV
  PASSNGR_NAME                      
  PNR_LOCATOR  
  REFUSE_CODE
  REFUSAL_DESC
  CHKOUT_DT AS 'RTN_DT'
  INVOICE_DATE AS 'TKT_DATE'
  TKTN AS 'TKT_NUM'
  TKT_TYPE
  TRAN_MY
  TRAN_TYPE
  INVOICE_DATE AS 'TRN_DATE'
  NNROOMS  
  NAME
  CHKIN_DT AS 'XFST_DPT'
 
  NEW_ROOM_RATE AS 'RATE'
WHERE (&HDTDESC GE &&FROMDT.EVAL) AND (&HDTDESC LE &&TODT.EVAL) 
      
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
-*&&WHERE1
-*&&WHERE2
-*&&WHERE3
-*&&WHERE4
&&WHERE5
&&WHERE6
-*&&WHERE7
-*&&WHERE8
-*&&WHERE9
-* &&WHERE10

-INCLUDE RPTPARMS

ON TABLE HOLD AS GFHTLHLD
END
-RUN


-IF &RECORDS EQ 0 THEN GOTO NOHTL ELSE GOTO Continueh;
-NOHTL;
-SET &&HTLDATA = 'N';
-RUN     
-GOTO XXITH

-Continueh

TABLE FILE GFHTLHLD
 
SUM  
    NEW_TOTAL_AMT AS 'HRAMT'
    NNROOMS  AS 'HRDAYS'
BY LEVEL_DESC    
BY PASSNGR_NAME
BY PNR_LOCATOR
BY NAME
BY TKT_NUM
ON TABLE HOLD AS GFHTL1
END
-RUN
 
MATCH FILE GFHTLHLD
PRINT BLANK_2 
  BLANK   
  BLANK3
  BLANK25
  BR_CL_IDX  
  C_ITIN  
  
  DST_APCX
  DCTY_NAME
  DCTY_CCOD
  NEW_TOTAL_AMT 
  FLAG
     
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4    
  ORG_APCX
   
  PADV
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT  
  TKT_DATE  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
   
  TRN_DATE
  NNROOMS
  NAME
  
  XFST_DPT  
 
  RATE
BY LEVEL_DESC    
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TKT_NUM
ON TABLE HOLD
RUN
FILE GFHTL1
SUM HRAMT
    HRDAYS
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TKT_NUM
AFTER MATCH HOLD AS HTWO OLD-OR-NEW
END
-RUN

DEFINE FILE HTWO
BLANK4/A4 = '    ';
END
TABLE FILE HTWO
PRINT
  BLANK   
  BR_CL_IDX  
  C_ITIN  
  DST_APCX
  DCTY_NAME
  DCTY_CCOD
  
  NEW_TOTAL_AMT AS 'FARE_PAID' 
  DST_APCX
  FLAG
     
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL_DESC 
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4    
  BLANK25 AS 'OCTY_NM'
  BLANK25 AS 'OCNTRY_NAME'
  BLANK3 AS 'OGEO_ZONE'
  ORG_APCX 
   
  PADV
  PASSNGR_NAME  
  PNR_LOCATOR 
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT  
  BLANK_2 AS 'TKT_CL_CAT'
  TKT_DATE  
  TKT_NUM  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
   
  TRN_DATE
  HRDAYS/D8 AS 'TRP_LEN'
  NAME
  
  XFST_DPT 
   
  RATE
BY FLAG
ON TABLE HOLD AS HTLHOLD2
END
-RUN

JOIN HTLHOLD2.DCTY_CCOD IN HTLHOLD2 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J1
-RUN


TABLE FILE HTLHOLD2
PRINT
  BLANK   
  BR_CL_IDX  
  C_ITIN  
  DCTY_NAME
  COUNTRY_NAME AS 'DCNTRY_NAME'
  GEO_ZONE AS 'DGEO_ZONE'
  
  FARE_PAID
  DST_APCX    
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL_DESC 
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4  
  
  OCTY_NM
  OCNTRY_NAME
  OGEO_ZONE
  ORG_APCX     
  PASSNGR_NAME  
  PNR_LOCATOR  
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT 
  TKT_CL_CAT
  TKT_DATE  
  TKT_NUM  
  TKT_TYPE 
  TRAN_MY   
  TRAN_TYPE  
  TRN_DATE
  TRP_LEN
   
  NAME
  XFST_DPT  
  PADV
   
  RATE
BY FLAG
ON TABLE HOLD AS GFHTLFNL FORMAT FOCUS INDEX FLAG
END
-RUN

-XXITH
 

 
