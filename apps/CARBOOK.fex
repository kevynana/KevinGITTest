-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 1/19/05 - DEB - ADDED CODE FOR GLOBAL CURRENCY
-*11/27/06 - DEB ADDED IBOOK
-*1/28/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK
-*12/22/15 - DLV - S-13284   Updated to allow reports to sort/subtotal by id-levels

-INCLUDE SETECHO
SET ASNAMES = ON  
-SET HOLDATTR = ON;
-RUN

-SET &&IDLEVELBREAK = ''; 
-RUN

-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN

DEFINE FILE &&EXTRACT
BOOKINGS/D12 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
LEVEL_DESC1/A60 = &&LDESC;
IBOOK/A13 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'INTERNET' ELSE
              'NON-INTERNET'; 
-INCLUDE IDLEVDEFINE 
  
END
-RUN

TABLEF FILE &&EXTRACT
PRINT 
-*  BOOKINGS AS 'CBOOK'
-*  RENTAL_AMT AS 'CAMT'
  BOOKINGS
  CURR_DATE
  IBOOK
  RENTAL_AMT
  LEVEL_DESC
  RESV_BRANCH
  TKT_NUM	
  
 -INCLUDE  &CARDATES
-*WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL)
WHERE TKT_NUM EQ '0000000000'
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS CARHOLD
END
-RUN


TABLE FILE CARHOLD
PRINT BOOKINGS
  IBOOK
  RENTAL_AMT
  LEVEL_DESC
  RESV_BRANCH
  TKT_NUM
BY CURR_DATE
ON TABLE HOLD AS CRHOLD FORMAT FOCUS INDEX CURR_DATE
END
-RUN

-* Global Reporting JOIN
JOIN CRHOLD.CURR_DATE IN CRHOLD TO GLOBAL.DATE IN GLOBAL AS J1
END

DEFINE FILE CRHOLD

NAMEC/A30 = CNAME;
 -******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;

-* DEFINES ON PREVIOUS DEFINES
AMT_RENTALX/D20.6 = RENTAL_AMT * CURR1X;

END
 

TABLE FILE CRHOLD
PRINT AMT_RENTALX/D16.2CS AS 'GCAMT'
  BOOKINGS AS 'CBOOK'
  IBOOK
  CURR_DATE 
  RENTAL_AMT AS 'CAMT'
  LEVEL_DESC
  NAMEC
  RESV_BRANCH
  TKT_NUM
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS CHOLD
END
-RUN

TABLE FILE CHOLD
SUM CBOOK
    CAMT
    GCAMT/D16.2CS
    NAMEC
BY LEVEL_DESC
BY RESV_BRANCH
BY IBOOK
ON TABLE HOLD AS CARBK 
END
-RUN
