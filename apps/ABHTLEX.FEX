-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO
-* File BVHTLEX.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*8/11/16-JEM-S-21166-Created for new report abachlfl
 
-********************************************************************
 
 
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';
 
DEFINE FILE &&EXTRACT
  HIDATE/MDYY = CHKIN_DATE;
 
  LEVEL_DESC/A60  = &&LDESC;
  NBR_DAYS/D12 =  NUM_DAYS;
  NNROOMS/D12CS = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  HODATE/MDYY = CHKOUT_DATE;
  NEW_DAILY_AMT/D14.2CS = DAILY_RATE;
  NEW_TOTAL_AMT/P12.2CS = TOTAL_AMT;
 
  XPSNGR_NM/A15        =
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
RSTAT/A1 = EDIT(RESV_STATUS, '$9');
HRES_DSC/A10 = DECODE RSTAT (O 'OPEN' C 'CANCELLED' X 'CHANGED');
HFLAG/A1='H';
END
-RUN
 
TABLEF FILE &&EXTRACT
PRINT CHKIN_DATE
  CHAIN_NAME
  HIDATE
  HODATE
  HFLAG
  HTL_KEY
  INVOICE_DATE
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  NNROOMS
  PASSNGR_NAME
  PNR_LOCATOR
  PROP_NAME
  PROP_CITY
  PROP_PHONE
  PROP_ADDRESS
  PROP_STATE
  PROP_ZIP
  NEW_DAILY_AMT
  NEW_TOTAL_AMT
  HRES_DSC
  TKT_NUM
  XPSNGR_NM
-*WHERE INVOICE_DATE GE '&&FROMDT.EVAL' AND INVOICE_DATE LE '&&TODT.EVAL'
-INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
 
ON TABLE HOLD AS HTL_HOLD
END
-RUN
 
DEFINE FILE HTL_HOLD
HKEYR/A69=REVERSE(69, HTL_KEY, HKEYR);
HKEYR1/A68=EDIT(HKEYR, '$99999999999999999999999999999999999999999999999999999999999999999999');
HKEY1/A69=REVERSE(82, HKEYR1, HKEY1);
END
 
TABLE FILE HTL_HOLD
SUM CHKIN_DATE CHAIN_NAME HFLAG HIDATE HODATE INVOICE_DATE LEVEL_DESC NNROOMS PASSNGR_NAME PNR_LOCATOR PROP_NAME
    PROP_PHONE PROP_ADDRESS PROP_CITY PROP_STATE PROP_ZIP NEW_DAILY_AMT NEW_TOTAL_AMT HRES_DSC TKT_NUM
BY HKEY1
ON TABLE HOLD AS HTL_HOLD1
END
 
 
TABLE FILE HTL_HOLD1
SUM CHKIN_DATE CHAIN_NAME HFLAG HIDATE HODATE INVOICE_DATE LEVEL_DESC NNROOMS PASSNGR_NAME PNR_LOCATOR PROP_NAME
    PROP_PHONE PROP_ADDRESS PROP_CITY PROP_STATE PROP_ZIP NEW_DAILY_AMT NEW_TOTAL_AMT HRES_DSC TKT_NUM
BY PNR_LOCATOR
BY TKT_NUM
WHERE NEW_TOTAL_AMT NE 0 OR NNROOMS NE 0
ON TABLE HOLD AS HTL_HOLD2
END
 
DEFINE FILE HTL_HOLD2
HKEY/A20=PNR_LOCATOR||TKT_NUM;
END
TABLE FILE HTL_HOLD2
PRINT CHKIN_DATE CHAIN_NAME HFLAG HIDATE HODATE INVOICE_DATE LEVEL_DESC NNROOMS PASSNGR_NAME PNR_LOCATOR PROP_NAME
      PROP_PHONE PROP_ADDRESS PROP_CITY PROP_STATE PROP_ZIP NEW_DAILY_AMT NEW_TOTAL_AMT HRES_DSC TKT_NUM
COMPUTE CNTRA/D9=1;
COMPUTE CNTR2/D9=IF HKEY NE LAST HKEY THEN 1 ELSE LAST CNTR2 + 1;
BY PNR_LOCATOR
BY TKT_NUM
ON TABLE HOLD AS ABHTL1
END
 
-* HOTEL 1 FIELDS
TABLE FILE ABHTL1
PRINT CNTR2
    NEW_DAILY_AMT AS 'H1_DAMT'
    NEW_TOTAL_AMT AS 'H1_TAMT'
    NNROOMS AS 'H1NNROOMS'
    PROP_NAME AS 'H1_PNAME'
    CHAIN_NAME AS 'H1_CHN'
    PROP_PHONE AS 'H1_PHN'
    PROP_ADDRESS AS 'H1_ADDR'
    PROP_CITY AS 'H1_CITY'
    PROP_STATE AS 'H1_STATE'
    HIDATE AS 'H1_HIDATE'
    HODATE AS 'H1_HODATE'
    HRES_DSC AS 'H1RDESC'
    HFLAG AS 'HFLAG1'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 1
ON TABLE HOLD AS ABHTLH1
END
 
-* HOTEL 2 FIELDS
TABLE FILE ABHTL1
PRINT CNTR2
    NEW_DAILY_AMT AS 'H2_DAMT'
    NEW_TOTAL_AMT AS 'H2_TAMT'
    NNROOMS AS 'H2NNROOMS'
    PROP_NAME AS 'H2_PNAME'
    CHAIN_NAME AS 'H2_CHN'
    PROP_PHONE AS 'H2_PHN'
    PROP_ADDRESS AS 'H2_ADDR'
    PROP_CITY AS 'H2_CITY'
    PROP_STATE AS 'H2_STATE'
    HIDATE AS 'H2_HIDATE'
    HODATE AS 'H2_HODATE'
    HRES_DSC AS 'H2RDESC'
    HFLAG AS 'HFLAG2'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
BY TKT_NUM
WHERE CNTR2 EQ 2
ON TABLE HOLD AS ABHTLH2
END
 
-*HOTEL 3 FIELDS
TABLE FILE ABHTL1
PRINT CNTR2
    NEW_DAILY_AMT AS 'H3_DAMT'
    NEW_TOTAL_AMT AS 'H3_TAMT'
    NNROOMS AS 'H3NNROOMS'
    PROP_NAME AS 'H3_PNAME'
    CHAIN_NAME AS 'H3_CHN'
    PROP_PHONE AS 'H3_PHN'
    PROP_ADDRESS AS 'H3_ADDR'
    PROP_CITY AS 'H3_CITY'
    PROP_STATE AS 'H3_STATE'
    HIDATE AS 'H3_HIDATE'
    HODATE AS 'H3_HODATE'
    HRES_DSC AS 'H3RDESC'
    HFLAG AS 'HFLAG3'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 3
ON TABLE HOLD AS ABHTLH3
END
 
-*HOTEL 4 FIELDS
TABLE FILE ABHTL1
PRINT CNTR2
    NEW_DAILY_AMT AS 'H4_DAMT'
    NEW_TOTAL_AMT AS 'H4_TAMT'
    NNROOMS AS 'H4NNROOMS'
    PROP_NAME AS 'H4_PNAME'
    CHAIN_NAME AS 'H4_CHN'
    PROP_PHONE AS 'H4_PHN'
    PROP_ADDRESS AS 'H4_ADDR'
    PROP_CITY AS 'H4_CITY'
    PROP_STATE AS 'H4_STATE'
    HIDATE AS 'H4_HIDATE'
    HODATE AS 'H4_HODATE'
    HRES_DSC AS 'H4RDESC'
    HFLAG AS 'HFLAG4'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 4
ON TABLE HOLD AS ABHTLH4
END
 
-*HOTEL 5 FIELDS
TABLE FILE ABHTL1
PRINT CNTR2
    NEW_DAILY_AMT AS 'H5_DAMT'
    NEW_TOTAL_AMT AS 'H5_TAMT'
    NNROOMS AS 'H5NNROOMS'
    PROP_NAME AS 'H5_PNAME'
    CHAIN_NAME AS 'H5_CHN'
    PROP_PHONE AS 'H5_PHN'
    PROP_ADDRESS AS 'H5_ADDR'
    PROP_CITY AS 'H5_CITY'
    PROP_STATE AS 'H5_STATE'
    HIDATE AS 'H5_HIDATE'
    HODATE AS 'H5_HODATE'
    HRES_DSC AS 'H5RDESC'
    HFLAG AS 'HFLAG5'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 5
ON TABLE HOLD AS ABHTLH5
END
 
 
-* MATCH FILES
MATCH FILE ABHTLH1
PRINT H1_DAMT H1_TAMT H1NNROOMS H1_PNAME H1_CHN H1_PHN H1_ADDR H1_CITY H1_STATE H1_HIDATE H1_HODATE H1RDESC HFLAG1
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABHTLH2
PRINT H2_DAMT H2_TAMT H2NNROOMS H2_PNAME H2_CHN H2_PHN H2_ADDR H2_CITY H2_STATE H2_HIDATE H2_HODATE H2RDESC HFLAG2
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABHTLH12 OLD-OR-NEW
END
 
MATCH FILE ABHTLH12
PRINT H1_DAMT H1_TAMT H1NNROOMS H1_PNAME H1_CHN H1_PHN H1_ADDR H1_CITY H1_STATE H1_HIDATE H1_HODATE H1RDESC HFLAG1
      H2_DAMT H2_TAMT H2NNROOMS H2_PNAME H2_CHN H2_PHN H2_ADDR H2_CITY H2_STATE H2_HIDATE H2_HODATE H2RDESC HFLAG2
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABHTLH3
PRINT H3_DAMT H3_TAMT H3NNROOMS H3_PNAME H3_CHN H3_PHN H3_ADDR H3_CITY H3_STATE H3_HIDATE H3_HODATE H3RDESC HFLAG3
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABHTLH123 OLD-OR-NEW
END
 
MATCH FILE ABHTLH123
PRINT H1_DAMT H1_TAMT H1NNROOMS H1_PNAME H1_CHN H1_PHN H1_ADDR H1_CITY H1_STATE H1_HIDATE H1_HODATE H1RDESC HFLAG1
      H2_DAMT H2_TAMT H2NNROOMS H2_PNAME H2_CHN H2_PHN H2_ADDR H2_CITY H2_STATE H2_HIDATE H2_HODATE H2RDESC HFLAG2
      H3_DAMT H3_TAMT H3NNROOMS H3_PNAME H3_CHN H3_PHN H3_ADDR H3_CITY H3_STATE H3_HIDATE H3_HODATE H3RDESC HFLAG3
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABHTLH4
PRINT H4_DAMT H4_TAMT H4NNROOMS H4_PNAME H4_CHN H4_PHN H4_ADDR H4_CITY H4_STATE H4_HIDATE H4_HODATE H4RDESC HFLAG4
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABHTLH1234 OLD-OR-NEW
END
 
MATCH FILE ABHTLH1234
PRINT H1_DAMT H1_TAMT H1NNROOMS H1_PNAME H1_CHN H1_PHN H1_ADDR H1_CITY H1_STATE H1_HIDATE H1_HODATE H1RDESC HFLAG1
      H2_DAMT H2_TAMT H2NNROOMS H2_PNAME H2_CHN H2_PHN H2_ADDR H2_CITY H2_STATE H2_HIDATE H2_HODATE H2RDESC HFLAG2
      H3_DAMT H3_TAMT H3NNROOMS H3_PNAME H3_CHN H3_PHN H3_ADDR H3_CITY H3_STATE H3_HIDATE H3_HODATE H3RDESC HFLAG3
      H4_DAMT H4_TAMT H4NNROOMS H4_PNAME H4_CHN H4_PHN H4_ADDR H4_CITY H4_STATE H4_HIDATE H4_HODATE H4RDESC HFLAG4
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABHTLH5
PRINT H5_DAMT H5_TAMT H5NNROOMS H5_PNAME H5_CHN H5_PHN H5_ADDR H5_CITY H5_STATE H5_HIDATE H5_HODATE H5RDESC HFLAG5
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABHTLH12345 OLD-OR-NEW
END
 
 
TABLE FILE ABHTLH12345
PRINT H1_DAMT H1_TAMT H1NNROOMS H1_PNAME H1_CHN H1_PHN H1_ADDR H1_CITY H1_STATE H1_HIDATE H1_HODATE H1RDESC HFLAG1
      H2_DAMT H2_TAMT H2NNROOMS H2_PNAME H2_CHN H2_PHN H2_ADDR H2_CITY H2_STATE H2_HIDATE H2_HODATE H2RDESC HFLAG2
      H3_DAMT H3_TAMT H3NNROOMS H3_PNAME H3_CHN H3_PHN H3_ADDR H3_CITY H3_STATE H3_HIDATE H3_HODATE H3RDESC HFLAG3
      H4_DAMT H4_TAMT H4NNROOMS H4_PNAME H4_CHN H4_PHN H4_ADDR H4_CITY H4_STATE H4_HIDATE H4_HODATE H4RDESC HFLAG4
      H5_DAMT H5_TAMT H5NNROOMS H5_PNAME H5_CHN H5_PHN H5_ADDR H5_CITY H5_STATE H5_HIDATE H5_HODATE H5RDESC HFLAG5
 
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD AS ABHTL
END
-RUN
