-* 07/27/15 - DEB - S-10299 COMMENTED OUT SET &ECHO=ALL
-*getSelectedCountries.fex
-*-SET &ECHO=ALL;
-SET &SPC='&' | 'nbsp;';
-DEFAULT &nbrSelected = 0;
-DEFAULT &InclGeo = 1;

TABLE FILE COUNTRY
PRINT GEO_ZONE COUNTRY_CODE
BY COUNTRY_NAME

-IF &InclGeo NE 1 THEN GOTO EXLUDEGO;
-*INCLUDE SELECTED
WHERE GEO_ZONE IN &1.EVAL
-GOTO DONEGEOTEST;

-EXLUDEGO
WHERE NOT GEO_ZONE IN &1.EVAL

-DONEGEOTEST
ON TABLE HOLD
END
 
DEFINE FILE HOLD
CNT/I5 = CNT + 1;
IMD/I5 = IMOD(CNT, 2, IMD);
COUNTRY/A40 = COUNTRY_NAME || ' (' | COUNTRY_CODE | ' - ' | GEO_ZONE | ')';
OPTS/A100=IF IMD NE 0 THEN '<option value="' || COUNTRY_CODE || '">' || COUNTRY 
  ELSE '<option style="background-color:#dcdcdc;" value="' || COUNTRY_CODE || '">' || COUNTRY ;
END

TABLE FILE HOLD
PRINT OPTS
ON TABLE SET HOLDLIST PRINTONLY
ON TABLE HOLD AS HLDCNTRY
END
-RUN


-HTMLFORM BEGIN
<html>
<head>Please Select Countries
<script>
function moveItems() {
 from=document.COUNTRY.COUNTRY;
 var nbr = &nbrSelected;
//var nbr = 0;  
// var startPos = from.options.selectedIndex;
 len = from.length;
 for (i=0; i<len;i++) {
     if (from.options[i].selected) { nbr++; 
         if (nbr > 25) { alert("A maximum of 25 items can be selected.\nOnly the first 25 will be selected."); break;}
         else {txt = from.options[i].text; window.opener.pasteCountry(txt);  }
     }
 }
 window.close();
}
 
</script>
</head>
<body >
<form name="COUNTRY">
<table border=0>
<tr>
<td>
<select name="COUNTRY" size="8" multiple>
!IBI.FIL.HLDCNTRY;
</select>
</td>
</tr>
<tr>
<td>&SPC</td>
</tr>
<tr>
<td>
<input type="button" value="  OK  " onclick="moveItems();">&SPC &SPC
<input type="button" value="Close" onclick="window.close();">
</td>
</tr>
</table>
</form>
</body>
</html>
-HTMLFORM END
