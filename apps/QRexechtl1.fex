-*****************THEQ HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File EXECHTL1.FEX
-*************************************************************************
-*DATE          NAME            DESCRIPTION
-* 3/07/01   TANDT-SS           CHANGE ALL NUMERIC FORMATS FROM P (PACKED) TO
-*                              D (FLOATING-POINT DOUBLE PRECEQION) TO PROVIDE
-*                              CONSEQTENCY IN ROUNDING AND PERCENTAGES.
-* 4/30/01    TANDT-SS          ADDED CODE TO CALCULATIONS TO KEEP NEGATIVE 
-*                              NUMBER IN PLACE FOR BACK-OUT OF CANCELLATIONS
-*                              AND DUPLICATES
-* 7/27/01    TANDT-SS          CHANGED TO LOOK AT CITY.INTL_DOM INSTEAD OF
-*                              COUNTRY CODE
-* 5/14/03    STEVE             CHANGED INTL_DOM DEFINE 
-*                              IF (CITY.INTL_DOM EQ 'D') THEN 'D' ELSE 'I'; 
-* 9/2/2015   DEB               S-11293 - ADDED TAT SAVINGS
-* 10/10/16 - DLV - S-25523 - Changed extract to use &&PYTDDATE instead of &&PYTODT to compare same number of quarters
-* 11/21/2016 - DLV - S-27466 - No changes testing hold file data only
-*************************************************************************
-INCLUDE SETECHO

DEFINE FILE &&EXTRACT
-*INTL_DOM/A1 =IF (CITY.INTL_DOM EQ 'I') THEN 'I' ELSE 
-*             IF (CITY.INTL_DOM EQ 'D') THEN 'D' ELSE ' ';
INTL_DOM/A1 =IF (CITY.INTL_DOM EQ 'I') THEN 'I' ELSE 'D';
-* INTL_DOM/A1 =IF (CITY.COUNTRY_CODE EQ 'US' OR ' ') THEN 'D' ELSE 'I';
 CM/A1 = IF INVOICE_DATE GE '&&CMFMDT.EVAL' AND 
INVOICE_DATE LE '&&CMTODT.EVAL' THEN 'Y' ELSE 'N';
 CY/A1 = IF INVOICE_DATE GE '&&CYFMDT.EVAL' AND 
INVOICE_DATE LE '&&CYTODT.EVAL' THEN 'Y' ELSE 'N';
 PM/A1 = IF INVOICE_DATE GE '&&PMFMDT.EVAL' AND 
INVOICE_DATE LE '&&PMTODT.EVAL' THEN 'Y' ELSE 'N';
 PY/A1 = IF INVOICE_DATE GE '&&PYFMDT.EVAL' AND 
INVOICE_DATE LE '&&PYTODT.EVAL' THEN 'Y' ELSE 'N';
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/D12 = IF (NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)
              THEN ((NBR_DAYS*NUM_ROOMS)*(-1))
              ELSE NBR_DAYS*NUM_ROOMS;


-*DOMESTIC PERIOD
-* CURRENT HOTEL AMOUNT DOMESTIC CALCULATION
      CDM1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS DOMESTIC CALCULATION
      CDM1HTL_DAY/D12 = IF (INTL_DOM EQ 'D') AND (CM EQ 'Y') THEN NNROOMS ELSE 0;
                        

-* CURRENT HOTEL ROOMS DOMESTIC CALCULATION
      CDM1HTL_RMS/D12 = IF ((INTL_DOM EQ 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT DOMESTIC ROOM RATE
      CDM1HTL_RR/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;

-*INT'L PERIOD
-* CURRENT HOTEL AMOUNT INT'L CALCULATION
      CIM1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS INT'L CALCULATION
      CIM1HTL_DAY/D12 = IF (INTL_DOM EQ 'I') AND (CM EQ 'Y') THEN NNROOMS ELSE 0;
                      

-* CURRENT HOTEL ROOMS INT'L CALCULATION
      CIM1HTL_RMS/D12 = IF ((INTL_DOM EQ 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT INTERNATIONAL ROOM RATE
      CIM1HTL_RR/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;
                                            
-*DOMESTIC PERIOD
-* PRIOR HOTEL AMOUNT DOMESTIC CALCULATION
      PDM1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;
-* PRIOR HOTEL DAYS DOMESTIC CALCULATION
      PDM1HTL_DAY/D12 = IF (INTL_DOM EQ 'D') AND (PM EQ 'Y') THEN NNROOMS ELSE 0;
                      

-* PRIOR HOTEL ROOMS DOMESTIC CALCULATION
      PDM1HTL_RMS/D12 = IF ((INTL_DOM EQ 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR DOMESTIC ROOM RATE
      PDM1HTL_RR/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;
                      
-*INT'L PERIOD
-* PRIOR HOTEL AMOUNT INT'L CALCULATION
      PIM1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* PRIOR HOTEL DAYS INT'L CALCULATION
      PIM1HTL_DAY/D12 = IF (INTL_DOM EQ 'I') AND (PM EQ 'Y') THEN NNROOMS ELSE 0;
                      

-* PRIOR HOTEL ROOMS INT'L CALCULATION
      PIM1HTL_RMS/D12 = IF ((INTL_DOM EQ 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR INTERNATIONAL ROOM RATE
      PIM1HTL_RR/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;

-*DOMESTIC YTD 
-* CURRENT HOTEL AMOUNT DOMESTIC CALCULATION
      CDY1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS DOMESTIC CALCULATION
      CDY1HTL_DAY/D12 = IF (INTL_DOM EQ 'D') AND (CY EQ 'Y') THEN NNROOMS ELSE 0;
                      

-* CURRENT HOTEL ROOMS DOMESTIC CALCULATION
      CDY1HTL_RMS/D12 = IF ((INTL_DOM EQ 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT DOMESTIC ROOM RATE
      CDY1HTL_RR/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;
                      
-*INT'L YTD
-* CURRENT HOTEL AMOUNT INT'L CALCULATION
      CIY1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS INT'L CALCULATION
      CIY1HTL_DAY/D12 = IF (INTL_DOM EQ 'I') AND (CY EQ 'Y') THEN NNROOMS ELSE 0;
                      
-* CURRENT HOTEL ROOMS INT'L CALCULATION
      CIY1HTL_RMS/D12 = IF ((INTL_DOM EQ 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT DOMESTIC ROOM RATE
      CIY1HTL_RR/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;
-*DOMESTIC YTD
-* PRIOR HOTEL AMOUNT DOMESTIC CALCULATION
      PDY1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;
-* PRIOR HOTEL DAYS DOMESTIC CALCULATION
      PDY1HTL_DAY/D12 = IF (INTL_DOM EQ 'D') AND (PY EQ 'Y') THEN NNROOMS ELSE 0;
                      
-* PRIOR HOTEL ROOMS DOMESTIC CALCULATION
      PDY1HTL_RMS/D12 = IF ((INTL_DOM EQ 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR DOMESTIC ROOM RATE
      PDY1HTL_RR/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;
-*INT'L YTD
-* PRIOR HOTEL AMOUNT INT'L CALCULATION
      PIY1HTL_AMT/D12.2 = IF ((INTL_DOM EQ 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* PRIOR HOTEL DAYS INT'L CALCULATION
      PIY1HTL_DAY/D12 = IF (INTL_DOM EQ 'I') AND (PY EQ 'Y') THEN NNROOMS ELSE 0;
                      

-* PRIOR HOTEL ROOMS INT'L CALCULATION
      PIY1HTL_RMS/D12 = IF ((INTL_DOM EQ 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR INTL ROOM RATE
      PIY1HTL_RR/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.ROOM_RATE
                      ELSE 0;
END
-RUN

TABLE FILE &&EXTRACT
SUM
CDM1HTL_AMT/D10 CDM1HTL_DAY/D10 CDM1HTL_RMS/D10 CDM1HTL_RR/D10
CIM1HTL_AMT/D10 CIM1HTL_DAY/D10 CIM1HTL_RMS/D10 CIM1HTL_RR/D10
PDM1HTL_AMT/D10 PDM1HTL_DAY/D10 PDM1HTL_RMS/D10 PDM1HTL_RR/D10
PIM1HTL_AMT/D10 PIM1HTL_DAY/D10 PIM1HTL_RMS/D10 PIM1HTL_RR/D10
CDY1HTL_AMT/D10 CDY1HTL_DAY/D10 CDY1HTL_RMS/D10 CDY1HTL_RR/D10
CIY1HTL_AMT/D10 CIY1HTL_DAY/D10 CIY1HTL_RMS/D10 CIY1HTL_RR/D10
PDY1HTL_AMT/D10 PDY1HTL_DAY/D10 PDY1HTL_RMS/D10 PDY1HTL_RR/D10
PIY1HTL_AMT/D10 PIY1HTL_DAY/D10 PIY1HTL_RMS/D10 PIY1HTL_RR/D10
  COMPUTE 
CDM1AVG_RATE/D10=IF CDM1HTL_AMT LT 0 AND CDM1HTL_DAY LT 0
                 THEN ((CDM1HTL_AMT/CDM1HTL_DAY) * (-1)) ELSE
                 IF ((CDM1HTL_DAY LT 1) AND (CDM1HTL_DAY GT (-1))) THEN 0 ELSE
                    (CDM1HTL_AMT/CDM1HTL_DAY);
CIM1AVG_RATE/D10=IF CIM1HTL_AMT LT 0 AND CIM1HTL_DAY LT 0
                 THEN ((CIM1HTL_AMT/CIM1HTL_DAY) * (-1)) ELSE
                 IF ((CIM1HTL_DAY LT 1) AND (CIM1HTL_DAY GT (-1))) THEN 0 ELSE
                    (CIM1HTL_AMT/CIM1HTL_DAY);
PDM1AVG_RATE/D10=IF PDM1HTL_AMT LT 0 AND PDM1HTL_DAY LT 0
                 THEN ((PDM1HTL_AMT/PDM1HTL_DAY) * (-1)) ELSE
                 IF ((PDM1HTL_DAY LT 1) AND (PDM1HTL_DAY GT (-1))) THEN 0 ELSE
                    (PDM1HTL_AMT/PDM1HTL_DAY);
PIM1AVG_RATE/D10=IF PIM1HTL_AMT LT 0 AND PIM1HTL_DAY LT 0
                 THEN ((PIM1HTL_AMT/PIM1HTL_DAY) * (-1)) ELSE
                 IF ((PIM1HTL_DAY LT 1) AND (PIM1HTL_DAY GT (-1))) THEN 0 ELSE
                    (PIM1HTL_AMT/PIM1HTL_DAY);
CDY1AVG_RATE/D10=IF CDY1HTL_AMT LT 0 AND CDY1HTL_DAY LT 0
                 THEN ((CDY1HTL_AMT/CDY1HTL_DAY) * (-1)) ELSE
                 IF ((CDY1HTL_DAY LT 1) AND (CDY1HTL_DAY GT (-1))) THEN 0 ELSE
                    (CDY1HTL_AMT/CDY1HTL_DAY);
CIY1AVG_RATE/D10=IF CIY1HTL_AMT LT 0 AND CIY1HTL_DAY LT 0
                 THEN ((CIY1HTL_AMT/CIY1HTL_DAY) * (-1)) ELSE
                 IF ((CIY1HTL_DAY LT 1) AND (CIY1HTL_DAY GT (-1))) THEN 0 ELSE
                    (CIY1HTL_AMT/CIY1HTL_DAY);
PDY1AVG_RATE/D10=IF PDY1HTL_AMT LT 0 AND PDY1HTL_DAY LT 0
                 THEN ((PDY1HTL_AMT/PDY1HTL_DAY) * (-1)) ELSE
                 IF ((PDY1HTL_DAY LT 1) AND (PDY1HTL_DAY GT (-1))) THEN 0 ELSE
                    (PDY1HTL_AMT/PDY1HTL_DAY);
PIY1AVG_RATE/D10=IF PIY1HTL_AMT LT 0 AND PIY1HTL_DAY LT 0
                 THEN ((PIY1HTL_AMT/PIY1HTL_DAY) * (-1)) ELSE
                 IF ((PIY1HTL_DAY LT 1) AND (PIY1HTL_DAY GT (-1))) THEN 0 ELSE
                    (PIY1HTL_AMT/PIY1HTL_DAY);
CDM1T_RR/D10 = IF (CDM1HTL_DAY LT 0) AND (CDM1HTL_RR LT 0) THEN ((CDM1HTL_DAY * CDM1HTL_RR)*(-1))
                     ELSE CDM1HTL_DAY * CDM1HTL_RR;                  
                   
CIM1T_RR/D10 = IF (CIM1HTL_DAY LT 0) AND (CIM1HTL_RR LT 0) THEN ((CIM1HTL_DAY * CIM1HTL_RR)*(-1))
                     ELSE CIM1HTL_DAY * CIM1HTL_RR;                  
                   
PDM1T_RR/D10 = IF (PDM1HTL_DAY LT 0) AND (PDM1HTL_RR LT 0) THEN ((PDM1HTL_DAY * PDM1HTL_RR)*(-1))
                     ELSE PDM1HTL_DAY * PDM1HTL_RR;                  
                   
PIM1T_RR/D10 = IF (PIM1HTL_DAY LT 0) AND (PIM1HTL_RR LT 0) THEN ((PIM1HTL_DAY * PIM1HTL_RR)*(-1))
                     ELSE PIM1HTL_DAY * PIM1HTL_RR;                       
                   
CDY1T_RR/D10 = IF (CDY1HTL_DAY LT 0) AND (CDY1HTL_RR LT 0) THEN ((CDY1HTL_DAY * CDY1HTL_RR)*(-1))
                     ELSE CDY1HTL_DAY * CDY1HTL_RR;                  
                   
CIY1T_RR/D10 = IF (CIY1HTL_DAY LT 0) AND (CIY1HTL_RR LT 0) THEN ((CIY1HTL_DAY * CIY1HTL_RR)*(-1))
                     ELSE CIY1HTL_DAY * CIY1HTL_RR;                  
                   
PDY1T_RR/D10 = IF (PDY1HTL_DAY LT 0) AND (PDY1HTL_RR LT 0) THEN ((PDY1HTL_DAY * PDY1HTL_RR)*(-1))
                     ELSE PDM1HTL_DAY * PDM1HTL_RR;                  
                   
PIY1T_RR/D10 = IF (PIY1HTL_DAY LT 0) AND (PIY1HTL_RR LT 0) THEN ((PIY1HTL_DAY * PIY1HTL_RR)*(-1))
                     ELSE PIY1HTL_DAY * PIY1HTL_RR;   
FLAG/A1 = 'H';
WHERE (INVOICE_DATE GE '&&CYFMDT.EVAL') AND (INVOICE_DATE LE '&&CYTODT.EVAL') OR
      (INVOICE_DATE GE '&&PYFMDT.EVAL') AND (INVOICE_DATE LE '&&PYTODT.EVAL') 
-*       (INVOICE_DATE GE '&&CMFMDT.EVAL') AND (INVOICE_DATE LE '&&CMTODT.EVAL') 
-*      (INVOICE_DATE GE '&&PMFMDT.EVAL') AND (INVOICE_DATE LE '&&PMTODT.EVAL') 

-INCLUDE RPTPARMS

ON TABLE HOLD AS HOLD3
END
-RUN

TABLEF FILE HOLD3
PRINT
CDM1HTL_AMT CDM1HTL_DAY CDM1HTL_RMS
CIM1HTL_AMT CIM1HTL_DAY CIM1HTL_RMS
PDM1HTL_AMT PDM1HTL_DAY PDM1HTL_RMS
PIM1HTL_AMT PIM1HTL_DAY PIM1HTL_RMS
CDY1HTL_AMT CDY1HTL_DAY CDY1HTL_RMS
CIY1HTL_AMT CIY1HTL_DAY CIY1HTL_RMS
PDY1HTL_AMT PDY1HTL_DAY PDY1HTL_RMS
PIY1HTL_AMT PIY1HTL_DAY PIY1HTL_RMS
CDM1AVG_RATE
CIM1AVG_RATE
PDM1AVG_RATE
PIM1AVG_RATE
CDY1AVG_RATE
CIY1AVG_RATE
PDY1AVG_RATE
PIY1AVG_RATE
CDM1T_RR
CIM1T_RR
PDM1T_RR
PDM1T_RR
CDY1T_RR
CIY1T_RR
PDY1T_RR
PIY1T_RR
FLAG
ON TABLE HOLD AS HTLSUMLD2
END
-*-EXIT

DEFINE FILE &&EXTRACT ADD
  NBR_DAYS/D12 =  NUM_DAYS; 
  NNROOMS/D12 = IF (NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)
                THEN ((NBR_DAYS*NUM_ROOMS)*(-1))
                ELSE NBR_DAYS*NUM_ROOMS;
  NEW_ROOM_RATE/D12.2C = ROOM_RATE;

  TOTAL_RR/D12.2C = IF (NNROOMS LT 0) AND (NEW_ROOM_RATE LT 0) THEN ((NNROOMS * NEW_ROOM_RATE)*(-1))
                     ELSE NNROOMS * NEW_ROOM_RATE;                  
  NEW_ROOM_RATE/D12.2C = ROOM_RATE;
CMDDAY/D10 = IF CM EQ 'Y' AND INTL_DOM EQ 'D' THEN NNROOMS ELSE 0;
CMIDAY/D10 = IF CM EQ 'Y' AND INTL_DOM EQ 'I' THEN NNROOMS ELSE 0;
CYDDAY/D10 = IF CY EQ 'Y' AND INTL_DOM EQ 'D' THEN NNROOMS ELSE 0;
CYIDAY/D10 = IF CY EQ 'Y' AND INTL_DOM EQ 'I' THEN NNROOMS ELSE 0;
PMDDAY/D10 = IF PM EQ 'Y' AND INTL_DOM EQ 'D' THEN NNROOMS ELSE 0;
PMIDAY/D10 = IF PM EQ 'Y' AND INTL_DOM EQ 'I' THEN NNROOMS ELSE 0;
PYDDAY/D10 = IF PY EQ 'Y' AND INTL_DOM EQ 'D' THEN NNROOMS ELSE 0;
PYIDAY/D10 = IF PY EQ 'Y' AND INTL_DOM EQ 'I' THEN NNROOMS ELSE 0;
CMDTOT_RR/D12.2 = IF CM EQ 'Y' AND INTL_DOM EQ 'D' THEN TOTAL_RR ELSE 0;
CMITOT_RR/D12.2 = IF CM EQ 'Y' AND INTL_DOM EQ 'I' THEN TOTAL_RR ELSE 0;
CYDTOT_RR/D12.2 = IF CY EQ 'Y' AND INTL_DOM EQ 'D' THEN TOTAL_RR ELSE 0;
CYITOT_RR/D12.2 = IF CY EQ 'Y' AND INTL_DOM EQ 'I' THEN TOTAL_RR ELSE 0;
PMDTOT_RR/D12.2 = IF PM EQ 'Y' AND INTL_DOM EQ 'D' THEN TOTAL_RR ELSE 0;
PMITOT_RR/D12.2 = IF PM EQ 'Y' AND INTL_DOM EQ 'I' THEN TOTAL_RR ELSE 0;
PYDTOT_RR/D12.2 = IF PY EQ 'Y' AND INTL_DOM EQ 'D' THEN TOTAL_RR ELSE 0;
PYITOT_RR/D12.2 = IF PY EQ 'Y' AND INTL_DOM EQ 'I' THEN TOTAL_RR ELSE 0;
END

TABLE FILE &&EXTRACT
SUM CMDDAY
    CMIDAY
    CYDDAY
    CYIDAY
    PMDDAY
    PMIDAY
    PYDDAY
    PYIDAY
    CMDTOT_RR
    CMITOT_RR
    CYDTOT_RR
    CYITOT_RR
    PMDTOT_RR
    PMITOT_RR
    PYDTOT_RR
    PYITOT_RR
WHERE (INVOICE_DATE GE '&&CYFMDT.EVAL') AND (INVOICE_DATE LE '&&CYTODT.EVAL') OR
      (INVOICE_DATE GE '&&PYFMDT.EVAL') AND (INVOICE_DATE LE '&&PYTODT.EVAL')  
BY HTL_KEY 
-INCLUDE RPTPARMS
ON TABLE HOLD AS TSHTLHLD2
END
-RUN


TABLE FILE ROLLUP
PRINT COMP
IF ROLLUP EQ '&&ROLLUP.EVAL'
ON TABLE HOLD AS COMPANY
END
-RUN

-READ COMPANY &&COMP.A8
-SET &&COMPNY = &&COMP.EVAL;
-CLOSE COMPANY

-SET &&COMPUH = 'D:\TNT\TTRACKER\DATA\UH'|| '&&COMPNY.EVAL' ||'.FOC';
-RUN



 

USE CLEAR *
USE 
&&COMPUH AS UDHTL
D:\TNT\TTRACKER\SYSTEM\DATA\UDID_DSC.FOC AS UDID_DSC
END


DEFINE FILE UDHTL
TAT_RT/D12.2CS = NUD_DATA;
END
TABLE FILE UDHTL
PRINT TAT_RT
BY HTL_KEY
IF UDID EQ TAT
ON TABLE HOLD AS UDIDHOLD2 
END
-RUN


MATCH FILE TSHTLHLD2
PRINT CMDDAY
    CMIDAY
    CYDDAY
    CYIDAY
    PMDDAY
    PMIDAY
    PYDDAY
    PYIDAY
    CMDTOT_RR
    CMITOT_RR
    CYDTOT_RR
    CYITOT_RR
    PMDTOT_RR
    PMITOT_RR
    PYDTOT_RR
    PYITOT_RR
BY HTL_KEY
ON TABLE HOLD
RUN
FILE UDIDHOLD2
PRINT TAT_RT
BY HTL_KEY
AFTER MATCH HOLD AS XHONE OLD-OR-NEW
END
-RUN



DEFINE FILE XHONE
FLAG/A1 = 'H';

CDMTAT_RAT/D12.2C = IF (CMDDAY LT 0) AND (TAT_RT LT 0) THEN ((CMDDAY * TAT_RT)*(-1)) ELSE CMDDAY * TAT_RT;  
CIMTAT_RAT/D12.2C = IF (CMIDAY LT 0) AND (TAT_RT LT 0) THEN ((CMIDAY * TAT_RT)*(-1)) ELSE CMIDAY * TAT_RT;  
CDYTAT_RAT/D12.2C = IF (CYDDAY LT 0) AND (TAT_RT LT 0) THEN ((CYDDAY * TAT_RT)*(-1)) ELSE CYDDAY * TAT_RT;  
CIYTAT_RAT/D12.2C = IF (CYIDAY LT 0) AND (TAT_RT LT 0) THEN ((CYIDAY * TAT_RT)*(-1)) ELSE CYIDAY * TAT_RT;  
PDMTAT_RAT/D12.2C = IF (PMDDAY LT 0) AND (TAT_RT LT 0) THEN ((PMDDAY * TAT_RT)*(-1)) ELSE PMDDAY * TAT_RT;  
PIMTAT_RAT/D12.2C = IF (PMIDAY LT 0) AND (TAT_RT LT 0) THEN ((PMIDAY * TAT_RT)*(-1)) ELSE PMIDAY * TAT_RT;  
PDYTAT_RAT/D12.2C = IF (PYDDAY LT 0) AND (TAT_RT LT 0) THEN ((PYDDAY * TAT_RT)*(-1)) ELSE PYDDAY * TAT_RT;  
PIYTAT_RAT/D12.2C = IF (PYIDAY LT 0) AND (TAT_RT LT 0) THEN ((PYIDAY * TAT_RT)*(-1)) ELSE PYIDAY * TAT_RT;  

CDMTAT_SAV/D12.2CS = IF CMDTOT_RR EQ 0 THEN 0 ELSE
                  IF CDMTAT_RAT EQ 0 THEN 0 ELSE CDMTAT_RAT - CMDTOT_RR;
CIMTAT_SAV/D12.2CS = IF CMITOT_RR EQ 0 THEN 0 ELSE
                  IF CIMTAT_RAT EQ 0 THEN 0 ELSE CIMTAT_RAT - CMITOT_RR;
CDYTAT_SAV/D12.2CS = IF CYDTOT_RR EQ 0 THEN 0 ELSE
                  IF CDYTAT_RAT EQ 0 THEN 0 ELSE CDYTAT_RAT - CYDTOT_RR;
CIYTAT_SAV/D12.2CS = IF CYITOT_RR EQ 0 THEN 0 ELSE
                  IF CIYTAT_RAT EQ 0 THEN 0 ELSE CIYTAT_RAT - CYITOT_RR;
PDMTAT_SAV/D12.2CS = IF PMDTOT_RR EQ 0 THEN 0 ELSE
                  IF PDMTAT_RAT EQ 0 THEN 0 ELSE PDMTAT_RAT - PMDTOT_RR;

PIMTAT_SAV/D12.2CS = IF PMITOT_RR EQ 0 THEN 0 ELSE
                  IF PIMTAT_RAT EQ 0 THEN 0 ELSE PIMTAT_RAT - PMITOT_RR;
PDYTAT_SAV/D12.2CS = IF PYDTOT_RR EQ 0 THEN 0 ELSE
                  IF PDYTAT_RAT EQ 0 THEN 0 ELSE PDYTAT_RAT - PYDTOT_RR;
PIYTAT_SAV/D12.2CS = IF PYITOT_RR EQ 0 THEN 0 ELSE
                  IF PIYTAT_RAT EQ 0 THEN 0 ELSE PIYTAT_RAT - PYITOT_RR;
END
TABLE FILE XHONE 
SUM   
  CDMTAT_SAV 
    CIMTAT_SAV
    CDYTAT_SAV
    CIYTAT_SAV
    PDMTAT_SAV
    PIMTAT_SAV
    PDYTAT_SAV
    PIYTAT_SAV
BY FLAG
ON TABLE HOLD AS TSTATHLD    
END
-RUN
 

MATCH FILE HTLSUMLD2
PRINT CDM1HTL_AMT CDM1HTL_DAY CDM1HTL_RMS
CIM1HTL_AMT CIM1HTL_DAY CIM1HTL_RMS
PDM1HTL_AMT PDM1HTL_DAY PDM1HTL_RMS
PIM1HTL_AMT PIM1HTL_DAY PIM1HTL_RMS
CDY1HTL_AMT CDY1HTL_DAY CDY1HTL_RMS
CIY1HTL_AMT CIY1HTL_DAY CIY1HTL_RMS
PDY1HTL_AMT PDY1HTL_DAY PDY1HTL_RMS
PIY1HTL_AMT PIY1HTL_DAY PIY1HTL_RMS
CDM1AVG_RATE
CIM1AVG_RATE
PDM1AVG_RATE
PIM1AVG_RATE
CDY1AVG_RATE
CIY1AVG_RATE
PDY1AVG_RATE
PIY1AVG_RATE
BY FLAG
ON TABLE HOLD 
RUN 
FILE TSTATHLD
PRINT  CDMTAT_SAV 
    CIMTAT_SAV
    CDYTAT_SAV
    CIYTAT_SAV
    PDMTAT_SAV
    PIMTAT_SAV
    PDYTAT_SAV
    PIYTAT_SAV
BY FLAG
AFTER MATCH HOLD AS HTLSUMLD OLD-OR-NEW
END
-RUN
