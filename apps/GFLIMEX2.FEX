-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 7/21/14 - DEB - CREATED FOR GLOFO-R


-********************************************************************
-* MODIFICAIONS:
-*SET &ECHO=ALL;
-INCLUDE SETECHO
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

 
 

 
DEFINE FILE &&EXTRACT
  BLANK/A3 = '   ';
  BLANK_2/A2 = '  ';
    BLANK2/A20 = ' ';
  BLANK3/A3 = '   ';
  BLANK4/A4 = '    ';
  BLANK25/A25 = ' ';
  BLANKITIN/A67 = ' ';
  DROP_OFF_DT/MDYY = DROP_DATE; 
  FLAG/A1 = 'C'; 
  IFLAG/A8 = IF DOD_TYPE EQ 'H' OR 'I' OR 'J' THEN 'ONLINE' ELSE 'OFFLINE';
  LEVEL_DESC/A60 = &&LDESC;
  NBR_DAYS/D12S = NUM_DAYS;
  NEW_RENTAL_AMT/D12.2CS = RENTAL_AMT;
  PICK_UP_DT/MDYY = PICKUP_DATE;

  RENTAL_DAYS/D12S = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
  TKTN/A10 = IF TKT_NUM EQ '0000000000' THEN ' ' ELSE  TKT_NUM;    
  TKT_TYPE/A8 = ' ';
   TRAN_MY/MTYY = INVOICE_DATE;
  TRAN_TYPE/A13 = ' ';
  VALAL_NM/A12 = VENDOR_NAME;
  PADV/P8 = 0;
  PIK_CTY/A4 = PICKUP_CITY;
END
-RUN

TABLEF FILE &&EXTRACT
PRINT BLANK_2
  BLANK2 AS 'BLANK'
  BLANK25
  BLANK3
  BLANK4
  CLIENT_NAME AS 'BR_CL_IDX'
  PICK_CTY.CITY_NAME AS 'DCTY_NAME'
  PICK_CTY.COUNTRY_CODE AS 'DCTY_CCOD'
  PICK_CTY.GEO_ZONE AS 'DGEO_ZONE'
  BLANKITIN AS 'C_ITIN'
  NEW_RENTAL_AMT  
  FLAG
  PIK_CTY AS 'DST_APCX'
  IFLAG
  INT_CODE
  INVOICE_NUM
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  BLANK4 AS 'ORG_APCX'
  PADV
  PASSNGR_NAME                      
  PNR_LOCATOR    
  DROP_OFF_DT AS 'RTN_DT'
  
  REFUSE_CODE
  REFUSAL_DESC
  INVOICE_DATE AS 'TKT_DATE'
  TKTN AS 'TKT_NUM'
  TKT_TYPE
  TRAN_MY
  TRAN_TYPE
  INVOICE_DATE AS 'TRN_DATE'
   
  RENTAL_DAYS  
  VALAL_NM
  PICK_UP_DT AS 'XFST_DPT'
  VENDOR_CODE
-INCLUDE &CARDATES 
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
-* &&WHERE1
-* &&WHERE2
-* &&WHERE3
-* &&WHERE4
-* &&WHERE5
-* &&WHERE6
&&WHERE7
&&WHERE8
-* &&WHERE9
-* &&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS GFLIMHLD
END
-RUN
 
 

TABLE FILE GFLIMHLD
 
SUM  
    NEW_RENTAL_AMT AS 'CRAMT'
    RENTAL_DAYS  AS 'CRDAYS'
BY LEVEL_DESC    
BY PASSNGR_NAME
BY PNR_LOCATOR
BY VENDOR_CODE
BY TKT_NUM
ON TABLE HOLD AS GFLIM1
END
-RUN
 

MATCH FILE GFLIMHLD
PRINT BLANK_2 BLANK 
  BLANK25
  BLANK3
  BLANK4
  BR_CL_IDX  
  C_ITIN  
  DCTY_NAME
  DCTY_CCOD
  DGEO_ZONE
  NEW_RENTAL_AMT 
  FLAG
  DST_APCX  
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4    
  ORG_APCX
  PADV
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT  
  TKT_DATE  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
  TRN_DATE
   
  RENTAL_DAYS
  VALAL_NM
  
  XFST_DPT  
BY LEVEL_DESC    
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TKT_NUM
ON TABLE HOLD
RUN
FILE GFLIM1
SUM CRAMT
    CRDAYS
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TKT_NUM
AFTER MATCH HOLD AS LTWO OLD-OR-NEW
END
-RUN

DEFINE FILE LTWO
BLANK30/A30 = '                              ';
END
TABLE FILE LTWO
PRINT
  BLANK  
  BR_CL_IDX  
  C_ITIN  

  CRAMT AS 'FARE_PAID' 
  DCTY_NAME
  DCTY_CCOD
  DGEO_ZONE
  DST_APCX
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL_DESC 
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4 
  BLANK25 AS 'OCTY_NM'
  BLANK25 AS 'OCNTRY_NAME'
  BLANK3 AS 'OGEO_ZONE'
  ORG_APCX  
  PASSNGR_NAME  
  PNR_LOCATOR  
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT  
  BLANK_2 AS 'TKT_CL_CAT'
  TKT_DATE  
  TKT_NUM  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
  TRN_DATE
  CRDAYS/D8 AS 'TRP_LEN'
   
  VALAL_NM
  BLANK3 AS ' '
  XFST_DPT  
  PADV
  BLANK30 AS 'PROP_NAME'
BY FLAG
ON TABLE HOLD AS LIMHOLD2
END
-RUN

JOIN LIMHOLD2.DCTY_CCOD IN LIMHOLD2 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J1
-RUN

TABLE FILE LIMHOLD2
PRINT
  BLANK  
  BR_CL_IDX  
  C_ITIN 
  DCTY_NAME
  COUNTRY_NAME AS 'DCNTRY_NAME'
  DGEO_ZONE
  FARE_PAID 
  DST_APCX
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL_DESC 
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4 
  OCTY_NM
  OCNTRY_NAME
  OGEO_ZONE
  ORG_APCX  
  PASSNGR_NAME  
  PNR_LOCATOR 
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT  
  TKT_CL_CAT
  TKT_DATE  
  TKT_NUM  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
  TRN_DATE
  TRP_LEN
   
   
  VALAL_NM  
  XFST_DPT 
  PADV
  PROP_NAME
 BY FLAG
ON TABLE HOLD AS GFLIMFNL FORMAT FOCUS INDEX FLAG
 
END
-RUN
 
 
-GOTO LIMXXIT



TABLE FILE CARHOLD4
PRINT
  BLANK  
  BR_CL_IDX  
  C_ITIN 
  DCTY_NAME
  DCNTRY_NAME
  DGEO_ZONE
  
  FARE_PAID 
  DST_APCX
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL_DESC 
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4 
  OCTY_NM
  OCNTRY_NAME
  OGEO_ZONE
  ORG_APCX  
  PASSNGR_NAME  
  PNR_LOCATOR 
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT  
  TKT_CL_CAT
  TKT_DATE  
  TKT_NUM  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
  TRN_DATE
  TRP_LEN
   
   
  VALAL_NM  
  XFST_DPT 
  PADV
  PROP_NAME
 BY FLAG
ON TABLE HOLD AS GFCARFNL FORMAT FOCUS INDEX FLAG

 
END
-RUN


 

TABLE FILE CARHOLD2
PRINT
  BLANK  
  BR_CL_IDX  
  C_ITIN  
  DCTY_NAME
  DCNTRY_NAME
  DGEO_ZONE
  FARE_PAID
  DST_APCX  
  IFLAG  
  INT_CODE  
  INVOICE_NUM  
  LEVEL_DESC 
  LEVEL1  
  LEVEL2  
  LEVEL3  
  LEVEL4 
  OCTY_NM
  OCNTRY_NAME
  OGEO_ZONE
  ORG_APCX  
  PASSNGR_NAME  
  PNR_LOCATOR  
  REFUSE_CODE
  REFUSAL_DESC
  RTN_DT 
  TKT_CL_CAT
  TKT_DATE  
  TKT_NUM  
  TKT_TYPE 
  TRAN_MY  
  TRAN_TYPE  
  TRN_DATE
  TRP_LEN
   
  VALAL_NM
   
  XFST_DPT  
  PADV
  PROP_NAME
BY FLAG
ON TABLE HOLD AS GFCARFNL FORMAT FOCUS INDEX FLAG
 END
-RUN
 

 



-LIMXXIT
 