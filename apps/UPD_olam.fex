-INCLUDE SETECHO

SET ASNAMES = ON

FILEDEF OLAM_LVL DISK D:\AS400\OLAM_LVL.TXT

TABLE FILE OLAM_LVL
PRINT NW_LVL3
BY LV2
ON TABLE HOLD AS FIXLVL1
END
-RUN


JOIN AIR_KEY IN S_OLAM TO AIR_KEY IN A_OLAM AS J1
DEFINE FILE S_OLAM
XL01/A15 = GETTOK(ICODEX, 36 ,2, '-', 15, XL01);
END
TABLE FILE S_OLAM
PRINT XL01 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY XL01 NOPRINT
ON TABLE HOLD AS DEBHOLD
END
-RUN

JOIN LV2 IN FIXLVL1 TO ALL XL01 IN DEBHOLD AS J1
TABLE FILE FIXLVL1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR XL01 AS 'LEVEL2' NW_LVL3 AS 'AROLL_LEV3'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXSEG
END
-RUN
 
JOIN CLEAR *
-RUN

TABLE FILE FIXSEG
PRINT LEVEL2
BY AIR_KEY
ON TABLE HOLD AS FIXAIR
END
-RUN

MODIFY FILE A_OLAM
FIXFORM FROM FIXAIR
MATCH AIR_KEY
ON MATCH UPDATE LEVEL2
ON NOMATCH REJECT
DATA ON FIXAIR
END
-RUN

TABLE FILE FIXSEG
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR AROLL_LEV3
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT 
BY SEG_NBR
ON TABLE HOLD AS FIXSEG1
END
-RUN

MODIFY FILE S_OLAM
FIXFORM FROM FIXSEG1
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV3
ON NOMATCH REJECT
DATA ON FIXSEG1
END
-RUN

JOIN AIR_KEY IN M_OLAM TO AIR_KEY IN A_OLAM AS J1
DEFINE FILE M_OLAM
XL01/A15 = GETTOK(ICODEX, 36 ,2, '-', 15, XL01);
END
TABLE FILE M_OLAM
PRINT XL01 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY XL01 NOPRINT
ON TABLE HOLD AS DEBHOLDM
END
-RUN

JOIN LV2 IN FIXLVL1 TO ALL XL01 IN DEBHOLDM AS J1
TABLE FILE FIXLVL1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  NW_LVL3 AS 'AROLL_LEV3'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXMKT
END
-RUN
 
JOIN CLEAR *
-RUN



MODIFY FILE M_OLAM
FIXFORM FROM FIXMKT
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV3
ON NOMATCH REJECT
DATA ON FIXMKT
END
-RUN

JOIN AIR_KEY IN D_OLAM TO AIR_KEY IN A_OLAM AS J1
DEFINE FILE D_OLAM
XL01/A15 = GETTOK(ICODEX, 36 ,2, '-', 15, XL01);
END
TABLE FILE D_OLAM
PRINT XL01 AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY XL01 NOPRINT
ON TABLE HOLD AS DEBHOLDD
END
-RUN

JOIN LV2 IN FIXLVL1 TO ALL XL01 IN DEBHOLDD AS J1
TABLE FILE FIXLVL1
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR  NW_LVL3 AS 'AROLL_LEV3'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
ON TABLE HOLD AS FIXDST
END
-RUN
 
JOIN CLEAR *
-RUN



MODIFY FILE D_OLAM
FIXFORM FROM FIXMKT
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV3
ON NOMATCH REJECT
DATA ON FIXDST
END
-RUN

DEFINE FILE C_OLAM
XL01/A15 = GETTOK(ICODEX, 36 ,2, '-', 15, XL01);
END
TABLE FILE C_OLAM
PRINT XL01 CAR_KEY
BY XL01 NOPRINT
ON TABLE HOLD AS CARHOLD
END
-RUN

JOIN LV2 IN FIXLVL1 TO ALL XL01 IN CARHOLD AS J1
TABLE FILE FIXLVL1
PRINT XL01 AS 'LEVEL2' NW_LVL3 AS 'AROLL_LEV3'
BY CAR_KEY
ON TABLE HOLD AS CARFIX
END
-RUN

JOIN CLEAR *
-RUN

MODIFY FILE C_OLAM
FIXFORM FROM CARFIX
MATCH CAR_KEY
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE AROLL_LEV3
ON NOMATCH REJECT
DATA ON CARFIX
END
-RUN

DEFINE FILE H_OLAM
XL01/A15 = GETTOK(ICODEX, 36 ,2, '-', 15, XL01);
END
TABLE FILE H_OLAM
PRINT XL01 HTL_KEY
BY XL01 NOPRINT
ON TABLE HOLD AS HTLHOLD
END
-RUN

JOIN LV2 IN FIXLVL1 TO ALL XL01 IN HTLHOLD AS J1
TABLE FILE FIXLVL1
PRINT XL01 AS 'LEVEL2' NW_LVL3 AS 'AROLL_LEV3'
BY HTL_KEY
ON TABLE HOLD AS HTLFIX
END
-RUN

JOIN CLEAR *
-RUN

MODIFY FILE H_OLAM
FIXFORM FROM HTLFIX
MATCH HTL_KEY
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE AROLL_LEV3
ON NOMATCH REJECT
DATA ON HTLFIX
END
-RUN

