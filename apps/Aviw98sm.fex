-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-********************************************************************
-* 3/18/14 - ADDED ROUTINE FOR ABGRPFLT - DEB
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*12/17/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-* 02/24/2017 - DLV - S-22486 CHANGED ettek Review to Post-trip Reporting
-*4/24/2017-JEM-S-33318-updated logic for no records report
-*09/28/2017 JEM S-35461 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = #;
-********************************************************************

-INCLUDE SETECHO 


SET ASNAMES = ON
-RUN


-IF '&&SETF.EVAL' EQ 'ABGRPFLT' THEN GOTO GROUPFLT;
TABLE FILE &&RPT_HOLD
SUM FARE_PAID/D12.2CS AS 'TFARE'	
    MRK_TKT_CNT/D8CS AS 'TMKT'
    NEW_SEG_AMT/D12.CS AS 'TBASE'
    DISSAVINGS/D12.2CS AS 'TLOSS'
    NET_TKT_CNT/D8CS AS 'TTKT'
BY LEVEL_DESC
-* BY XDPT_DT
-*BY RTE_APT_NM
BY DST_APC
BY DST_APCX
BY XDPT_DT
ON TABLE HOLD AS HOLDONE
END
-RUN

JOIN HOLDONE.DST_APCX IN HOLDONE TO AIRPORT.APCODEX IN AIRPORT AS J2
END


TABLE FILE HOLDONE
SUM TFARE
    TMKT
    TBASE
    TLOSS
    TTKT
    AIRPORT_NAME AS 'DAP_NAME'
BY LEVEL_DESC
BY DST_APC
BY XDPT_DT
ON TABLE HOLD AS HOLDTWO
END
-RUN





TABLE FILE &&RPT_HOLD
PRINT 
  AIRLINE 	
  AIRLINE_NAME
  DOC_TYPE
  EMB_APT_NM
  EX_FLAG
  FARE_PAID
  NET_TKT_CNT
  MRK_TKT_CNT
  NEW_SEG_AMT
  RF_FLAG
  RTE_APT_NM
  ORG_APC
  ORG_APCX
  SEG_NBR
  TKT_NUM
  XDPT_DT
BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM
BY DST_APC
BY XDPT_DT
ON TABLE HOLD AS XTWO
END
-RUN


MATCH FILE XTWO
PRINT
  AIRLINE 	
  AIRLINE_NAME
  EMB_APT_NM
  FARE_PAID 
  MRK_TKT_CNT
  NET_TKT_CNT
  NEW_SEG_AMT 
  ORG_APC
  ORG_APCX
  RTE_APT_NM
  TKT_NUM
  XDPT_DT
BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM
BY DST_APC
BY XDPT_DT
ON TABLE HOLD
RUN
FILE HOLDTWO
SUM TBASE
    TFARE
    TMKT
    TLOSS
    TTKT
    DAP_NAME
BY LEVEL_DESC
BY DST_APC
BY XDPT_DT
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN


-* -SET &&RANK_LIMIT = 10;

JOIN XTHREE.ORG_APCX IN XTHREE TO AIRPORT.APCODEX IN AIRPORT AS J2
END

-IF '&&ROLLUP.EVAL' EQ 'SCHNEI-R' OR 'UPTTL-R' THEN GOTO SCHNEI;


-GOTO CONTINUE;

TABLE FILE XTHREE
PRINT AIRPORT_NAME AS 'OAP_NAME'
  AIRLINE 	
  AIRLINE_NAME
  DAP_NAME
  DST_APC
  EMB_APT_NM
  FARE_PAID
  MRK_TKT_CNT 
  NET_TKT_CNT
  NEW_SEG_AMT
  ORG_APC
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
  RTE_APT_NM
  TKT_NUM
  XDPT_DT
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM
BY DAP_NAME
BY XDPT_DT
WHERE TTKT GE &&RANK_LIMIT
ON TABLE HOLD AS XFOUR  
END
-RUN


-SCHNEI

-SET &&RANK_LIMIT = 2;


TABLE FILE XTHREE
SUM NET_TKT_CNT AS 'ATKT'

BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM
BY DAP_NAME
BY AIRPORT_NAME
BY XDPT_DT
BY AIRLINE
ON TABLE HOLD AS ACNT
END
-RUN


MATCH FILE XTHREE
PRINT  
  AIRLINE_NAME
  DST_APC
  EMB_APT_NM
  FARE_PAID
  MRK_TKT_CNT 
  NET_TKT_CNT
  NEW_SEG_AMT
  ORG_APC
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
  RTE_APT_NM
  TKT_NUM
  XDPT_DT
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM
BY DAP_NAME
BY AIRPORT_NAME
BY XDPT_DT
BY AIRLINE
ON TABLE HOLD
RUN
FILE ACNT
SUM ATKT
BY LEVEL_DESC
BY DAP_NAME
BY AIRPORT_NAME
BY XDPT_DT
BY AIRLINE
AFTER MATCH HOLD AS SHHOLD OLD-OR-NEW
END
-RUN


TABLE FILE SHHOLD
PRINT AIRPORT_NAME AS 'OAP_NAME'  
  AIRLINE 	
  AIRLINE_NAME
-*  DAP_NAME
  DST_APC
  EMB_APT_NM
  FARE_PAID
  MRK_TKT_CNT 
  NET_TKT_CNT
  NEW_SEG_AMT
  ORG_APC
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
  RTE_APT_NM
  TKT_NUM
-*  XDPT_DT
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
  ATKT
BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM
BY DAP_NAME
BY XDPT_DT
WHERE ATKT GE &&RANK_LIMIT
ON TABLE HOLD AS XFOUR  
END
-RUN

-GOTO FinReport;

-CONTINUE
-IF '&&SETF.EVAL' NE 'CYGROUPI' THEN GOTO Skipset;

-SET &&RANK_LIMIT = 2;

-Skipset


TABLE FILE XTHREE
PRINT AIRPORT_NAME AS 'OAP_NAME'  
  AIRLINE 	
  AIRLINE_NAME
  DAP_NAME
  DST_APC
  EMB_APT_NM
  FARE_PAID 
  MRK_TKT_CNT 
  NET_TKT_CNT
  NEW_SEG_AMT
  ORG_APC
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
  RTE_APT_NM
  TKT_NUM
  XDPT_DT
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
BY LEVEL_DESC
-* BY XDPT_DT
-* BY RTE_APT_NM


BY DAP_NAME
BY XDPT_DT
WHERE TTKT GE &&RANK_LIMIT
ON TABLE HOLD AS XFOUR  
END
-RUN

-GOTO FinReport;


-GROUPFLT

 
TABLE FILE &&RPT_HOLD
SUM FARE_PAID/D12.2CS AS 'TFARE'	
    MRK_TKT_CNT/D8CS AS 'TMKT'
    NEW_SEG_AMT/D12.CS AS 'TBASE'
    DISSAVINGS/D12.2CS AS 'TLOSS'
    NET_TKT_CNT/D8CS AS 'TTKT'
BY LEVEL_DESC
BY RTE_APT_NM
BY EMB_APT_NM
BY AIRLINE
BY FLIGHT
BY XDPT_DT
ON TABLE HOLD AS HOLDONE
END
-RUN



TABLE FILE HOLDONE
SUM TFARE
    TMKT
    TBASE
    TLOSS
    TTKT
BY LEVEL_DESC
BY RTE_APT_NM
BY EMB_APT_NM
BY AIRLINE
BY FLIGHT
BY XDPT_DT
ON TABLE HOLD AS HOLDTWO
END
-RUN


TABLE FILE &&RPT_HOLD
PRINT 
  AIRLINE 	
  AIRLINE_NAME
  DOC_TYPE
  DST_APC
  EMB_APT_NM
  EX_FLAG
  FARE_PAID
  FLIGHT
  NET_TKT_CNT
  MRK_TKT_CNT
  NEW_SEG_AMT
  RF_FLAG
  RTE_APT_NM
  ORG_APC
  ORG_APCX
  SEG_NBR
  TKT_NUM
  XDPT_DT
BY LEVEL_DESC
BY RTE_APT_NM
BY EMB_APT_NM
BY AIRLINE
BY FLIGHT
BY XDPT_DT
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT
  AIRLINE 	
  AIRLINE_NAME
  DST_APC
  EMB_APT_NM
  FARE_PAID 
  FLIGHT
  MRK_TKT_CNT
  NET_TKT_CNT
  NEW_SEG_AMT 
  ORG_APC
  ORG_APCX
  RTE_APT_NM
  TKT_NUM
  XDPT_DT
BY LEVEL_DESC
BY RTE_APT_NM
BY EMB_APT_NM
BY AIRLINE
BY FLIGHT
BY XDPT_DT
ON TABLE HOLD
RUN
FILE HOLDTWO
SUM TBASE
    TFARE
    TMKT
    TLOSS
    TTKT
BY LEVEL_DESC
BY RTE_APT_NM
BY EMB_APT_NM
BY AIRLINE
BY FLIGHT
BY XDPT_DT
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN


TABLE FILE XTHREE
PRINT 
  AIRLINE 	
  AIRLINE_NAME
  DST_APC
  EMB_APT_NM
  FARE_PAID
  FLIGHT
  MRK_TKT_CNT 
  NET_TKT_CNT
  NEW_SEG_AMT
  ORG_APC
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
  RTE_APT_NM
  TKT_NUM
  XDPT_DT
  TBASE
  TFARE
  TMKT
  TLOSS
  TTKT
BY LEVEL_DESC
BY RTE_APT_NM
BY EMB_APT_NM
BY AIRLINE
BY FLIGHT
BY XDPT_DT
WHERE TTKT GE &&RANK_LIMIT
ON TABLE HOLD AS XFOUR  
END
-RUN

-FinReport

-IF &RECORDS EQ 0 THEN GOTO NORECORDS; 


DEFINE FILE XFOUR
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
  CALC/I6 = IF (XDPT_DT NE LAST XDPT_DT) OR (DST_APC NE LAST DST_APC) 
           THEN 1 ELSE 0;
  X_DATE/A8MDYY = XDPT_DT;
  XDATM/A2 = EDIT(X_DATE,'99');
  XDATD/A2 = EDIT(X_DATE, '$$99');
  XDATY/A4 = EDIT(X_DATE, '$$$$9999');
  XTDATE2/A10 = XDATM || '/' || XDATD || '/' || XDATY;
  XTDATE3/A10 = IF TKT_NUM NE LAST TKT_NUM THEN XTDATE2 ELSE ' ';
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE XFOUR
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;

    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
" "
" "
"TOTAL POTENTIAL MEETINGS <TOT.CALC"
-*
-INCLUDE FOOTERSM
-*
ON TABLE COLUMN-TOTAL
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT

-NORECORDS



-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN
-*
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO XXIT

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-XXIT

