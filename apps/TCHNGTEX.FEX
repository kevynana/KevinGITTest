-* JK added code to select only tnt_company eq 1 or 2 2/21/05
-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE

-INCLUDE SETECHO
SET ASNAMES = ON
-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED IN STEP3
-*========================================================================
-SET &&EXTRACT = 'HR_50';

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';


DEFINE FILE &&EXTRACT
  BOOKINGS/D8 = IF TOTAL_AMT GE 0 THEN 1 ELSE 0;
  IBOOK/A13 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE 'TRADITIONAL';  
  NBR_ROOMS/D12 =  NUM_ROOMS; 
  NBR_DAYS/D12 = NUM_DAYS;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NBR_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NBR_ROOMS) * (-1)) ELSE NBR_DAYS*NBR_ROOMS;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  
END

TABLEF FILE &&EXTRACT
PRINT BOOKINGS
  IBOOK
  NBR_ROOMS
  NNROOMS	
  NEW_TOTAL_AMT 	
 -INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
-**************************************** BYPASSING WHERE STATEMENTS
-* -GOTO SKIP_ROLL
WHERE ROLLUP_CODE EQ 'AIRT-R' OR 'ALTO-R' OR 'AMERUS-R' OR 'AMP-R' OR 'AMRS-R' OR 'ASSUR-R' OR 'BFDS-R' OR
'BIC-R' OR 'BOUNCE-R' OR 'BRAU-R' OR 'BUCKLE-R' OR 'BUSHN-R' OR 'CCA-R' OR 'CCRTEC-R' OR 'CHEP-R' OR 'COMPC-R' OR
'COMPS-R' OR 'COMPUT-R' OR 'CRAY-R' OR 'CSGO-R' OR 'DODGE-R' OR 'DRAU-R' OR 'DTNC-R' OR 'DUNC-R' OR 'DUNN-R' OR
'ELECT-R' OR 'FOREST-R' OR 'FRANK-R' OR 'GALLUP-R' OR 'GAVIL-R' OR 'GAYES-R' OR 'GENMC-R' OR 'GENO-R' OR 'GOLUB-R' OR
'GWL-R' OR 'HAMD-R' OR 'HAR-R' OR 'HARTE-R' OR 'HKS-R' OR 'HMMH-R' OR 'HNS-R' OR 'HOLLST-R' OR 'HRG-R' OR 'HUMANX-R' OR
'ICM-R' OR 'IHI-R' OR 'ILSS-R' OR 'IRC-R' OR 'ITRON-R' OR 'JBSP-R' OR 'KAUFF-R' OR 'KCLG-R' OR 'KENEXA-R' OR 'KMC-R' OR
'KOLEY-R' OR 'LAFRA-R' OR 'LIFE-R' OR 'LINK-R' OR 'LUMET-R' OR 'MACC-R' OR 'MAIDS-R' OR 'MAM-R' OR 'MANRO-R' OR 
'MANX-R' OR 'MAV-R' OR 'MERRCO-R' OR 'MESAFD-R' OR 'MEVENT-R' OR 'MOFO-R' OR 'MUSCO-R' OR 'MUTM-R' OR 'NAL-R' OR
'NBAS-R' OR 'NEMACH-R' OR 'NGL-R' OR 'NOVAS-R' OR 'NUSTAR-R' OR 'OBRI-R' OR 'OPT-R' OR 'PCG-R' OR 'PERCEP-R' OR
'PLUS-R' OR 'PPFA-R' OR 'PROFO-R' OR 'REGEN-R' OR 'REG-R' OR 'REPTEA-R' OR 'RGA-R' OR 'RUNZ-R' OR 'SEY-R' OR
'SINGSE-R' OR 'SMH-R' OR 'SPG-R' OR 'STAPLE-R' OR 'SUNF-R' OR 'TELECA-R' OR 'TELM-R' OR 'TEMPU-R' OR 'TOSCA-R' OR
'UAP-R' OR 'UNI-R' OR 'VANMET-R' OR 'VECTOR-R' OR 'VWALL-R' OR 'WILL-R' OR 'WIND-R' OR 'WOODW-R' OR 'WWF-R' OR
'YORK-R' OR 'ZONAR-R'
WHERE TKT_NUM EQ '0000000000'
-*****************************************
-SKIP_ROLL
ON TABLE HOLD AS TCHHLD
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TCTHTL       
-*========================================================================
DEFINE FILE TCHHLD
ROLLCD/A8 = '&&ROLL';
-* NMB/I5    = NMB + 1;
END
TABLE FILE TCHHLD
SUM BOOKINGS
    NBR_ROOMS
    NNROOMS	
    NEW_TOTAL_AMT 
BY ROLLCD
-* BY NMB
BY IBOOK
ON TABLE HOLD AS TCHHLD2 
END
-RUN

MODIFY FILE TCHTRN1
FIXFORM FROM TCHHLD2
DATA ON TCHHLD2
END
-RUN




-NEXTONE
