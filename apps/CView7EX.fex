-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File CVIEW7EX.FEX
-********************************************************************
-* MODIFICAIONS:
-* 11/24/04 - DEB - ADDED CODE FOR GLOBAL CURRENCY
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK
-*07/12/16    RSB   S-20630 - New Employee ID database field
-*                  Added EMP_ID
-*  
-********************************************************************
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

DEFINE FILE &&EXTRACT
 
BOOKINGS/D12 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;
  CAR_DSC/A20 = EDIT(CAR_DESC, '99999999999999999999$$$$$$$$$$');
  LEVEL_DESC/A60 = &&LDESC;
  DROP_OFF_DT/MDYY = DROP_DATE;	
  NBR_DAYS/D12CS = NUM_DAYS;
  PICK_UP_DT/MDYY = PICKUP_DATE;	
  RENTAL_DAYS/D8CS = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS; 
  
END
-RUN

TABLEF FILE &&EXTRACT
PRINT BOOKINGS
  CAR_DSC
  CAR_RATE 	
  CAR_TYPE
  CURR_DATE 	
  DAILY_RATE 	
  DROP_CTY.CITY_NAME/A14 AS 'DROP_CTY_NAME' 	
  DROP_OFF_DT
  LEVEL_DESC	
  EMP_ID
  LEVEL1
  LEVEL2
  NBR_DAYS
  PASSNGR_NAME
  PICK_CTY.CITY_NAME/A14 AS 'PICK_CTY_NAME'	
  PICK_UP_DT	
  PICKUP_DATE	
  RENTAL_AMT
  RENTAL_DAYS	
  VENDOR_NAME
  
 -INCLUDE &CARDATES      
-*WHERE INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS

ON TABLE HOLD AS CARHOLD 
END
-RUN

TABLE FILE CARHOLD 
PRINT BOOKINGS
  CAR_DSC
  CAR_RATE 	
  CAR_TYPE
  DAILY_RATE 	
  DROP_CTY_NAME 	
  DROP_OFF_DT
  LEVEL_DESC	
  EMP_ID
  LEVEL1
  LEVEL2
  NBR_DAYS
  PASSNGR_NAME
  PICK_CTY_NAME	
  PICK_UP_DT	
  PICKUP_DATE	
  RENTAL_AMT
  RENTAL_DAYS	
  VENDOR_NAME
BY CURR_DATE ON TABLE HOLD AS CARHOLD7 FORMAT FOCUS INDEX CURR_DATE
END
-RUN

-* Global Reporting JOIN
JOIN CARHOLD7.CURR_DATE IN CARHOLD7 TO GLOBAL.DATE IN GLOBAL AS J1
END

DEFINE FILE CARHOLD7

 NAMEC/A30 = CNAME;

-******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;

-* DEFINES ON PREVIOUS DEFINES
AMT_RENTALX/D20.6 = RENTAL_AMT * CURR1X;
RATE_DLYX/D20.6 = DAILY_RATE * CURR1X;

END

TABLE FILE CARHOLD7
PRINT BOOKINGS
  CAR_DSC
  CAR_RATE 	
  CAR_TYPE
  CURR_DATE
  DAILY_RATE 	
  DROP_CTY_NAME 	
  DROP_OFF_DT
  LEVEL_DESC	
  EMP_ID
  LEVEL1
  LEVEL2
  NBR_DAYS
  PASSNGR_NAME
  PICK_CTY_NAME	
  PICK_UP_DT	
  PICKUP_DATE	
  RENTAL_AMT
  RENTAL_DAYS	
  VENDOR_NAME
  AMT_RENTALX/D16.2CS
  RATE_DLYX/D16.2CS
  NAMEC
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS CARHLD7
END
-RUN



