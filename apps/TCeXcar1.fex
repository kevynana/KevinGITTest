-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File TCEXCAR1.FEX
-*************************************************************************
-*DATE          NAME            DESCRIPTION
-* 7/1/04       DEB             THIS PROGRAM EXTRACTS CAR DATA FOR USE
-*                              IN TOTAL COMPANY REPORTING TRAVEL SUMMARY
-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT
-*************************************************************************
-*SET %STRICTMATH=OLD 

-* -INCLUDE SETECHO
SET ASNAMES = ON


DEFINE FILE CR_50
INTL_DOM/A1 =IF (PICK_CTY.INTL_DOM EQ 'I') THEN 'I' ELSE 'D';
CM/A1 = IF INVOICE_DATE GE &&CMFMDT.EVAL AND
INVOICE_DATE LE &&CMTODT.EVAL THEN 'Y' ELSE 'N';
 CY/A1 = IF INVOICE_DATE GE &&CYFMDT.EVAL AND
INVOICE_DATE LE &&CYTODT.EVAL THEN 'Y' ELSE 'N';
 PM/A1 = IF INVOICE_DATE GE &&PMFMDT.EVAL AND
INVOICE_DATE LE &&PMTODT.EVAL THEN 'Y' ELSE 'N';
 PY/A1 = IF INVOICE_DATE GE &&PYFMDT.EVAL AND
INVOICE_DATE LE &&PYTODT.EVAL THEN 'Y' ELSE 'N';


-*DOMESTIC PERIOD
-* CURRENT RENTAL AMOUNT DOMESTIC CALCULATION
      CDM1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;
-*DOMESTIC PERIOD
-* CURRENT RENTAL AMOUNT DOMESTIC CALCULATION
      CDM1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* CURRENT RENTAL DAYS DOMESTIC CALCULATION
      CDM1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (CM EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (CM EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;
-*INT'L PERIOD
-* CURRENT RENTAL AMOUNT INT'L CALCULATION
      CIM1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* CURRENT RENTAL DAYS INT'L CALCULATION
      CIM1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (CM EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (CM EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;

-*DOMESTIC PERIOD
-* PRIOR RENTAL AMOUNT DOMESTIC CALCULATION
      PDM1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* PRIOR RENTAL DAYS DOMESTIC CALCULATION
      PDM1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (PM EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (PM EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;

-*INT'L PERIOD
-* PRIOR RENTAL AMOUNT INT'L CALCULATION
      PIM1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* PRIOR RENTAL DAYS INT'L CALCULATION
      PIM1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (PM EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (PM EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;

-*DOMESTIC YTD
-* CURRENT RENTAL AMOUNT DOMESTIC CALCULATION
      CDY1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* CURRENT RENTAL DAYS DOMESTIC CALCULATION
      CDY1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (CY EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (CY EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;
-*INT'L YTD
-* CURRENT RENTAL AMOUNT INT'L CALCULATION
      CIY1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* CURRENT RENTAL DAYS INT'L CALCULATION
      CIY1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (CY EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (CY EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;

-*DOMESTIC YTD
-* PRIOR RENTAL AMOUNT DOMESTIC CALCULATION
      PDY1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* PRIOR RENTAL DAYS DOMESTIC CALCULATION
      PDY1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'D') AND (PY EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'D') AND (PY EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;

-*INT'L YTD
-* PRIOR RENTAL AMOUNT INT'L CALCULATION
      PIY1RNT_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))
                      THEN CAR_MAIN.RENTAL_AMT
                      ELSE 0;

-* PRIOR RENTAL DAYS INT'L CALCULATION
      PIY1RNT_DAY/D12.2 = IF ((INTL_DOM IS 'I') AND (PY EQ 'Y')
                      AND (CAR_MAIN.NUM_DAYS LT 0)
                      AND (CAR_MAIN.NUM_CAR LT 0))
                      THEN ((CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR) * (-1))
                      ELSE IF ((INTL_DOM IS 'I') AND (PY EQ 'Y'))
                      THEN CAR_MAIN.NUM_DAYS * CAR_MAIN.NUM_CAR
                      ELSE 0;
MIR_SEQ1/A1 = EDIT(MIR_SEQ, '9$$$$$');
RES_SYS/A1 = IF MIR_SEQ1 EQ 'X' THEN 'S' ELSE 'A';                      
END
-RUN

TABLEF FILE CR_50
SUM
CDM1RNT_AMT/D15 CDM1RNT_DAY/D15 CIM1RNT_AMT/D15 CIM1RNT_DAY/D15
PDM1RNT_AMT/D15 PDM1RNT_DAY/D15 PIM1RNT_AMT/D15 PIM1RNT_DAY/D15
CDY1RNT_AMT/D15 CDY1RNT_DAY/D15 CIY1RNT_AMT/D15 CIY1RNT_DAY/D15
PDY1RNT_AMT/D15 PDY1RNT_DAY/D15 PIY1RNT_AMT/D15 PIY1RNT_DAY/D15

WHERE (CAR_MAIN.INVOICE_DATE GE &&CYFMDT.EVAL
      AND CAR_MAIN.INVOICE_DATE LE &&CYTODT.EVAL)
 OR (CAR_MAIN.INVOICE_DATE GE &&PYFMDT.EVAL
      AND CAR_MAIN.INVOICE_DATE LE &&PYTODT.EVAL)
 OR (CAR_MAIN.INVOICE_DATE GE &&CMFMDT.EVAL
      AND CAR_MAIN.INVOICE_DATE LE &&CMTODT.EVAL)
 OR (CAR_MAIN.INVOICE_DATE GE &&PMFMDT.EVAL
      AND CAR_MAIN.INVOICE_DATE LE &&PMTODT.EVAL);
&&WHERE1
&&WHERE2
&&WHERE3
-INCLUDE RPTPARMS

ON TABLE HOLD AS TCCARH
END
-RUN




-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*                <---------------- STEP5 ---------------->
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TC_TRVL       
-*========================================================================

DEFINE FILE TCCARH
ROLLCD/A8 = '&&ROLL';
END

TABLE FILE TCCARH
-* Generated by Report Assist
PRINT
CDM1RNT_AMT CDM1RNT_DAY CIM1RNT_AMT CIM1RNT_DAY
PDM1RNT_AMT PDM1RNT_DAY PIM1RNT_AMT PIM1RNT_DAY
CDY1RNT_AMT CDY1RNT_DAY CIY1RNT_AMT CIY1RNT_DAY
PDY1RNT_AMT PDY1RNT_DAY PIY1RNT_AMT PIY1RNT_DAY
BY ROLLCD
ON TABLE HOLD AS CARHOLD2
END
-RUN

DEFINE FILE CARHOLD2
  NMB/I5 = NMB + 1;  
END
TABLE FILE CARHOLD2
PRINT
CDM1RNT_AMT CDM1RNT_DAY CIM1RNT_AMT CIM1RNT_DAY
PDM1RNT_AMT PDM1RNT_DAY PIM1RNT_AMT PIM1RNT_DAY
CDY1RNT_AMT CDY1RNT_DAY CIY1RNT_AMT CIY1RNT_DAY
PDY1RNT_AMT PDY1RNT_DAY PIY1RNT_AMT PIY1RNT_DAY
BY ROLLCD
BY NMB
ON TABLE HOLD AS TCCAR
END
-RUN


MODIFY FILE TC_TSCAR
FIXFORM FROM TCCAR
MATCH ROLLCD NMB
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON TCCAR
END
-RUN

-NEXTONE




