-* 5/29/13 - DEB CHANGED DIFF PCT TO BE CALCUATED FROM DIVIIDING BY PRIOR
-*           INSTEAD OF CURRENT
-* 1/15/14 - Joy Updated the LRPCT define to not calculate if difference nets to zero


-SET ASNAMES = ON


-INCLUDE SETECHO

DEFINE FILE HTLHOLD
LABEL1/A40='Hotel Expenditure';
LABEL2/A40='Average Hotel Rate';
LABEL3/A40='Average Length of Stay';
LABEL4/A40='# of Room Nights';
END
TABLE FILE HTLHOLD
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
BY TRNM
ON TABLE HOLD AS HOLDTHREE
END
-RUN


-*JAN

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;
                                         
BY TRNM
WHERE TRNM EQ 'JAN'
ON TABLE HOLD AS JANHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO FEB;

DEFINE FILE JANHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE JANHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JANTOTHTL
END
-RUN

TABLE FILE JANTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JANTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JANTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO CURYR PRYR DIFF IDPERCENT TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JANTOTHTL1
END
-RUN


TABLE FILE JANHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO' AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12 AS 
'PRYR' AND RATEDIFF/D12 AS 'DIFF' RATEPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS JANHTLAVG
END
-RUN

TABLE FILE JANHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JANHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JANHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO CURYR PRYR DIFF IDPERCENT TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JANHTLAVG1
END
-RUN

TABLE FILE JANHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS JANSTAY
END
-RUN

TABLE FILE JANSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JANSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JANSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO CURYR PRYR DIFF IDPERCENT TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JANSTAY1
END
-RUN

TABLE FILE JANHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12 AS 'CURMO' AND YROOMS/D12 AS 'PRMO' AND 
MROOMS/D12 AS 'CURYR' AND YROOMS/D12 AS 'PRYR' AND ROOMDIFF/D12 AS 'DIFF'
AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS JANROOM
END
-RUN

TABLE FILE JANROOM
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JANROOM1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JANROOM1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO CURYR PRYR DIFF IDPERCENT TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JANROOM1
END
-RUN 

-FEB

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'FEB'
ON TABLE HOLD AS FEBHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO MAR;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;
                     
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB'
ON TABLE HOLD AS FEBHTLYTD
END
-RUN



DEFINE FILE FEBHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE FEBHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS FEBTOTHTL
END
-RUN

TABLE FILE FEBTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS FEBTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON FEBTOTHTL1
END
-RUN

DEFINE FILE FEBHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE FEBHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS FEBYTDHTL1
END
-RUN


TABLE FILE FEBYTDHTL1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS FEBYTDHTL2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBYTDHTL2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON FEBYTDHTL2
END
-RUN

TABLE FILE FEBHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS FEBHTLAVG
END
-RUN

TABLE FILE FEBHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS FEBHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON FEBHTLAVG1
END
-RUN

TABLE FILE FEBHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS FEBYTDAVG
END
-RUN

TABLE FILE FEBYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS FEBYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON FEBYTDAVG1
END
-RUN

TABLE FILE FEBHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS FEBSTAY
END
-RUN

TABLE FILE FEBSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS FEBSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON FEBSTAY1
END
-RUN

TABLE FILE FEBHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS FEBSTAYYTD 
END
-RUN

TABLE FILE FEBSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS FEBSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON FEBSTAYYTD1
END
-RUN

TABLE FILE FEBHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS FEBROOMS
END
-RUN

TABLE FILE FEBROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS FEBROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON FEBROOMS1
END
-RUN

TABLE FILE FEBHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS FEBROOMYTD
END
-RUN

TABLE FILE FEBROOMYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS FEBROOMYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBROOMYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON FEBROOMYTD1
END
-RUN

-MAR
TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'MAR'
ON TABLE HOLD AS MARHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO APR;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR'
ON TABLE HOLD AS MARHTLYTD
END
-RUN

DEFINE FILE MARHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE MARHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MARTOTHTL
END
-RUN

TABLE FILE MARTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MARTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MARTOTHTL1
END
-RUN

DEFINE FILE MARHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE MARHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MARYTDHTL1
END
-RUN

TABLE FILE MARYTDHTL1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS MARYTDHTL2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARYTDHTL2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MARYTDHTL2
END
-RUN

TABLE FILE MARHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS MARHTLAVG
END
-RUN

TABLE FILE MARHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MARHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MARHTLAVG1
END
-RUN

TABLE FILE MARHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS MARYTDAVG
END
-RUN

TABLE FILE MARYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS MARYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MARYTDAVG1
END
-RUN
 
TABLE FILE MARHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS MARSTAY
END
-RUN

TABLE FILE MARSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MARSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MARSTAY1
END
-RUN

TABLE FILE MARHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS MARSTAYYTD 
END
-RUN

TABLE FILE MARSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS MARSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MARSTAYYTD1
END
-RUN
 
TABLE FILE MARHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS MARROOMS
END
-RUN

TABLE FILE MARROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MARROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MARROOMS1
END
-RUN

TABLE FILE MARHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS MARROOMYTD
END
-RUN

TABLE FILE MARROOMYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS MARROOMYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARROOMYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MARROOMYTD1
END
-RUN

-APR

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'APR'
ON TABLE HOLD AS APRHTL
END
-RUN


TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' 
ON TABLE HOLD AS APRHTLYTD
END
-RUN

DEFINE FILE APRHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE APRHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS APRTOTHTL
END
-RUN

TABLE FILE APRTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS APRTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON APRTOTHTL1
END
-RUN

DEFINE FILE APRHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE APRHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS APRYTDHTL1
END
-RUN

TABLE FILE APRYTDHTL1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS APRYTDHTL2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRYTDHTL2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON APRYTDHTL2
END
-RUN

TABLE FILE APRHTL 
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS APRHTLAVG 
END
-RUN

TABLE FILE APRHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS APRHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON APRHTLAVG1
END
-RUN

TABLE FILE APRHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS APRYTDAVG
END
-RUN

TABLE FILE APRYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS APRYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON APRYTDAVG1
END
-RUN
 

TABLE FILE APRHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS APRSTAY
END
-RUN

TABLE FILE APRSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS APRSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON APRSTAY1
END
-RUN

TABLE FILE APRHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS APRSTAYYTD 
END
-RUN

TABLE FILE APRSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS APRSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON APRSTAYYTD1
END
-RUN

TABLE FILE APRHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS APRROOMS
END
-RUN

TABLE FILE APRROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS APRROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON APRROOMS1
END
-RUN

TABLE FILE APRHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS APRROOMYTD
END
-RUN

TABLE FILE APRROOMYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS APRROOMYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRROOMYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON APRROOMYTD1
END
-RUN

-MAY
TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'MAY'
ON TABLE HOLD AS MAYHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO JUN;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;

BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY'
ON TABLE HOLD AS MAYHTLYTD
END
-RUN

DEFINE FILE MAYHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE MAYHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MAYTOTHTL
END
-RUN

TABLE FILE MAYTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MAYTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MAYTOTHTL1
END
-RUN

DEFINE FILE MAYHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE MAYHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MAYYTDHTL
END
-RUN

TABLE FILE MAYYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS MAYYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MAYYTDHTL1
END
-RUN

TABLE FILE MAYHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS MAYHTLAVG
END
-RUN

TABLE FILE MAYHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MAYHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MAYHTLAVG1
END
-RUN

TABLE FILE MAYHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS MAYYTDAVG
END
-RUN

TABLE FILE MAYYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS MAYYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MAYYTDAVG1
END
-RUN
 
TABLE FILE MAYHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS MAYSTAY
END
-RUN

TABLE FILE MAYSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MAYSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MAYSTAY1
END
-RUN

TABLE FILE MAYHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS MAYSTAYYTD 
END
-RUN

TABLE FILE MAYSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS MAYSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MAYSTAYYTD1
END
-RUN

TABLE FILE MAYHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS MAYROOMS
END
-RUN

TABLE FILE MAYROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MAYROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MAYROOMS1
END
-RUN

TABLE FILE MAYHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS MAYROOMYTD
END
-RUN

TABLE FILE MAYROOMYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS MAYROOMYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYROOMYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MAYROOMYTD1
END
-RUN

-JUN

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'JUN'
ON TABLE HOLD AS JUNHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO JUL;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;

BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN'
ON TABLE HOLD AS JUNHTLYTD
END
-RUN

DEFINE FILE JUNHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE JUNHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JUNTOTHTL
END
-RUN

TABLE FILE JUNTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JUNTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JUNTOTHTL1
END
-RUN

DEFINE FILE JUNHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
-RUN

TABLE FILE JUNHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JUNYTDHTL
END
-RUN

TABLE FILE JUNYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS JUNYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JUNYTDHTL1
END
-RUN

TABLE FILE JUNHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS JUNHTLAVG
END
-RUN

TABLE FILE JUNHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JUNHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JUNHTLAVG1
END
-RUN

TABLE FILE JUNHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS JUNYTDAVG
END
-RUN

TABLE FILE JUNYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS JUNYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JUNYTDAVG1
END
-RUN
 
TABLE FILE JUNHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS JUNSTAY
END
-RUN

TABLE FILE JUNSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JUNSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JUNSTAY1
END
-RUN

TABLE FILE JUNHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS JUNSTAYYTD 
END
-RUN

TABLE FILE JUNSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JUNSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JUNSTAYYTD1
END
-RUN

TABLE FILE JUNHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS JUNROOMS
END
-RUN

TABLE FILE JUNROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JUNROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JUNROOMS1
END
-RUN

TABLE FILE JUNHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS JUNROOMYTD
END
-RUN

TABLE FILE JUNROOMYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JUNROOMYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNROOMYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JUNROOMYTD1
END
-RUN

-JUL

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'JUL'
ON TABLE HOLD AS JULHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO AUG;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;

BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL'
ON TABLE HOLD AS JULHTLYTD
END
-RUN

DEFINE FILE JULHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE JULHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JULTOTHTL
END
-RUN

TABLE FILE JULTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JULTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JULTOTHTL1
END
-RUN

DEFINE FILE JULHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE JULHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JULYTDHTL
END
-RUN

TABLE FILE JULYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS JULYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JULYTDHTL1
END
-RUN

TABLE FILE JULHTL 
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS JULHTLAVG
END
-RUN

TABLE FILE JULHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JULHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JULHTLAVG1
END
-RUN

TABLE FILE JULHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS JULYTDAVG
END
-RUN

TABLE FILE JULYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS JULYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JULYTDAVG1
END
-RUN

TABLE FILE JULHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS JULSTAY
END
-RUN

TABLE FILE JULSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JULSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JULSTAY1
END
-RUN

TABLE FILE JULHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS JULSTAYYTD 
END
-RUN

TABLE FILE JULSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JULSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JULSTAYYTD1
END
-RUN
 
TABLE FILE JULHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS JULROOMS
END
-RUN

TABLE FILE JULROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JULROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JULROOMS1
END
-RUN

TABLE FILE JULHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS JULROOMSYTD
END
-RUN

TABLE FILE JULROOMSYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JULROOMSYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULROOMSYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JULROOMSYTD1
END
-RUN

-AUG

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'AUG'
ON TABLE HOLD AS AUGHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO SEP;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG'
ON TABLE HOLD AS AUGHTLYTD
END
-RUN

DEFINE FILE AUGHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE AUGHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS AUGTOTHTL
END
-RUN

TABLE FILE AUGTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS AUGTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON AUGTOTHTL1
END
-RUN

DEFINE FILE AUGHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE AUGHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS AUGYTDHTL
END
-RUN

TABLE FILE AUGYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS AUGYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON AUGYTDHTL1
END
-RUN

TABLE FILE AUGHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS AUGHTLAVG
END
-RUN

TABLE FILE AUGHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS AUGHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON AUGHTLAVG1
END
-RUN

TABLE FILE AUGHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS AUGYTDAVG
END
-RUN

TABLE FILE AUGYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS AUGYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON AUGYTDAVG1
END
-RUN
 
TABLE FILE AUGHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS AUGSTAY
END
-RUN

TABLE FILE AUGSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS AUGSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON AUGSTAY1
END
-RUN

TABLE FILE AUGHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS AUGSTAYYTD 
END
-RUN

TABLE FILE AUGSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS AUGSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON AUGSTAYYTD1
END
-RUN
 
TABLE FILE AUGHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS AUGROOMS
END
-RUN

TABLE FILE AUGROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS AUGROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON AUGROOMS1
END
-RUN

TABLE FILE AUGHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS AUGROOMSYTD
END
-RUN

TABLE FILE AUGROOMSYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS AUGROOMSYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGROOMSYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON AUGROOMSYTD1
END
-RUN

-SEP

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'SEP'
ON TABLE HOLD AS SEPHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO OCT;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;

BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP'
ON TABLE HOLD AS SEPHTLYTD
END
-RUN

DEFINE FILE SEPHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE SEPHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS SEPTOTHTL
END
-RUN

TABLE FILE SEPTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS SEPTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SEPTOTHTL1
END
-RUN

DEFINE FILE SEPHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE SEPHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS SEPYTDHTL
END
-RUN

TABLE FILE SEPYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS SEPYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON SEPYTDHTL1
END
-RUN

TABLE FILE SEPHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS SEPHTLAVG
END
-RUN

TABLE FILE SEPHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS SEPHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SEPHTLAVG1
END
-RUN

TABLE FILE SEPHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS SEPYTDAVG
END
-RUN

TABLE FILE SEPYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS SEPYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON SEPYTDAVG1
END
-RUN

TABLE FILE SEPHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS SEPSTAY
END
-RUN

TABLE FILE SEPSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS SEPSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SEPSTAY1
END
-RUN

TABLE FILE SEPHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS SEPSTAYYTD 
END
-RUN

TABLE FILE SEPSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS SEPSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON SEPSTAYYTD1
END
-RUN

TABLE FILE SEPHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS SEPROOMS
END
-RUN

TABLE FILE SEPROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS SEPROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SEPROOMS1
END
-RUN

TABLE FILE SEPHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS SEPROOMSYTD
END
-RUN

TABLE FILE SEPROOMSYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS SEPROOMSYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPROOMSYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON SEPROOMSYTD1
END
-RUN

-OCT 

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'OCT'
ON TABLE HOLD AS OCTHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO NOV;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP' OR 'OCT'
ON TABLE HOLD AS OCTHTLYTD
END
-RUN

DEFINE FILE OCTHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE OCTHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS OCTTOTHTL
END
-RUN

TABLE FILE OCTTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS OCTTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OCTTOTHTL1
END
-RUN

DEFINE FILE OCTHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE OCTHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS OCTYTDHTL
END
-RUN


TABLE FILE OCTYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS OCTYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON OCTYTDHTL1
END
-RUN

TABLE FILE OCTHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS OCTHTLAVG
END
-RUN

TABLE FILE OCTHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS OCTHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OCTHTLAVG1
END
-RUN

TABLE FILE OCTHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS OCTYTDAVG
END
-RUN

TABLE FILE OCTYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS OCTYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON OCTYTDAVG1
END
-RUN
 
TABLE FILE OCTHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS OCTSTAY
END
-RUN

TABLE FILE OCTSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS OCTSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OCTSTAY1
END
-RUN

TABLE FILE OCTHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS OCTSTAYYTD 
END
-RUN

TABLE FILE OCTSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS OCTSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON OCTSTAYYTD1
END
-RUN
 
TABLE FILE OCTHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS OCTROOMS
END
-RUN

TABLE FILE OCTROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS OCTROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OCTROOMS1
END
-RUN

TABLE FILE OCTHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS OCTROOMSYTD
END
-RUN

TABLE FILE OCTROOMSYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS OCTROOMSYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTROOMSYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON OCTROOMSYTD1
END
-RUN

-NOV

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'NOV'
ON TABLE HOLD AS NOVHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO DEC;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;

BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP' OR 'OCT' OR 'NOV'
ON TABLE HOLD AS NOVHTLYTD
END
-RUN

DEFINE FILE NOVHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE NOVHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS NOVTOTHTL
END
-RUN

TABLE FILE NOVTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS NOVTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON NOVTOTHTL1
END
-RUN

DEFINE FILE NOVHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE NOVHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS NOVYTDHTL
END
-RUN

TABLE FILE NOVYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS NOVYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON NOVYTDHTL1
END
-RUN

TABLE FILE NOVHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS NOVHTLAVG
END
-RUN

TABLE FILE NOVHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS NOVHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON NOVHTLAVG1
END
-RUN

TABLE FILE NOVHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS NOVYTDAVG
END
-RUN

TABLE FILE NOVYTDAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS NOVYTDAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVYTDAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON NOVYTDAVG1
END
-RUN
 
TABLE FILE NOVHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS NOVSTAY
END
-RUN

TABLE FILE NOVSTAY
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS NOVSTAY1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVSTAY1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON NOVSTAY1
END
-RUN

TABLE FILE NOVHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS NOVSTAYYTD 
END
-RUN

TABLE FILE NOVSTAYYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS NOVSTAYYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVSTAYYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON NOVSTAYYTD1
END
-RUN
 
TABLE FILE NOVHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS NOVROOMS
END
-RUN

TABLE FILE NOVROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS NOVROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON NOVROOMS1
END
-RUN

TABLE FILE NOVHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS NOVROOMSYTD
END
-RUN

TABLE FILE NOVROOMSYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS NOVROOMSYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVROOMSYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON NOVROOMSYTD1
END
-RUN

-DEC

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
BY TRNM
WHERE TRNM EQ 'DEC'
ON TABLE HOLD AS DECHTL
END
-RUN

-IF &LINES EQ 0 THEN GOTO XXITHTL;

TABLE FILE HOLDTHREE
SUM LABEL1
    LABEL2
    LABEL3
    LABEL4
    MROOMS
    YROOMS
    MTTL_AMT
    YTTL_AMT
    MONTHLY
    YTD
    MBOOKINGS
    YBOOKINGS
    LEVEL_DESC
    TRNM
    TRNY
    LEVEL_DESC 
    MONTHLY
    YTD
    CMN_YR
    PMN_YR
COMPUTE MAVGAMT/P12 = IF (MTTL_AMT LT 0) AND (MROOMS LT 0) THEN ((MTTL_AMT/MROOMS)*(-1)) ELSE
                      IF ((MROOMS LT 1) AND (MROOMS GT (-1))) THEN 0 ELSE MTTL_AMT/MROOMS;
COMPUTE MAVGSTY/P8 = IF (MROOMS LT 0) AND (MBOOKINGS LT 0) THEN ((MROOMS/MBOOKINGS)*(-1)) ELSE
                     IF ((MBOOKINGS LT 1) AND (MBOOKINGS GT (-1))) THEN 0 ELSE MROOMS/MBOOKINGS; 
COMPUTE YAVGAMT/P12 = IF (YTTL_AMT LT 0) AND (YROOMS LT 0) THEN ((YTTL_AMT/YROOMS)*(-1)) ELSE
                      IF ((YROOMS LT 1) AND (YROOMS GT (-1))) THEN 0 ELSE YTTL_AMT/YROOMS;
COMPUTE YAVGSTY/P8 = IF (YROOMS LT 0) AND (YBOOKINGS LT 0) THEN ((YROOMS/YBOOKINGS)*(-1)) ELSE
                     IF ((YBOOKINGS LT 1) AND (YBOOKINGS GT (-1))) THEN 0 ELSE YROOMS/YBOOKINGS;   
                     
COMPUTE HTLDIFF/P12C= MTTL_AMT - YTTL_AMT;
COMPUTE RATEDIFF/P12C = MAVGAMT - YAVGAMT;
COMPUTE STAYDIFF/P12 = MAVGSTY - YAVGSTY;
COMPUTE ROOMDIFF/P12 = MROOMS - YROOMS;
COMPUTE HTLPCT/D12C = IF MTTL_AMT EQ 0 THEN 0 ELSE (HTLDIFF/YTTL_AMT) * 100;
COMPUTE RATEPCT/D12C = IF MAVGAMT EQ 0 THEN 0 ELSE (RATEDIFF/YAVGAMT) * 100;
COMPUTE STAYPCT/D12C = IF MAVGSTY EQ 0 THEN 0 ELSE 
                       IF YAVGSTY EQ 0 THEN 0 ELSE (STAYDIFF/YAVGSTY) *100;
COMPUTE ROOMPCT/D12C = IF MROOMS EQ 0 THEN 0 ELSE (ROOMDIFF/YROOMS) *100;

BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP' OR 'OCT' OR 'NOV' OR 'DEC'
ON TABLE HOLD AS DECHTLYTD
END
-RUN

DEFINE FILE DECHTL
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE DECHTL
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURMO' AND YTTL_AMT/D12M AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS DECTOTHTL
END
-RUN

TABLE FILE DECTOTHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS DECTOTHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECTOTHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DECTOTHTL1
END
-RUN

DEFINE FILE DECHTLYTD
CATEGORY/A8 = 'HTL';
CAT_ORDER/I2 = 2;
END
TABLE FILE DECHTLYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MTTL_AMT/D12M AS 'CURYR' AND YTTL_AMT/D12M AS 'PRYR' AND
HTLDIFF/D12 AS 'DIFF' AND HTLPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS DECYTDHTL
END
-RUN

TABLE FILE DECYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS DECYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON DECYTDHTL1
END
-RUN

TABLE FILE DECHTL
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURMO' AND YAVGAMT/D12 AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS DECHTLAVG
END
-RUN

TABLE FILE DECHTLAVG
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS DECHTLAVG1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECHTLAVG1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO  TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DECHTLAVG1
END
-RUN

TABLE FILE DECHTLYTD
PRINT CATEGORY/A8 AND LABEL2/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGAMT/D12 AS 'CURYR' AND YAVGAMT/D12M AS 'PRYR' AND
RATEDIFF/D12 AS 'DIFF' AND RATEPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 2;   
ON TABLE HOLD AS DECYTDHTL
END
-RUN

TABLE FILE DECYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS DECYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON DECYTDHTL1
END
-RUN
 
TABLE FILE DECHTL
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURMO' AND YAVGSTY/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS DECYTDHTL
END
-RUN

TABLE FILE DECYTDHTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS DECYTDHTL1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECYTDHTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DECYTDHTL1
END
-RUN

TABLE FILE DECHTLYTD
PRINT CATEGORY/A8 AND LABEL3/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MAVGSTY/D12  AS 'CURYR' AND YAVGSTY/D12 AS 
'PRYR' AND STAYDIFF/D12 AS 'DIFF' AND STAYPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 3;   
ON TABLE HOLD AS DECYTDHTLYTD 
END
-RUN

TABLE FILE DECYTDHTLYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS DECYTDHTLYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECYTDHTLYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON DECYTDHTLYTD1
END
-RUN
 
TABLE FILE DECHTL
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURMO' AND YROOMS/D12 AS 
'PRMO' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS DECROOMS
END
-RUN

TABLE FILE DECROOMS
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS DECROOMS1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECROOMS1
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DECROOMS1
END
-RUN

TABLE FILE DECHTLYTD
PRINT CATEGORY/A8 AND LABEL4/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND MROOMS/D12  AS 'CURYR' AND YROOMS/D12 AS 
'PRYR' AND ROOMDIFF/D12 AS 'DIFF' AND ROOMPCT/D12 AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 4;   
ON TABLE HOLD AS DECROOMSYTD
END
-RUN

TABLE FILE DECROOMSYTD
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS DECROOMSYTD1
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECROOMSYTD1
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON DECROOMSYTD1
END
-RUN
-GOTO XXIT

 

-CHECK1
-SET &FMY=EDIT(&&FROMDT,'$9999');
-SET &TXOY=EDIT(&&TXDATE,'$9999'); 

-SET &CURMY = 'JAN' || '&FMY.EVAL';
-SET &PRMY  = 'JAN' || '&TXOY.EVAL';
-SET &CURMY1 = '&CURMY.EVAL' |',' | 'CUMULATIVE'; 
-SET &PRMY1 = '&PRMY.EVAL' |',' | 'CUMULATIVE'; 




DEFINE FILE BBCM
KEY/A1 = IF BBCM.TRANM EQ 'JAN' THEN 'A' ELSE
         IF BBCM.TRANM EQ 'FEB' THEN 'B' ELSE
         IF BBCM.TRANM EQ 'MAR' THEN 'C' ELSE
         IF BBCM.TRANM EQ 'APR' THEN 'D' ELSE
         IF BBCM.TRANM EQ 'MAY' THEN 'E' ELSE 
         IF BBCM.TRANM EQ 'JUN' THEN 'F' ELSE   
         IF BBCM.TRANM EQ 'JUL' THEN 'G' ELSE
         IF BBCM.TRANM EQ 'AUG' THEN 'H' ELSE
         IF BBCM.TRANM EQ 'SEP' THEN 'I' ELSE
         IF BBCM.TRANM EQ 'OCT' THEN 'J' ELSE
         IF BBCM.TRANM EQ 'NOV' THEN 'K' ELSE
         IF BBCM.TRANM EQ 'DEC' THEN 'L' ELSE 'M';
         
END         
         
         

         
TABLE FILE BBCM
 
PRINT BBCM.TRANM AS 'TRAN MONTH'
      BBCM.ROW_LABEL AS 'AIR'
      BBCM.CURMO  AS  '&CURMY.EVAL'
      BBCM.PRMO AS '&PRMY.EVAL'
      BBCM.CURYR AS '&CURMY1.EVAL' 
      BBCM.PRYR AS  '&PRMY1.EVAL' 
      BBCM.DIFF AS 'DIFFERENCE'
      BBCM.IDPERCENT AS '% INC./,DECREASE'
BY KEY NOPRINT       
BY BBCM.CAT_ORDER NOPRINT
BY BBCM.CATEGORY NOPRINT 
BY BBCM.ROW_ORDER NOPRINT
ON BBCM.CATEGORY SKIP-LINE

END
-RUN
-QUIT
-XXIT
-XXITHTL