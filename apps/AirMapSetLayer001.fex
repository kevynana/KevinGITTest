-**********************************************************************************************
-* AirMapSetLayer001.fex
-*
-* calls AirMapGetOrigins.fex to get the list of origin airport codes in file FORGAPC.ftm
-* calls AirMapGetDestinations.fex to get the list of destination airport codes in file FDSTAPC.ftm
-* calls AirMapGetConnections.fex to get the list of connection airport codes in file FCONNAPC.ftm
-* 
-* AIRPORT_CODE/A4 
-**********************************************************************************************
-INCLUDE SETECHO
-INCLUDE AirMapSetupReportData
-RUN

SET ASNAMES = ON
-SET HOLDATTR = ON;
-*-DEFAULT &ORG = 'OMA';
-*-DEFAULT &DST = 'FLL';

-DEFAULT &ORG = '';
-DEFAULT &DST = 'ORD';

-SET &WhatOrgApc = IF '&ORG.EVAL' EQ '' THEN '' ELSE 'WHERE ORG_APC EQ ''&ORG.EVAL'''; 
-SET &WhatDstApc = IF '&DST.EVAL' EQ '' THEN '' ELSE 'WHERE FNL_DEST_AIRPORT EQ ''&DST.EVAL'''; 

-INCLUDE AirMapGetOrigins
-RUN

-INCLUDE AirMapGetDestinations
-RUN

-INCLUDE AirMapGetConnections
-RUN

FILEDEF FINALAPC DISK FINALAPC.ftm
DEFINE FILE DIM_AIRPORT
  LATITUDE/P20.7 = EDIT(AIRPORT_LATITUDE);
  LONGITUDE/P20.7 = EDIT(AIRPORT_LONGITUDE);
  AP_TYPE/I1 = 1;
END
TABLE FILE DIM_AIRPORT
PRINT AP_TYPE AIRPORT_CODE AIRPORT_NAME
BY LATITUDE
BY LONGITUDE
WHERE AIRPORT_CODE IN FILE FORGAPC
ON TABLE HOLD AS 'FINALAPC'
END
-RUN

FILEDEF FINALAPC DISK FINALAPC.ftm (APPEND
DEFINE FILE DIM_AIRPORT
  LATITUDE/P20.7 = EDIT(AIRPORT_LATITUDE);
  LONGITUDE/P20.7 = EDIT(AIRPORT_LONGITUDE);
  AP_TYPE/I1 = 2;
END
TABLE FILE DIM_AIRPORT
PRINT AP_TYPE AIRPORT_CODE AIRPORT_NAME
BY LATITUDE
BY LONGITUDE
WHERE AIRPORT_CODE IN FILE FDSTAPC
ON TABLE HOLD AS 'FINALAPC'
END
-RUN

FILEDEF FINALAPC DISK FINALAPC.ftm (APPEND
DEFINE FILE DIM_AIRPORT
  LATITUDE/P20.7 = EDIT(AIRPORT_LATITUDE);
  LONGITUDE/P20.7 = EDIT(AIRPORT_LONGITUDE);
  AP_TYPE/I1 = 3;
END
TABLE FILE DIM_AIRPORT
PRINT AP_TYPE AIRPORT_CODE AIRPORT_NAME
BY LATITUDE
BY LONGITUDE
WHERE AIRPORT_CODE IN FILE FCONNAPC
ON TABLE HOLD AS 'FINALAPC'
END
-RUN


TABLE FILE FINALAPC
PRINT AIRPORT_CODE

     COMPUTE MARKER/A15 = DECODE AP_TYPE(1 'redpin' 2  'purplepin' 3 'bluepin');
     COMPUTE MARKER_IMAGE/A20 = MARKER || '.png';
     COMPUTE AP_TIPS/A30 = AIRPORT_NAME;
BY LATITUDE
BY LONGITUDE
-*WHERE AIRPORT_COUNTRY EQ 'US'
-*WHERE RECORDLIMIT EQ 200
HEADING
""
FOOTING
""
ON TABLE SET PAGE-NUM OFF
ON TABLE NOTOTAL
ON TABLE PCHOLD FORMAT XML
ON TABLE SET HTMLCSS ON
ON TABLE SET STYLE *
     UNITS=IN,
     SQUEEZE=ON,
     ORIENTATION=PORTRAIT,
$
TYPE=REPORT,
     GRID=OFF,
     FONT='ARIAL',
     SIZE=9,
$
TYPE=TITLE,
     STYLE=BOLD,
$
TYPE=TABHEADING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=TABFOOTING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=HEADING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=FOOTING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=SUBHEAD,
     SIZE=10,
     STYLE=BOLD,
$
TYPE=SUBFOOT,
     SIZE=10,
     STYLE=BOLD,
$
TYPE=SUBTOTAL,
     BACKCOLOR=RGB(210 210 210),
$
TYPE=ACROSSVALUE,
     SIZE=9,
$
TYPE=ACROSSTITLE,
     STYLE=BOLD,
$
TYPE=GRANDTOTAL,
     BACKCOLOR=RGB(210 210 210),
     STYLE=BOLD,
$
ENDSTYLE
END
-RUN

-********************+++++++++++++++++++++++++++++++++++++++++++++
-EXIT

DEFINE FILE DIM_AIRPORT
  LATITUDE/P20.7 = EDIT(AIRPORT_LATITUDE);
  LONGITUDE/P20.7 = EDIT(AIRPORT_LONGITUDE);
END
TABLE FILE DIM_AIRPORT
SUM
     'DIM_AIRPORT.DIM_AIRPORT.AIRPORT_CODE'
     COMPUTE AP_TYPE/I1 = IF AIRPORT_CODE IN FILE FORGAPC THEN 1
				ELSE IF AIRPORT_CODE IN FILE FDSTAPC THEN 2 
				ELSE IF AIRPORT_CODE IN FILE FCONNAPC THEN 3 
				ELSE 0;
     COMPUTE MARKER/A15 = DECODE AP_TYPE(1 'redpin' 2  'purplepin' 3 'bluepin');
     COMPUTE MARKER_IMAGE/A20 = MARKER || '.png';
     COMPUTE AP_TIPS/A30 = AIRPORT_NAME;
BY MARKER_IMAGE
BY LATITUDE
BY LONGITUDE
-*WHERE AIRPORT_COUNTRY EQ 'US'
-*WHERE RECORDLIMIT EQ 200
HEADING
""
FOOTING
""
ON TABLE SET PAGE-NUM OFF
ON TABLE NOTOTAL
-*ON TABLE PCHOLD FORMAT XML
ON TABLE SET HTMLCSS ON
ON TABLE SET STYLE *
     UNITS=IN,
     SQUEEZE=ON,
     ORIENTATION=PORTRAIT,
$
TYPE=REPORT,
     GRID=OFF,
     FONT='ARIAL',
     SIZE=9,
$
TYPE=TITLE,
     STYLE=BOLD,
$
TYPE=TABHEADING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=TABFOOTING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=HEADING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=FOOTING,
     SIZE=12,
     STYLE=BOLD,
$
TYPE=SUBHEAD,
     SIZE=10,
     STYLE=BOLD,
$
TYPE=SUBFOOT,
     SIZE=10,
     STYLE=BOLD,
$
TYPE=SUBTOTAL,
     BACKCOLOR=RGB(210 210 210),
$
TYPE=ACROSSVALUE,
     SIZE=9,
$
TYPE=ACROSSTITLE,
     STYLE=BOLD,
$
TYPE=GRANDTOTAL,
     BACKCOLOR=RGB(210 210 210),
     STYLE=BOLD,
$
ENDSTYLE
END
