
SET ASNAMES=ON

USE CLEAR *
USE
    D:\TNT\TTRACKER\SUDATA\ROLLUP.FOC
END


TABLE FILE ROLLUP
PRINT ROLLUP
BY ROLLUP NOPRINT
WHERE LOAD_GRP EQ 'V' 
-* WHERE ROLLUP_CODE EQ 'CH2M-R' 
ON TABLE HOLD
END

MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH COMPUTE PR_STAMP='X';
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-SET &CNT=0;

-TOP
TABLE FILE ROLLUP
PRINT ROLLUP COMP 
BY ROLLUP_CODE NOPRINT
IF RECORDLIMIT EQ 1
IF PR_STAMP EQ 'X'
ON TABLE SAVE AS CUSTS
END
-RUN


-READ CUSTS &&ROLLUP.A8 &&COMP.A6
-RUN

-IF &RECORDS EQ 0 THEN GOTO STOP;
-RUN

-SET &&FOCANAME = 'A4'||&&COMP;
-SET &&FOCCNAME = 'C4'||&&COMP;
-SET &&FOCDNAME = 'D4'||&&COMP;
-SET &&FOCHNAME = 'H4'||&&COMP;
-SET &&FOCMNAME = 'M4'||&&COMP;
-SET &&FOCSNAME = 'S4'||&&COMP;
-SET &&FOCTNAME = 'T4'||&&COMP;

TABLE FILE &&FOCANAME
SUM AIR_KEY 
BY AIR_KEY
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCANAME
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE &&FOCCNAME
SUM CAR_KEY 
BY CAR_KEY
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCCNAME
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE &&FOCHNAME
SUM HTL_KEY 
BY HTL_KEY
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCHNAME
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE &&FOCDNAME
SUM AIR_KEY
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCDNAME
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE &&FOCMNAME
SUM AIR_KEY
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCMNAME
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE &&FOCSNAME
SUM AIR_KEY
BY AIR_KEY
BY EMBARK
BY ROUTE
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCSNAME
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE &&FOCTNAME
SUM AIR_KEY
BY AIR_KEY
ON TABLE HOLD
END
-RUN

MODIFY FILE &&FOCTNAME
FIXFORM FROM HOLD
MATCH AIR_KEY 
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN



TABLE FILE ROLLUP
PRINT ROLLUP PR_STAMP
IF ROLLUP EQ '&&ROLLUP'
ON TABLE HOLD
END
-RUN


MODIFY FILE ROLLUP
FIXFORM FROM HOLD
MATCH ROLLUP
ON MATCH COMPUTE PR_STAMP=' ';
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN


-GOTO TOP
-RUN
-*======================================================================
-STOP

-XFER
-TYPE PROGRAM COMPLETED.......
-EXIT

-XXIT
-EXIT



