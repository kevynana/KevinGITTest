-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File EXECHTL1.FEX
-*************************************************************************
-*DATE          NAME            DESCRIPTION
-* 3/07/01   TANDT-SS           CHANGE ALL NUMERIC FORMATS FROM P (PACKED) TO
-*                              D (FLOATING-POINT DOUBLE PRECISION) TO PROVIDE
-*                              CONSISTENCY IN ROUNDING AND PERCENTAGES.
-*************************************************************************


DEFINE FILE &&EXTRACT
INTL_DOM/A1 =IF (CITY.COUNTRY_CODE EQ 'US' OR ' ') THEN 'D' ELSE 'I';
 CM/A1 = IF INVOICE_DATE GE &&CMFMDT.EVAL AND 
INVOICE_DATE LE &&CMTODT.EVAL THEN 'Y' ELSE 'N';
 CY/A1 = IF INVOICE_DATE GE &&CYFMDT.EVAL AND 
INVOICE_DATE LE &&CYTODT.EVAL THEN 'Y' ELSE 'N';
 PM/A1 = IF INVOICE_DATE GE &&PMFMDT.EVAL AND 
INVOICE_DATE LE &&PMTODT.EVAL THEN 'Y' ELSE 'N';
 PY/A1 = IF INVOICE_DATE GE &&PYFMDT.EVAL AND 
INVOICE_DATE LE &&PYTODT.EVAL THEN 'Y' ELSE 'N';
0440_RUF/A1 = IF LEVEL1 EQ '0440RUFFALO' THEN 'Y' ELSE
              IF LEVEL2 EQ '0015010100000' OR '0042022600000' OR
              '0015050000000' OR '0015010100000' OR '0015010000000' OR
              '0015062000000' OR '0015022000000' OR '0015010100000' OR
              '0013025300000' OR '0015044000000' OR '0015017900000' OR
              '0015017900000' OR '0010062200000' OR '0015010000000' OR
              '0015044000000' OR '0021044000000' OR '0015062000000' OR
              '0015010600000' OR '0032022500000' OR '0015012100000' OR
              '0014025200000' OR '0017044000000' OR '0005044000000' OR
              '0042022700000' OR '2402240000000' OR '0033044000000' 
              THEN 'Y' ELSE 'N';


-*DOMESTIC PERIOD
-* CURRENT HOTEL AMOUNT DOMESTIC CALCULATION
      CDM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS DOMESTIC CALCULATION
      CDM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS DOMESTIC CALCULATION
      CDM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*INT'L PERIOD
-* CURRENT HOTEL AMOUNT INT'L CALCULATION
      CIM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS INT'L CALCULATION
      CIM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS INT'L CALCULATION
      CIM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*DOMESTIC PERIOD
-* PRIOR HOTEL AMOUNT DOMESTIC CALCULATION
      PDM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;
-* PRIOR HOTEL DAYS DOMESTIC CALCULATION
      PDM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR HOTEL ROOMS DOMESTIC CALCULATION
      PDM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*INT'L PERIOD
-* PRIOR HOTEL AMOUNT INT'L CALCULATION
      PIM1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* PRIOR HOTEL DAYS INT'L CALCULATION
      PIM1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR HOTEL ROOMS INT'L CALCULATION
      PIM1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PM EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*DOMESTIC YTD 
-* CURRENT HOTEL AMOUNT DOMESTIC CALCULATION
      CDY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS DOMESTIC CALCULATION
      CDY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS DOMESTIC CALCULATION
      CDY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*INT'L YTD
-* CURRENT HOTEL AMOUNT INT'L CALCULATION
      CIY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* CURRENT HOTEL DAYS INT'L CALCULATION
      CIY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* CURRENT HOTEL ROOMS INT'L CALCULATION
      CIY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (CY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;


-*DOMESTIC YTD
-* PRIOR HOTEL AMOUNT DOMESTIC CALCULATION
      PDY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;
-* PRIOR HOTEL DAYS DOMESTIC CALCULATION
      PDY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;
-* PRIOR HOTEL ROOMS DOMESTIC CALCULATION
      PDY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'D')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-*INT'L YTD
-* PRIOR HOTEL AMOUNT INT'L CALCULATION
      PIY1HTL_AMT/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.TOTAL_AMT
                      ELSE 0;

-* PRIOR HOTEL DAYS INT'L CALCULATION
      PIY1HTL_DAY/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_DAYS * HTL_MAIN.NUM_ROOMS
                      ELSE 0;

-* PRIOR HOTEL ROOMS INT'L CALCULATION
      PIY1HTL_RMS/D12.2 = IF ((INTL_DOM IS 'I')
                      AND (PY EQ 'Y'))       
                      THEN HTL_MAIN.NUM_ROOMS
                      ELSE 0;
END
-RUN

TABLEF FILE &&EXTRACT
SUM
CDM1HTL_AMT/D10 CDM1HTL_DAY/D10 CDM1HTL_RMS/D10 
CIM1HTL_AMT/D10 CIM1HTL_DAY/D10 CIM1HTL_RMS/D10
PDM1HTL_AMT/D10 PDM1HTL_DAY/D10 PDM1HTL_RMS/D10 
PIM1HTL_AMT/D10 PIM1HTL_DAY/D10 PIM1HTL_RMS/D10
CDY1HTL_AMT/D10 CDY1HTL_DAY/D10 CDY1HTL_RMS/D10 
CIY1HTL_AMT/D10 CIY1HTL_DAY/D10 CIY1HTL_RMS/D10
PDY1HTL_AMT/D10 PDY1HTL_DAY/D10 PDY1HTL_RMS/D10 
PIY1HTL_AMT/D10 PIY1HTL_DAY/D10 PIY1HTL_RMS/D10
AND COMPUTE 
CDM1AVG_RATE/D10=CDM1HTL_AMT/CDM1HTL_DAY;
CIM1AVG_RATE/D10=CIM1HTL_AMT/CIM1HTL_DAY;
PDM1AVG_RATE/D10=PDM1HTL_AMT/PDM1HTL_DAY;
PIM1AVG_RATE/D10=PIM1HTL_AMT/PIM1HTL_DAY;
CDY1AVG_RATE/D10=CDY1HTL_AMT/CDY1HTL_DAY;
CIY1AVG_RATE/D10=CIY1HTL_AMT/CIY1HTL_DAY;
PDY1AVG_RATE/D10=PDY1HTL_AMT/PDY1HTL_DAY;
PIY1AVG_RATE/D10=PIY1HTL_AMT/PIY1HTL_DAY;
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
&&WHERE11
&&WHERE12
&&WHERE13
&&WHERE14
&&WHERE15
&&WHERE16
&&WHERE17
&&WHERE18
&&WHERE19
&&WHERE20
&&WHERE21
&&WHERE22
&&WHERE23
&&WHERE24
&&WHERE25
&&WHERE26
&&WHERE27
&&WHERE28
&&WHERE29
&&WHERE30
&&WHERE31
&&WHERE32
&&WHERE33
&&WHERE34
&&WHERE35
&&WHERE36
&&WHERE37
&&WHERE38
&&WHERE39
&&WHERE40
&&WHERE41
&&WHERE42
&&WHERE43
&&WHERE44
&&WHERE45
&&WHERE46
&&WHERE47
&&WHERE48
&&WHERE49
&&WHERE50
&&WHERE51
&&WHERE52
&&WHERE53
&&WHERE54
&&WHERE55
&&WHERE56
&&WHERE57
&&WHERE58
&&WHERE59
&&WHERE60
&&WHERE61
&&WHERE62
&&WHERE63
&&WHERE64
&&WHERE65
&&WHERE66
&&WHERE67
&&WHERE68


WHERE (HTL_MAIN.INVOICE_DATE GE &&CYFMDT.EVAL
      AND HTL_MAIN.INVOICE_DATE LE &&CYTODT.EVAL)
 OR (HTL_MAIN.INVOICE_DATE GE &&PYFMDT.EVAL
      AND HTL_MAIN.INVOICE_DATE LE &&PYTODT.EVAL)
 OR (HTL_MAIN.INVOICE_DATE GE &&CMFMDT.EVAL 
      AND HTL_MAIN.INVOICE_DATE LE &&CMTODT.EVAL) 
 OR (HTL_MAIN.INVOICE_DATE GE &&PMFMDT.EVAL 
      AND HTL_MAIN.INVOICE_DATE LE &&PMTODT.EVAL);

-INCLUDE RPTPARMS

ON TABLE HOLD AS HOLD3
END
-RUN

TABLEF FILE HOLD3
PRINT
CDM1HTL_AMT CDM1HTL_DAY CDM1HTL_RMS
CIM1HTL_AMT CIM1HTL_DAY CIM1HTL_RMS
PDM1HTL_AMT PDM1HTL_DAY PDM1HTL_RMS
PIM1HTL_AMT PIM1HTL_DAY PIM1HTL_RMS
CDY1HTL_AMT CDY1HTL_DAY CDY1HTL_RMS
CIY1HTL_AMT CIY1HTL_DAY CIY1HTL_RMS
PDY1HTL_AMT PDY1HTL_DAY PDY1HTL_RMS
PIY1HTL_AMT PIY1HTL_DAY PIY1HTL_RMS
CDM1AVG_RATE
CIM1AVG_RATE
PDM1AVG_RATE
PIM1AVG_RATE
CDY1AVG_RATE
CIY1AVG_RATE
PDY1AVG_RATE
PIY1AVG_RATE
ON TABLE HOLD AS HTLSUMLD
END
-*-EXIT
