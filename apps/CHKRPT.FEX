-INCLUDE SETECHO
-SET &RPTGRP = 'AIR';
-SET &&RPTGRP = 'AIR';
-SET &RIND = 'S';
-SET &RPTSTREAM = 'ADHOCRPT';
-SET &&IKEY = 487287;
-SET &INST_KEY = 487287;
-SET &VIEW = 'AVIEW0';
-SET &WHERE701  = ' ';
-SET &WHERE707 = ' ';
-SET &WHERE708 = ' ';


TABLE FILE RPT_FLDS
PRINT SEG.COMMON1.INCL1 
BY INST_KEY NOPRINT
WHERE INST_KEY EQ 487287
ON TABLE SAVE AS COMMON1
END
-RUN

-SET &COM1A = 0;
-SET &COM1B = 0;
-SET &COM1C = 0;
-SET &CN = 0;
-SET &ST = 0;
-SET &COM1D = 0;
-SET &REG = 0;
-SET &COM5 = 0;
-SET &COM6 = 0;
-SET &COM7 = 0;
-SET &COMEMP = 0;

-IF &LINES EQ 0 THEN GOTO chkRegion;
-READ COMMON1 &COM1A.1. &COM1B.1. &COM1C.1. &CN.1. &ST.1. &COM1D.1. &REG.1. &COM5.1. &COM6.1. &COM7.1. &COMEMP.1.
-CLOSE COMMON1;
-IF &RPTGRP EQ 'EXC' OR &RPTGRP EQ 'OTH' OR &RPTGRP EQ 'OTM' OR &RPTGRP EQ 'QTR' THEN GOTO ChkLevel1;

-*region, country and state selections
-*STATE selection is not available for tkt_main
-chkRegion
TABLE FILE RPT_FLDS
PRINT REGION_CODE COUNTRY_CODE STATE_CODE
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS RCS
END
-RUN
-SET &MAXLEN=124;
-SET &NUMRCS = &LINES;
-IF &LINES EQ 0 THEN GOTO ChkLevel1;

-*-IF '&RIND.EVAL' EQ 'C' OR &RIND EQ 'H' THEN GOTO NoViewList;
-* chenges made for limo reports
-IF &RIND EQ 'H' OR &SETFILE EQ 'ABBNM' OR &SETFILE EQ 'PRAIRDLV' THEN GOTO NoViewList;
TABLE FILE VIEWLIST
PRINT CPFLAG
WHERE RPT_STREAM EQ '&RPTSTREAM.EVAL' AND USE_PARM EQ '&VIEW.EVAL'
ON TABLE SAVE AS CPFLAG
END
-RUN
-IF &LINES EQ 0 THEN GOTO ChkLevel1;
-READ CPFLAG &RIND.1.
-IF '&RIND.EVAL' EQ 'E' THEN GOTO ChkLevel1;  

-NoViewList
-SET &OP1 = IF &CN EQ 1 AND &RPTSTREAM EQ 'ADHOCRPT'  THEN ' CONTAINS ' 
- ELSE IF &CN EQ 1 AND &RIND NE 'T' THEN ' EQ ' 
- ELSE IF &CN EQ 2 AND &RPTSTREAM EQ 'ADHOCRPT' THEN ' OMITS ' 
- ELSE IF &CN EQ 2 AND &RIND NE 'T' THEN ' NE ' 
- ELSE IF &CN EQ 1 THEN ' CONTAINS ' ELSE IF &CN EQ 2 THEN ' OMITS ' ELSE '';

-SET &OP2 = IF &ST EQ 1 AND &RPTSTREAM EQ 'ADHOCRPT' THEN ' CONTAINS ' 
- ELSE IF &ST EQ 1 AND &RIND NE 'T' THEN ' EQ ' 
- ELSE IF &ST EQ 2 AND &RPTSTREAM EQ 'ADHOCRPT' THEN ' OMITS '
- ELSE IF &ST EQ 2 AND &RIND NE 'T' THEN ' NE ' 
- ELSE IF &ST EQ 1 THEN ' CONTAINS ' ELSE IF &ST EQ 2 THEN ' OMITS ' ELSE '';

-SET &OPGEO= IF &REG EQ 1 AND &RPTSTREAM EQ 'ADHOCRPT' THEN ' CONTAINS ' 
- ELSE IF &REG EQ 1 AND &RIND NE 'T' THEN ' EQ ' 
- ELSE IF &REG EQ 2 AND &RPTSTREAM EQ 'ADHOCRPT' THEN ' OMITS ' 
- ELSE IF &REG EQ 2 AND &RIND NE 'T' THEN ' NE ' 
- ELSE IF &REG EQ 1 THEN ' CONTAINS ' ELSE IF &REG EQ 2 THEN ' OMITS ' ELSE '';

-SET &CNT = 1;
-REPEAT ENDRCS &NUMRCS TIMES
-READ RCS NOCLOSE &RC.3. &CC.3. &SC.2.  

-*WHERE701 - REGION CODE

-SET &WHERE701 = IF &CNT EQ 1 AND &RC EQ ' ' AND &CC EQ ' ' THEN ''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'C' OR &CNT EQ 1 AND &&RPTGRP EQ 'CAR' THEN 'WHERE PICK_CTY.GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'H' OR &CNT EQ 1 AND &&RPTGRP EQ 'HTL' THEN 'WHERE CITY.GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'S' AND &SETFILE EQ 'ABCNTRY' THEN 'WHERE  RTE_APT.GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'S' AND &SETFILE EQ 'CONGCNTY' THEN 'WHERE  RTE_APT.GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'S' AND &RPTSTREAM  NE 'ADHOCRPT' THEN 'WHERE EMB_APT.GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'T' AND &SETFILE EQ 'CHTRIPI' OR 'ABCNTFST' THEN 'WHERE  TKT_MAIN.FST_DEST_GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'T' AND &SETFILE EQ 'ABCNTFNL' THEN 'WHERE  TKT_MAIN.FNL_DEST_GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND (&RIND EQ 'T' OR &RPTSTREAM  EQ 'ADHOCRPT') THEN 'WHERE TKT_MAIN.GEO_ZONE' | '&OPGEO.EVAL' | '''&RC.EVAL'''
- ELSE IF &RC NE ' ' THEN &WHERE701 | ' OR ' | '''' || &RC || ''''
- ELSE &WHERE701;

-SET &LEN=ARGLEN(3, &CC, 'I1');
-IF &LEN EQ 0 THEN GOTO CHKSTATECODE;
-SET &CC = SUBSTR(3, &CC, 1, &LEN, &LEN, 'A&LEN.EVAL');
-SET &LEN = ARGLEN(130, &WHERE703, 'I3');
-SET &WHERE703 = IF &CNT EQ 1 AND &CC EQ ' ' THEN ''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'C' OR &CNT EQ 1 AND &&RPTGRP EQ 'CAR' THEN 'WHERE PICK_CTY.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'H' OR &CNT EQ 1 AND &&RPTGRP EQ 'HTL' THEN 'WHERE CITY.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'S' AND &SETFILE EQ 'ABCNTRY' THEN 'WHERE RTE_APT.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'S' AND &SETFILE EQ 'CONGCNTY' THEN 'WHERE RTE_APT.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'S' AND &RPTSTREAM  NE 'ADHOCRPT' THEN 'WHERE EMB_APT.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'T' AND &SETFILE EQ 'CHTRIPI' OR 'ABCNTFST' THEN 'WHERE TKT_MAIN.FST_DEST_CNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'T' AND &SETFILE EQ 'ABCNTFNL' THEN 'WHERE TKT_MAIN.FNL_DEST_CNTY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND (&RIND EQ 'T' OR &RPTSTREAM  EQ 'ADHOCRPT') THEN 'WHERE TKT_MAIN.CTRY_COD' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CC NE ' ' AND &LEN LT &MAXLEN THEN &WHERE703 || ' OR ' | '''' || &CC || ''''
- ELSE &WHERE703;

-SET &WHERE704 = IF &LEN GE &MAXLEN AND &CC NE '' THEN &WHERE704 || ' OR ' | '''' || &CC || '''' ELSE &WHERE704;

-CHKSTATECODE
-*State selection does not apply to TKT_MAIN as we don't have state data in TKT_MAIN.
-IF &RIND EQ 'T' THEN GOTO RCSINCREMENT;
-SET &LEN = ARGLEN(130, &WHERE707, 'I3');
-SET &WHERE707 = IF &CNT EQ 1 AND &SC EQ ' ' THEN ''
- ELSE IF &CNT EQ 1 AND &SC NE ' ' AND &RIND EQ 'C' THEN 'WHERE PICK_CTY.STATE_CODE' | '&OP2.EVAL' | '''&SC.EVAL'''
- ELSE IF &CNT EQ 1 AND &SC NE ' ' AND &RIND EQ 'H' THEN 'WHERE CITY.STATE_CODE' | '&OP2.EVAL' | '''&SC.EVAL'''
- ELSE IF &CNT EQ 1 AND &SC NE ' ' AND &RIND EQ 'S' AND &RPTSTREAM  NE 'ADHOCRPT' THEN 'WHERE EMB_APT.STATE_CODE' | '&OP2.EVAL' | '''&SC.EVAL'''
- ELSE IF &CNT EQ 1 AND &SC NE ' ' AND &RPTSTREAM  EQ 'ADHOCRPT' THEN 'WHERE TKT_MAIN.STATE_CODES' | '&OP2.EVAL' | '''&SC.EVAL'''
- ELSE IF &SC NE ' ' AND &LEN LT &MAXLEN THEN &WHERE707 || ' OR ' | '''' || &SC || ''''
- ELSE &WHERE707;

-SET &WHERE708 = IF &LEN GE &MAXLEN AND &SC NE '' THEN &WHERE708 || ' OR ' | '''' || &SC || '''' ELSE &WHERE708;

-RCSINCREMENT
-SET &CNT = &CNT + 1;
-ENDRCS
-CLOSE RCS

-************************************************************************************************
-*SECOND LOOP TO concatinate with RTE_APT.GEO_ZONE or RTE_APT.COUNTRY_CODE or RTE_APT.STATE_CODE
-*FOR CITY_PAIR REPORTS.      01/22/2007
-************************************************************************************************
-IF &RPTSTREAM  EQ 'ADHOCRPT' OR &RPTSTREAM  EQ 'LIM_PLCY'   THEN GOTO ENDRCS22;
-IF &RIND EQ 'H' OR &RIND EQ 'T' THEN GOTO ENDRCS22;
-****************************************************************
-* 03/03/09 Include: use OR; Exclude: use AND
-****************************************************************
-SET &CNOP = IF &CN EQ 1 THEN ' OR ' ELSE ' AND ';
-SET &STOP = IF &ST EQ 1 THEN ' OR ' ELSE ' AND ';

-SET &CNT = 1;
-REPEAT ENDRCS2 &NUMRCS TIMES
-READ RCS NOCLOSE &RC.3. &CC.3. &SC.2.  

-* Steve - uncommented 11/07/2011 - METX-R request for ASA and JP (only getting EMBARK GEO_ZONE of ASA not ROUTE 
-*WHERE702 - REGION CODE
-SET &WHERE702 = IF &CNT EQ 1 AND &RC EQ ' ' THEN ''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'S' THEN ' OR RTE_APT.GEO_ZONE EQ ' | '''&RC.EVAL'''
- ELSE IF &CNT EQ 1 AND &RC NE ' ' AND &RIND EQ 'C' THEN ' OR DROP_CTY.GEO_ZONE EQ ' | '''&RC.EVAL'''
- ELSE IF &RC NE ' ' THEN &WHERE702 | ' OR ' | '''' || &RC || ''''
- ELSE &WHERE702;

-SET &LEN = ARGLEN(130, &WHERE705, 'I3');
-SET &WHERE705 = IF &CNT EQ 1 AND &CC EQ ' ' THEN ''
- ELSE IF &RIND EQ 'S' AND &SETFILE EQ 'ABCNTRY' THEN ' '
- ELSE IF &RIND EQ 'S' AND &SETFILE EQ 'CONGCNTY' THEN ' '
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'S' THEN '&CNOP.EVAL' | 'RTE_APT.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CNT EQ 1 AND &CC NE ' ' AND &RIND EQ 'C' THEN '&CNOP.EVAL' | 'DROP_CTY.COUNTRY_CODE' | '&OP1.EVAL' | '''&CC.EVAL'''
- ELSE IF &CC NE ' ' AND &LEN LT &MAXLEN THEN &WHERE705 || ' OR ' | '''' || &CC || ''''
- ELSE &WHERE705;

-SET &WHERE706 = IF &LEN GE &MAXLEN AND &CC NE '' THEN &WHERE706 || ' OR ' | '''' || &CC || '''' ELSE &WHERE706;

-SET &LEN = ARGLEN(130, &WHERE709, 'I3');
-SET &WHERE709 = IF &CNT EQ 1 AND &SC EQ ' ' THEN ''
- ELSE IF &CNT EQ 1 AND &SC NE ' ' AND &RIND EQ 'S' THEN '&STOP.EVAL' | 'RTE_APT.STATE_CODE' | '&OP2.EVAL' | '''&SC.EVAL'''
- ELSE IF &CNT EQ 1 AND &SC NE ' ' AND &RIND EQ 'C' THEN '&STOP.EVAL' | 'DROP_CTY.STATE_CODE' | '&OP2.EVAL' | '''&SC.EVAL'''
- ELSE IF &SC NE ' ' AND &LEN LT &MAXLEN THEN &WHERE709 || ' OR ' | '''' || &SC || ''''
- ELSE &WHERE709;
-SET &WHERE710 = IF &LEN GE &MAXLEN AND &SC NE '' THEN &WHERE710 || ' OR ' | '''' || &SC || '''' ELSE &WHERE710;

-SET &CNT = &CNT + 1;
-ENDRCS2
-CLOSE RCS
-ENDRCS22
-**************************The end of second loop *************************************************

-***********
-ChkLevel1
-***********
-IF &COM1A EQ 0 THEN GOTO ChkLevel2;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL1
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL1 NE ' '
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkLevel2;
-SET &CNT = 1;
-SET &WHERE500 = IF &COM1A EQ 1  THEN 'WHERE LEVEL1 EQ '
- ELSE IF &COM1A EQ 2  THEN 'WHERE LEVEL1 NE '
-   ELSE IF &COM1A EQ 3 THEN 'WHERE LEVEL1 CONTAINS '
-   ELSE IF &COM1A EQ 4 THEN 'WHERE LEVEL1 OMITS '
- ELSE ' ';

-REPEAT TOEND1A &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A15. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(17, &V3, 'I2');
-SET &V1 = SUBSTR(17, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');
 
-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl501;
-IF &CNT GE 51  THEN GOTO Lbl502;

-SET &OP = IF &COM1A EQ 1 OR &COM1A EQ 3 OR &COM1A EQ 4 THEN ' OR ' ELSE ' AND LEVEL1 NE ';

-SET &WHERE500 = IF &CNT EQ &LINES THEN &WHERE500 | &V1 
-   ELSE &WHERE500 | &V1 | '&OP.EVAL';

-GOTO Increment1A
-***********
-Lbl501
-***********
-SET &WHERE501 = IF &WHERE500 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE501 | &V1 
-    ELSE &WHERE501 | &V1 | '&OP.EVAL';

-GOTO Increment1A
-***********
-Lbl502
-***********
-SET &WHERE502 = IF &WHERE500 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE502 | &V1 
-    ELSE &WHERE502 | &V1 | '&OP.EVAL';

-Increment1A
-SET &CNT = &CNT + 1;

-TOEND1A
-CLOSE COMMON2
-RUN

-***********
-ChkLevel2
-***********
-IF &COM1B EQ 0 THEN GOTO ChkLevel3;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL2
WHERE INST_KEY EQ &INST_KEY
WHERE COMMON2.ID_LEVEL2 NE ' '
BY INST_KEY NOPRINT
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkLevel3;
-SET &CNT = 1;

-SET &WHERE505 = IF &COM1B EQ 1  THEN 'WHERE LEVEL2 EQ '
- ELSE IF &COM1B EQ 2  THEN 'WHERE LEVEL2 NE '
-   ELSE IF &COM1B EQ 3 THEN 'WHERE LEVEL2 CONTAINS '
-   ELSE IF &COM1B EQ 4 THEN 'WHERE LEVEL2 OMITS '
-  ELSE ' ';

-REPEAT TOEND1B &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A15. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(17, &V3, 'I2');
-SET &V1 = SUBSTR(17, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');

-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl506;
-IF &CNT GE 51  THEN GOTO Lbl507;

-IF &V1 EQ '' THEN GOTO Increment1B;

-SET &OP = IF &COM1B EQ 1 OR &COM1B EQ 3 OR &COM1B EQ 4 THEN ' OR ' ELSE ' AND LEVEL2 NE ';

-SET &WHERE505 = IF &CNT EQ &LINES THEN &WHERE505 | &V1 
-   ELSE &WHERE505 | &V1 | '&OP.EVAL';

-GOTO Increment1B
-***********
-Lbl506
-***********
-SET &WHERE506 = IF &WHERE505 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE506 | &V1 
-    ELSE &WHERE506 | &V1 | '&OP.EVAL';

-GOTO Increment1B
-***********
-Lbl507
-***********
-SET &WHERE507 = IF &WHERE505 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE507 | &V1 
-    ELSE &WHERE507 | &V1 | '&OP.EVAL';

-Increment1B
-SET &CNT = &CNT + 1;

-TOEND1B
-CLOSE COMMON2
-RUN

-***********
-ChkLevel3
-***********
-IF &COM1C EQ 0 THEN GOTO ChkLevel4;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL3
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL3 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkLevel4;
-SET &CNT = 1;
-SET &WHERE510 = IF &COM1C EQ 1  THEN 'WHERE LEVEL3 EQ '
- ELSE IF &COM1C EQ 2  THEN 'WHERE LEVEL3 NE '
-   ELSE IF &COM1C EQ 3 THEN 'WHERE LEVEL3 CONTAINS '
-   ELSE IF &COM1C EQ 4 THEN 'WHERE LEVEL3 OMITS '
- ELSE ' ';

-REPEAT TOEND1C &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A15. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(17, &V3, 'I2');
-SET &V1 = SUBSTR(17, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');

-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl511;
-IF &CNT GE 51  THEN GOTO Lbl512;

-IF &V1 EQ '' THEN GOTO Increment1C;

-SET &OP = IF &COM1C EQ 1 OR &COM1C EQ 3  OR &COM1C EQ 4 THEN ' OR ' ELSE ' AND LEVEL3 NE ';

-SET &WHERE510 = IF &CNT EQ &LINES THEN &WHERE510 | &V1
-   ELSE &WHERE510 | &V1 | '&OP.EVAL';

-GOTO Increment1C
-***********
-Lbl511
-***********
-SET &WHERE511 = IF &WHERE510 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE511 | &V1
-    ELSE &WHERE511 | &V1 | '&OP.EVAL';

-GOTO Increment1C
-***********
-Lbl512
-***********
-SET &WHERE512 = IF &WHERE510 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE512 | &V1 
-    ELSE &WHERE512 | &V1 | '&OP.EVAL';

-Increment1C
-SET &CNT = &CNT + 1;

-TOEND1C
-CLOSE COMMON2
-RUN

-* REJ ****************************************************************************
-***********
-ChkLevel4
-***********
-IF &COM1D EQ 0 THEN GOTO ChkLevel5;
-*-IF &COM1D EQ 0 THEN GOTO ChkViewType;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL4
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL4 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkLevel5;
-SET &CNT = 1;
-SET &WHERE550 = IF &COM1D EQ 1  THEN 'WHERE LEVEL4 EQ '
- ELSE IF &COM1D EQ 2  THEN 'WHERE LEVEL4 NE '
-   ELSE IF &COM1D EQ 3 THEN 'WHERE LEVEL4 CONTAINS '
-   ELSE IF &COM1D EQ 4 THEN 'WHERE LEVEL4 OMITS '
- ELSE ' ';

-REPEAT TOEND1D &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A60. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(62, &V3, 'I2');
-SET &V1 = SUBSTR(62, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');

-IF &CNT GE 10 AND &CNT LE 20 THEN GOTO Lbl551;
-IF &CNT GE 21  THEN GOTO Lbl552;

-IF &V1 EQ '' THEN GOTO Increment1D;

-SET &OP = IF &COM1D EQ 1 OR &COM1D EQ 3 OR &COM1D EQ 4 THEN ' OR ' ELSE ' AND LEVEL4 NE ';

-SET &WHERE550 = IF &CNT EQ &LINES THEN &WHERE550 | &V1
-   ELSE &WHERE550 | &V1 | '&OP.EVAL';

-GOTO Increment1D
-***********
-Lbl551
-***********
-SET &WHERE551 = IF &WHERE550 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE551 | &V1
-    ELSE &WHERE551 | &V1 | '&OP.EVAL';

-GOTO Increment1D
-***********
-Lbl552
-***********
-SET &WHERE552 = IF &WHERE550 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE552 | &V1 
-    ELSE &WHERE552 | &V1 | '&OP.EVAL';

-Increment1D
-SET &CNT = &CNT + 1;

-TOEND1D
-CLOSE COMMON2
-RUN

-* REJ ****************************************************************************

-* LS 01/25/2012 ID level 5, 6, and 7 *********************************************
-***********
-ChkLevel5
-***********
-IF &COM5 EQ 0 THEN GOTO ChkLevel6;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL5
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL5 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkLevel6;
-SET &CNT = 1;
-SET &WHERE554 = IF &COM5 EQ 1  THEN 'WHERE LEVEL5 EQ '
- ELSE IF &COM5 EQ 2 THEN 'WHERE LEVEL5 NE '
- ELSE IF &COM5 EQ 3 THEN 'WHERE LEVEL5 CONTAINS '
- ELSE IF &COM5 EQ 4 THEN 'WHERE LEVEL5 OMITS '
- ELSE ' ';

-REPEAT TOENDIDlvl5 &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A20. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(22, &V3, 'I2');
-SET &V1 = SUBSTR(22, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');

-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl555;
-IF &CNT GE 51  THEN GOTO Lbl556;

-IF &V1 EQ '' THEN GOTO IncrementID5;

-SET &OP = IF &COM5 EQ 1 OR &COM5 EQ 3  OR &COM5 EQ 4 THEN ' OR ' ELSE ' AND LEVEL5 NE ';

-SET &WHERE554 = IF &CNT EQ &LINES THEN &WHERE554 | &V1
-   ELSE &WHERE554 | &V1 | '&OP.EVAL';

-GOTO IncrementID5
-***********
-Lbl555
-***********
-SET &WHERE555 = IF &WHERE554 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE555 | &V1
-    ELSE &WHERE555 | &V1 | '&OP.EVAL';

-GOTO IncrementID5
-***********
-Lbl556
-***********
-SET &WHERE556 = IF &WHERE554 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE556 | &V1 
-    ELSE &WHERE556 | &V1 | '&OP.EVAL';

-IncrementID5
-SET &CNT = &CNT + 1;

-TOENDIDlvl5
-CLOSE COMMON2
-RUN

-***********
-ChkLevel6
-***********
-IF &COM6 EQ 0 THEN GOTO ChkLevel7;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL6
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL6 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkLevel7;
-SET &CNT = 1;
-SET &WHERE558 = IF &COM6 EQ 1  THEN 'WHERE LEVEL6 EQ '
- ELSE IF &COM6 EQ 2 THEN 'WHERE LEVEL6 NE '
- ELSE IF &COM6 EQ 3 THEN 'WHERE LEVEL6 CONTAINS '
- ELSE IF &COM6 EQ 4 THEN 'WHERE LEVEL6 OMITS '
- ELSE ' ';

-REPEAT TOENDIDlvl6 &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A20. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(22, &V3, 'I2');
-SET &V1 = SUBSTR(22, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');

-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl559;
-IF &CNT GE 51  THEN GOTO Lbl560;

-IF &V1 EQ '' THEN GOTO IncrementID6;

-SET &OP = IF &COM6 EQ 1 OR &COM6 EQ 3  OR &COM6 EQ 4 THEN ' OR ' ELSE ' AND LEVEL6 NE ';

-SET &WHERE558 = IF &CNT EQ &LINES THEN &WHERE558 | &V1
-   ELSE &WHERE558 | &V1 | '&OP.EVAL';

-GOTO IncrementID6
-***********
-Lbl559
-***********
-SET &WHERE559 = IF &WHERE558 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE559 | &V1
-    ELSE &WHERE559 | &V1 | '&OP.EVAL';

-GOTO IncrementID6
-***********
-Lbl560
-***********
-SET &WHERE560 = IF &WHERE558 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE560 | &V1 
-    ELSE &WHERE560 | &V1 | '&OP.EVAL';

-IncrementID6
-SET &CNT = &CNT + 1;

-TOENDIDlvl6
-CLOSE COMMON2
-RUN

-***********
-ChkLevel7
-***********
-IF &COM7 EQ 0 THEN GOTO ChkMPID;
TABLE FILE RPT_FLDS
PRINT COMMON2.ID_LEVEL7
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.ID_LEVEL7 NE ' '
BY COMMON2.SEQ_NO NOPRINT
ON TABLE SAVE AS COMMON2
END
-RUN

-IF &LINES EQ 0 THEN GOTO ChkMPID;
-SET &CNT = 1;
-SET &WHERE562 = IF &COM7 EQ 1  THEN 'WHERE LEVEL7 EQ '
- ELSE IF &COM7 EQ 2 THEN 'WHERE LEVEL7 NE '
- ELSE IF &COM7 EQ 3 THEN 'WHERE LEVEL7 CONTAINS '
- ELSE IF &COM7 EQ 4 THEN 'WHERE LEVEL7 OMITS '
- ELSE ' ';

-REPEAT TOENDIDlvl7 &LINES TIMES
-READ COMMON2 NOCLOSE &V2.A50. 

-SET &V3='''' || &V2 || '''';
-SET &LEN = ARGLEN(52, &V3, 'I2');
-SET &V1 = SUBSTR(52, &V3, 1, &LEN, &LEN, 'A&LEN.EVAL');

-IF &CNT GE 25 AND &CNT LE 50 THEN GOTO Lbl563;
-IF &CNT GE 51  THEN GOTO Lbl564;

-IF &V1 EQ '' THEN GOTO IncrementID7;

-SET &OP = IF &COM7 EQ 1 OR &COM7 EQ 3  OR &COM7 EQ 4 THEN ' OR ' ELSE ' AND LEVEL7 NE ';

-SET &WHERE562 = IF &CNT EQ &LINES THEN &WHERE562 | &V1
-   ELSE &WHERE562 | &V1 | '&OP.EVAL';

-GOTO IncrementID7
-***********
-Lbl563
-***********
-SET &WHERE563 = IF &WHERE562 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE563 | &V1
-    ELSE &WHERE563 | &V1 | '&OP.EVAL';

-GOTO IncrementID7
-***********
-Lbl564
-***********
-SET &WHERE564 = IF &WHERE562 EQ ' ' THEN ' '
-  ELSE IF &CNT EQ &LINES THEN &WHERE564 | &V1 
-    ELSE &WHERE564 | &V1 | '&OP.EVAL';

-IncrementID7
-SET &CNT = &CNT + 1;

-TOENDIDlvl7
-CLOSE COMMON2
-RUN

-* LS 01/25/2012 ID level 5, 6, and 7 *********************************************

-*LSI 08/17/2016 THE FOLLOWING ADDED FOR EMP_ID CHANGES IN RPT_FLDS
-***********
-ChkMPID
-***********
-IF &COMEMP EQ 0 THEN GOTO ChkViewType;
TABLE FILE RPT_FLDS
PRINT COMMON2.EMP_ID
WHERE INST_KEY EQ &INST_KEY
BY INST_KEY NOPRINT
WHERE COMMON2.EMP_ID NE ' '
BY COMMON2.SEQ_NO NOPRINT
-*ON TABLE SAVE AS COMMON2
END
-RUN