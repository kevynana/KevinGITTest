
-INCLUDE SETECHO
SET ASNAMES=ON
SET PAGE-NUM=OFF
SET EMPTYREPORT=ON


-DEFAULT &&DESC1 = 'XXXX';
-DEFAULT &&ROLSEL = 'ABCD-R';
-DEFAULT &&RGROUP = 'AIR';
-DEFAULT &&STD1 = 'N';
-DEFAULT &&STD2 = 'N'
-DEFAULT &&STD3 = 'N';


-SET &&DESC1 = 'Carrier';
-SET &&DESC1U = UPCASE(60, '&&DESC1.EVAL', DESC1U);
-SET &&ROLSEL = 'ABCD-R';
-SET &&STD1 = 'N';

-IF '&&ROLSEL.EVAL' EQ 'TOTAL-R' THEN GOTO TOTAL;


-IF &&STD1 EQ 'Y' THEN GOTO 'AIRSTD' ELSE
-IF &&STD2 EQ 'Y' THEN GOTO 'CARSTD' ELSE 
-IF &&STD3 EQ 'Y' THEN GOTO 'HTLSTD' ELSE GOTO NONSTD;

-AIRSTD;
-SET &&RGROUP = 'AIR';
-GOTO CONTSTD;

-CARSTD;
-SET &&RGROUP = 'CAR';
-GOTO CONTSTD;

-CARSTD;
-SET &&RGROUP = 'HTL';
-GOTO CONTSTD;

-CONTSTD;

JOIN
INNER RPT_SET.RPT_SET.SET_KEY IN RPT_SET TO MULTIPLE RPT_INST.RPT_INST.SET_KEY IN RPT_INST TAG J2 AS J2
WHERE (J2.ROLLUP_CODE EQ 'ABCD-R');
END
JOIN
INNER J2.RPT_INST.ROLLUP_CODE AND J2.RPT_INST.GLOBAL_PARM IN RPT_SET TO MULTIPLE ROLLSET.ROLLUP_CODE AND ROLLSET.GLOBAL_PARM IN ROLLSET TAG J3 AS J3
WHERE (J3.ROLLUP_CODE EQ 'ABCD-R');
END

DEFINE FILE RPT_SET
DSC1R/A60 = UPCASE(60, DESC1, DSC1R);
DSC2R/A60 = UPCASE(60, DESC2, DSC2R);
STD1/A1 = '&&STD1.EVAL';
STD2/A1 = '&&STD2.EVAL';
STD3/A1 = '&&STD3.EVAL';
GPARM/A2 = EDIT(GLOBAL_PARM, '99');
DSC3/A60=SUBSTR (120, DESC3, 1, 60, 120, DSC3);
DSC4/A60=SUBSTR (120, DESC4, 1, 60, 120, DSC4);
DSC34/A120 = DSC3||DSC4;
END
-RUN


TABLE FILE RPT_SET
PRINT GLOBAL_PARM DESC1 DESC2 DSC3 DSC4
BY ROLLUP_CODE
BY USER_NAME
BY SET_NAME
BY RPT_NAME
WHERE DSC1R CONTAINS '&&DESC1U.EVAL' OR DSC2R CONTAINS '&&DESC1U.EVAL' 
WHERE RPT_GROUP EQ '&&RGROUP.EVAL'
WHERE ROLLUP_CODE EQ 'ABCD-R'
ON TABLE HOLD AS RS1
END
-RUN



TABLE FILE RS1
HEADING CENTER
" "
"<40 Report Listing by Description"
" "
" "
" "
" "
SUM RPT_NAME AS 'Report Name' 
      DESC1 AS 'Report,Description 1' 
      DESC2 AS 'Report,Description 2'
      DSC3 AS 'Special,Selections 1'
      DSC4 AS 'Special,Selections 2
BY ROLLUP_CODE AS 'Rollup'
BY USER_NAME AS 'User Name'
BY SET_NAME AS 'Set Name'
BY GLOBAL_PARM AS 'Program ID'
FOOTING BOTTOM 
" "
"Standard Reports"
ON TABLE SET ONLINE-FMT PDF
ON ROLLUP_CODE UNDER-LINE
ON USER_NAME SKIP-LINE
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.030000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, STYLE=NORMAL, $
TYPE=HEADING, SIZE=12, STYLE=BOLD, FONT=ARIAL, COLOR=WHITE, $
TYPE=FOOTING, SIZE=7, FONT=ARIAL, STYLE=BOLD, COLOR=WHITE, $
TYPE=TITLE, STYLE=BOLD, $
-* TYPE=REPORT, IMAGE=LOGO15, POSITION=(.5 .5 ), SIZE=(1.5 .4), $
-*******************
TYPE=REPORT, IMAGE=TSMHEAD.jpg, POSITION=(0 0), $
TYPE=REPORT, IMAGE=QR_FOOTER.jpg, POSITION=(0 8.2), $ 
END
-RUN


-GOTO XXIT;

-NONSTD;


JOIN
INNER RPT_SET.SET_KEY IN RPT_SET TAG J1 TO MULTIPLE RPT_INST.SET_KEY IN RPT_INST TAG J2 AS J2
WHERE (J1.ROLLUP_CODE NE 'ABCD-R' OR 'TOTAL-R') AND (J2.ROLLUP_CODE NE 'ABCD-R' OR 'TOTAL-R');
END
JOIN
INNER J2.RPT_INST.ROLLUP_CODE AND J2.RPT_INST.GLOBAL_PARM IN RPT_SET TO MULTIPLE ROLLSET.ROLLUP_CODE AND ROLLSET.GLOBAL_PARM IN ROLLSET TAG J3 AS J3
WHERE (J3.ROLLUP_CODE NE 'ABCD-R' OR 'TOTAL-R');
END

DEFINE FILE RPT_SET
DSC1R/A60 = UPCASE(60, DESC1, DSC1R);
DSC2R/A60 = UPCASE(60, DESC2, DSC2R);
STD1/A1 = '&&STD1.EVAL';
STD2/A1 = '&&STD2.EVAL';
STD3/A1 = '&&STD3.EVAL';
GPARM/A2 = EDIT(GLOBAL_PARM, '99');
DSC3/A60=SUBSTR (120, DESC3, 1, 60, 120, DSC3);
DSC4/A60=SUBSTR (120, DESC4, 1, 60, 120, DSC4);
DSC34/A120 = DSC3||DSC4;
END
-RUN


TABLE FILE RPT_SET
PRINT GLOBAL_PARM DESC1 DESC2 DSC34
BY ROLLUP_CODE
BY USER_NAME
BY SET_NAME
BY RPT_NAME
WHERE DSC1R CONTAINS '&&DESC1U.EVAL' OR DSC2R CONTAINS '&&DESC1U.EVAL' 
WHERE RPT_GROUP EQ '&&RGROUP.EVAL'
WHERE ROLLUP_CODE NE 'ABCD-R'
WHERE GPARM NE 'AB'
WHERE ROLLUP_CODE NE 'TOTAL-R'
ON TABLE HOLD AS RS1
END
-RUN

TABLE FILE RS1
HEADING CENTER
" "
"<40 Report Listing by Description"
" "
" "
" "
" "
SUM RPT_NAME AS 'Report Name' 
      DESC1 AS 'Report,Description 1' 
      DESC2 AS 'Report,Description 2'
      DSC34 AS 'Special,Selections'
BY ROLLUP_CODE AS 'Rollup'
BY USER_NAME AS 'User Name'
BY SET_NAME AS 'Set Name'
BY GLOBAL_PARM AS 'Program ID'
FOOTING BOTTOM 
" "
"Non-Standard Reports"
ON TABLE SET ONLINE-FMT PDF
ON ROLLUP_CODE UNDER-LINE
ON USER_NAME SKIP-LINE
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.030000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, STYLE=NORMAL, $
TYPE=HEADING, SIZE=12, STYLE=BOLD, FONT=ARIAL, COLOR=WHITE, $
TYPE=FOOTING, SIZE=7, FONT=ARIAL, STYLE=BOLD, COLOR=WHITE, $
TYPE=TITLE, STYLE=BOLD, $
-* TYPE=REPORT, IMAGE=LOGO15, POSITION=(.5 .5 ), SIZE=(1.5 .4), $
-*******************
TYPE=REPORT, IMAGE=TSMHEAD.jpg, POSITION=(0 0), $
TYPE=REPORT, IMAGE=QR_FOOTER.jpg, POSITION=(0 8.2), $ 
END
-RUN

-GOTO XXIT;

-TOTAL;

DEFINE FILE ROLLSET
DSC1R/A60 = UPCASE(60, DESC1, DSC1R);
DSC2R/A60 = UPCASE(60, DESC2, DSC2R);
GPARM/A2 = EDIT(GLOBAL_PARM, '99');
ROLL/A8 = IF (GPARM EQ 'AB')  THEN 'ABCD-R' ELSE ROLLUP_CODE;
END
-RUN


TABLE FILE ROLLSET
SUM GPARM 
BY ROLL AS 'ROLLUP_CODE'
BY GLOBAL_PARM 
BY DESC1 
BY DESC2
BY DESC3
BY DESC4
WHERE DSC1R CONTAINS '&&DESC1U.EVAL' OR  DSC2R CONTAINS '&&DESC1U.EVAL' 
WHERE ROLLUP_CODE EQ 'TOTAL-R'
ON TABLE HOLD AS RS1
END
-RUN

TABLE FILE RS1
PRINT DESC1 DESC2 DESC3 DESC4 
BY ROLLUP_CODE
BY GLOBAL_PARM
-* ON TABLE HOLD AS RS2
END
-RUN
-QUIT


JOIN SET_KEY IN RPT_SET TO SET_KEY IN RPT_INST
-RUN

MATCH FILE RS2
PRINT DESC1 DESC2 DESC3 DESC4 
BY ROLLUP_CODE
BY GLOBAL_PARM
ON TABLE HOLD
RUN
FILE RPT_SET
PRINT USER_NAME SET_NAME
BY ROLLUP_CODE
BY GLOBAL_PARM
AFTER MATCH HOLD AS RSRI1 OLD
END
-RUN


TABLE FILE RSRI1
PRINT DESC1 DESC2 DESC3 DESC4
BY ROLLUP_CODE
BY USER_NAME
BY SET_NAME
BY GLOBAL_PARM
WHERE USER_NAME NE ' '
WHERE ROLLUP_CODE NE 'TOTAL-R'
END
-RUN
-QUIT



TABLE FILE RIHLD3
HEADING CENTER
" "
" "
" "
"REPORT LISTING"
" "
" "
PRINT RPT_NAME AS 'REPORT NAME' 
      DESC1 AS 'REPORT,DESCRIPTION 1' 
      DESC2 AS 'REPORT,DESCRIPTION 2'
      DESC3 AS 'SPECIAL,SELECTION 1'
      DESC4 AS 'SPECIAL,SELECTION 2'
BY ROLLUP_CODE AS 'ROLLUP'
BY USER_NAME AS 'USER NAME'
BY SET_NAME AS 'SET NAME'
BY GLOBAL_PARM AS 'PROGRAM ID'
FOOTING BOTTOM 
" "
" "
"INCLUSIVE OF INSTANCE KEY &&IKEY.EVAL"
ON TABLE SET ONLINE-FMT PDF
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.200000, RIGHTMARGIN=0.200000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, STYLE=NORMAL, $
TYPE=HEADING, SIZE=10, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
TYPE=FOOTING, SIZE=7, STYLE=BOLD, $
TYPE=TITLE, STYLE=BOLD, $
TYPE=REPORT, IMAGE=LOGO15, POSITION=(.5 .5 ), SIZE=(1.5 .4), $
END
-RUN

-XXIT;

