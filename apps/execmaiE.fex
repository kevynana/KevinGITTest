-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File EXECMAI1.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            COMMENTED OUT CREATEMSG SINCE IT
-*                                  DOES NOT APPLY IN WEBFOCUS
-* 3/07/01   TANDT-SS           CHANGE ALL NUMERIC FORMATS FROM P (PACKED) TO
-*                              D (FLOATING-POINT DOUBLE PRECISION) TO PROVIDE
-*                              CONSISTENCY IN ROUNDING AND PERCENTAGES.
-**********************************************************************

-*SET CREATEMSG = OFF
-RUN

-SET &&ES1_MAIN = &&WEB_PATH || 'ES1_MAIN.FOC';
-RUN
FILEDEF ES1_MAIN DISK &&ES1_MAIN
-RUN

CREATE FILE ES1_MAIN
-RUN

DEFINE FILE &&EXTRACT
 CM/A1 = IF TRN_DATE GE &&CMFMDT.EVAL AND 
TRN_DATE LE &&CMTODT.EVAL THEN 'Y' ELSE 'N';
 CY/A1 = IF TRN_DATE GE &&CYFMDT.EVAL AND 
TRN_DATE LE &&CYTODT.EVAL THEN 'Y' ELSE 'N';
 PM/A1 = IF TRN_DATE GE &&PMFMDT.EVAL AND 
TRN_DATE LE &&PMTODT.EVAL THEN 'Y' ELSE 'N';
 PY/A1 = IF TRN_DATE GE &&PYFMDT.EVAL AND 
TRN_DATE LE &&PYTODT.EVAL THEN 'Y' ELSE 'N';
0440_RUF/A1 = IF LEVEL1 EQ '0440RUFFALO' THEN 'Y' ELSE
              IF LEVEL2 EQ '0015010100000' OR '0042022600000' OR
              '0015050000000' OR '0015010100000' OR '0015010000000' OR
              '0015062000000' OR '0015022000000' OR '0015010100000' OR
              '0013025300000' OR '0015044000000' OR '0015017900000' OR
              '0015017900000' OR '0010062200000' OR '0015010000000' OR
              '0015044000000' OR '0021044000000' OR '0015062000000' OR
              '0015010600000' OR '0032022500000' OR '0015012100000' OR
              '0014025200000' OR '0017044000000' OR '0005044000000' OR
              '0042022700000' OR '2402240000000' OR '0033044000000' 
              THEN 'Y' ELSE 'N';


-*DOMESTIC PERIOD
-* CURRENT NET AMOUNT DOMESTIC CALCULATION
      CDM1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT ELSE 0;

-* CURRENT TAX AMOUNT DOMESTIC CALCULATION
      CDM1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX ELSE 0;

-* CURRENT AIRLINE FEE AMOUNT DOMESTIC CALCULATION
        CDM1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))       
                      THEN SEG_AMT+SEG_TAX
                      ELSE 0;

-* CURRENT TICKETS ISSUED DOMESTIC CALCULATION
        CDM1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D') 
                      AND (CM EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* CURRENT VOIDS ISSUED DOMESTIC CALCULATION
        CDM1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT EXCHANGES ISSUED DOMESTIC CALCULATION
        CDM1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F') 
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT REFUNDS ISSUED DOMESTIC CALCULATION
        CDM1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT MILES DOMESTIC CALCULATION
        CDM1_MILES/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                        AND (CM EQ 'Y') AND (VOID_DATE EQ 0))
                        THEN SEG_MILES ELSE 0;

-* CURRENT SAVINGS AMOUNT DOMESTIC CALCULATION
        CDM1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX) ELSE 0;

-* CURRENT LOST SAVINGS AMOUNT DOMESTIC CALCULATION
        CDM1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* CURRENT VALUE ADDED SAVINGS AMOUNT DOMESTIC CALCULATION
        CDM1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*INTERNATIONAL
-* CURRENT NET AMOUNT INTERNATIONAL CALCULATION
        CIM1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT 
                      ELSE 0;

-* CURRENT TAX AMOUNT INTERNATIONAL CALCULATION
        CIM1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX 
                      ELSE 0;

-* CURRENT AIRLINE FEE AMOUNT INTERNATIONAL CALCULATION
        CIM1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))
                      THEN SEG_AMT+SEG_TAX 
                      ELSE 0;

-* CURRENT TICKETS ISSUED INTERNATIONAL CALCULATION
        CIM1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I') 
                      AND (CM EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND  (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* CURRENT VOIDS ISSUED INTERNATIONAL CALCULATION
        CIM1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT EXCHANGES ISSUED INTERNATIONAL CALCULATION
        CIM1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (SEG_COUNT EQ -1)
                      AND (EX_FLAG EQ 'F') 
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT REFUNDS ISSUED INTERNATIONAL CALCULATION
        CIM1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT SAVINGS AMOUNT INTERNATIONAL CALCULATION
        CIM1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX)
                      ELSE 0;

-* CURRENT LOST SAVINGS AMOUNT INTERNATIONAL CALCULATION
        CIM1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* CURRENT VALUE ADDED SAVINGS AMOUNT INTERNATIONAL CALCULATION
        CIM1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CM EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*PRIOR PERIOD
-* PRIOR NET AMOUNT DOMESTIC CALCULATION
      PDM1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT
                      ELSE 0;

-* PRIOR TAX AMOUNT DOMESTIC CALCULATION
      PDM1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX
                      ELSE 0;

-* PRIOR AIRLINE FEE AMOUNT DOMESTIC CALCULATION
        PDM1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0)       
                      AND (EMBARK EQ 'FP2' OR 'FP3'))
                      THEN SEG_AMT+SEG_TAX
                      ELSE 0;

-* PRIOR TICKETS ISSUED DOMESTIC CALCULATION
        PDM1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D') 
                      AND (PM EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* PRIOR VOIDS ISSUED DOMESTIC CALCULATION
        PDM1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR EXCHANGES ISSUED DOMESTIC CALCULATION
        PDM1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR REFUNDS ISSUED DOMESTIC CALCULATION
        PDM1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR SAVINGS AMOUNT DOMESTIC CALCULATION
        PDM1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX)
                      ELSE 0;

-* PRIOR LOST SAVINGS AMOUNT DOMESTIC CALCULATION
        PDM1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* PRIOR VALUE ADDED SAVINGS AMOUNT DOMESTIC CALCULATION
        PDM1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*INTERNATIONAL
-* PRIOR NET AMOUNT INTERNATIONAL CALCULATION
        PIM1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT 
                      ELSE 0;

-* PRIOR TAX AMOUNT INTERNATIONAL CALCULATION
        PIM1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX 
                      ELSE 0;

-* PRIOR AIRLINE FEE AMOUNT INTERNATIONAL CALCULATION
        PIM1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))       
                      THEN SEG_AMT+SEG_TAX 
                      ELSE 0;

-* PRIOR TICKETS ISSUED INTERNATIONAL CALCULATION
        PIM1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I') 
                      AND (PM EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND  (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* PRIOR VOIDS ISSUED INTERNATIONAL CALCULATION
        PIM1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR EXCHANGES ISSUED INTERNATIONAL CALCULATION
        PIM1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR REFUNDS ISSUED INTERNATIONAL CALCULATION
        PIM1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR SAVINGS AMOUNT INTERNATIONAL CALCULATION
        PIM1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                                       - SEG_TAX)
                      ELSE 0;

-* PRIOR LOST SAVINGS AMOUNT INTERNATIONAL CALCULATION
        PIM1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* PRIOR VALUE ADDED SAVINGS AMOUNT INTERNATIONAL CALCULATION
        PIM1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PM EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*DOMESTIC YTD
-* CURRENT NET AMOUNT DOMESTIC CALCULATION
      CDY1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT
                      ELSE 0;

-* CURRENT TAX AMOUNT DOMESTIC CALCULATION
      CDY1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX
                      ELSE 0;

-* CURRENT AIRLINE FEE AMOUNT DOMESTIC CALCULATION
        CDY1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))       
                      THEN SEG_AMT+SEG_TAX
                      ELSE 0;

-* CURRENT TICKETS ISSUED DOMESTIC CALCULATION
        CDY1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D') 
                      AND (CY EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND  (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* CURRENT VOIDS ISSUED DOMESTIC CALCULATION
        CDY1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT EXCHANGES ISSUED DOMESTIC CALCULATION
        CDY1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT REFUNDS ISSUED DOMESTIC CALCULATION
        CDY1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT SAVINGS AMOUNT DOMESTIC CALCULATION
        CDY1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX)
                      ELSE 0;

-* CURRENT LOST SAVINGS AMOUNT DOMESTIC CALCULATION
        CDY1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* CURRENT VALUE ADDED SAVINGS AMOUNT DOMESTIC CALCULATION
        CDY1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*INTERNATIONAL
-* CURRENT NET AMOUNT INTERNATIONAL CALCULATION
        CIY1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT 
                      ELSE 0;

-* CURRENT TAX AMOUNT INTERNATIONAL CALCULATION
        CIY1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX 
                      ELSE 0;

-* CURRENT AIRLINE FEE AMOUNT INTERNATIONAL CALCULATION
        CIY1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))       
                      THEN SEG_AMT+SEG_TAX 
                      ELSE 0;

-* CURRENT TICKETS ISSUED INTERNATIONAL CALCULATION
        CIY1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I') 
                      AND (CY EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND  (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* CURRENT VOIDS ISSUED INTERNATIONAL CALCULATION
        CIY1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT EXCHANGES ISSUED INTERNATIONAL CALCULATION
        CIY1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT REFUNDS ISSUED INTERNATIONAL CALCULATION
        CIY1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* CURRENT SAVINGS AMOUNT INTERNATIONAL CALCULATION
        CIY1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX)
                      ELSE 0;

-* CURRENT LOST SAVINGS AMOUNT INTERNATIONAL CALCULATION
        CIY1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* CURRENT VALUE ADDED SAVINGS AMOUNT INTERNATIONAL CALCULATION
        CIY1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (CY EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*DOMESTIC PRIOR YTD
-* PRIOR NET AMOUNT DOMESTIC CALCULATION
      PDY1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT
                      ELSE 0;

-* PRIOR TAX AMOUNT DOMESTIC CALCULATION
      PDY1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX
                      ELSE 0;

-* PRIOR AIRLINE FEE AMOUNT INTERNATIONAL CALCULATION
        PDY1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))       
                      THEN SEG_AMT+SEG_TAX 
                      ELSE 0;

-* PRIOR TICKETS ISSUED DOMESTIC CALCULATION
        PDY1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D') 
                      AND (PY EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND  (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* PRIOR VOIDS ISSUED DOMESTIC CALCULATION
        PDY1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR EXCHANGES ISSUED DOMESTIC CALCULATION
        PDY1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR REFUNDS ISSUED DOMESTIC CALCULATION
        PDY1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR SAVINGS AMOUNT DOMESTIC CALCULATION
        PDY1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX)
                      ELSE 0;

-* PRIOR LOST SAVINGS AMOUNT DOMESTIC CALCULATION
        PDY1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* PRIOR VALUE ADDED SAVINGS AMOUNT DOMESTIC CALCULATION
        PDY1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'D')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;

-*INTERNATIONAL
-* PRIOR NET AMOUNT INTERNATIONAL CALCULATION
        PIY1NET_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_AMT 
                      ELSE 0;

-* PRIOR TAX AMOUNT INTERNATIONAL CALCULATION
        PIY1TAX_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN SEG_TAX 
                      ELSE 0;

-* PRIOR AIRLINE FEE AMOUNT DOMESTIC CALCULATION
        PIY1AIR_FEE/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EMBARK EQ 'FP2' OR 'FP3'))       
                      THEN SEG_AMT+SEG_TAX
                      ELSE 0;


-* PRIOR TICKETS ISSUED INTERNATIONAL CALCULATION
        PIY1TKT_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I') 
                      AND (PY EQ 'Y') AND (SEG_NBR EQ '01') 
                    AND  (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1))
                      THEN 1 ELSE 0;

-* PRIOR VOIDS ISSUED INTERNATIONAL CALCULATION
        PIY1VOD_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE NE 0)
                      AND (SEG_COUNT EQ 1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR EXCHANGES ISSUED INTERNATIONAL CALCULATION
        PIY1EXG_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (EX_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR REFUNDS ISSUED INTERNATIONAL CALCULATION
        PIY1REF_ISS/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0)
                      AND (RF_FLAG EQ 'F')
                      AND (SEG_COUNT EQ -1)
                      AND (SEG_NBR EQ '01')) THEN 1
                      ELSE 0;

-* PRIOR SAVINGS AMOUNT INTERNATIONAL CALCULATION
        PIY1SAV_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN (SEG_STANDARD - SEG_AMT
                           - SEG_TAX)
                      ELSE 0;

-* PRIOR LOST SAVINGS AMOUNT INTERNATIONAL CALCULATION
        PIY1LOS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))       
                      THEN ((SEG_AMT + SEG_TAX)
                           - SEG_LOWEST)
                      ELSE 0;

-* PRIOR VALUE ADDED SAVINGS AMOUNT INTERNATIONAL CALCULATION
        PIY1VAS_AMT/D12.2 = IF ((AIR_MAIN.INTL_DOM IS 'I')
                      AND (PY EQ 'Y') AND (VOID_DATE EQ 0))
                      THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX)
                      ELSE 0;


END
-RUN

TABLEF FILE &&EXTRACT
-* Generated by Report Assist
SUM
CDM1NET_AMT/D10 CDM1TAX_AMT/D10 CDM1TKT_ISS/D10 CDM1VOD_ISS/D10 
CDM1REF_ISS/D10 
CDM1EXG_ISS/D10 CDM1SAV_AMT/D10 CDM1LOS_AMT/D10 CDM1VAS_AMT/D10
CDM1AIR_FEE/D10 
CIM1NET_AMT/D10 CIM1TAX_AMT/D10 CIM1TKT_ISS/D10 CIM1VOD_ISS/D10 
CIM1REF_ISS/D10 
CIM1EXG_ISS/D10 CIM1SAV_AMT/D10 CIM1LOS_AMT/D10 CIM1VAS_AMT/D10 
CIM1AIR_FEE/D10 

PDM1NET_AMT/D10 PDM1TAX_AMT/D10 PDM1TKT_ISS/D10 PDM1VOD_ISS/D10 
PDM1REF_ISS/D10 
PDM1EXG_ISS/D10 PDM1SAV_AMT/D10 PDM1LOS_AMT/D10 PDM1VAS_AMT/D10 
PDM1AIR_FEE/D10 
PIM1NET_AMT/D10 PIM1TAX_AMT/D10 PIM1TKT_ISS/D10 PIM1VOD_ISS/D10 
PIM1REF_ISS/D10 
PIM1EXG_ISS/D10 PIM1SAV_AMT/D10 PIM1LOS_AMT/D10 PIM1VAS_AMT/D10 
PIM1AIR_FEE/D10

CDY1NET_AMT/D10 CDY1TAX_AMT/D10 CDY1TKT_ISS/D10 CDY1VOD_ISS/D10 
CDY1REF_ISS/D10 
CDY1EXG_ISS/D10 CDY1SAV_AMT/D10 CDY1LOS_AMT/D10 CDY1VAS_AMT/D10 
CDY1AIR_FEE/D10 
CIY1NET_AMT/D10 CIY1TAX_AMT/D10 CIY1TKT_ISS/D10 CIY1VOD_ISS/D10 
CIY1REF_ISS/D10 
CIY1EXG_ISS/D10 CIY1SAV_AMT/D10 CIY1LOS_AMT/D10 CIY1VAS_AMT/D10 
CIY1AIR_FEE/D10

PDY1NET_AMT/D10 PDY1TAX_AMT/D10 PDY1TKT_ISS/D10 PDY1VOD_ISS/D10 
PDY1REF_ISS/D10 
PDY1EXG_ISS/D10 PDY1SAV_AMT/D10 PDY1LOS_AMT/D10 PDY1VAS_AMT/D10 
PDY1AIR_FEE/D10 
PIY1NET_AMT/D10 PIY1TAX_AMT/D10 PIY1TKT_ISS/D10 PIY1VOD_ISS/D10 
PIY1REF_ISS/D10 
PIY1EXG_ISS/D10 PIY1SAV_AMT/D10 PIY1LOS_AMT/D10 PIY1VAS_AMT/D10 
PIY1AIR_FEE/D10

WHERE (AIR_MAIN.TICKET_CODE EQ '1' );
WHERE (AIR_MAIN.CONJ_REL EQ 1) ;
WHERE (TRN_DATE GE &&PYFMDT.EVAL
      AND TRN_DATE LE &&PYTODT.EVAL)
   OR (TRN_DATE GE &&CYFMDT.EVAL
      AND TRN_DATE LE &&CYTODT.EVAL)
   OR (TRN_DATE GE &&CMFMDT.EVAL
      AND TRN_DATE LE &&CMTODT.EVAL)
   OR (TRN_DATE GE &&PMFMDT.EVAL
      AND TRN_DATE LE &&PMTODT.EVAL);

&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
&&WHERE11
&&WHERE12
&&WHERE13
&&WHERE14
&&WHERE15
&&WHERE16
&&WHERE17
&&WHERE18
&&WHERE19
&&WHERE20
&&WHERE21
&&WHERE22
&&WHERE23
&&WHERE24
&&WHERE25
&&WHERE26
&&WHERE27
&&WHERE28
&&WHERE29
&&WHERE30
&&WHERE31
&&WHERE32
&&WHERE33
&&WHERE34
&&WHERE35
&&WHERE36
&&WHERE37
&&WHERE38
&&WHERE39
&&WHERE40
&&WHERE41
&&WHERE42
&&WHERE43
&&WHERE44
&&WHERE45
&&WHERE46
&&WHERE47
&&WHERE48
&&WHERE49
&&WHERE50
&&WHERE51
&&WHERE52
&&WHERE53
&&WHERE54
&&WHERE55
&&WHERE56
&&WHERE57
&&WHERE58
&&WHERE59
&&WHERE60
&&WHERE61
&&WHERE62
&&WHERE63
&&WHERE64
&&WHERE65
&&WHERE66
&&WHERE67
&&WHERE68

-INCLUDE RPTPARMS

ON TABLE HOLD AS HOLD1
END
-RUN

TABLEF FILE HOLD1
-* Generated by Report Assist
PRINT
CDM1NET_AMT CDM1TAX_AMT CDM1TKT_ISS CDM1VOD_ISS CDM1REF_ISS 
CDM1EXG_ISS CDM1SAV_AMT CDM1LOS_AMT CDM1VAS_AMT CDM1AIR_FEE 
CIM1NET_AMT CIM1TAX_AMT CIM1TKT_ISS CIM1VOD_ISS CIM1REF_ISS 
CIM1EXG_ISS CIM1SAV_AMT CIM1LOS_AMT CIM1VAS_AMT CIM1AIR_FEE 

PDM1NET_AMT PDM1TAX_AMT PDM1TKT_ISS PDM1VOD_ISS PDM1REF_ISS 
PDM1EXG_ISS PDM1SAV_AMT PDM1LOS_AMT PDM1VAS_AMT PDM1AIR_FEE 
PIM1NET_AMT PIM1TAX_AMT PIM1TKT_ISS PIM1VOD_ISS PIM1REF_ISS 
PIM1EXG_ISS PIM1SAV_AMT PIM1LOS_AMT PIM1VAS_AMT PIM1AIR_FEE

CDY1NET_AMT CDY1TAX_AMT CDY1TKT_ISS CDY1VOD_ISS CDY1REF_ISS  
CDY1EXG_ISS CDY1SAV_AMT CDY1LOS_AMT CDY1VAS_AMT CDY1AIR_FEE 
CIY1NET_AMT CIY1TAX_AMT CIY1TKT_ISS CIY1VOD_ISS CIY1REF_ISS 
CIY1EXG_ISS CIY1SAV_AMT CIY1LOS_AMT CIY1VAS_AMT CIY1AIR_FEE

PDY1NET_AMT PDY1TAX_AMT PDY1TKT_ISS PDY1VOD_ISS PDY1REF_ISS 
PDY1EXG_ISS PDY1SAV_AMT PDY1LOS_AMT PDY1VAS_AMT PDY1AIR_FEE
PIY1NET_AMT PIY1TAX_AMT PIY1TKT_ISS PIY1VOD_ISS PIY1REF_ISS 
PIY1EXG_ISS PIY1SAV_AMT PIY1LOS_AMT PIY1VAS_AMT PIY1AIR_FEE

ON TABLE HOLD AS TKT_TYP1
END
-*-EXIT
