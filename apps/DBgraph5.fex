SET ASNAMES=ON
-*SET TEMPERASE = OFF
-INCLUDE SETECHO

DEFINE FILE EACONG
FLAG/A1 = 'A';
END
TABLE FILE EACONG
SUM NET_TKT_CNT/P12 AS 'TNET'
BY FLAG
WHERE INVOICE_MY GE '01/2006'
ON TABLE HOLD AS H1
END
-RUN
DEFINE FILE EACONG
ONL_TRA/A15 = IF DOD_TYPE EQ 'H' OR 'I' OR 'J' OR 'M' OR 'X' OR
             'A' OR 'L' OR 'N' OR 'S' OR 'H' THEN 'Online' ELSE 'Traditional';
FLAG/A1 = 'A';
END
-RUN
TABLE FILE EACONG
PRINT NET_TKT_CNT ONL_TRA
BY FLAG
WHERE INVOICE_MY GE '01/2006'
ON TABLE HOLD AS H2
END
-RUN

MATCH FILE H2
SUM NET_TKT_CNT 
BY FLAG
BY ONL_TRA
ON TABLE HOLD
RUN 
FILE H1
SUM TNET
BY FLAG
AFTER MATCH HOLD AS H3 OLD-OR-NEW
END
-RUN


TABLE FILE H3
SUM
COMPUTE PCTNT/P12 = IF TNET EQ 0 THEN 0 ELSE (NET_TKT_CNT/TNET)*100;
BY ONL_TRA
ON TABLE HOLD AS H4
END
-RUN

GRAPH FILE H4
PRINT PCTNT AS ' '
ACROSS ONL_TRA AS ' '
ON GRAPH HOLD AS 'DBGRAPH5' FORMAT PNG
ON GRAPH SET LOOKGRAPH PIE
ON GRAPH SET GRAPHEDIT SERVER
ON GRAPH SET BARNUMB OFF
ON GRAPH SET 3D ON
ON GRAPH SET VZERO ON
ON GRAPH SET GRID OFF
ON GRAPH SET VAXIS 230
ON GRAPH SET HAXIS 220
-* ON GRAPH PCHOLD FORMAT PNG
ON GRAPH SET GRAPHSTYLE *
setMarkerDisplay(true);
setConnectLineMarkers(false);
setConnectScatterMarkers(false);
setO1LabelDisplay(true);
setO1AxisSide(0);
setO1MajorGridDisplay(false);
setO1MinorGridDisplay(false);
setAxisAssignment(0,0);
setY1LabelDisplay(false);
setY1MajorGridDisplay(false);
setY1MinorGridDisplay(false);
-* setTextFormatPreset(getY1Label(),1);
setPieFeelerTextDisplay(2);
setPieLabelDisplay(0);
setTextFormatPreset(getPieSliceLabel(),0);
setFontSizeAbsolute(getPieSliceLabel(),true);
setFontSize(getPieLabelDisplay(),9);
setFontStyle(getPieLabelDisplay(),1);
setRiserBorderMode(1);
setSeriesDefaultTransparentBorderColor(true);
setUseSeriesBorderDefaults(true);
setLegendDisplay(true);
setTitleString("Online vs Traditional Ticket%");
setTextJustHoriz(getTitle(),1);
setFontSizeAbsolute(getTitle(),true);
setFontSize(getTitle(),12);
setFontStyle(getTitle(),2);
setTextRotation(getTitle(),0);
setTextWrap(getTitle(),false);
setTextJustHoriz(getLegendText(),2);
setFontSizeAbsolute(getLegendText(),true);
setFontSize(getLegendText(),10);
setFontStyle(getLegendText(),0);
setTextRotation(getLegendText(),0);
setTextWrap(getLegendText(),false);
setTextJustHoriz(getY1Title(),1);
setFontSizeAbsolute(getY1Title(),true);
setFontSize(getY1Title(),12);
setTextRotation(getY1Title(),1);
setTextWrap(getY1Title(),false);
setTextJustHoriz(getY1Label(),2);
setFontSizeAbsolute(getY1Label(),true);
setFontSize(getY1Label(),16);
setTextRotation(getY1Label(),0);
setTextWrap(getY1Label(),false);
setFontSizeAbsolute(getY2Title(),true);
setFontSizeAbsolute(getY2Label(),true);
setFontSizeAbsolute(getO1Title(),true);
setPlaceResize(getTitle(),0);
setPlaceRotate(getTitle(),0);
setPlaceAlign(getTitle(),0);
setPlaceWordWrap(getTitle(),0);
setPlaceResize(getPieSliceLabel(),0);
setPlaceRotate(getPieSliceLabel(),0);
setPlaceAlign(getPieSliceLabel(),0);
setPlaceWordWrap(getPieSliceLabel(),0);
setPlaceResize(getLegendText(),0);
setPlaceRotate(getLegendText(),0);
setPlaceAlign(getLegendText(),0);
setPlaceWordWrap(getLegendText(),0);
setPlaceResize(getY1Title(),0);
setPlaceRotate(getY1Title(),0);
setPlaceAlign(getY1Title(),0);
setPlaceWordWrap(getY1Title(),0);
setPlaceResize(getY1Label(),0);
setPlaceRotate(getY1Label(),0);
setPlaceAlign(getY1Label(),0);
setPlaceWordWrap(getY1Label(),0);
setPlace(true);
setSeriesFillColor(0, new Color, 0 64 128));
setSeriesFillColor(2, new Color, 115 160 247));
setPieDepth(50);
setPieTilt(50);
ENDSTYLE
END
-RUN
-QUIT
ON GRAPH SET STYLE *
     SQUEEZE=ON,
     ORIENTATION=PORTRAIT,
     TITLETEXT='Total Expense',
$
TYPE=REPORT,
     GRID=OFF,
     FONT='TIMES NEW ROMAN',
     SIZE=10,
$
ENDSTYLE
END


