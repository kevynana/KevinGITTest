-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File DVSUM.FEX
-* CREATED FOR DATA VAULT EXPENSE REPORT 
-* CREATED FROM TKTSUM

-**********************************************************************

-**********************************************************************

SET ASNAMES=ON

  

-SET &&RPTSUF = 'DTL';
-INCLUDE FDEFRPTS
-RUN
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNKA=&HLDPATH || 'HOLDA.FOC';
-SET &HNKB=&HLDPATH || 'HOLDH.FOC';
-SET &HNKC=&HLDPATH || 'HOLDC.FOC';
-SET &HNKD=&HLDPATH || 'HOLDM.FOC';
 

-SET &FILENAME = 'HOLDA'; 


-RUN



-DOS STATE &HNKA
-SET &HOLDFILEA = IF &RETCODE.EVAL EQ 0 THEN &HNKA | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKC
-SET &HOLDFILEC = IF &RETCODE.EVAL EQ 0 THEN &HNKC | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKB
-SET &HOLDFILEH = IF &RETCODE.EVAL EQ 0 THEN &HNKB | ' AS ' | &FILENAME ELSE ' ';

-DOS STATE &HNKD
-SET &HOLDFILEM = IF &RETCODE.EVAL EQ 0 THEN &HNKD | ' AS ' | &FILENAME ELSE ' ';



USE ADD 
&HOLDFILEA
&HOLDFILEC
&HOLDFILEH
&HOLDFILEM
END


DEFINE FILE HOLDA
CITY1/A25 = IF CITY1 EQ ' ' THEN 'MISC SVC FEE' ELSE CITY1;
END
TABLE FILE HOLDA
PRINT
  AMOUNT
  TTL_COUNT
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TRAN_DATE
BY TKT_NUM
BY TSORT
BY SEG
BY TYPE
BY NAME 
BY DATE
BY DATE2
BY CITY1
BY FLAG
BY ACCT
BY INVOICE_NUM
BY STATUS
BY DV_NUM
BY LEVEL1
BY LEVEL2
BY LEVEL3
BY LEVEL4
BY TRIP_PURPOSE
BY GEO_ZONE
ON TABLE HOLD AS HOLDE
END
-RUN




TABLE FILE HOLDE
PRINT
  AMOUNT
  TTL_COUNT
  GEO_ZONE

BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR
BY TRAN_DATE
BY TKT_NUM
BY TSORT
BY SEG
BY TYPE
BY NAME 
BY DATE
BY DATE2
BY CITY1
BY FLAG
BY ACCT
BY INVOICE_NUM
BY STATUS
BY DV_NUM
BY LEVEL1
BY LEVEL2
BY LEVEL3
BY LEVEL4
BY TRIP_PURPOSE
ON TABLE HOLD AS HOLDALL
END
-RUN



-INCLUDE DATAVROLL


FILEDEF MYTEMPLATE DISK D:\TNT\MNT\PUSHTECK\MYTEMPLATE.MHT
-SET &FDT = EDIT(&&FROMDT,'$9999999999');
-SET &TDT = EDIT(&&TODT,'$9999999999');

-**************************************************************************
DEFINE FILE HOLDALL
COUNT1/D12CS = IF (FLAG EQ 'A') THEN TTL_COUNT ELSE 0;
COUNT2/D12CS = IF (FLAG EQ 'C') THEN TTL_COUNT ELSE 0;
COUNT3/D12CS = IF (FLAG EQ 'H') THEN TTL_COUNT ELSE 0;
AMT1/D12.2CS = IF (FLAG EQ 'A') THEN AMOUNT ELSE 0;
AMT2/D12.2CS = IF (FLAG EQ 'C') THEN AMOUNT ELSE 0;
AMT3/D12.2CS = IF (FLAG EQ 'H') THEN AMOUNT ELSE 0;

FLAGA/A5 = DECODE FLAG ('A' 'AIR'   'C' 'CAR'  'H' 'HOTEL');                         
XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
TICKET_NMBR/A30 = IF (TKT_NUM EQ '0000000000') THEN ' ' ELSE
                  TKT_NUM;
                 
-*DEFINES ON PREVIOUS DEFINES 
PASNGR_NAME/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
LVL1/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL1 ELSE ' ';
TRAN_MYA/I6MTYY = TRAN_DATE;
NOWTOD/A8 WITH TKT_NUM = HHMMSS (NOWTOD);
END

TABLE FILE HOLDALL
-*-INCLUDE HEADAIR
-*"&&SUBHEAD"
"</5"
" &&RPT_TTL1.EVAL"
" &&RPT_TTL2.EVAL"
" &&DTDESC.EVAL &FDT.EVAL - &TDT.EVAL "
PRINT 
ACCT AS 'ACCT'
LEVEL1 AS '&LV1.EVAL'
PASSNGR_NAME AS 'TRAVELER'
TRAN_DATE AS 'INVOICED'
DATE AS 'DEPART'
DATE2 AS 'RETURN'
INVOICE_NUM AS 'INVOICE'
TKT_NUM AS 'TICKET'
FLAG AS 'TYPE'
NAME AS 'VENDOR'
DV_NUM AS 'BILLED TO'
CITY1 AS 'DESCRIPTION'
TYPE AS 'DOCTYPE'
STATUS AS 'STATUS'
AMOUNT AS 'AMOUNT'
LEVEL2 &LV2
LEVEL3 &LV3
LEVEL4 &LV4
BY PASSNGR_NAME NOPRINT
BY TRAN_DATE NOPRINT

BY TKT_NUM NOPRINT
BY FLAG NOPRINT
ON TABLE COLUMN-TOTAL



-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*

-*ON TABLE PCHOLD FORMAT EXL2K TEMPLATE 'MYTEMPLATE' SHEETNUMBER 8

ON TABLE PCHOLD FORMAT EXL2K

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&DTSTY 
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

