-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-SET &&OV_OFF = &&WEB_PATH || 'OV_OFF.FOC';
-RUN
FILEDEF OV_OFF DISK &&OV_OFF
-RUN

CREATE FILE OV_OFF
-RUN

SET ASNAMES=ON

DEFINE FILE CURMATCH1
RSN/A30 =  IF REFUSE_CODE EQ 'AS' THEN 'CARRIER PREFERENCE' ELSE
           IF REFUSE_CODE EQ 'TS' THEN 'TIME NOT CONVENIENT' ELSE
           IF REFUSE_CODE EQ 'NR' THEN 'MORE COSTLY/REF TKT CLS' ELSE
           IF REFUSE_CODE EQ 'AA' OR 'CX' THEN 
                             'ALT ARPT/CONNEC REJECTED' ELSE
           IF REFUSE_CODE EQ 'AP' THEN 'BKG LESS THAN 7 DAYS' ELSE
                             'OTHER';
TRSN1/A5 = 'TOTAL';
                  

-* DEFINES ON PREVIOUS DEFINES
DISSAVINGS/D12.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'CARRIER PREFERENCE'
ON TABLE HOLD AS OVLST1 
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'TIME NOT CONVENIENT'
ON TABLE HOLD AS OVLST2
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'MORE COSTLY/REF TKT CLS'
ON TABLE HOLD AS OVLST3
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'ALT ARPT/CONNEC REJECTED'
ON TABLE HOLD AS OVLST4
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'BKG LESS THAN 7 DAYS'
ON TABLE HOLD AS OVLST5
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'OTHER'
ON TABLE HOLD AS OVLST6
END
-RUN

TABLE FILE CURMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY TRSN1
ON TABLE HOLD AS OVLST7
END
-RUN

DEFINE FILE OVLST1
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST1
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND 
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
ON TABLE HOLD AS OVLOST1
END
-RUN

TABLE FILE OVLOST1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTA
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTA
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTA
END
-RUN

DEFINE FILE OVLST2
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST2
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
ON TABLE HOLD AS OVLOST2
END
-RUN

TABLE FILE OVLOST2
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTB
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTB
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTB
END
-RUN

DEFINE FILE OVLST3
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST3
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;     
ON TABLE HOLD AS OVLOST3
END
-RUN

TABLE FILE OVLOST3
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTC
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTC
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTC
END
-RUN

DEFINE FILE OVLST4
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST4
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;     
ON TABLE HOLD AS OVLOST4
END
-RUN

TABLE FILE OVLOST4
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTD
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTA
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTD
END
-RUN

DEFINE FILE OVLST5
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST5
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;  
ON TABLE HOLD AS OVLOST5
END
-RUN

TABLE FILE OVLOST5
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTE
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTE
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTE
END
-RUN

DEFINE FILE OVLST6
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST6
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 2;      
ON TABLE HOLD AS OVLOST6
END
-RUN

TABLE FILE OVLOST6
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTF
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTF
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTF
END
-RUN

DEFINE FILE OVLST7
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST7
PRINT CATEGORY/A30 AND TRSN1/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_CURR' AND
DISSAVINGS/D15 AS 'TKT_CURR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 3;  
ON TABLE HOLD AS OVLOST7
END
-RUN

TABLE FILE OVLOST7
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND VOL_CURR AND TKT_CURR
ON TABLE HOLD AS OVLOSTG
END
MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTG
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTG
END
-RUN

DEFINE FILE PRIORMATCH1
RSN/A30 =  IF REFUSE_CODE EQ 'AS' THEN 'CARRIER PREFERENCE' ELSE
           IF REFUSE_CODE EQ 'TS' THEN 'TIME NOT CONVENIENT' ELSE
           IF REFUSE_CODE EQ 'NR' THEN 'MORE COSTLY/REF TKT CLS' ELSE
           IF REFUSE_CODE EQ 'AA' OR 'CX' THEN 
                             'ALT ARPT/CONNEC REJECTED' ELSE
           IF REFUSE_CODE EQ 'AP' THEN 'BKG LESS THAN 7 DAYS' ELSE
                             'OTHER';
TRSN1/A5 = 'TOTAL';
                  

-* DEFINES ON PREVIOUS DEFINES
DISSAVINGS/D12.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
END
-RUN

TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'CARRIER PREFERENCE'
ON TABLE HOLD AS MXLST1 
END
-RUN


TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'TIME NOT CONVENIENT'
ON TABLE HOLD AS MXLST2
END
-RUN

TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'MORE COSTLY/REF TKT CLS'
ON TABLE HOLD AS MXLST3
END
-RUN

TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'ALT ARPT/CONNEC REJECTED'
ON TABLE HOLD AS MXLST4 
END
-RUN

TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'BKG LESS THAN 7 DAYS'
ON TABLE HOLD AS MXLST5
END
-RUN

TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY RSN
WHERE RSN EQ 'OTHER'
ON TABLE HOLD AS MXLST6
END
-RUN

TABLE FILE PRIORMATCH1
SUM NET_TKT_CNT DISSAVINGS
BY TRSN1
ON TABLE HOLD AS MXLST7
END
-RUN

DEFINE FILE MXLST1
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST1
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND 
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
ON TABLE HOLD AS MXLOST1
END
-RUN

TABLE FILE MXLOST1
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTA
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTA
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTA
END
-RUN

DEFINE FILE MXLST2
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST2
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
ON TABLE HOLD AS MXLOST2
END
-RUN

TABLE FILE MXLOST2
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTB
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTB
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTB
END
-RUN

DEFINE FILE MXLST3
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST3
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;     
ON TABLE HOLD AS MXLOST3
END
-RUN

TABLE FILE MXLOST3
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTC
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTC
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTC
END
-RUN

DEFINE FILE MXLST4
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST4
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;     
ON TABLE HOLD AS MXLOST4
END
-RUN

TABLE FILE MXLOST4
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTD
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTA
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTD
END
-RUN

DEFINE FILE MXLST5
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST5
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;  
ON TABLE HOLD AS MXLOST5
END
-RUN

TABLE FILE MXLOST5
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTE
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTE
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTE
END
-RUN

DEFINE FILE MXLST6
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST6
PRINT CATEGORY/A30 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 2;      
ON TABLE HOLD AS MXLOST6
END
-RUN

TABLE FILE MXLOST6
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTF
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTF
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTF
END
-RUN

DEFINE FILE MXLST7
CATEGORY/A30 = 'LOST AIRLINE SAVINGS';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE MXLST7
PRINT CATEGORY/A30 AND TRSN1/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D15 AS 'VOL_PRIOR' AND
DISSAVINGS/D15 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 3;  
ON TABLE HOLD AS MXLOST7
END
-RUN

TABLE FILE MXLOST7
PRINT CATEGORY AND ROW_LABEL AND VOL_PRIOR AND TKT_PRIOR
ON TABLE HOLD AS MXLOSTG
END
MODIFY FILE OV_OFF
FIXFORM FROM MXLOSTG
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH INCLUDE
DATA ON MXLOSTG
END
-RUN






