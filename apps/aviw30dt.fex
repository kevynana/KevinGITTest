-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-*                     FOCEXEC: AIRRPT
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*6/2/98         JK                 INCLUDE AIRLEVM INSTEAD OF AIRLEVT
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*1/15/03       JK                  ADDED BOOK DEFINE
-*1/15/03       JK                  CHANGED UPAMT DEFINE
-*10/26/04   STEVE                  Changed VOIDS to include voided MCO
-*12/21/04  DEB                  CHANGED BOOK DEFINE TO INCLUDE ADDTL
-*                               DOD_TYPE
-*10/11/05  DEB                  ADDED DOD_TYPE 'H' TO BOOK DEFINE
-*03/01/11   STEVE               CORRECTED UPAMNT DEFINE FOR $15 ONLINE AND $30 TRADITIONAL 
-*1/16/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE

-**************************************************************************
SET ASNAMES=ON
-RUN


DEFINE FILE &&RPT_HOLD
  DPCTY1/A3 = IF SEG_NBR EQ '01' THEN EMBARK ELSE ' ';
  DPCTY2/A3 = IF SEG_NBR EQ '02' THEN EMBARK ELSE ' ';
  DPCTY3/A3 = IF SEG_NBR EQ '03' THEN EMBARK ELSE ' ';
  DPCTY4/A3 = IF SEG_NBR EQ '04' THEN EMBARK ELSE ' ';
  DPCTY5/A3 = IF SEG_NBR EQ '05' THEN EMBARK ELSE ' ';
  DPCTY6/A3 = IF SEG_NBR EQ '06' THEN EMBARK ELSE ' ';
  DSCTY1/A3 = IF SEG_NBR EQ '01' THEN ROUTE ELSE ' ';
  DSCTY2/A3 = IF SEG_NBR EQ '02' THEN ROUTE ELSE ' ';
  DSCTY3/A3 = IF SEG_NBR EQ '03' THEN ROUTE ELSE ' ';
  DSCTY4/A3 = IF SEG_NBR EQ '04' THEN ROUTE ELSE ' ';
  DSCTY5/A3 = IF SEG_NBR EQ '05' THEN ROUTE ELSE ' ';
  DSCTY6/A3 = IF SEG_NBR EQ '06' THEN ROUTE ELSE ' ';
  EXMCOS/D9 = IF (EX_FLAG EQ ' ') AND (DOC_TYPE EQ '1') AND
		(EXCHG_SALE NE ' ') THEN 1 ELSE 0;
  FARE_PAID/D12 = SEG_AMT + SEG_TAX;
  FULL_RFNDS/D9 = IF ((VOID_DATE EQ 0) AND (RF_FLAG EQ 'F') AND
                (TKT_NUM NE LAST TKT_NUM) AND (SEG_COUNT LT 0))
                THEN 1 ELSE 0;
  ORIG_SALE/D9 = IF ((SEG_NBR EQ '01') AND (FARE_PAID GE 0)
               AND (SEG_COUNT EQ 1) AND (EXCHG_SALE EQ ' '))
               THEN 1 ELSE IF ((DOC_TYPE EQ '1') AND (VOID_DATE EQ 0) 
               AND (FARE_PAID GE 0) AND (EXCHG_SALE EQ ' '))
		 THEN 1 ELSE 0; 
  PART_RFNDS/D9 = IF ((VOID_DATE EQ 0) AND (RF_FLAG EQ 'P') AND
                (TKT_NUM NE LAST TKT_NUM) AND (SEG_COUNT LE 0))
                THEN 1 ELSE 0;
  REFUNDS/D9 = FULL_RFNDS + PART_RFNDS;
  TKT_CNT/D8CS = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0)
               AND (SEG_COUNT EQ 1) THEN 1 ELSE 0;
  
  VOIDS/D9 = IF (VOID_DATE NE 0) AND (SEG_COUNT EQ 1) AND (SEG_NBR EQ '01')
  	     THEN 1 ELSE IF (DOC_TYPE EQ '1' AND VOID_DATE NE 0) 
	     THEN 1 ELSE 0;	


-* ****DEFINES ON PREVIOUS DEFINES****
  EXCHGS/D9 =  IF (EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND 
             (EMBARK NE 'DT1' OR 'RF1' OR 'FP3') THEN TKT_CNT ELSE 
             IF (DOC_TYPE EQ '1') AND (EXCHG_SALE EQ 'E') THEN
             0 ELSE IF (SEG_COUNT GE 0) AND (EXCHG_SALE NE ' ')
             THEN TKT_CNT ELSE 0;
  TOT_ECNT/D9 = EXCHGS + EXMCOS;
  TOT_TRANS/D9 = ORIG_SALE + VOIDS + TOT_ECNT + REFUNDS;
END
-RUN

TABLE FILE &&RPT_HOLD
SUM 
  TOT_TRANS
BY TKT_NUM
BY SEG_COUNT
PRINT 
  AIRLINE
  CONJ_REL
  DOD_TYPE	
  DPT_DATE	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
WHERE TOT_TRANS GE 1 
ON TABLE HOLD AS HOLDA
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT 
  DPCTY1
  DSCTY1
BY TKT_NUM
BY SEG_COUNT
WHERE SEG_NBR EQ '01'
ON TABLE HOLD AS HOLD1
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT 
  DPCTY2
  DSCTY2
BY TKT_NUM
BY SEG_COUNT
WHERE SEG_NBR EQ '02'
ON TABLE HOLD AS HOLD2
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT 
  DPCTY3
  DSCTY3
BY TKT_NUM
BY SEG_COUNT
WHERE SEG_NBR EQ '03'
ON TABLE HOLD AS HOLD3
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT 
  DPCTY4
  DSCTY4
BY TKT_NUM
BY SEG_COUNT
WHERE SEG_NBR EQ '04'
ON TABLE HOLD AS HOLD4
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT 
  DPCTY5
  DSCTY5
BY TKT_NUM
BY SEG_COUNT
WHERE SEG_NBR EQ '05'
ON TABLE HOLD AS HOLD5
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT 
  DPCTY6
  DSCTY6
BY TKT_NUM
BY SEG_COUNT
WHERE SEG_NBR EQ '06'
ON TABLE HOLD AS HOLD6
END
-RUN

MATCH FILE HOLDA
PRINT 
  AIRLINE	
  CONJ_REL
  DOD_TYPE	
  DPT_DATE	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TOT_TRANS	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD
RUN
FILE HOLD1
PRINT 
  DPCTY1
  DSCTY1
BY TKT_NUM
BY SEG_COUNT
AFTER MATCH HOLD AS HOLD7 OLD
END
-RUN

MATCH FILE HOLD7
PRINT 
  AIRLINE	
  CONJ_REL
  DOD_TYPE	
  DPCTY1	
  DPT_DATE	
  DSCTY1	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TOT_TRANS	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD
RUN
FILE HOLD2
PRINT 
  DPCTY2
  DSCTY2
BY TKT_NUM
BY SEG_COUNT
AFTER MATCH HOLD AS HOLD8 OLD
END
-RUN

MATCH FILE HOLD8
PRINT 
  AIRLINE	
  CONJ_REL
  DOD_TYPE	
  DPCTY1	
  DPCTY2	
  DPT_DATE	
  DSCTY1	
  DSCTY2	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TOT_TRANS	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD
RUN
FILE HOLD3
PRINT 
  DPCTY3
  DSCTY3
BY TKT_NUM
BY SEG_COUNT
AFTER MATCH HOLD AS HOLD9 OLD
END
-RUN

MATCH FILE HOLD9
PRINT 
  AIRLINE	
  CONJ_REL
  DOD_TYPE	
  DPCTY1	
  DPCTY2	
  DPCTY3	
  DPT_DATE	
  DSCTY1	
  DSCTY2	
  DSCTY3	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TOT_TRANS	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD
RUN
FILE HOLD4
PRINT 
  DPCTY4
  DSCTY4
BY TKT_NUM
BY SEG_COUNT
AFTER MATCH HOLD AS HOLD10 OLD
END
-RUN

MATCH FILE HOLD10
PRINT 
  AIRLINE	
  CONJ_REL
  DOD_TYPE	
  DPCTY1	
  DPCTY2	
  DPCTY3	
  DPCTY4	
  DPT_DATE	
  DSCTY1	
  DSCTY2	
  DSCTY3	
  DSCTY4	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TOT_TRANS	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD
RUN
FILE HOLD5
PRINT 
  DPCTY5
  DSCTY5
BY TKT_NUM
BY SEG_COUNT
AFTER MATCH HOLD AS HOLD11 OLD
END
-RUN

MATCH FILE HOLD11
PRINT 
  AIRLINE
  CONJ_REL
  DOD_TYPE	
  DPCTY1	
  DPCTY2	
  DPCTY3	
  DPCTY4	
  DPCTY5	
  DPT_DATE	
  DSCTY1	
  DSCTY2	
  DSCTY3	
  DSCTY4	
  DSCTY5	
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  RESV_BRANCH	
  TOT_TRANS	
  TRN_DATE	
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD
RUN
FILE HOLD6
PRINT 
  DPCTY6
  DSCTY6
BY TKT_NUM
BY SEG_COUNT
AFTER MATCH HOLD AS HOLD12 OLD
END
-RUN

DEFINE FILE HOLD12
  AMTSIGN/A1 = ' ';
  ACCTDT/A4 = '0000';
  APPRVR/A30 = '999999999999999999999999999999';
  BOOK/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';
  CHGYR/YY = TRN_DATE;
  CONJ_STAT/I5 = IF CONJ_REL GT 1 THEN CONJ_REL - 1 ELSE 0;
  COSTCC/A15 = IF LEVEL1 EQ 'SOFTCC' THEN LEVEL3 ELSE LEVEL1;
  DDATE1/YYMD = DPT_DATE;
  FILL1/A1 = ' ';
  FILL9/A7 = '       ';
  FILL11/A6 = '      ';
  TDATE1/YYMD = TRN_DATE;
  UPAMNT/A9 = IF (TOT_TRANS EQ 2) AND (BOOK EQ 'N') THEN '000006000' ELSE 
              IF (TOT_TRANS EQ 2) AND (BOOK EQ 'Y') THEN '000003000' ELSE
              IF (BOOK EQ 'N') THEN '000003000' ELSE '000001500';
  UPCCTR/A6 = EDIT(COSTCC,'999999');
  UPINV#/A6 = EDIT(INVOICE_NUM,'999999');
  UPPAX/A22 = EDIT(PASSNGR_NAME,'9999999999999999999999');
  UPSSN/A9 = EDIT(LEVEL2,'999999999');
  XTKT_NUM/A3 = EDIT(TKT_NUM,'$$$$$$$999');
  XTKT_NUMI/I5 = EDIT(XTKT_NUM);

-* ****DEFINES ON PREVIOUS DEFINES****
  CONJ_NUM/I5 = IF CONJ_REL GT 1 THEN XTKT_NUMI + CONJ_STAT ELSE 0;
  CONJ_NUMA/A5 = EDIT(CONJ_NUM);
  CONJ_TKT/A5 = IF CONJ_NUMA EQ '0' THEN ' ' ELSE CONJ_NUMA;
  FULLDDATE/I8MDYY = DDATE1;
  FULLTDATE/I8MDYY = TDATE1;
  UPDPTY/A2 = EDIT(FULLDDATE,'$$$$$$99');
  UPDPTD/A2 = EDIT(FULLDDATE,'$$99$$$$');
  UPDPTM/A2 = EDIT(FULLDDATE,'99$$$$$$');

-* ****DEFINES ON DEFINES ON PREVIOUS DEFINES****
  CHGDD/A2 = EDIT(FULLTDATE, '$$99$$$$');
  CHGMM/A2 = EDIT(FULLTDATE, '99$$$$$$');
  UPTKT#/A18 = AIRLINE|TKT_NUM|CONJ_TKT;

-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
  NOWTOD/A8 WITH TKT_NUM = HHMMSS (NOWTOD);

END
TABLE FILE HOLD12
-INCLUDE HEADAIR
"&&SUBHEAD"
"</2"
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&DTSTY    
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
