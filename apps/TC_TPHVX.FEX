-* 6/19/15 - DEB - S-09727 CREATED FOR TCTPVXDD
-*  08/23/2016  REJ  S-17914 Changes for ER5.
-*10/31/16-JEM-s-26559-Corrected report from erroring


-INCLUDE SETECHO
 
CREATE FILE TCTPVX
-RUN
 
-INCLUDE TCGETROLL
-RUN
 
-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT;
EX TCHTLDB
-RUN
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop2;
 
EX TCVXTPEX
-RUN
-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2
 
-INCLUDE SetParmtime
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE AVRP_SUBFOOT
-:AVSF0
 
-SET &&RANK_LIMIT = 50;
-SET &&RANK_LIMIT2 = 10;
-SET &&CTY_LMT = &&RANK_LIMIT;
-SET &&HTL_LMT = &&RANK_LIMIT2;
-SET &&RANK_METH = 'CDAY';
 
 
TABLE FILE TCTPVX
SUM CDAY
    PDAY
    CAMT
    PAMT
    CBK
    PBK
    CSVG
    PSVG
    PREF_NON
BY CITY_ST
BY PROP_NAME
BY PROP_ZIP5
BY PROP_ADDRESS
BY PROP_CODE
BY PROP_LANYON_ID
BY PROP_LATITUDE
BY PROP_LONGITUDE
BY PROP_MSTARS
BY PROP_AAA_DMDS
BY PROP_OHG_CLASS
BY CHAIN_CODE
BY ROLLCD
ON TABLE HOLD AS HOLD1
END
 
 
TABLE FILE HOLD1
PRINT
    CDAY
    PDAY
    CAMT
    PAMT
    CBK
    PBK
    CSVG
    PSVG
    PROP_NAME
    PROP_ZIP5
    PROP_ADDRESS
    PROP_CODE
    PROP_LANYON_ID
    PROP_LATITUDE
    PROP_LONGITUDE
    PROP_MSTARS
    PROP_AAA_DMDS
    PROP_OHG_CLASS
    CHAIN_CODE
    PREF_NON
    ROLLCD
BY CITY_ST
RANKED BY HIGHEST &&RANK_METH NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN
 
 
-SET &&HTL_LMT = '9999';
 
DEFINE FILE HOLD2
 RANK_LIMIT/I5 = &&HTL_LMT;
 DRANK/D5      = RANK;
 ARANKX/A6 = FTOA(DRANK, '(D5)', 'A6');
 ARANK/A5=EDIT(ARANKX,'$99999');
 RANK_VALUE/A9 = IF (RANK_LIMIT EQ 0) THEN (ARANK) ELSE
                  IF RANK GT RANK_LIMIT THEN 'All Other' ELSE ARANK;
 
END
-RUN
 
TABLE FILE HOLD2
PRINT CDAY
    PDAY
    CAMT
    PAMT
    CBK
    PBK
    CSVG
    PSVG
    PROP_NAME
    PROP_ZIP5
    PROP_ADDRESS
    PROP_CODE
    PROP_LANYON_ID
    ROLLCD
    PROP_LATITUDE
    PROP_LONGITUDE
    PROP_MSTARS
    PROP_AAA_DMDS
    PROP_OHG_CLASS
    CHAIN_CODE
    PREF_NON
BY CITY_ST
BY RANK_VALUE
ON TABLE HOLD AS HOLD3
END
-RUN
 
DEFINE FILE HOLD3
HTL_NAME/A30 = IF RANK_VALUE NE 'All Other' THEN PROP_NAME ELSE 'All Other';
PNPR/A1 = IF RANK_VALUE NE 'All Other' THEN PREF_NON ELSE ' ';
PROP_CD/A7 = IF RANK_VALUE NE 'All Other' THEN PROP_CODE ELSE ' ';
LANYON_ID/A15 = IF RANK_VALUE NE 'All Other' THEN PROP_LANYON_ID ELSE ' ';
PROP_LAT/D13.8 = IF RANK_VALUE NE 'All Other' THEN PROP_LATITUDE ELSE 0;
PROP_LON/D13.8  = IF RANK_VALUE NE 'All Other' THEN PROP_LONGITUDE ELSE 0;
MOBIL_STARS/I5 = IF RANK_VALUE NE 'All Other' THEN PROP_MSTARS ELSE 0;
AAA_DIAMONDS/I5 = IF RANK_VALUE NE 'All Other' THEN PROP_AAA_DMDS ELSE 0;
OHG_CLASS/A5 = IF RANK_VALUE NE 'All Other' THEN PROP_OHG_CLASS ELSE ' ';
ZIP/A5 = IF RANK_VALUE NE 'All Other' THEN PROP_ZIP5 ELSE ' ';
ADDRESS/A35 = IF RANK_VALUE NE 'All Other' THEN PROP_ADDRESS ELSE ' ';
CHAIN_CD/A2 = IF RANK_VALUE NE 'All Other' THEN CHAIN_CODE ELSE ' ';
ROLL_CD/A8 = IF RANK_VALUE NE 'All Other' THEN ROLLCD ELSE ' ';
-RUN
 
TABLE FILE HOLD3
SUM CDAY
    PDAY
    CAMT
    PAMT
    CBK
    PBK
    CSVG
    PSVG
BY CITY_ST
BY RANK_VALUE
BY HTL_NAME
BY ZIP
BY ADDRESS
BY PROP_CD
BY LANYON_ID
BY ROLL_CD
BY PROP_LAT
BY PROP_LON
BY MOBIL_STARS
BY AAA_DIAMONDS
BY OHG_CLASS
BY PNPR
BY CHAIN_CD
ON TABLE HOLD AS HOLD4
END
-RUN
 
 
TABLE FILE HOLD1
SUM CDAY
BY CITY_ST
ON TABLE HOLD AS RHOLD1
END
-RUN
 
TABLE FILE RHOLD1
PRINT *
RANKED BY HIGHEST &&RANK_METH AS 'DAYS_RANK'
ON TABLE HOLD AS RHOLD2
END
-RUN
 
MATCH FILE HOLD4
PRINT *
BY CITY_ST
ON TABLE HOLD
RUN
FILE RHOLD2
SUM DAYS_RANK
BY CITY_ST
AFTER MATCH HOLD AS HOLD5 OLD-OR-NEW
END
-RUN
 
TABLE FILE HOLD5
PRINT *
RANKED BY HIGHEST DAYS_RANK
ON TABLE HOLD AS HOLD6
END
-RUN
 
-SET &&CTY_LMT = '9999';
 
DEFINE FILE HOLD6
  CTY_LIMIT/I2 = &&CTY_LMT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6= EDIT(FRANKX,'$999999');
  CTY_VALUE/A9 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                 IF LIST GT CTY_LIMIT THEN 'All Other' ELSE FRANK;
  CTY_PRINT/A35 = IF CTY_VALUE NE 'All Other' THEN CITY_ST ELSE 'All Other';
 
  PNPR1/A1 = IF CTY_VALUE NE 'All Other' THEN PNPR ELSE ' ';
  HTL_NAME1/A30 = IF CTY_VALUE NE 'All Other' THEN HTL_NAME ELSE ' ';
  HTL_NAME1A/A30 = IF CTY_VALUE EQ 'All Other' THEN 'All Other' ELSE HTL_NAME1;
  PROP_C1/A7 = IF CTY_VALUE NE 'All Other' THEN PROP_CD ELSE ' ';
  LID_P1/A15 = IF CTY_VALUE NE 'All Other' THEN LANYON_ID ELSE ' ';
  LON_P/D13.8 = IF CTY_VALUE NE 'All Other' THEN PROP_LON ELSE 0;
  LAT_P/D13.8 = IF CTY_VALUE NE 'All Other' THEN PROP_LAT ELSE 0;
  MOS_P/I5 = IF CTY_VALUE NE 'All Other' THEN MOBIL_STARS ELSE 0;
  AAA_P/I5 = IF CTY_VALUE NE 'All Other' THEN AAA_DIAMONDS ELSE 0;
  OHG_P/A5 = IF CTY_VALUE NE 'All Other' THEN OHG_CLASS ELSE ' ';
  RANK_VAL/A10 = IF CTY_VALUE EQ 'All Other' THEN '9999999999' ELSE RANK_VALUE;
  ZIP51/A5 = IF CTY_VALUE NE 'All Other' THEN ZIP ELSE ' ';
  HTL_ADDRESS/A35 = IF CTY_VALUE NE 'All Other' THEN ADDRESS ELSE ' ';
  CH_CD/A2 = IF CTY_VALUE NE 'All Other' THEN CHAIN_CD ELSE ' ';
  RL_CD/A8 = IF CTY_VALUE NE 'All Other' THEN ROLL_CD ELSE ' ';
END
-RUN
 
TABLE FILE HOLD6
SUM CDAY
    PDAY
    CAMT
    PAMT
    CBK
    PBK
    CSVG
    PSVG
    CLIMIT
    LON_P
BY CTY_VALUE
BY CTY_PRINT
BY RANK_VAL
BY HTL_NAME1A
BY ZIP51
BY HTL_ADDRESS
BY PROP_C1
BY LID_P1
BY RL_CD
BY LON_P
BY LAT_P
BY MOS_P
BY AAA_P
BY OHG_P
BY PNPR1
BY CH_CD
ON TABLE HOLD AS HOLD7
END

 
-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN
 
DEFINE FILE HOLD7
SPACE/A5 = ' ';
NOWTOD/A8 WITH CTY_VALUE = HHMMSS (NOWTOD);
END
 
-SET &FMM=EDIT(&&FROMDT,'$$$$$$99');
-SET &FMD=EDIT(&&FROMDT,'$$$$$$$$$99');
-SET &FMY=EDIT(&&FROMDT,'$9999');
-SET &TOM=EDIT(&&TODT,'$$$$$$99');
-SET &TOD=EDIT(&&TODT,'$$$$$$$$$99');
-SET &TOY=EDIT(&&TODT,'$9999');
-SET &FXM=EDIT(&&FXDATE,'$$$$$$99');
-SET &FXD=EDIT(&&FXDATE,'$$$$$$$$$99');
-SET &FXY=EDIT(&&FXDATE,'$9999');
-SET &TXM=EDIT(&&TXDATE,'$$$$$$99');
-SET &TXD=EDIT(&&TXDATE,'$$$$$$$$$99');
-SET &TXY=EDIT(&&TXDATE,'$9999');
-SET &SP='|';
-SET &ROLLNME = TRUNCATE(&&RPTNAM);
 
-SET &ROLLCTY1 = LCWORD(15, '&&ROLLCTY.EVAL', 'A15');
 
-SET &ROLLCNCT = TRUNCATE(&&ROLLCNCT);
-SET &ROLLCS = TRUNCATE(&ROLLCTY1) || EDIT(&&ROLLSTA,', 99');
 
-SET &ROLLPHN = EDIT(&&ROLLFON,'9-999-999-9999');
 
-SET &ROLLCS = IF &&ROLLCS EQ ',' THEN ' ' ELSE &ROLLCS;
-SET &ROLLCS = IF &&ROLLSTA EQ '  ' THEN &&ROLLCTY ELSE &ROLLCS;
-SET &ROLLPHN = IF &&ROLLPHN EQ ' -   -   -    ' THEN ' ' ELSE &ROLLPHN;
-RUN
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS';
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
 
 
TABLE FILE HOLD7
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
FOOTING
"</3"
"&&FOOTER1"
"&&FOOTER2"
"<55 eTTek Review &DATE AT <NOWTOD <95 &&FOOTR"
ON TABLE PAGE-BREAK AND SUBFOOT
" "
" "
" "
" "
" "
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
 
TYPE=REPORT, COLUMN=N2, SQUEEZE=1.5, $
TYPE=REPORT, COLUMN=N3, SQUEEZE=1.5, $
TYPE=DATA, JUSTIFY=LEFT, $
-*TYPE=DATA, COLUMN=N2, COLOR=RGB(0 0 138), $
-*TYPE=DATA, COLUMN=N4, COLOR=RGB(0 0 138), $
-GOTO NOBACKCOLOR;
-* TYPE=DATA, COLUMN=N6, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
-* TYPE=DATA, COLUMN=N7, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N13, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N14, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N15, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N16, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N17, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N18, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N19, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
-*TYPE=DATA, COLUMN=N15, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N21, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N22, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N23, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N24, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N25, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N26, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
TYPE=DATA, COLUMN=N27, BACKCOLOR=RGB(17 185 38), WHEN=PNPR1 EQ 'P', $
-NOBACKCOLOR
-*TYPE=DATA, COLUMN=N14, SQUEEZE=.1, $
 
TYPE=SUBTOTAL, JUSTIFY=LEFT, STYLE=BOLD, $
TYPE=GRANDTOTAL, JUSTIFY=LEFT, STYLE=BOLD,$
 
ENDSTYLE
 
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
 
 
 
 
 
-IF &LINES GT 0 THEN GOTO XXIT;
EX TCEMPTY
-RUN
-XXIT
