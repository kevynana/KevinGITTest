-* created for B Brau Online Percentage report 10/6/08 - DV
-* 11/28/12 ADDED INCLUDE BY HIERARCHY SORT - DEB
-*1/27/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-* ADDED TRANTYPE INCLUDE - JK 12/16/14 STORY ID S-06492


-**********************************************************************
-* B Brua Online Percentage
-*-**********************************************************************
 
-INCLUDE SETECHO
SET ASNAMES=ON

-*********************************************************************************
-*  
-*********************************************************************************

DEFINE FILE SR_50
  
  BRK_LVL/I2 = &&BRK_LVL;
  LEVEL_DESC/A60 = &&LDESC;
    
  FARE_PAID/D12.2 = SEG_AMT + SEG_TAX;
  NET_TKT_CNT/D12    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0; 
-* Define on previous defines                           
                           
  IBOOK_CNT/D8CS = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN NET_TKT_CNT ELSE 0;
  IBOOK_FARE/D12.2CS = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN FARE_PAID ELSE 0;
  TRANYR/YY= TRN_DATE;
-* Defines on Previous                           
-*   P1/A1 = IF (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) THEN 'Y' ELSE 'N';
-*   P2/A1 = IF (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL) THEN 'Y' ELSE 'N';
  AYEAR/A4YY = TRANYR;                      
   P1/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND 
                   TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
   P2/A1 = IF TRN_DATE GE &&FXDATE.EVAL AND 
                  TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';

-* Defines on Previous

  YEAR/A4 = AYEAR;
-INCLUDE TRANTYPE 
END
-RUN

TABLEF FILE SR_50
PRINT  FARE_PAID
       NET_TKT_CNT     
       IBOOK_CNT
       IBOOK_FARE
       LEVEL_DESC
       AROLL_LEV3
       AROLL_LEV4
       P1
       P2
       YEAR
-INCLUDE BYHIERARCHY
WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS HOLDONE
END
-RUN
 



TABLE FILE HOLDONE
SUM  FARE_PAID
     NET_TKT_CNT
     IBOOK_CNT
     IBOOK_FARE
BY LEVEL_DESC
BY YEAR
BY P1
BY P2
BY AROLL_LEV3
BY AROLL_LEV4
ON TABLE HOLD AS HOLDTWO
END
-RUN



-IF '&&SETF.EVAL' EQ 'BBONLINE' THEN GOTO NoCarHtl;

EX CAPCUSE
-RUN

DEFINE FILE CR_50
 
 LEVEL_DESC/A60 = &&LDESC;
 RENTAL_DAY/D12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
-* TRANYR/YY= INVOICE_DATE;
 TRANYR/YY= PICKUP_DATE;

P1/A1 = IF PICKUP_DATE GE &&FROMDT.EVAL AND PICKUP_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
P2/A1 = IF PICKUP_DATE GE &&FXDATE.EVAL AND PICKUP_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
-* P1/A1 = IF INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
-* P2/A1 = IF INVOICE_DATE GE &&FXDATE.EVAL AND INVOICE_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
-* Defines on previous
 AYEAR/A4YY = TRANYR;                      
 YEAR/A4 = AYEAR;
END
-RUN
TABLEF FILE CR_50
PRINT  
      RENTAL_DAY
      RENTAL_AMT
      P1
      P2
      LEVEL_DESC
      YEAR
-INCLUDE BYHIERARCHY
WHERE (PICKUP_DATE GE &&FROMDT.EVAL) AND (PICKUP_DATE LE &&TODT.EVAL) OR
      (PICKUP_DATE GE &&FXDATE.EVAL) AND (PICKUP_DATE LE &&TXDATE.EVAL)
-*WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL) OR
-*      (INVOICE_DATE GE &&FXDATE.EVAL) AND (INVOICE_DATE LE &&TXDATE.EVAL)

-INCLUDE RPTPARMS
ON TABLE HOLD AS CARHOLD
END
-RUN
 
TABLE FILE CARHOLD
SUM RENTAL_DAY
    RENTAL_AMT
    P1
    P2
BY LEVEL_DESC
BY YEAR
ON TABLE HOLD AS CAR1
END
-RUN





EX CAPHUSE
-RUN

DEFINE FILE HR_50
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
LEVEL_DESC/A60 = &&LDESC;

NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;

P1/A1 = IF CHKIN_DATE GE &&FROMDT.EVAL AND CHKIN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
P2/A1 = IF CHKIN_DATE GE &&FXDATE.EVAL AND CHKIN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
-* P1/A1 = IF INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
-* P2/A1 = IF INVOICE_DATE GE &&FXDATE.EVAL AND INVOICE_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';

-*TRANYR/YY= INVOICE_DATE;
TRANYR/YY= CHKIN_DATE;

-*Defines on previous defines
 AYEAR/A4YY = TRANYR;                      

 
 YEAR/A4 = AYEAR;                      


END

TABLE FILE HR_50
PRINT NNROOMS
      NEW_TOTAL_AMT
      P1
      P2
      LEVEL_DESC
      YEAR
-INCLUDE BYHIERARCHY
WHERE (CHKIN_DATE GE &&FROMDT.EVAL) AND (CHKIN_DATE LE &&TODT.EVAL) OR
      (CHKIN_DATE GE &&FXDATE.EVAL) AND (CHKIN_DATE LE &&TXDATE.EVAL)
-* WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL) OR
-*       (INVOICE_DATE GE &&FXDATE.EVAL) AND (INVOICE_DATE LE &&TXDATE.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTLHOLD
END
-RUN

 
TABLE FILE HTLHOLD
SUM NNROOMS
      NEW_TOTAL_AMT
      P1
      P2

BY LEVEL_DESC
BY YEAR
ON TABLE HOLD AS HOTEL2
END
-RUN





-NoCarHtl