-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* File CVIEW1SM.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-*4/17/01      TANDT-SS             Added DOD_TYPE>
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*09/04/02   STEVE              Added RSNCDE
-* 6/23/03   DEB                CARRIED THROUGH NODAYS AND NMBR_DAYS  
-*12/2/03    JK                 CARRIED THROUGH AGENT_NUM
-*3/26/04    DV                 CARRIED THROUGH INV_MY VENDOR_CODE
-*3/31/04    DV                 CARRIED THROUGH GROSS_BOOK
-*6/15/04    DV                 CARRIED THROUGH XLEVEL3 XLEV_3
-*10/21/04   DV                 CHANGED TO INCLUDE GLOBAL CURRENCY
-*11/3/04    JK                 ADDED LEVEL3
-*10/28/05   DEB                COMMENTED OUT COUNTRY_NAME DUE TO REPORT RAN FROM PRIOR
-*                              PERIOD MISSING DATA
-*9/6/06     DEB                ADDED ABSRD DEFINE
-*4/26/07    DEB                CARRIED THROUGH XLVL3
-*7/23/07    DEB                CARRIED THROUGH KB_AGT
-*5/14/15 - joy - STORY ID - S-08873 - Changed to correct Global Currency Error
-*6/8/15 - joy - STORY ID - S-08873 - Update story id had a transposed number within line above
-*11/25/15  Joy    S-07987  Corrected for running Currency Enabled Version
-* 12/2/15 - DLV - S-13446 - Corrected issue of report failing by changing CHECK4
-*03/04/16 - JEM - S-13285 Updated to allow reports to sort/subtotal by id-levels
-*04/07/16-JEM-S-17604 Changed PCTBK Define to D8.2 to be consistent with ADHOC and correct total % bookings rounding issue
-*07/11/16  RSB    S-20630 - New Employee ID database field
-*                           Added EMP_ID
-*  
-**********************************************************************


SET ASNAMES = ON
-RUN
-INCLUDE SETECHO


-IF &&SETF EQ 'ABCARTRN' AND &&CURRENCY NE 'USD' THEN GOTO CARTRN  
-ELSE GOTO CHECK2;


-CARTRN;

-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &&S_SUBJ3='AMT_RENTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''' ;

-GOTO NEXT;

-CHECK2;

-IF &&SETF EQ 'ABCRC' AND &&CURRENCY NE 'USD' THEN GOTO CRC  
-ELSE GOTO CHECK3;

-CRC;

-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &CAVG_CUR = 'AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2='AMT_RENTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''' ;
-SET &&S_SUBJ4='COMPUTE GAVGDR/D16.2CS=IF ((NBR_DAYS LT 0) AND';
-SET &&S_SUBJ5='(AMT_RENTL1 LT 0)) THEN ((AMT_RENTL1/NBR_DAYS)*(-1)) ELSE';
-SET &&S_SUBJ6='IF ((NBR_DAYS LT 1) AND (NBR_DAYS GT (-1))) THEN 0 ELSE';
-SET &&S_SUBJ7='AMT_RENTL1/NBR_DAYS; AS ' | '''&CAVG_CUR.EVAL''';

-GOTO NEXT;


-CHECK3;

-IF &&SETF EQ 'ABCVENDR' AND &&CURRENCY NE 'USD' THEN GOTO CVNDR ELSE GOTO CHECK4;

-CVNDR;

-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &CAVG_CUR = 'AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &&S_SUBJ3='AMT_RENTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''' ;
-SET &&S_SUBJ4='PCT.AMT_RENTL1/D8.1 AS ''% OF,TOTAL,RENTAL,AMOUNT''';
-SET &&S_SUBJ5='COMPUTE GAVGDR/D16.2CS=IF ((RENTAL_DAYS LT 0) AND';
-SET &&S_SUBJ6='(AMT_RENTL1 LT 0)) THEN ((AMT_RENTL1/RENTAL_DAYS)*(-1)) ELSE';
-SET &&S_SUBJ7='IF ((RENTAL_DAYS LT 1) AND (RENTAL_DAYS GT (-1))) THEN 0 ELSE';
-SET &&S_SUBJ8='AMT_RENTL1/RENTAL_DAYS; AS ' | '''&CAVG_CUR.EVAL'' ';
-SET &&S_SUBJ9='COMPUTE AV/D12=IF BOOKINGS EQ 0 THEN 0 ELSE';
-SET &&S_SUBJ10='RENTAL_DAYS/BOOKINGS; AS ''AVERAGE,RENTAL,LENGTH''';

-CHECK4;

-*-IF &&SETF EQ 'ABCTRNBT' AND &&CURRENCY NE 'USD' THEN GOTO CBT; ELSE GOTO NEXT;
-IF &&SETF EQ 'ABCTRNBT' AND &&CURRENCY NE 'USD' THEN GOTO CBT ELSE GOTO NEXT;

-CBT;
-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &&S_SUBJ4='AMT_RENTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''' ;

-GOTO NEXT;

-NEXT;


TABLE FILE CARHOLD2
SUM AVG_DLY_RATE/D12.2CS AS 'CAVG'
    BOOKINGS/D8 AS 'CBOOK'
    GROSS_BOOK/D8 AS 'GBOOK'
    DAILY_RATE/D12.2CS AS 'CDRTE'
    MIDBOOK/D8 AS 'CMBOOK'
    MID_DAYS/D8 AS 'CMDAYS'
    MID_AMT/D12.2CS AS 'CMAMT'
    NBR_DAYS AS 'CNDAY'
    NONMIDBOOK/D8 AS 'CNMBOOK'
    NONMID_AMT/D12.2CS AS 'CNMAMT'
    NONMID_DAYS/D8 AS 'CNMDAYS'
    NONZE_AMT/D12.2CS AS 'CNZEAMT'
    NONZEBOOK/D8 AS 'CNZEBK'
    NONZE_DAYS/D8 AS 'CNZDAYS'
    RATE_DLY1/D16.2CS AS 'GCDRTE'
    RENTAL_AMT/D12.2CS AS 'CRAMT'
    RENTAL_DAYS/D12.2CS AS 'CRDAYS'
    RESV_BRANCH
    STD_RATE/D12.2CS AS 'CSTD'
    ZE_AMT/D12.2CS AS 'CZEAMT'
    ZEBOOK/D8 AS 'CZEBOOK'
    ZE_DAYS/D8 AS 'CZDAYS'
    AMT_RENTL1/D16.2CS AS 'GCRAMT'
    
    COMPUTE AVGDR/D12.2CS=IF (RENTAL_AMT LT 0) AND (NBR_DAYS LT 0)
	THEN ((RENTAL_AMT/NBR_DAYS) * (-1)) 
	ELSE RENTAL_AMT/NBR_DAYS; AS 'AVG,DAILY,RATE'
-INCLUDE BYHIERARCHY  
BY LEVEL_DESC    
    
 -INCLUDE OTHPARMS
    
ON TABLE HOLD AS HOLDONE
END
-RUN


DEFINE FILE CARHOLD2
ABSRD/D8 = ABS(RENTAL_DAYS);
END
TABLE FILE CARHOLD2
PRINT ABSRD 
  AGENT_NUM
  AIRPORT_CODE	
  AIRPORT_NAME
  AMT_RENTL1	
  AVG_DLY_RATE
  AVGDR
  BKGS2
  BOOKINGS
  CAR	
  CAR_CAT
  CAR_DESC
  CAR_TOT
  CAR_TYPE	
  COUNTRY_NAME
  CC_NUM	
  DAILY_RATE
  DOD_TYPE
  DROP_CTY_NAME	
  DROP_DAY
  DROP_OFF_DT
  GROSS_BOOK	
  IBOOK
  INV_MY
  INV_MONTH
  KB_AGT
  EMP_ID
  LEVEL1
  LEVEL2
  LEVEL3
  MIDBOOK
  MID_AMT
  MID_DAYS
  NAMEC
  NEW_RENTL_AMT
  NEW_STD_RATE 
  NBR_DAYS
  NMBR_DAYS
  NODAYS	
  NONMIDBOOK
  NONMID_AMT
  NONMID_DAYS
  NONZE_AMT
  NONZEBOOK
  NONZE_DAYS
  NUM_CARS
  ONLINE_TRADITIONAL  
  PASSNGR_NAME	
  PICK_DAY
  PICK_UP_DT
  PICK_CTY_NAME	
  RATE_DLY1
  RENTAL_AMT
  RENTAL_DAYS	
  RESV_BRANCH
  RNTL_TYP
  RSNCDE
  STD_RATE
  TOTAL_STD
  TOTAL_SLSAV
  VENDOR_CODE	
  VENDOR_NAME
  XSPACE	
  ZE_AMT
  ZEBOOK
  ZE_DAYS
  XLEVEL3
  XLEV_3
  XLVL3
  ZE_VNDR 
COMPUTE AVGDR/D12.2CS=IF (RENTAL_AMT LT 0) AND (NBR_DAYS LT 0)
	THEN ((RENTAL_AMT/NBR_DAYS) * (-1)) 
	ELSE RENTAL_AMT/NBR_DAYS; AS 'AVG,DAILY,RATE'
-INCLUDE BYHIERARCHY  
BY LEVEL_DESC
BY REFUSE_CD
-INCLUDE CARRATE
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT ABSRD 
  AGENT_NUM
  AIRPORT_CODE	
  AIRPORT_NAME
  AMT_RENTL1	
  AVG_DLY_RATE	
  AVGDR
  BKGS2
  BOOKINGS
  CAR
  CAR_CAT
  CAR_DESC	
  CAR_TOT
  CAR_TYPE
  COUNTRY_NAME	
  CC_NUM	
  DAILY_RATE
  DOD_TYPE
  DROP_CTY_NAME	
  DROP_DAY
  DROP_OFF_DT
  GROSS_BOOK
  IBOOK
  INV_MY
  INV_MONTH 
  KB_AGT
  EMP_ID
  LEVEL1
  LEVEL2
  LEVEL3
  MIDBOOK
  MID_AMT
  MID_DAYS
  NBR_DAYS
  NAMEC
  NEW_RENTL_AMT
  NEW_STD_RATE
  NMBR_DAYS
  NODAYS	
  NONMIDBOOK
  NONMID_AMT
  NONMID_DAYS
  NONZE_AMT
  NONZEBOOK
  NONZE_DAYS
  NUM_CARS
  ONLINE_TRADITIONAL
 
  PASSNGR_NAME	
  PICK_CTY_NAME
  PICK_DAY
  PICK_UP_DT
  RATE_DLY1	
  RENTAL_AMT
  RENTAL_DAYS	
  RESV_BRANCH
  RNTL_TYP
  RSNCDE
  STD_RATE
  TOTAL_STD
  TOTAL_SLSAV
  VENDOR_CODE	
  VENDOR_NAME
  XSPACE	
  ZE_AMT
  ZEBOOK
  ZE_DAYS
  XLEVEL3
  XLEV_3 
  XLVL3
  ZE_VNDR
-INCLUDE BYHIERARCHY  
BY LEVEL_DESC
BY REFUSE_CD
ON TABLE HOLD
RUN
FILE HOLDONE
SUM 
    CAVG 
    CBOOK
    CDRTE
    CMAMT
    CMBOOK
    CMDAYS
    CNDAY
    CNMAMT
    CNMBOOK
    CNMDAYS
    CNZEAMT
    CNZEBK
    CNZDAYS
    CRAMT
    CRDAYS
    CSTD
    CZEAMT
    CZEBOOK
    CZDAYS
    GBOOK
    GCDRTE
    GCRAMT
-INCLUDE BYHIERARCHY  
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN


DEFINE FILE XTHREE
-*   PCTCRAMT/D8.1S=IF (RENTAL_AMT LT 0) AND (CRAMT LT 0) THEN
-*                  ((RENTAL_AMT/CRAMT)*(-100)) ELSE ((RENTAL_AMT/CRAMT)*100);
  PCTCRAMT/D8.1S = IF ((CRAMT LT 1) AND (CRAMT GT (-1))) THEN 0
                   ELSE ((RENTAL_AMT/CRAMT)*100);
  PCTBK/D8.2S=IF ((CBOOK LT 1) AND (CBOOK GT (-1))) THEN 0
                 ELSE ((BOOKINGS/CBOOK)*100);	
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
-INCLUDE DefineSubtotalFields
END


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
  
-*BY
-IF &&MULTIBREAK NE 'Y' THEN GOTO :NOMULTBREAK;
-INCLUDE LevelNOPRINT
-:NOMULTBREAK
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-IF &&MULTIBREAK NE 'Y' OR &&ALTHIER NE 'Y' THEN GOTO :NOMULTOTAL;
-INCLUDE TOTALBYHIERARCHY
-GOTO SKIPBREAKOPT;
-:NOMULTOTAL
&&BREAKOPTION
-SKIPBREAKOPT
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM

ON TABLE COLUMN-TOTAL
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&SETF EQ 'ABCCARBN' THEN GOTO SKIP_DRILL;

-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-IF &&SETF EQ 'UPCVNDR' GOTO SKIP_DRILL;

-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT



-XXIT
