-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Joy Updated Pref_Non define to contain C/P/N/M/L
-*1/31/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*7/16/14 Updated defines to remove + signs per Neely
-*8/11/14 UPDATED THE FINAL HOLD FILE TO PRINT INSTEAD OF SUM - jk
-* 9/8/14 Updated Pref_non define to use exclude_flags
-*10/29/14 Added Passenger Name - JK
-*  09/21/2016  REJ  S-24432 ER5 Testing updates. 
-*11/16/2016 - RSB - S-26926 - Change reports to read employee ID from EMP_ID
-*                               Changed LEVEL1 to EMP_ID 
 
-INCLUDE SETECHO
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'HTL';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
LOG DUPL MSG OFF
-IF &&FROMAVRP EQ 'Y' GOTO :AB1;
FIXFORM INST_KEY/7 RPT_GROUP/3
-GOTO :AB1_CONT;
-:AB1
FIXFORM INST_KEY/11 RPT_GROUP/3
-:AB1_CONT
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :AB2;
 
MODIFY FILE BRPTFLDS
LOG DUPL MSG OFF
FIXFORM INST_KEY/7 HTL.ID/1 HTL.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG HTL
  ON NOMATCH INCLUDE
  ON MATCH UPDATE HTL.INCL1
DATA ON AIRACH00
END
-RUN
 
-:AB2
 
EX CODEGEN
-RUN
 
-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';
 
DEFINE FILE &&EXTRACT
  CC/A2 = EDIT(CREDIT_CARD, '99');
  FLAG/A1='H';
 HIER1/A15 = AROLL_LEV1;
 HIER2/A32 = AROLL_LEV1||'|'||AROLL_LEV2;
 HIER3/A50 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3;
 HIER4/A66 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4;
 HIER5/A85 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5;
 HIER6/A100 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6;
 HIER7/A120 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7;
 HIER8/A135 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8;
 HIER9/A151 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9;
 HIER10/A168 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9||'|'||AROLL_LEV10;
 HIER11/A185 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9||'|'||AROLL_LEV10||'|'||AROLL_LEV11;
 HIER12/A202 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9||'|'||AROLL_LEV10||'|'||AROLL_LEV11||'|'||AROLL_LEV12;
 HIER13/A219 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9||'|'||AROLL_LEV10||'|'||AROLL_LEV11||'|'||AROLL_LEV12||'|'||AROLL_LEV13;
 HIER14/A236 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9||'|'||AROLL_LEV10||'|'||AROLL_LEV11||'|'||AROLL_LEV12||'|'||AROLL_LEV13||'|'||AROLL_LEV14;
 HIER15/A255 = AROLL_LEV1||'|'||AROLL_LEV2||'|'||AROLL_LEV3||'|'||AROLL_LEV4||'|'||AROLL_LEV5||'|'||AROLL_LEV6||'|'||AROLL_LEV7||'|'||AROLL_LEV8||'|'||AROLL_LEV9||'|'||AROLL_LEV10||'|'||AROLL_LEV11||'|'||AROLL_LEV12||'|'||AROLL_LEV13||'|'||AROLL_LEV14||'|'||AROLL_LEV15;
 
 
 
 HIERA/A255 = IF AROLL_LEV15 NE ' ' THEN HIER15 ELSE
             IF AROLL_LEV14 NE ' ' THEN HIER14 ELSE
             IF AROLL_LEV13 NE ' ' THEN HIER13 ELSE
             IF AROLL_LEV12 NE ' ' THEN HIER12 ELSE
             IF AROLL_LEV11 NE ' ' THEN HIER11 ELSE
             IF AROLL_LEV10 NE ' ' THEN HIER10 ELSE
             IF AROLL_LEV9 NE ' ' THEN HIER9 ELSE
             IF AROLL_LEV8 NE ' ' THEN HIER8 ELSE
             IF AROLL_LEV7 NE ' ' THEN HIER7 ELSE
             IF AROLL_LEV6 NE ' ' THEN HIER6 ELSE
             IF AROLL_LEV5 NE ' ' THEN HIER5 ELSE
             IF AROLL_LEV4 NE ' ' THEN HIER4 ELSE
             IF AROLL_LEV3 NE ' ' THEN HIER3 ELSE
             IF AROLL_LEV2 NE ' ' THEN HIER2 ELSE HIER1;
 
 HIER/A255 = IF AROLL_LEV3 EQ AROLL_LEV4 THEN HIER3 ELSE
             IF AROLL_LEV4 EQ AROLL_LEV5 THEN HIER4 ELSE
             IF AROLL_LEV6 EQ AROLL_LEV7 THEN HIER6 ELSE
             IF AROLL_LEV7 EQ AROLL_LEV8 THEN HIER7 ELSE
             IF AROLL_LEV8 EQ AROLL_LEV9 THEN HIER8 ELSE
             IF AROLL_LEV9 EQ AROLL_LEV10 THEN HIER9 ELSE
             IF AROLL_LEV10 EQ AROLL_LEV11 THEN HIER10 ELSE
             IF AROLL_LEV11 EQ AROLL_LEV12 THEN HIER11 ELSE
             IF AROLL_LEV12 EQ AROLL_LEV13 THEN HIER12 ELSE
             IF AROLL_LEV13 EQ AROLL_LEV14 THEN HIER13 ELSE
             IF AROLL_LEV14 EQ AROLL_LEV15 THEN HIER14 ELSE HIERA;
 
 
  MIR_SEQ1/A1 = EDIT(MIR_SEQ, '9$$$$$');
 
 PREF_CC/A1 = IF CC EQ 'AX' THEN 'Y' ELSE 'N';
 
  NBR_DAYS/P12CS=NUM_DAYS;
  NBR_ROOMS/P12CS = NUM_ROOMS;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  NNROOMS/P12CS = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  PNP_FLAG/A1 = EDIT(EXCLUDE_FLAGS, '$9');
  PNP_IE/A1 = EDIT(EXCLUDE_FLAGS, '$$9');
-* HPREF/A1 = IF CLIENT_PREF EQ 'C' OR 'P' OR 'N' OR 'M' OR 'L' THEN '+' ELSE ' ';
 HPREF/A1 = IF PNP_FLAG EQ 'I' THEN '+' ELSE ' ';
 ONLH/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN '+' ELSE ' ';
 
 HTL_AMT/D12.2CSM = TOTAL_AMT;
 
  XTRAN_DTH/MDYY = INVOICE_DATE;
  TVL_DTH/MDYY = CHKIN_DATE;
 
  XPSNGR_NM/A15        =
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
TKTN/A10 = IF TKT_NUM EQ '0000000000' THEN 'HTL ONLY' ELSE TKT_NUM;
FLAG/A1 = 'H';
RES_ST/A1 = EDIT(RESV_STATUS, '$9');
MIR_SEQ1/A1 = EDIT(MIR_SEQ, '9$$$$$');
 
RES_SYS/A1 = IF MIR_SEQ1 EQ 'X' THEN 'S' ELSE 'A';
 
PROP_CODE1/A7 = IF RES_SYS EQ 'S' THEN PROP_SABRE_CODE ELSE PROP_APOLLO_CODE;
FLAGH/A1 = IF TKTN NE ' ' THEN 'Y' ELSE 'N';
FLAGHP/A1 = 'Y';
 
END
-RUN
 
TABLEF FILE &&EXTRACT
PRINT CLIENT_PREF
      PNR_LOCATOR
      PASSNGR_NAME
      HPREF
      FLAGH
      FLAGHP
      EMP_ID
      ONLH
      FLAG
      TKTN
      HIER
      RES_ST
      RESV_STAT
      RES_SYS
-* WHERE (INVOICE_DATE GE '&&FROMDT.EVAL') AND (INVOICE_DATE LE '&&TODT.EVAL')
 
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE &HTLDATES
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHLDH1
END
-RUN
 
DEFINE FILE RPTHLDH1
PLUS/A8 = '+';
ONE/A2 = '1';
PLUS1/A10 = PLUS|ONE;
 
HPREF1/A5 = IF HPREF EQ '+' AND RES_ST NE 'X' THEN '1' ELSE
            IF HPREF EQ '+' AND RES_ST EQ 'X' THEN '-1' ELSE ' ';
ONLH1/A10 = IF ONLH EQ '+' AND RES_ST NE 'X' THEN '1' ELSE
           IF ONLH EQ '+' AND RES_ST EQ 'X' THEN '-1' ELSE ' ';
END
TABLE FILE RPTHLDH1
PRINT HPREF1 ONLH1 FLAGH FLAGHP
BY HIER
BY PASSNGR_NAME
BY EMP_ID
BY PNR_LOCATOR
BY TKTN
BY RES_SYS
ON TABLE HOLD AS HTLHLD
END
-RUN
 
 
-IF &RECORDS NE 0 THEN GOTO SETA ELSE GOTO SETA1;
 
-SETA
-SET &&HTLDATA='Y';
-GOTO XXIT;
 
-SETA1
-SET &&HTLDATA='N';
-GOTO XXIT;
 
 
-XXIT;
 
