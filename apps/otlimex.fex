-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*  03/31/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-*10/23/15 - S-11851 Added logic for ABACHLOD (DOMESTIC ONLY) ABACHLOI (INTERNATIONAL ONLY) - JM
-*12/30/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels

 
-INCLUDE SETECHO
 
FILEDEF RPTPARMS CLEAR
-RUN
 
EX LIMUSE
-RUN
 
-SET &&RPTGRP = 'LIM';
EX UDIDGEN
-RUN
 
DEFINE FILE BRPTINST
  RT/A3 = 'CAR';
END
TABLE FILE BRPTINST
PRINT RT AS 'RPT_GROUP'
BY INST_KEY
ON TABLE SAVE AS AIRACH00
END
-RUN
MODIFY FILE BRPTINST
FIXFORM INST_KEY/7 RPT_GROUP/3
MATCH INST_KEY
  ON MATCH UPDATE RPT_GROUP
DATA ON AIRACH00
END
-RUN
 
MODIFY FILE BRPTFLDS
FIXFORM INST_KEY/7 CAR.ID/1 CAR.INCL1/1
REPOSITION INST_KEY
MATCH INST_KEY
  ON MATCH CONTINUE
  ON NOMATCH INCLUDE
MATCH * KEYS SEG CAR
  ON NOMATCH INCLUDE
  ON MATCH UPDATE CAR.INCL1
DATA ON AIRACH00
END
-RUN
 
-IF &&FROMAVRP EQ 'Y' GOTO :OTL1;
EX CODEGEN
-:OTL1

-SET &&IDLEVELBREAK = '';

 
-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN

 
DEFINE FILE &&EXTRACT
LIM_AMT/D12.2CS = RENTAL_AMT;
LEVEL_DESC1/A80      = &&LDESC;
-* LBOOK/P8CS = IF DAILY_RATE GE 0 THEN 1 ELSE (-1);
LBOOK/P8CS = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;

NBR_DAYS/D12 = NUM_DAYS;
LIM_DAYS/D12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
 
OTFLAG/A1 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'Y' ELSE 'N';
 
LTKTN/A10 = IF TKT_NUM EQ '0000000000' THEN 'LIMO ONLY' ELSE TKT_NUM;
 
TRN_DATE/YYMD = INVOICE_DATE;
 
LI_AMT/D12.2CS = IF OTFLAG EQ 'Y' THEN LIM_AMT ELSE 0;
LIBOOK/D8CS = IF OTFLAG EQ 'Y' THEN LBOOK ELSE 0;
LT_AMT/D12.2CS = IF OTFLAG EQ 'N' THEN LIM_AMT ELSE 0;
LTBOOK/D8CS = IF OTFLAG EQ 'N' THEN LBOOK ELSE 0;
LIDAYS/D8CS = IF OTFLAG EQ 'Y' THEN LIM_DAYS ELSE 0;
LTDAYS/D8CS = IF OTFLAG EQ 'N' THEN LIM_DAYS ELSE 0;
FLAG/A5 = 'LIMO';
-INCLUDE IDLEVDEFINE 
END
TABLE FILE &&EXTRACT
SUM LIM_AMT LBOOK LIBOOK LTBOOK LI_AMT LT_AMT LIDAYS LTDAYS
BY LEVEL_DESC
BY FLAG
-INCLUDE &CARDATES
-INCLUDE RPTPARMS 

-IF '&&SETF.EVAL' EQ 'ABACHLD' GOTO INTD;
-IF '&&SETF.EVAL' EQ 'ABACHLI' GOTO INTI;
-GOTO INTDONE;
-INTD;
WHERE PICK_CTY.INTL_DOM EQ 'D'
-* WHERE PICK_CTY.GEO_ZONE EQ 'USA'
-GOTO INTDONE;
-INTI;
WHERE PICK_CTY.INTL_DOM EQ 'I'
-* WHERE PICK_CTY.GEO_ZONE NE 'USA'
-GOTO INTDONE;
-INTDONE;
ON TABLE HOLD AS LIMHLD
END
-RUN
 
