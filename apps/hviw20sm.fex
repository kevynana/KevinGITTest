-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File HVIW20SM.FEX
-*  This program was created for the Hotel by Country Report

SET ASNAMES = ON
-RUN

-IF &&SETF EQ 'ABHRC' AND &&CURRENCY NE 'USD' THEN GOTO HRC ELSE
-GOTO NEXT;

-HRC;


-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,AMOUNT, (' | &&CURRENCY || ')';
-SET &CAVG_CUR = 'AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2='AMT_TOTL1/D16.2CS AS ' | '''&TAMT_CUR.EVAL''' ;
-SET &&S_SUBJ3='COMPUTE CAVG/D16.2CS=IF (AMT_TOTL1 LT 0) AND';
-SET &&S_SUBJ4='(NNROOMS LT 0) THEN ((AMT_TOTL1/NNROOMS)*(-1)) ELSE';
-SET &&S_SUBJ5='IF ((NNROOMS LT 1) AND (NNROOMS GT (-1))) THEN 0 ELSE';
-SET &&S_SUBJ6='AMT_TOTL1/NNROOMS; AS ' | '''&CAVG_CUR.EVAL''';




-NEXT;

TABLE FILE HTLHLD
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC	
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5	
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY COUNTRY
ON TABLE HOLD AS HC1 
END
-RUN

TABLE FILE COUNTRY
PRINT COUNTRY_NAME
BY COUNTRY_CODE
ON TABLE HOLD AS HC2
END
-RUN

MATCH FILE HC1
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC	
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5	
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY COUNTRY
ON TABLE HOLD
RUN 
FILE HC2
SUM COUNTRY_NAME
BY COUNTRY_CODE
AFTER MATCH HOLD AS HC3 OLD-AND-NEW
END
-RUN

TABLE FILE HTLHLD
SUM NBR_DAYS AS 'HNDAY'
    NEW_ROOM_RATE/D14.2 AS 'HRRATE'
    RATE_ROOM1/D16.2 AS 'GHRRATE'
    STD_RATE/D14.2 AS 'HSTD'
    NEW_TOTAL_AMT/D14.2 AS 'HTTL'
    AMT_TOTL1/D16.2 AS 'GHTTL'
    BOOKINGS/D8 AS 'HBOOK'
    BY LEVEL_DESC
    ON TABLE HOLD AS HOLDONE
END
-RUN

TABLE FILE HC3
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  COUNTRY_NAME
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC	
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5	
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY LEVEL_DESC
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AMT_TOTALX
  AMT_TOTL1
  BOOKINGS
  CHAIN_CODE	
  CHAIN_NAME
  CITY_ST
  COUNTRY_NAME
  HOTEL_PHONE
  IBOOK	
  IN_DATE
  INV_DATE
  LEVEL_DESC	
  NAMEC	
  NBR_DAYS	
  NBR_ROOMS	
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NUM_DAYS
  NUM_ROOMS	
  OUT_DATE	
  PASSNGR_NAME	
  PROP_ADDRESS	
  PROP_CITY	
  PROP_NAME	
  PROP_STATE_CD
  PROP_ZIP5	
  ROOM_RATE	
  ROOM_TYPE	
  STD_RATE	
  TOTAL_AMT	
  TOTAL_SLSAV
  TOTAL_STD
  XPSNGR_NM
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDONE
SUM HNDAY
    HRRATE
    HSTD
    HTTL
    GHTTL
    GHRRATE
    HBOOK
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN

DEFINE FILE XTHREE
-*   PCTHDAYS/D8.1S=IF (NNROOMS LT 0) AND (HNDAY LT 0) 
-*                  THEN ((NNROOMS/HNDAY)*(-100))
-*                  ELSE ((NNROOMS/HNDAY)*100);
   PCTHDAYS/D8.1S = IF ((HNDAY LT 1) AND (HNDAY GT (-1))) THEN 0
                    ELSE ((NNROOMS/HNDAY)*100);
   PCTHTAMT/D8.1S = IF ((HTTL LT 1) AND (HTTL GT (-1))) THEN 0
                    ELSE ((TOTAL_AMT/HTTL)*100);
   PCTBOOK/D8.1S = IF ((HBOOK LT 1) AND (HBOOK GT (-1))) THEN 0
                    ELSE ((BOOKINGS/HBOOK)*100);                 
-*   PCTHTAMT/D8.1S=IF (TOTAL_AMT LT 0) AND (HTTL LT 0) 
-*                  THEN ((TOTAL_AMT/HTTL)*(-100))
-*                  ELSE ((TOTAL_AMT/HTTL)*100);

-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
