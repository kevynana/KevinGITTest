-* Udid Detail Report
-* 8/23/06 - DEB - Added udid BPAY_AMT BUS_FAR PAY_AMT TIER
-*                 Added code for Modine report
-*1/8/08 - DEB CARRIED THROUGH EXCHG_SALE
-* 12/14/12 - DEB ADDED LEVEL1
-* CHANGED CODE DUE TO DRILL DOWN NOT WORKING - DEB 11/18/13  
-* Added Fields for ABTPCO - Joy 4/1/14
-* Added logic for new report TYACHTP - 4/2/14 
-* Added logic for New Cost Opps by Hierarchy report - JK 4/24/14
-* STORY ID S-06408 CHANGED TKEY DEFINE FOR NEWTP DUE TO DRILL DOWN NOT
-* WORKING CORRECTLY - DEB - 1/8/15
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available 
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 4/30/15 - DEB - S-08628 - ADDED ADV PURCH DAYS ADDCOLLECT AIRLINE_FEE TO ABLDCO
-*5/20/15 - DEB - S-08628 - Added HDRADDC routine to ABLDCO so add coll and pntly amts
-*                          would balance ABEXCH2
-*1/26/16 - JEM - S-14726 Added logic for report CMACHTPO 
-*02/12/16 - DLV - S-13286  Updated to allow reports to sort/subtotal by id-levels
-*03/25/16 - JEM - S-17133 Updated to fix error when running report CG07D
-*06/29/16 - RSB - S-20630 New Employee ID database field
-*                         Changed LEVEL1 to EMP_ID
-*08/15/16 - DLV - S-23485 - Corrected issue with drilldown error for NONE GIVEN 
-*4/26/2017-JEM-S-33318-updated logic for no records report
-*09/01/17 - DLV - S-37468 - added limo data to ABLDCO

-*
-*-INCLUDE SETECHO
SET ASNAMES = ON 
-RUN 

-IF '&&SETF.EVAL' EQ 'CG07D' GOTO 07DUDID;

-IF '&&SETF.EVAL' EQ 'SDACHC' GOTO STAND;

-IF '&&SETF.EVAL' EQ 'TYACHTP' GOTO TYSON;

-IF '&&SETF.EVAL' EQ 'ABLDCO' GOTO NEWLD;

-IF '&&SETF.EVAL' EQ 'CMACHTPO' GOTO CRANEM;


TABLE FILE &&RPT_HOLD
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN TRP_DESC EMP_ID LEVEL1 LEVEL4 XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE
BY LEVEL_DESC
BY TRIP_RSN
BY TRIP_KEY
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS XAONE
END
-RUN


-INCLUDE TPHTLEXD
-RUN

MATCH FILE XAONE
SUM FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE TRP_DESC XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY LEVEL4
BY XPSNGR_NM
BY TKT_NUM
BY EMP_ID
BY LEVEL1
ON TABLE HOLD
RUN
FILE RPTHLDH
SUM HBOOK NNROOMS HTL_AMT HC_ITIN XHINV_DT
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY LEVEL4
BY XPSNGR_NM 
BY TKT_NUM
BY EMP_ID
BY LEVEL1
AFTER MATCH HOLD AS XAHONE OLD-OR-NEW
END
-RUN

DEFINE FILE XAHONE
TKTN1/A10 = IF TKT_NUM NE '0000000000' THEN TKT_NUM ELSE 'HTL ONLY';
CIT/A67 = IF C_ITIN NE ' ' THEN C_ITIN ELSE HC_ITIN;
DATE1/MDYY = IF XTRAN_DT EQ ' ' THEN XHINV_DT ELSE XTRAN_DT;
END
-RUN
TABLE FILE XAHONE
PRINT FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CIT TRIP_KEY TRIP_RSN TRP_DESC TKT_TYPE XFST_DT AIRLINE CIT TKT_NUM C_ITIN DATE1 NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE 
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY LEVEL4
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL1
ON TABLE HOLD AS XAHTWO
END
-RUN


-INCLUDE TPCAREXD
-RUN

 

MATCH FILE XAHTWO
SUM AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT TRIP_RSN TRIP_KEY XFST_DT TKT_TYPE TRP_DESC TRIP_KEY TRIP_RSN DATE1 
    NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE 
BY LEVEL_DESC
BY TRIP_RSN
BY TRIP_KEY
BY TRP_DESC
BY LEVEL4
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL1
-* BY TRIP_KEY
-* BY TRIP_RSN
ON TABLE HOLD
RUN
FILE CARHLD
PRINT CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY LEVEL4
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL1
AFTER MATCH HOLD AS XAHCONE OLD-OR-NEW
END
-RUN
 
DEFINE FILE XAHCONE
CIT1/A67 = IF CIT NE ' ' THEN CIT ELSE CC_ITIN;
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
DATE/MDYY = IF DATE1 EQ ' ' THEN XCINV_DT ELSE DATE1;
 
TRIPDSC/A40 = IF TRIP_RSN EQ 'NONE GIVEN' AND TRP_DESC EQ ' ' THEN 'NONE GIVEN' ELSE 
              IF TRIP_RSN NE ' ' AND TRP_DESC EQ ' ' THEN 'NOT ON FILE' ELSE TRP_DESC;
 
TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' OR TRIPDSC EQ 'NONE GIVEN' THEN 'Z' ELSE 'A';


END
-RUN

TABLE FILE XAHCONE
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT TRIP_KEY TRIP_RSN XFST_DT TKT_TYPE TRIPDSC AS 'TRP_DESC' LEVEL4 EMP_ID LEVEL1 DATE TKEY
      NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE     
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1 AS 'TKT_NUM'
BY CIT1 AS 'C_ITIN'
ON TABLE HOLD AS XAHTWO
END
-RUN


TABLE FILE XAHTWO
SUM TRP_DESC
BY TRIP_KEY
BY TRIP_RSN
WHERE TRP_DESC NE ' '
ON TABLE HOLD AS DSCH1
END
-RUN



MATCH FILE XAHTWO
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT XFST_DT TKT_TYPE 
      LEVEL_DESC XPSNGR_NM TKT_NUM C_ITIN LEVEL4 EMP_ID LEVEL1 DATE TKEY
      NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE  
BY TRIP_KEY
BY TRIP_RSN
ON TABLE HOLD
RUN
FILE DSCH1
SUM TRP_DESC
BY TRIP_KEY
BY TRIP_RSN
AFTER MATCH HOLD AS TPH1 OLD-AND-NEW
END
-RUN
 
 




-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'TPH1';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************
DEFINE FILE TPH1
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
LVL4/A30 = EDIT(LEVEL4, '999999999999999999999999999999');
-*TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' THEN 'Z' ELSE 'A';

END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADAIR' ELSE 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE TPH1
HEADING
-INCLUDE &&PAHDR
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10

-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-GOTO XXIT

-07DUDID;

-INCLUDE RETUDID
-RUN

TABLE FILE &&RPT_HOLD
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN LEVEL4 LEVEL_DESC XPSNGR_NM TKT_NUM
BY AIR_KEY
ON TABLE HOLD AS XAONE FORMAT FOCUS INDEX AIR_KEY
END
-RUN

EX UDCG07DDT
-RUN

-IF &&CG07DDT EQ 'Y' THEN GOTO NORECORDS;


-INCLUDE 07HTLEXD
-RUN

MATCH FILE XATWO
PRINT FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE 7D_DSC 7D_DSC1
BY LEVEL_DESC
BY LEVEL4
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HTLHLD
SUM HBOOK NNROOMS HTL_AMT 
BY LEVEL_DESC
BY LEVEL4
BY XPSNGR_NM 
BY TKT_NUM
AFTER MATCH HOLD AS XAHONE OLD
END
-RUN

TABLE FILE XAHONE
PRINT FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE 7D_DSC 7D_DSC1 HBOOK NNROOMS HTL_AMT
BY LEVEL_DESC
BY LEVEL4
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS XAHTWO
END
-RUN

-INCLUDE 07CAREXD
-RUN

MATCH FILE XAHTWO
PRINT AIRLINE FARE_PAID C_ITIN NET_TKT_CNT HBOOK NNROOMS HTL_AMT XFST_DT TKT_TYPE 7D_DSC 7D_DSC1
BY LEVEL_DESC
BY LEVEL4
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT 
BY LEVEL_DESC
BY LEVEL4
BY XPSNGR_NM
BY TKT_NUM
AFTER MATCH HOLD AS XAHCONE OLD
END
-RUN

DEFINE FILE XAHCONE
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
END
TABLE FILE XAHCONE
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT XFST_DT TKT_TYPE LEVEL4 7D_DSC 7D_DSC1
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY C_ITIN
ON TABLE HOLD AS TPH1
END
-RUN


-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'TPH1';
-INCLUDE DRILWHRS
-SKIP_DRIL

-************************************************************

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADAIR' ELSE 'HDREXLS1'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;

DEFINE FILE TPH1
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
LVL4/A30 = EDIT(LEVEL4, '999999999999999999999999999999');
END
-RUN
TABLE FILE TPH1
HEADING
-INCLUDE &&PAHDR
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 



-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-GOTO XXIT

-STAND;
 

DEFINE FILE AIRHOLD2
FLAG/A1 = 'A';
END
-RUN
TABLE FILE AIRHOLD2
PRINT FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN XTRAN_DT INVOICE_NUM EMB_CTY_NM AS 'ECTY' DISSAVINGS REFUSAL_DESC AIRLINE_NAME
BY FLAG
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS XAONE
END
-RUN

-INCLUDE TPHTLEXD
-RUN

MATCH FILE XAONE
PRINT FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE XTRAN_DT INVOICE_NUM ECTY DISSAVINGS REFUSAL_DESC AIRLINE_NAME
BY FLAG
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HTLHLD
PRINT HBOOK NNROOMS HTL_AMT HC_ITIN XHINV_DT HINV_NUM HCOM HRSNCDE CHAIN_NAME
BY FLAG
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM 
BY TKT_NUM
AFTER MATCH HOLD AS XAHONE OLD-OR-NEW
END
-RUN


DEFINE FILE XAHONE
TKTN1/A10 = IF TKT_NUM NE '0000000000' THEN TKT_NUM ELSE 'HTL ONLY';
CIT/A67 = IF C_ITIN NE ' ' THEN C_ITIN ELSE HC_ITIN;
CITA/A67 = IF C_ITIN EQ ' ' THEN HC_ITIN ELSE ECTY;
-* DATE1/MDYY = IF XTRAN_DT EQ ' ' THEN XHINV_DT ELSE XTRAN_DT;
DATE1/MDYY = IF FLAG EQ 'H' THEN XHINV_DT ELSE XTRAN_DT;

INVN/A7 = IF INVOICE_NUM NE ' ' THEN INVOICE_NUM ELSE HINV_NUM;
END
-RUN
TABLE FILE XAHONE
PRINT FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CIT TKT_TYPE XFST_DT AIRLINE CIT TKT_NUM C_ITIN DATE1 INVN CITA DISSAVINGS REFUSAL_DESC HCOM HRSNCDE AIRLINE_NAME CHAIN_NAME
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM
BY FLAG
BY TKTN1
ON TABLE HOLD AS XAHTWO
END
-RUN


-INCLUDE TPCAREXD
-RUN

MATCH FILE XAHTWO
PRINT AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT XFST_DT TKT_TYPE DATE1 INVN CITA DISSAVINGS REFUSAL_DESC HCOM HRSNCDE AIRLINE_NAME CHAIN_NAME
BY FLAG
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM
BY TKTN1
ON TABLE HOLD
RUN
FILE CARHLD
PRINT CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT CINV_NUM CCOM CRSNCDE VENDOR_NAME
BY FLAG
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM
BY TKTN1
AFTER MATCH HOLD AS XAHCONE OLD-OR-NEW
END
-RUN

DEFINE FILE XAHCONE
CIT1/A67 = IF CIT NE ' ' THEN CIT ELSE CC_ITIN;
CIT1A/A67 = IF CITA NE ' ' THEN CITA ELSE CC_ITIN;
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
DATE/MDYY = IF FLAG EQ 'C' THEN XCINV_DT ELSE DATE1;
 
INVN1/A7 = IF INVN EQ ' ' THEN CINV_NUM ELSE INVN;
FLAG1/A5 = IF FLAG EQ 'A' THEN 'AIR' ELSE
           IF FLAG EQ 'C' THEN 'CAR' ELSE 'HOTEL';

CHRSN/A48 = IF FLAG EQ 'H' THEN HRSNCDE ELSE
            IF FLAG EQ 'C' THEN CRSNCDE ELSE ' ';

VENDOR/A30 = IF FLAG EQ 'A' THEN AIRLINE_NAME ELSE
             IF FLAG EQ 'C' THEN VENDOR_NAME ELSE CHAIN_NAME;

END
-RUN

TABLE FILE XAHCONE
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT XFST_DT TKT_TYPE DATE INVN1 CIT1A DISSAVINGS REFUSAL_DESC HCOM CCOM CHRSN VENDOR
BY LEVEL_DESC
BY AROLL_DSC3
BY AROLL_DSC4
BY XPSNGR_NM
BY FLAG1
BY TKTN1 AS 'TKT_NUM'
BY CIT1 AS 'C_ITIN'
ON TABLE HOLD AS XAHTWO
END
-RUN


DEFINE FILE XAHTWO
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END
-RUN

-SET &&PAHDR = 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE XAHTWO
-INCLUDE &&PAHDR
"&&SUBHEAD"
"</2"
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 



-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT;


-TYSON;

-INCLUDE RETUDID
-RUN


TABLE FILE &&RPT_HOLD
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN TRP_DESC EMP_ID LEVEL4 XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE 
      LEVEL_DESC TRIP_RSN TRIP_KEY XPSNGR_NM TKT_NUM
BY AIR_KEY 
ON TABLE HOLD AS XAONE FORMAT FOCUS INDEX AIR_KEY
END
-RUN

EX UDTYAD
-RUN

-IF &&TYBBDDT EQ 'Y' THEN GOTO NORECORDS;


-INCLUDE TYHTLEXD
-RUN

MATCH FILE XATWO
SUM FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE TRP_DESC XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE BKD_BY
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HTLHLD
SUM HBOOK NNROOMS HTL_AMT HC_ITIN XHINV_DT HBKD_BY HD_BILL
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY XPSNGR_NM 
BY TKT_NUM
AFTER MATCH HOLD AS XAHONE OLD-OR-NEW
END
-RUN

DEFINE FILE XAHONE
TKTN1/A10 = IF TKT_NUM NE '0000000000' THEN TKT_NUM ELSE 'HTL ONLY';
CIT/A67 = IF C_ITIN NE ' ' THEN C_ITIN ELSE HC_ITIN;
DATE1/MDYY = IF XTRAN_DT EQ ' ' THEN XHINV_DT ELSE XTRAN_DT;
BKD_BY1/A64 = IF BKD_BY NE ' ' THEN BKD_BY ELSE HBKD_BY;
END
-RUN
TABLE FILE XAHONE
PRINT FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CIT TRIP_KEY TRIP_RSN TRP_DESC TKT_TYPE XFST_DT AIRLINE CIT TKT_NUM C_ITIN DATE1 NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE
      BKD_BY1 HD_BILL
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY XPSNGR_NM
BY TKTN1
ON TABLE HOLD AS XAHTWO
END
-RUN
 

-INCLUDE TYCAREXD
-RUN

MATCH FILE XAHTWO
SUM AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT TRIP_RSN TRIP_KEY XFST_DT TKT_TYPE TRP_DESC TRIP_KEY TRIP_RSN DATE1
    NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE BKD_BY1 HD_BILL 
BY LEVEL_DESC
BY TRIP_RSN
BY TRIP_KEY
BY TRP_DESC
BY XPSNGR_NM
BY TKTN1
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT CBKD_BY CD_BILL
BY LEVEL_DESC
BY TRIP_RSN
BY TRP_DESC
BY TRIP_KEY
BY XPSNGR_NM
BY TKTNC
AFTER MATCH HOLD AS XAHCONE OLD-OR-NEW
END
-RUN

DEFINE FILE XAHCONE
CIT1/A67 = IF CIT NE ' ' THEN CIT ELSE CC_ITIN;
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
DATE/MDYY = IF DATE1 EQ ' ' THEN XCINV_DT ELSE DATE1;
 
TRIPDSC/A40 = IF TRIP_RSN EQ 'NONE GIVEN' AND TRP_DESC EQ ' ' THEN 'NONE GIVEN' ELSE 
              IF TRIP_RSN NE ' ' AND TRP_DESC EQ ' ' THEN 'NOT ON FILE' ELSE TRP_DESC;
 
TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' OR TRIPDSC EQ 'NONE GIVEN' THEN 'Z' ELSE 'A';
BKD_BY2/A64 = IF BKD_BY1 NE ' ' THEN BKD_BY1 ELSE CBKD_BY;
TKT/A10 = IF TKTN1 NE ' ' THEN TKTN1 ELSE TKTNC;
END
-RUN

TABLE FILE XAHCONE
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT TRIP_KEY TRIP_RSN XFST_DT TKT_TYPE TRIPDSC AS 'TRP_DESC' DATE TKEY
      NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE BKD_BY2 HD_BILL CD_BILL    
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT AS 'TKT_NUM'
BY CIT1 AS 'C_ITIN'
ON TABLE HOLD AS XAHTWO
END
-RUN

TABLE FILE XAHTWO
SUM TRP_DESC
BY TRIP_KEY
BY TRIP_RSN
WHERE TRP_DESC NE ' '
ON TABLE HOLD AS DSCH1
END
-RUN


MATCH FILE XAHTWO
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT XFST_DT TKT_TYPE 
      LEVEL_DESC XPSNGR_NM TKT_NUM C_ITIN DATE TKEY BKD_BY2 HD_BILL CD_BILL
BY TRIP_KEY
BY TRIP_RSN
ON TABLE HOLD
RUN
FILE DSCH1
SUM TRP_DESC
BY TRIP_KEY
BY TRIP_RSN
AFTER MATCH HOLD AS TPH1 OLD-AND-NEW
END
-RUN


 

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'TPH1';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************
DEFINE FILE TPH1
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
DIR_BILL/A1 = IF HD_BILL EQ 'Y' THEN 'Y' ELSE 
              IF CD_BILL EQ 'Y' THEN 'Y' ELSE ' ';
END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADAIR' ELSE 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE TPH1
HEADING
-INCLUDE &&PAHDR
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 



-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO XXIT;

-NEWLD;

TABLE FILE &&RPT_HOLD
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN TRP_DESC EMP_ID LEVEL4 XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE NEW_ADV_PURCH 
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS AIRHOLD1
END
-RUN


DEFINE FILE &&RPT_HOLD
 REC_CNT/D8CS = IF NET_TKT_CNT EQ 1 THEN 1 ELSE 0;
  TTLDAYS/D8 = NEW_ADV_PURCH*REC_CNT;
  
END                    
TABLE FILE &&RPT_HOLD
SUM NET_TKT_CNT AS 'PTTKT'
REC_CNT
TTLDAYS
COMPUTE PADV/P8 = IF ((REC_CNT LT 1) AND (REC_CNT GT (-1))) THEN 0 ELSE 
            (TTLDAYS/REC_CNT); 
BY LEVEL_DESC 
BY XPSNGR_NM

BY TKT_NUM
ON TABLE HOLD AS PHOLDONE
END
-RUN

MATCH FILE AIRHOLD1
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN TRP_DESC EMP_ID LEVEL4 XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE   
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE PHOLDONE
PRINT PADV
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
AFTER MATCH HOLD AS XONE OLD-OR-NEW
END
-RUN


-INCLUDE HDRADDC
-RUN

TABLE FILE EXHOLD2
SUM AC_AMT PNLTY_AMT
BY LEVEL_DESC
 
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD AS EXCAIR2
END
-RUN 




 

MATCH FILE XONE
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN TRP_DESC EMP_ID LEVEL4 XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV  
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE EXCAIR2
PRINT AC_AMT PNLTY_AMT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
AFTER MATCH HOLD AS XAONE OLD-OR-NEW
END
-RUN




-INCLUDE TPHTLEXD
-RUN

MATCH FILE XAONE
SUM FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE TRP_DESC XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV AC_AMT PNLTY_AMT 
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
BY EMP_ID
BY LEVEL4
ON TABLE HOLD
RUN
FILE RPTHLDH
SUM HBOOK NNROOMS HTL_AMT HC_ITIN XHINV_DT
BY LEVEL_DESC
BY XPSNGR_NM 
BY TKT_NUM
BY EMP_ID
BY LEVEL4
AFTER MATCH HOLD AS XAHONE OLD-OR-NEW
END
-RUN


-INCLUDE TPCAREXD
-RUN



DEFINE FILE XAHONE
TKTN1/A10 = IF TKT_NUM NE '0000000000' THEN TKT_NUM ELSE 'HTL ONLY';
CIT/A67 = IF C_ITIN NE ' ' THEN C_ITIN ELSE HC_ITIN;
DATE1/MDYY = IF XTRAN_DT EQ ' ' THEN XHINV_DT ELSE XTRAN_DT;
END
-RUN
TABLE FILE XAHONE
PRINT FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CIT TKT_TYPE XFST_DT AIRLINE CIT TKT_NUM C_ITIN DATE1 NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV AC_AMT PNLTY_AMT 
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL4
ON TABLE HOLD AS XAHTWO
END
-RUN
 


MATCH FILE XAHTWO
SUM AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT XFST_DT TKT_TYPE DATE1
    NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV AC_AMT PNLTY_AMT 
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL4
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL4
AFTER MATCH HOLD AS XAHCONE OLD-OR-NEW
END
-RUN


-INCLUDE TPLIMEXD
-RUN
-IF &&NOLIMRCD EQ 'Y' THEN GOTO NoLIMD;

MATCH FILE XAHCONE
SUM AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT XFST_DT TKT_TYPE DATE1
    NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV AC_AMT PNLTY_AMT 
    CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT    
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL4
ON TABLE HOLD
RUN
FILE LIMHLD
SUM LBOOK LIM_DAYS LIM_AMT LL_ITIN XLINV_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL4
AFTER MATCH HOLD AS XAHCLONE OLD-OR-NEW
END
-RUN

-GOTO LIMcont;

-NoLIMD;

DEFINE FILE XAHCONE
LBOOK/P8CS = 0;
LIM_DAYS/D12 = 0;
LIM_AMT/D12.2CS = 0;
LL_ITIN/A67 = ' ';
XLINV_DT/MDYY  = ' ' ;
END 
TABLE FILE XAHCONE
SUM AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT XFST_DT TKT_TYPE DATE1
    NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV AC_AMT PNLTY_AMT 
    CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT 
    LBOOK LIM_DAYS LIM_AMT LL_ITIN XLINV_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
BY EMP_ID
BY LEVEL4
ON TABLE HOLD AS XAHCLONE
END
-RUN
 


-LIMcont;

DEFINE FILE XAHCLONE
CIT1/A67 = IF CIT NE ' ' THEN CIT ELSE LL_ITIN;
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
DATE/MDYY = IF DATE1 EQ ' ' THEN XLINV_DT ELSE DATE1; 
END
TABLE FILE XAHCLONE
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT XFST_DT TKT_TYPE LEVEL4 EMP_ID DATE 
      NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE PADV AC_AMT PNLTY_AMT 
      LBOOK LIM_DAYS LIM_AMT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1 AS 'TKT_NUM'
BY CIT1 AS 'C_ITIN'
ON TABLE HOLD AS XAHTWO
END
-RUN
 
 

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'XAHTWO';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************
DEFINE FILE XAHTWO
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
LVL4/A30 = EDIT(LEVEL4, '999999999999999999999999999999');
-IF '&&SETF.EVAL' EQ 'ABLDCO' THEN GOTO NoTripKey;
TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' OR TRP_DESC EQ 'NONE GIVEN' THEN 'B' ELSE 'A';

-*TKEY/A1 = IF TRIP_RSN EQ 'NONE GIVEN' THEN 'Z' ELSE 'A';
-NoTripKey
END
-RUN
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'TPHEADAIR' ELSE 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

-IF '&&NOLIMRCD.EVAL' EQ 'Y' THEN GOTO SKIPset;

-SET &&PRINT10 = 'LIM_AMT AS ''Limo,Amount'' LBOOK AS ''Limo,Bookings''';
-SET &&ONTABLE3='CAR_AMT CAR_DAYS LIM_AMT LBOOK AS ''Total For''';



-SKIPset;


TABLE FILE XAHTWO
HEADING
-INCLUDE &&PAHDR
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 
 


-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-GOTO XXIT;

-CRANEM;

-INCLUDE RETUDID
-RUN


TABLE FILE &&RPT_HOLD
PRINT TKT_NUM FARE_PAID NET_TKT_CNT TKT_TYPE XFST_DT AIRLINE C_ITIN EMP_ID LEVEL4 XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE
      LEVEL_DESC  XPSNGR_NM TKT_NUM
BY AIR_KEY 
ON TABLE HOLD AS XAONE FORMAT FOCUS INDEX AIR_KEY
END
-RUN


EX UDCMTPO
-RUN


-IF &&CMBBDDT EQ 'Y' THEN GOTO NORECORDS;


-INCLUDE CMHTLEXD
-RUN


MATCH FILE XATWO
SUM FARE_PAID NET_TKT_CNT C_ITIN AIRLINE XFST_DT TKT_TYPE XTRAN_DT NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE EMP_ID ATPO 
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HTLHLD
SUM HBOOK NNROOMS HTL_AMT HC_ITIN XHINV_DT HTPO
BY LEVEL_DESC
BY XPSNGR_NM 
BY TKT_NUM
AFTER MATCH HOLD AS XAHONE OLD-OR-NEW
END
-RUN

DEFINE FILE XAHONE
TKTN1/A10 = IF TKT_NUM NE '0000000000' THEN TKT_NUM ELSE 'HTL ONLY';
CIT/A67 = IF C_ITIN NE ' ' THEN C_ITIN ELSE HC_ITIN;
DATE1/MDYY = IF XTRAN_DT EQ ' ' THEN XHINV_DT ELSE XTRAN_DT;
TPO1/A64 = IF ATPO NE ' ' THEN ATPO ELSE HTPO;
END
-RUN
TABLE FILE XAHONE
PRINT FARE_PAID NET_TKT_CNT HBOOK NNROOMS HTL_AMT CIT TKT_TYPE XFST_DT AIRLINE CIT TKT_NUM C_ITIN DATE1 NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE
      TPO1
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
ON TABLE HOLD AS XAHTWO
END
-RUN

-INCLUDE CMCAREXD
-RUN


MATCH FILE XAHTWO
SUM AIRLINE FARE_PAID NET_TKT_CNT CIT HBOOK NNROOMS HTL_AMT XFST_DT TKT_TYPE DATE1 TPO1
    NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE 
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTN1
ON TABLE HOLD
RUN
FILE CARHLD
SUM CBOOK CAR_DAYS CAR_AMT CC_ITIN XCINV_DT CTPO
BY LEVEL_DESC
BY XPSNGR_NM
BY TKTNC
AFTER MATCH HOLD AS XAHCONE OLD-OR-NEW
END
-RUN

DEFINE FILE XAHCONE
CIT1/A67 = IF CIT NE ' ' THEN CIT ELSE CC_ITIN;
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
DATE/MDYY = IF DATE1 EQ ' ' THEN XCINV_DT ELSE DATE1;
TPO2/A64 = IF TPO1 NE ' ' THEN TPO1 ELSE CTPO;
 

TKT/A10 = IF TKTN1 NE ' ' THEN TKTN1 ELSE TKTNC;
END
-RUN

TABLE FILE XAHCONE
PRINT AIRLINE FARE_PAID NET_TKT_CNT NNROOMS HTL_AMT CAR_DAYS CAR_AMT XFST_DT TKT_TYPE  DATE 
      NEW_SEG_LOW NFVSV DISSAVINGS REFUSE_CODE  TPO2   
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT AS 'TKT_NUM'
BY CIT1 AS 'C_ITIN'
ON TABLE HOLD AS TPH1
END



-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRILCM;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'TPH1';
-INCLUDE DRILWHRS
-SKIP_DRILCM
-************************************************************
DEFINE FILE TPH1
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);

END
-RUN

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADACH' ELSE 'HDREXACH'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE TPH1
HEADING
-INCLUDE &&PAHDR
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPCCM;
"</2"
-NOSPCCM;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHRCM;
-INCLUDE &&DRILLWHR
-SKIP_WHRCM
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 



-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-GOTO XXIT;



-NORECORDS



-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-XXIT
