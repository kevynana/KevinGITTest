-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 2/25/05 - DEB - ADDED CODE FOR GLOBAL CURRENCY

-INCLUDE SETECHO

-SET &&OV_OFF = &&WEB_PATH || 'OV_OFF.FOC';
-RUN
FILEDEF OV_OFF DISK &&OV_OFF
-RUN

CREATE FILE OV_OFF
-RUN

SET ASNAMES=ON

DEFINE FILE GNONHLD
CY/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND
           TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PY/A1 =  IF TRN_DATE GE &&FXDATE.EVAL AND
               TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
RSN1/A30 =  IF REFUSE_CODE EQ 'AS' THEN 'CARRIER PREFERENCE' ELSE
           IF REFUSE_CODE EQ 'TS' THEN 'TIME NOT CONVENIENT' ELSE
           IF REFUSE_CODE EQ 'NR' THEN 'MORE COSTLY/REF TKT CLS' ELSE
           IF REFUSE_CODE EQ 'AA' OR 'CX' THEN 
                             'ALT ARPT/CONNEC REJECTED' ELSE
           IF REFUSE_CODE EQ 'AP' THEN 'BKG LESS THAN 7 DAYS' ELSE
                             'OTHER';
RSN/A30 = LCWORD(30, RSN1, RSN);
TRSN1/A5 = 'Total';
                  

-* DEFINES ON PREVIOUS DEFINES

END
-RUN

TABLE FILE GNONHLD
SUM NET_TKT_CNT
    PCT.NET_TKT_CNT AS 'PCTNET'
    NAMEC
BY RSN
WHERE CY EQ 'Y'
ON TABLE HOLD AS OVLST1
END
-RUN

DEFINE FILE OVLST1
LABEL/A30 = 'Lost Airline Savings';
CATEGORY/A61 = IF NAMEC EQ ' ' THEN LABEL ELSE LABEL||'-'||NAMEC;
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE OVLST1
PRINT CATEGORY/A61 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D16 AS 'VOL_CURR' AND 
PCTNET/D16 AS 'TKT_CURR'  
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
ON TABLE HOLD AS OVLOST1
END
-RUN

TABLE FILE OVLOST1
PRINT CAT_ORDER ROW_ORDER VOL_CURR TKT_CURR
BY CATEGORY
BY ROW_LABEL
ON TABLE HOLD AS OVLOSTA
END
-RUN

MODIFY FILE OV_OFF
FIXFORM FROM OVLOSTA
MATCH CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OVLOSTA
END
-RUN

TABLE FILE GNONHLD
SUM NET_TKT_CNT
    PCT.NET_TKT_CNT AS 'PCTNET'
    NAMEC
BY RSN
WHERE PY EQ 'Y'
ON TABLE HOLD AS PRLST
END
-RUN


DEFINE FILE PRLST
LABEL/A30 = 'Lost Airline Savings';
CATEGORY/A61 = IF NAMEC EQ ' ' THEN LABEL ELSE LABEL||'-'||NAMEC;
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE PRLST
PRINT CATEGORY/A61 AND RSN/A30 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND NET_TKT_CNT/D16 AS 'VOL_PRIOR' AND 
PCTNET/D16 AS 'TKT_PRIOR' AND 
COMPUTE ROW_ORDER/I2 = ROW_ORDER + 1;    
ON TABLE HOLD AS PRLST1
END
-RUN


TABLE FILE PRLST1
PRINT CAT_ORDER ROW_ORDER VOL_PRIOR TKT_PRIOR
BY CATEGORY
BY ROW_LABEL
ON TABLE HOLD AS PRLST2
END
-RUN


MODIFY FILE OV_OFF
FIXFORM FROM PRLST2
MATCH CATEGORY ROW_LABEL
ON MATCH UPDATE VOL_PRIOR TKT_PRIOR
ON NOMATCH REJECT
DATA ON PRLST2
END
-RUN



