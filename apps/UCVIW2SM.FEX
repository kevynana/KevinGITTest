-* 1/30/13 - DEB changed due to expansion of car database to
-* include trip purpose
-*4/7/14 - DEB - added code to skip RETUDID to speed up report
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*4/26/2017-JEM-S-33318-updated logic for no records report

-INCLUDE SETECHO

SET ASNAMES=ON
-RUN

-IF '&&SETF.EVAL' EQ 'ABUCTRP' THEN GOTO NOudid;
-INCLUDE RETUDID


-NOudid

TABLE FILE &&RPT_HOLD
PRINT CAR_KEY
      BOOKINGS 
      CAR_TYPE       
      DAILY_RATE       
      DROP_CTY_NAME
      DROP_OFF_DT      
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM       
      LEVEL_DESC       
      NBR_DAYS 
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      TRIP_PURPOSE
      TRIP_RSN
      VENDOR_NAME 
BY LEVEL_DESC
ON TABLE HOLD AS CHLD1
END
-RUN

TABLE FILE &&RPT_HOLD
SUM 
  RENTAL_DAYS AS 'TDAY'
  RENTAL_AMT AS 'TAMT'
BY LEVEL_DESC 
-INCLUDE CARRATE
ON TABLE HOLD AS CHOLD2
END
-RUN

MATCH FILE CHLD1
PRINT CAR_KEY
      BOOKINGS 
      CAR_TYPE
      DAILY_RATE
      DROP_CTY_NAME
      DROP_OFF_DT
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      TRIP_PURPOSE
      TRIP_RSN
      VENDOR_NAME 
BY LEVEL_DESC
ON TABLE HOLD  
RUN
FILE CHOLD2
SUM TDAY
    TAMT
BY LEVEL_DESC
AFTER MATCH HOLD AS CHOLD3 OLD-OR-NEW
END
-RUN

TABLE FILE CHOLD3
PRINT CAR_KEY
      BOOKINGS 
      CAR_TYPE
      DAILY_RATE
      DROP_CTY_NAME
      DROP_OFF_DT
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      VENDOR_NAME 
      TRIP_PURPOSE
      TRIP_RSN
      TDAY
      TAMT
BY CAR_KEY
ON TABLE HOLD AS CHOLD4
END
-RUN

-IF '&&SETF.EVAL' EQ 'ABUCTRP' THEN GOTO EXBUCKLE;

-IF '&&SETF.EVAL' EQ 'JHUCFBO' THEN GOTO EXJHA;
-IF '&&SETF.EVAL' EQ 'LFCBCDS' THEN GOTO EXLIFE;

-EXBUCKLE

DEFINE FILE CHOLD4
TRP_PRP/A2 = TRIP_PURPOSE;

END
TABLE FILE CHOLD4
PRINT 
      BOOKINGS 
      CAR_TYPE
      DAILY_RATE
      DROP_CTY_NAME
      DROP_OFF_DT
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      VENDOR_NAME 
      TDAY
      TAMT
BY TRP_PRP 
ON TABLE HOLD AS CHOLD5
END
-RUN

DEFINE FILE TRP_REF
 TRIP_KEY/A2   = EDIT(TRP_KEY, '$$$$$$$$99');
 TRP_PRP/A2  = TRIP_KEY;  
END
TABLE FILE TRP_REF
PRINT TRP_DESC
BY TRP_PRP 
WHERE TRP_KEY CONTAINS '&&ROLLUP.EVAL'
ON TABLE HOLD AS CTRIPRSN
END
-RUN


-IF &LINES NE 0 THEN GOTO SkipThis;


DEFINE FILE CHOLD4
TRP_PRP/A2 = TRIP_PURPOSE;
END
TABLE FILE CHOLD4
PRINT CAR_KEY
      BOOKINGS 
      CAR_TYPE
      DAILY_RATE
      DROP_CTY_NAME
      DROP_OFF_DT
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      VENDOR_NAME 
      TDAY
      TAMT
BY TRP_PRP
ON TABLE HOLD AS CHOLD5
END
-RUN

-SkipThis



MATCH FILE CHOLD5
PRINT BOOKINGS
      CAR_TYPE
      DAILY_RATE
      DROP_CTY_NAME
      DROP_OFF_DT
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      VENDOR_NAME  
BY TRP_PRP
ON TABLE HOLD
RUN
FILE CTRIPRSN
SUM TRP_DESC
BY TRP_PRP
AFTER MATCH HOLD AS XONE OLD-AND-NEW
END
-RUN

 
DEFINE FILE XONE
TRP_PRP2/A10 = IF TRP_PRP EQ ' ' THEN 'NONE GIVEN' ELSE TRP_PRP;
END
TABLE FILE XONE
PRINT BOOKINGS
      CAR_TYPE
      DAILY_RATE
      DROP_CTY_NAME
      DROP_OFF_DT
      INV_DATE       
      INVOICE_DATE
      INVOICE_NUM
      LEVEL_DESC
      NBR_DAYS
      PASSNGR_NAME
      PICK_CTY_NAME      
      PICK_UP_DT
      PNR_LOCATOR
      REFUSAL_DESC
      REFUSE_CODE
      RENTAL_AMT
      RENTAL_DAYS
      VENDOR_NAME  
      TRP_DESC
      TRP_PRP
      TRP_PRP2
BY LEVEL_DESC
ON TABLE HOLD AS CHOLD6
END
-RUN


-IF &RECORDS EQ 0 THEN GOTO NORECORDS;

-GOTO Finalrpt;

-EXJHA

EX UDCJHA
-RUN

-IF '&&NOJHAREC.EVAL' EQ 'Y' THEN GOTO NORECORDS;
-GOTO Finalrpt


-EXLIFE

EX UDCLIF
-RUN

-IF '&&NOLIFREC.EVAL' EQ 'Y' THEN GOTO NORECORDS;
-GOTO Finalrpt



-Finalrpt

DEFINE FILE CHOLD6 ADD
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE CHOLD6
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
  
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10


-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT

-NORECORDS
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' OR 'CDD' OR 'HDD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT






