-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* View Created to Produce Conagra reports with 3 or more occurrences.
-* 0-13 Advanced with 3 or more occurrences, Lost savings $200 or more
-* with 3 or more occurrences, Non Visa Usage with 3 or more occurrences
-* Created by JK 10/8/03
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*4/24/2017-JEM-S-33318-updated logic for no records report
-*09/28/2017 - JEM - S-35422 Place the footer date/time stamp text in a separate file to be -INCLUDED in the stylesheets

-********************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON

TABLE FILE &&RPT_HOLD
PRINT DISSAVINGS	
     FARE_PAID
     LEVEL_DESC
     LEVEL1
     NET_TKT_CNT
BY XPSNGR_NM
ON TABLE HOLD AS XTWO
END
-RUN


TABLE FILE XTWO
SUM NET_TKT_CNT AS 'NET_TKT_CNT1'
BY XPSNGR_NM
ON TABLE HOLD AS XNAMES
END
-RUN

DEFINE FILE XNAMES
PSNGR_CNT/A1=IF NET_TKT_CNT1 GE 3 THEN 'Y' ELSE 'N';
END
TABLE FILE XNAMES
SUM NET_TKT_CNT1 AS 'NET_TKT_CNT'
BY XPSNGR_NM
WHERE PSNGR_CNT EQ 'Y'
ON TABLE HOLD AS MULTIOFF
END
-RUN
 


MATCH FILE XTWO
SUM  DISSAVINGS
     FARE_PAID
     LEVEL_DESC
     LEVEL1
BY XPSNGR_NM
ON TABLE HOLD
RUN 
FILE MULTIOFF
PRINT NET_TKT_CNT  
BY XPSNGR_NM
AFTER MATCH HOLD AS AIRHOLD6 OLD-AND-NEW
END
-RUN

 
-SET &&NRECDT = IF &RECORDS EQ 0 THEN 'Y' ELSE 'N';

-IF &RECORDS EQ 0 THEN GOTO NORECORDS;


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


DEFINE FILE AIRHOLD6
LEVEL_D/A60 =  IF XPSNGR_NM NE LAST XPSNGR_NM THEN LEVEL_DESC ELSE ' ';
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
END
TABLE FILE AIRHOLD6
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3



-NORECORDS
 
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT

-SKIP_R3

