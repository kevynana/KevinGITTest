-GOTO BRKSTN
-* -GOTO PRINCST
-* -GOTO PRINCSU
-GOTO PRINC

-AIR

TABLE FILE SR_50
SUM AIR_KEY AROLL_LEV4
BY AIR_KEY NOPRINT
BY AROLL_LEV4 NOPRINT
IF TRN_DATE GE '20020301'
ON TABLE HOLD
END
-RUN

SET ASNAMES=ON

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK C:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
BY AROLL_LEV4 NOPRINT
IF AROLL_LEV1 EQ 'PRINC-R'
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE HOLD
PRINT AIR_KEY
BY AROLL_LEV4 NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
BY AROLL_LEV4 NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT AIR_KEY AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE ALPRINC
FIXFORM FROM HOLD2
MATCH AIR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3
DATA ON HOLD2
END
-RUN

-CAR

TABLE FILE CR_50
SUM CAR_KEY AROLL_LEV4
BY CAR_KEY NOPRINT
BY AROLL_LEV4 NOPRINT
IF INVOICE_DATE GE '20020301'
ON TABLE HOLD
END
-RUN

SET ASNAMES=ON

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK C:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
BY AROLL_LEV4 NOPRINT
IF AROLL_LEV1 EQ 'PRINC-R'
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE HOLD
PRINT CAR_KEY
BY AROLL_LEV4 NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
BY AROLL_LEV4 NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT CAR_KEY AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3
BY CAR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE CLPRINC
FIXFORM FROM HOLD2
MATCH CAR_KEY
ON NOMATCH REJECT
ON MATCH UPDATE AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3
DATA ON HOLD2
END
-RUN

-HOTEL

TABLE FILE HR_50
SUM HTL_KEY AROLL_LEV4
BY HTL_KEY NOPRINT
BY AROLL_LEV4 NOPRINT
IF INVOICE_DATE GE '20020301'
ON TABLE HOLD
END
-RUN

SET ASNAMES=ON

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK C:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
BY AROLL_LEV4 NOPRINT
IF AROLL_LEV1 EQ 'PRINC-R'
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE HOLD
PRINT HTL_KEY
BY AROLL_LEV4 NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
BY AROLL_LEV4 NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT HTL_KEY AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3
BY HTL_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

MODIFY FILE HLPRINC
FIXFORM FROM HOLD2
MATCH HTL_KEY
ON NOMATCH REJECT
ON MATCH UPDATE AROLL_LEV2 AROLL_DSC2 AROLL_LEV3 AROLL_DSC3
DATA ON HOLD2
END
-RUN
-EXIT

-BDGA

TABLE FILE ALBDGA
PRINT AIR_KEY
IF AROLL_LEV4 EQ 'MEETING'
IF AIR_KEY CONTAINS 'DV196196'
ON TABLE HOLD
END
-RUN

MODIFY FILE ALBDGA
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE AROLL_LEV4='CONFERENCE';
ON MATCH COMPUTE AROLL_LEV5='CONFERENCE';
ON MATCH COMPUTE AROLL_DSC4='(CONFERENCE) BANDAG CONFERENCE';
ON MATCH COMPUTE AROLL_DSC5='(CONFERENCE) BANDAG CONFERENCE';
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

TABLE FILE CLBDGA
PRINT CAR_KEY
IF AROLL_LEV4 EQ 'MEETING'
IF CAR_KEY CONTAINS 'DV196196'
ON TABLE HOLD
END
-RUN

MODIFY FILE CLBDGA
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_LEV4='CONFERENCE';
ON MATCH COMPUTE AROLL_LEV5='CONFERENCE';
ON MATCH COMPUTE AROLL_DSC4='(CONFERENCE) BANDAG CONFERENCE';
ON MATCH COMPUTE AROLL_DSC5='(CONFERENCE) BANDAG CONFERENCE';
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

TABLE FILE HLBDGA
PRINT HTL_KEY
IF AROLL_LEV4 EQ 'MEETING'
IF HTL_KEY CONTAINS 'DV196196'
ON TABLE HOLD
END
-RUN

MODIFY FILE HLBDGA
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_LEV4='CONFERENCE';
ON MATCH COMPUTE AROLL_LEV5='CONFERENCE';
ON MATCH COMPUTE AROLL_DSC4='(CONFERENCE) BANDAG CONFERENCE';
ON MATCH COMPUTE AROLL_DSC5='(CONFERENCE) BANDAG CONFERENCE';
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

-BDGA2

TABLE FILE ALBDGA
PRINT AIR_KEY
IF AROLL_LEV4 EQ 'MEETING'
IF AIR_KEY CONTAINS 'DV443390'
ON TABLE HOLD
END
-RUN

MODIFY FILE ALBDGA
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE AROLL_LEV4='DVDEFAULT';
ON MATCH COMPUTE AROLL_LEV5='DVDEFAULT';
ON MATCH COMPUTE AROLL_DSC4='(DVDEFAULT) BANDAG DEFAULT';
ON MATCH COMPUTE AROLL_DSC5='(DVDEFAULT) BANDAG DEFAULT';
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

TABLE FILE CLBDGA
PRINT CAR_KEY
IF AROLL_LEV4 EQ 'MEETING'
IF CAR_KEY CONTAINS 'DV443390'
ON TABLE HOLD
END
-RUN

MODIFY FILE CLBDGA
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_LEV4='DVDEFAULT';
ON MATCH COMPUTE AROLL_LEV5='DVDEFAULT';
ON MATCH COMPUTE AROLL_DSC4='(DVDEFAULT) BANDAG DEFAULT';
ON MATCH COMPUTE AROLL_DSC5='(DVDEFAULT) BANDAG DEFAULT';
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

TABLE FILE HLBDGA
PRINT HTL_KEY
IF AROLL_LEV4 EQ 'MEETING'
IF HTL_KEY CONTAINS 'DV443390'
ON TABLE HOLD
END
-RUN

MODIFY FILE HLBDGA
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_LEV4='DVDEFAULT';
ON MATCH COMPUTE AROLL_LEV5='DVDEFAULT';
ON MATCH COMPUTE AROLL_DSC4='(DVDEFAULT) BANDAG DEFAULT';
ON MATCH COMPUTE AROLL_DSC5='(DVDEFAULT) BANDAG DEFAULT';
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

-BDGA3

TABLE FILE ALBDGA
PRINT AIR_KEY
IF AROLL_LEV5 EQ 'DVDEFAULT'
IF AIR_KEY CONTAINS 'DV259333'
ON TABLE HOLD
END
-RUN

MODIFY FILE ALBDGA
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE AROLL_LEV5='MEETING';
ON MATCH COMPUTE AROLL_DSC5='(MEETING) BANDAG MEETINGS';
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

TABLE FILE CLBDGA
PRINT CAR_KEY
IF AROLL_LEV5 EQ 'DVDEFAULT'
IF CAR_KEY CONTAINS 'DV259333'
ON TABLE HOLD
END
-RUN

MODIFY FILE CLBDGA
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_LEV5='MEETING';
ON MATCH COMPUTE AROLL_DSC5='(MEETING) BANDAG MEETINGS';
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

TABLE FILE HLBDGA
PRINT HTL_KEY
IF AROLL_LEV5 EQ 'DVDEFAULT'
IF HTL_KEY CONTAINS 'DV259333'
ON TABLE HOLD
END
-RUN

MODIFY FILE HLBDGA
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_LEV5='MEETING';
ON MATCH COMPUTE AROLL_DSC5='(MEETING) BANDAG MEETINGS';
ON MATCH UPDATE AROLL_LEV5
ON MATCH UPDATE AROLL_DSC5
DATA ON HOLD
END
-RUN

-PRINC

-* QUESTIONS ON THE FOLLOWING CLIENT CODES:
-* NG      919829   PRINCIPAL TOP PRODUCERS    PRINC-R   N       DEFAULTG
-* NG      919811   PRINCIPAL PRESIDENTS CIR   PRINC-R   N       DEFAULTG
-* NG      919571   PRINCIPAL ROUND TABLE      PRINC-R   N       DEFAULTG
-* PR      295261   PRINCIPAL FINANCIAL-GRPS   PRINC-R   N       DEFAULTG

-* CHANGE ALL OF THE ABOVE CLIENT CODES TO "DEFAULT"

SET ASNAMES=ON

-* SEGMENT

DEFINE FILE S_PRINC
AROLL_LEVX/A15 = SUBSTR(15, AROLL_LEV4, 8, 8, 1, AROLL_LEVX);
AROLL_LEV2X/A15 = 'PRINCB';
AROLL_LEV3X/A15 = GETTOK (AROLL_LEV3, 15, 1, 'G', 15, AROLL_LEV3X);
AROLL_LEV4X/A15 = SUBSTR(15, AROLL_LEV4, 1, 7, 7, AROLL_LEV4X);
END
-RUN

TABLE FILE S_PRINC
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
AROLL_LEV2X AS 'AROLL_LEV2'
AROLL_LEV3X AS 'AROLL_LEV3'
AROLL_LEV4X AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AROLL_LEVX EQ 'G'
ON TABLE HOLD
END
-RUN

MODIFY FILE S_PRINC
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* MARKET

DEFINE FILE M_PRINC
AROLL_LEVX/A15 = SUBSTR(15, AROLL_LEV4, 8, 8, 1, AROLL_LEVX);
AROLL_LEV2X/A15 = 'PRINCB';
AROLL_LEV3X/A15 = GETTOK (AROLL_LEV3, 15, 1, 'G', 15, AROLL_LEV3X);
AROLL_LEV4X/A15 = SUBSTR(15, AROLL_LEV4, 1, 7, 7, AROLL_LEV4X);
END
-RUN

TABLE FILE M_PRINC
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
AROLL_LEV2X AS 'AROLL_LEV2'
AROLL_LEV3X AS 'AROLL_LEV3'
AROLL_LEV4X AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AROLL_LEVX EQ 'G'
ON TABLE HOLD
END
-RUN

MODIFY FILE M_PRINC
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* DESTINATION

DEFINE FILE D_PRINC
AROLL_LEVX/A15 = SUBSTR(15, AROLL_LEV4, 8, 8, 1, AROLL_LEVX);
AROLL_LEV2X/A15 = 'PRINCB';
AROLL_LEV3X/A15 = GETTOK (AROLL_LEV3, 15, 1, 'G', 15, AROLL_LEV3X);
AROLL_LEV4X/A15 = SUBSTR(15, AROLL_LEV4, 1, 7, 7, AROLL_LEV4X);
END
-RUN

TABLE FILE D_PRINC
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
AROLL_LEV2X AS 'AROLL_LEV2'
AROLL_LEV3X AS 'AROLL_LEV3'
AROLL_LEV4X AS 'AROLL_LEV4'
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AROLL_LEVX EQ 'G'
ON TABLE HOLD
END
-RUN

MODIFY FILE D_PRINC
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* CAR

DEFINE FILE C_PRINC
AROLL_LEVX/A15 = SUBSTR(15, AROLL_LEV4, 8, 8, 1, AROLL_LEVX);
AROLL_LEV2X/A15 = 'PRINCB';
AROLL_LEV3X/A15 = GETTOK (AROLL_LEV3, 15, 1, 'G', 15, AROLL_LEV3X);
AROLL_LEV4X/A15 = SUBSTR(15, AROLL_LEV4, 1, 7, 7, AROLL_LEV4X);
END
-RUN

TABLE FILE C_PRINC
PRINT CAR_KEY
AROLL_LEV2X AS 'AROLL_LEV2'
AROLL_LEV3X AS 'AROLL_LEV3'
AROLL_LEV4X AS 'AROLL_LEV4'
BY CAR_KEY NOPRINT
IF AROLL_LEVX EQ 'G'
ON TABLE HOLD
END
-RUN

MODIFY FILE C_PRINC
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* HOTEL

DEFINE FILE H_PRINC
AROLL_LEVX/A15 = SUBSTR(15, AROLL_LEV4, 8, 8, 1, AROLL_LEVX);
AROLL_LEV2X/A15 = 'PRINCB';
AROLL_LEV3X/A15 = GETTOK (AROLL_LEV3, 15, 1, 'G', 15, AROLL_LEV3X);
AROLL_LEV4X/A15 = SUBSTR(15, AROLL_LEV4, 1, 7, 7, AROLL_LEV4X);
END
-RUN

TABLE FILE H_PRINC
PRINT HTL_KEY
AROLL_LEV2X AS 'AROLL_LEV2'
AROLL_LEV3X AS 'AROLL_LEV3'
AROLL_LEV4X AS 'AROLL_LEV4'
BY HTL_KEY NOPRINT
IF AROLL_LEVX EQ 'G'
ON TABLE HOLD
END
-RUN

MODIFY FILE H_PRINC
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-PRINCSU

TABLE FILE I_SUMM
PRINT INST_KEY HSEL1 HDES1 HSIF01
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'PRINC'
IF HSEL1 EQ 'PRINCG'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH COMPUTE HSEL1='PRINCB';
ON MATCH COMPUTE HDES1='(PRINCB) PRINCIPAL BUSINESS TRAVEL';
ON MATCH COMPUTE HSIF01='IF AROLL_LEV2 EQ '|''''||''''||'PRINCB'||''''||'''';
ON MATCH UPDATE HSEL1
ON MATCH UPDATE HDES1
ON MATCH UPDATE HSIF01
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY
BY INST_KEY NOPRINT
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE RPT_INST
FIXFORM FROM HOLD1
MATCH INST_KEY
ON MATCH COMPUTE CATG1='GROUP';
ON MATCH COMPUTE CASEL='I';
ON MATCH COMPUTE CA_OM1='IF CATEGORY EQ GROUP';
ON MATCH UPDATE CATG1
ON MATCH UPDATE CASEL
ON MATCH UPDATE CA_OM1
ON NOMATCH REJECT
DATA ON HOLD1
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSEL1 HDES1 HSIF01
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'PRINC'
IF HSEL1 EQ '10G'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH COMPUTE HSEL1='10';
ON MATCH COMPUTE HDES1='(10) INDIVIDUAL';
ON MATCH COMPUTE HSIF01='IF AROLL_LEV3 EQ '|''''||''''||'10'||''''||'''';
ON MATCH UPDATE HSEL1
ON MATCH UPDATE HDES1
ON MATCH UPDATE HSIF01
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY
BY INST_KEY NOPRINT
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE RPT_INST
FIXFORM FROM HOLD1
MATCH INST_KEY
ON MATCH COMPUTE CATG1='GROUP';
ON MATCH COMPUTE CASEL='I';
ON MATCH COMPUTE CA_OM1='IF CATEGORY EQ GROUP';
ON MATCH UPDATE CATG1
ON MATCH UPDATE CASEL
ON MATCH UPDATE CA_OM1
ON NOMATCH REJECT
DATA ON HOLD1
END
-RUN

TABLE FILE I_SUMM
PRINT INST_KEY HSEL1 HDES1 HSIF01
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'PRINC'
IF HSEL1 EQ 'H068000G'
ON TABLE HOLD
END
-RUN

MODIFY FILE I_SUMM
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH COMPUTE HSEL1='H068000';
ON MATCH COMPUTE HDES1='(H068000) IND DI STRATALL';
ON MATCH COMPUTE HSIF01='IF AROLL_LEV3 NE '|''''||''''||'H068000'||''''||'''';
ON MATCH UPDATE HSEL1
ON MATCH UPDATE HDES1
ON MATCH UPDATE HSIF01
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE HOLD
PRINT INST_KEY
BY INST_KEY NOPRINT
ON TABLE HOLD AS HOLD1
END
-RUN

MODIFY FILE RPT_INST
FIXFORM FROM HOLD1
MATCH INST_KEY
ON MATCH COMPUTE CATG1='GROUP';
ON MATCH COMPUTE CASEL='E';
ON MATCH COMPUTE CA_OM1='IF CATEGORY NE GROUP';
ON MATCH UPDATE CATG1
ON MATCH UPDATE CASEL
ON MATCH UPDATE CA_OM1
ON NOMATCH REJECT
DATA ON HOLD1
END
-RUN

JOIN INST_KEY IN RPT_INST TO INST_KEY IN I_SUMM AS JOIN1

TABLE FILE RPT_INST
PRINT INST_KEY
BY INST_KEY NOPRINT
IF INST_KEY CONTAINS 'PRINC'
IF CA_OM1 EQ ' '
IF HSEL1 NE 'PRINC-R' OR 'PRINCS' OR 'PRINCP' OR 'LEISURE' OR ' '
IF HSEL2 EQ ' '
ON TABLE HOLD
END

MODIFY FILE RPT_INST
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH COMPUTE CATG1='GROUP';
ON MATCH COMPUTE CASEL='E';
ON MATCH UPDATE CATG1
ON MATCH UPDATE CASEL
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-PRINCST

SET ASNAMES=ON

DEFINE FILE RPT_INST
CX_OM1/A65='IF CATEGORY NE GROUP';
END
-RUN

TABLE FILE RPT_INST
PRINT INST_KEY CX_OM1 AS 'CA_OM1'
BY INST_KEY NOPRINT
IF CA_OM1 EQ ' '
IF CATG1 NE ' '
ON TABLE HOLD
END

MODIFY FILE RPT_INST
FIXFORM FROM HOLD
MATCH INST_KEY
ON MATCH CONTINUE TO CA_OM1
ON MATCH UPDATE CA_OM1
ON NOMATCH INCLUDE
DATA ON HOLD
END
-RUN

-EXIT

-BRKSTN

-* SEGMENT

TABLE FILE S_BRKSTN
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AROLL_LEV6 EQ '882'
ON TABLE HOLD
END
-RUN

MODIFY FILE S_BRKSTN
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE AROLL_LEV3='BGARD';
ON MATCH COMPUTE AROLL_LEV4='BGARD4';
ON MATCH COMPUTE AROLL_LEV5='BGARD5';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* MARKET

TABLE FILE M_BRKSTN
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AROLL_LEV6 EQ '882'
ON TABLE HOLD
END
-RUN

MODIFY FILE M_BRKSTN
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE AROLL_LEV3='BGARD';
ON MATCH COMPUTE AROLL_LEV4='BGARD4';
ON MATCH COMPUTE AROLL_LEV5='BGARD5';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* DESTINATION

TABLE FILE D_BRKSTN
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AROLL_LEV6 EQ '882'
ON TABLE HOLD
END
-RUN

MODIFY FILE D_BRKSTN
FIXFORM FROM HOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH COMPUTE AROLL_LEV3='BGARD';
ON MATCH COMPUTE AROLL_LEV4='BGARD4';
ON MATCH COMPUTE AROLL_LEV5='BGARD5';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* CAR

TABLE FILE C_BRKSTN
PRINT CAR_KEY 
AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 
BY CAR_KEY NOPRINT
IF AROLL_LEV6 EQ '882'
ON TABLE HOLD
END
-RUN

MODIFY FILE C_BRKSTN
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_LEV3='BGARD';
ON MATCH COMPUTE AROLL_LEV4='BGARD4';
ON MATCH COMPUTE AROLL_LEV5='BGARD5';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* HOTEL

TABLE FILE H_BRKSTN
PRINT HTL_KEY 
AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 
BY HTL_KEY NOPRINT
IF AROLL_LEV6 EQ '882'
ON TABLE HOLD
END
-RUN

MODIFY FILE H_BRKSTN
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_LEV3='BGARD';
ON MATCH COMPUTE AROLL_LEV4='BGARD4';
ON MATCH COMPUTE AROLL_LEV5='BGARD5';
ON MATCH UPDATE AROLL_LEV3
ON MATCH UPDATE AROLL_LEV4
ON MATCH UPDATE AROLL_LEV5
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT
