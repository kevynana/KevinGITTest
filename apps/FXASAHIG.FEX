
SET ASNAMES = ON 



TABLE FILE A_ASAHIG
PRINT AIR_KEY AND COMPUTE
NBR_LV/I2 = POSIT(ICODEX, 36, '-', 1, 'I2');
ICODE2/A26 = EDIT(ICODEX, '$$$$$$$$$$99999999999999999999999999');
NBR_LV2/I2 = POSIT(ICODE2, 26, '-', 2, 'I2');
LV2/A15 = IF NBR_LV EQ 0 THEN '               ' ELSE LEVEL3;

LV3/A15 = GETTOK (ICODEX, 36, -1, '-', 15, LV3);
LVL3/A15 = IF LEVEL3 NE ' ' THEN LV3 ELSE '               ';;
LEV3NEW/A15 = IF LVL3 EQ LEVEL3 THEN '               ' ELSE LVL3;
LV2NEW/A15 = IF LEVEL3 NE LEVEL1 THEN LEVEL3 ELSE '               ';
BY AIR_KEY NOPRINT

IF TKT_DATE GE '2009/01/01'
IF TKT_DATE LE '2009/04/12'
ON TABLE HOLD AS DEBHOLD
END
-RUN
 
TABLE FILE DEBHOLD
PRINT AIR_KEY LV2NEW AS 'LEVEL2' LEV3NEW AS 'LEVEL3'
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLDFIX
END
-RUN


MODIFY FILE A_ASAHIG
FIXFORM FROM HOLDFIX
MATCH AIR_KEY
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLDFIX
END


TABLE FILE A_ASAHIG
PRINT AIR_KEY LEVEL1 LEVEL2 LEVEL3 ICODEX
BY AIR_KEY NOPRINT
WHERE LEVEL1 EQ LEVEL2
IF TKT_DATE GE '2009/01/01'
IF TKT_DATE LE '2009/04/12'
ON TABLE HOLD
END
-RUN
 

MODIFY FILE A_ASAHIG
FIXFORM FROM HOLD
MATCH AIR_KEY 
ON MATCH COMPUTE LEVEL2='               ';
ON MATCH UPDATE LEVEL2
ON NOMATCH REJECT
DATA ON HOLD
END


-* CAR

TABLE FILE C_ASAHIG
PRINT CAR_KEY AND COMPUTE
NBR_LV/I2 = POSIT(ICODEX, 36, '-', 1, 'I2');
ICODE2/A26 = EDIT(ICODEX, '$$$$$$$$$$99999999999999999999999999');
NBR_LV2/I2 = POSIT(ICODE2, 26, '-', 2, 'I2');
LV2/A15 = IF NBR_LV EQ 0 THEN '               ' ELSE LEVEL3;

LV3/A15 = GETTOK (ICODEX, 36, -1, '-', 15, LV3);
LVL3/A15 = IF LEVEL3 NE ' ' THEN LV3 ELSE '               ';;
LEV3NEW/A15 = IF LVL3 EQ LEVEL3 THEN '               ' ELSE LVL3;
LV2NEW/A15 = IF LEVEL3 NE LEVEL1 THEN LEVEL3 ELSE '               ';
BY CAR_KEY NOPRINT

IF INVOICE_DATE GE '2009/01/01'
IF INVOICE_DATE LE '2009/04/12'
ON TABLE HOLD AS DEBHOLDC
END
-RUN
 
TABLE FILE DEBHOLDC
PRINT CAR_KEY LV2NEW AS 'LEVEL2' LEV3NEW AS 'LEVEL3'
BY CAR_KEY NOPRINT
ON TABLE HOLD AS HOLDFIXC
END
-RUN


MODIFY FILE C_ASAHIG
FIXFORM FROM HOLDFIXC
MATCH CAR_KEY
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLDFIXC
END


TABLE FILE C_ASAHIG
PRINT CAR_KEY LEVEL1 LEVEL2 LEVEL3 ICODEX
BY CAR_KEY NOPRINT
WHERE LEVEL1 EQ LEVEL2
IF INVOICE_DATE GE '2009/01/01'
IF INVOICE_DATE LE '2009/04/12'
ON TABLE HOLD
END
-RUN
 

MODIFY FILE C_ASAHIG
FIXFORM FROM HOLD
MATCH CAR_KEY 
ON MATCH COMPUTE LEVEL2='               ';
ON MATCH UPDATE LEVEL2
ON NOMATCH REJECT
DATA ON HOLD
END


-*HOTEL

TABLE FILE H_ASAHIG
PRINT HTL_KEY AND COMPUTE
NBR_LV/I2 = POSIT(ICODEX, 36, '-', 1, 'I2');
ICODE2/A26 = EDIT(ICODEX, '$$$$$$$$$$99999999999999999999999999');
NBR_LV2/I2 = POSIT(ICODE2, 26, '-', 2, 'I2');
LV2/A15 = IF NBR_LV EQ 0 THEN '               ' ELSE LEVEL3;

LV3/A15 = GETTOK (ICODEX, 36, -1, '-', 15, LV3);
LVL3/A15 = IF LEVEL3 NE ' ' THEN LV3 ELSE '               ';;
LEV3NEW/A15 = IF LVL3 EQ LEVEL3 THEN '               ' ELSE LVL3;
LV2NEW/A15 = IF LEVEL3 NE LEVEL1 THEN LEVEL3 ELSE '               ';
BY HTL_KEY NOPRINT

IF INVOICE_DATE GE '2009/01/01'
IF INVOICE_DATE LE '2009/04/12'
ON TABLE HOLD AS DEBHOLDH
END
-RUN
 
TABLE FILE DEBHOLDH
PRINT HTL_KEY LV2NEW AS 'LEVEL2' LEV3NEW AS 'LEVEL3'
BY HTL_KEY NOPRINT
ON TABLE HOLD AS HOLDFIXH
END
-RUN


MODIFY FILE H_ASAHIG
FIXFORM FROM HOLDFIXH
MATCH HTL_KEY
ON MATCH UPDATE LEVEL2
ON MATCH UPDATE LEVEL3
ON NOMATCH REJECT
DATA ON HOLDFIXH
END


TABLE FILE H_ASAHIG
PRINT HTL_KEY LEVEL1 LEVEL2 LEVEL3 ICODEX
BY HTL_KEY NOPRINT
WHERE LEVEL1 EQ LEVEL2
IF INVOICE_DATE GE '2009/01/01'
IF INVOICE_DATE LE '2009/04/12'
ON TABLE HOLD
END
-RUN
 

MODIFY FILE H_ASAHIG
FIXFORM FROM HOLD
MATCH HTL_KEY 
ON MATCH COMPUTE LEVEL2='               ';
ON MATCH UPDATE LEVEL2
ON NOMATCH REJECT
DATA ON HOLD
END
