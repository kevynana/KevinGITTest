-INCLUDE SETECHO

-* 1/11/13 - DEB - CHANGED REPORT TO USE INVOICE_DATE FOR CAR AND HOTEL
-*            DATA INSTEAD OF PICKUP_DATE AND CHKIN_DATE
-*1/27/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*2/5/14 Updated the bookings define to use num_days instead of daily_rate - JK
-*4/27/2017-JEM-S-33318-updated logic for no records report

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN




DEFINE FILE &&EXTRACT
LEVEL_DESC/A60 = &&LDESC;

AIR_VOL/D12.2 = SEG_AMT + SEG_TAX ;
NET_TKTS/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (AIR_VOL GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
                            
DISSAVINGS/D11.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         AIR_VOL - SEG_LOWEST;  
TRNM/MT = TRN_DATE;
TRNY/A3 = 'YTD';
XTRAN_Y/YY = TRN_DATE;
XTRAN_M/M = TRN_DATE;

CTRN_YR/A10 =  &&FROMDT.EVAL ;
PTRN_YR/A10 =  &&FXDATE.EVAL ; 
TRN_MON/A3          = DECODE XTRAN_M (1 'JAN' 2 'FEB' 3 'MAR'
                                 4 'APR' 5 'MAY' 6 'JUN' 7 'JUL'
                                 8 'AUG' 9 'SEP' 10 'OCT' 11 'NOV' 12 'DEC');
CYEAR/A4 = EDIT(CTRN_YR,'9999$$$$$$');
PYEAR/A4 = EDIT(PTRN_YR,'9999$$$$$$');
CMN_YR/A8 = TRN_MON | CYEAR; 
PMN_YR/A8 = TRN_MON | PYEAR; 
                          
-* DEFINES ON PREVIOUS DEFINES
DOM_VOL/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'D') THEN AIR_VOL ELSE 0;
DOM_TKTS/D12  = IF (AIR_MAIN.INTL_DOM EQ 'D') THEN NET_TKTS ELSE 0;
INT_VOL/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'I') THEN AIR_VOL ELSE 0;
INT_TKTS/D12  = IF (AIR_MAIN.INTL_DOM EQ 'I') THEN NET_TKTS ELSE 0;
ONL_TKTS/D12.2 = IF (ONLINE_TRADITIONAL EQ 'ONLINE') THEN NET_TKTS ELSE 0;
ONL_VOL/D12 = IF (ONLINE_TRADITIONAL EQ 'ONLINE') THEN AIR_VOL ELSE 0;
LT7NET_TKTS/D12 = IF ADV_PURCH LT 7 THEN NET_TKTS ELSE 0;
LT7LST_SAV/D12.2 = IF ADV_PURCH LT 7 THEN DISSAVINGS ELSE 0;

CURRENT/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND 
                   TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
PRIOR/A1 = IF TRN_DATE GE &&FXDATE.EVAL AND 
                  TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
                         
CAVOL/D12.2 = IF CURRENT EQ 'Y' THEN AIR_VOL ELSE 0;
CNTKT/D12 = IF CURRENT EQ 'Y' THEN NET_TKTS ELSE 0;
CDAVOL/D12.2 = IF CURRENT EQ 'Y' THEN DOM_VOL ELSE 0;
CIAVOL/D12.2 = IF CURRENT EQ 'Y' THEN INT_VOL ELSE 0;
CDNTKT/D12 = IF CURRENT EQ 'Y' THEN DOM_TKTS ELSE 0;
CINTKT/D12 = IF CURRENT EQ 'Y' THEN INT_TKTS ELSE 0;
CONL_TKT/D12 = IF CURRENT EQ 'Y' THEN ONL_TKTS ELSE 0;
CONLAVOL/D12.2 = IF CURRENT EQ 'Y' THEN ONL_VOL ELSE 0;
CLT7NTKT/D12 = IF CURRENT EQ 'Y' THEN LT7NET_TKTS ELSE 0;
CLT7LST_SAV/D12.2 = IF CURRENT EQ 'Y' THEN LT7LST_SAV ELSE 0;


PAVOL/D12.2 = IF PRIOR EQ 'Y' THEN AIR_VOL ELSE 0;
PNTKT/D12 = IF PRIOR EQ 'Y' THEN NET_TKTS ELSE 0;
PDAVOL/D12.2 = IF PRIOR EQ 'Y' THEN DOM_VOL ELSE 0;
PIAVOL/D12.2 = IF PRIOR EQ 'Y' THEN INT_VOL ELSE 0;
PDNTKT/D12 = IF PRIOR EQ 'Y' THEN DOM_TKTS ELSE 0;
PINTKT/D12 = IF PRIOR EQ 'Y' THEN INT_TKTS ELSE 0;
PONL_TKT/D12 = IF PRIOR EQ 'Y' THEN ONL_TKTS ELSE 0;
PONLAVOL/D12.2 = IF PRIOR EQ 'Y' THEN ONL_VOL ELSE 0;
PLT7NTKT/D12 = IF PRIOR EQ 'Y' THEN LT7NET_TKTS ELSE 0;
PLT7LST_SAV/D12.2 = IF PRIOR EQ 'Y' THEN LT7LST_SAV ELSE 0;


-* Defines on Previous                           

END

TABLE FILE &&EXTRACT
PRINT CAVOL
      CNTKT
      CDAVOL
      CIAVOL
      CDNTKT
      CINTKT
      CONL_TKT
      CONLAVOL
      CLT7NTKT
      CLT7LST_SAV
      PAVOL
      PNTKT
      PDAVOL
      PIAVOL
      PDNTKT
      PINTKT
      PONL_TKT
      PONLAVOL
      PLT7NTKT
      PLT7LST_SAV
      TRNM
      TRNY
      LEVEL_DESC 
      CURRENT
      PRIOR
      CMN_YR
      PMN_YR
WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS HOLDONE
END
-RUN

-SET &&AIRREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';



EX CAPHUSE
-RUN

DEFINE FILE HR_50
NBR_DAYS/D12 =  NUM_DAYS;
NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
LEVEL_DESC/A60 = &&LDESC;
NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
BOOKINGS/D8 = IF NEW_TOTAL_AMT GE 0 THEN 1 ELSE (-1);
MONTHLY/A1 = IF CHKIN_DATE GE &&FROMDT.EVAL AND CHKIN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
YTD/A1 = IF CHKIN_DATE GE &&FXDATE.EVAL AND CHKIN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';


-* MONTHLY/A1 = IF INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
-* YTD/A1 = IF INVOICE_DATE GE &&FXDATE.EVAL AND INVOICE_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
TRNM/MT = CHKIN_DATE;
TRNY/A3 = 'YTD';
XTRAN_Y/YY = CHKIN_DATE;
XTRAN_M/M = CHKIN_DATE;

-*XTRAN_Y/YY = INVOICE_DATE;
-*XTRAN_M/M = INVOICE_DATE;
CTRN_YR/A10 =  &&FROMDT.EVAL ;
PTRN_YR/A10 =  &&FXDATE.EVAL ; 
TRN_MON/A3          = DECODE XTRAN_M (1 'JAN' 2 'FEB' 3 'MAR'
                                 4 'APR' 5 'MAY' 6 'JUN' 7 'JUL'
                                 8 'AUG' 9 'SEP' 10 'OCT' 11 'NOV' 12 'DEC');
CYEAR/A4 = EDIT(CTRN_YR,'9999$$$$$$');
PYEAR/A4 = EDIT(PTRN_YR,'9999$$$$$$');
CMN_YR/A8 = TRN_MON | CYEAR; 
PMN_YR/A8 = TRN_MON | PYEAR; 
-*Defines on previous defines
 MROOMS/D12 = IF MONTHLY EQ 'Y' THEN NNROOMS ELSE 0;
 YROOMS/D12 = IF YTD EQ 'Y' THEN NNROOMS ELSE 0;
 MTTL_AMT/D12.2CS = IF MONTHLY EQ 'Y' THEN NEW_TOTAL_AMT ELSE 0;
 YTTL_AMT/D12.2CS = IF YTD EQ 'Y' THEN NEW_TOTAL_AMT ELSE 0;
 MBOOKINGS/D8 = IF MONTHLY EQ 'Y' THEN BOOKINGS ELSE 0;
 YBOOKINGS/D8 = IF YTD EQ 'Y' THEN BOOKINGS ELSE 0;
END

TABLE FILE HR_50
PRINT MROOMS
      YROOMS
      MTTL_AMT
      YTTL_AMT
      MONTHLY
      YTD
      MBOOKINGS
      YBOOKINGS
      LEVEL_DESC
      TRNM
      TRNY
      LEVEL_DESC 
      MONTHLY
      YTD
      CMN_YR
      PMN_YR
WHERE (CHKIN_DATE GE &&FROMDT.EVAL) AND (CHKIN_DATE LE &&TODT.EVAL) OR
      (CHKIN_DATE GE &&FXDATE.EVAL) AND (CHKIN_DATE LE &&TXDATE.EVAL)
-*WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL) OR
-*      (INVOICE_DATE GE &&FXDATE.EVAL) AND (INVOICE_DATE LE &&TXDATE.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTLHOLD
END
-RUN

-SET &&HTLREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';



EX CAPCUSE
-RUN

DEFINE FILE CR_50
 
 LEVEL_DESC/A60 = &&LDESC;
BOOKINGS/D12 = IF NUM_DAYS GT 0 THEN 1 ELSE IF NUM_DAYS LT 0 THEN (-1) ELSE 0;

 RENTAL_DAY/D12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
 P1/A1 = IF PICKUP_DATE GE &&FROMDT.EVAL AND PICKUP_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
 P2/A1 = IF PICKUP_DATE GE &&FXDATE.EVAL AND PICKUP_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
-* P1/A1 = IF INVOICE_DATE GE &&FROMDT.EVAL AND INVOICE_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
-* P2/A1 = IF INVOICE_DATE GE &&FXDATE.EVAL AND INVOICE_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
TRNM/MT = PICKUP_DATE;
 TRNY/A3 = 'YTD';
 XTRAN_Y/YY = PICKUP_DATE;
 XTRAN_M/M = PICKUP_DATE;
-* XTRAN_Y/YY = INVOICE_DATE;
-* XTRAN_M/M = INVOICE_DATE; 
 CTRN_YR/A10 =  &&FROMDT.EVAL ;
 PTRN_YR/A10 =  &&FXDATE.EVAL ; 
 TRN_MON/A3          = DECODE XTRAN_M (1 'JAN' 2 'FEB' 3 'MAR'
                                  4 'APR' 5 'MAY' 6 'JUN' 7 'JUL'
                                  8 'AUG' 9 'SEP' 10 'OCT' 11 'NOV' 12 'DEC');
 CYEAR/A4 = EDIT(CTRN_YR,'9999$$$$$$');
 PYEAR/A4 = EDIT(PTRN_YR,'9999$$$$$$');
 CMN_YR/A8 = TRN_MON | CYEAR; 
PMN_YR/A8 = TRN_MON | PYEAR; 
-* Defines on previous
 MRNTL_DAYS/D12 = IF P1 EQ 'Y' THEN RENTAL_DAY ELSE 0;
 YRNTL_DAYS/D12 = IF P2 EQ 'Y' THEN RENTAL_DAY ELSE 0;
 MRNTL_AMT/D12.2CS = IF P1 EQ 'Y' THEN RENTAL_AMT ELSE 0;
 YRNTL_AMT/D12.2CS = IF P2 EQ 'Y' THEN RENTAL_AMT ELSE 0;
 MBOOKINGS/D8 = IF P1 EQ 'Y' THEN BOOKINGS ELSE 0;
 YBOOKINGS/D8 = IF P2 EQ 'Y' THEN BOOKINGS ELSE 0;
END

-RUN
TABLEF FILE CR_50
PRINT  
      MRNTL_DAYS
      MRNTL_AMT
      YRNTL_DAYS
      YRNTL_AMT
      MBOOKINGS
      YBOOKINGS
      P1
      P2
      LEVEL_DESC
      TRNM
      TRNY
      LEVEL_DESC 
      CMN_YR
      PMN_YR
WHERE (PICKUP_DATE GE &&FROMDT.EVAL) AND (PICKUP_DATE LE &&TODT.EVAL) OR
      (PICKUP_DATE GE &&FXDATE.EVAL) AND (PICKUP_DATE LE &&TXDATE.EVAL)
-*WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL) OR
-*      (INVOICE_DATE GE &&FXDATE.EVAL) AND (INVOICE_DATE LE &&TXDATE.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS CARHOLD
END
-RUN

-SET &&CARREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';



 

 


 
