SET ASNAMES=ON

TABLE FILE RPT_INST
ON TABLE SET PAGE-NUM OFF
PRINT LEV_SELECT AND LEVEL_KEY AS 'ROLL_KEY' AND LEVEL_KEY BY INST_KEY
HEADING
"PAGE <TABPAGENO  "
ON TABLE NOTOTAL
WHERE ROLLUP_CODE EQ 'METX-R';
ON TABLE HOLD AS HOLD1
END
-RUN
-* -EXIT

MATCH FILE HOLD1
PRINT INST_KEY AND LEV_SELECT AND LEVEL_KEY
BY ROLL_KEY NOPRINT
RUN
FILE HPMETX
SUM
ROLL_KEY AND LEVEL_DESC
BY ROLL_KEY NOPRINT
AFTER MATCH HOLD AS HOLD2 OLD
END
-RUN

TABLE FILE HOLD2
PRINT INST_KEY 
COMPUTE LEV_SELECT/A30 = LJUST (30, LEVEL_DESC, LEV_SELECT);
BY INST_KEY NOPRINT
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE RPT_INST
FIXFORM INST_KEY/72 LEV_SELECT/30 
MATCH INST_KEY
ON MATCH UPDATE LEV_SELECT
ON NOMATCH REJECT
DATA ON HOLD3
END
