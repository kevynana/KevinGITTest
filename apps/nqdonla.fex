-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Created for the new quarterly review - JK 8/2/05
-* Changed Total to Total YTD - Steve 01/09/2007
-* Changed ONLSAV Define on graph to not calculate savings if no online bookings - Deb 1/31/07
-* Changed Savings footing to show markets instead of tickets - Steve 02/19/2007
-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE

-******************************************************************************
-INCLUDE SETECHO



SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &POS0=0;
-SET &INC = 10;
-SET &INC1 = 18;
-SET &POS1T = &POS0 + 1 * &INC;
-SET &POS1T1 = &POS0 + 1 * &INC1;

-SET &POS1 = &POS1T + 0;
-SET &POS2 = &POS1 + 9;
-SET &POS3 = &POS2 + 9;
-SET &POS4 = &POS3 + 10;
-SET &POS5 = &POS4 + 10;
-SET &POS6 = &POS5 + 10;
-SET &POS7 = &POS6 + 8;
-SET &POS8 = &POS7 + 10;
-SET &POS9 = &POS8 + 10;
-SET &POS10 = &POS9 + 10;


DEFINE FILE &&EXTRACT 
  FARE_PAID/P12 = SEG_AMT + SEG_TAX;
  NEW_SEG_MILES/D10 = SEG_MILES;
  NET_TKT_CNT/D12    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
 MRK_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
-INCLUDE QRFTRANA
END
-RUN 

TABLEF FILE &&EXTRACT
PRINT AIR_MAIN.INTL_DOM AS 'INTL_DOM'
      DOD_TYPE
      FARE_PAID
      NEW_SEG_MILES  
      MRK_TKT_CNT
      NET_TKT_CNT
      ONLINE_TRADITIONAL
      ROLLUP_CODE
      YEAR
      TRAN   
      TRN_DATE
WHERE (TRN_DATE GE '&&FROMDT.EVAL') AND (TRN_DATE LE '&&TODT.EVAL') OR
      (TRN_DATE GE '&&FXDATE.EVAL') AND (TRN_DATE LE '&&TXDATE.EVAL')
WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
-INCLUDE RPTPARMS
ON TABLE HOLD AS HOLDBASE
END
-RUN

DEFINE FILE HOLDBASE
ONLFARE/P12 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN FARE_PAID ELSE 0;
TRAFARE/P12 = IF ONLINE_TRADITIONAL EQ 'TRADITIONAL' THEN FARE_PAID ELSE 0;
ONLNTKT/P12 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN NET_TKT_CNT ELSE 0;
TRANTKT/P12 = IF ONLINE_TRADITIONAL EQ 'TRADITIONAL' THEN NET_TKT_CNT ELSE 0;
ONLMKTS/P12 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN MRK_TKT_CNT ELSE 0;
TRAMKTS/P12 = IF ONLINE_TRADITIONAL EQ 'TRADITIONAL' THEN MRK_TKT_CNT ELSE 0;
TOTAL/A9 = 'Total YTD';
END
-RUN

TABLE FILE HOLDBASE
SUM   FARE_PAID
      NET_TKT_CNT
      ONLFARE
      ONLMKTS
      ONLNTKT
      TRAFARE
      TRAMKTS
      TRANTKT
BY TOTAL      
WHERE (TRN_DATE GE '&&FROMDT.EVAL') AND (TRN_DATE LE '&&TODT.EVAL') 
WHERE INTL_DOM EQ 'D'
ON TABLE HOLD AS ONLT1
END
-RUN


TABLE FILE ONLT1
SUM NET_TKT_CNT  ONLNTKT  
COMPUTE ONLAP/D8 = IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE
                      (ONLNTKT/NET_TKT_CNT)*100;
COMPUTE TAVTP1/D12.4 = IF ((TRANTKT LT 1) AND (TRANTKT GT (-1))) THEN 0 ELSE
                       (TRAFARE/TRANTKT);
COMPUTE OAVTP1/D12.4 = IF ((ONLNTKT LT 1) AND (ONLNTKT GT (-1))) THEN 0 ELSE
                       (ONLFARE/ONLNTKT);
COMPUTE ONLA25/D8 = TRANTKT * .25;
COMPUTE ONLA50/D8 = TRANTKT * .50;
COMPUTE ONLA75/D8 = TRANTKT * .75;
COMPUTE AVSAV/P12 = TAVTP - OAVTP;
COMPUTE 25ONLI/D8 = ONLA25 * AVSAV;
COMPUTE 25ONLA/D8 = IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE
                       ((ONLA25+ONLNTKT)/NET_TKT_CNT)*100;
COMPUTE 50ONLI/D8 = ONLA50 * AVSAV;
COMPUTE 50ONLA/D8 = IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE
                       ((ONLA50+ONLNTKT)/NET_TKT_CNT)*100;
COMPUTE 75ONLI/D8 = ONLA75 * AVSAV;
COMPUTE 75ONLA/D8 = IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE
                       ((ONLA75+ONLNTKT)/NET_TKT_CNT)*100;
BY TOTAL
ON TABLE HOLD AS ONLT2
END
-RUN


TABLE FILE ONLT2
PRINT TOTAL NET_TKT_CNT ONLAP TAVTP1/D12 AS 'TAVTP' OAVTP1/D12 AS 'OAVTP' 25ONLI 25ONLA 50ONLI 50ONLA 75ONLI 75ONLA
ON TABLE HOLD AS ONLT2A
END
-RUN

TABLE FILE ONLT2A
PRINT TOTAL NET_TKT_CNT ONLAP TAVTP OAVTP 25ONLI 25ONLA 50ONLI 50ONLA 75ONLI 75ONLA
ON TABLE SAVE AS ONLT3
END
-RUN

-SET &TOTAL=' ';
-SET &NTCNT=' ';
-SET &ONLAP=' ';
-SET &TAVTP=' ';
-SET &OAVTP=' ';
-SET &25ONLI=' ';
-SET &25ONLA=' ';
-SET &50ONLI=' ';
-SET &50ONLA=' ';
-SET &75ONLI=' ';
-SET &75ONLA=' ';


-SET &CNT= 1;
-REPEAT TOEND &LINES TIMES
-READ ONLT3 NOCLOSE &TOTAL.9. &NTCNT.12. &ONLAP.8. &TAVTP.12. &OAVTP.12. &25ONLI.8. &25ONLA.8. &50ONLI.8. &50ONLA.8. &75ONLI.8. &75ONLA.8.

EX FMTNUMBER VALUE=&NTCNT,DOLLAR=N,LEN=12
-RUN
-SET &NTCNT = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&ONLAP,DOLLAR=N,LEN=8
-RUN
-SET &ONLAP = '&&RETVAL.EVAL'|'%';

EX FMTNUMBER VALUE=&TAVTP,DOLLAR=Y,LEN=12
-RUN
-SET &TAVTP = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&OAVTP,DOLLAR=Y,LEN=12
-RUN
-SET &OAVTP = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&25ONLI,DOLLAR=Y,LEN=8
-RUN
-SET &25ONLI = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&25ONLA,DOLLAR=N,LEN=8
-RUN
-SET &25ONLA = '&&RETVAL.EVAL'|'%';

EX FMTNUMBER VALUE=&50ONLI,DOLLAR=Y,LEN=8
-RUN
-SET &50ONLI = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&50ONLA,DOLLAR=N,LEN=8
-RUN
-SET &50ONLA = '&&RETVAL.EVAL'|'%';

EX FMTNUMBER VALUE=&75ONLA,DOLLAR=N,LEN=8
-RUN
-SET &75ONLA = '&&RETVAL.EVAL'|'%';

EX FMTNUMBER VALUE=&75ONLI,DOLLAR=Y,LEN=8
-RUN
-SET &75ONLI = '&&RETVAL.EVAL';

-TOEND
-CLOSE ONLT3


-SET &G_TDG3 = 'N';
-IF '&&SKIPGRAPH.EVAL' EQ 'Y' THEN GOTO AROUNDG;

-*  Online Savings Graph


DEFINE FILE HOLDBASE
ONLFARE/P12 = IF DOD_TYPE EQ 'H' OR 'I' OR 'J' THEN FARE_PAID ELSE 0;
TRAFARE/P12 = IF DOD_TYPE NE 'H' OR 'I' OR 'J' THEN FARE_PAID ELSE 0;
ONLNTKT/P12 = IF DOD_TYPE EQ 'H' OR 'I' OR 'J' THEN NET_TKT_CNT ELSE 0;
TRANTKT/P12 = IF DOD_TYPE NE 'H' OR 'I' OR 'J' THEN NET_TKT_CNT ELSE 0;
TOTAL/A9 = 'Total YTD';
END
-RUN

TABLE FILE HOLDBASE
SUM 
COMPUTE TAVTP/P12 = IF ((TRANTKT LT 1) AND (TRANTKT GT (-1))) THEN 0 ELSE
                       (TRAFARE/TRANTKT);
COMPUTE OAVTP/P12 = IF ((ONLNTKT LT 1) AND (ONLNTKT GT (-1))) THEN 0 ELSE
                       (ONLFARE/ONLNTKT);
COMPUTE ONLSAV/P12 = IF OAVTP EQ 0 THEN 0 ELSE (TAVTP - OAVTP);
BY TRAN
WHERE INTL_DOM EQ 'D'
ON TABLE HOLD AS SAVTRN
END
-RUN



GRAPH FILE SAVTRN
PRINT ONLSAV AS ' '
ACROSS TRAN AS ' '
ON GRAPH SET LOOKGRAPH VLINE
ON GRAPH SET BARNUMB OFF
ON GRAPH SET 3D OFF
ON GRAPH SET VZERO ON
ON GRAPH SET GRID OFF
ON GRAPH SET GRAPHSTYLE *
setLegendDisplay(false);
setFillColor(getSeries(0), new Color, 0 64 128));
setMarkerDisplay(true);
setConnectLineMarkers(true);
setO1LabelRotate(0);
setO1MajorGridDisplay(false);
setO1MinorGridDisplay(false);
setSeriesType(0,2);
setY1LabelDisplay(true);
setY1LabelFormat(6);
setFontSizeAbsolute(getY1Label(),true);
setY1MajorGridDisplay(false);
setY1MinorGridDisplay(false);
setPieFeelerTextDisplay(2);
setPieLabelDisplay(1);
setTextFormatPreset(getPieSliceLabel(),1);
setTitleString("Online Savings per ticket");
setTextJustHoriz(getTitle(),1);
setFontSizeAbsolute(getTitle(),true); 
setFontStyle(getTitle(),1);
setPlace(true);
ENDSTYLE
ON GRAPH HOLD AS ONLSAV FORMAT SVG
END
-RUN

-SET &G_TDG3=IF &LINES GT 0 THEN 'Y' ELSE 'N';
-AROUNDG


-**************************************************************************
-* Begin Comments
-**************************************************************************

TABLE FILE ONLT1
SUM 
COMPUTE OAVGDM/D6 = IF ((ONLMKTS LT 1) AND (ONLMKTS GT (-1))) THEN 0 ELSE
                        (ONLFARE/ONLMKTS);
COMPUTE TAVGDM/D6 = IF ((TRAMKTS LT 1) AND (TRAMKTS GT (-1))) THEN 0 ELSE
                        (TRAFARE/TRAMKTS);
COMPUTE OSAV/P12 = TAVGDM - OAVGDM;
COMPUTE AOSAV/P12 = OSAV * ONLMKTS;
COMPUTE ABSOASV/P12 = ABS(OSAV);
COMPUTE CM1/A83 = 'Comparing Online vs Traditional domestic markets the average online market price is';
COMPUTE CM2/A25 = 'booked through an agent.';
COMPUTE CM3/A28  = 'This represents a savings of';
COMPUTE PRINTC3/A1 = IF OSAV LT 0 THEN 'N' ELSE 'Y';
BY TOTAL
ON TABLE HOLD AS ONLCMT1
END
-RUN

TABLE FILE ONLCMT1
PRINT OAVGDM TAVGDM OSAV AOSAV CM1 CM2 CM3 ABSOASV PRINTC3
ON TABLE SAVE AS ONLCMT2
END
-RUN

-SET &OAVGDM = ' ';
-SET &TAVGDM = ' ';
-SET &OSAV = ' ';
-SET &AOSAV = ' ';
-SET &CM1 = ' ';
-SET &CM2 = ' ';
-SET &CM3 = ' ';


-READ ONLCMT2 NOCLOSE &OAVGDM.6. &TAVGDM.6. &OSAV.12. &AOSAV.12. &CM1.83. &CM2.25. &CM3.28. &ABSOASV.12. &PRINTC3.1.

EX FMTNUMBER VALUE=&OAVGDM,DOLLAR=Y,ALIGNED='N'
-RUN
-SET &OAVGDM = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&TAVGDM,DOLLAR=Y,ALIGNED='N'
-RUN
-SET &TAVGDM = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&OSAV,DOLLAR=Y,LEN=8
-RUN
-SET &OSAV = '&&RETVAL.EVAL';

EX FMTNUMBER VALUE=&AOSAV,DOLLAR=Y,ALIGNED='N'
-RUN
-SET &AOSAV = '&&RETVAL.EVAL';

-SET &CLINEA = IF &ABSOASV LT 1 THEN ' ' ELSE &CM1;
-SET &CLINEB = IF &ABSOASV LT 1 THEN ' ' ELSE &CM2;
-*-SET &CLINEC = IF &ABSOASV LT 1 THEN ' ' ELSE &CM3;

-*-SET &CLINEA = IF &OSAV LT 1 THEN ' ' ELSE &CM1;
-*-SET &CLINEB = IF &OSAV LT 1 THEN ' ' ELSE &CM2;
-SET &CLINEC = IF &PRINTC3 EQ 'N' THEN ' ' ELSE &CM3;


-SET &SPACE = ' ';
-SET &CLINE1 = IF &CLINEA NE ' ' THEN '&CLINEA.EVAL &OAVGDM.EVAL' ELSE ' ';
-SET &CLINE2 = IF &CLINEA NE ' ' THEN  'versus &TAVGDM.EVAL  &CM2.EVAL'  ELSE ' ';
-SET &CLINE3 = IF &PRINTC3 EQ 'Y' THEN '&CLINEC.EVAL &AOSAV.EVAL year to date.'  ELSE ' ';

TABLE FILE BRPTINST
BY INST_KEY NOPRINT
ON TABLE SET PAGE-NUM OFF
&&OUTLINE1
&&OUTLINE2
FOOTING
"</3"
"<56 Potential <75 Potential <94 Potential"
"<28 Traditional <37 Online <46 Potential <56 Adoption Rate <65 Potential <75 Adoption Rate <84 Potential <94 Adoption Rate"
"<10 Total Net  <19 Current Online <28 Average <37 Average <46 Savings - 25% <56 with 25% <65 Savings - 50% <75 with 50% <84 Savings - 75% <94 with 75%" 
"<10 Tickets Issued  <19 Adoption % <28 Ticket Price <37 Ticket Price <46 Online Increase <56 Increase <65 Online Increase <75 Increase <84 Online Increase <94 Increase"
" "
" "
" "
"<1 &TOTAL <&POS1 &NTCNT <&POS2 &ONLAP <&POS3 &TAVTP <&POS4 &OAVTP <&POS5 &25ONLI <&POS6 &25ONLA <&POS7 &50ONLI <&POS8 &50ONLA <&POS9 &75ONLI <&POS10 &75ONLA"
"</36"
"&CLINE1"
"&CLINE2"
" "
"&CLINE3"
"</5 Savings (online vs. traditional) calculation: Online avg market price minus traditional avg market price multiplied by number of online markets"
"Potential savings calculation: Traditional net tickets multiplied by percentage increase multiplied by online savings"
"Potential adoption rate calculation: Traditional net tickets multiplied by percentage increase plus current online net tickets divided by total net tickets"
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.250000, RIGHTMARGIN=0.150000, 
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON, 
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=FOOTING,FONT=TIMES NEW ROMAN, SIZE=8, $
TYPE=FOOTING, LINE=5, SIZE=8, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=6, SIZE=8, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=7, SIZE=8, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=8, SIZE=8, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=12, SIZE=8, ITEM=1, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=50, SIZE=15, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=51, SIZE=15, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=FOOTING, LINE=53, SIZE=15, FONT=TIMES NEW ROMAN, STYLE=BOLD, $
TYPE=REPORT, IMAGE=OnlineAnalysisD.GIF,POSITION=(0.1 0.1), SIZE=(10.75 .75), $
TYPE=REPORT, IMAGE=bgclgreyh.GIF, POSITION=(1.0 1.1) , SIZE=(8.6 .75),$
-IF '&&SKIPGRAPH.EVAL' EQ 'Y' OR &G_TDG3 EQ 'N' THEN GOTO SKIP_DGAT3;
TYPE=REPORT,
IMAGE=ONLSAV.SVG,
    POSITION=(2.0  3.0), SIZE=(6.5 2.8), $
-SKIP_DGAT3
ENDSTYLE
END
-RUN


