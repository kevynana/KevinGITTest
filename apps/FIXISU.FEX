-* File FIXFUJI.FEX

-***************************************************************************
-* This program will update the AL, CL and HL databases when there is a blank
-* AROLL_LEV1 or AROLL_DSC1 - based off of the TTPHIERA0 file.
-* DATE           NAME
-* 03/27/02       Steve Cords - Initial Creation
-***************************************************************************
-* CHANGES THAT NEED TO BE MADE FOR EACH COMPANY
-* 1.  COMPANY (IE...METX VS. FUJI)
-* 2.  AROLL_LEVX (X IS TOTAL NUMBER OF LEVELS)
-* 3.  LEVELX (X IS VALIDATION LEVEL)
-* 4.  THE BAD HIERARCHY LEVEL (IE....079)
-* 4.  THE NEW VALID HIERARCHY LEVEL (IE...DEF)

-* -GOTO UPDATEC

-* -GOTO WRNRFIX

-GOTO CH2MFIX

-* -GOTO FUJIFIX

TABLE FILE A_FUJI
PRINT AIR_KEY LEVEL1
BY AIR_KEY NOPRINT
IF LEVEL1 EQ '000000';
-* IF BR_CL_IDX EQ 'AC170001';
ON TABLE HOLD
END
-RUN

MODIFY FILE A_FUJI
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE LEVEL1='DEF';
ON MATCH UPDATE LEVEL1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* CAR

TABLE FILE C_FUJI
PRINT CAR_KEY LEVEL1
BY CAR_KEY NOPRINT
IF LEVEL1 EQ '000000';
-* IF BR_CL_IDX EQ 'AC170001';
ON TABLE HOLD
END
-RUN

MODIFY FILE C_FUJI
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE LEVEL1='DEF';
ON MATCH UPDATE LEVEL1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* HOTEL

TABLE FILE H_FUJI
PRINT HTL_KEY LEVEL1
BY HTL_KEY NOPRINT
IF LEVEL1 EQ '000000';
-* IF BR_CL_IDX EQ 'AC170001';
ON TABLE HOLD
END
-RUN

MODIFY FILE H_FUJI
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE LEVEL1='DEF';
ON MATCH UPDATE LEVEL1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-UPDATEA
-*AIR

SET ASNAMES=ON

TABLE FILE ALFUJI
PRINT AIR_KEY
BY AIR_KEY NOPRINT
WHERE (AROLL_LEV1 EQ ' ') OR (AROLL_DSC1 EQ ' ')
ON TABLE HOLD AS ALHOLD
END
-RUN

USE
D:\TNT\TTRACKER\DATA\A_FUJI.FOC AS AIR_MAIN
END
-RUN

TABLE FILE AIR_MAIN
PRINT AIR_KEY LEVEL1
BY AIR_KEY NOPRINT
ON TABLE HOLD AS AIRHOLD
END
-RUN

MATCH FILE AIRHOLD
PRINT AIR_KEY LEVEL1
BY AIR_KEY NOPRINT
RUN
FILE ALHOLD
SUM AIR_KEY
BY AIR_KEY NOPRINT
AFTER MATCH HOLD NEW
-* AFTER MATCH HOLD OLD-NOT-NEW
END
-RUN

TABLE FILE HOLD
PRINT AIR_KEY LEVEL1 AS 'AROLL_LEV8'
BY LEVEL1 NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK D:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT *
BY AROLL_LEV8 NOPRINT
IF AROLL_LEV1 EQ 'FUJI-R'
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE HOLD2
PRINT AIR_KEY
BY AROLL_LEV8 NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY AROLL_LEV8 NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE ALFUJI
FIXFORM FROM HOLD3
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
ON MATCH UPDATE AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
ON MATCH UPDATE AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
ON MATCH UPDATE AROLL_LEV9 AROLL_DSC9
DATA ON HOLD3
END
-RUN

-UPDATEC
-*CAR

SET ASNAMES=ON

TABLE FILE CLFUJI
PRINT CAR_KEY
BY CAR_KEY NOPRINT
WHERE (AROLL_LEV1 EQ ' ') OR (AROLL_DSC1 EQ ' ')
ON TABLE HOLD AS CLHOLD
END
-RUN

USE
D:\TNT\TTRACKER\DATA\C_FUJI.FOC AS CAR_MAIN
END
-RUN

TABLE FILE CAR_MAIN
PRINT CAR_KEY LEVEL1
BY CAR_KEY NOPRINT
ON TABLE HOLD AS CARHOLD
END
-RUN

MATCH FILE CARHOLD
PRINT CAR_KEY LEVEL1
BY CAR_KEY NOPRINT
RUN
FILE CLHOLD
SUM CAR_KEY
BY CAR_KEY NOPRINT
AFTER MATCH HOLD NEW
-* AFTER MATCH HOLD OLD-NOT-NEW
END
-RUN

TABLE FILE HOLD
PRINT CAR_KEY LEVEL1 AS 'AROLL_LEV8'
BY LEVEL1 NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK D:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT *
BY AROLL_LEV8 NOPRINT
IF AROLL_LEV1 EQ 'FUJI-R'
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE HOLD2
PRINT CAR_KEY
BY AROLL_LEV8 NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY AROLL_LEV8 NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY CAR_KEY NOPRINT
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE CLFUJI
FIXFORM FROM HOLD3
MATCH CAR_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
ON MATCH UPDATE AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
ON MATCH UPDATE AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
ON MATCH UPDATE AROLL_LEV9 AROLL_DSC9
DATA ON HOLD3
END
-RUN

-UPDATEH
-*HOTEL

SET ASNAMES=ON

TABLE FILE HLFUJI
PRINT HTL_KEY
BY HTL_KEY NOPRINT
WHERE (AROLL_LEV1 EQ ' ') OR (AROLL_DSC1 EQ ' ')
ON TABLE HOLD AS HLHOLD
END
-RUN

USE
D:\TNT\TTRACKER\DATA\H_FUJI.FOC AS HTL_MAIN
END
-RUN

TABLE FILE HTL_MAIN
PRINT HTL_KEY LEVEL1
BY HTL_KEY NOPRINT
ON TABLE HOLD AS HTLHOLD
END
-RUN

MATCH FILE HTLHOLD
PRINT HTL_KEY LEVEL1
BY HTL_KEY NOPRINT
RUN
FILE HLHOLD
SUM HTL_KEY
BY HTL_KEY NOPRINT
AFTER MATCH HOLD NEW
-* AFTER MATCH HOLD OLD-NOT-NEW
END
-RUN

TABLE FILE HOLD
PRINT HTL_KEY LEVEL1 AS 'AROLL_LEV8'
BY LEVEL1 NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK D:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT *
BY AROLL_LEV8 NOPRINT
IF AROLL_LEV1 EQ 'FUJI-R'
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE HOLD2
PRINT HTL_KEY
BY AROLL_LEV8 NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY AROLL_LEV8 NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY HTL_KEY NOPRINT
ON TABLE HOLD AS HOLD3
END
-RUN

MODIFY FILE HLFUJI
FIXFORM FROM HOLD3
MATCH HTL_KEY
ON NOMATCH INCLUDE
ON MATCH UPDATE AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
ON MATCH UPDATE AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
ON MATCH UPDATE AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
ON MATCH UPDATE AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
ON MATCH UPDATE AROLL_LEV9 AROLL_DSC9
DATA ON HOLD3
END
-RUN
-EXIT

-FUJIFIX

TABLE FILE ALFUJI
PRINT AIR_KEY
IF AROLL_LEV2 EQ 'FUJIBP'
ON TABLE HOLD
END
-RUN

MODIFY FILE ALFUJI
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE AROLL_DSC2='(FUJIBP) FUJIBP-BUSINESS + PERSONAL';
ON MATCH UPDATE AROLL_DSC2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN


TABLE FILE CLFUJI
PRINT CAR_KEY
IF AROLL_LEV2 EQ 'FUJIBP'
ON TABLE HOLD
END
-RUN

MODIFY FILE CLFUJI
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_DSC2='(FUJIBP) FUJIBP-BUSINESS + PERSONAL';
ON MATCH UPDATE AROLL_DSC2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

TABLE FILE HLFUJI
PRINT HTL_KEY
IF AROLL_LEV2 EQ 'FUJIBP'
ON TABLE HOLD
END
-RUN

MODIFY FILE HLFUJI
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_DSC2='(FUJIBP) FUJIBP-BUSINESS + PERSONAL';
ON MATCH UPDATE AROLL_DSC2
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

-WRNRFIX

-* AIR

TABLE FILE ALWRNR
PRINT AIR_KEY
IF AROLL_LEV6 EQ 'WV'
ON TABLE HOLD
END
-RUN

MODIFY FILE ALWRNR
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE AROLL_DSC6='(WV) WERNER ENT VALUE ADDED SERVICES';
ON MATCH UPDATE AROLL_DSC6
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* CAR

TABLE FILE CLWRNR
PRINT CAR_KEY
IF AROLL_LEV6 EQ 'WV'
ON TABLE HOLD
END
-RUN

MODIFY FILE CLWRNR
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_DSC6='(WV) WERNER ENT VALUE ADDED SERVICES';
ON MATCH UPDATE AROLL_DSC6
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN

-* HOTEL

TABLE FILE HLWRNR
PRINT HTL_KEY
IF AROLL_LEV6 EQ 'WV'
ON TABLE HOLD
END
-RUN

MODIFY FILE HLWRNR
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_DSC6='(WV) WERNER ENT VALUE ADDED SERVICES';
ON MATCH UPDATE AROLL_DSC6
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

-* -CH2MFIX

-* AIR

TABLE FILE SR_50
PRINT AIR_KEY
IF AROLL_LEV8 EQ 'DEFL8'
IF BR_CL_IDX EQ 'DE899971'
ON TABLE HOLD
END
-RUN

MODIFY FILE ALCH2M
FIXFORM FROM HOLD
MATCH AIR_KEY
ON MATCH COMPUTE AROLL_DSC9='(DEFP8) DEFAULT PERSONAL LEVEL8';
ON MATCH COMPUTE AROLL_LEV9='DEFP8';
ON MATCH COMPUTE AROLL_DSC8='(DEFP8) DEFAULT PERSONAL LEVEL8';
ON MATCH COMPUTE AROLL_LEV8='DEFP8';
ON MATCH COMPUTE AROLL_DSC7='(DEFP7) DEFAULT PERSONAL LEVEL7';
ON MATCH COMPUTE AROLL_LEV7='DEFP7';
ON MATCH COMPUTE AROLL_DSC6='(DEFP6) DEFAULT PERSONAL LEVEL6';
ON MATCH COMPUTE AROLL_LEV6='DEFP6';
ON MATCH COMPUTE AROLL_DSC5='(DEFP5) DEFAULT PERSONAL LEVEL5';
ON MATCH COMPUTE AROLL_LEV5='DEFP5';
ON MATCH COMPUTE AROLL_DSC4='(DEFP4) DEFAULT PERSONAL LEVEL4';
ON MATCH COMPUTE AROLL_LEV4='DEFP4';
ON MATCH COMPUTE AROLL_DSC3='(DEFP3) DEFAULT PERSONAL LEVEL3';
ON MATCH COMPUTE AROLL_LEV3='DEFP3';
ON MATCH COMPUTE AROLL_DSC2='(CH2MP) CH2M HILL PERSONAL';
ON MATCH COMPUTE AROLL_LEV2='CH2MP';
ON MATCH COMPUTE AROLL_DSC1='(CH2M-R) CH2M HILL TOTAL COMPANY';
ON MATCH COMPUTE AROLL_LEV1='CH2M-R';
ON MATCH UPDATE AROLL_DSC9 AROLL_DSC8 AROLL_DSC7
ON MATCH UPDATE AROLL_DSC6 AROLL_DSC5 AROLL_DSC4
ON MATCH UPDATE AROLL_DSC3 AROLL_DSC2 AROLL_DSC1
ON MATCH UPDATE AROLL_LEV9 AROLL_LEV8 AROLL_LEV7
ON MATCH UPDATE AROLL_LEV6 AROLL_LEV5 AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3 AROLL_LEV2 AROLL_LEV1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

-* -CH2MFIX

-* CAR

TABLE FILE CR_50
PRINT CAR_KEY
IF AROLL_LEV8 EQ 'DEFL8'
IF BR_CL_IDX EQ 'DE899971'
ON TABLE HOLD
END
-RUN

MODIFY FILE CLCH2M
FIXFORM FROM HOLD
MATCH CAR_KEY
ON MATCH COMPUTE AROLL_DSC9='(DEFP8) DEFAULT PERSONAL LEVEL8';
ON MATCH COMPUTE AROLL_LEV9='DEFP8';
ON MATCH COMPUTE AROLL_DSC8='(DEFP8) DEFAULT PERSONAL LEVEL8';
ON MATCH COMPUTE AROLL_LEV8='DEFP8';
ON MATCH COMPUTE AROLL_DSC7='(DEFP7) DEFAULT PERSONAL LEVEL7';
ON MATCH COMPUTE AROLL_LEV7='DEFP7';
ON MATCH COMPUTE AROLL_DSC6='(DEFP6) DEFAULT PERSONAL LEVEL6';
ON MATCH COMPUTE AROLL_LEV6='DEFP6';
ON MATCH COMPUTE AROLL_DSC5='(DEFP5) DEFAULT PERSONAL LEVEL5';
ON MATCH COMPUTE AROLL_LEV5='DEFP5';
ON MATCH COMPUTE AROLL_DSC4='(DEFP4) DEFAULT PERSONAL LEVEL4';
ON MATCH COMPUTE AROLL_LEV4='DEFP4';
ON MATCH COMPUTE AROLL_DSC3='(DEFP3) DEFAULT PERSONAL LEVEL3';
ON MATCH COMPUTE AROLL_LEV3='DEFP3';
ON MATCH COMPUTE AROLL_DSC2='(CH2MP) CH2M HILL PERSONAL';
ON MATCH COMPUTE AROLL_LEV2='CH2MP';
ON MATCH COMPUTE AROLL_DSC1='(CH2M-R) CH2M HILL TOTAL COMPANY';
ON MATCH COMPUTE AROLL_LEV1='CH2M-R';
ON MATCH UPDATE AROLL_DSC9 AROLL_DSC8 AROLL_DSC7
ON MATCH UPDATE AROLL_DSC6 AROLL_DSC5 AROLL_DSC4
ON MATCH UPDATE AROLL_DSC3 AROLL_DSC2 AROLL_DSC1
ON MATCH UPDATE AROLL_LEV9 AROLL_LEV8 AROLL_LEV7
ON MATCH UPDATE AROLL_LEV6 AROLL_LEV5 AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3 AROLL_LEV2 AROLL_LEV1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT

-* HOTEL

-CH2MFIX

TABLE FILE HR_50
PRINT HTL_KEY
IF AROLL_LEV8 EQ 'DEFL8'
IF BR_CL_IDX EQ 'DE899971'
ON TABLE HOLD
END
-RUN

MODIFY FILE HLCH2M
FIXFORM FROM HOLD
MATCH HTL_KEY
ON MATCH COMPUTE AROLL_DSC9='(DEFP8) DEFAULT PERSONAL LEVEL8';
ON MATCH COMPUTE AROLL_LEV9='DEFP8';
ON MATCH COMPUTE AROLL_DSC8='(DEFP8) DEFAULT PERSONAL LEVEL8';
ON MATCH COMPUTE AROLL_LEV8='DEFP8';
ON MATCH COMPUTE AROLL_DSC7='(DEFP7) DEFAULT PERSONAL LEVEL7';
ON MATCH COMPUTE AROLL_LEV7='DEFP7';
ON MATCH COMPUTE AROLL_DSC6='(DEFP6) DEFAULT PERSONAL LEVEL6';
ON MATCH COMPUTE AROLL_LEV6='DEFP6';
ON MATCH COMPUTE AROLL_DSC5='(DEFP5) DEFAULT PERSONAL LEVEL5';
ON MATCH COMPUTE AROLL_LEV5='DEFP5';
ON MATCH COMPUTE AROLL_DSC4='(DEFP4) DEFAULT PERSONAL LEVEL4';
ON MATCH COMPUTE AROLL_LEV4='DEFP4';
ON MATCH COMPUTE AROLL_DSC3='(DEFP3) DEFAULT PERSONAL LEVEL3';
ON MATCH COMPUTE AROLL_LEV3='DEFP3';
ON MATCH COMPUTE AROLL_DSC2='(CH2MP) CH2M HILL PERSONAL';
ON MATCH COMPUTE AROLL_LEV2='CH2MP';
ON MATCH COMPUTE AROLL_DSC1='(CH2M-R) CH2M HILL TOTAL COMPANY';
ON MATCH COMPUTE AROLL_LEV1='CH2M-R';
ON MATCH UPDATE AROLL_DSC9 AROLL_DSC8 AROLL_DSC7
ON MATCH UPDATE AROLL_DSC6 AROLL_DSC5 AROLL_DSC4
ON MATCH UPDATE AROLL_DSC3 AROLL_DSC2 AROLL_DSC1
ON MATCH UPDATE AROLL_LEV9 AROLL_LEV8 AROLL_LEV7
ON MATCH UPDATE AROLL_LEV6 AROLL_LEV5 AROLL_LEV4
ON MATCH UPDATE AROLL_LEV3 AROLL_LEV2 AROLL_LEV1
ON NOMATCH REJECT
DATA ON HOLD
END
-RUN
-EXIT
