MAINTAIN FILE RPT_SET AND ROLLUP AND USRROLL                                    
 FROM STK_NEW_ROLLUSR                                                           
-* PROCEDURE TO GENERATE THE DEFAULT REPORT SET EACH                            
-* TIME A ROLLUP IS ADDED TO A USER.                                            
MODULE IMPORT (MNTUWS);                                                         

CASE TOP                                                                                
COMPUTE XDate/A10 = ;                                                           
COMPUTE XTime/A8 = ;                                                            
COMPUTE XDay/YYMD = ;                                                           
COMPUTE ID_Date/A8 = ;                                                          
COMPUTE ID_Time/A6 = ;                                                          
COMPUTE ID_User/A2 = ;                                                          
COMPUTE ID_Name/A1 = ;                                                          
COMPUTE XSET/A3=;                                                               
                                                                                
INFER RPT_SET INTO RS_Temp                                                      
INFER USRROLL.USRROLL.USER_NAME INTO STK_NEW_ROLLUSR;                           
INFER ROLLUP.ROLLUP.ROLLUP_CODE INTO ROLL_STACK;                                
                                                                                
REPOSITION ROLLUP.ROLLUP_CODE                                                   
STACK CLEAR ROLL_STACK                                                          
NEXT ROLLUP.ROLLUP.ROLLUP_CODE into ROLL_STACK                                  
Where (ROLLUP.ROLLUP.ROLLUP_CODE  = STK_NEW_ROLLUSR(1).CLIENT_ID_ROLLUP);       
                                                                                
PERFORM Gen_ID                                                                  
PERFORM Gen_New_Set                                                             
ENDCASE

CASE Gen_ID                                                                     
  COMPUTE XTime = HHMMSS();                                                     
  COMPUTE XDay_A10/A10= TODAY2();                                               
  COMPUTE Xday_yymd/a10=MASK(Xday_A10,'$$$$$$9999') | '/' |                     
   MASK(Xday_A10,'99') | '/' | MASK(Xday_A10,'$$$99');                          
  COMPUTE XDate = XDay_yymd;                                                    
  COMPUTE ID_Date = MASK(XDate, '9999$99$99');                                  
  COMPUTE ID_Time = MASK(XTime, '99$99$99');                                    
  COMPUTE ID_User = MASK(STK_NEW_ROLLUSR(1).USER_NAME, '99$$$$$$');             
ENDCASE                                                                         
                                                                                
case Gen_New_Set                                                                
STACK CLEAR RS_Temp                                                             
COMPUTE RS_Temp(1).SET_ID =                                                     
  Roll_Stack(1).COMP | ID_User | ID_Date | ID_Time;                             
COMPUTE RS_Temp(1).SET_KEY = STK_NEW_ROLLUSR(1).CLIENT_ID_ROLLUP |              
  RS_Temp(1).SET_ID;                                                            
COMPUTE RS_Temp(1).ROLLUP_CODE = STK_NEW_ROLLUSR(1).CLIENT_ID_ROLLUP;           
COMPUTE RS_Temp(1).CONTROL_ID = 'PGM';                                          
COMPUTE RS_Temp(1).SET_NAME = 'Default Report Set';                             
                                                                                
COMPUTE RS_Temp(1).USER_NAME = STK_NEW_ROLLUSR(1).USER_NAME;                    
COMPUTE RS_Temp(1).USER_SECURITY = STK_NEW_ROLLUSR(1).USER_SECURITY_LEVEL;      
COMPUTE RS_TEMP(1).SET_TYPE = 'SPC';                                            
                                                                                
REPOSITION RPT_SET.SET_KEY                                                      
For 1 Include RPT_SET.SET_KEY From RS_Temp(1)                                   
COMMIT                                                                          
ENDCASE                                                                         
                                                                                
END                                                                             
