-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*  08/23/2016  REJ  S-17914 Changes for ER5.
-*  12/29/2016  REJ  S-28553 Move ER5 My Reports to production.
-*4/24/2017-JEM-S-33318-updated logic for no records report

-*SET TEMPERASE = OFF
EX SETCG SETFILE=&&SETF
-RUN
-INCLUDE OTHPARMS
 
-SET &&DRILLABLE = 'N';
 
-SET &&RPT_HOLD = 'RPTHOLD';
-SET &OUTDEST = EDIT('&&OUTTO.EVAL','9$');
 
-SET &&OUTLINE1 = IF '&OUTDEST.EVAL' EQ 'E' OR '&OUTDEST.EVAL' EQ 'T'
- THEN 'ON TABLE SAVE AS SAVREP FORMAT EXL2K'
- ELSE 'ON TABLE PCHOLD FORMAT EXL2K';
-SET &&OUTLINE2 = '';
 
-INCLUDE SETPARMTIME
-IF '&&SETF.EVAL' EQ 'BBONLINE' THEN GOTO Set1 ELSE
-IF '&&SETF.EVAL' EQ 'BBONLCH' THEN GOTO Set2 ELSE GOTO Set3;
 
-Set1
-SET &&RPTSUF = 'BBOnline';
-GOTO Cont;
-Set2
-SET &&RPTSUF = 'BBONLCH';
-GOTO Cont;
-Set3
-SET &&RPTSUF = 'SUMMARY';
 
-Cont
-INCLUDE FDEFRPTS
-RUN
 
-*-INCLUDE SetParmtime
-*-RUN
-**********************************************************************
-* DETERMINE IF WE HAVE WEB DEPLOYMENT OR LOCAL STAND ALONE
-* SET PATH FOR SAVING THE SETFILE
-**********************************************************************
-******LOCAL DEPLOYMENT
-IF &&DEPLOY EQ 'W' GOTO SETWEB;
-SET &&SETFNM= &&LOCPATH || &&DTTMSTRM ||'.FTM';
COPY &&SETF &&SETFNM
-RUN
 
-******WEB DEPLOYMENT
-SETWEB
-SET &&WEBPATH ='&&WEBSRV.EVAL' || '\TTWEB\ ' || &&ROLLUP || '\ '||&&UNAME.EVAL|| '\';
-SET &&SETFNM = &&WEBPATH || &&DTTMSTRM ||'.FTM';
 
COPY &&VARFWEB &&SETFNM
-INCLUDE SETFPARM
-RUN
 
FILEDEF AUSEINCL DISK &&AUSEPASS
-RUN
FILEDEF CUSEINCL DISK &&CUSEPASS
-RUN
FILEDEF HUSEINCL DISK &&HUSEPASS
-RUN
FILEDEF LUSEINCL DISK &&LUSEPASS
-RUN
 
-INCLUDE SELCATQT
-RUN
 
EX &&CATQTRPR
-RUN
 
FILEDEF AUSEINCL CLEAR
-RUN
FILEDEF CUSEINCL CLEAR
-RUN
FILEDEF HUSEINCL CLEAR
-RUN
FILEDEF LUSEINCL CLEAR
-RUN
 
-SET &&SMD = 'S';
-RUN
 
-SET &&RPTGRP = 'AIR';
-SET &&RPTGRP_OVERRIDE = 'AIR';
 
EX AIRUSE
-RUN
 
EX SELDESC2
-RUN
 
 
-IF '&&SETF.EVAL' EQ 'BBACHSUM' THEN GOTO ACHSUM;
 
EX BBONL
-RUN
-GOTO Cont2;
 
-ACHSUM
EX BBONL2
-RUN

-IF &RECORDS EQ 0 THEN GOTO NORECORDS;
 
-Cont2
 
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE AVRP_SUBFOOT
-:AVSF0
 
-SET &&COMPOUND=IF &&OUTLINE1 CONTAINS 'ONLINE-FMT' OR 'PCHOLD' THEN
- 'COMPOUND LAYOUT PCHOLD FORMAT ' | '&&OUTFMT.EVAL' ELSE
- 'COMPOUND LAYOUT HOLD FORMAT ' | '&&OUTFMT.EVAL';
 
-IF &&SETF EQ 'BBONLCH' THEN GOTO BBONLCH;
-IF &&SETF EQ 'BBACHSUM' THEN GOTO BBACHSUM;
 
EX BBMULTIWS
-RUN
 
-GOTO Skipthis;
-BBONLCH
 
 
EX BBACH
-RUN
 
 
EX BBMULTI2
-RUN
 
-GOTO Skipthis
 
 
 
-BBACHSUM
 
EX BBACH2
-RUN
 
EX BB_LAYOUT
-RUN
 
-Skipthis
 
 
-IF &&OUTTO EQ 'XB' GOTO SKIP_TRIG;
 
-SET &OFL=&&OUTFMT.LENGTH;
-SET &OFM='A' || '&OFL.EVAL';
-SET &&OUTFMTX=LOCASE(&OFL.EVAL, '&&OUTFMT.EVAL', '&OFM.EVAL');
 
-SET &HFILE=&&WEB_PATH || 'SAVREP.' || &&OUTFMT;
-IF &&OUTTO EQ 'TC' GOTO SRV_SAVE;
 
-GOTO SKIP_TRIG;
 
-SRV_SAVE
COPY &HFILE &&SAVSUM
 
 
-SKIP_TRIG
SET EMPTYREPORT=OFF
-RUN
 
-*-GOTO XXIT
 
 
-* REJ ADDED TO TRAP ERRORS
-SET &&FEXNOW=&&EXPARM;
-INCLUDE ERRORCHK
-IF &&RET GT 1 GOTO XXIT;
-* REJ ADDED TO TRAP ERRORS
 
-IF &RECORDS GT 0 THEN GOTO DOIT;
 
-NORECORDS; 
-SET &INST_KEY = &&IKEY;

TABLE FILE BRPTINST
PRINT PAIR_DB RPT_GROUP RPT_STREAM GLOBAL_PARM USE_PARM INST_KEY
WHERE INST_KEY EQ &INST_KEY
ON TABLE SAVE AS PAIRDB
END
-RUN

-READ PAIRDB &PAIRDB.A1. &RPTGRP.A3. &RPTSTREAM.A8. &SETFILE.A8. &VIEW.A8.
-CLOSE PAIRDB
 
-SET &RPTGRP = '&RPTGRP.EVAL';
-SET &VIEW = '&VIEW.EVAL';
-SET &STREAM = '&RPTSTREAM.EVAL';

-SET &HEADER = IF &RPTGRP EQ 'ADD' THEN 'NORECHDRDD' ELSE 'NORECHDR';
-RUN


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN &HEADER ELSE  
-              IF &RPTGRP EQ 'ADD' THEN 'HDREXLSDD' ELSE 
-              IF &STREAM EQ 'AIR_BNM' THEN 'HDREXLSDD' ELSE 'HDREXLS';

-RUN


-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE 'NORECSTY';

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
-RUN

DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE &&PAHDR
PRINT EMPTY AS 'REPORT,MESSAGE'
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
 
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN
-DOIT
 
-XXIT
 
