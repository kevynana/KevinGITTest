-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
 
-*                     FOCEXEC: AIRRPT
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               --------------------- 
-*1/24/01        SS                 NEW VIEW 
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*6/23/05    deb                CARRIED THROUGH DST_APC
-*9/06/06    DEB                CARRIED THROUGH ORG_APC
-*10/18/12   Deb                Added -GOTO Finishrpt after -Continue3 due to no HTML error
-* 5/21/13   DEB                CARRIED THROUGH FLIGHT_HOURS 
-*4/9/14     JOY                CARRIED THROUGH INT_FLAG
-*5/23/14    DEB                UPDATED NUMEROUS DEFINES TO INCLUDE EX5
-*6/9/14     JOY                ADDED LOGIC FOR GLTRIPI
-*8/27/14    JOY                ADDED JOINS TO ADD COUNTRY_NAME SORT 
-* 8/13/15    JM   S-08380  Added Logic for new ticketed versus traveled report
-*02/26/16 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels
-* 03/09/16 - DLV - S-16600 - updated STATE_NM define added DST_COUNTRY_CODE
-*                            and DST_ST2 defines for BFTRIDD
-*04/15/16 - DLV - S-16819 Added NSDCAN NSDDOM to GLOFO routine 
-*                 Carried through XFST_DPT EX_IND EX_FLAG RF_FLAG
-*                 Added RTN_DT define
-*5/6/16- JEM - S-18790 Updated goto name as KWTRIPI was looping
-* 07/11/16  RSB   S-20630 - New Employee ID database field
-*                           Changed LEVEL1 to EMP_ID in Define
-*                           Added EMP_ID to Table requests
-* 07/14/16  RSB   S-20630 - Commented out EMP_NUM
-* 02/13/17  DLV   S-30442 - Corrected NORD routine for ORG_ST_NM and DST_ST_NM
-* 08/04/2017 - JEM - S-37368 Updated LOW_AMT field to use SRT_DT instead of TKT_SORT

-* -**************************************************************************
SET ASNAMES=ON



-INCLUDE SETECHO
-RUN

-IF '&&SETF.EVAL' EQ 'KWTKTTVL' GOTO KWTKTTVL; 

TABLE FILE &&RPT_HOLD
SUM DISSAVINGS AS 'DTSAVE'
    TKT_AMOUNT AS 'TAMT'
    SEG_DISCOUNT AS 'TDISC'
    FARE_PAID AS 'TFARE'
    SEG_LOWEST AS 'TLOW'
    NEW_SEG_MILES AS 'TMILE'
    TKT_PURCH AS 'TPURCH'
    REF_EXCH_CNT AS 'TRFEX'
    SAVINGS AS 'TSAVE'
    SEG_AMT AS 'TSEG'
    SEG_STANDARD AS 'TSTD'
    SEG_TAX AS 'TTAX'
    NET_TKT_CNT AS 'TTKT'
    MRK_TKT_CNT AS 'TMKT'
    NEW_STAY AS 'TSTAY'
    TRP_LEN      
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
-IF &&SETF NE 'ABTRIPAA' OR 'ABTRIPUA' OR 'ABTRIPUS'  THEN GOTO NotThis;
WHERE (TRP_LEN GE 2) OR (TRP_LEN LE -2)  
-NotThis
ON TABLE HOLD AS AIRHOLD1
END
-RUN


TABLE FILE &&RPT_HOLD
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME
      CLIENT_NUM
      COUNTRY_CODE
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE
      INT_CODE
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      NET_TKT_CNT
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR	
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TOUR_CODE	
      TRIP_LENGTH
      TRIP_RSN
      TRP_DESC
      TRP_LEN	
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT
      XFST_DPT
      XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME
      CLIENT_NUM
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE     
      GROUP_CODE
      INT_CODE
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      NET_TKT_CNT
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR	
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TOUR_CODE	
      TRIP_LENGTH
      TRIP_RSN
      TRP_DESC
      TRP_LEN	
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT
      XFST_DPT
      XTRAN_DT	
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TAMT
      TDISC
      TFARE
      TLOW
      TMILE
      TPURCH
      TRFEX
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT 
      TMKT
      TSTAY
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
-IF &&SETF EQ 'ABTRIPAA' OR 'ABTRIPUA' OR 'ABTRIPUS' THEN GOTO Match2
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
-GOTO SkipMatch
-Match2
AFTER MATCH HOLD AS AIRHOLD2 OLD-AND-NEW
-SkipMatch
END
-RUN

-IF '&&SETF.EVAL' EQ 'GLTRIPI' OR 'NSDCAN' OR 'NSDDOM' THEN GOTO GLOFO;
-IF '&&SETF.EVAL' EQ 'ABBAGFEE' THEN GOTO ABCD ELSE GOTO NextHold;

-*-GOTO DoneHold

-NextHold

TABLE FILE AIRHOLD2
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID
      LEVEL1
      LEVEL2	
      LEVEL3	
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
-IF &&SETF NE 'WFTRIP' THEN GOTO NoWhere;
WHERE TRIP_LENGTH LE 3 AND TRIP_LENGTH GE -3
WHERE TRIP_LENGTH NE ' '
-NoWhere
ON TABLE HOLD AS AIRHOLD3
END
-RUN


-GOTO DoneHold


-ABCD
 
TABLE FILE AIRHOLD2
SUM 
    TRP_LEN
    NET_TKT_CNT
    FARE_PAID
    NEW_SEG_MILES
    NEW_STAY 
    MRK_TKT_CNT
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
WHERE DST_APC OMITS 'FP1' OR 'FP2' OR 'DT1' OR 'EX1' OR 'EX5'
ON TABLE HOLD AS HOLD3
END
-RUN

TABLE FILE &&RPT_HOLD
SUM 
    FARE_PAID AS 'AFARE'
    NEW_STAY AS 'ASTAY'
    MRK_TKT_CNT AS 'AMKT'
    AIRLINE_NAME AS 'ANAME'
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
BY AIRLINE
ON TABLE HOLD AS HOLD4
END
-RUN


MATCH FILE HOLD3
PRINT 
   TRP_LEN
    NET_TKT_CNT
    FARE_PAID
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
ON TABLE HOLD
RUN
FILE HOLD4
SUM AFARE
    ASTAY
    AMKT
    ANAME
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
BY AIRLINE
AFTER MATCH HOLD AS MATCHONE OLD-OR-NEW
END
-RUN

TABLE FILE MATCHONE
PRINT TRP_LEN
    NET_TKT_CNT
    FARE_PAID
    AFARE
    ASTAY
    AMKT
    ANAME
  LEVEL_DESC
  PASSNGR_NAME
  PNR_LOCATOR 
  TKT_NUM
BY AIRLINE
ON TABLE HOLD AS XONE
END
-RUN


JOIN XONE.AIRLINE IN XONE TO BAG_FEE.AIRLINE IN BAG_FEE AS J1

DEFINE FILE XONE
NOBAG/A1 = IF ASTAY EQ 0 THEN 'Y' ELSE 'N';

BAG1_CHK/A1 = IF NOBAG EQ 'Y' THEN 'N' ELSE
            IF (ASTAY LE 5 ) OR (ASTAY GE -5) THEN 'Y' ELSE 'N';

BAG2_CHK/A1 = IF NOBAG EQ 'Y' THEN 'N' ELSE
          IF (ASTAY GE 6) OR (ASTAY LE -6) THEN 'Y' ELSE 'N';
BAG1_FEE/D12.2CS =  IF BAG1_CHK EQ 'Y' THEN AMKT * BAG1FEE ELSE 0;
BAG2_FEE/D12.2CS =  IF BAG2_CHK EQ 'Y'  THEN AMKT * BAG2FEE ELSE 0;
BAG1_TRP/A1 = IF (ASTAY GE 1) AND (ASTAY LE 5) OR (ASTAY LE -1 ) AND (ASTAY GE -5) THEN 'Y' ELSE 'N';
BAG2_TRP/A1 = IF (ASTAY GE 6) OR (ASTAY LE -6) THEN 'Y' ELSE 'N';
NOFEE_AL/A1 = IF AIRLINE EQ 'AC' OR 'BA' OR 'B6' OR 'WN' OR 'YX' THEN 'Y' ELSE 'N';

BAG1_TRIP/D12CS = IF BAG1_TRP EQ 'Y' THEN AMKT ELSE 0;
BAG2_TRIP/D12CS =  IF BAG2_TRP EQ 'Y' THEN AMKT ELSE 0;
BAG_TOT/D12.2CS = BAG1_FEE + BAG2_FEE;          
END
TABLE FILE XONE
PRINT  
    NOBAG
    BAG1_CHK
    BAG2_CHK
    NET_TKT_CNT  
    ASTAY 
    AMKT
    BAG1FEE
    BAG2FEE
    ANAME
    BAG1FEE
    BAG2FEE
    BAG1_FEE
    BAG2_FEE
    BAG_TOT
    BAG1_TRIP
    BAG2_TRIP
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
BY AIRLINE
ON TABLE HOLD AS BAGFEES
END
-RUN




MATCH FILE AIRHOLD2
PRINT AIR_KEY	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM	
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      GROUP_CODE	
      INT_CODE 
      INTL_DOM	
      INVOICE_NUM	
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NET_TKT_CNT
      NEW_STAY
      ORG_APC
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE	
      RTE_APT_CD
      RTE_APT_NM
      RTE_CTY_NM	
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_NBR
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_SORT
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      TSTAY
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XPSNGR_NM
      XTRAN_DT
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
BY AIRLINE
ON TABLE HOLD 
RUN
FILE BAGFEES
SUM  
    ASTAY 
    AMKT
    BAG1FEE
    BAG2FEE
    ANAME
    BAG1FEE
    BAG2FEE
    BAG1_FEE
    BAG2_FEE
    BAG_TOT
    BAG1_TRIP
    BAG2_TRIP
BY LEVEL_DESC
BY PASSNGR_NAME
BY PNR_LOCATOR 
BY TKT_NUM
BY AIRLINE
AFTER MATCH HOLD AS AIRHOLD3 OLD-OR-NEW
AFTER MATCH HOLD AS AIRHOLD3 NEW
END
-RUN



-DoneHold

-IF &&SETF EQ 'ITTRIPD' OR 'BFTRIDD' OR 'ITTRPCAN' THEN GOTO Continue3;
-IF &&SETF EQ 'KWTRIPI' THEN GOTO Continue4;


-* -IF &&SETF EQ 'CHTRIPL' THEN GOTO Finishrpt;

JOIN AIRHOLD3.DST_APCX IN AIRHOLD3 TO AIRPORT.APCODEX IN AIRPORT AS J1

JOIN AIRPORT.COUNTRY_CODE IN AIRHOLD3 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J2

-GOTO Finishrpt;

-Continue2

 
JOIN AIRHOLD3.DST_APCX IN AIRHOLD3 TO ALL AIRPORT.APCODEX IN AIRPORT AS J1

JOIN AIRPORT.STATE_CODE IN AIRHOLD3 TO ALL STATE.STATE_CODE IN STATE AS J2

-GOTO Finishrpt;

-Continue3


 
JOIN AIRHOLD3.DST_APCX IN AIRHOLD3 TO AIRPORT.APCODEX IN AIRPORT AS J1

-IF '&&SETF.EVAL' EQ 'BFTRIDD' THEN GOTO BFDS;

JOIN AIRPORT.STATE_CODE IN AIRHOLD3 TO STATE.STATE_CODE IN STATE AS J2

-GOTO Finishrpt

-Continue4

JOIN AIRHOLD3.FNL_DEST_CNTY_CODE IN AIRHOLD3 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J1
-RUN

-GOTO Finishrpt

-BFDS
TABLE FILE AIRHOLD3
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX

      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID
      LEVEL1
      LEVEL2	
      LEVEL3	
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XPSNGR_NM
      XTRAN_DT
      COUNTRY_CODE AS 'DST_CNTRY'
BY  STATE_CODE AS 'DST_STATE'            
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3A
END
-RUN



JOIN AIRHOLD3A.DST_STATE IN AIRHOLD3A TO STATE.STATE_CODE IN STATE AS J2
-RUN 

DEFINE FILE AIRHOLD3A
 
DST_COUNTRY_CODE/A3 = IF DST_APCX EQ 'NYCA' OR 'WASA' OR 'MIAA' OR 'DENA' OR 'BHMA'
                      OR 'LAXA' THEN 'US' ELSE DST_CNTRY;
DST_ST2/A3 = IF DST_APCX EQ 'WAST' OR 'WASA' THEN 'DC' ELSE
            IF DST_APCX EQ 'STMT' THEN 'CT' ELSE
            IF DST_APCX EQ 'NYPT' OR 'NYCA' THEN 'NY' ELSE
            IF DST_APCX EQ 'BBYT' OR 'BOST' OR 'FRAT' THEN 'MA' ELSE
            IF DST_APCX EQ 'PHLT' THEN 'PA' ELSE
            IF DST_APCX EQ 'EWRT' THEN 'NJ' ELSE
            IF DST_APCX EQ 'LAXA' THEN 'CA' ELSE 
            IF DST_APCX EQ 'MIAA' THEN 'FL' ELSE   
            IF DST_APCX EQ 'BHMA' THEN 'AL' ELSE 
            IF DST_APCX EQ 'DENA' THEN 'CO' ELSE DST_STATE; 
END
TABLE FILE AIRHOLD3A
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DST_ST2 AS 'DST_STATE'
      DST_COUNTRY_CODE
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD
      STATE_NAME
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN


-GOTO Finishrpt;

-GLOFO

TABLE FILE &&RPT_HOLD
PRINT XDPT_DT    
BY AIR_KEY
BY SEG_NBR NOPRINT
WHERE EMBARK OMITS 'DT1' OR 'FP' 
ON TABLE HOLD AS TEST1
END
-RUN


TABLE FILE TEST1
SUM LST.XDPT_DT AS 'RTN_DT'
BY AIR_KEY
ON TABLE HOLD AS TEST2
END
-RUN

MATCH FILE AIRHOLD2
PRINT  
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_NBR
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_SORT
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY AIR_KEY
ON TABLE HOLD
RUN
FILE TEST2
SUM RTN_DT
BY AIR_KEY
AFTER MATCH HOLD AS AIRHOLD2X OLD-OR-NEW
END
-RUN



TABLE FILE AIRHOLD2X
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      RTN_DT
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3A
END
-RUN


 

JOIN CLEAR *
-RUN



JOIN AIRHOLD3A.DST_APCX IN AIRHOLD3A TO AIRPORT.APCODEX IN AIRPORT AS J1

JOIN AIRPORT.COUNTRY_CODE IN AIRHOLD3A TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J2
-RUN

TABLE FILE AIRHOLD3A
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME
      AIRPORT_NAME AS 'DST_AP_NAM'
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN 
      C_ITIN
      CITY_CODE AS 'DST_CITY'
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD
      COUNTRY_NAME AS 'DCOUNTRY'
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      CITY_CODE AS 'DST_CITY'
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      RTN_DT
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STATE_CODE AS 'DST_STATE'
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3B
END
-RUN


JOIN CLEAR *
-RUN

JOIN AIRHOLD3B.ORG_APCX IN AIRHOLD3B TO AIRPORT.APCODEX IN AIRPORT AS J1

JOIN AIRPORT.COUNTRY_CODE IN AIRHOLD3B TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J2
-RUN


TABLE FILE AIRHOLD3B
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME
      AIRPORT_NAME AS 'ORG_AP_NM'  
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      CL_CAT	
      C_ITIN
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD
      DISSAVINGS
      DCOUNTRY 
      COUNTRY_NAME AS 'OCOUNTRY'
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DST_AP_NAM
      DST_CITY
      DST_STATE
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      CITY_CODE AS 'ORG_CITY'
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      RTN_DT
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD
      STATE_CODE AS 'ORG_STATE'
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3C
END
-RUN


-IF '&&SETF.EVAL' EQ 'NSDCAN' OR 'NSDDOM' THEN GOTO NORD;
 

TABLE FILE AIRHOLD3C
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD
      DCOUNTRY AS 'COUNTRY_NAME'
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_AP_NAM
      DST_APCX
      DST_CITY
      DST_STATE
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      ORG_AP_NM
      ORG_CITY
      ORG_STATE
      OCOUNTRY
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      RTN_DT
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN

-GOTO Finishrpt

-NORD
 
JOIN CLEAR *
-RUN

JOIN AIRHOLD3C.ORG_CITY IN AIRHOLD3C TO CITY.CITY_CODE IN CITY AS J1
-RUN
JOIN AIRHOLD3C.ORG_STATE IN AIRHOLD3C TO STATE.STATE_CODE IN STATE AS J2
-RUN

TABLE FILE AIRHOLD3C
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CITY_NAME AS 'ORG_CTY_NM'
      CHT_LEN
      C_ITIN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD
      DCOUNTRY
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_AP_NAM
      DST_APCX
      DST_CITY
      DST_STATE
      STATE_NAME AS 'ORG_ST_NM'
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      ORG_AP_NM
      ORG_CITY
      ORG_STATE
      OCOUNTRY
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      RTN_DT
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_NBR
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM
      TKT_SORT
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3D
END
-RUN

JOIN CLEAR *
-RUN

JOIN AIRHOLD3D.DST_CITY IN AIRHOLD3D TO CITY.CITY_CODE IN CITY AS J1
-RUN

JOIN AIRHOLD3D.DST_STATE IN AIRHOLD3D TO STATE.STATE_CODE IN STATE AS J2
-RUN

TABLE FILE AIRHOLD3D
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      C_ITIN
      CITY_NAME AS 'DST_CTY_NM'
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM	
      CREDIT_CARD
      DCOUNTRY
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_AP_NAM
      DST_APCX
      DST_CITY
      DST_STATE
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM
      EX_FLAG
      EX_IND
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      LEVEL4
      LEVEL5
      LEVEL6
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      ORG_AP_NM
      ORG_CITY
      ORG_CTY_NM 
      ORG_STATE
      ORG_ST_NM
      STATE_NAME AS 'DST_ST_NM'
      OCOUNTRY
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE
      RF_FLAG
      RND_TRP
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      RTN_DT
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XFST_DPT
      XPSNGR_NM
      XTRAN_DT
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN




-Finishrpt

DEFINE FILE AIRHOLD3
-INCLUDE STDTIME
CPMILE/D12.2CS = FARE_PAID/SEG_MILES;
LEV_1/A15 = IF TKT_NUM NE LAST TKT_NUM THEN EMP_ID ELSE ' ';
LEV_2/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL2 ELSE ' ';
LEV_3/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL3 ELSE ' ';

NETTKT/D9S = TTKT;
NET_TKT_CNT/D9S = IF (SEG_NBR EQ '01') THEN  TTKT ELSE 0;

PASNGR_NAME/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
REASON_CD/A2 =  IF TKT_NUM NE LAST TKT_NUM THEN REFUSE_CODE ELSE ' ';
RREFUSE_CODE/A2 = IF TKT_SORT NE LAST TKT_SORT THEN REFUSE_CODE ELSE ' ';


TICKET_NMBR/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_NUM ELSE ' ';
TOTAL_MILES/D8CS = IF TKT_SORT NE LAST TKT_SORT THEN TMILE ELSE 0;
XBOOK_DT/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN BOOK_DT ELSE 0;
-* XMTG_NUM/A7 = IF TKT_NUM NE LAST TKT_NUM THEN MTG_NUM ELSE ' ';
XT_DTE/A8 = EDIT(TRN_DATE);
XTKT_SRT/A10 = EDIT(TKT_SORT,'9999999999$');
XTRAN_DTE/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN XTRAN_DT ELSE 0;
-******************************************************************
-*  9/21/00  IBISTL-RJ    DEFINED AS AN 'A2', SHOULD BE 'A3'
XVAL_ALN/A3 = IF TKT_NUM NE LAST TKT_NUM THEN VAL_AIRLINE ELSE ' ';
TRAN_MONTH/MT = TRN_DATE;
 


-* ****DEFINES ON PREVIOUS DEFINES****
SRT_DT/A120 = TKT_SORT||XT_DTE||LEVEL_DESC||XPSNGR_NM;
SRT_DT2/A132 = LEVEL_DESC||PASSNGR_NAME||PNR_LOC||TKT_NUM||AIRLINE;
FARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TFARE ELSE 0;
MKT_CNT/D8CS     = IF SRT_DT NE LAST SRT_DT THEN TMKT ELSE 0;

RADV_PURCH/I8CS = IF (EMB_APT_CD EQ 'FP2' OR 'EX1' OR 'RF1' OR 'EX5') THEN 0
  ELSE IF (TKT_TYPE EQ 'P-RF' OR 'P-EX') THEN 0
  ELSE IF (SEG_NBR EQ '00') THEN 0
  ELSE IF (TKT_SORT NE LAST TKT_SORT) AND (FARE_AMT GE 0) THEN NEW_ADV_PURCH
  ELSE IF (TKT_SORT NE LAST TKT_SORT) AND (FARE_AMT LT 0)
  THEN NEW_ADV_PURCH * (-1) ELSE 0;
SAVE_AMT/D10.2CS = IF SRT_DT NE LAST SRT_DT THEN TSAVE ELSE 0;
TK_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TAMT ELSE 0;
XSEG_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TSEG ELSE 0;
XTRP_LEN/I5CS = IF SRT_DT NE LAST SRT_DT THEN TRIP_LENGTH * TTKT ELSE 0;
-IF '&&SETF.EVAL' NE 'ABBAGFEE' GOTO Skipdefine;

TKT_NBR/A10 = IF SRT_DT2 NE LAST SRT_DT2 THEN TKT_NUM ELSE ' ';

1BAG_FEE/D12.2CS = IF (EMB_APT_CD EQ 'FP2' OR 'EX1' OR 'RF1' OR 'EX5') THEN 0 ELSE
                   IF (TKT_TYPE EQ 'P-RF' OR 'P-EX') THEN 0 ELSE
                   IF SRT_DT2 NE LAST SRT_DT2 THEN BAG1_FEE ELSE 0;
2BAG_FEE/D12.2CS = IF (EMB_APT_CD EQ 'FP2' OR 'EX1' OR 'RF1' OR 'EX5') THEN 0 ELSE
                   IF (TKT_TYPE EQ 'P-RF' OR 'P-EX') THEN 0 ELSE
                   IF SRT_DT2 NE LAST SRT_DT2 THEN BAG2_FEE ELSE 0;
BAG_TOT/D12.2CS = 1BAG_FEE + 2BAG_FEE;
1BAG_TRIP/D12CS =  IF SRT_DT2 NE LAST SRT_DT2 THEN BAG1_TRIP ELSE 0;
2BAG_TRIP/D12CS =  IF SRT_DT2 NE LAST SRT_DT2 THEN BAG2_TRIP ELSE 0;
TOT_TRIPS/D12CS = 1BAG_TRIP + 2BAG_TRIP;

-Skipdefine
-IF &&SETF NE 'ITTRIPD' OR 'BFTRIDD' OR 'ITTRPCAN' THEN GOTO Skipdefine2
STATE_NM/A25 = IF DST_APC EQ 'SJU' AND STATE_NAME EQ ' ' THEN 'PUERTO RICO' ELSE 
               IF DST_APC EQ 'STT' OR 'STX' AND STATE_NAME EQ ' ' THEN 'VIRGIN ISLANDS' ELSE
               IF STATE_NAME EQ ' ' THEN 'UNKNOWN' ELSE STATE_NAME;
-*                IF DST_APC EQ 'STM' AND STATE_NAME EQ ' ' THEN 'UNKNOWN' ELSE STATE_NAME;

-Skipdefine2;
-IF '&&SETF.EVAL' NE 'NSDCAN' OR 'NSDDOM' THEN GOTO Skipdefine3;
TTYPE/A25 =    IF RF_FLAG NE ' ' THEN 'Refund Credit' ELSE 
               IF EX_IND EQ 'E' THEN 'Exchange Sale' ELSE 
               IF EX_FLAG NE ' ' THEN 'Original Sale Credit' ELSE
              'Original Sale'; 


-Skipdefine3;
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*7/31/00     IBISTL-KR             ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
XTS_FLAG/A1 = ' ';
CONV_AMT/D9.2CS = IF SRT_DT NE LAST SRT_DT THEN TDISC ELSE 0;
LOST_SAV_AMT/D9.2CS = IF SRT_DT NE LAST SRT_DT THEN DTSAVE ELSE 0;
LOW_AMT/D10.2CS = IF SRT_DT NE LAST SRT_DT THEN TLOW ELSE 0;
SEG_AMT/D9.2CS = IF SRT_DT NE LAST SRT_DT THEN TSEG ELSE 0;
SEG_TAX/D9.2CS = IF SRT_DT NE LAST SRT_DT THEN TTAX ELSE 0;
STD_FARE/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TSTD ELSE 0;
END


 

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;

-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD3';
-INCLUDE DRILWHRS

-************************************************************
-SKIP_DRIL

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN
 

TABLE FILE AIRHOLD3
 
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-IF '&&SETF.EVAL' EQ 'NSDCAN' OR 'NSDDOM' THEN GOTO NORDCAN;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10

-GOTO Finishrpt1


-NORDCAN

SUM XTRAN_DT AS 'Booking,Date' 
    PASSNGR_NAME AS 'Traveler,Name'
    EMP_ID AS 'Employee,Number'
-*    TKT_NUM
-*    ORG_APCX
    ORG_CTY_NM AS 'Origin,City,Name'
    OCOUNTRY AS 'Origin,Country'
    ORG_ST_NM AS 'Origin,State/Province'
-*   DST_APCX
    DST_CTY_NM AS 'Destination,City,Name'
    DCOUNTRY  AS 'Destination,Country'
    DST_ST_NM AS 'Destination,State/Province'
    XFST_DPT AS 'Ticket,Departure,Date'
    RTN_DT AS 'Ticket,Return,Date'
    TRP_LEN AS 'Trip,Days'
    PNR_LOCATOR AS 'PNR'
    LEVEL2 AS 'Business,Unit'
    LEVEL3 AS 'Store,Number'
    LEVEL5 AS 'Cost,Center'
    TTYPE AS 'Transaction,Type'
    C_ITIN AS 'Ticket,Routing'
    RND_TRP AS 'Routing,Type'
-*   FARE_AMT
-*   NET_TKT_CNT
BY HIGHEST XTRAN_DT NOPRINT
BY PASSNGR_NAME NOPRINT
BY XPSNGR_NM NOPRINT
BY TRN_DATE NOPRINT
BY TKT_NUM NOPRINT
BY PNR_LOCATOR NOPRINT
ON TABLE COLUMN-TOTAL
 
 
-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*

-Finishrpt1
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-GOTO XXIT;

-KWTKTTVL;

TABLE FILE &&RPT_HOLD
SUM DISSAVINGS AS 'DTSAVE'
    TKT_AMOUNT AS 'TAMT'
    SEG_DISCOUNT AS 'TDISC'
    FARE_PAID AS 'TFARE'
    SEG_LOWEST AS 'TLOW'
    NEW_SEG_MILES AS 'TMILE'
    TKT_PURCH AS 'TPURCH'
    REF_EXCH_CNT AS 'TRFEX'
    SAVINGS AS 'TSAVE'
    SEG_AMT AS 'TSEG'
    SEG_STANDARD AS 'TSTD'
    SEG_TAX AS 'TTAX'
    NET_TKT_CNT AS 'TTKT'
    MRK_TKT_CNT AS 'TMKT'
    NEW_STAY AS 'TSTAY'
    TRP_LEN  
 BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      CL_CAT	
      CLASS	
      CLIENT_NAME
      CLIENT_NUM
      COUNTRY_CODE
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM	
      FARE_BAS	
      FARE_PAID	
      FLIGHT
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE
      GROUP_CODE
      INT_CODE
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      NET_TKT_CNT
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR	
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE	
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TOUR_CODE	
      TRIP_LENGTH
      TRIP_RSN
      TRP_DESC
      TRP_LEN	
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XTRAN_DT	
-* NEW TKT VERSUS TRAVELED FIELDS
      STATUS1
-*      EMP_NUM
      DISTRICT
      PTRP_LEN
      PNET_TKT
      TTRP_LEN
      TNET_TKT     
      TKT_DESC
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      CL_CAT	
      CLASS	
      CLIENT_NAME
      CLIENT_NUM
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM	
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE     
      GROUP_CODE
      INT_CODE
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      NET_TKT_CNT
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR	
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE	
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TOUR_CODE	
      TRIP_LENGTH
      TRIP_RSN
      TRP_DESC
      TRP_LEN	
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XTRAN_DT	
-*      EMP_NUM
      STATUS1
-*      EMP_NUM
      DISTRICT
      PTRP_LEN
      PNET_TKT
      TTRP_LEN
      TNET_TKT  
      TKT_DESC
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TAMT
      TDISC
      TFARE
      TLOW
      TMILE
      TPURCH
      TRFEX
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT 
      TMKT
      TSTAY
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

TABLE FILE AIRHOLD2
PRINT AIR_KEY	
      AIRLINE	
      AIRLINE_FEE	
      AIRLINE_NAME	
      ARR_DAY
      ARR_TIME	
      BAG_FEE
      BOOK_DT	
      BR_CL_IDX	
      CHT_LEN
      CL_CAT	
      CLASS	
      CLIENT_NAME	
      CLIENT_NUM
      CREDIT_CARD	
      DISSAVINGS	
      DPT_DAY
      DPT_TIME
      DST_APC
      DST_APCX
      DTSAVE
      EMB_APT_CD	
      EMB_APT_NM
      EMB_CTY_NM	
      FARE_BAS	
      FARE_PAID	
      FLIGHT	
      FLIGHT_HOURS
      FNL_DEST_CNTY_CODE AS 'COUNTRY_CODE'
      GROUP_CODE	
      INT_CODE 
      INT_FLAG
      INTL_DOM	
      INVOICE_NUM	
      LEVEL_DESC
      EMP_ID	
      LEVEL1
      LEVEL2	
      LEVEL3	
      MRK_TKT_CNT
      NEW_ADV_PURCH	
      NEW_SEG_MILES
      NEW_STAY
      ORG_APCX
      ORG_APC
      PASSNGR_NAME
      PNR_LOCATOR
      REF_EXCH_CNT	
      REFUSAL_DESC	
      REFUSE_CODE	
      RTE_APT_CD
      RTE_APT_NM
      RTE_CNTRY_CODE
      RTE_CTY_NM
      RTE_STATE
      SAVINGS	
      SEG_DESIG	
      SEG_DISCOUNT	
      SEG_LOWEST	
      SEG_MILES	
      SEG_STANDARD	
      STAY
      TAMT
      TDISC
      TFARE
      TICKET_BRANCH	
      TKT_AMOUNT	
      TKT_NUM	
      TKT_TYPE	
      TLOW
      TMILE
      TOUR_CODE	
      TPURCH
      TRFEX
      TRIP_LENGTH	
      TRN_DATE
      TRP_LEN
      TRIP_RSN
      TRP_DESC
      TMKT
      TSAVE
      TSEG
      TSTD
      TTAX
      TTKT
      VAL_AIRLINE	
      XARR_DT	
      XDPT_DT	
      XPSNGR_NM
      XTRAN_DT
      DISTRICT
      STATUS1
-*      EMP_NUM
      PTRP_LEN
      PNET_TKT
      TTRP_LEN
      TNET_TKT  
      TKT_DESC
BY TKT_SORT
BY SEG_NBR
ON TABLE HOLD AS AIRHOLD3
END
-RUN


-DoneHold


-Continue4

JOIN AIRHOLD3.COUNTRY_CODE IN AIRHOLD3 TO COUNTRY.COUNTRY_CODE IN COUNTRY AS J1
-RUN


DEFINE FILE AIRHOLD3
-INCLUDE STDTIME
CONV_AMT/D9.2CS = IF TKT_SORT NE LAST TKT_SORT THEN TDISC ELSE 0;
CPMILE/D12.2CS = FARE_PAID/SEG_MILES;
LEV_1/A15 = IF TKT_NUM NE LAST TKT_NUM THEN EMP_ID ELSE ' ';
LEV_2/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL2 ELSE ' ';
LEV_3/A15 = IF TKT_NUM NE LAST TKT_NUM THEN LEVEL3 ELSE ' ';
LOST_SAV_AMT/D9.2CS = IF TKT_SORT NE LAST TKT_SORT THEN DTSAVE ELSE 0;
LOW_AMT/D10.2CS = IF TKT_SORT NE LAST TKT_SORT THEN TLOW ELSE 0;
NETTKT/D9S = TTKT;
NET_TKT_CNT/D9S = IF (SEG_NBR EQ '01') THEN  TTKT ELSE 0;

PASNGR_NAME/A15 = IF TKT_NUM NE LAST TKT_NUM THEN XPSNGR_NM ELSE ' ';
REASON_CD/A2 =  IF TKT_NUM NE LAST TKT_NUM THEN REFUSE_CODE ELSE ' ';
RREFUSE_CODE/A2 = IF TKT_SORT NE LAST TKT_SORT THEN REFUSE_CODE ELSE ' ';

SEG_AMT/D9.2CS = IF TKT_SORT NE LAST TKT_SORT THEN TSEG ELSE 0;
SEG_TAX/D9.2CS = IF TKT_SORT NE LAST TKT_SORT THEN TTAX ELSE 0;
STD_FARE/D12.2CS = IF TKT_SORT NE LAST TKT_SORT THEN TSTD ELSE 0;
TICKET_NMBR/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_NUM ELSE ' ';
TOTAL_MILES/D8CS = IF TKT_SORT NE LAST TKT_SORT THEN TMILE ELSE 0;

XBOOK_DT/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN BOOK_DT ELSE 0;
-* XMTG_NUM/A7 = IF TKT_NUM NE LAST TKT_NUM THEN MTG_NUM ELSE ' ';
XT_DTE/A8 = EDIT(TRN_DATE);
XTKT_SRT/A10 = EDIT(TKT_SORT,'9999999999$');
XTRAN_DTE/MDYY = IF TKT_NUM NE LAST TKT_NUM THEN XTRAN_DT ELSE 0;
STAT/A7 = IF TKT_NUM NE LAST TKT_NUM THEN STATUS1 ELSE ' ';
-******************************************************************
-*  9/21/00  IBISTL-RJ    DEFINED AS AN 'A2', SHOULD BE 'A3'
XVAL_ALN/A3 = IF TKT_NUM NE LAST TKT_NUM THEN VAL_AIRLINE ELSE ' ';
TRAN_MONTH/MT = TRN_DATE;
TKT_DSC/A10 = IF TKT_NUM NE LAST TKT_NUM THEN TKT_DESC ELSE ' '; 
PNR/A6 = IF TKT_NUM NE LAST TKT_NUM THEN PNR_LOCATOR ELSE ' ';

-* ****DEFINES ON PREVIOUS DEFINES****
SRT_DT/A120 = TKT_SORT||XT_DTE||LEVEL_DESC||XPSNGR_NM;
SRT_DT2/A132 = LEVEL_DESC||PASSNGR_NAME||PNR_LOC||TKT_NUM||AIRLINE;
FARE_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TFARE ELSE 0;
MKT_CNT/D8CS     = IF SRT_DT NE LAST SRT_DT THEN TMKT ELSE 0;

RADV_PURCH/I8CS = IF (EMB_APT_CD EQ 'FP2' OR 'EX1' OR 'RF1' OR 'EX5') THEN 0
  ELSE IF (TKT_TYPE EQ 'P-RF' OR 'P-EX') THEN 0
  ELSE IF (SEG_NBR EQ '00') THEN 0
  ELSE IF (TKT_SORT NE LAST TKT_SORT) AND (FARE_AMT GE 0) THEN NEW_ADV_PURCH
  ELSE IF (TKT_SORT NE LAST TKT_SORT) AND (FARE_AMT LT 0)
  THEN NEW_ADV_PURCH * (-1) ELSE 0;
SAVE_AMT/D10.2CS = IF SRT_DT NE LAST SRT_DT THEN TSAVE ELSE 0;
TK_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TAMT ELSE 0;
XSEG_AMT/D12.2CS = IF SRT_DT NE LAST SRT_DT THEN TSEG ELSE 0;
XTRP_LEN/I5CS = IF SRT_DT NE LAST SRT_DT THEN TRIP_LENGTH * TTKT ELSE 0;

-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*7/31/00     IBISTL-KR             ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERDT
-**************************************************************************
NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
XTS_FLAG/A1 = ' ';

END


 

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRILKW;

-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'AIRHOLD3';
-INCLUDE DRILWHRS

-************************************************************
-SKIP_DRILKW

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN
 

TABLE FILE AIRHOLD3
 
-INCLUDE &&PAHDR
"<COUNTRY_NAME"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPCKW;
"</2"
-NOSPCKW;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHRKW;
-INCLUDE &&DRILLWHR
-SKIP_WHRKW
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
ON COUNTRY_NAME PAGE-BREAK 
&&ONTABLE1
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10

 


-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT 
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN





-GOTO XXIT;

-XXIT;