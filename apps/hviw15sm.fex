-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File HVIEW3SM.FEX


SET ASNAMES=ON
-RUN
-SET &&CTY_LMT = '50';
-SET &&HTL_LMT = '50';
-SET &&RANK_METH = IF &&RANK_METH EQ 'ROOM_AMT' THEN 'ROOM_AMT'
- ELSE IF &&RANK_METH EQ 'NMBR_DAYS' THEN 'NMBR_DAYS' 
- ELSE 'NMBR_DAYS';

TABLE FILE &&RPT_HOLD
SUM BOOKINGS	
    NEW_ROOM_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMS/D8 AS 'NMBR_DAYS'	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'
BY CITY_ST	
BY LEVEL_DESC
ON TABLE HOLD AS HOLD1
END
-RUN


TABLE FILE HOLD1
PRINT 
  BOOKINGS	
  CITY_ST
  LEVEL_DESC
  NEW_ROOM_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  ROOM_AMT/D12.2
BY LEVEL_DESC	
RANKED BY HIGHEST NMBR_DAYS NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN


DEFINE FILE HOLD2
 CTY_LIMIT/I2 = &&CTY_LMT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6=EDIT(FRANKX,'$999999');
  CTY_VALUE/A9 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                 IF RANK GT CTY_LIMIT THEN 'ALL OTHER' ELSE BRANK;
END
-RUN

TABLE FILE HOLD2
PRINT 
  BOOKINGS	
  NEW_ROOM_RATE
  NEW_TOTAL_AMT	
  NMBR_DAYS	
  NNROOMS	
  ROOM_AMT
BY LEVEL_DESC	
BY CTY_VALUE
BY CITY_ST
ON TABLE HOLD AS HOLD3
END
-RUN


DEFINE FILE HOLD3
  CITY/A35 = IF CTY_VALUE LE '&&CTY_LMT' THEN CITY_ST ELSE 'ALL OTHER';
-*   LEVEL/A60 = IF RANK_VALUE LE '&&HTL_LMT' THEN LEVEL_DESC ELSE ' ';
-*   HTL_ADDRESS/A35= IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_ADDRESS ELSE ' ';	
-*   HTL_NAME/A35 = IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_NAME ELSE 'ALL OTHER';	
-************************IBI KR 
-*   PROP_PHONE/A15= IF RANK_VALUE LE '&&HTL_LMT' THEN HOTEL_PHONE ELSE ' ';	
-*   ZIP5/A5 = IF RANK_VALUE LE '&&HTL_LMT' THEN PROP_ZIP5 ELSE ' ';	
END
-RUN

TABLE FILE HOLD3
SUM 
  BOOKINGS	
  NEW_ROOM_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS	
  ROOM_AMT
BY LEVEL_DESC	
BY CTY_VALUE
BY CITY
ON TABLE HOLD AS HOLD4
END
-RUN


DEFINE FILE HOLD4
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);	
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE HOLD4
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-INCLUDE FOOTERSM

ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *
-INCLUDE &&PASTYS
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-*

-* -IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
