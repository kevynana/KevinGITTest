
-INCLUDE SETECHO

SET ASNAMES=ON

-SET &&DATETYPE = 'I';

EX CONCAT_ALL_DBS ROLL=HROM-R,FID=SEG,CLEAR=Y
-RUN





DEFINE FILE SR_50
FLAG/A1 = IF AIR_MAIN.INTL_DOM EQ 'D' THEN 'D' ELSE 'I';
TRN_MY/MY = TRN_DATE;
END
TABLE FILE SR_50
SUM INTL_DOM FLAG

BY TRN_MY
BY BR_CL_IDX
BY INTL_DOM
BY FLAG
END
-RUN
-QUIT

WHERE TRN_DATE GE '2012/08/01' AND TRN_DATE LE '2012/08/31'
END
-RUN
-QUIT








DEFINE FILE SR_50
LEVEL_DESC/A60 = AROLL_LEV1;
IT_ADV_PUR/A8  = IF (ADV_PURCH LT 7) THEN '00-06' ELSE  
                 IF (ADV_PURCH GE 7) AND (ADV_PURCH LT 14) THEN '07-13' ELSE '14+';

-* AIR VOLUME CALCULATION
      AIR_VOL/D12.2 = IF (VOID_DATE EQ 0) THEN (SEG_AMT + SEG_TAX) ELSE 0;

-* NET AMOUNT CALCULATION
      NET_AMT/D12.2 = IF (VOID_DATE EQ 0) THEN SEG_AMT ELSE 0;

-* TICKETS ISSUED CALCULATION
        TKT_ISS/D12.2 = IF (SEG_NBR EQ '01') AND (SEG_AMT+SEG_TAX GE 0)
                        AND (SEG_COUNT EQ 1) THEN 1 ELSE 0;

-* NET TICKETS CALCULATION
        NET_TKTS/D12.2 = IF (TICKET_CODE EQ '1') AND
                            (VOID_DATE EQ 0) AND
                            (SEG_NBR EQ '01') AND
                            (SEG_AMT+SEG_TAX GE 0) AND
                            (SEG_COUNT EQ 1) AND 
                            (CONJ_REL EQ 1) THEN 1 ELSE 
                         IF (TICKET_CODE EQ '1') AND
                            (VOID_DATE EQ 0) AND
                            (SEG_NBR EQ '01') AND 
                            (EX_FLAG EQ 'F') THEN (-1) ELSE 
                         IF (TICKET_CODE EQ '1') AND
                            (VOID_DATE EQ 0) AND
                            (SEG_NBR EQ '01') AND
                            (RF_FLAG EQ 'F') THEN (-1) ELSE 0;

-* FULL REFUNDS ISSUED CALCULATION
        REF_ISS/D12.2 = IF (VOID_DATE EQ 0) AND (RF_FLAG EQ 'F')
-*                         AND (DOC_TYPE NE '1') 
                        AND (SEG_COUNT EQ -1)
                        AND (SEG_NBR EQ '01') THEN 1 ELSE 0;
-* FULL REFUNDS AMOUNT CALCULATION
        REF_AMT/D12.2 = IF (VOID_DATE EQ 0) AND (RF_FLAG EQ 'F')
                        AND (DOC_TYPE NE '1') AND (SEG_COUNT EQ -1)
                        THEN (SEG_AMT+SEG_TAX) ELSE 0;

-* LOST SAVINGS AMOUNT CALCULATION
        LOS_AMT/D12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                        IF (VOID_DATE NE 0) THEN 0 ELSE ((SEG_AMT + SEG_TAX) - SEG_LOWEST);
-* LOST SAVINGS1 AMOUNT CALCULATION
        LOS_AMT1/D12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE 
                         IF (VOID_DATE NE 0) THEN 0 ELSE ((TICKET_AMT + TAX_AMT) - LOWEST_AMT);
-* CONTRACT SAVINGS AMOUNT CALCULATION
        VAS_AMT/D12.2 = IF (VOID_DATE EQ 0) THEN (SEG_DISCOUNT - SEG_AMT - SEG_TAX) ELSE 0;

-* AGENCY DISCOUNT AMOUNT CALCULATION
        VAS_AMT1/D12.2 = IF (VOID_DATE EQ 0) THEN  (SEG_AGENCY_DISC - SEG_AMT - SEG_TAX) ELSE 0;
                       

-* VOIDS ISSUED CALCULATION
        VOD_ISS/D12.2 = IF (VOID_DATE NE 0) AND (SEG_COUNT EQ 1)
                        AND (SEG_NBR EQ '01') THEN 1 ELSE 0;

-* VOIDS ISSUED AMOUNT CALCULATION
        VOD_AMT/D12.2 = IF (VOID_DATE NE 0)
                        THEN (SEG_AMT+SEG_TAX) ELSE 0;

-* FULL EXCHANGES ISSUED CALCULATION
        EXG_ISS/D12.2 = IF (VOID_DATE EQ 0) AND (EX_FLAG EQ 'F') 
                            AND (SEG_COUNT EQ -1) AND (SEG_NBR EQ '01')
                            THEN 1 ELSE 0;
-* FULL EXCHANGES AMOUNT CALCULATION
        EXG_AMT/D12.2 = IF (VOID_DATE EQ 0) AND (EX_FLAG EQ 'F') 
-*                            AND (SEG_COUNT EQ -1) 
                            THEN (SEG_AMT+SEG_TAX) ELSE 0;

TRNM/MT = IF '&&DATETYPE.EVAL' EQ 'I' THEN TRN_DATE ELSE FST_DPT_DATE;
TRNY/A3 = 'YTD';

-* DEFINES ON PREVIOUS DEFINES
DOM_VOL/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'D') THEN AIR_VOL ELSE 0;
DOM_TKTS/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'D') THEN NET_TKTS ELSE 0;
INT_VOL/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'I') THEN AIR_VOL ELSE 0;
INT_TKTS/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'I') THEN NET_TKTS ELSE 0;
ONL_TKTS/D12.2 = IF (DOD_TYPE EQ 'I' OR 'J') THEN NET_TKTS ELSE 0;
DONL_TKTS/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'D') AND (DOD_TYPE EQ 'I' OR 'J') THEN NET_TKTS ELSE 0;
DLOS_AMT/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'D') THEN LOS_AMT ELSE 0;
ILOS_AMT/D12.2 = IF (AIR_MAIN.INTL_DOM EQ 'I') THEN LOS_AMT ELSE 0;
713_TKTS/D12 = IF (IT_ADV_PUR EQ '07-13') THEN NET_TKTS ELSE 0;
14_TKTS/D12 = IF (IT_ADV_PUR EQ '14+') THEN NET_TKTS ELSE 0;
DNONR_TKTS/D12 = IF (NONREF_FLAG EQ 'N') AND (AIR_MAIN.INTL_DOM EQ 'D') THEN NET_TKTS ELSE 0;
-*DLOS_AMTA/D12.2 = IF (DLOS_AMT GE 300) OR (DLOS_AMT LE -300)  THEN DLOS_AMT ELSE 0;
DLOS_AMTA/D12.2 = IF (LOS_AMT1 GE 300) OR (LOS_AMT1 LE -300) THEN LOS_AMT ELSE 0;
ILOS_AMTA/D12.2 = IF (LOS_AMT1 GE 300) OR (LOS_AMT1 LE -300) THEN LOS_AMT ELSE 0;
DLOS_TKTA/D12.2 = IF (LOS_AMT1 GE 300) OR (LOS_AMT1 LE -300) THEN NET_TKTS ELSE 0;
ILOS_TKTA/D12.2 = IF (LOS_AMT1 GE 300) OR (LOS_AMT1 LE -300) THEN NET_TKTS ELSE 0;
DLOS_AMT1/D12.2 = IF AIR_MAIN.INTL_DOM EQ 'D' THEN DLOS_AMTA ELSE 0;
ILOS_AMT1/D12.2 = IF AIR_MAIN.INTL_DOM EQ 'I' THEN ILOS_AMTA ELSE 0;
DLOS_TKT1/D12.2 = IF AIR_MAIN.INTL_DOM EQ 'D' THEN DLOS_TKTA ELSE 0;
ILOS_TKT1/D12.2 = IF AIR_MAIN.INTL_DOM EQ 'I' THEN ILOS_TKTA ELSE 0;               
 
               
END
TABLEF FILE SR_50
PRINT 
  AIR_VOL	
  DOM_TKTS
  DOM_VOL
  DONL_TKTS
  EXG_AMT
  EXG_ISS
  INT_TKTS
  INT_VOL
  NET_AMT
  ONL_TKTS
  TKT_ISS
  SEG_DISCOUNT
  LEVEL_DESC	
  NET_TKTS
  REF_AMT
  REF_ISS
  LOS_AMT	
  TRNM	
  TRNY
  TRN_DATE
  VAS_AMT
  VAS_AMT1
  VOD_AMT
  VOD_ISS
-* ITRON ADDED FIELDS
  DLOS_AMT
  ILOS_AMT
  DLOS_AMT1
  ILOS_AMT1
  DNONR_TKTS
  713_TKTS
  14_TKTS
  DLOS_TKT1
  ILOS_TKT1
WHERE TRN_DATE GE '2012/08/01' AND TRN_DATE LE '2012/08/31'
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
WHERE AROLL_LEV1 EQ 'HROM-R'
-*ON TABLE HOLD AS TSMAHLD
END
-RUN
-QUIT
