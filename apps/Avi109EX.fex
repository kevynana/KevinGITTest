-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* File RNKEXTRT.FEX
-********************************************************************
-*********************************************************************
-*
-* This program extracts data for a drillable frequent flyer report
-* Added defines for ref_tkts and non_tkts JK 9/29/04 
-* ADDED CODE FOR GLOBAL CURRENCY - DV 11/9/04
-* ADDED AA_TKT DL_TKT NW_TKT UA_TKT OTH_TKT DEFINE - DEB 11/17/04
-* ADDED TRP_LEN - DEB 10/25/07
-*03/13/13  CHANGED CLASS_CAT CLASS1 DEFINE DUE TO CLASS CATEGORY CHANGES - DV
-*11/25/13  = ADDED ARR_TIME XARR_DT - DEB
-*1/7/14    UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*7/16/14   UPDATED TO USE FNL_DEST_AIPORT INSTEAD OF DST_APC - JK 
-*12/3/14   ADDED ORG_CNTRY_CODE AND FNL_DEST_CNTY_CODE - JK
-* ADDED TRANTYPE INCLUDE - JK 12/9/14 STORY ID S-06492
-* 05/06/16 DLV - S-18637 - Added new define DST_APC1
-*09/13/2017 - DLV - S-37268 - Updated AT_FLAG and VTYPE defines 
-*                             Added ORG_APCX FNL_DEST_AIRPORTX to be used in JOIN in summary/detail 
 
-********************************************************************
-INCLUDE SETECHO

SET ASNAMES = ON

-SET HOLDATTR = ON;
FI METX_PAX DISK D:\TNT\TTRACKER\TEMP\METX_PAX.TXT

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
-*  CLASS1/A25 = IF CDIR_ALL CONTAINS '*F' THEN 'FIRST' ELSE
-*               IF CDIR_ALL CONTAINS '*B' THEN 'BUSINESS' ELSE
-*               IF CDIR_ALL CONTAINS '*C' THEN 'COACH' ELSE
-*               IF CDIR_ALL CONTAINS '*D' THEN 'DISCOUNTED COACH' ELSE 'OTHER';
  CLASS1/A25 = IF TKT_CL_CAT CONTAINS 'F' THEN 'FIRST' ELSE
               IF TKT_CL_CAT CONTAINS 'U' THEN 'UPGRADE' ELSE
               IF TKT_CL_CAT CONTAINS 'B' THEN 'BUSINESS' ELSE
               IF TKT_CL_CAT CONTAINS 'P' THEN 'PREMIUM ECONOMY' ELSE               
               IF TKT_CL_CAT CONTAINS 'E' THEN 'ECONOMY' ELSE 'DEFAULT';
             
-* CLASS_CAT/A8 = DECODE CL_CAT ('F' 'FIRST'     'C' 'COACH'   
-*                              'D' 'DISCOUNT'  'B' 'BUSINESS'
-*                             ' ' 'OTHER');               
 CLASS_CAT/A15 = DECODE CL_CAT ('F' 'FIRST'     'P' 'PREMIUM ECONOMY'   
			        'D' 'DEFAULT'   'B' 'BUSINESS'
			        'E' 'ECONOMY'   'U'  'UPGRADE' 
                                ' ' 'DEFAULT'); 
  COMM_SEG/D12.2S   = SEG_COM;
  BASE_FARE/D12.2C = SEG_AMT;
  BASE_TAX/D12.2C = SEG_TAX;
  FARE_PAID/D12.2C   = SEG_AMT + SEG_TAX;
  KILO/D9      = CITYPAIR.SEG_MILES * 1.60934 ;  
  LEVEL_DESC/A60      = &&LDESC;
  MRK_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
  NET_COMM/D12.2S     = (SEG_AMT - SEG_COM);
  NET_FARE/D12.2S  = IF (EX_FLAG EQ ' ') AND (RF_FLAG EQ ' ')
                         THEN SEG_AMT ELSE 0;
  NET_TKT_CNT/P8    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  NEW_SEG_LOWEST/D9 = SEG_LOWEST;
  NEW_SEG_MILES/D9 = SEG_MILES;
  NEW_STAY/D9 = STAY;
  NEW_TRIP_LENGTH/D12 = TRIP_LENGTH;
  OTFLAG/A33 = ONLINE_TRADITIONAL;
  REF_EXCH_CNT/D8CS   = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 0 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN 1 ELSE 0;
  SAVINGS/D11.2CS     = SEG_STANDARD - FARE_PAID;  
  TKT_AMOUNT/D12.2CS  = TICKET_AMT + TAX_AMT;
  TKT_PURCH/D8CS      = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 0;
  TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                          (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
  TOTAL_FARE/D12.2S = SEG_AMT + SEG_TAX;
  TRAN_MONTH/MT = TRN_DATE;
  TRP_LEN/D8CS = TRIP_LENGTH * NET_TKT_CNT;
  VMESVINGS/D11.2CS = SEG_DISCOUNT - TOTAL_FARE;
  XPSNGR_NM/A15        = 
  EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  XARR_DT/MDYY         = ARR_DATE;
  XDPT_DT/MDYY         = DPT_DATE;
  XTRAN_DT/MDYY        = TRN_DATE;
  AIRLINE_FEE/D8.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN FARE_PAID ELSE 0;
  AT_FLAG/A1 = EDIT(ND_ORGX, '$$$$$$9'); 
  ORG_APX/A4 = ORG_APC || AT_FLAG;
  DST_APX/A4 = DST_APC || AT_FLAG;    
  
  CTRY1/A2 =  EDIT(CTRY_COD, 
 '99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY2/A2 =  EDIT(CTRY_COD, 
 '$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY3/A2 =  EDIT(CTRY_COD, 
 '$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY4/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY5/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY6/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY7/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY8/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY9/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY10/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY11/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY12/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY13/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY14/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY15/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$$$$');
 CTRY16/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$$$$');
 CTRY17/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$$$$');
 CTRY18/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$$$$');
 CTRY19/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$$$$');
 CTRY20/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$$$$');
 CTRY21/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$$$$');
 CTRY22/A2 =  EDIT(CTRY_COD, 
 '$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99$$$');
 CTRY23/A2 =  EDIT(CTRY_COD, 
'$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$99');

 CH2M_CLCAT/A1 = IF ADIR_ALL CONTAINS '*F' THEN 'F' ELSE IF ADIR_ALL CONTAINS '*B' THEN 'B' ELSE 
               IF ADIR_ALL CONTAINS '*C' THEN 'C' ELSE 'D';
  
  
  CH2M_CAT/A8 = DECODE CH2M_CLCAT ('F' 'FIRST'     'C' 'COACH'   
                              'D' 'DISCOUNT'  'B' 'BUSINESS');   
-* ****DEFINES ON PREVIOUS DEFINES****
  CPMILE/D12.2CS = IF ((SEG_MILES LT 1) AND (SEG_MILES GT (-1))) THEN 0 ELSE
                      (FARE_PAID/SEG_MILES);
  DISSAVINGS/D11.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;
  AIRFEE_CNT/D8CS = IF AIRLINE_FEE GT 0 THEN 1 ELSE 0;
  NON_TKTS/P8CS = IF NONREF_FLAG EQ 'N' THEN NET_TKT_CNT ELSE 0;
  REF_TKTS/P8CS = IF NONREF_FLAG NE 'N' THEN NET_TKT_CNT ELSE 0;
  AA_TKT/P8CS = IF VAL_AIRLINE EQ 'AA' THEN NET_TKT_CNT ELSE 0;
  UA_TKT/P8CS = IF VAL_AIRLINE EQ 'UA' THEN NET_TKT_CNT ELSE 0;
  NW_TKT/P8CS = IF VAL_AIRLINE EQ 'NW' THEN NET_TKT_CNT ELSE 0;
  DL_TKT/P8CS = IF VAL_AIRLINE EQ 'DL' THEN NET_TKT_CNT ELSE 0;
  OTH_TKT/P8CS = IF VAL_AIRLINE NE 'AA' OR 'UA' OR 'NW' OR 'DL' THEN
                  NET_TKT_CNT ELSE 0;
                  
 CTRY_FLAG2/A1 = IF 
   (CTRY2 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY3 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY4 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY5 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY6 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY7 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY8 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR  
   (CTRY9 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY10 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY11 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY12 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY13 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY14 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY15 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY16 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY17 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY18 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY19 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY20 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY21 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY22 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') OR 
   (CTRY23 CONTAINS 'AE' OR 'BH' OR 'EG' OR 'IL' OR 'IQ' OR 'IR' OR 'JO' OR 'KW' OR 
                  'LB' OR 'OM' OR 'PS' OR 'QA' OR 'SA' OR 'SY' OR 'YE') THEN 'Y' ELSE 'N';
                  
                  
  CTRY_FLAG3/A1 = IF 
  (CTRY2 CONTAINS 'RU' ) OR 
  (CTRY3 CONTAINS 'RU') OR
  (CTRY4 CONTAINS 'RU') OR
  (CTRY5 CONTAINS 'RU') OR
  (CTRY6 CONTAINS 'RU') OR
  (CTRY7 CONTAINS 'RU') OR
  (CTRY8 CONTAINS 'RU') OR 
  (CTRY9 CONTAINS 'RU') OR
  (CTRY10 CONTAINS 'RU') OR
  (CTRY11 CONTAINS 'RU') OR
  (CTRY12 CONTAINS 'RU') OR
  (CTRY13 CONTAINS 'RU') OR
  (CTRY14 CONTAINS 'RU') OR
  (CTRY15 CONTAINS 'RU') OR
  (CTRY16 CONTAINS 'RU') OR 
  (CTRY17 CONTAINS 'RU') OR
  (CTRY18 CONTAINS 'RU') OR
  (CTRY19 CONTAINS 'RU') OR
  (CTRY20 CONTAINS 'RU') OR
  (CTRY21 CONTAINS 'RU') OR
  (CTRY22 CONTAINS 'RU') OR
  (CTRY23 CONTAINS 'RU') THEN 'Y' ELSE 'N';
 NEW_STAY/D9 = STAY;
 
 MXTIERO/A1 = IF (ORG_APC EQ 'BDL' OR 'EWR' OR 'LGA' OR 'JFK' OR 'SNA' OR 'LAX' OR 'DFW' OR 'DAL' OR 'ORD' OR 'MDW' OR
                        'TPA' OR 'SFO' OR 'OAK' OR 'DEN' OR 'PHX' OR 'STL' OR 'ICT' OR 'DAY' OR 'ATL') THEN 'Y' ELSE 'N';

 MXTIERD/A1 = IF (DST_APC EQ 'BDL' OR 'EWR' OR 'LGA' OR 'JFK' OR 'SNA' OR 'LAX' OR 'DFW' OR 'DAL' OR 'ORD' OR 'MDW' OR
                   'TPA' OR 'SFO' OR 'OAK' OR 'DEN' OR 'PHX' OR 'STL' OR 'ICT' OR 'DAY' OR 'ATL')  THEN 'Y' ELSE 'N';                       
 
 MXTIER/A1 = IF (ORG_APC EQ 'BDL' OR 'EWR' OR 'LGA' OR 'JFK' OR 'SNA' OR 'LAX' OR 'DFW' OR 'DAL' OR 'ORD' OR 'MDW' OR
                        'TPA' OR 'SFO' OR 'OAK' OR 'DEN' OR 'PHX' OR 'STL' OR 'ICT' OR 'DAY' OR 'ATL') OR
                (DST_APC EQ 'BDL' OR 'EWR' OR 'LGA' OR 'JFK' OR 'SNA' OR 'LAX' OR 'DFW' OR 'DAL' OR 'ORD' OR 'MDW' OR
                        'TPA' OR 'SFO' OR 'OAK' OR 'DEN' OR 'PHX' OR 'STL' OR 'ICT' OR 'DAY' OR 'ATL')  THEN 'Y' ELSE 'N'; 
VTYPE/A1 = EDIT(DST_APCX, '$$$$$$9');
FNL_APX/A4 = FNL_DEST_AIRPORT || VTYPE;


-INCLUDE TRANTYPE                        
                
                  
END
-RUN

TABLEF FILE &&EXTRACT
PRINT   AIR_KEY
        AIRLINE
        AIRLINE_FEE
        AIR_MAIN.INTL_DOM
        AROLL_DSC4
        ARR_TIME
        BASE_FARE
        BASE_TAX
        CH2M_CAT
        CITYPAIR.EMBARK      AS 'EMB_APT_CD'	
        CITYPAIR.ROUTE       AS 'RTE_APT_CD'	
        CLASS
        CLASS1
        CLASS_CAT
        EMB_CTY.COUNTRY_CODE AS 'EMB_CNTRY_CODE'
        CPMILE	
        DISSAVINGS
        DPT_TIME
        FNL_DEST_AIRPORT AS 'DST_APC'
        FNL_APX AS 'DST_APC1'
        EMB_APT.AIRPORT_NAME AS 'EMB_APT_NM'	
        EMB_CTY.CITY_NAME    AS 'EMB_CTY_NM'
        FARE_BAS		
        FARE_PAID           
        FNL_DEST_AIRPORTX
        FNL_DEST_CNTY_CODE
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        MXTIERO
        MXTIERD
        NET_TKT_CNT         	
        NEW_SEG_MILES
        NEW_STAY
        ORG_APC
        ORG_APCX
        ORG_APX
        ORG_CNTRY_CODE
        OTFLAG
        OTH_TKT
        PASSNGR_NAME
        REFUSE_CODE
        REF_TKTS
        RTE_APT.AIRPORT_NAME AS 'RTE_APT_NM'
        RTE_CTY.CITY_NAME    AS 'RTE_CTY_NM'	
        SAVINGS	
        SEG_NBR	
        TKT_AMOUNT
        TKT_DATE	
        TKT_NUM	
        TKT_SORT
        TKT_TYPE	
        TRN_DATE 
        TRP_LEN
        XARR_DT
        XDPT_DT	
        XPSNGR_NM	
        XTRAN_DT
        
         

-INCLUDE &AIRDATES

-*WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS GCTOPTVL 

END
-RUN

TABLE FILE GCTOPTVL
PRINT AIR_KEY
        AIRLINE
        AIRLINE_FEE
        AROLL_DSC4
        ARR_TIME
        BASE_FARE
        BASE_TAX
        CH2M_CAT
        INTL_DOM	
        EMB_APT_CD	
        RTE_APT_CD	
        CLASS
        CLASS1
        CLASS_CAT
        EMB_CNTRY_CODE
        CPMILE	
        DISSAVINGS
        DPT_TIME
        DST_APC
        DST_APC1
        EMB_APT_NM	
        EMB_CTY_NM
        FARE_BAS		
        FARE_PAID
        FNL_DEST_AIRPORTX
        FNL_DEST_CNTY_CODE
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        MXTIERO
        MXTIERD
        NET_TKT_CNT         	
        NEW_SEG_MILES
        NEW_STAY
        ORG_APC
        ORG_APCX
        ORG_APX
        ORG_CNTRY_CODE
        OTFLAG
        OTH_TKT
        PASSNGR_NAME
        REFUSE_CODE
        REF_TKTS
        RTE_APT_NM
        RTE_CTY_NM	
        SAVINGS	
        SEG_NBR	
        TKT_AMOUNT
        TKT_NUM	
        TKT_SORT
        TKT_TYPE	
        TRN_DATE 
        TRP_LEN
        XARR_DT
        XDPT_DT	
        XPSNGR_NM	
        XTRAN_DT         
BY TKT_DATE 
ON TABLE HOLD AS TOPTRVL FORMAT FOCUS INDEX TKT_DATE
END
-RUN

-* Global Reporting JOIN
JOIN TOPTRVL.TKT_DATE IN TOPTRVL TO GLOBAL.DATE IN GLOBAL AS J1


DEFINE FILE TOPTRVL
NAMEC/A30 = CNAME;

-******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;

-* DEFINES ON PREVIOUS DEFINES
PAID_FAREX/D20.6 = FARE_PAID * CURR1X;

-* DEFINES ON PREVIOUSLY DEFINES DEFINES

PAID_FARE1/D20.6C = PAID_FAREX;
END
-RUN



TABLE FILE TOPTRVL
PRINT AIR_KEY
        AIRLINE
        AIRLINE_FEE
        ARR_TIME
        AROLL_DSC4
        BASE_FARE
        BASE_TAX
        CH2M_CAT
        INTL_DOM	
        EMB_APT_CD	
        RTE_APT_CD	
        CLASS
        CLASS1
        CLASS_CAT
        EMB_CNTRY_CODE
        CPMILE	
        DISSAVINGS
        DPT_TIME
        DST_APC
        DST_APC1
        EMB_APT_NM	
        EMB_CTY_NM
        FARE_BAS		
        FARE_PAID
        FNL_DEST_CNTY_CODE
        FNL_DEST_AIRPORTX
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        MXTIERO
        MXTIERD
        NET_TKT_CNT         	
        NEW_SEG_MILES
        NEW_STAY
        ORG_APC
        ORG_APCX
        ORG_APX
        ORG_CNTRY_CODE
        OTFLAG
        OTH_TKT
        PASSNGR_NAME
        REFUSE_CODE
        REF_TKTS
        RTE_APT_NM
        RTE_CTY_NM	
        SAVINGS	
        SEG_NBR	
        TKT_AMOUNT 
        TKT_NUM	
        TKT_SORT
        TKT_TYPE	
        TRN_DATE  
        TRP_LEN
        XDPT_DT	
        XPSNGR_NM
        XARR_DT
        XTRAN_DT         
        PAID_FAREX
        PAID_FARE1
        NAMEC
BY DST_APC1       
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS TOPDST FORMAT FOCUS INDEX DST_APC1
END
-RUN

 



-*-EXIT


 

