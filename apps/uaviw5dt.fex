-* changed code of AB14DRSN to extract udid data in UD14DDT
-* due to report taking too long to process - Deb 8/19/13
-* 10/8/13 - DEB - CHANGED CODE TO ENABLE ABRBTRSN TO RUN FASTER
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 2/27/15 - DEB S-07681 ADDED AB07DRSN ROUTINE

-* Udid Detail Report


-IF &&SETF.EVAL EQ 'AB14DRSN' OR 'ABRBTRSN' OR 'AB07DRSN' THEN GOTO SkipIt; 
 
-INCLUDE RETUDID
-RUN

-IF &RECORDS EQ 0 THEN GOTO NOREC;

-SkipIt;

SET ASNAMES=ON
-RUN

TABLE FILE &&RPT_HOLD
PRINT   AIR_KEY
        AIRLINE
        AIRLINE_FEE
        AIRFEE_CNT	
        INTL_DOM	
        AR_BRANCH
        BASE_FARE
        BR_CL_IDX        
        CLASS
        CLIENT_NUM	
        COMM_SEG
        EMB_CNTRY_CODE
        CPMILE	
        DISSAVINGS
        DPT_TIME
        EMB_APT_CD
        EMB_APT_NM	
        EMB_CTY_NM
        EX_RF_FLAG
        EXCHGS
        F_EXCH_CNT
        FARE_BAS		
        FARE_PAID
        IFLAG
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        NET_COMM	
        NET_FARE	
        NET_TKT_CNT
        NEW_ADV_PURCH
        NEW_SEG_LOWEST
        NEW_SEG_MILES
        NEW_STAY
        NEW_TRIP_LENGTH
        PASSNGR_NAME
        REF_EXCH_CNT
        REF_EXCH_CNT2
        REFUSAL_DESC
        REFUSE_CODE
        RTE_APT_CD
        RTE_APT_NM
        RTE_CTY_NM	
        SAVINGS	
        SEG_AMT	
        SEG_COUNT	
        SEG_DISCOUNT	
        SEG_LOWEST
        SEG_STANDARD	
        SEG_TAX	
        STAY
        TICKET_BRANCH	
        TKT_AMOUNT	
        TKT_NUM	
        TKT_PURCH
        TKT_TYPE	
        TOTAL_FARE	
        VAL_AIRLINE	
        VASAVINGS
        XDPT_DT	
        XTRAN_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD AS HOLDONE
END
-RUN


TABLE FILE &&RPT_HOLD
SUM DISSAVINGS AS 'DTSAVE'
    FARE_PAID AS 'TFARE'
    NEW_SEG_MILES AS 'TMILE'
    NET_TKT_CNT AS 'TTKT'
    SEG_LOWEST AS 'TLOW'
    SEG_AMT AS 'TBASE'
    REF_EXCH_CNT AS 'TREX'
    NEW_ADV_PURCH AS 'TADV'
    BASE_FARE/D12.CS AS 'TBASE'
    SAVINGS/D12.2CS AS 'TSVGS'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
ON TABLE HOLD AS AIRHOLD1
END
-RUN

MATCH FILE HOLDONE
PRINT   AIR_KEY
        AIRLINE
        AIRLINE_FEE
        AIRFEE_CNT	
        INTL_DOM	
        AR_BRANCH
        BASE_FARE
        BR_CL_IDX        
        CLASS
        CLIENT_NUM	
        COMM_SEG
        EMB_CNTRY_CODE
        CPMILE	
        DISSAVINGS
        DPT_TIME
        EMB_APT_CD
        EMB_APT_NM	
        EMB_CTY_NM
        EX_RF_FLAG
        EXCHGS
        F_EXCH_CNT
        FARE_BAS		
        FARE_PAID
        IFLAG
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        NET_COMM	
        NET_FARE	
        NET_TKT_CNT
        NEW_ADV_PURCH
        NEW_SEG_LOWEST
        NEW_SEG_MILES
        NEW_STAY
        NEW_TRIP_LENGTH
        PASSNGR_NAME
        REF_EXCH_CNT
        REF_EXCH_CNT2
        REFUSAL_DESC
        REFUSE_CODE
        RTE_APT_CD
        RTE_APT_NM
        RTE_CTY_NM	
        SAVINGS	
        SEG_AMT	
        SEG_COUNT	
        SEG_DISCOUNT	
        SEG_LOWEST
        SEG_STANDARD	
        SEG_TAX	
        STAY
        TICKET_BRANCH	
        TKT_AMOUNT	
        TKT_NUM	
        TKT_PURCH
        TKT_TYPE	
        TOTAL_FARE	
        VAL_AIRLINE	
        VASAVINGS
        XDPT_DT	
        XTRAN_DT
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
BY SEG_NBR
ON TABLE HOLD
RUN
FILE AIRHOLD1
PRINT DTSAVE
      TFARE
      TLOW
      TMILE
      TTKT
      TBASE
      TREX
      TADV
      TSVGS
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE
AFTER MATCH HOLD AS AIRHOLD2 OLD-OR-NEW
END
-RUN

TABLE FILE AIRHOLD2
PRINT   AIR_KEY
        AIRLINE
        AIRLINE_FEE
        AIRFEE_CNT	
        INTL_DOM	
        AR_BRANCH
        BASE_FARE
        BR_CL_IDX        
        CLASS
        CLIENT_NUM	
        COMM_SEG
        EMB_CNTRY_CODE
        CPMILE	
        DISSAVINGS
        DPT_TIME
        EMB_APT_CD
        EMB_APT_NM	
        EMB_CTY_NM
        EX_RF_FLAG
        EXCHGS
        F_EXCH_CNT
        FARE_BAS		
        FARE_PAID
        IFLAG
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        NET_COMM	
        NET_FARE	
        NET_TKT_CNT
        NEW_ADV_PURCH
        NEW_SEG_LOWEST
        NEW_SEG_MILES
        NEW_STAY
        NEW_TRIP_LENGTH
        PASSNGR_NAME
        REF_EXCH_CNT
        REF_EXCH_CNT2
        REFUSAL_DESC
        REFUSE_CODE
        RTE_APT_CD
        RTE_APT_NM
        RTE_CTY_NM	
        SAVINGS	
        SEG_AMT	
        SEG_COUNT	
        SEG_DISCOUNT	
        SEG_LOWEST
        SEG_STANDARD	
        SEG_TAX	
        STAY
        TICKET_BRANCH	
        TKT_AMOUNT	
        TKT_NUM	
        TKT_PURCH
        TKT_TYPE	
        TOTAL_FARE	
        VAL_AIRLINE	
        VASAVINGS
        XDPT_DT	
        XTRAN_DT
        LEVEL_DESC
        XPSNGR_NM
        TKT_SORT
        TRN_DATE
        SEG_NBR
        DTSAVE
        TFARE
        TBASE
        TLOW
        TMILE
        TTKT
        TREX
        TADV
        TSVGS
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD3 FORMAT FOCUS INDEX AIR_KEY
END
-RUN


-IF '&&SETF.EVAL' EQ 'ABRBTRSN' OR 'ABRBTDTL' THEN GOTO RBTDT; 
-IF '&&SETF.EVAL' EQ 'PRGNMTG' THEN GOTO GN;
-IF '&&SETF.EVAL' EQ 'AB14DRSN' THEN GOTO 14DAY;
-IF '&&SETF.EVAL' EQ 'AB07DRSN' THEN GOTO 07DAY ELSE GOTO Next;


-RBTDT

EX UDRBTDT
-RUN

-IF &&NORECRBT EQ 'Y' THEN GOTO XXIT;


-GOTO Next;

-14DAY

EX UD14DDT
-RUN
-GOTO Next;

-IF &&NOREC14D EQ 'Y' THEN GOTO XXIT;

-GN

EX UDPRGNDT
-RUN

-IF &&NORECGN EQ 'Y' THEN GOTO XXIT;
-GOTO Next;

-07DAY

EX UD07DDT
-RUN

-IF &&NOREC07D EQ 'Y' THEN GOTO NOREC;
-GOTO Next;


-Next;
 
 


DEFINE FILE FINALHLD
-INCLUDE GNDEFINE
NTKT_CNT/D9S= IF SRT_DT NE LAST SRT_DT THEN NET_TKT_CNT ELSE 0;
NOWTOD/A8 WITH TKT_SORT = HHMMSS (NOWTOD);
-IF '&&SETF.EVAL' NE 'ABRBTRSN' OR 'ABRBTDTL' THEN GOTO SKIPdefine;
RBTRSN_CD/A4 = IF TKT_SORT NE LAST TKT_SORT THEN RBTRSN ELSE ' ';
RBT_RSN/A53 = IF TKT_SORT NE LAST TKT_SORT THEN RBTRSN_DSC ELSE ' ';
-SKIPdefine
-IF '&&SETF.EVAL' NE 'AB14DRSN' THEN GOTO SKIPdefine2;
14DRSN_CD/A4 = IF TKT_SORT NE LAST TKT_SORT THEN 14DY_RSN ELSE ' ';
14D_RSN/A53 = IF TKT_SORT NE LAST TKT_SORT THEN 14D_RSN_DSC ELSE ' ';
-SKIPdefine2
-IF '&&SETF.EVAL' NE 'AB07DRSN' THEN GOTO SKIPdefine3;
07DRSN_CD/A4 = IF TKT_SORT NE LAST TKT_SORT THEN 07DY_RSN ELSE ' ';
07D_RSN/A53 = IF TKT_SORT NE LAST TKT_SORT THEN 07D_RSN_DSC ELSE ' ';
-SKIPdefine3
 
END
-IF '&&SETF.EVAL' NE 'ABRBTRSN' OR 'ABRBTDTL' THEN GOTO NotThis;

-SET &&BREAKOPTION =  'ON LEVEL_DESC RECOMPUTE AS ''TOTAL FOR'' ';

-NotThis

-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_DRIL;
-************************************************************
-* INCLUDE PROGRAM TO GEN WHERE STATEMENTS
-************************************************************
-SET &&DRILLRPT = 'FINALHLD';
-INCLUDE DRILWHRS
-SKIP_DRIL
-************************************************************
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADAIR' ELSE 'HDREXLS'; 
-SET &&PASTYD = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'DTEXL' ELSE &&DTSTY;
-RUN

TABLE FILE FINALHLD
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
-**********************************************************************
-* Print statement with fields passed from the user profile database
-**********************************************************************
-*
&&PRINT1
&&PRINT2
&&PRINT3
&&PRINT4
&&PRINT5
&&PRINT6
&&PRINT7
&&PRINT8
&&PRINT9
&&PRINT10
-*
-**********************************************************************
-* By statements (one per field)
-**********************************************************************
-*
&&BY1
&&BY2
&&BY3
&&BY4
&&BY5
&&BY6
&&BY7
&&BY8
&&BY9
&&BY10
-*
-*********************************************************************
-*DATE           NAME               DESCRIPTION 
-*8/18/00      IBISTL-KR            INCLUDE WHERE STATEMENTS WHEN
-*                                  DRILLED_RUN EQ 'Y'.
-*********************************************************************
-*
-**********************************************************************
-* Where statements for Drilled Report
-**********************************************************************
-*
-IF &&DRILLED_RUN EQ 'N' GOTO SKIP_WHR;
-INCLUDE &&DRILLWHR
-SKIP_WHR
-*
-**********************************************************************
-* On Table statements for code appropriate to On Table commands
-**********************************************************************
-*
&&BREAKOPTION
&&ONTABLE1 
&&ONTABLE2
&&ONTABLE3
&&ONTABLE4
&&ONTABLE5
&&ONTABLE6
&&ONTABLE7
&&ONTABLE8
&&ONTABLE9
&&ONTABLE10
 




-*
-**********************************************************************
-* Report specific footer(s)
-**********************************************************************
-*
-INCLUDE FOOTERDT
-*
-*ON TABLE SET STYLE &&DTSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**************************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYD
ENDSTYLE
-*
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-GOTO XXIT

-NOREC
-* -SET &&RPTSUF = 'MSG';
-* -INCLUDE FDEFRPTS
-* -RUN
JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
DEFINE FILE BRPTINST
EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADAIR
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN

-XXIT
