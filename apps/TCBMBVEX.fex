-***************************************************************************
-* REPORT NAME: BENMARKING ANALYSIS (AIR EXTRACT)
-* TOTAL COMPANY REPORTING
-*2/22/05        JK                 ADDED TNT_COMPANY WHERE STATEMENT
-***************************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON



-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED IN STEP3
-*========================================================================
DEFINE FILE SR_50
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE 
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';   
  FARE_PAID/D12 = SEG_AMT + SEG_TAX;
  NET_TKT_CNT/P8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                      IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                      IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
LOST_SAV/D12  =  IF EMBARK EQ 'DT1' THEN 0 ELSE
                    FARE_PAID - SEG_LOWEST;                           

ROLL1/A8 = '&&ROLL.EVAL';
  

END
-RUN

-IF &&SETF EQ 'TCBNMCCA' GOTO CCA


TABLEF FILE SR_50
PRINT AIR_MAIN.INTL_DOM AS 'INTL_DOM'
  CGADV
  CITYPAIR.INTL_DOM AS 'ITDOM'
  DOD_TYPE
  FARE_PAID
  LOST_SAV
  NET_TKT_CNT
  SEG_COUNT
  SEG_NBR 	
  TKT_NUM
  TRN_DATE
  VOID_DATE 	
  VOID_STATUS 	

WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-* WHERE ROLL1 EQ 'BLV-R'
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCBNM_BV
END

-* -IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*                <---------------- STEP5 ---------------->
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TCAREV       
-*========================================================================
DEFINE FILE TCBNM_BV
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCBNM_BV
PRINT
  CGADV
  DOD_TYPE
  FARE_PAID
  INTL_DOM
  ITDOM
  LOST_SAV
  NET_TKT_CNT
  TRN_DATE
  VOID_DATE 	
  VOID_STATUS 	
BY ROLLCD
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS HOLD2
END
-RUN

DEFINE FILE HOLD2
  NMB/I5 = NMB + 1;  
END
TABLE FILE HOLD2
PRINT CGADV
  DOD_TYPE
  FARE_PAID
  INTL_DOM
  ITDOM
  LOST_SAV
  NET_TKT_CNT	
  TRN_DATE
  VOID_DATE 	
  VOID_STATUS 	
BY ROLLCD
BY NMB
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS TCBV1
END
-RUN

MODIFY FILE TCBMBV
FIXFORM FROM TCBV1
DATA ON TCBV1
END
-RUN

-GOTO XXITTA;

-CCA

TABLEF FILE SR_50
PRINT AIR_MAIN.INTL_DOM AS 'INTL_DOM'
  CGADV
  CITYPAIR.INTL_DOM AS 'ITDOM'
  DOD_TYPE
  FARE_PAID
  LOST_SAV
  NET_TKT_CNT
  SEG_COUNT
  SEG_NBR 	
  TKT_NUM
  TRN_DATE
  VOID_DATE 	
  VOID_STATUS 	

WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCBNM_BV
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*                <---------------- STEP5 ---------------->
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TCAREV       
-*========================================================================
DEFINE FILE TCBNM_BV
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCBNM_BV
PRINT
  CGADV
  DOD_TYPE
  FARE_PAID
  INTL_DOM
  ITDOM
  LOST_SAV
  NET_TKT_CNT
  TRN_DATE
  VOID_DATE 	
  VOID_STATUS 	
BY ROLLCD
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS HOLD2
END
-RUN

DEFINE FILE HOLD2
  NMB/I5 = NMB + 1;  
END
TABLE FILE HOLD2
PRINT CGADV
  DOD_TYPE
  FARE_PAID
  INTL_DOM
  ITDOM
  LOST_SAV
  NET_TKT_CNT	
  TRN_DATE
  VOID_DATE 	
  VOID_STATUS 	
BY ROLLCD
BY NMB
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS TCBV1
END
-RUN

MODIFY FILE TCBMBV
FIXFORM FROM TCBV1
DATA ON TCBV1
END
-RUN




-NEXTONE

-XXITTA;

