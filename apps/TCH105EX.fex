-* JK added code to select only tnt_company eq 1 or 2 2/21/05
-INCLUDE SETECHO
SET ASNAMES = ON
-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED IN STEP3
-*========================================================================
-SET &&EXTRACT = 'HR_50';

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';


DEFINE FILE &&EXTRACT
  INTL_DOM/A1 =IF (CITY.INTL_DOM EQ 'I') THEN 'I' ELSE 'D';

  BOOKINGS/D8 = IF TOTAL_AMT GE 0 THEN 1 ELSE 0;
  NBR_ROOMS/D12 =  NUM_ROOMS; 
  NBR_DAYS/D12 = NUM_DAYS;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  
  DBOOKINGS/D8 = IF INTL_DOM EQ 'D' THEN BOOKINGS ELSE 0;
  DNBR_ROOMS/D12 = IF INTL_DOM EQ 'D' THEN NBR_ROOMS ELSE 0;
  DNNROOMS/D12 = IF INTL_DOM EQ 'D' THEN NNROOMS ELSE 0;
  DAMT/D14.2CSM = IF INTL_DOM EQ 'D' THEN NEW_TOTAL_AMT ELSE 0;
  
  IBOOKINGS/D8 = IF INTL_DOM EQ 'I' THEN BOOKINGS ELSE 0;
  INBR_ROOMS/D12 = IF INTL_DOM EQ 'I' THEN NBR_ROOMS ELSE 0;
  INNROOMS/D12 = IF INTL_DOM EQ 'I' THEN NNROOMS ELSE 0;
  IAMT/D14.2CSM = IF INTL_DOM EQ 'I' THEN NEW_TOTAL_AMT ELSE 0;
END

TABLEF FILE &&EXTRACT
PRINT DBOOKINGS
  DNBR_ROOMS
  DNNROOMS	
  DAMT 
  IBOOKINGS
  INBR_ROOMS
  INNROOMS	
  IAMT 	 
 -INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCHHLD
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TCTHTL       
-*========================================================================
DEFINE FILE TCHHLD
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCHHLD
SUM DBOOKINGS
  DNBR_ROOMS
  DNNROOMS	
  DAMT 
  IBOOKINGS
  INBR_ROOMS
  INNROOMS	
  IAMT 	 
BY ROLLCD
ON TABLE HOLD AS TCHHLD1 
END
-RUN

DEFINE FILE TCHHLD1
NMB/I5    = NMB + 1;
END
TABLE FILE TCHHLD1
SUM DBOOKINGS
  DNBR_ROOMS
  DNNROOMS	
  DAMT 
  IBOOKINGS
  INBR_ROOMS
  INNROOMS	
  IAMT 	  
BY ROLLCD
BY NMB
ON TABLE HOLD AS TCHHLD2
END
-RUN

MODIFY FILE TCHTRN
FIXFORM FROM TCHHLD2
DATA ON TCHHLD2
END
-RUN




-NEXTONE
