
-INCLUDE SETECHO
SET ASNAMES = ON


EX CONCAT_ALL_DBS ROLL=PIPE-R,FID=SEG,CLEAR=Y
-RUN











DEFINE FILE SR_50
FARE/D12.2 = SEG_AMT + SEG_TAX;
ADD_COLLECT/D12.2CS = EXCH_NET_FARE + EXCH_NET_TAX;
  AIRLINE_FEE/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN FARE ELSE 0;
LEVEL_DESC/A60 = AROLL_DSC3;
  FARE_PAID2/D12.2CS = TICKET_AMT + TAX_AMT;
  ORG_SALE/D12.2CS    = PARENT_FARE + PARENT_TAX;


END
TABLE FILE SR_50
SUM TKT_NUM PASSNGR_NAME DOC_NUMBER EMBARK ROUTE TRN_DATE AROLL_LEV1 AROLL_LEV2 AROLL_LEV3 AROLL_LEV4 AROLL_LEV5
FARE  ADD_COLLECT FARE_PAID2   EXCH_NET_FARE EXCH_NET_TAX EX_FLAG AIRLINE_FEE  EXCHG_SALE
ORG_SALE
BY LEVEL_DESC  
BY TKT_NUM NOPRINT
BY DOC_NUMBER NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TRN_DATE NOPRINT
BY AROLL_LEV1 NOPRINT
BY AROLL_LEV2 NOPRINT
BY AROLL_LEV3 NOPRINT
BY AROLL_LEV4 NOPRINT
BY AROLL_LEV5 NOPRINT
IF TKT_NUM CONTAINS '9005298400' OR 9004310751 OR 9004441750 OR 9004526133 OR 9005231987
END
-RUN
-QUIT

-*IF TKT_NUM CONTAINS 7732998064 OR 7915877246 OR 7916825870 OR 7917725853
-*WHERE AROLL_LEV2 EQ 'PIPEB'
-*WHERE AROLL_LEV3 EQ 'FXD INC SVC'

WHERE TRN_DATE GE '2017/01/01' AND TRN_DATE LE '2017/03/31'
END
-RUN
-QUIT

ON TABLE HOLD AS AIRHOLD1
END
-RUN
EXCH_AMT/D12.2CS = IF (TKT_NUM NE LAST TKT_NUM) AND (EX_FLAG EQ ' ') THEN EXCH_NET_FARE ELSE 0;
OP_COST/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN EXCH_NET_FARE - AIRLINE_FEE ELSE 0;
  ORG_SALE/D12.2CS    = PARENT_FARE + PARENT_TAX; 
DEFINE FILE AIRHOLD1
FLAG/A1 = IF PENALTY_AMT EQ 0 THEN 'N' ELSE 'Y';
END
TABLE FILE AIRHOLD1
SUM PENALTY_AMT      
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
ON LEVEL_DESC SUMMARIZE AS 'TOTAL FOR'
 
WHERE FLAG EQ 'Y'
ON TABLE COLUMN-TOTAL
END
-RUN
-QUIT



DEFINE FILE SR_50
FARE_PAID/D12.2CS = SEG_AMT + SEG_TAX;
ADDCOLLECT/D12.2CS = EXCH_NET_FARE + EXCH_NET_TAX;
  AIRLINE_FEE/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN FARE_PAID ELSE 0;
END

TABLE FILE SR_50
SUM TKT_NUM PASSNGR_NAME DOC_NUM TRN_DATE AROLL_LEV1 AROLL_LEV2 AROLL_LEV3 AROLL_LEV4 AROLL_LEV5 FARE_PAID ADDCOLLECT AIRLINE_FEE
BY TKT_NUM NOPRINT
BY TRN_DATE NOPRINT
BY PASSNGR_NAME NOPRINT
WHERE TRN_DATE GE '2017/01/01' AND TRN_DATE LE '2017/03/31'
IF TKT_NUM CONTAINS 7732998064 OR 7915877246 OR 7915877246 OR 7916825870 OR 7917725853
ON TABLE COLUMN-TOTAL
END
-RUN
-QUIT