-*getRIParmClients.fex
-* 03/05/2014 LS - added staple-r and ameres-r for gloable data requested by Deb
-* 03/06/2014 LS - removed staple-r and ameres-r from gloable data requested by Deb
-* 05/20/2014 LS - added CIT-R into global group.
-* 05/21/14 LS added MANI-R SKECH-R GLOFO-R CSPORT-R into global group
-* 07/07/2014 LS Added CH2M-R into global group
-* 09/15/2014 LS Added UTC-R into global group
-* 09/18/2014  LS added PHYSCO-R and CURT-R to global group
-* 09/25/2014 LS setup all global accounts to include global data in Global Reports.
-* 07/27/15 - DEB - S-10299 COMMENTED OUT SET &ECHO=ALL

-*-SET &ECHO=ALL;
-SET &SPC='&' | 'nbsp;';
-DEFAULT &nbr = 0;
-DEFAULT &1 = 'ABCD-R';
-DEFAULT &2 = 'Y';


TABLE FILE GLOBALEXCL
PRINT *
WHERE ROLLUP_CODE EQ '&1.EVAL'
ON TABLE HOLD
END
-RUN

-SET &GetGlobal = IF &LINES EQ 0 THEN 'Y' ELSE IF &LINES NE 0 AND '&2.EVAL' EQ 'Y' THEN 'Y' ELSE 'N';
 
DEFINE FILE CLIENT
CNT/I5 = CNT + 1;
IMD/I5 = IMOD(CNT, 2, IMD);
CLIENT_TXT/A50 = CLIENT_NUM || ' - ' | CLIENT_BRNCH || ' - ' | CLIENT_NAME ;
OPTS/A200=IF IMD NE 0 THEN '<option value="' || BR_CL_IDX || '">' || CLIENT_TXT 
  ELSE '<option style="background-color:#dcdcdc;" value="' || BR_CL_IDX || '">' || CLIENT_TXT ;
END

TABLE FILE CLIENT
PRINT OPTS
BY ROLLUP_CODE NOPRINT
WHERE ROLLUP_CODE EQ '&1.EVAL'

-*-IF '&1.EVAL' EQ 'KIEWIT-R' OR '&1.EVAL' EQ 'CERN-R'  OR '&1.EVAL' EQ 'HROM-R' OR '&1.EVAL' EQ 'WOODW-R' OR '&1.EVAL' EQ 'ITRON-R' OR '&1.EVAL' EQ 'UPI-R' OR '&1.EVAL' EQ 'PETS-R' OR '&1.EVAL' EQ 'BLV-R' OR '&1.EVAL' EQ 'BING-R' OR '&1.EVAL' EQ 'CIT-R' OR '&1.EVAL' EQ 'MANI-R' OR '&1.EVAL' EQ 'SKECH-R' OR '&1.EVAL' EQ 'GLOFO-R' OR '&1.EVAL' EQ 'CSPORT-R' OR '&1.EVAL' EQ 'CH2M-R' OR '&1.EVAL' EQ 'UTC-R' OR '&1.EVAL' EQ 'PHYSCO-R' OR '&1.EVAL' EQ 'CURT-R' 
-*- THEN GOTO INCLGLOBAL;

-IF &GetGlobal EQ 'Y' THEN GOTO INCLGLOBAL; 
WHERE CLIENT.CATEGORY NE 'GLOBAL'
-INCLGLOBAL
ON TABLE SET HOLDLIST PRINTONLY
ON TABLE HOLD AS HLDCLNT
END
-RUN

-HTMLFORM BEGIN
<html>
<head>Select Clients</head>
<body >
<form name="clients">
<table border=0>
<tr>
<td>
<select name="clients" size="5" multiple>
!IBI.FIL.HLDCLNT;
</select>
</td>
</tr>
</table>

<table border="0" width="50%">
  <tr>
    <td width="50%">
        <input type="button" value="Select" name="B1" onclick="moveItems();">
    </td>
    <td width="50%">
        <input type="button" value="Close" name="B2" onclick="closeWindow();">
    </td>
  </tr>
</table>
<font size="3">___________________________________________________________________</font><br>
<font size="2" color="#800000">Enter Exact Code or Partial Name to Search      </font>

<table border="0" width="80%">
<tr>
<td width="40%">Member Code:</td>
<td width="40%"><input type="text" name="MCODE" size="20" maxlength="20"></td>
<td width="20%"><input type="button" value="Find" name="GO" onclick="checkNum();"></td>
</tr>
<tr>
    <td width="40%">Member Name: </td>
    <td width="40%"><input type="text" name="MemName" size="35" maxlength="40">  </td>
    <td width="20%"><input type="button" value="Find" name="GO2" onclick="checkName();"> </td>
  </tr>
</table>


<SCRIPT TYPE='text/javascript' LANGUAGE='JavaScript'>

function moveItems() {
 from=document.clients.clients;
 var len=0;
 var nbr = &nbr;
 
  for (i=0; i<from.options.length;i++) {
     if (from.options[i].selected) { nbr++;
         txt = from.options[i].text;  
         len = window.opener.pasteClient(txt); 
         if (nbr > 24) {alert("You are allowed to select up to 25 clients"); break;}
     }
 }
 window.close();
}

function checkName() {
if ((document.clients.MemName.value == '') || (document.clients.MemName.value == ' ')) {
 alert("Please Enter a Client Member Name");
 return false;
}
unSelectAll();
searchMemberName();
}

function searchMemberName() {
var i;
var val, len, name;
var fund=false;
for (i=0; i < document.clients.clients.length; i++) {
 val = document.clients.clients.options[i].text;

 len = val.indexOf(" - ") + 3;
 name=val.substring(len, val.length).toUpperCase();
 //get all names which contains that search string
 if (name.indexOf(document.clients.MemName.value.toUpperCase()) != -1 ) {
   document.clients.clients.options[i].selected = true;
   fund = true;
 }
}
if (!fund) {
 alert("Client Name Not Found!!");
}
}

function unSelectAll() {
for (i=0; i < document.clients.clients.length; i++) {
	document.clients.clients.options[i].selected = false;
}
}

function checkNum() {
	if ((document.clients.MCODE.value == '') || (document.clients.MCODE.value == ' ')) {
	 alert("Please Enter a Client Code");
	 return false;
	}
	unSelectAll();
	searchMembers();
}

function searchMembers() {
	var i;
	var val, len, mcode;
	var fund=false;
	for (i=0; i < document.clients.clients.length; i++) {
		 val = document.clients.clients.options[i].text;
		 len = val.indexOf(" - ") ;
		 mcode=val.substring(0,len);
		 if (mcode == document.clients.MCODE.value.toUpperCase()) {
		   document.clients.clients.options[i].selected = true;
		   fund=true; break;}
	}
	if (!fund) { alert("Client Code Not Found!!");}
}

function postCode() {
  var wchfld = window.name.toString();
  var sel='', sel2='';

  var first=true;
  var j, k, i=0;
  k = arraySize + 1;
  for (j=1; j<k; j++) {
    if (document.clients.clients.options[j].selected && i<25) {
       opener.pasteClient(document.clients.clients.options[j].text);
      i++;
     }
     else if (i >= 25) {
     	alert ("Only the first 25 items will be selected");
     	j = k;
     }
  }
  //opener.codeVal = sel2;
  //opener.pasteIt(wchfld);
  location.href = '/Asp/Clients.html';
  winClose();
}

function closeWindow() {
  window.close();
}

</script>

</form>
</body>
</html>
-HTMLFORM END
