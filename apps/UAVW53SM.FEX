-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* 08/14/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Added: -SET &FTR_AddlLines = #;
-*
-INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-*
-**********************************************************************

SET ASNAMES = ON
-RUN




-INCLUDE LOHTLSM
-RUN


-INCLUDE RETUDID
-RUN





-QUIT


-SET &&RANK_LIMIT = 300;
-SET &&RANK_METH = HBPCT;


 

DEFINE FILE &&RPT_HOLD
NOHOTEL/P9C = STAY-NNROOMS1;
STAY1/P9C = STAY;
NH_TKT_CNT/D9C = IF STAY1 EQ NOHOTEL THEN NET_TKT_CNT ELSE 0;
H_TKT_CNT/D9C = IF STAY1 NE NOHOTEL THEN NET_TKT_CNT ELSE 0;
-*NH_FLAG/A1 = IF NOHR_KEY EQ ' ' AND NOHOTEL EQ 0 THEN 'Y' ELSE 'N';
END
TABLE FILE &&RPT_HOLD
PRINT AIR_KEY STAY1/P9C NNROOMS1/P9C NOHOTEL NET_TKT_CNT NH_TKT_CNT H_TKT_CNT
BY LEVEL_DESC
BY PASSNGR_NAME
BY TKT_NUM
-*BY RTE_CTY_NM
-*BY NOHR_KEY
-*BY NOHTL_KEY
-*BY DOD_PAX_CAT
-*WHERE NH_FLAG NE 'Y'
-*ON TABLE HOLD AS AIRHOLD1
END
-RUN
-QUIT


TABLE FILE AIRHOLD1
SUM STAY
    NNROOMS1 
    NOHOTEL
    NH_TKT_CNT
    NET_TKT_CNT
    H_TKT_CNT
    
COMPUTE HBPCT/D12.1 =  IF ((NET_TKT_CNT LT 1) AND 
                      (NET_TKT_CNT GT (-1))) THEN 0 ELSE ((H_TKT_CNT/NET_TKT_CNT) * 100); 
BY LEVEL_DESC
BY PASSNGR_NAME
-*WHERE NH_FLAG NE 'Y'
ON TABLE HOLD AS PHOLD
END
-RUN


TABLE FILE PHOLD
PRINT STAY1 NNROOMS1 NOHOTEL NH_TKT_CNT H_TKT_CNT HBPCT NET_TKT_CNT
BY LEVEL_DESC
RANKED BY LOWEST &&RANK_METH
BY PASSNGR_NAME
WHERE NH_TKT_CNT NE 0
ON TABLE HOLD AS RNKHLD2
END
-RUN


DEFINE FILE RNKHLD2
  DRANK/D9 = RANK;
  ARANKX/A11 = FTOA(DRANK, '(D9)', 'A11');
  ARANK/A9 = EDIT(ARANKX,'$$999999999');
  LIST/D9 = (LAST LIST + 1);
  CRANKX/A11 = FTOA(LIST, '(D9)', 'A11');
  CRANK/A9 = EDIT(CRANKX,'$$999999999');
  RANK_VALUE/A9 = IF &&RANK_LIMIT EQ 0 THEN ARANK ELSE 
                  IF LIST GT &&RANK_LIMIT THEN 'ALL OTHER' ELSE 
                  CRANK;
  RANK_VAL/A9 = IF &&RANK_LIMIT EQ 0 THEN ARANK ELSE
                IF RANK GT &&RANK_LIMIT THEN 'ALL OTHER' ELSE
                ARANK;
  RANK_LABEL1/A60 = IF RANK_VALUE NE 'ALL OTHER' THEN &&RANK_LABEL1
                      ELSE ' ';
  RANK_LABEL2/A60 = IF RANK_VALUE NE 'ALL OTHER' THEN &&RANK_LABEL2
                      ELSE ' ';
  RANK_LABEL3/A60 = IF RANK_VALUE NE 'ALL OTHER' THEN &&RANK_LABEL3
                      ELSE ' ';
  NOWTOD/A8 WITH RANK_VALUE = HHMMSS (NOWTOD);
END
-RUN




TABLE FILE RNKHLD2
PRINT STAY1 NNROOMS1 NOHOTEL NH_TKT_CNT  H_TKT_CNT NET_TKT_CNT HBPCT RANK_VALUE RANK_LABEL1 RANK_LABEL2
BY LEVEL_DESC
BY PASSNGR_NAME
ON TABLE HOLD AS DEBTEST
END
-RUN

TABLE FILE AIRHOLD1
PRINT AIR_KEY
BY LEVEL_DESC
BY PASSNGR_NAME
ON TABLE HOLD AS HDRHOLD
END
-RUN

MATCH FILE DEBTEST
PRINT STAY1
      NNROOMS1
      NOHOTEL 
      NH_TKT_CNT  
      H_TKT_CNT 
      NET_TKT_CNT
      HBPCT 
      RANK_VALUE 
      RANK_LABEL1 
      RANK_LABEL2
BY LEVEL_DESC
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE HDRHOLD
PRINT AIR_KEY
BY LEVEL_DESC
BY PASSNGR_NAME
AFTER MATCH HOLD AS HDRTWO OLD 
END
-RUN


TABLE FILE HDRTWO
PRINT STAY1
      NNROOMS1
      NOHOTEL 
      NH_TKT_CNT  
      H_TKT_CNT 
      NET_TKT_CNT
      HBPCT 
      RANK_VALUE 
      RANK_LABEL1 
      RANK_LABEL2
      LEVEL_DESC
      PASSNGR_NAME  
BY AIR_KEY
WHERE RANK_VALUE NE ' '
ON TABLE HOLD AS HDRHOLD2 FORMAT FOCUS INDEX AIR_KEY
END
-RUN




EX UDHDREMP
-RUN

-Finishrpt

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE RNKHLD2
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
-*&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
   

-SET &FTR_AddlLines = 4;
FOOTING BOTTOM
" "
" "
"The report includes only tickets with an"
"overnight stay"
-*
-INCLUDE FOOTERSM
-* 
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
