-*1/30/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*10/16/15 - S-11851 Added logic for ABACHLOD (DOMESTIC ONLY) ABACHLOI (INTERNATIONAL ONLY) - JM
-*12/30/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels


-INCLUDE SETECHO

SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &&IDLEVELBREAK = '';


-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

-INCLUDE IDLEVROLLDEF
-RUN

DEFINE FILE &&EXTRACT
 

FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;

LEVEL_DESC1/A80 = &&LDESC;
NET_TKT_CNT/D12      = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;





-* ****DEFINES ON PREVIOUS DEFINES****
ABOOK_CNT/D8CS = IF ONLINE_TRADITIONAL EQ 'TRADITIONAL' THEN NET_TKT_CNT ELSE 0;
ABOOK_FARE/D12.2CS = IF ONLINE_TRADITIONAL EQ 'TRADITIONAL' THEN FARE_PAID ELSE 0;


IBOOK_CNT/D8CS = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN NET_TKT_CNT ELSE 0;
IBOOK_FARE/D12.2CS = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN FARE_PAID ELSE 0;
           
  
-INCLUDE TRANTYPE  
-INCLUDE IDLEVDEFINE 
            
END
-RUN


TABLEF FILE &&EXTRACT
PRINT
  ABOOK_CNT
  ABOOK_FARE
-*  AIBOOK_CNT
  FARE_PAID
  IBOOK_CNT
  IBOOK_FARE
  LEVEL_DESC	
  NET_TKT_CNT  
 
-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS
-IF '&&SETF.EVAL' EQ 'ABACHLD' GOTO INTD;
-IF '&&SETF.EVAL' EQ 'ABACHLI' GOTO INTI;
-GOTO INTDONE;
-INTD;
WHERE AIR_MAIN.INTL_DOM EQ 'D'
-GOTO INTDONE;
-INTI;
WHERE AIR_MAIN.INTL_DOM EQ 'I'
-GOTO INTDONE;

-INTDONE;
ON TABLE HOLD AS BOOKSUM

END
-RUN


