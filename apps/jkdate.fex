
USE ADD
D:\TNT\TTRACKER\DATA\S9ALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\S0ALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\SYALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\SZALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\S1ALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\S2ALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\S3ALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\S4ALL.FOC AS SR_50
D:\TNT\TTRACKER\DATA\S5ALL.FOC AS SR_50

D:\TNT\TTRACKER\DATA\A9ALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\A0ALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\AYALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\AZALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\A1ALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\A2ALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\A3ALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\A4ALL.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\A5ALL.FOC AS AIR_MAIN

D:\TNT\TTRACKER\DATA\T9ALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\T0ALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\TYALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\TZALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\T1ALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\T2ALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\T3ALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\T4ALL.FOC AS TKT_MAIN
D:\TNT\TTRACKER\DATA\T5ALL.FOC AS TKT_MAIN
END

-GOTO JOY
USE ADD
D:\TNT\TTRACKER\DATA\S_BCBS.FOC AS SR_50
D:\TNT\TTRACKER\DATA\A_BCBS.FOC AS AIR_MAIN
D:\TNT\TTRACKER\DATA\T_BCBS.FOC AS TKT_MAIN
END

CM_NET_TKTS
    CM_FARE_PAID
    PM_NET_TKTS
    PM_FARE_PAID
    CY_NET_TKTS
    CY_FARE_PAID
    PY_NET_TKTS
    PY_FARE_PAID


-JOY



-SET &&FROMDT = '20101201';
-SET &&TODT = '20101231';


DEFINE FILE SR_50
FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;

NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;                              
ORG_DST/A6=ORG_APC||DST_APC;       
-* Current Month
CMFM_DT/YYMD = &&FROMDT;
CMTO_DT/YYMD = &&TODT;

-* Prior Month
CPFM_DT/YYMD = DATEADD(CMFM_DT, 'M', (-12));
CPTO_DTA/YYMD = DATEADD(CMTO_DT, 'M', (-12));
CPTO_DT/YYMD = DATEMOV(CPTO_DTA, 'EOM');

-* Current Year From Date
CYFM_DT/YYMD = DATEADD(CMFM_DT, 'M', (-11));

-* Prior Year From Date & To Date
PYFM_DT/YYMD = DATEADD(CYFM_DT, 'M', (-12));
-* PYTO_DT/YYMD = DATEADD(CPTO_DT, 'M', (-11));

-* Time Period Flags
-* Current Month
CM/A1 = IF TRN_DATE GE CMFM_DT AND TRN_DATE LE CMTO_DT THEN 'Y' ELSE 'N';
PM/A1 = IF TRN_DATE GE CPFM_DT AND TRN_DATE LE CPTO_DT THEN 'Y' ELSE 'N';
CY/A1 = IF TRN_DATE GE CYFM_DT AND TRN_DATE LE CMTO_DT THEN 'Y' ELSE 'N';
PY/A1 = IF TRN_DATE GE PYFM_DT AND TRN_DATE LE CPTO_DT THEN 'Y' ELSE 'N';

-* Time Period Fares/Tickets
CM_NET_TKTS/P12 =    IF CM EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CM_FARE_PAID/D12.2 = IF CM EQ 'Y' THEN FARE_PAID ELSE 0;
PM_NET_TKTS/P12    = IF PM EQ 'Y' THEN NET_TKT_CNT ELSE 0;
PM_FARE_PAID/D12.2 = IF PM EQ 'Y' THEN FARE_PAID ELSE 0;
CY_NET_TKTS/P12 =    IF CY EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CY_FARE_PAID/D12.2 = IF CY EQ 'Y' THEN FARE_PAID ELSE 0;
PY_NET_TKTS/P12    = IF PY EQ 'Y' THEN NET_TKT_CNT ELSE 0;
PY_FARE_PAID/D12.2 = IF PY EQ 'Y' THEN FARE_PAID ELSE 0;

END    
-RUN


TABLE FILE SR_50
SUM PY_NET_TKTS
    PY_FARE_PAID
BY ORG_DST
BY RNDT_FLAG
BY C_ITIN
WHERE TRN_DATE GE PYFM_DT AND TRN_DATE LE CMTO_DT
-* WHERE TRN_DATE GE '20100101' AND TRN_DATE LE '20101231'
WHERE VOID_DATE EQ 0
WHERE AIRLINE NE '2V'
-* WHERE AIR_MAIN.INTL_DOM EQ 'D'
WHERE ORG_DST EQ 'ABECLE'
-* WHERE AROLL_LEV2 EQ 'ALL_CORP'
ON TABLE COLUMN-TOTAL
ON TABLE PCHOLD FORMAT EXL2K
END
-RUN
-QUIT
