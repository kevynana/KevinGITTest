-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-*2/05/01      TANDT-SS             ADD BASE_FARE, DEPT_MONTH, SEG_DESIG 
-*                                  AND TOUR_CODE.
-*12/5/01      TANDT-JK             CARRIED THROUGH INTDOM DECODE
-* 2/13/02     TANDT-JK             CARRIED THROUGH INTEXT, INTCNT, EXTCNT
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*8/26/02    TANDT-JK               CARRIED THROUGH OTCNT
-*12/08/15 - JEM - S-13286 Updated to allow reports to sort/subtotal by id-levels

-**********************************************************************

SET ASNAMES = ON
-RUN

TABLE FILE &&RPT_HOLD

SUM BASE_FARE/D12.CS AS 'TBASE'
    DISSAVINGS/D12.2CS AS 'TLOSS'
    EXT_FARE/D12.2CS AS 'TEXT'
    FARE_PAID/D12.2CS AS 'TFARE'	
    GROSS_DSAVE AS 'GDSAV'	
    GROSS_FARE AS 'GFARE'
    INT_FARE/D12.2CS AS 'TINT'
    NET_TKT_CNT AS 'NTTKT'	
    NET_TKT_CNT1 AS 'NTTKT1'	
    NEW_ADV_PURCH AS 'TADV'	
    NEW_SEG_COUNT/D8CS AS 'TSEG'
    OTH_FARE/D12.2CS AS 'TOTH'
    REF_CNT AS 'TREF'	
    REF_E_CNT AS 'TREX'	
    REF_EXCH_CNT AS 'TRFEX'	
    SALE_CNT AS 'TSAL'
    SAVINGS/D12.2CS AS 'TSVGS'	
    SEG_LOWEST/D12.2CS AS 'TLOW'	
    SEG_STANDARD/D12.2CS AS 'TSTD'	
    TKT_PURCH AS 'TTKT'	
BY LEVEL_DESC
ON TABLE HOLD AS HOLDONE
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT AGENT_NUM
  AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  AUX_NON_MIR
  BASE_FARE	
  BOOK_DT
  BR_CL_IDX	
  CLASS	
  CLASS_CAT	
  CLIENT_NAME
  CLIENT_NUM	
  CREDIT_CARD
  DEPT_MONTH
  DEPT_YEAR	
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DOD_PAX_CAT	
  EXT_FARE
  EXTCNT
  FARE_BAS	
  FARE_PAID
  GEOAREA	
  GROUP_CODE
  GROSS_DSAVE	
  GROSS_FARE	
  INT_CODE
  INT_FARE
  INTCNT
  INTDOM
  INVOICE_NUM
  KBLEVEL1	
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT	
  MTG_NUM
  ND_CITY_NM	
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  OTCNT
  OTH_FARE
  PASSNGR_NAME
  PNR_LOCATOR
  REF_CNT	
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH
  REFUSE_CODE
  REFUSAL_DESC
  SALE_CNT	
  SAVINGS	
  SEG_AMT
  SEG_DESIG	
  SEG_LOWEST
  SEG_STANDARD
  SEG_TAX	
  STAY
  TKT_NUM	
  TKT_PURCH
  TOUR_CODE	
  VAL_AIRLINE	
  XPSNGR_NM	
  XTRAN_DT
BY LEVEL_DESC	
ON TABLE HOLD AS XTWO
END
-RUN

MATCH FILE XTWO
PRINT AGENT_NUM
  AIR_KEY	
  AIRLINE	
  AIRLINE_FEE	
  AIRLINE_NAME	
  AR_BRANCH
  AUX_NON_MIR	
  BASE_FARE
  BOOK_DT
  BR_CL_IDX	
  CLASS	
  CLASS_CAT	
  CLIENT_NAME	
  CLIENT_NUM	
  CREDIT_CARD	
  DEPT_MONTH
  DEPT_YEAR
  DIR_CP_CD	
  DIR_CP_NM	
  DISSAVINGS
  DOD_PAX_CAT	
  EXTCNT
  EXT_FARE
  FARE_BAS	
  FARE_PAID
  GEOAREA	
  GROSS_DSAVE	
  GROSS_FARE	
  GROUP_CODE	
  INT_CODE	
  INTCNT
  INT_FARE
  INTDOM
  INVOICE_NUM
  KBLEVEL1
  LEVEL1	
  LEVEL2	
  LEVEL3	
  MRK_TKT_CNT	
  MTG_NUM
  ND_CITY_NM	
  NET_TKT_CNT	
  NET_TKT_CNT1	
  NEW_ADV_PURCH	
  NEW_SEG_COUNT	
  NEW_SEG_DISC	
  NEW_SEG_MILES	
  NOREF_SEG_COUNT
  OTCNT	
  OTH_FARE
  PASSNGR_NAME
  PNR_LOCATOR
  REF_CNT
  REF_E_CNT	
  REF_EXCH_CNT	
  REFEXCH
  REFUSE_CODE
  REFUSAL_DESC
  SALE_CNT
  SAVINGS	
  SEG_AMT
  SEG_DESIG
  SEG_LOWEST
  SEG_STANDARD	
  SEG_TAX
  STAY
  TKT_NUM	
  TKT_PURCH
  TOUR_CODE	
  VAL_AIRLINE	
  XPSNGR_NM	
  XTRAN_DT	
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDONE
SUM GDSAV
    GFARE
    NTTKT
    NTTKT1
    TADV
    TBASE
    TFARE
    TLOSS
    TLOW
    TREF
    TREX
    TRFEX
    TSAL
    TSEG
    TSTD
    TSVGS
    TTKT
    TEXT
    TINT
    TOTH
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW 
END
-RUN

DEFINE FILE XTHREE
  LSAVPCT/D8.1S=IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0
                ELSE ((TLOSS/TFARE)*100);	
  PCDSAVE/D8.1S=IF ((FARE_PAID LT 1) AND (FARE_PAID GT (-1))) THEN 0
                ELSE (DISSAVINGS/FARE_PAID);	
  PCTDSAVE/D8.1S=IF ((TLOSS LT 1) AND (TLOSS GT (-1))) THEN 0
                 ELSE ((DISSAVINGS/TLOSS)*100);	
  PCTFARE/D8.1S=IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0 
                ELSE ((FARE_PAID/TFARE)*100);	
  PCTNETTKT/D8.1S=IF ((NTTKT LT 1) AND (NTTKT GT (-1))) THEN 0 
                  ELSE ((NET_TKT_CNT/NTTKT)*100);	
  PCTRFEX/D8.1S=IF ((TRFEX LT 1) AND (TRFEX GT (-1))) THEN 0
                ELSE ((REF_EXCH_CNT/TRFEX)*100);	
  PCTSAVE/D8.1S=IF ((TSVGS LT 1) AND (TSVGS GT (-1))) THEN 0
                ELSE ((SAVINGS/TSVGS)*100);	
  PCTTKT/D8.1S=IF ((TTKT LT 1) AND (TTKT GT (-1))) THEN 0
               ELSE ((TKT_PURCH/TTKT)*100);	
  SAVPCT/D8.1S=IF ((TSTD LT 1) AND (TSTD GT (-1))) THEN 0
               ELSE ((TSVGS/TSTD)*100);	
  SAVPCT1/D8.1S=IF ((TFARE LT 1) AND (TFARE GT (-1))) THEN 0
                ELSE ((TSVGS/TFARE)*100);	
  TKTSAV/D12.2CS=IF ((NTTKT LT 1) AND (NTTKT GT (-1))) THEN 0
                 ELSE (TSVGS/NTTKT);


-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
  NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE XTHREE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;

-IF '&&SETF.EVAL' EQ 'MXINEX' THEN GOTO MXinex;

    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4 
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10



-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10

-GOTO FOOT;


-MXinex; 

SUM INTCNT AS 'INT,BKD,TKTS' 
COMPUTE PCTIC/D8.1C=IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE INTCNT/NET_TKT_CNT*100; AS '% OF,INT,TKTS' 
INT_FARE AS 'INT,FARE,PAID' 
COMPUTE PCTIF/D8.1C= IF ((FARE_PAID LT 1) AND (FARE_PAID GT (-1))) THEN 0 ELSE INT_FARE/FARE_PAID*100; AS '% OF,INT,FARE' 

EXTCNT AS 'EXT,BKD,TKTS' 
COMPUTE PCTEC/D8.1C = IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE EXTCNT/NET_TKT_CNT*100; AS '% OF,EXT,TKTS' 
EXT_FARE AS 'EXT,FARE,PAID' 
COMPUTE PCTEF/D8.1C= IF ((FARE_PAID LT 1) AND (FARE_PAID GT (-1))) THEN 0 ELSE EXT_FARE/FARE_PAID*100; AS '% OF,EXT,FARE' 
OTCNT AS 'OTHER,TKTS' 
COMPUTE PCTOT/D8.1C= IF ((NET_TKT_CNT LT 1) AND (NET_TKT_CNT GT (-1))) THEN 0 ELSE OTCNT/NET_TKT_CNT*100; AS ' % OF,OTHER,TKTS' 
OTH_FARE AS 'OTHER,FARE,PAID' 
COMPUTE PCTOF/D8.1C= IF ((FARE_PAID LT 1) AND (FARE_PAID GT (-1))) THEN 0 ELSE OTH_FARE/FARE_PAID*100; AS '% OF,OTH,FARE' 
FARE_PAID AS 'FARE,PAID' 
 

BY LEVEL_DESC AS ' '
ON LEVEL_DESC RECOMPUTE MULTILINES AS 'TOTAL FOR'





-FOOT

-INCLUDE FOOTERSM
ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
