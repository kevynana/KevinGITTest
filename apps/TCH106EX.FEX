-* JK added code to select only tnt_company eq 1 or 2 2/21/05
-INCLUDE SETECHO
SET ASNAMES = ON
-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED IN STEP3
-*========================================================================
-SET &&EXTRACT = 'HR_50';

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';


DEFINE FILE &&EXTRACT
  GROSS_BOOK/D8 = IF TOTAL_AMT GE 0 THEN 1 ELSE 0;

  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  BOOKINGS/D8 = IF NEW_TOTAL_AMT GE 0 THEN 1 ELSE (-1);
  BKGS2/D8 = IF RSVSTA CONTAINS 'O' THEN 1 ELSE (-1);
END

TABLEF FILE &&EXTRACT
PRINT BKGS2 AS 'GROSS_BOOK'
   NEW_TOTAL_AMT 
   BKGS2
 -INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCHOTEL
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACT DATA FROM STEP4 - HOLD TO FOCUS DATABASE TCTHTL       
-*========================================================================
DEFINE FILE TCHOTEL
ROLLCD/A8 = '&&ROLL';
NMB/I5    = NMB + 1;
END
TABLE FILE TCHOTEL
SUM GROSS_BOOK
    NEW_TOTAL_AMT 
BY ROLLCD
BY NMB
ON TABLE HOLD AS TCHTLHLD
END
-RUN

MODIFY FILE TCHTLTRN
FIXFORM FROM TCHTLHLD
DATA ON TCHTLHLD
END
-RUN





-NEXTONE
