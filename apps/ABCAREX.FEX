-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO
-* File BVCAREX.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*8/11/16-JEM-S-21166-Created for new report abachlfl
-********************************************************************
-*SET &ECHO=ALL;
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN
 
-SET &CARDATES = &&WEB_PATH || 'CARDATES.fex';
 
 
DEFINE FILE &&EXTRACT
CDDATE/MDYY = DROP_DATE;
CDRATE/D12.2CS=DAILY_RATE;
LEVEL_DESC/A60 = &&LDESC;
NBR_DAYS/D12CS = NUM_DAYS;
CRENTALA/P12.2CS = RENTAL_AMT;
  CRENTAL_DAYS/D12CS = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
 CPDATE/MDYY = PICKUP_DATE;
 
  XPSNGR_NM/A15        =
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
RSTAT/A1 = EDIT(RESV_STATUS, '$9');
CRES_DSC/A10 = DECODE RSTAT (O 'OPEN' C 'CANCELLED' X 'CHANGED');
CFLAG/A1='C';
END
-RUN
TABLEF FILE &&EXTRACT
PRINT CAR_KEY
  CDDATE
  CDRATE
  DROP_CTY.CITY_NAME/A14 AS 'CD_CITY'
  CFLAG
  CPDATE
  CRENTALA
  CRENTAL_DAYS
  CRES_DSC
  INVOICE_DATE
  LEVEL_DESC
  LEVEL1
  PASSNGR_NAME
  PICK_CTY.CITY_NAME/A14 AS 'CP_CITY'
  PNR_LOCATOR
  RESV_STATUS
  TKT_NUM
  VENDOR_NAME
  XPSNGR_NM
  RSTAT
  RESV_STATUS
  CCR_CONFIRM
-*WHERE INVOICE_DATE GE '&&FROMDT.EVAL' AND INVOICE_DATE LE '&&TODT.EVAL'
-INCLUDE &CARDATES
 
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
 
-INCLUDE RPTPARMS
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
ON TABLE HOLD AS CAR_HOLD
END
-RUN
 
 
 
DEFINE FILE CAR_HOLD
CKEYR/A82=REVERSE(82, CAR_KEY, CKEYR);
CKEYR1/A81=EDIT(CKEYR, '$999999999999999999999999999999999999999999999999999999999999999999999999999999999');
CKEY1/A82=REVERSE(82, CKEYR1, CKEY1);
END
TABLE FILE CAR_HOLD
SUM PNR_LOCATOR TKT_NUM CDRATE CRENTALA CRENTAL_DAYS PASSNGR_NAME CFLAG CD_CITY CDDATE LEVEL_DESC
    CPDATE CRES_DSC CP_CITY VENDOR_NAME LEVEL_DESC
BY CKEY1
ON TABLE HOLD AS CAR_HOLD1
END
-RUN
 
TABLE FILE CAR_HOLD1
PRINT CDRATE CRENTALA CRENTAL_DAYS PASSNGR_NAME CFLAG CD_CITY CDDATE
      CPDATE CRES_DSC CP_CITY VENDOR_NAME LEVEL_DESC
BY PNR_LOCATOR
BY TKT_NUM
WHERE CRENTALA NE 0
ON TABLE HOLD AS CAR_HOLD2
END
-RUN
 
DEFINE FILE CAR_HOLD2
CKEY/A20=TKT_NUM||PNR_LOCATOR;
END
TABLE FILE CAR_HOLD2
PRINT CDRATE CRENTALA CRENTAL_DAYS PASSNGR_NAME CFLAG CD_CITY CDDATE
      CPDATE CRES_DSC CP_CITY VENDOR_NAME LEVEL_DESC
COMPUTE CTRA/D9=1;
COMPUTE CNTR2/D9=IF CKEY NE LAST CKEY THEN 1 ELSE LAST CNTR2 + 1;
BY TKT_NUM
BY PNR_LOCATOR
ON TABLE HOLD AS ABCAR1
END
 
-* CAR 1 FIELDS
 
TABLE FILE ABCAR1
PRINT CNTR2
      CDDATE AS 'C1_CDATE'
      CDRATE AS 'C1_CDRATE'
      CD_CITY AS 'C1_CD_CITY'
      CFLAG AS 'CFLAG1'
      CPDATE AS 'C1_CPDATE'
      CRENTALA AS 'C1_CRENTALA'
      CRENTAL_DAYS AS 'C1_CRENTAL_DAYS'
      CRES_DSC AS 'C1_RES_DSC'
      CP_CITY AS 'C1_CP_CITY'
      VENDOR_NAME AS 'C1_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 1
ON TABLE HOLD AS ABCARH1
END
 
-* CAR 2 FIELDS
TABLE FILE ABCAR1
PRINT CNTR2
      CDDATE AS 'C2_CDATE'
      CDRATE AS 'C2_CDRATE'
      CD_CITY AS 'C2_CD_CITY'
      CFLAG AS 'CFLAG2'
      CPDATE AS 'C2_CPDATE'
      CRENTALA AS 'C2_CRENTALA'
      CRENTAL_DAYS AS 'C2_CRENTAL_DAYS'
      CRES_DSC AS 'C2_RES_DSC'
      CP_CITY AS 'C2_CP_CITY'
      VENDOR_NAME AS 'C2_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 2
ON TABLE HOLD AS ABCARH2
END
 
 
-* CAR 3 FIELDS
TABLE FILE ABCAR1
PRINT CNTR2
      CDDATE AS 'C3_CDATE'
      CDRATE AS 'C3_CDRATE'
      CD_CITY AS 'C3_CD_CITY'
      CFLAG AS 'CFLAG3'
      CPDATE AS 'C3_CPDATE'
      CRENTALA AS 'C3_CRENTALA'
      CRENTAL_DAYS AS 'C3_CRENTAL_DAYS'
      CRES_DSC AS 'C3_RES_DSC'
      CP_CITY AS 'C3_CP_CITY'
      VENDOR_NAME AS 'C3_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 3
ON TABLE HOLD AS ABCARH3
END
 
-* CAR 4 FIELDS
TABLE FILE ABCAR1
PRINT CNTR2
      CDDATE AS 'C4_CDATE'
      CDRATE AS 'C4_CDRATE'
      CD_CITY AS 'C4_CD_CITY'
      CFLAG AS 'CFLAG4'
      CPDATE AS 'C4_CPDATE'
      CRENTALA AS 'C4_CRENTALA'
      CRENTAL_DAYS AS 'C4_CRENTAL_DAYS'
      CRES_DSC AS 'C4_RES_DSC'
      CP_CITY AS 'C4_CP_CITY'
      VENDOR_NAME AS 'C4_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 4
ON TABLE HOLD AS ABCARH4
END
 
-* CAR 4 FIELDS
TABLE FILE ABCAR1
PRINT CNTR2
      CDDATE AS 'C5_CDATE'
      CDRATE AS 'C5_CDRATE'
      CD_CITY AS 'C5_CD_CITY'
      CFLAG AS 'CFLAG5'
      CPDATE AS 'C5_CPDATE'
      CRENTALA AS 'C5_CRENTALA'
      CRENTAL_DAYS AS 'C5_CRENTAL_DAYS'
      CRES_DSC AS 'C5_RES_DSC'
      CP_CITY AS 'C5_CP_CITY'
      VENDOR_NAME AS 'C5_VENDOR'
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
WHERE CNTR2 EQ 5
ON TABLE HOLD AS ABCARH5
END
 
 
 
-* MATCH ALL CAR FIELDS TOGHETHER
 
MATCH FILE ABCARH1
PRINT C1_CDATE C1_CDRATE C1_CD_CITY CFLAG1 C1_CPDATE C1_CRENTALA C1_CRENTAL_DAYS C1_RES_DSC C1_CP_CITY C1_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABCARH2
PRINT C2_CDATE C2_CDRATE C2_CD_CITY CFLAG2 C2_CPDATE C2_CRENTALA C2_CRENTAL_DAYS C2_RES_DSC C2_CP_CITY C2_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABCARH12 OLD-OR-NEW
END
 
 
MATCH FILE ABCARH12
PRINT C1_CDATE C1_CDRATE C1_CD_CITY CFLAG1 C1_CPDATE C1_CRENTALA C1_CRENTAL_DAYS C1_RES_DSC C1_CP_CITY C1_VENDOR
      C2_CDATE C2_CDRATE C2_CD_CITY CFLAG2 C2_CPDATE C2_CRENTALA C2_CRENTAL_DAYS C2_RES_DSC C2_CP_CITY C2_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABCARH3
PRINT C3_CDATE C3_CDRATE C3_CD_CITY CFLAG3 C3_CPDATE C3_CRENTALA C3_CRENTAL_DAYS C3_RES_DSC C3_CP_CITY C3_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
AFTER MATCH HOLD AS ABCARH123 OLD-OR-NEW
END
 
MATCH FILE ABCARH123
PRINT C1_CDATE C1_CDRATE C1_CD_CITY CFLAG1 C1_CPDATE C1_CRENTALA C1_CRENTAL_DAYS C1_RES_DSC C1_CP_CITY C1_VENDOR
      C2_CDATE C2_CDRATE C2_CD_CITY CFLAG2 C2_CPDATE C2_CRENTALA C2_CRENTAL_DAYS C2_RES_DSC C2_CP_CITY C2_VENDOR
      C3_CDATE C3_CDRATE C3_CD_CITY CFLAG3 C3_CPDATE C3_CRENTALA C3_CRENTAL_DAYS C3_RES_DSC C3_CP_CITY C3_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABCARH4
PRINT C4_CDATE C4_CDRATE C4_CD_CITY CFLAG4 C4_CPDATE C4_CRENTALA C4_CRENTAL_DAYS C4_RES_DSC C4_CP_CITY C4_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD AS ABCARH1234 OLD-OR-NEW
END
 
MATCH FILE ABCARH123
PRINT C1_CDATE C1_CDRATE C1_CD_CITY CFLAG1 C1_CPDATE C1_CRENTALA C1_CRENTAL_DAYS C1_RES_DSC C1_CP_CITY C1_VENDOR
      C2_CDATE C2_CDRATE C2_CD_CITY CFLAG2 C2_CPDATE C2_CRENTALA C2_CRENTAL_DAYS C2_RES_DSC C2_CP_CITY C2_VENDOR
      C3_CDATE C3_CDRATE C3_CD_CITY CFLAG3 C3_CPDATE C3_CRENTALA C3_CRENTAL_DAYS C3_RES_DSC C3_CP_CITY C3_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABCARH4
PRINT C4_CDATE C4_CDRATE C4_CD_CITY CFLAG4 C4_CPDATE C4_CRENTALA C4_CRENTAL_DAYS C4_RES_DSC C4_CP_CITY C4_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD AS ABCARH1234 OLD-OR-NEW
END
 
MATCH FILE ABCARH1234
PRINT C1_CDATE C1_CDRATE C1_CD_CITY CFLAG1 C1_CPDATE C1_CRENTALA C1_CRENTAL_DAYS C1_RES_DSC C1_CP_CITY C1_VENDOR
      C2_CDATE C2_CDRATE C2_CD_CITY CFLAG2 C2_CPDATE C2_CRENTALA C2_CRENTAL_DAYS C2_RES_DSC C2_CP_CITY C2_VENDOR
      C3_CDATE C3_CDRATE C3_CD_CITY CFLAG3 C3_CPDATE C3_CRENTALA C3_CRENTAL_DAYS C3_RES_DSC C3_CP_CITY C3_VENDOR
      C4_CDATE C4_CDRATE C4_CD_CITY CFLAG4 C4_CPDATE C4_CRENTALA C4_CRENTAL_DAYS C4_RES_DSC C4_CP_CITY C4_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD
RUN
FILE ABCARH5
PRINT C5_CDATE C5_CDRATE C5_CD_CITY CFLAG5 C5_CPDATE C5_CRENTALA C5_CRENTAL_DAYS C5_RES_DSC C5_CP_CITY C5_VENDOR
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD AS ABCARH12345 OLD-OR-NEW
END
 
 
TABLE FILE ABCARH12345
PRINT C1_CDATE C1_CDRATE C1_CD_CITY CFLAG1 C1_CPDATE C1_CRENTALA C1_CRENTAL_DAYS C1_RES_DSC C1_CP_CITY C1_VENDOR
      C2_CDATE C2_CDRATE C2_CD_CITY CFLAG2 C2_CPDATE C2_CRENTALA C2_CRENTAL_DAYS C2_RES_DSC C2_CP_CITY C2_VENDOR
      C3_CDATE C3_CDRATE C3_CD_CITY CFLAG3 C3_CPDATE C3_CRENTALA C3_CRENTAL_DAYS C3_RES_DSC C3_CP_CITY C3_VENDOR
      C4_CDATE C4_CDRATE C4_CD_CITY CFLAG4 C4_CPDATE C4_CRENTALA C4_CRENTAL_DAYS C4_RES_DSC C4_CP_CITY C4_VENDOR
      C5_CDATE C5_CDRATE C5_CD_CITY CFLAG5 C5_CPDATE C5_CRENTALA C5_CRENTAL_DAYS C5_RES_DSC C5_CP_CITY C5_VENDOR
COMPUTE CAA/D12.2 = C1_CRENTALA + C2_CRENTALA + C3_CRENTALA + C4_CRENTALA + C5_CRENTALA;
COMPUTE CAD/P12 = C1_CRENTAL_DAYS + C2_CRENTAL_DAYS + C3_CRENTAL_DAYS + C4_CRENTAL_DAYS + C5_CRENTAL_DAYS;
BY PNR_LOCATOR
BY TKT_NUM
BY PASSNGR_NAME
ON TABLE HOLD AS ABCAR
END
