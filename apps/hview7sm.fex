-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO
-* File HVIEW3SM.FEX
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*5/27/03    DEB                HARDCODED TO RANK BY HIGHEST NMBR_DAYS
-*4/1/04     DEB                CHANGED TO SUM DEFINE BOOKINGS FIELD
-*5/06/05    DEB                ADDED CODE FOR GLOBAL CURRENCY
-*12/22/11   GSE                Removed parens from around CLIMIT in
-*                              DEFINEs for 7.7.03
-*7/16/13    JEK                ADDED LOGIC TO GO AROUND PART OF FOOTER FOR PSGTPHPN 
-*11/4/13    jek                Removed the reason code exclusion footer
-* Joy Added additional field for MXTPHCIT 1/22/14
-* Added goto for ALTPHCIT TO GOTO MXTPHCIT Code JK 3/10/14
-* Added logic for MXTPHCCW - JK 5/16/14
-* 9/24/14 Updated to use exclude flags in % - JK
-* 2/3/15 - DEB - S-07299 CORRECTED % TO NOT EXCEED 100.0
-* 3/2/15 - Joy - S-07752 Updated MXTPCCW version to show a grand total with correct %s 
-*6/8/15 - joy - STORY ID - S-09493 - Updated footer to include more verbiage related to % omitting data based upon preferred/non-preferred setup
-*4/11/16-jem-S-17687 Updated Grand Total Percentage to calculate correctly (not always be 100%)
-*03/13/17 - DLV - S-22486 - updated ettek Review to Post-trip Reporting
-*09/29/2017 JEM S-35465 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*10/25/2017 RSB S-38044 Place the footer date/time stamp text in a separate file to be -INCLUDED in the stylesheets
-*                        Added: -SET &FTR_AddlLines = #;
-*11/17/17 JEM S-42229 Correcting grand total LSV

-**********************************************************************

SET ASNAMES=ON

-IF &&SETF EQ 'MXTPHCIT' OR 'ALTPHCIT' OR 'ALTPHCHH' THEN GOTO MXRPT;
-IF &&SETF EQ 'MXTPHCCW' THEN GOTO MXRPT1 ELSE GOTO CURR;
-RUN

-CURR;


-IF &&CURRENCY EQ 'USD' THEN GOTO SKIPTHIS;


-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,ROOM, AMOUNT, (' | &&CURRENCY || ')';
-SET &GADR_CUR = ' AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &GSAV_CUR = ' SAVINGS, (' | &&CURRENCY || ')';
-SET &GLSV_CUR = ' LOST,SVGS, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2='GROOM_AMT/D16.2C AS ' | '''&TAMT_CUR.EVAL''';
-SET &&S_SUBJ3='COMPUTE GAVGAMT/D16.2CS=IF (GROOM_AMT LT 0) AND (NNROOMS LT 0)';
-SET &&S_SUBJ4='THEN ((GROOM_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND';
-SET &&S_SUBJ5='(NNROOMS GT (-1))) THEN 0 ELSE (GROOM_AMT/NNROOMS); ';
-SET &&S_SUBJ6='AS ' | '''&GADR_CUR.EVAL''' ;
-SET &&S_SUBJ9='SLSAV_TTL1/D16.2C AS ' | '''&GSAV_CUR.EVAL''' ;
-SET &&S_SUBJ10='GLSV/D16.2C AS ' | '''&GLSV_CUR.EVAL''' ;





-SKIPTHIS;


-IF &&SETF NE 'MXTPHPN' THEN GOTO NOWHR;
-SET &&MXWHR = 'WHERE NMBR_DAYS NE 0';
-RUN
-GOTO NOWHR1;

-NOWHR;
-SET &&MXWHR = ' ';
-RUN

-NOWHR1;


TABLE FILE HTLHLD2
-* SUM CNT.NUM_DAYS AS 'BOOKINGS'	
SUM BOOKINGS
    NAMEC
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMS3
    NNROOMSPN
    NPREF_AMT
    AMT_NPREF1/D16.2
    NPREF_NGT
    PREF_AMT
    AMT_PREF1/D16.2
    PREF_NGT
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'
    AMT_TOTL1/D16.2 AS 'GROOM_AMT'
    TOTAL_STD
    TOTAL_SLSAV	
    SLSAV_TTL1/D16.2
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
ON TABLE HOLD AS HOLD1 
END
-RUN

TABLE FILE HTLHLD2
-* SUM CNT.NUM_DAYS AS 'BOOKINGS'	
SUM BOOKINGS
    NAMEC
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    AMT_NPREF1/D16.2
    NPREF_NGT
    PREF_AMT
    AMT_PREF1/D16.2
    PREF_NGT
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    AMT_TOTL1/D16.2 AS 'GROOM_AMT'
    TOTAL_STD
    TOTAL_SLSAV	
    SLSAV_TTL1/D16.2
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
BY PREF_NON
ON TABLE HOLD AS MATCHHLD 
END

-RUN

TABLE FILE HTLHLD2
SUM NNROOMS AS 'TNROOMS' NNROOMS3 AS 'TNROOMS1'
BY CITY_ST
ON TABLE HOLD AS TTLHLD
END
-RUN


MATCH FILE HOLD1
PRINT
    BOOKINGS
    NAMEC
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMS3
    NNROOMSPN
    NPREF_AMT
    AMT_NPREF1
    NPREF_NGT
    PREF_AMT
    AMT_PREF1
    PREF_NGT
    SAVINGS	
    ROOM_AMT
    GROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    SLSAV_TTL1
    NMBR_DAYS
BY CITY_ST
ON TABLE HOLD
RUN
FILE TTLHLD
SUM TNROOMS TNROOMS1
BY CITY_ST
AFTER MATCH HOLD AS TTL1HLD OLD-OR-NEW
END
-RUN


TABLE FILE TTL1HLD
PRINT 
  BOOKINGS
  CITY_ST
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT
  GROOM_AMT
  SAVINGS
  TNROOMS
  TNROOMS1
  TOTAL_STD	
  TOTAL_SLSAV
  SLSAV_TTL1
-* RANKED BY &&RANK_ORDER &&RANK_METH NOPRINT
RANKED BY HIGHEST NMBR_DAYS
ON TABLE HOLD AS HOLD2 
END
-RUN

-IF '&&SETF.EVAL' NE 'CGHRAHI' OR 'CGHRAHE' GOTO NEXT;
-SET &&RANK_LIMIT = 9999;


-NEXT;
DEFINE FILE HOLD2
  CTY_LIMIT/I2 = &&RANK_LIMIT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
  FRANK/A6=EDIT(FRANKX,'$999999');
  CTY_VALUE/A6 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                 IF RANK GT CTY_LIMIT THEN 'OTHER' ELSE BRANK;
END
-RUN

MATCH FILE HOLD2
SUM CLIMIT
    CTY_VALUE
    TNROOMS
    TNROOMS1
BY CITY_ST
ON TABLE HOLD
RUN
FILE MATCHHLD
PRINT BOOKINGS
    NAMEC
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMS3
    NNROOMSPN
    NPREF_AMT
    AMT_NPREF1
    NPREF_NGT
    PREF_AMT
    AMT_PREF1
    PREF_NGT
    PREF_NON
    SAVINGS	
    ROOM_AMT
    GROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    SLSAV_TTL1
    NMBR_DAYS
BY CITY_ST
AFTER MATCH HOLD AS MATCHH2 OLD-OR-NEW
END
-RUN

DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';	
END

TABLE FILE MATCHH2
SUM BOOKINGS
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_PREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS
  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE GPAVG/P16.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS MATCHH3
END
-RUN

DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';
END 

TABLE FILE MATCHH2
PRINT
  BOOKINGS	
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS
  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE GPAVG/P16.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
WHERE CTY_VALUE NE 'OTHER'
ON TABLE HOLD AS HOLD7 FORMAT FOCUS
END
-RUN


DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';
END

TABLE FILE MATCHH2
SUM BOOKINGS
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS
  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE GPAVG/P16.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
WHERE CTY_VALUE EQ 'OTHER'
ON TABLE HOLD AS XTWO FORMAT ALPHA
END
-RUN

TABLE FILE XTWO
SUM NNROOMS AS 'TNROOMS' NNROOMS3 AS 'TNROOMS1'
BY CTY_VALUE
ON TABLE HOLD AS JHOLD FORMAT ALPHA
END
-RUN

MATCH FILE XTWO
PRINT BOOKINGS
  CLIMIT
  CTY_PRINT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMS3
  NNROOMSPN
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  PREF_NON
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
BY CTY_VALUE 
ON TABLE HOLD
RUN
FILE JHOLD
SUM TNROOMS TNROOMS1
BY CTY_VALUE
AFTER MATCH HOLD AS JHOLD1 OLD-OR-NEW
END
-RUN

-* DEFINE FILE JHOLD1
-* CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE ' ';
-* END

TABLE FILE JHOLD1
PRINT
  BOOKINGS
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS
  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P16.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS XTHREE FORMAT FOCUS
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNK=&HLDPATH || 'HOLD7.FOC';
-SET &HNORNK=&HLDPATH || 'XTHREE.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD
&HNK AS HOLD7
&HNORNK AS HOLD7
END
-RUN

TABLE FILE HOLD7
SUM  BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE GPAVG/P16.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREF 
END
-RUN 

MATCH FILE HOLD7
PRINT
  BOOKINGS	
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  NAVG
  GNAVG
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  PREF_NON	
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS	
  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
BY CTY_VALUE
BY CTY_PRINT
ON TABLE HOLD
RUN
FILE HOLDPREF
SUM PAVG 
    GPAVG
BY CTY_VALUE
BY CTY_PRINT
AFTER MATCH HOLD AS HOLD8 OLD-OR-NEW
END
-RUN

DEFINE FILE HOLD8
PAVG1/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
TNROOMS2/D12 = IF NNROOMSPN GT TNROOMS1 THEN 0 ELSE TNROOMS1;

FLAG/A1 = 'A';
END

TABLE FILE HOLD8
SUM BOOKINGS	
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  NAVG
  GNAVG
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE ROOM_AMT/NMBR_DAYS; 
COMPUTE GAVGAMT/D16.2=IF (GROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((GROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE GROOM_AMT/NMBR_DAYS; 
COMPUTE NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT; 
COMPUTE PAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE GPAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT; 
COMPUTE PCTNBRN/P12.2 = IF ((TNROOMS2 LT 1) AND (TNROOMS2 GT (-1))) THEN 0 ELSE
((NNROOMSPN/TNROOMS2)*100);
-* COMPUTE LSV/P12.2C= IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG-PAVG1)*NPREF_NGT);
COMPUTE LSV/P12.2C = IF NAVG-PAVG1 LE 0 THEN 0 ELSE 
                     IF PAVG1 EQ 0 THEN 0 ELSE ((NAVG-PAVG1)*NPREF_NGT);           
COMPUTE GLSV/P16.2C= IF GNAVG-GPAVG1 LE 0 THEN 0 ELSE ((GNAVG-GPAVG1)*NPREF_NGT);
BY FLAG
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS HLDONE FORMAT FOCUS
END
-RUN


DEFINE FILE MATCHH3
FLAG/A1 = 'C';
CTY_VALUE/A35 = 'GRAND TOTAL';
CTY_PRINT/A6 = ' ';
END
TABLE FILE MATCHH3
SUM NNROOMS3 AS 'TNROOMS1' 
COMPUTE PAVGT/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE 
BY FLAG
BY CTY_VALUE
BY CTY_PRINT
ON TABLE HOLD AS TFIX
END
-RUN

TABLE FILE MATCHH3
SUM BOOKINGS
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_PREF1
  NPREF_NGT
  PREF_AMT
  AMT_NPREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS
-*  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
  NAVG
  GNAVG
  PAVG
  GPAVG
BY FLAG  
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS MATCHH3A
END

MATCH FILE MATCHH3A
SUM BOOKINGS
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_PREF1
  NPREF_NGT
  PREF_AMT
  AMT_PREF1
  AMT_NPREF1 
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS
  TNROOMS
-*  TNROOMS1
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1
  NAVG
  GNAVG
  PAVG
  GPAVG
BY FLAG  
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD
RUN
FILE TFIX
SUM TNROOMS1 PAVGT
BY FLAG
BY CTY_VALUE
BY CTY_PRINT
AFTER MATCH HOLD AS MATCHH3AA OLD-OR-NEW
END


DEFINE FILE MATCHH3AA
PAVG1/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
TNROOMS2/D12 = IF NNROOMSPN GT TNROOMS1 THEN 0 ELSE TNROOMS1;
-* TNROOMS2/D12 = NNROOMSPN;
FLAG/A1 = 'C';
-* CTY_VALUE/A35 = 'GRAND TOTAL';
-* CTY_PRINT/A6 = ' ';
END



TABLE FILE MATCHH3AA
SUM BOOKINGS	
  CLIMIT
  NAMEC
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NMBR_DAYS	
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  AMT_NPREF1
  NPREF_NGT
  NAVG
  GNAVG
  PREF_AMT
  AMT_PREF1
  PREF_NGT
  ROOM_AMT	
  GROOM_AMT
  SAVINGS	
  TOTAL_STD
  TOTAL_SLSAV
  SLSAV_TTL1  
 
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE ROOM_AMT/NMBR_DAYS; 
COMPUTE GAVGAMT/D16.2=IF (GROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((GROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE GROOM_AMT/NMBR_DAYS; 
COMPUTE NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT; 
COMPUTE PAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE GPAVG/P16.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT; 
COMPUTE PCTNBRNT/P12.2 = IF ((TNROOMS2 LT 1) AND (TNROOMS2 GT (-1))) THEN 0 ELSE
((NNROOMSPN/TNROOMS2)*100);
-* COMPUTE LSV/P12.2C= IF (PAVGT EQ 0) THEN 0 ELSE ((NAVG2-PAVGT)*NPREF_NGT);
COMPUTE LSV/P12.2C = IF NAVG2-PAVGT LE 0 THEN 0 ELSE 
                     IF PAVGT EQ 0 THEN 0 ELSE ((NAVG2-PAVGT)*NPREF_NGT);           

COMPUTE GLSV/P16.2C= IF (GPAVG EQ 0) THEN 0 ELSE ((GNAVG-GPAVG)*NPREF_NGT);
BY FLAG
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS HLDTWO FORMAT FOCUS
END
-RUN


-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK=&HLDPATH || 'HLDONE.FOC';
-SET &HNORANK=&HLDPATH || 'HLDTWO.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD
&HRANK AS HLDONE
&HNORANK AS HLDONE
END
-RUN


-GOTO JOY

TABLE FILE HLDONE
PRINT *
ON TABLE HOLD AS HLDMOD FORMAT FOCUS
END
-RUN


TABLE FILE HLDMOD
PRINT FOCLIST 
BY FOCLIST NOPRINT
WHERE FLAG EQ 'C'
ON TABLE HOLD AS HHLDFIX
END
-RUN

MODIFY FILE HLDMOD
FIXFORM FROM HHLDFIX
MATCH FOCLIST
ON MATCH COMPUTE PCTNBRN=100.00;
ON MATCH UPDATE PCTNBRN
ON NOMATCH REJECT
DATA ON HHLDFIX
END
-RUN

-JOY;

DEFINE FILE HLDONE
NOWTOD/A8 WITH CTY_VALUE = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE HLDONE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
   
-* Where Statement for Metlife to exclude bookings that net to zero   

  &&MXWHR
  
-IF &&SETF EQ 'PSGTPHPN' GOTO NOSI;
-SET &FTR_AddlLines = 6;
FOOTING BOTTOM
"</2>"
"* BASED UPON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT, % ONLY MAY CONTAIN EXCLUSIONS"
"LOST SAVINGS = NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS ALSO EXCLUDES REASON CODES S AND I"
-*
-GOTO SICONT;
-*****
-NOSI
-*****
-SET &FTR_AddlLines = 6;
FOOTING BOTTOM
"</2>"
"* BASED UPON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT, % ONLY MAY CONTAIN EXCLUSIONS"
"LOST SAVINGS = NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-*******
-SICONT
-*******
-*
-INCLUDE FOOTERSM
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;


-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
-*
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-*

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3

-GOTO XXIT;

-MXRPT;

-********************************************************************************************************
-* Metlife Report includes only cities included in the PREFHTL file
-********************************************************************************************************

TABLE FILE MXPREFH
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    PBOOK
    RBOOK
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'
    TOTAL_STD
    TOTAL_SLSAV	
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
ON TABLE HOLD AS HOLD1 
END
-RUN

TABLE FILE MXPREFH
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	    
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
BY PREF_NON
ON TABLE HOLD AS MATCHHLD 
END
-RUN

TABLE FILE MXPREFH
SUM NNROOMS AS 'TNROOMS'
    BOOKINGS AS 'TBOOK'
    NNROOMS3 AS 'TNROOMS1'
    BKGS3 AS 'TBOOK1'
BY CITY_ST
ON TABLE HOLD AS TTLHLD
END
-RUN

MATCH FILE HOLD1
PRINT
    BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    NMBR_DAYS
BY CITY_ST
ON TABLE HOLD
RUN
FILE TTLHLD
SUM TNROOMS TBOOK TNROOMS1 TBOOK1
BY CITY_ST
AFTER MATCH HOLD AS TTL1HLD OLD-OR-NEW
END
-RUN


TABLE FILE TTL1HLD
PRINT BOOKINGS
      BKGSPN
      BKGS3
      CITY_ST
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS	
      NNROOMSPN
      NNROOMS3
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      RAMT
      RNGT
      RBOOK
      PBOOK
      SAVINGS	
      ROOM_AMT
      TOTAL_STD
      TOTAL_SLSAV
      TNROOMS
      TNROOMS1
      TBOOK
      TBOOK1
      NMBR_DAYS
RANKED BY HIGHEST NMBR_DAYS
ON TABLE HOLD AS HOLD2 
END
-RUN

DEFINE FILE HOLD2
  CTY_LIMIT/I2 = &&RANK_LIMIT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A12     = FTOA(CRANK, '(D5)', 'A12');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A13 = FTOA(LIST, '(D6)', 'A13');
  FRANK/A12=EDIT(FRANKX,'$99999999999');
  CTY_VALUE/A12 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                  IF LIST GT CTY_LIMIT THEN 'ALL OTHER' ELSE FRANK;
END 
-RUN

MATCH FILE HOLD2
SUM CLIMIT
    CTY_VALUE
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
BY CITY_ST
ON TABLE HOLD
RUN
FILE MATCHHLD
PRINT BOOKINGS
      BKGSPN
      BKGS3
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      NNROOMSPN
      NNROOMS3
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      PREF_NON
      RAMT
      RNGT
      RBOOK
      PBOOK
      SAVINGS	
      ROOM_AMT
      TOTAL_STD
      TOTAL_SLSAV
      NMBR_DAYS
BY CITY_ST
AFTER MATCH HOLD AS MATCHH2 OLD-OR-NEW
END
-RUN

DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE 'ALL OTHER';	
END

TABLE FILE MATCHH2
SUM BOOKINGS
  BKGSPN
  BKGS3
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  RAMT
  RNGT
  RBOOK
  PBOOK
  SAVINGS	
  ROOM_AMT
  TOTAL_STD
  TOTAL_SLSAV
  TBOOK
  TBOOK1
  TNROOMS
  TNROOMS1
  NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS MATCHH3
END
-RUN


DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE 'ALL OTHER';
END 

TABLE FILE MATCHH2
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
WHERE CTY_VALUE NE 'ALL OTHER'
ON TABLE HOLD AS HOLD7 FORMAT FOCUS
END
-RUN

DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE 'ALL OTHER';
END

TABLE FILE MATCHH2
SUM BOOKINGS
  BKGSPN
  BKGS3
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  RAMT
  RNGT
  RBOOK
  PBOOK
  SAVINGS	
  ROOM_AMT
  TOTAL_STD
  TOTAL_SLSAV
  NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
WHERE CTY_VALUE EQ 'ALL OTHER'
ON TABLE HOLD AS XTWO 
END
-RUN

TABLE FILE XTWO
SUM NNROOMS AS 'TNROOMS' BOOKINGS AS 'TBOOK' NNROOMS3 AS 'TNROOMS1' BKGS3 AS 'TBOOK1'
BY CTY_VALUE
ON TABLE HOLD AS JHOLD FORMAT ALPHA
END
-RUN

MATCH FILE XTWO
PRINT CTY_PRINT
  BOOKINGS
  BKGSPN
  BKGS3
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS	
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  RAMT
  RNGT
  RBOOK
  PBOOK
  SAVINGS	
  ROOM_AMT
  TOTAL_STD
  TOTAL_SLSAV
  NMBR_DAYS
BY CTY_VALUE 
ON TABLE HOLD
RUN
FILE JHOLD
SUM TNROOMS TBOOK TNROOMS1 TBOOK1
BY CTY_VALUE
AFTER MATCH HOLD AS JHOLD1 OLD-OR-NEW
END
-RUN


TABLE FILE JHOLD1
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS XTHREE FORMAT FOCUS
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNK=&HLDPATH || 'HOLD7.FOC';
-SET &HNORNK=&HLDPATH || 'XTHREE.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD
&HNK AS HOLD7
&HNORNK AS HOLD7
END
-RUN

TABLE FILE HOLD7
SUM  BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREF 
END
-RUN

MATCH FILE HOLD7
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    PREF_NON
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
BY CTY_VALUE
BY CTY_PRINT
ON TABLE HOLD
RUN
FILE HOLDPREF
SUM PAVG 
BY CTY_VALUE
BY CTY_PRINT
AFTER MATCH HOLD AS HOLD8 OLD-OR-NEW
END
-RUN

DEFINE FILE HOLD8
PAVG1/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
TNROOMS2/D12 = IF NNROOMSPN GT TNROOMS1 THEN 0 ELSE TNROOMS1;
TBOOK2/D12 = IF BKGSPN GT TBOOK1 THEN 0 ELSE TBOOK1;
FLAG/A1 = 'A';
END

TABLE FILE HOLD8
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    NMBR_DAYS
    PAVG
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE ROOM_AMT/NMBR_DAYS; 
COMPUTE NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE PAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE PCTNBRN/P12.2 = IF ((TNROOMS2 LT 1) AND (TNROOMS2 GT (-1))) THEN 0 ELSE ((NNROOMSPN/TNROOMS2)*100);
COMPUTE PCTPBK/P12.2S = IF ((TBOOK2 LT 1) AND (TBOOK2 GT (-1))) THEN 0 ELSE ((BKGSPN/TBOOK2)*100);
COMPUTE PCTRBK/P12.2S = IF ((PBOOK LT 1) AND (PBOOK GT (-1))) THEN 0 ELSE ((RBOOK/PBOOK)*100);
COMPUTE LSV/P12.2C= IF NAVG2-PAVG1 LE 0 THEN 0 ELSE
                    IF PAVG1 EQ 0 THEN 0 ELSE ((NAVG2-PAVG1)*NPREF_NGT);
VARAVG/P12.2CS = IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)/NAVG2)*100;
BY FLAG
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS HLDONE FORMAT FOCUS
END
-RUN


DEFINE FILE HOLD7
CTY_VAL/A35 = 'GRAND TOTAL';
CTY_P/A12 = ' ';
END
-RUN
TABLE FILE HOLD7
SUM  BOOKINGS 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VAL 
BY CTY_P 
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREFT 
END
-RUN

DEFINE FILE HOLD7
CTY_VAL/A35 = 'GRAND TOTAL';
CTY_P/A12 = ' ';
END
-RUN

TABLE FILE HOLD7
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK    
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
BY CTY_VAL
BY CTY_P
BY PREF_NON
ON TABLE HOLD AS HOLD7T
END
-RUN


MATCH FILE HOLD7T
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    PREF_NON
    RAMT
    RNGT
    RBOOK
    PBOOK    
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV  
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
BY CTY_VAL
BY CTY_P
ON TABLE HOLD
RUN
FILE HOLDPREFT
SUM PAVG 
BY CTY_VAL
BY CTY_P
AFTER MATCH HOLD AS HOLD8T OLD-OR-NEW
END
-RUN



DEFINE FILE HOLD8T
PAVG1/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
FLAG/A1 = 'C';
CTY_VALUE/A35 = 'GRAND TOTAL';
CTY_PRINT/A12 = ' ';
TNROOMS2/D12 = IF NNROOMSPN GT TNROOMS1 THEN 0 ELSE TNROOMS1;
TBOOK2/D12 = IF BKGSPN GT TBOOK1 THEN 0 ELSE TBOOK1;
END

TABLE FILE HOLD8T
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK    
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    NMBR_DAYS
    PAVG
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE ROOM_AMT/NMBR_DAYS; 
COMPUTE NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE PCTNBRN/P12.2 = IF ((TNROOMS2 LT 1) AND (TNROOMS2 GT (-1))) THEN 0 ELSE
((NNROOMSPN/TNROOMS2)*100);
COMPUTE PCTPBK/P12.2S = IF ((TBOOK2 LT 1) AND (TBOOK2 GT (-1))) THEN 0 ELSE ((BKGSPN/TBOOK2)*100);
COMPUTE PCTRBK/P12.2S = IF ((PBOOK LT 1) AND (PBOOK GT (-1))) THEN 0 ELSE ((RBOOK/PBOOK)*100);
COMPUTE LSV/P12.2C= IF NAVG2-PAVG1 LE 0 THEN 0 ELSE
                    IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)*NPREF_NGT);
VARAVG/P12.2CS = IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)/NAVG2)*100;

BY FLAG
BY CTY_VALUE
BY CTY_PRINT
BY PREF_NON
ON TABLE HOLD AS HLDTWO FORMAT FOCUS
END
-RUN


-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK=&HLDPATH || 'HLDONE.FOC';
-SET &HNORANK=&HLDPATH || 'HLDTWO.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD
&HRANK AS HLDONE
&HNORANK AS HLDONE
END
-RUN

TABLE FILE HLDONE
PRINT *
ON TABLE HOLD AS HLDMOD FORMAT FOCUS
END
-RUN


TABLE FILE HLDMOD
PRINT FOCLIST 
BY FOCLIST NOPRINT
WHERE FLAG EQ 'C'
ON TABLE HOLD AS HHLDFIX
END
-RUN

MODIFY FILE HLDMOD
FIXFORM FROM HHLDFIX
MATCH FOCLIST
ON MATCH COMPUTE PCTNBRN=100.00;
ON MATCH UPDATE PCTNBRN
ON NOMATCH REJECT
DATA ON HHLDFIX
END
-RUN


DEFINE FILE HLDMOD
NOWTOD/A8 WITH CTY_VALUE = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE HLDMOD
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
   

-SET &FTR_AddlLines = 6;
FOOTING BOTTOM
"</2>"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS = NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-*
-INCLUDE FOOTERSM
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;


-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
-*
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-*

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT;



-MXRPT1;

-********************************************************************************************************
-* Metlife Report includes only cities included in the PREFHTL file
-********************************************************************************************************

TABLE FILE MXPREFH
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    PBOOK
    RBOOK
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'
    TOTAL_STD
    TOTAL_SLSAV	
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
ON TABLE HOLD AS HOLD1 
END
-RUN

TABLE FILE MXPREFH
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    TOTAL_AMT/D12.2 AS 'ROOM_AMT'	
    TOTAL_STD
    TOTAL_SLSAV	    
    TTL_NGT AS 'NMBR_DAYS'
BY CITY_ST
BY CHAIN_WIDE
ON TABLE HOLD AS MATCHHLD 
END
-RUN


TABLE FILE MXPREFH
SUM NNROOMS AS 'TNROOMS'
    BOOKINGS AS 'TBOOK'
    NNROOMS3 AS 'TNROOMS1'
    BKGS3 AS 'TBOOK1'
BY CITY_ST
ON TABLE HOLD AS TTLHLD
END
-RUN

MATCH FILE HOLD1
PRINT
    BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    NMBR_DAYS
BY CITY_ST
ON TABLE HOLD
RUN
FILE TTLHLD
SUM TNROOMS TBOOK TNROOMS1 TBOOK1
BY CITY_ST
AFTER MATCH HOLD AS TTL1HLD OLD-OR-NEW
END
-RUN


TABLE FILE TTL1HLD
PRINT BOOKINGS
      BKGSPN
      BKGS3
      CITY_ST
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS	
      NNROOMSPN
      NNROOMS3
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      RAMT
      RNGT
      RBOOK
      PBOOK
      SAVINGS	
      ROOM_AMT
      TOTAL_STD
      TOTAL_SLSAV
      TNROOMS
      TNROOMS1
      TBOOK
      TBOOK1
      NMBR_DAYS
RANKED BY HIGHEST NMBR_DAYS
ON TABLE HOLD AS HOLD2 
END
-RUN

DEFINE FILE HOLD2
  CTY_LIMIT/I2 = &&RANK_LIMIT;
  CLIMIT/A2    = EDIT(CTY_LIMIT) ;
  CRANK/D5     = RANK;    
  BRANK/A12     = FTOA(CRANK, '(D5)', 'A12');
  LIST/D6 = IF CITY_ST NE LAST CITY_ST THEN (LAST LIST + 1) ELSE LAST LIST;
  FRANKX/A13 = FTOA(LIST, '(D6)', 'A13');
  FRANK/A12=EDIT(FRANKX,'$99999999999');
  CTY_VALUE/A12 = IF CTY_LIMIT EQ 0 THEN BRANK ELSE
                  IF LIST GT CTY_LIMIT THEN 'ALL OTHER' ELSE FRANK;
END 
-RUN

MATCH FILE HOLD2
SUM CLIMIT
    CTY_VALUE
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
BY CITY_ST
ON TABLE HOLD
RUN
FILE MATCHHLD
PRINT BOOKINGS
      BKGSPN
      BKGS3
      CHAIN_WIDE
      NEW_ROOM_RATE
      NEW_STD_RATE
      NEW_TOTAL_AMT
      NNROOMS
      NNROOMSPN
      NNROOMS3
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      RAMT
      RNGT
      RBOOK
      PBOOK
      SAVINGS	
      ROOM_AMT
      TOTAL_STD
      TOTAL_SLSAV
      NMBR_DAYS
BY CITY_ST
AFTER MATCH HOLD AS MATCHH2 OLD-OR-NEW
END
-RUN

DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE 'ALL OTHER';	
END

TABLE FILE MATCHH2
SUM BOOKINGS
  BKGSPN
  BKGS3
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS	
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  RAMT
  RNGT
  RBOOK
  PBOOK
  SAVINGS	
  ROOM_AMT
  TOTAL_STD
  TOTAL_SLSAV
  TBOOK
  TBOOK1
  TNROOMS
  TNROOMS1
  NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY CHAIN_WIDE
ON TABLE HOLD AS MATCHH3
END
-RUN


DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE 'ALL OTHER';
END 

TABLE FILE MATCHH2
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY CHAIN_WIDE
WHERE CTY_VALUE NE 'ALL OTHER'
ON TABLE HOLD AS HOLD7 FORMAT FOCUS
END
-RUN

DEFINE FILE MATCHH2
CTY_PRINT/A35 = IF CTY_VALUE LT CLIMIT THEN CITY_ST ELSE 'ALL OTHER';
END

TABLE FILE MATCHH2
SUM BOOKINGS
  BKGSPN
  BKGS3
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS	
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  RAMT
  RNGT
  RBOOK
  PBOOK
  SAVINGS	
  ROOM_AMT
  TOTAL_STD
  TOTAL_SLSAV
  NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
BY CHAIN_WIDE
WHERE CTY_VALUE EQ 'ALL OTHER'
ON TABLE HOLD AS XTWO 
END
-RUN

TABLE FILE XTWO
SUM NNROOMS AS 'TNROOMS' BOOKINGS AS 'TBOOK' NNROOMS3 AS 'TNROOMS1' BKGS3 AS 'TBOOK1'
BY CTY_VALUE
ON TABLE HOLD AS JHOLD FORMAT ALPHA
END
-RUN

MATCH FILE XTWO
PRINT CTY_PRINT
  BOOKINGS
  BKGSPN
  BKGS3
  NEW_ROOM_RATE
  NEW_STD_RATE
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  CHAIN_WIDE
  RAMT
  RNGT
  RBOOK
  PBOOK
  SAVINGS	
  ROOM_AMT
  TOTAL_STD
  TOTAL_SLSAV
  NMBR_DAYS
BY CTY_VALUE 
ON TABLE HOLD
RUN
FILE JHOLD
SUM TNROOMS TBOOK TNROOMS1 TBOOK1
BY CTY_VALUE
AFTER MATCH HOLD AS JHOLD1 OLD-OR-NEW
END
-RUN


TABLE FILE JHOLD1
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
BY CTY_VALUE
BY CTY_PRINT
BY CHAIN_WIDE
ON TABLE HOLD AS XTHREE FORMAT FOCUS
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HNK=&HLDPATH || 'HOLD7.FOC';
-SET &HNORNK=&HLDPATH || 'XTHREE.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD
&HNK AS HOLD7
&HNORNK AS HOLD7
END
-RUN

TABLE FILE HOLD7
SUM  BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VALUE
BY CTY_PRINT
WHERE CHAIN_WIDE NE 'NON-PREFERRED'
ON TABLE HOLD AS HOLDPREF 
END
-RUN

MATCH FILE HOLD7
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    CHAIN_WIDE
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
BY CTY_VALUE
BY CTY_PRINT
ON TABLE HOLD
RUN
FILE HOLDPREF
SUM PAVG 
BY CTY_VALUE
BY CTY_PRINT
AFTER MATCH HOLD AS HOLD8 OLD-OR-NEW
END
-RUN

DEFINE FILE HOLD8
PAVG1/D12.2 = IF CHAIN_WIDE NE 'NON-PREFERRED' THEN 0 ELSE PAVG;
TNROOMS2/P12 = IF NNROOMSPN GT TNROOMS1 THEN 0 ELSE TNROOMS1;
TBOOK2/P12 = IF BKGSPN GT TBOOK1 THEN 0 ELSE TBOOK1;
FLAG/A1 = 'A';
END


TABLE FILE HOLD8
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    NMBR_DAYS
    PAVG
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE ROOM_AMT/NMBR_DAYS; 
COMPUTE NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE PAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE PCTNBRN/D12.2 = IF ((TNROOMS2 LT 1) AND (TNROOMS2 GT (-1))) THEN 0 ELSE ((NNROOMSPN/TNROOMS2)*100);
COMPUTE PCTPBK/D12.2 = IF ((TBOOK2 LT 1) AND (TBOOK2 GT (-1))) THEN 0 ELSE ((BKGSPN/TBOOK2)*100);
COMPUTE PCTRBK/D12.2 = IF ((PBOOK LT 1) AND (PBOOK GT (-1))) THEN 0 ELSE ((RBOOK/PBOOK)*100);
COMPUTE LSV/P12.2C= IF NAVG2-PAVG1 LE 0 THEN 0 ELSE
                    IF(PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)*NPREF_NGT);
VARAVG/D12.2 = IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)/NAVG2)*100;
BY FLAG
BY CTY_VALUE
BY CTY_PRINT
BY CHAIN_WIDE
ON TABLE HOLD AS HLDONE FORMAT FOCUS
END
-RUN


DEFINE FILE HOLD7
CTY_VAL/A35 = 'GRAND TOTAL';
CTY_P/A12 = ' ';
END
-RUN
TABLE FILE HOLD7
SUM  BKGSPN AS 'TBKGSJ' NNROOMSPN AS 'TNRMSPNJ'
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
BY CTY_VAL 
BY CTY_P 
-* WHERE CHAIN_WIDE NE 'PREFERRED'
ON TABLE HOLD AS HOLDPREFT 
END
-RUN

DEFINE FILE HOLD7
CTY_VAL/A35 = 'GRAND TOTAL';
CTY_P/A12 = ' ';
END
-RUN

TABLE FILE HOLD7
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK    
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
BY CTY_VAL
BY CTY_P
BY CHAIN_WIDE
ON TABLE HOLD AS HOLD7T
END
-RUN



MATCH FILE HOLD7T
PRINT BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    CHAIN_WIDE
    RAMT
    RNGT
    RBOOK
    PBOOK    
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV  
    TNROOMS
    TNROOMS1
    TBOOK
    TBOOK1
    NMBR_DAYS
BY CTY_VAL
BY CTY_P
ON TABLE HOLD
RUN
FILE HOLDPREFT
SUM PAVG TBKGSJ TNRMSPNJ
BY CTY_VAL
BY CTY_P
AFTER MATCH HOLD AS HOLD8T OLD-OR-NEW
END
-RUN



DEFINE FILE HOLD8T
PAVG1/D12.2 = IF CHAIN_WIDE NE 'NON-PREFERRED' THEN 0 ELSE PAVG;
TNROOMS2/D12 = IF NNROOMSPN GT TNROOMS1 THEN 0 ELSE TNRMSPNJ;
TBOOK2/D12 = IF BKGSPN GT TBOOK1 THEN 0 ELSE TBKGSJ;
FLAG/A1 = 'C';
CTY_VALUE/A35 = 'GRAND TOTAL';
CTY_PRINT/A12 = ' ';

END

TABLE FILE HOLD8T
SUM BOOKINGS
    BKGSPN
    BKGS3
    NEW_ROOM_RATE
    NEW_STD_RATE
    NEW_TOTAL_AMT
    NNROOMS	
    NNROOMSPN
    NNROOMS3
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    RAMT
    RNGT
    RBOOK
    PBOOK    
    SAVINGS	
    ROOM_AMT
    TOTAL_STD
    TOTAL_SLSAV
    NMBR_DAYS
    PAVG
COMPUTE AVGAMT/D12.2=IF (ROOM_AMT LT 0) AND (NMBR_DAYS LT 0)
THEN ((ROOM_AMT/NMBR_DAYS)*(-1)) ELSE IF ((NMBR_DAYS LT 1)
AND (NMBR_DAYS GT (-1))) THEN 0 ELSE ROOM_AMT/NMBR_DAYS; 
COMPUTE NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT; 
COMPUTE PAVG2/P12.2 = IF ((PREF_NGT LT 1) AND
(PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT; 
COMPUTE PCTNBRN/D12.3 = IF ((TNROOMS2 LT 1) AND (TNROOMS2 GT (-1))) THEN 0 ELSE
((NNROOMSPN/TNROOMS2)*100);
COMPUTE PCTPBK/D12.2 = IF ((TBOOK2 LT 1) AND (TBOOK2 GT (-1))) THEN 0 ELSE ((BKGSPN/TBOOK2)*100);
COMPUTE PCTRBK/D12.2 = IF ((PBOOK LT 1) AND (PBOOK GT (-1))) THEN 0 ELSE ((RBOOK/PBOOK)*100);
COMPUTE LSV/P12.2C= IF NAVG2-PAVG1 LE 0 THEN 0 ELSE
                    IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)*NPREF_NGT);
VARAVG/D12.2 = IF (PAVG1 EQ 0) THEN 0 ELSE ((NAVG2-PAVG1)/NAVG2)*100;

BY FLAG
BY CTY_VALUE
BY CTY_PRINT
BY CHAIN_WIDE
ON TABLE HOLD AS HLDTWO FORMAT FOCUS
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK=&HLDPATH || 'HLDONE.FOC';
-SET &HNORANK=&HLDPATH || 'HLDTWO.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD
&HRANK AS HLDONE
&HNORANK AS HLDONE
END
-RUN

-GOTO JOY

TABLE FILE HLDONE
PRINT *
ON TABLE HOLD AS HLDMOD FORMAT FOCUS
END
-RUN


TABLE FILE HLDMOD
PRINT FOCLIST 
BY FOCLIST NOPRINT
WHERE FLAG EQ 'C'
ON TABLE HOLD AS HHLDFIX
END
-RUN

MODIFY FILE HLDMOD
FIXFORM FROM HHLDFIX
MATCH FOCLIST
ON MATCH COMPUTE PCTNBRN=100.00;
ON MATCH UPDATE PCTNBRN
ON NOMATCH REJECT
DATA ON HHLDFIX
END
-RUN

-JOY

DEFINE FILE HLDONE
NOWTOD/A8 WITH CTY_VALUE = HHMMSS (NOWTOD);
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN


TABLE FILE HLDONE
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
-*
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
   

-SET &FTR_AddlLines = 6;
FOOTING BOTTOM
"</2>"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS = NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-*
-INCLUDE FOOTERSM
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT

ON TABLE SET STYLE *

-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;


-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE
-*
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-*

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3M

EX REPORT_3

-SKIP_R3M
-GOTO XXIT;



-XXIT;
