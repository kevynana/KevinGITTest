-* File DELDATA.FEX
-* THIS PROGRAM DELETES DATA FOR A CERTAIN TIME PERIOD FROM
-* AIR, CAR, HOTEL, SEGMENT, MARKET, DESTINATION, TKT_MAIN
-*
-INCLUDE SETECHO
SST ASNAMES = ON
-* The date range in this file should be the date range you want to delete

TABLE FILE S_WOODW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR TRN_DATE
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AIR_KEY CONTAINS DP010454 OR DP999839  OR DP999857 OR DP999887  OR DP999896  
WHERE (TRN_DATE GE '2012/01/01') AND (TRN_DATE LE '2013/12/31')
ON TABLE HOLD AS SHOLD
END
-RUN
 

-* The date range in this file is all other data outside of the data being deleted above

TABLE FILE S_WOODW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AIR_KEY CONTAINS DP010454 OR DP999839  OR DP999857 OR DP999887  OR DP999896  
WHERE (TRN_DATE GE '2012/01/01') AND (TRN_DATE LE '2013/12/31')
ON TABLE HOLD AS SHOLD2
END
-RUN

-* Match these two files together getting everything in the original file that is not in the new file 

MATCH FILE SHOLD
PRINT AIR_KEY TRN_DATE
BY AIR_KEY NOPRINT
RUN
FILE SHOLD2
PRINT AIR_KEY
BY AIR_KEY NOPRINT
AFTER MATCH HOLD AS SHOLD3 OLD-NOT-NEW
END
-RUN

TABLE FILE SHOLD3
SUM TRN_DATE
BY AIR_KEY
ON TABLE HOLD AS SHOLD4
END
-RUN

TABLE FILE SHOLD4
PRINT AIR_KEY 
BY AIR_KEY NOPRINT
ON TABLE HOLD AS SHOLD5
END
-RUN



-* AIR_MAIN
MODIFY FILE A_WOODW
FIXFORM FROM SHOLD5
MATCH AIR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON SHOLD5
END
-RUN

-* TKT_MAIN
MODIFY FILE T_WOODW
FIXFORM FROM SHOLD5
MATCH AIR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON SHOLD5
END
-RUN

-* SEGMENT
MODIFY FILE S_WOODW
FIXFORM FROM SHOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON SHOLD
END
-RUN

TABLE FILE M_WOODW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AIR_KEY CONTAINS DP010454 OR DP999839  OR DP999857 OR DP999887  OR DP999896  
IF TRN_DATE GE '2012/01/01'
IF TRN_DATE LE '2013/12/31'
ON TABLE HOLD AS MHOLD
END
-RUN

-* MARKET
MODIFY FILE M_WOODW
FIXFORM FROM MHOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON MHOLD
END
-RUN

TABLE FILE D_WOODW
PRINT AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
BY AIR_KEY NOPRINT
BY EMBARK NOPRINT
BY ROUTE NOPRINT
BY TKT_SORT NOPRINT
BY SEG_NBR NOPRINT
IF AIR_KEY CONTAINS DP010454 OR DP999839  OR DP999857 OR DP999887  OR DP999896  
IF TRN_DATE GE '2012/01/01'
IF TRN_DATE LE '2013/12/31'
ON TABLE HOLD AS DHOLD
END

-* DESTINATION
MODIFY FILE D_WOODW
FIXFORM FROM DHOLD
MATCH AIR_KEY EMBARK ROUTE TKT_SORT SEG_NBR
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON DHOLD
END
-RUN

-* CAR

TABLE FILE C_WOODW
PRINT CAR_KEY
BY CAR_KEY NOPRINT
IF CAR_KEY CONTAINS DP010454 OR DP999839  OR DP999857 OR DP999887  OR DP999896  
IF INVOICE_DATE GE '2012/01/01'
IF INVOICE_DATE LE '2013/12/31'
ON TABLE HOLD AS CHOLD
END
-RUN

MODIFY FILE C_WOODW
FIXFORM FROM CHOLD
MATCH CAR_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON CHOLD
END

-* HOTEL

TABLE FILE H_WOODW
PRINT HTL_KEY
BY HTL_KEY NOPRINT
IF HTL_KEY CONTAINS DP010454 OR DP999839  OR DP999857 OR DP999887  OR DP999896  
IF INVOICE_DATE GE '2012/01/01'
IF INVOICE_DATE LE '2013/12/31'
ON TABLE HOLD AS HHOLD
END
-RUN

 

MODIFY FILE H_WOODW
FIXFORM FROM HHOLD
MATCH HTL_KEY
ON MATCH DELETE
ON NOMATCH REJECT
DATA ON HHOLD
END
-RUN

-EXIT
