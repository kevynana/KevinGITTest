-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AVIW23EX.FEX
-********************************************************************
-* MODIFICAIONS:
-********************************************************************
-*
-* This program extracts data for the series of basic ticket listing
-* reports.  Based on the user profile selected, one of many report
-* formats will be produced.  
-* 12/29/04 - DEB - ADDED FILEDEF FOR FUJI REPORT - DEB
-* 1/25/05  - DEB - ADDED CODE FOR GLOBAL CURRENCY
-* 8/29/05  - DEB - ADDED BDGA_DPT DEFINE
-*3/2/16 - JEM -S-16367 Updated hard coded d:\ to use &&WFSRV1.EVAL
-*04/03/2017  - DLV - S-32239 - Added AROLL_LEV3
-******************************************************************** 
 
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN


FI FUJILIST DISK &&WFSRV1.EVAL\TNT\TTRACKER\TEMP\FUJILIST.TXT

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
  MTG_CODE/A2=EDIT(CLIENT_NUM, '99'); 
  LEVEL_DESC/A60 = &&LDESC;
  BDGA_DPT/A3 = EDIT(LEVEL1, '999$$$$$$$$$$$$'); 
  NEW_SEG_TAX/D12.2CS = SEG_TAX;
END
-RUN

TABLEF FILE &&EXTRACT
PRINT 
  AIR_KEY	
  AIRLINE
  AROLL_LEV3
  BDGA_DPT
  BR_CL_IDX	
  CLASS	
  DOC_TYPE	
  DOD_TYPE
  DOD_DESC
  DPT_DATE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE	
  GRAND_MSTR_CODE	
  GROUP_CODE
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL_DESC
  MTG_CODE	
  MSTR_GRP_CODE	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  REFUSE_KEY	
  RESV_BRANCH	
  RF_FLAG
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX
  TKT_DATE 	
  TKT_NUM
  TRN_DATE	
  VAL_AIRLINE	
  VOID_DATE 	
  VOID_STATUS 
  NEW_SEG_TAX

-INCLUDE &AIRDATES

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10


-INCLUDE RPTPARMS

ON TABLE HOLD AS RPTHOLD
END
-RUN

TABLE FILE RPTHOLD
PRINT AIR_KEY	
  AIRLINE
  AROLL_LEV3
  BDGA_DPT
  BR_CL_IDX	
  CLASS	
  DOC_TYPE	
  DOD_TYPE
  DOD_DESC
  DPT_DATE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE	
  GRAND_MSTR_CODE	
  GROUP_CODE
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL_DESC
  MTG_CODE	
  MSTR_GRP_CODE	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  REFUSE_KEY	
  RESV_BRANCH	
  RF_FLAG
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX
  TKT_NUM
  TRN_DATE	
  VAL_AIRLINE	
  VOID_DATE 	
  VOID_STATUS
  NEW_SEG_TAX
BY TKT_DATE 
ON TABLE HOLD AS AIRHOLD FORMAT FOCUS INDEX TKT_DATE
END
-RUN

-* Global Reporting JOIN
JOIN AIRHOLD.TKT_DATE IN AIRHOLD TO GLOBAL.DATE IN GLOBAL AS J1


DEFINE FILE AIRHOLD
NAMEC/A30 = CNAME;

-******************************************************************************
-*                         Global Currency Conversion Defines
-******************************************************************************
CURR1X/D20.6 = 1 / USDPU ;

-* DEFINES ON PREVIOUS DEFINES
GSEG_TAX/D20.6 = SEG_TAX * CURR1X;
GSEG_AMT/D20.6 = SEG_AMT * CURR1X;
GSEG_COM/D20.6 = SEG_COM * CURR1X;

END
-RUN  	 


TABLE FILE AIRHOLD
PRINT AIR_KEY	
  AIRLINE
  AROLL_LEV3
  BDGA_DPT
  BR_CL_IDX	
  CLASS	
  DOC_TYPE	
  DOD_TYPE
  DOD_DESC
  DPT_DATE	
  EMBARK	
  EX_FLAG	
  EXCHG_SALE	
  GRAND_MSTR_CODE	
  GROUP_CODE
  INVOICE_NUM	
  LEVEL1	
  LEVEL2	
  LEVEL3
  LEVEL_DESC
  MTG_CODE	
  MSTR_GRP_CODE	
  ONLINE_TRADITIONAL
  PASSNGR_NAME	
  REFUSE_KEY	
  RESV_BRANCH	
  RF_FLAG
  SEG_AMT	
  SEG_COM	
  SEG_COUNT
  SEG_NBR 	
  SEG_TAX
  TKT_DATE
  TKT_NUM
  TRN_DATE	
  VAL_AIRLINE	
  VOID_DATE 	
  VOID_STATUS
  NAMEC
  GSEG_AMT/D16.2CS
  GSEG_TAX/D16.2CS
  GSEG_COM/D16.2CS
  NEW_SEG_TAX
WHERE GLOBAL.COUNTRYCODE EQ '&&CURRENCY'
ON TABLE HOLD AS &&RPT_HOLD
END
-RUN   	

-*-EXIT


