-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO

SET ASNAMES=ON





TABLEF FILE TPMPYR
PRINT AIR_LINE 
    AIRLINE_NAME
    P1CNT
    P1FARE     
    XTRANMY
    TRNM_FLAG
    TRN_DATE
BY TRAN_MY    
BY CP_AIRLINE
WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL)
ON TABLE HOLD AS HOLD1
END
-RUN











DEFINE FILE HOLD1 
  AIRSELECT/A3 = IF ('&&AIR1' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT2/A3 =IF ('&&AIR2' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT3/A3 =IF ('&&AIR3' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT4/A3 =IF ('&&AIR4' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT5/A3 =IF ('&&AIR5' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  
END
-RUN


TABLE FILE HOLD1
SUM P1CNT
    P1FARE      
    XTRANMY     
    TRNM_FLAG
    AIRLINE_NAME
BY AIRSELECT NOPRINT
BY AIRSELECT2 NOPRINT
BY AIRSELECT3 NOPRINT
BY AIRSELECT4 NOPRINT
BY AIRSELECT5 NOPRINT
BY CP_AIRLINE
BY TRAN_MY


-**** Start - WHERE statement to test Flown Airlines selected *****************
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' ' 
- AND &&AIR5 NE ' ' THEN GOTO WHEREAIR5 ELSE GOTO CHKAIR4;

-WHEREAIR5
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' OR '&&AIR5'
-GOTO CHKDONE;

-CHKAIR4
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- THEN GOTO WHEREAIR4 ELSE GOTO CHKAIR3;

-WHEREAIR4
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' 
-GOTO CHKDONE;

-CHKAIR3
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' 
- THEN GOTO WHEREAIR3 ELSE GOTO CHKAIR2;

-WHEREAIR3
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3'
-GOTO CHKDONE;

-CHKAIR2
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' THEN GOTO WHEREAIR2 ELSE GOTO CHKAIR1;
-WHEREAIR2
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' 
-GOTO CHKDONE;

-CHKAIR1
-IF &&AIR1 EQ ' '  THEN GOTO CHKDONE;
-WHEREAIR1
WHERE CP_AIRLINE EQ '&&AIR1' 

-CHKDONE
-**** End - WHERE statement to test Flown Airlines selected *******************

ON TABLE HOLD AS CPHOLD1 
END
-RUN

DEFINE FILE CPHOLD1
FLAG/A1 = 'A';
END

TABLE FILE CPHOLD1
SUM P1CNT
    P1FARE     
    XTRANMY
    TRNM_FLAG
BY FLAG
BY AIRLINE_NAME
BY CP_AIRLINE
BY TRAN_MY
ON TABLE HOLD AS CPHOLD2 FORMAT FOCUS
END
-RUN

DEFINE FILE HOLD1
AIRLINE_NAME/A12 = 'ALL AIRLINES';
CP_AIRLINE/A3 = 'ZZZ';
FLAG/A1 = 'B';
END
TABLE FILE HOLD1
SUM P1CNT
    P1FARE     
    XTRANMY
    TRNM_FLAG
BY FLAG
BY AIRLINE_NAME
BY CP_AIRLINE
BY TRAN_MY
ON TABLE HOLD AS HOLD3 FORMAT FOCUS
END
-RUN



-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK1=&HLDPATH || 'CPHOLD2.FOC';
-SET &HRANK2=&HLDPATH || 'HOLD3.FOC';
-RUN

USE CLEAR *
-RUN

EX SUUSES
-RUN

USE ADD 
&HRANK1 AS CPHOLD2
&HRANK2 AS CPHOLD2
END
-RUN


TABLE FILE CPHOLD2
SUM XTRANMY
BY TRAN_MY
ON TABLE HOLD AS DEBHOLD
END
-RUN

TABLE FILE DEBHOLD
LIST *
ON TABLE HOLD AS DEBHOLD2
END
-RUN

 

TABLE FILE DEBHOLD2
PRINT LIST/I2 AS 'ROW_ORDER'
      XTRANMY/A8 AS 'ROW_LABEL'
BY TRAN_MY
ON TABLE HOLD AS DEBHOLD3
END
-RUN










DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Average Market Fare (Domestic)';
CAT_ORDER/I2 = 1;
END
-RUN

TABLE FILE DEBHOLD3
PRINT CATEGORY/A40 AND ROW_LABEL/A8 AND
CAT_ORDER/I2 AND ROW_ORDER/I2 AND TRAN_MY/MTYY 
ON TABLE HOLD AS DEBHOLD3A
END
-RUN

TABLE FILE DEBHOLD3A
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER AND TRAN_MY
ON TABLE HOLD AS DEBHOLD3B
END
MODIFY FILE SIMP_FAR
FIXFORM FROM DEBHOLD3B
MATCH CATEGORY ROW_LABEL ROW_ORDER TRAN_MY 
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DEBHOLD3B
END
-RUN


DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Dollar/PCT Variance over Previous Year';
CAT_ORDER/I2 = 2;
END
-RUN

TABLE FILE DEBHOLD3
PRINT CATEGORY/A40 AND XTRANMY/A8 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND ROW_ORDER/I2 AND TRAN_MY/MTYY
ON TABLE HOLD AS DEBHOLD3C
END
-RUN

TABLE FILE DEBHOLD3C
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER AND TRAN_MY
ON TABLE HOLD AS DEBHOLD3D
END
MODIFY FILE SIMP_FAR
FIXFORM FROM DEBHOLD3D
MATCH CATEGORY ROW_LABEL ROW_ORDER TRAN_MY
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DEBHOLD3D
END
-RUN


DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Cost/(Savings) over Previous Year';
CAT_ORDER/I2 = 3;
END
-RUN

TABLE FILE DEBHOLD3
PRINT CATEGORY/A40 AND XTRANMY/A8 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND ROW_ORDER/I2 AND TRAN_MY/MTYY
ON TABLE HOLD AS DEBHOLD3E
END
-RUN

TABLE FILE DEBHOLD3E
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER AND TRAN_MY
ON TABLE HOLD AS DEBHOLD3F
END
MODIFY FILE SIMP_FAR
FIXFORM FROM DEBHOLD3F
MATCH CATEGORY ROW_LABEL ROW_ORDER TRAN_MY
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DEBHOLD3F
END
-RUN

