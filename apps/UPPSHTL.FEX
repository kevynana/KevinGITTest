-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**


-* 7/13/05 - DEB - INCLUDED REFUSE_CD 'R' TO TOTAL_NON DEFINE
-*7/11/16 S-20630 DLV  Commented out EMP_ID define
-*4/26/2017-JEM-S-33318-updated logic for no records report

TABLE FILE CONTROL
PRINT SECURITY_LEVEL
BY ROLLUP_CODE
ON TABLE SAVE AS XROLL
END
-RUN
-READ XROLL &&RLUP.A8.

SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &HTLDATES = &&WEB_PATH || 'HTLDATES.fex';

DEFINE FILE &&EXTRACT
-*  EMP_ID/A9 = EDIT(LEVEL2,'999999999');
  LEVEL_DESC/A60  = &&LDESC;
  NBR_DAYS/D12=NUM_DAYS;
  NBR_ROOMS/D12 = NUM_ROOMS;
  NEW_TOTAL_AMT/D14.2C = TOTAL_AMT;
  NNROOMS/D12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN 
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
  REFUSE_CD/A2=EDIT(REFUSE_KEY,'$$$$$$$$99');
  PREF_NON/A15 = IF REFUSE_CD EQ 'A' THEN 'PREFERRED' ELSE 'NON-PREFERRED';
-* Defines on Previous Defines

  NPREF_AMT/D12.2 = IF PREF_NON EQ 'NON-PREFERRED' THEN TOTAL_AMT ELSE 0;
  NPREF_NGT/D12CS = IF PREF_NON EQ 'NON-PREFERRED' THEN NNROOMS ELSE 0;
  PREF_AMT/D12.2 = IF PREF_NON EQ 'PREFERRED' THEN TOTAL_AMT ELSE 0;
  PREF_NGT/D12CS = IF PREF_NON EQ 'PREFERRED' THEN NNROOMS ELSE 0;
 XPSNGR_NM/A15        = 
  EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
END
-RUN

TABLEF FILE &&EXTRACT
PRINT AROLL_LEV4
      LEVEL_DESC
      EMP_ID 
      NNROOMS 
      NEW_TOTAL_AMT
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      PASSNGR_NAME
      XPSNGR_NM
-INCLUDE &HTLDATES
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS HTLHOLD
END
-RUN

TABLE FILE HTLHOLD
SUM AROLL_LEV4
      NNROOMS 
      NEW_TOTAL_AMT
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      LEVEL_DESC
      PASSNGR_NAME
COMPUTE NPANR/D9.2CS=IF ((NPREF_NGT LT 1) AND
       (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;       
BY EMP_ID
ON TABLE HOLD AS HTLHOLD2
END
-RUN


TABLE FILE HTLHOLD2
SUM PREF_AMT AS 'TPRFAMT'
    PREF_NGT AS 'TPRFNGT'
BY AROLL_LEV4
ON TABLE HOLD AS HTLHOLD3
END
-RUN

TABLE FILE HTLHOLD3
SUM TPRFAMT
    TPRFNGT
COMPUTE TPANR/D9.2CS=IF ((TPRFNGT LT 1) AND
       (TPRFNGT GT (-1))) THEN 0 ELSE TPRFAMT/TPRFNGT;     
BY AROLL_LEV4
ON TABLE HOLD AS HTLHOLD4
END
-RUN

MATCH FILE HTLHOLD2
PRINT EMP_ID
      LEVEL_DESC
      NNROOMS 
      NEW_TOTAL_AMT
      NPREF_AMT
      NPREF_NGT
      PREF_AMT
      PREF_NGT
      PASSNGR_NAME
      NPANR
BY AROLL_LEV4
ON TABLE HOLD
RUN
FILE HTLHOLD4
SUM TPRFAMT
    TPRFNGT
    TPANR
BY AROLL_LEV4
AFTER MATCH HOLD AS XTWO OLD-AND-NEW
END
-RUN

TABLE FILE XTWO
PRINT PASSNGR_NAME
    LEVEL_DESC
    NPANR
    NNROOMS 
    NEW_TOTAL_AMT
    NPREF_AMT
    NPREF_NGT
    PREF_AMT
    PREF_NGT
    TPRFAMT
    TPRFNGT
    TPANR
BY EMP_ID
ON TABLE HOLD AS UPPSAVH
END
-RUN


TABLE FILE UPPSAVH
PRINT NPREF_NGT
      PREF_NGT
      NPANR
      TPANR
      LEVEL_DESC
      PASSNGR_NAME
 BY EMP_ID
 ON TABLE HOLD AS UPPSH
 END
 -RUN


-SET &&HTLREC=IF &RECORDS EQ 0 THEN 'N' ELSE 'Y';

 