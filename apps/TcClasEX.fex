-* JK added code to select only tnt_company eq 1 or 2 2/21/05


-INCLUDE SETECHO
SET ASNAMES = ON

-*========================================================================
-*           PERFORM DATA EXTRACT FOR CLIENT DETERMINED
-*========================================================================
-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';

DEFINE FILE &&EXTRACT
CLASS_CAT/A15 = DECODE CL_CAT ('F' 'FIRST'     'P' 'PREMIUM ECONOMY'   
			        'D' 'DEFAULT'   'B' 'BUSINESS'
			        'E' 'ECONOMY'   'U'  'UPGRADE' 
                                ' ' 'DEFAULT'); 
COM_AMT/D12.2CS = SEG_COM;                             
FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
-*LEVEL_DESC/A60 = &&LDESC;
MRK_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
END

TABLEF FILE &&EXTRACT
PRINT 
  CLASS 
  CLASS_CAT
  COM_AMT
  FARE_PAID
  MRK_TKT_CNT
  VAL_AIR.AIRLINE_NAME AS 'VALAIR'
-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
&&WHERE5
&&WHERE6
&&WHERE7
&&WHERE8
&&WHERE9
&&WHERE10
-INCLUDE RPTPARMS
ON TABLE HOLD AS TC_MRK 
END
-RUN


-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACTED DATA FROM ABOVE
-*========================================================================
DEFINE FILE TC_MRK
ROLLCD/A8 = '&&ROLL';
NMB/I5    = NMB + 1;
END
TABLE FILE TC_MRK
SUM FARE_PAID
    MRK_TKT_CNT
    COM_AMT
BY ROLLCD
BY NMB
BY VALAIR
BY CLASS_CAT
ON TABLE HOLD AS TCM1 
END
-RUN

MODIFY FILE TCCLS
FIXFORM FROM TCM1
DATA ON TCM1
END
-RUN

-NEXTONE


