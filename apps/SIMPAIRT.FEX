-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-INCLUDE SETECHO

SET ASNAMES=ON

-SET &&NOCYREC = 'N'; 
-SET &&RCNT = 0;
 
TABLE FILE TPMPYR
SUM XTRANMY
BY TRAN_MY
WHERE CURRENT EQ 'Y'
ON TABLE HOLD AS DEBHOLD
END
-RUN

-SET &&NOCYREC = IF &RECORDS EQ 0 THEN 'Y' ELSE 'N';
-IF '&&NOCYREC.EVAL' EQ 'Y' THEN GOTO XXIT;

TABLE FILE DEBHOLD
LIST *
ON TABLE HOLD AS DEBHOLD2
END
-RUN

DEFINE FILE DEBHOLD2
XTRN_M/A3 = EDIT(XTRANMY, '999$$$$');
XTRN_Y/A4 = EDIT(XTRANMY, '$$$9999');
XTRN_MY/A8 = XTRN_M | ' ' | XTRN_Y;
END
TABLE FILE DEBHOLD2
PRINT LIST/I2 AS 'ROW_ORDER'
      XTRN_MY/A8 AS 'ROW_LABEL'
BY TRAN_MY
ON TABLE HOLD AS DEBHOLD3
END
-RUN

DEFINE FILE DEBHOLD2
CURM/A3 = EDIT(XTRANMY, '999');
CURM2/A5 =  '''' |CURM|'''';
END
TABLE FILE DEBHOLD2
PRINT CURM2
BY CURM2 NOPRINT
ON TABLE SAVE AS CURYR
END
-RUN

TABLE FILE DEBHOLD3
COUNT ROW_LABEL AS 'RCNT'
ON TABLE HOLD AS ROWCNT
END
-RUN

TABLE FILE ROWCNT
SUM RCNT/I5
ON TABLE SAVE AS ROWCNT1
END
-RUN

-READ ROWCNT1 NOCLOSE &RCNT.I5.
-RUN

-SET &&RCNT = &RCNT;

-CLOSE ROWCNT1

-SET &YTDLBL = &&TODT.EVAL;
-SET &YR = SUBSTR(10, &YTDLBL, 1, 4, 4, 'A4');
-SET &&RLBL = 'YTD' | ' ' | '&YR.EVAL';

DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Average Market Fare';
CAT_ORDER/I2 = 1;
END
TABLE FILE DEBHOLD3
PRINT CATEGORY/A40 AND ROW_LABEL/A8 AND
CAT_ORDER/I2 AND ROW_ORDER/I2 AND TRAN_MY/MTYY 
ON TABLE HOLD AS DEBHOLD3A
END
-RUN

TABLE FILE DEBHOLD3A
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER AND TRAN_MY
ON TABLE HOLD AS DEBHOLD3B
END
-RUN

MODIFY FILE SIMP_FAR
FIXFORM FROM DEBHOLD3B
MATCH CATEGORY ROW_LABEL ROW_ORDER TRAN_MY 
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DEBHOLD3B
END
-RUN

DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Average Market Fare';
ROW_LABEL/A8 = '&&RLBL.EVAL';
END
TABLE FILE DEBHOLD3
SUM CATEGORY TRAN_MY   
BY ROW_LABEL
ON TABLE HOLD AS DEBHOLD4
END
-RUN

DEFINE FILE DEBHOLD4
CAT_ORDER/I2 = 1;
END
TABLE FILE DEBHOLD4
PRINT CATEGORY/A40 AND ROW_LABEL/A8 AND CAT_ORDER
COMPUTE ROW_ORDER/I2 = 13;
ON TABLE HOLD AS YTDTTL
END
-RUN

TABLE FILE YTDTTL
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER
ON TABLE HOLD AS YTDTTL1
END
-RUN

MODIFY FILE SIMP_FAR
FIXFORM FROM YTDTTL1
MATCH CATEGORY ROW_LABEL ROW_ORDER
ON MATCH REJECT
ON NOMATCH INCLUDED
DATA ON YTDTTL1
END
-RUN

DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Dollar/PCT Variance over Previous Year';
CAT_ORDER/I2 = 2;
END
TABLE FILE DEBHOLD3
PRINT CATEGORY/A40 AND XTRN_MY/A8 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND ROW_ORDER/I2 AND TRAN_MY/MTYY
ON TABLE HOLD AS DEBHOLD3C
END
-RUN

TABLE FILE DEBHOLD3C
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER AND TRAN_MY
ON TABLE HOLD AS DEBHOLD3D
END
-RUN

MODIFY FILE SIMP_FAR
FIXFORM FROM DEBHOLD3D
MATCH CATEGORY ROW_LABEL ROW_ORDER TRAN_MY
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DEBHOLD3D
END
-RUN

DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Dollar/PCT Variance over Previous Year';
ROW_LABEL/A8 = '&&RLBL.EVAL';
END
TABLE FILE DEBHOLD3
SUM CATEGORY TRAN_MY   
BY ROW_LABEL
ON TABLE HOLD AS DEBHOLD5
END
-RUN

DEFINE FILE DEBHOLD5
CAT_ORDER/I2 = 2;
END
TABLE FILE DEBHOLD5
PRINT CATEGORY/A40 AND ROW_LABEL/A8 AND CAT_ORDER
COMPUTE ROW_ORDER/I2 = 13;
ON TABLE HOLD AS YTDTTL2
END
-RUN

TABLE FILE YTDTTL2
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER
ON TABLE HOLD AS YTDTTL3
END
-RUN

MODIFY FILE SIMP_FAR
FIXFORM FROM YTDTTL3
MATCH CATEGORY ROW_LABEL ROW_ORDER
ON MATCH REJECT
ON NOMATCH INCLUDED
DATA ON YTDTTL3
END
-RUN

DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Cost/(Savings) over Previous Year';
CAT_ORDER/I2 = 3;
END
TABLE FILE DEBHOLD3
PRINT CATEGORY/A40 AND XTRN_MY/A8 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND ROW_ORDER/I2 AND TRAN_MY/MTYY
ON TABLE HOLD AS DEBHOLD3E
END
-RUN

TABLE FILE DEBHOLD3E
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER AND TRAN_MY
ON TABLE HOLD AS DEBHOLD3F
END
-RUN

MODIFY FILE SIMP_FAR
FIXFORM FROM DEBHOLD3F
MATCH CATEGORY ROW_LABEL ROW_ORDER TRAN_MY
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DEBHOLD3F
END
-RUN

DEFINE FILE DEBHOLD3
CATEGORY/A40 = 'Cost/(Savings) over Previous Year';
ROW_LABEL/A8 = '&&RLBL.EVAL';
END
TABLE FILE DEBHOLD3
SUM CATEGORY TRAN_MY   
BY ROW_LABEL
ON TABLE HOLD AS DEBHOLD6
END
-RUN

DEFINE FILE DEBHOLD6
CAT_ORDER/I2 = 3;
END
TABLE FILE DEBHOLD6
PRINT CATEGORY/A40 AND ROW_LABEL/A8 AND CAT_ORDER
COMPUTE ROW_ORDER/I2 = 13;
ON TABLE HOLD AS YTDTTL4
END
-RUN

TABLE FILE YTDTTL4
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER AND
      ROW_ORDER
ON TABLE HOLD AS YTDTTL5
END
-RUN

MODIFY FILE SIMP_FAR
FIXFORM FROM YTDTTL5
MATCH CATEGORY ROW_LABEL ROW_ORDER
ON MATCH REJECT
ON NOMATCH INCLUDED
DATA ON YTDTTL5
END
-RUN

-XXIT;

