-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-*  
-*  
-* changed code of AB14DRSN to extract udid data in UD14DRSN
-* due to report taking too long to process - Deb 8/19/13
-* 10/8/13 - DEB - CHANGED CODE TO ENABLE ABRBTRSN TO RUN FASTER
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-* 2/27/15 - DEB S-07681 ADDED AB07DRSN ROUTINE
-*06/15/17 DLV S-35586 - Added new routine for FUTPTVLC


-*-INCLUDE CheckErrorRoutine
-* -INCLUDE SETECHO
-* File SMRYRPT.FEX
-**********************************************************************
-**********************************************************************

-INCLUDE SETECHO

SET ASNAMES = ON
-RUN

-IF &&SETF.EVAL EQ 'FUTPTVLC' THEN GOTO FUJI;
-IF &&SETF.EVAL EQ 'AB14DRSN' OR 'ABRBTRSN' OR 'AB07DRSN' OR 'FUTPTVLC' THEN GOTO SKIPit;
-INCLUDE RETUDID
-RUN

-IF &RECORDS EQ 0 THEN GOTO NOREC;

 
-SKIPit;
TABLE FILE &&RPT_HOLD
SUM 
    REF_EXCH_CNT AS 'TREX'
    FARE_PAID/D12.2CS AS 'TFARE'
    NET_TKT_CNT AS 'NTTKT'
BY LEVEL_DESC
ON TABLE HOLD AS HOLDONE
END
-RUN

TABLE FILE &&RPT_HOLD
PRINT AIR_KEY   
        AIRLINE
        AIRLINE_FEE 
        EXCHGS
        FARE_PAID
        IFLAG
        LEVEL_DESC      
        NET_TKT_CNT 
        IFLAG
        NEW_ADV_PURCH
BY LEVEL_DESC
ON TABLE HOLD AS TOPTVL2
END
-RUN


MATCH FILE TOPTVL2
PRINT  AIR_KEY
        AIRLINE
        AIRLINE_FEE 
        EXCHGS
        FARE_PAID
        IFLAG
        LEVEL_DESC      
        NET_TKT_CNT 
        IFLAG
        NEW_ADV_PURCH
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDONE
SUM TREX
    TFARE
    NTTKT
BY LEVEL_DESC
AFTER MATCH HOLD AS HOLD2 OLD-OR-NEW
END
-RUN



TABLE FILE HOLD2
PRINT AIR_KEY
      AIRLINE
      AIRLINE_FEE 
      EXCHGS
      FARE_PAID
      IFLAG
      LEVEL_DESC      
      NET_TKT_CNT 
      NTTKT
      TREX
      TFARE
      IFLAG
      NEW_ADV_PURCH
 BY AIR_KEY 
 ON TABLE HOLD AS AIRHOLD3 FORMAT FOCUS INDEX AIR_KEY
 END
 -RUN
-GOTO CONT:;

-FUJI

TABLE FILE &&RPT_HOLD
PRINT   
        AIRLINE
        AIRLINE_FEE
        AIRFEE_CNT	
        INTL_DOM
        BASE_FARE
        AR_BRANCH
        BR_CL_IDX
        CC_NUM
        EMB_APT_CD
        RTE_APT_CD	
        CLASS
        CLIENT_NUM	
        COMM_SEG
        EMB_CNTRY_CODE
        CPMILE	
        DISSAVINGS
        DPT_TIME
        EMBARK
        EMB_APT_NM	
        EMB_CTY_NM
        EMP_ID
        EXCHGS
        EX_RF_FLAG
        F_EXCH_CNT
        FARE_BAS		
        FARE_PAID
        IFLAG
        KILO
        LEVEL_DESC	
        LEVEL1	
        LEVEL2	
        LEVEL3
        MRK_TKT_CNT
        NET_COMM	
        NET_FARE	
        NET_TKT_CNT
        NEW_ADV_PURCH
        NEW_SEG_LOWEST
        NEW_SEG_MILES
        NEW_STAY
        NEW_TRIP_LENGTH
        P_EXCH_CNT
        PASSNGR_NAME
        PNR_LOCATOR
        REF_EXCH_CNT
        REF_EXCH_CNT2
        REFUSAL_DESC
        REFUSE_CODE
        RTE_APT_NM
        RTE_CTY_NM	
        SAVINGS	
        SEG_AMT	
        SEG_COUNT	
        SEG_DISCOUNT	
        SEG_LOWEST
        SEG_NBR	
        SEG_STANDARD	
        SEG_TAX	
        STAY
        TICKET_BRANCH	
        TKT_AMOUNT
        TKT_DATE	
        TKT_NUM	
        TKT_PURCH
        TKT_SORT
        TKT_TYPE	
        TOTAL_FARE	
        TRN_DATE
        VAL_AIRLINE	
        VASAVINGS
        XDPT_DT	
        XPSNGR_NM	
        XTRAN_DT
BY AIR_KEY
ON TABLE HOLD AS AIRHOLD1
END
-RUN
 

-GOTO FUJI_ORN;


 
-CONT:;


-IF '&&SETF.EVAL' EQ 'ABRBTRSN' THEN GOTO RBT;
-IF '&&SETF.EVAL' EQ 'PRGNMTG' THEN GOTO GN;
-IF '&&SETF.EVAL' EQ 'AB14DRSN' THEN GOTO 14DAY;
-IF '&&SETF.EVAL' EQ 'AB07DRSN' THEN GOTO 07DAY ELSE GOTO NextChk;

-RBT

EX UDRBTSM
-RUN

-IF &&NREC EQ 'Y' GOTO NOREC;

-GOTO Continue

-14DAY

EX UD14DRSN
-RUN
-GOTO Continue


-GN

EX UDPRGNSM
-RUN

-GOTO Continue

-07DAY

EX UD07DRSN
-RUN


 

-IF &&NREC EQ 'Y' THEN GOTO NOREC;
-GOTO Continue


-FUJI_ORN;

EX UDFUJIORN
-RUN
 


-NextChk;

 
-Continue

-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS 
-*                                  USED IN FOOTERSM
-**********************************************************************
DEFINE FILE AIRHOLD5 

NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
  PCTNETTKT/D8.1S=IF ((NTTKT LT 1) AND (NTTKT GT (-1))) THEN 0
                  ELSE ((NET_TKT_CNT/NTTKT)*100);
END

 
-IF '&&SETF.EVAL' NE 'ABRBTRSN' OR 'AB07DRSN' THEN GOTO NotThis;

-SET &&BREAKOPTION =  'ON LEVEL_DESC RECOMPUTE AS ''TOTAL FOR'' ';

-NotThis;

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE AIRHOLD5
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
   
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 

-INCLUDE FOOTERSM
 


 -* ON TABLE COLUMN-TOTAL
-*ON TABLE SET STYLE &&SMSTY
-**************************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT 
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-INCLUDE &&PASTYS

-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR 
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' GOTO SKIP_DRILL;
-INCLUDE &&DSTY

-SKIP_DRILL

ENDSTYLE


&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN

-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;

EX REPORT_3

-SKIP_R3
-GOTO XXIT

-NOREC
 
 

-* -SET &&RPTSUF=' ';
-* -TYPE &&RPTSUF
-* -INCLUDE SetParmtime
-* -RUN
-* -SET &&RPTSUF = 'MSG';
-* -TYPE &&RPTSUF
-* -INCLUDE FDEFRPTS

JOIN SET_KEY IN BRPTINST TO SET_KEY IN BRPT_SET AS J1
DEFINE FILE BRPTINST
  EMPTY/A35 = 'NO RECORDS FOUND FOR THIS SELECTION';
  NOWTOD/A8 WITH INST_KEY = HHMMSS (NOWTOD);
END
TABLE FILE BRPTINST
-INCLUDE HEADAIR
PRINT EMPTY AS 'REPORT,MESSAGE' 
BY ROLLUP_CODE AS 'ROLLUP,CODE'
BY RPT_NAME AS 'REPORT,NAME'
BY SELECT_LEV AS 'BREAK,LEVEL'
IF INST_KEY EQ &&IKEY
IF RECORDLIMIT EQ 1
-INCLUDE FOOTERDT
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET PAGE-NUM OFF
ON TABLE SET STYLE *
-INCLUDE &&DTSTY
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
END
-RUN


-XXIT



-*-*-EXIT




