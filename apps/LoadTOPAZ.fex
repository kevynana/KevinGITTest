-******************************************************************************
-* file:  LOADTOPAZ.FEX
-* 
-* load topaz data into a focus file TOPAZXF.FOC
-* 
-* SAVE AS file to tab delimited file from each worksheets (receive from topaz).  
-* The first sheet QTR DATA saved as TOPAZQTR.
-* The second sheet YTD DATA saved as TOPAZYTD.
-*
-* 07/27/15 - DEB - S-10299 COMMENTED OUT SET &ECHO=ALL

-******************************************************************************
-*-SET &ECHO=ALL;
-INCLUDE SETECHO
-*back up old topaz.foc file first
-SET &DIR = 'D:\TNT\TTRACKER\SYSTEM\DATA\';
-SET &SRC = &DIR | 'TOPAZ.FOC';
-SET &DST = &DIR | 'TOPAZ.FOC.BAK';
-DOS COPY &SRC &DST
-RUN
CREATE FILE TOPAZ
-RUN

DEFINE FILE TOPAZQTR
WORKSHEET/A3='QTR';
END

TABLE FILE TOPAZQTR
PRINT PERIOD DPRICE IPRICE CPRICE WORKSHEET
ON TABLE HOLD
END
-RUN

MODIFY FILE TOPAZ
FIXFORM FROM HOLD
MATCH PERIOD
  ON MATCH UPDATE DPRICE IPRICE CPRICE WORKSHEET
  ON NOMATCH INCLUDE
DATA ON HOLD
END
-RUN

DEFINE FILE TOPAZYTD
WORKSHEET/A3='YTD';
END
TABLE FILE TOPAZYTD
PRINT PERIOD DPRICE IPRICE CPRICE WORKSHEET
ON TABLE HOLD
END
-RUN

MODIFY FILE TOPAZ
FIXFORM FROM HOLD
MATCH PERIOD
  ON MATCH UPDATE DPRICE IPRICE CPRICE WORKSHEET
  ON NOMATCH INCLUDE
DATA ON HOLD
END
-RUN

-MTHLY
-SET &DIR = '&&WEBSRV.EVAL' | 'TNT\DBR\DBRDATA\';
-SET &SRC = &DIR | 'TOPAZM.FOC';
-SET &DST = &DIR | 'TOPAZM.FOC.BAK';
-DOS COPY &SRC &DST
-RUN
CREATE FILE TOPAZM
-RUN

DEFINE FILE TOPAZMTH
WORKSHEET/A3='MTH';
END

TABLE FILE TOPAZMTH
PRINT PERIOD DPRICE IPRICE CPRICE WORKSHEET
ON TABLE HOLD
END
-RUN

MODIFY FILE TOPAZM
FIXFORM FROM HOLD
MATCH PERIOD
  ON MATCH UPDATE DPRICE IPRICE CPRICE WORKSHEET
  ON NOMATCH INCLUDE
DATA ON HOLD
END
-RUN

-*NON FISCAL DATA
DEFINE FILE TOPAZNFD
WORKSHEET/A3='NFD';
END

TABLE FILE TOPAZNFD
PRINT PERIOD DPRICE IPRICE CPRICE WORKSHEET
ON TABLE HOLD
END
-RUN

MODIFY FILE TOPAZM
FIXFORM FROM HOLD
MATCH PERIOD
  ON MATCH UPDATE DPRICE IPRICE CPRICE WORKSHEET
  ON NOMATCH INCLUDE
DATA ON HOLD
END
-RUN