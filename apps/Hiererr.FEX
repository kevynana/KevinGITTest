-* 4/27/04  SAC   ADDED TRP_REF AND NHR_REF
-*======================================================================
-*          INTIALIZE DIALOGE MANAGER, AND GLOBAL VARIABLES
-*======================================================================
SET TEMPDIR=D:\FOCTEMP
SET MESSAGE=ON
SET WARNING=OFF
SET YRTHRESH=30
SET DEFCENT=19
SET ASNAMES=ON


FI CUSTS DISK D:\LOAD\FOCTEMP\CUSTS.DAT

CREATE FILE RPTERR

-RUN
-*=======================================================================
-*                     GET COMPANY FOR DATA PROCESSING
-*=======================================================================
-TOP
DEFINE FILE ROLLUP
XL01/MDYY = &MDYY;
XL02/I8MDYY=XL01;
XL03/A8MDYY=EDIT(XL02);
XL04/A8=XL03;
XL05/A2=EDIT(XL04,'99$$$$$$');
XL06/A4=EDIT(XL04,'$$$$9999');
XL07/A3=IF XL05 EQ '01' THEN 'DEC' ELSE
        IF XL05 EQ '02' THEN 'JAN' ELSE
        IF XL05 EQ '03' THEN 'FEB' ELSE
        IF XL05 EQ '04' THEN 'MAR' ELSE
        IF XL05 EQ '05' THEN 'APR' ELSE
        IF XL05 EQ '06' THEN 'MAY' ELSE
        IF XL05 EQ '07' THEN 'JUN' ELSE
        IF XL05 EQ '08' THEN 'JUL' ELSE
        IF XL05 EQ '09' THEN 'AUG' ELSE
        IF XL05 EQ '10' THEN 'SEP' ELSE
        IF XL05 EQ '11' THEN 'OCT' ELSE
        IF XL05 EQ '12' THEN 'NOV' ;
XL08/A7=XL07||XL06;
XL09/A2='50';
XL10/A16 = ' ' ;
XL11/A40 = ' ' ;
XL12/A60 = ROLLUP_ORG ;
DT01/YYMD = &YMD ;
DT02/YM   = DT01 ;
DT03/YM   = DT02 - 1;
DT04/YYMD = DT03;
DT05/YYMD = DT02;
DT06/YYMD = DT05 - 1;

END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT QTR_ENABLE
      XL10
      XL11
      XL12
      RKEY_LEN
      COMP
      XL08
      XL09
      DT04
      DT06
BY ROLLUP_CODE
IF UPD_ENABLE NE ' '
IF RECORDLIMIT EQ 1
IF PR_STAMP NE 'R'
ON TABLE SAVE AS CUSTS
END
-RUN
-IF &RECORDS EQ 0 GOTO STOP ;
-RUN
-READ CUSTS &&RUP.A8. &&QTR_EN.A1. &&R_TAG.A16. &&R_ID.A40. &&R_ORG.A60.,
-,&&RKEY_LEN.A3. &&COMP.A6. &&DDX.A7. &&NLEN.A2. &&SDATE.A8. &&EDATE.A8.
-RUN
-*============================================================
-* DEFINE CITYPAIR FILE
-*============================================================
DEFINE FILE ROLLUP
XL01/A50='D:\TNT\TTRACKER\DATA\' ;
XL02/A8 = ' ' ;
XL03/A8='S_'||'&&COMP' ;
XL04/A79=XL01||XL03||'.FOC'||' AS '||' CITYPAIR' ;
-*============================================================
-* DEFINE CAR_MAIN FILE
-*============================================================
XL05/A50='D:\TNT\TTRACKER\DATA\' ;
XL06/A8 = ' ' ;
XL07/A8='C_'||'&&COMP' ;
XL08/A79=XL05||XL07||'.FOC'||' AS '||' CAR_MAIN' ;
-*============================================================
-* DEFINE CAR_MAIN FILE
-*============================================================
XL09/A50='D:\TNT\TTRACKER\DATA\' ;
XL10/A8 = ' ' ;
XL11/A8='H_'||'&&COMP' ;
XL12/A79=XL09||XL11||'.FOC'||' AS '||' HTL_MAIN' ;

XUSE1/A45 = EDIT(XL04,'999999999999999999999999999999999999999999999');
XUSE2/A45 = EDIT(XL08,'999999999999999999999999999999999999999999999');
XUSE3/A45 = EDIT(XL12,'999999999999999999999999999999999999999999999');
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT XUSE1
      XUSE2
      XUSE3
IF RECORDLIMIT EQ 1
IF ROLLUP EQ '&&RUP'
ON TABLE SAVE
END
-RUN
-READ SAVE &&AUSE.A45 &&CUSE.A45 &&HUSE.A45
-RUN
-*=======================================================================
-*                 CREATE DATA FILES FOR PROCESSING
-*=======================================================================
-SET &&COMP = &&COMP;
-SET &AH = 'D:\TNT\TTRACKER\DATA'|'AH'||&&COMP|||'.MAS' ;
-SET &AHM= 'D:\TNT\TTRACKER\DATA'|'AH'||&&COMP|||'.MAS' ;
-SET &A_ = 'D:\TNT\TTRACKER\DATA'|'A_'||&&COMP;
-SET &A_M= 'D:\TNT\TTRACKER\DATA'|'A_'||&&COMP|||'.MAS' ;
-SET &CH = 'D:\TNT\TTRACKER\DATA'|'AH'||&&COMP;
-SET &CHM= 'D:\TNT\TTRACKER\DATA'|'AH'||&&COMP|||'.MAS' ;
-SET &C_ = 'D:\TNT\TTRACKER\DATA'|'C_'||&&COMP;
-SET &C_M= 'D:\TNT\TTRACKER\DATA'|'C_'||&&COMP|||'.MAS' ;
-SET &D_ = 'D:\TNT\TTRACKER\DATA'|'D_'||&&COMP;
-SET &D_M= 'D:\TNT\TTRACKER\DATA'|'D_'||&&COMP|||'.MAS' ;
-SET &HH = 'D:\TNT\TTRACKER\DATA'|'AH'||&&COMP;
-SET &HHM= 'D:\TNT\TTRACKER\DATA'|'AH'||&&COMP|||'.MAS' ;
-SET &HP = 'D:\TNT\TTRACKER\DATA'|'HP'||&&COMP;
-SET &HPM= 'D:\TNT\TTRACKER\DATA'|'HP'||&&COMP|||'.MAS' ;
-SET &HX = 'D:\TNT\TTRACKER\DATA'|'HX'||&&COMP;
-SET &HXM= 'D:\TNT\TTRACKER\DATA'|'HX'||&&COMP|||'.MAS' ;
-SET &H_ = 'D:\TNT\TTRACKER\DATA'|'H_'||&&COMP;
-SET &H_M= 'D:\TNT\TTRACKER\DATA'|'H_'||&&COMP|||'.MAS' ;
-SET &M_ = 'D:\TNT\TTRACKER\DATA'|'M_'||&&COMP;
-SET &M_M= 'D:\TNT\TTRACKER\DATA'|'M_'||&&COMP|||'.MAS' ;
-SET &S_ = 'D:\TNT\TTRACKER\DATA'|'S_'||&&COMP;
-SET &S_M= 'D:\TNT\TTRACKER\DATA'|'S_'||&&COMP|||'.MAS' ;
-SET &DIR = 'COPY D:\DATA\'||&&COMP|||'\'||&&DDX|||'\'||'*.*';
-SET &CPY = &DIR||'D:\LOAD\AS400';
-SET &&MDIR = 'D:\EXECUTABLES\'||&&RUP|||'\'||&&DDX;
-SET &&FSET = '??'||&&COMP|||'.FOC' ;
-SET &&PUTF = 'D:\LOAD\DATA\'||&&FSET;
-RUN
-*=======================================================================
-*       SET-UP DIALOGE MANAGER & GLOBAL VARIABLES FOR PROGRAM
-*=======================================================================
-SET &&ROLLUP = &&RUP;
-SET &&QUARTERLY = '';
-SET &QUARTERLY1 = '';
-SET &&ROLLUP_TAG = &&R_TAG;
-SET &&ROLLUP_ID = &&R_ID;
-SET &&ROLLUP_ORG = &&R_ORG;
-SET &&RKEY_LEN = &&RKEY_LEN;
-SET &&AIR_PATH = 'D:\TNT\TTRACKER\DATA\' ;
-SET &&COM_PATH = 'D:\TNT\TTRACKER\DATA\' ;
-SET &&MKP_PATH = 'D:\AS400\';
-SET &&EXC_PATH = 'D:\TNT\TTRACKER\DATA\' ;
-SET &&HTL_PATH = 'D:\TNT\TTRACKER\DATA\' ;
-SET &&CAR_PATH = 'D:\TNT\TTRACKER\DATA\' ;
-SET &&SU_PATH  = 'D:\TNT\TTRACKER\SUDATA\';
-SET &&AIR_DB1 = 'A_' || &&COMP;
-SET &&SEG_DB1 = 'S_' || &&COMP;
-SET &&MRK_DB1 = 'M_' || &&COMP;
-SET &&DST_DB1 = 'D_' || &&COMP;
-SET &&CAR_DB  = 'C_' || &&COMP;
-SET &&CH_DB   = 'AH' || &&COMP;
-SET &&HTL_DB  = 'H_' || &&COMP;
-SET &&HH_DB   = 'AH' || &&COMP;
-SET &&HIER    = 'HP' || &&COMP;

-SET &QUARTERLY1 = IF &&QTR_EN NE ' ' THEN &&QUARTERLY ELSE ' ';
-SET &&AIR_DB2 = 'A9' || &QUARTERLY1 || &&COMP;
-SET &&SEG_DB2 = 'S9' || &QUARTERLY1 || &&COMP;
-SET &&MRK_DB2 = 'M9' || &QUARTERLY1 || &&COMP;
-SET &&DST_DB2 = 'D9' || &QUARTERLY1 || &&COMP;
-SET &&AH_DB = 'AH' || &&COMP;
-SET &&TRIG = 'CP_TRIG';
-SET &&ARFILE = 'AR_' || &&NLEN;
-SET &&AHFILE = 'AH_' || &&NLEN;
-SET &&HHFILE = 'HIER'|| &&NLEN;
-SET &&XXFILE = 'XHIER'||&&NLEN;
-SET &&CH_FILE= 'AH_' || &&NLEN;
-SET &&HH_FILE= 'AH_' || &&NLEN;
-SET &&USE_AIR = &&AIR_PATH || &&AIR_DB1|||'.FOC' ;
-SET &&USE_SEG = &&AIR_PATH || &&SEG_DB1|||'.FOC' ;
-SET &&USE_MRK = &&AIR_PATH || &&MRK_DB1|||'.FOC' ;
-SET &&USE_DST = &&AIR_PATH || &&DST_DB1|||'.FOC' ;
-SET &&USE_CAR = &&AIR_PATH || &&CAR_DB|||'.FOC' ;
-SET &&USE_CCH = &&AIR_PATH || &&CH_DB|||'.FOC' ;
-SET &&USE_HOT = &&AIR_PATH || &&HTL_DB|||'.FOC' ;
-SET &&USE_HHH = &&AIR_PATH || &&HH_DB|||'.FOC' ;
-SET &&USE_HPP = &&AIR_PATH || &&HIER|||'.FOC' ;

-*============================================================================
-*          GET DATABASE NAME TO USE FOR LOAD PROCESS
-*============================================================================
-SET &&AIRDATA = &&AIR_DB1 ;
-SET &&SEGDATA = &&SEG_DB1 ;
-SET &&MRKDATA = &&MRK_DB1 ;
-SET &&DSTDATA = &&DST_DB1 ;
-SET &&USE_HIER   = &&COM_PATH ||  &&HIER      ||'.FOC';
-SET &&USE_CLNT   = &&COM_PATH || 'CLIENT'     ||'.FOC';
-SET &&USE_AIRPRT = &&COM_PATH || 'AIRPORT'    ||'.FOC';
-SET &&USE_AIREMB = &&COM_PATH || 'EMBARPT'    ||'.FOC';
-SET &&USE_AIRRTE = &&COM_PATH || 'RTEARPT'    ||'.FOC';
-SET &&USE_AREF   = &&COM_PATH || 'AIR_REF'    ||'.FOC';
-SET &&USE_TREF   = &&COM_PATH || 'TRP_REF'    ||'.FOC';
-SET &&USE_NREF   = &&COM_PATH || 'NHR_REF'    ||'.FOC';
-SET &&USE_BRCH   = &&COM_PATH || 'BRANCH'     ||'.FOC';
-SET &&USE_ROLL   = &&SU_PATH  || 'ROLLUP'     ||'.FOC';
-SET &&USE_TTYP   = &&COM_PATH || 'TKT_TYPE'   ||'.FOC';
-SET &&USE_MRK    = &&COM_PATH || &&MRKDATA    ||'.FOC' ;
-SET &&USE_SEG    = &&COM_PATH || &&SEGDATA    ||'.FOC';
-SET &&USE_DST    = &&COM_PATH || &&DSTDATA    ||'.FOC' ;
-SET &&USE_CAR    = &&COM_PATH || &&CAR_DB     ||'.FOC';
-SET &&USE_CH     = &&COM_PATH || &&CH_DB      ||'.FOC';
-SET &&USE_BASEC  = &&COM_PATH || 'MKPCARA0'   ||'.FOC';
-SET &&USE_MKPCAR = &&MKP_PATH || 'TTPCARA0' ;
-SET &&CAR_EXC    = &&EXC_PATH || 'CAREXC.TXT' ||'.FOC';
-SET &&TCAR = 'TMPCAR';
-SET &&USE_HTL    = &&COM_PATH || &&HTL_DB     ||'.FOC';
-SET &&USE_HH     = &&COM_PATH || &&HH_DB      ||'.FOC';
-SET &&USE_HP     = &&COM_PATH || &&HIER       ||'.FOC';
-SET &&USE_BASEH  = &&COM_PATH || 'MKPHTLA0'   ||'.FOC';
-SET &&USE_MKPHTL = &&MKP_PATH || 'TTPHTLA0';
-SET &&HTL_EXC    = &&EXC_PATH || 'HTLEXC.TXT' ||'.FOC';
-SET &&THTL='TMPHTL';
-SET &&USE_THTL   = &&COM_PATH || &&THTL       ||'.FOC';
-SET &&USE_TCAR   = &&COM_PATH || &&TCAR       ||'.FOC';
-SET &&USE_TRIG   = &&COM_PATH || &&TRIG       ||'.FOC';
-SET &&USE_AH     = &&AIR_PATH || &&AH_DB      ||'.FOC';
-SET &&USE_HP     = &&AIR_PATH || &&HIER       ||'.FOC';
-SET &&USE_BASEA  = &&AIR_PATH || 'MKPAIRA0'   ||'.FOC';
-SET &&USE_BASES  = &&AIR_PATH || 'MKPSEGA0'   ||'.FOC';
-SET &&USE_BASEM  = &&AIR_PATH || 'MKPMRKA0'   ||'.FOC';
-SET &&USE_BASED  = &&AIR_PATH || 'MKPDSTA0'   ||'.FOC';
-SET &&USE_MKPAIR = &&MKP_PATH || 'TTPAIRA0' ;
-SET &&USE_MKPSEG = &&MKP_PATH || 'TTPSEGA0' ;
-SET &&USE_MKPMRK = &&MKP_PATH || 'TTPMRKA0' ;
-SET &&USE_MKPDST = &&MKP_PATH || 'TTPDSTA0' ;
-SET &&USE_MKPHTL = &&MKP_PATH || 'TTPHTLA0' ;
-SET &&AIR_EXC    = &&EXC_PATH || 'AIREXC.TXT';
-SET &&AUSEPASS   = &&COM_PATH || 'AUSEINCL.FTM';
-SET &&CUSEPASS   = &&COM_PATH || 'CUSEINCL.FTM';
-SET &&HUSEPASS   = &&COM_PATH || 'HUSEINCL.FTM';
-SET &&TSEG = 'TMPSEG';
-SET &&USE_TSEG   = &&COM_PATH || &&TSEG       ||'.FOC';

-RUN

USE CLEAR *
USE
  &&USE_AIR
  &&USE_SEG
  &&USE_MRK
  &&USE_DST
  &&USE_CAR
  &&USE_CCH
  &&USE_HOT
  &&USE_HHH
  &&USE_HPP
  &&USE_BASEA
  &&USE_BASES
  &&USE_BASEM
  &&USE_BASED
  &&USE_BASEC
  &&USE_BASEH
  &&USE_AH
  &&USE_AIR  AS &&ARFILE
  &&USE_AIR  AS AIR_MAIN
  &&USE_AH   AS &&AHFILE
  &&USE_HIER AS &&HHFILE
  &&USE_CH
  &&USE_CH   AS &&CH_FILE
  &&USE_HH   AS &&HH_FILE
  &&USE_HH   AS &&XXFILE
  &&USE_ROLL
  &&USE_TCAR
  &&USE_TSEG
  &&USE_SEG AS CITYSEG
  &&USE_SEG AS CITYPAIR
  &&USE_MRK AS CITYMRK
  &&USE_DST AS CITYDST
  &&AUSE
  &&CUSE
  &&HUSE
END
-RUN
-*========================================================================
-*                     CHECK FOR ERRORS IN AIR FILE
-*========================================================================
DEFINE FILE &&AH_DB
XL01/I6 = IF ROLL_KEY EQ ' ' OR '0' OR
       '00000000000000000000000000000000000000000000000000' THEN 1 ELSE 0 ;
XL02/A8 = '&&RUP' ;
XL03/MDYY = &MDY ;
XL04/A5 = 'AIR' ;
XL05/A5 = IF XL01 NE 0 THEN 'ERROR' ELSE 'OK' ;
END
TABLE FILE &&AH_DB
BY XL02 NOPRINT
SUM XL02 AS 'ROLLUP'
    XL04 AS 'CATEGORY'
    XL03 AS 'RDATE'
    XL05 AS 'STATUS'
    XL01 AS 'ECOUNT'
ON TABLE HOLD AS HOLD01
END
MODIFY FILE RPTERR
FIXFORM FROM HOLD01
MATCH ROLLUP
ON MATCH REJECT
ON NOMATCH INCLUDE
MATCH CATEGORY
ON MATCH UPDATE *
ON NOMATCH INCLUDE
DATA ON HOLD01
END

-*========================================================================
-*                     CHECK FOR ERRORS IN CAR FILE
-*========================================================================
DEFINE FILE &&CH_DB
XL01/I6 = IF ROLL_KEY EQ ' ' OR '0' OR
       '00000000000000000000000000000000000000000000000000' THEN 1 ELSE 0 ;
XL02/A8 = '&&RUP' ;
XL03/MDYY = &MDY ;
XL04/A5 = 'CAR' ;
XL05/A5 = IF XL01 NE 0 THEN 'ERROR' ELSE 'OK' ;
END
TABLE FILE &&CH_DB
BY XL02 NOPRINT
SUM XL02 AS 'ROLLUP'
    XL04 AS 'CATEGORY'
    XL03 AS 'RDATE'
    XL05 AS 'STATUS'
    XL01 AS 'ECOUNT'
ON TABLE HOLD AS HOLD02
END
MODIFY FILE RPTERR
FIXFORM FROM HOLD02
MATCH ROLLUP
ON MATCH CONTINUE
MATCH CATEGORY
ON MATCH UPDATE *
ON NOMATCH INCLUDE
DATA ON HOLD02
END
-*========================================================================
-*                     CHECK FOR ERRORS IN HOTEL FILE
-*========================================================================
DEFINE FILE &&HH_DB
XL01/I6 = IF ROLL_KEY EQ ' ' OR '0' OR
       '00000000000000000000000000000000000000000000000000' THEN 1 ELSE 0 ;
XL02/A8 = '&&RUP' ;
XL03/MDYY = &MDY ;
XL04/A5 = 'HOTEL' ;
XL05/A5 = IF XL01 NE 0 THEN 'ERROR' ELSE 'OK' ;
END
TABLE FILE &&HH_DB
BY XL02 NOPRINT
SUM XL02 AS 'ROLLUP'
    XL04 AS 'CATEGORY'
    XL03 AS 'RDATE'
    XL05 AS 'STATUS'
    XL01 AS 'ECOUNT'
ON TABLE HOLD AS HOLD03
END
MODIFY FILE RPTERR
FIXFORM FROM HOLD03
MATCH ROLLUP
ON MATCH CONTINUE
MATCH CATEGORY
ON MATCH UPDATE *
ON NOMATCH INCLUDE
DATA ON HOLD03
END
-*========================================================================
-*            STAMP CLIENT AS 'CHECKED' (TEMPORARY STAMP)
-*========================================================================
DEFINE FILE ROLLUP
XL01/A1 = 'R' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP XL01
IF RECORDLIMIT EQ 1
IF ROLLUP EQ '&&RUP'
ON TABLE HOLD AS HOLD04
END
MODIFY FILE ROLLUP
FIXFORM ROLLUP/8 PR_STAMP/1
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD04
END
-GOTO TOP
-RUN
-STOP
DEFINE FILE ROLLUP
XL01/A1 = ' ' ;
END
TABLE FILE ROLLUP
BY ROLLUP NOPRINT
PRINT ROLLUP XL01
IF PR_STAMP EQ 'R'
ON TABLE HOLD AS HOLD05
END
MODIFY FILE ROLLUP
FIXFORM ROLLUP/8 PR_STAMP/1
MATCH ROLLUP
ON MATCH UPDATE PR_STAMP
ON NOMATCH REJECT
DATA ON HOLD05
END
-RUN
DEFINE FILE RPTERR
STAT/A5 = IF ECOUNT GT 0 THEN 'FAIL' ELSE 'PASS' ;
END
TABLE FILE RPTERR
HEADING CENTER
"&DATE     eTTek Review ERROR CHECKING REPORT    &TOD"
"GLOBAL WIDE SYSTEM CHECK FOR INVALID HIERARCHY CODES"
" "
" "
BY ROLLUP     AS  'ROLLUP-CODE'
BY CATEGORY   AS  'DATA-CATEGORY'
SUM   RDATE   AS  'SCAN DATE'
      ECOUNT  AS  'ERROR-COUNT'
      STAT    AS  'STATUS'
IF STAT EQ 'FAIL'
ON ROLLUP UNDER-LINE SKIP-LINE
ON ROLLUP SUB-TOTAL AS '**TOTAL **'
ON TABLE COLUMN-TOTAL
END
USE CLEAR *
FILEDEF * CLEAR
