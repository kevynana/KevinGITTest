-* 5/29/13 - DEB CHANGED DIFF PCT TO BE CALCUATED FROM DIVIIDING BY PRIOR
-*           INSTEAD OF CURRENT

-SET ASNAMES = ON

-INCLUDE SETECHO

 

TABLE FILE HOLDONE
SUM CAVOL
    PAVOL
    LEVEL_DESC
    TRNY
BY TRNM
ON TABLE HOLD AS AIRTOT
END

TABLE FILE HTLHOLD
SUM MTTL_AMT
    YTTL_AMT
BY TRNM
ON TABLE HOLD AS HTLTOT
END
-RUN

TABLE FILE CARHOLD
SUM MRNTL_AMT
    YRNTL_AMT
BY TRNM
ON TABLE HOLD AS CARTOT
END
-RUN

MATCH FILE AIRTOT
PRINT CAVOL
      PAVOL
      LEVEL_DESC
      TRNY
BY TRNM
ON TABLE HOLD
RUN
FILE HTLTOT
SUM MTTL_AMT
    YTTL_AMT
BY TRNM
AFTER MATCH HOLD AS AIRCAR OLD-AND-NEW
END
-RUN

MATCH FILE AIRCAR
PRINT CAVOL
      PAVOL
      MTTL_AMT
      YTTL_AMT
      TRNY
      LEVEL_DESC
BY TRNM
ON TABLE HOLD
RUN
FILE CARTOT
SUM MRNTL_AMT
    YRNTL_AMT
BY TRNM
AFTER MATCH HOLD AS ACHTOT OLD-AND-NEW
END
-RUN

DEFINE FILE ACHTOT 
LABEL1/A40='Air/Hotel Car Expenditure';
END
TABLE FILE ACHTOT
SUM CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT 
    LABEL1
    TRNY
COMPUTE CTOT/D12.2 = CAVOL + MTTL_AMT + MRNTL_AMT;
COMPUTE PTOT/D12.2 = PAVOL + YTTL_AMT + YRNTL_AMT;
BY TRNM
ON TABLE HOLD AS ACHTOT1
END
-RUN

-*JAN

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'JAN'
ON TABLE HOLD AS JANTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO FEB;

DEFINE FILE JANTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE JANTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO' AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JANTOT1
END
-RUN

TABLE FILE JANTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM
ON TABLE HOLD AS JANTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JANTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO CURYR PRYR DIFF IDPERCENT TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JANTOT2
END
-RUN

-FEB

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'FEB'
ON TABLE HOLD AS FEBTOT
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO MAR;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB'
ON TABLE HOLD AS FEBYTD
END
-RUN
 
DEFINE FILE FEBTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE FEBTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS FEBTOT1 
END
-RUN

TABLE FILE FEBTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS FEBTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON FEBTOT2
END
-RUN

DEFINE FILE FEBYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE FEBYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS FEBYTD1
END
-RUN


TABLE FILE FEBYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS FEBYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM FEBYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON FEBYTD2
END
-RUN

-MAR

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'MAR'
ON TABLE HOLD AS MARTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO APR;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR'
ON TABLE HOLD AS MARYTD
END
-RUN
 
DEFINE FILE MARTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE MARTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MARTOT1 
END
-RUN

TABLE FILE MARTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MARTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MARTOT2
END
-RUN

DEFINE FILE MARYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE MARYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MARYTD1
END
-RUN

TABLE FILE MARYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS MARYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MARYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MARYTD2
END
-RUN

-APR

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'APR'
ON TABLE HOLD AS APRTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO MAY;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR'
ON TABLE HOLD AS APRYTD
END
-RUN
 
DEFINE FILE APRTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE APRTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS APRTOT1 
END
-RUN

TABLE FILE APRTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS APRTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON APRTOT2
END
-RUN

DEFINE FILE APRYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE APRYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS APRYTD1
END
-RUN

TABLE FILE APRYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS APRYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM APRYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON APRYTD2
END
-RUN

-MAY

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'MAY'
ON TABLE HOLD AS MAYTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO JUN;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY'
ON TABLE HOLD AS MAYYTD
END
-RUN
 
DEFINE FILE MAYTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE MAYTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MAYTOT1 
END
-RUN

TABLE FILE MAYTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS MAYTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON MAYTOT2
END
-RUN

DEFINE FILE MAYYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE MAYYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS MAYYTD1
END
-RUN

TABLE FILE MAYYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS MAYYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM MAYYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON MAYYTD2
END
-RUN

-JUN

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'JUN'
ON TABLE HOLD AS JUNTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO JUL;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN'
ON TABLE HOLD AS JUNYTD
END
-RUN
 
DEFINE FILE JUNTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE JUNTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JUNTOT1 
END
-RUN

TABLE FILE JUNTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JUNTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JUNTOT2
END
-RUN

DEFINE FILE JUNYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE JUNYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JUNYTD1
END
-RUN

TABLE FILE JUNYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS JUNYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JUNYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JUNYTD2
END
-RUN

-JUL
 
TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'JUL'
ON TABLE HOLD AS JULTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO AUG;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL'
ON TABLE HOLD AS JULYTD
END
-RUN
 
DEFINE FILE JULTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE JULTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JULTOT1 
END
-RUN

TABLE FILE JULTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS JULTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON JULTOT2
END
-RUN

DEFINE FILE JULYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE JULYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS JULYTD1
END
-RUN

TABLE FILE JULYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS JULYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM JULYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON JULYTD2
END
-RUN

-AUG
TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'AUG'
ON TABLE HOLD AS AUGTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO SEP;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG'
ON TABLE HOLD AS AUGYTD
END
-RUN
 
DEFINE FILE AUGTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE AUGTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS AUGTOT1 
END
-RUN

TABLE FILE AUGTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS AUGTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON AUGTOT2
END
-RUN

DEFINE FILE AUGYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE AUGYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS AUGYTD1
END
-RUN

TABLE FILE AUGYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS AUGYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM AUGYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON AUGYTD2
END
-RUN

-SEP
TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'SEP'
ON TABLE HOLD AS SEPTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO OCT;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP'
ON TABLE HOLD AS SEPYTD
END
-RUN
 
DEFINE FILE SEPTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE SEPTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS SEPTOT1 
END
-RUN

TABLE FILE SEPTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS SEPTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SEPTOT2
END
-RUN

DEFINE FILE SEPYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE SEPYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS SEPYTD1
END
-RUN

TABLE FILE SEPYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS SEPYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM SEPYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON SEPYTD2
END
-RUN

-OCT
TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'OCT'
ON TABLE HOLD AS OCTTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO NOV;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP' OR 'OCT'
ON TABLE HOLD AS OCTYTD
END
-RUN
 
DEFINE FILE OCTTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE OCTTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS OCTTOT1 
END
-RUN

TABLE FILE OCTTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS OCTTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON OCTTOT2
END
-RUN

DEFINE FILE OCTYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE OCTYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS OCTYTD1
END
-RUN

TABLE FILE OCTYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS OCTYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM OCTYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON OCTYTD2
END
-RUN

-NOV
TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'NOV'
ON TABLE HOLD AS NOVTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO DEC;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP' OR 'OCT' OR 'NOV'
ON TABLE HOLD AS NOVYTD
END
-RUN
 
DEFINE FILE NOVTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE NOVTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS NOVTOT1 
END
-RUN

TABLE FILE NOVTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS NOVTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON NOVTOT2
END
-RUN

DEFINE FILE NOVYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE NOVYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS NOVYTD1
END
-RUN

TABLE FILE NOVYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS NOVYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM NOVYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON NOVYTD2
END
-RUN

-DEC
TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNM
WHERE TRNM EQ 'DEC'
ON TABLE HOLD AS DECTOT
END
-RUN

-IF &LINES EQ 0 THEN GOTO XXITTOT;

TABLE FILE ACHTOT1
SUM LABEL1
    CAVOL
    PAVOL
    MTTL_AMT
    YTTL_AMT
    MRNTL_AMT
    YRNTL_AMT
    CTOT
    PTOT
    TRNM
COMPUTE TOTDIFF/D12.2C= CTOT - PTOT;
COMPUTE TOTPCT/D12C = IF PTOT EQ 0 THEN 0 ELSE (TOTDIFF/PTOT) * 100;
BY TRNY
WHERE TRNM EQ 'JAN' OR 'FEB' OR 'MAR' OR 'APR' OR 'MAY' OR 'JUN' OR 'JUL' OR 'AUG' OR 'SEP' OR 'OCT' OR 'NOV' OR 'DEC'
ON TABLE HOLD AS DECYTD
END
-RUN
 
DEFINE FILE DECTOT
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE DECTOT
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURMO' AND PTOT/D12M AS 
'PRMO'  AND TRNM/MT AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS DECTOT1 
END
-RUN

TABLE FILE DECTOT1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURMO AND PRMO AND TRANM
ON TABLE HOLD AS DECTOT2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECTOT2
MATCH CATEGORY ROW_LABEL ROW_ORDER CURMO PRMO TRANM
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON DECTOT2
END
-RUN

DEFINE FILE DECYTD
CATEGORY/A8 = 'TOTAL';
CAT_ORDER/I2 = 4;
END
TABLE FILE DECYTD
PRINT CATEGORY/A8 AND LABEL1/A40 AS 'ROW_LABEL' AND
CAT_ORDER/I2 AND CTOT/D12M AS 'CURYR' AND PTOT/D12M AS 'PRYR' AND
TOTDIFF/D12 AS 'DIFF' AND TOTPCT AS 'IDPERCENT' AND TRNM AS 'TRANM' AND
COMPUTE ROW_ORDER/I2 = 1;   
ON TABLE HOLD AS DECYTD1
END
-RUN

TABLE FILE DECYTD1
PRINT CATEGORY AND ROW_LABEL AND CAT_ORDER
      AND ROW_ORDER AND CURYR AND PRYR AND DIFF AND IDPERCENT AND TRANM  
ON TABLE HOLD AS DECYTD2
END
MODIFY FILE BBCM
LOG DUPL MSG OFF
FIXFORM FROM DECYTD2
MATCH CATEGORY ROW_LABEL ROW_ORDER TRANM
ON MATCH UPDATE CURYR PRYR DIFF IDPERCENT
ON NOMATCH REJECT
DATA ON DECYTD2
END
-RUN

-GOTO XXIT

 

-CHECK1
-SET &FMY=EDIT(&&FROMDT,'$9999');
-SET &TXOY=EDIT(&&TXDATE,'$9999'); 

-SET &CURMY = 'JAN' || '&FMY.EVAL';
-SET &PRMY  = 'JAN' || '&TXOY.EVAL';
-SET &CURMY1 = '&CURMY.EVAL' |',' | 'CUMULATIVE'; 
-SET &PRMY1 = '&PRMY.EVAL' |',' | 'CUMULATIVE'; 




DEFINE FILE BBCM
KEY/A1 = IF BBCM.TRANM EQ 'JAN' THEN 'A' ELSE
         IF BBCM.TRANM EQ 'FEB' THEN 'B' ELSE
         IF BBCM.TRANM EQ 'MAR' THEN 'C' ELSE
         IF BBCM.TRANM EQ 'APR' THEN 'D' ELSE
         IF BBCM.TRANM EQ 'MAY' THEN 'E' ELSE 
         IF BBCM.TRANM EQ 'JUN' THEN 'F' ELSE   
         IF BBCM.TRANM EQ 'JUL' THEN 'G' ELSE
         IF BBCM.TRANM EQ 'AUG' THEN 'H' ELSE
         IF BBCM.TRANM EQ 'SEP' THEN 'I' ELSE
         IF BBCM.TRANM EQ 'OCT' THEN 'J' ELSE
         IF BBCM.TRANM EQ 'NOV' THEN 'K' ELSE
         IF BBCM.TRANM EQ 'DEC' THEN 'L' ELSE 'M';
         
END         
         
         

         
TABLE FILE BBCM
 
PRINT BBCM.TRANM AS 'TRAN MONTH'
      BBCM.ROW_LABEL AS 'AIR'
      BBCM.CURMO  AS  '&CURMY.EVAL'
      BBCM.PRMO AS '&PRMY.EVAL'
      BBCM.CURYR AS '&CURMY1.EVAL' 
      BBCM.PRYR AS  '&PRMY1.EVAL' 
      BBCM.DIFF AS 'DIFFERENCE'
      BBCM.IDPERCENT AS '% INC./,DECREASE'
BY KEY NOPRINT       
BY BBCM.CAT_ORDER NOPRINT
BY BBCM.CATEGORY NOPRINT 
BY BBCM.ROW_ORDER NOPRINT
ON BBCM.CATEGORY SKIP-LINE

END
-RUN
-QUIT
-XXIT
-XXITTOT


