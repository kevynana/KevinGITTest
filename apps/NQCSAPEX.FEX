-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* Created for the new quarterly review - JK 8/2/05
-******************************************************************************
-INCLUDE SETECHO
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

DEFINE FILE &&EXTRACT 
FARE_PAID/D12 = SEG_AMT + SEG_TAX;
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;       
TOTAL_FARE/D12 = SEG_AMT + SEG_TAX;
VASAVINGS/D11 = SEG_DISCOUNT - TOTAL_FARE;

SEG_DISC/D12 = SEG_DISCOUNT;
-*ROLLUP_CODE/A8 = &&ROLLUP;                         
CLIENTCODE/A8 = '&&ROLLUP.EVAL';
-INCLUDE QRFTRANA
END

TABLEF FILE &&EXTRACT
PRINT CURRENT
      FARE_PAID
      NET_TKT_CNT
      PRIOR
      PYTD
      CLIENTCODE AS 'ROLLUP_CODE' 
      VASAVINGS          
      YEAR
      TRAN      
WHERE VOID.VOID_DATE EQ 0     
WHERE (TRN_DATE GE '&&FROMDT.EVAL') AND (TRN_DATE LE '&&TODT.EVAL') OR
      (TRN_DATE GE '&&FXDATE.EVAL') AND (TRN_DATE LE '&&TXDATE.EVAL')
-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
ON TABLE HOLD AS PEERCSA
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;




TABLE FILE PEERCSA
SUM FARE_PAID
    NET_TKT_CNT
    VASAVINGS
BY ROLLUP_CODE
BY YEAR
BY TRAN
WHERE CURRENT EQ 'Y'
ON TABLE HOLD AS PEER2
END
-RUN

 
TABLE FILE PEER2
PRINT ROLLUP_CODE YEAR TRAN FARE_PAID NET_TKT_CNT VASAVINGS 
ON TABLE SAVE
END
-RUN

MODIFY FILE QRCSAIR2
FIXFORM ROLLUP_CODE/8 YEAR/4 TRAN/7 FARE_PAID/12 NET_TKT_CNT/8 VASAVINGS/11 
MATCH ROLLUP_CODE YEAR TRAN  
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN





-NEXTONE