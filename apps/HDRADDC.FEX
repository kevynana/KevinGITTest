-* 5/20/15 - DEB - S-08628 - CREATED NEW ROUTINE FOR ABLDCO
-*                           TO OBTAIN ADD COLLECT AMOUNT TO BALANCE ABEXCH2
-*05/25/17 - DLV - S-34806 - Changed due to balancing differences on ABEXCH2 and
-*                           ABLDCO 
-INCLUDE SETECHO

SET ASNAMES = ON




DEFINE FILE &&RPT_HOLD
AP_DAYS/D9 = IF TKT_NUM NE LAST TKT_NUM THEN NEW_ADV_PURCH ELSE 0;
PNLTY_AMT/D12.2 = IF TKT_SORT NE LAST TKT_SORT THEN AIRLINE_FEE ELSE 0;
DOCNBR/A9 = EDIT(DOC_NUMBER, '$999999999');
FARE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN FARE_PAID2 ELSE 0;
ORGSALE/D12.2CS = IF TKT_NUM NE LAST TKT_NUM THEN ORG_SALE ELSE 0;
AC_AMT/D12.2CS = IF ORGSALE EQ 0 THEN 0 ELSE
                  IF ORGSALE GT FARE THEN 0 ELSE FARE - ORGSALE;
END
TABLE FILE  &&RPT_HOLD
PRINT 
  AP_DAYS
  TRN_DATE 
  TKT_NUM 
  DOC_NUMBER 
  EX_FLAG
  PNLTY_AMT
  AC_AMT
  FARE 
  ORGSALE
  PEXG_ISS1 AS 'PEXG_ISS'
BY LEVEL_DESC
BY XPSNGR_NM
BY TKT_SORT
BY TRN_DATE 
WHERE ((EXCHG_SALE NE ' ') AND (SEG_COUNT GE 0)) OR
((EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0)) 
WHERE EX_FLAG EQ ' '
ON TABLE HOLD AS EXHOLD2 FORMAT FOCUS
END
-RUN







-ENDit