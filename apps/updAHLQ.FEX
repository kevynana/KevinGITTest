-AIR
-SET &&DATPATH = 'D:\TNT\TTRACKER\DATA\';
-SET &&DBUSEA1 = '';
-SET &&DBUSEA2 = '';
-SET &&DBUSEA3 = '';
-SET &&DBUSEA4 = '';
-SET &&DBUSEA5 = '';
-SET &&DBUSEA6 = '';
-SET &&DBUSEA7 = '';
-SET &&DBUSEA8 = '';
-SET &&DBUSEA9 = '';
-SET &&DBUSEA0 = '';
-SET &&DBUSEAY = '';
-SET &&DBUSEAZ = '';
-SET &&DBUSEC1 = '';
-SET &&DBUSEC2 = '';
-SET &&DBUSEC3 = '';
-SET &&DBUSEC4 = '';
-SET &&DBUSEC5 = '';
-SET &&DBUSEC6 = '';
-SET &&DBUSEC7 = '';
-SET &&DBUSEC8 = '';
-SET &&DBUSEC9 = '';
-SET &&DBUSEC0 = '';
-SET &&DBUSECY = '';
-SET &&DBUSECZ = '';
-SET &&DBUSEH1 = '';
-SET &&DBUSEH2 = '';
-SET &&DBUSEH3 = '';
-SET &&DBUSEH4 = '';
-SET &&DBUSEH5 = '';
-SET &&DBUSEH6 = '';
-SET &&DBUSEH7 = '';
-SET &&DBUSEH8 = '';
-SET &&DBUSEH9 = '';
-SET &&DBUSEH0 = '';
-SET &&DBUSEHY = '';
-SET &&DBUSEHZ = '';
-SET &&ROLLTARG = '                ';

-UPDLOOP
-TYPE "AIR"

-* This is the trigger file containing the target rollups for update
-*   action - each rollup shall be identified by a single entry
-*   consisting of the company id - e.g. METX or
-*   BAIR - the last record in this trigger file must be END
FILEDEF ROLLLIST DISK D:\TNT\TTRACKER\TEMP\ROLLLIST.TXT (LRECL 80
-RUN
FILEDEF ROLLNEW DISK D:\TNT\TTRACKER\TEMP\ROLLNEW.TXT (LRECL 80
-RUN

-READ ROLLLIST &&ROLLTARG
-IF &&ROLLTARG EQ 'END' THEN GOTO XFER;
-TYPE ROLLTARG &&ROLLTARG

-REPEAT BNEW WHILE &IORETURN EQ 0;
-READ ROLLLIST &&SLINE.80
-IF &IORETURN NE 0 THEN GOTO BNEW;
-WRITE ROLLNEW &&SLINE
-BNEW

FILEDEF ROLLLIST CLEAR
-RUN
FILEDEF ROLLNEW CLEAR
-RUN

COPY D:\TNT\TTRACKER\TEMP\ROLLNEW.TXT D:\TNT\TTRACKER\TEMP\ROLLLIST.TXT
-RUN

-TYPE ROLLTARG &&ROLLTARG

-SET &&TOTLEV = SUBSTR(16, &&ROLLTARG, 7, 7, 1, 'A1');
-SET &&ROLLLEV = SUBSTR(16, &&ROLLTARG, 8, 8, 1, 'A1');
-SET &&ROLLCOMP = SUBSTR(16, &&ROLLTARG, 1, 6, 6, 'A6');
-SET &&ROLLROLL = SUBSTR(16, &&ROLLTARG, 9, 16, 8, 'A8');
-SET &&LEVEL = 'LEVEL' || &&ROLLLEV;

-TYPE ROLLLEV &&ROLLLEV
-TYPE ROLLCOMP &&ROLLCOMP
-TYPE ROLLUP &&ROLLROLL
-TYPE LEVEL &&LEVEL

-SET &&ROLLAIR1 = 'A1' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR2 = 'A2' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR3 = 'A3' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR4 = 'A4' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR5 = 'A5' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR6 = 'A6' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR7 = 'A7' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR8 = 'A8' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR9 = 'A9' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIR0 = 'A0' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIRY = 'AY' || &&ROLLCOMP || '.FOC';
-SET &&ROLLAIRZ = 'AZ' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR1 = 'C1' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR2 = 'C2' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR3 = 'C3' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR4 = 'C4' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR5 = 'C5' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR6 = 'C6' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR7 = 'C7' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR8 = 'C8' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR9 = 'C9' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCAR0 = 'C0' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCARY = 'CY' || &&ROLLCOMP || '.FOC';
-SET &&ROLLCARZ = 'CZ' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL1 = 'H1' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL2 = 'H2' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL3 = 'H3' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL4 = 'H4' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL5 = 'H5' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL6 = 'H6' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL7 = 'H7' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL8 = 'H8' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL9 = 'H9' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTL0 = 'H0' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTLY = 'HY' || &&ROLLCOMP || '.FOC';
-SET &&ROLLHTLZ = 'HZ' || &&ROLLCOMP || '.FOC';
-SET &&ALFILE = 'AL' || &&ROLLCOMP;
-SET &&CLFILE = 'CL' || &&ROLLCOMP;
-SET &&HLFILE = 'HL' || &&ROLLCOMP;
-SET &&ALPATH = &&DATPATH || &&ALFILE || '.MAS';
-SET &&CLPATH = &&DATPATH || &&CLFILE || '.MAS';
-SET &&HLPATH = &&DATPATH || &&HLFILE || '.MAS';

-SET &&AIRIF = 'IF AROLL_LEV1 EQ ''' || &&ROLLROLL || '''';
-* -SET &&CARIF = 'IF CROLL_LEV1 EQ ''' || &&ROLLROLL || '''';
-* -SET &&HTLIF = 'IF HROLL_LEV1 EQ ''' || &&ROLLROLL || '''';
-SET &&AROLL = '''AROLL_LEV' || &&TOTLEV || '''';
-* -SET &&CROLL = '''CROLL_LEV' || &&TOTLEV || '''';
-* -SET &&HROLL = '''HROLL_LEV' || &&TOTLEV || '''';

-TYPE ROLLAIR1 &&ROLLAIR1
-TYPE ROLLCAR &&ROLLCAR1
-TYPE ROLLHTL &&ROLLHTL1
-TYPE ALPATH &&ALPATH
-TYPE CLPATH &&CLPATH
-TYPE HLPATH &&HLPATH
-TYPE AIRIF &&AIRIF
-* -TYPE CARIF &&CARIF
-* -TYPE HTLIF &&HTLIF
-TYPE AROLL &&AROLL

-SET &&DBUSEA1 = &&DATPATH || &&ROLLAIR1;
-SET &&DBUSEA2 = &&DATPATH || &&ROLLAIR2;
-SET &&DBUSEA3 = &&DATPATH || &&ROLLAIR3;
-SET &&DBUSEA4 = &&DATPATH || &&ROLLAIR4;
-SET &&DBUSEA5 = &&DATPATH || &&ROLLAIR5;
-SET &&DBUSEA6 = &&DATPATH || &&ROLLAIR6;
-SET &&DBUSEA7 = &&DATPATH || &&ROLLAIR7;
-SET &&DBUSEA8 = &&DATPATH || &&ROLLAIR8;
-SET &&DBUSEA9 = &&DATPATH || &&ROLLAIR9;
-SET &&DBUSEA0 = &&DATPATH || &&ROLLAIR0;
-SET &&DBUSEAY = &&DATPATH || &&ROLLAIRY;
-SET &&DBUSEAZ = &&DATPATH || &&ROLLAIRZ;

USE
&&DBUSEA1 AS AIR_MAIN
&&DBUSEA2 AS AIR_MAIN
&&DBUSEA3 AS AIR_MAIN
&&DBUSEA4 AS AIR_MAIN
&&DBUSEA5 AS AIR_MAIN
&&DBUSEA6 AS AIR_MAIN
&&DBUSEA7 AS AIR_MAIN
&&DBUSEA8 AS AIR_MAIN
&&DBUSEA9 AS AIR_MAIN
&&DBUSEA0 AS AIR_MAIN
&&DBUSEAY AS AIR_MAIN
&&DBUSEAZ AS AIR_MAIN
END
-RUN

SET ASNAMES=ON

TABLE FILE AIR_MAIN
PRINT AIR_KEY &&LEVEL AS &&AROLL
BY &&LEVEL NOPRINT
ON TABLE HOLD AS ALHOLD
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
FI TTPHIERA DISK D:\AS400\TTPHIERA.TXT

TABLE FILE TTPHIERA
PRINT *
BY &&AROLL NOPRINT
&&AIRIF
ON TABLE HOLD AS TMPHOLDA
END
-RUN

MATCH FILE ALHOLD
PRINT AIR_KEY
BY &&AROLL NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY &&AROLL NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY AIR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

COPY D:\TNT\TTRACKER\DATA\ALSYSTEM.MAS &&ALPATH
-RUN

CREATE FILE &&ALFILE
END
-RUN

MODIFY FILE &&ALFILE
FIXFORM FROM HOLD
MATCH AIR_KEY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON HOLD2
END
-RUN

-CAR
-TYPE "CAR"

-SET &&DBUSEC1 = &&DATPATH || &&ROLLCAR1;
-SET &&DBUSEC2 = &&DATPATH || &&ROLLCAR2;
-SET &&DBUSEC3 = &&DATPATH || &&ROLLCAR3;
-SET &&DBUSEC4 = &&DATPATH || &&ROLLCAR4;
-SET &&DBUSEC5 = &&DATPATH || &&ROLLCAR5;
-SET &&DBUSEC6 = &&DATPATH || &&ROLLCAR6;
-SET &&DBUSEC7 = &&DATPATH || &&ROLLCAR7;
-SET &&DBUSEC8 = &&DATPATH || &&ROLLCAR8;
-SET &&DBUSEC9 = &&DATPATH || &&ROLLCAR9;
-SET &&DBUSEC0 = &&DATPATH || &&ROLLCAR0;
-SET &&DBUSECY = &&DATPATH || &&ROLLCARY;
-SET &&DBUSECZ = &&DATPATH || &&ROLLCARZ;

USE
&&DBUSEC1 AS CAR_MAIN
&&DBUSEC2 AS CAR_MAIN
&&DBUSEC3 AS CAR_MAIN
&&DBUSEC4 AS CAR_MAIN
&&DBUSEC5 AS CAR_MAIN
&&DBUSEC6 AS CAR_MAIN
&&DBUSEC7 AS CAR_MAIN
&&DBUSEC8 AS CAR_MAIN
&&DBUSEC9 AS CAR_MAIN
&&DBUSEC0 AS CAR_MAIN
&&DBUSECY AS CAR_MAIN
&&DBUSECZ AS CAR_MAIN
END
-RUN

SET ASNAMES=ON

TABLE FILE CAR_MAIN
PRINT CAR_KEY &&LEVEL AS &&AROLL
BY &&LEVEL NOPRINT
ON TABLE HOLD AS CLHOLD
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
-* FI TTPHIERC DISK D:\AS400\TTPHIERC.TXT

-* TABLE FILE TTPHIERC
-* PRINT *
-* BY &&AROLL NOPRINT
-* &&AIRIF
-* ON TABLE HOLD AS TMPHOLDC
-* END
-* -RUN

MATCH FILE CLHOLD
PRINT CAR_KEY
BY &&AROLL NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY &&AROLL NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY CAR_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

COPY D:\TNT\TTRACKER\DATA\CLSYSTEM.MAS &&CLPATH
-RUN

CREATE FILE &&CLFILE
END
-RUN

MODIFY FILE &&CLFILE
FIXFORM FROM HOLD
MATCH CAR_KEY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON HOLD2
END
-RUN

-HOTEL
-TYPE "HOTEL"

-SET &&DBUSEH1 = &&DATPATH || &&ROLLHTL1;
-SET &&DBUSEH2 = &&DATPATH || &&ROLLHTL2;
-SET &&DBUSEH3 = &&DATPATH || &&ROLLHTL3;
-SET &&DBUSEH4 = &&DATPATH || &&ROLLHTL4;
-SET &&DBUSEH5 = &&DATPATH || &&ROLLHTL5;
-SET &&DBUSEH6 = &&DATPATH || &&ROLLHTL6;
-SET &&DBUSEH7 = &&DATPATH || &&ROLLHTL7;
-SET &&DBUSEH8 = &&DATPATH || &&ROLLHTL8;
-SET &&DBUSEH9 = &&DATPATH || &&ROLLHTL9;
-SET &&DBUSEH0 = &&DATPATH || &&ROLLHTL0;
-SET &&DBUSEHY = &&DATPATH || &&ROLLHTLY;
-SET &&DBUSEHZ = &&DATPATH || &&ROLLHTLZ;

USE
&&DBUSEH1 AS HTL_MAIN
&&DBUSEH2 AS HTL_MAIN
&&DBUSEH3 AS HTL_MAIN
&&DBUSEH4 AS HTL_MAIN
&&DBUSEH5 AS HTL_MAIN
&&DBUSEH6 AS HTL_MAIN
&&DBUSEH7 AS HTL_MAIN
&&DBUSEH8 AS HTL_MAIN
&&DBUSEH9 AS HTL_MAIN
&&DBUSEH0 AS HTL_MAIN
&&DBUSEHY AS HTL_MAIN
&&DBUSEHZ AS HTL_MAIN
END
-RUN

SET ASNAMES=ON

TABLE FILE HTL_MAIN
PRINT HTL_KEY &&LEVEL AS &&AROLL
BY &&LEVEL NOPRINT
ON TABLE HOLD AS HLHOLD
END
-RUN

-*=======================================================================
-* DECLARE FILEDEFS FOR AS400 FILES USED FOR DATA EXTRACT
-*=======================================================================
-* FI TTPHIERH DISK D:\AS400\TTPHIERH.TXT

-* TABLE FILE TTPHIERH
-* PRINT *
-* BY &&AROLL NOPRINT
-* &&AIRIF
-* ON TABLE HOLD AS TMPHOLDH
-* END
-* -RUN

MATCH FILE HLHOLD
PRINT HTL_KEY
BY &&AROLL NOPRINT
RUN
FILE TMPHOLDA
SUM
AROLL_LEV1 AROLL_DSC1 AROLL_LEV2 AROLL_DSC2
AROLL_LEV3 AROLL_DSC3 AROLL_LEV4 AROLL_DSC4
AROLL_LEV5 AROLL_DSC5 AROLL_LEV6 AROLL_DSC6
AROLL_LEV7 AROLL_DSC7 AROLL_LEV8 AROLL_DSC8
AROLL_LEV9 AROLL_DSC9
BY &&AROLL NOPRINT
AFTER MATCH HOLD OLD
END
-RUN

TABLE FILE HOLD
PRINT *
BY HTL_KEY NOPRINT
ON TABLE HOLD AS HOLD2
END
-RUN

COPY D:\TNT\TTRACKER\DATA\HLSYSTEM.MAS &&HLPATH
-RUN

CREATE FILE &&HLFILE
END
-RUN

MODIFY FILE &&HLFILE
FIXFORM FROM HOLD
MATCH HTL_KEY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON HOLD2
END
-RUN

-GOTO UPDLOOP

-XFER
-TYPE PROGRAM COMPLETED.......
-EXIT
