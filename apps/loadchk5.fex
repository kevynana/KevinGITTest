-* File LOADCHK.FEX

-*SET TEMPERASE = OFF

-SET &&CHKTARG = '        ';

-* Add code here to build CHKLIST and NEWLIST so it is not manual
-*************************************************************
FI TTPSEGA0 DISK K:\AS400\TTPSEGA0.TXT

TABLE FILE TTPSEGA0
COUNT ROLLUP_CODE
BY ROLLUP_CODE
ON TABLE HOLD
END

MATCH FILE HOLD
PRINT ROLLUP_CODE
BY ROLLUP_CODE
RUN
FILE ROLLUP
PRINT COMP QTR_ENABLE
BY ROLLUP_CODE
AFTER MATCH HOLD AS CHKLIST2 OLD
END

TABLE FILE CHKLIST2
PRINT COMP QTR_ENABLE
BY COMP NOPRINT
ON TABLE HOLD AS CHKLIST3 FORMAT FOCUS INDEX COMP
END

DEFINE FILE CHKLIST2
COMP/A6='ZZZ';
QTR_ENABLE/A1=' ';
END

TABLE FILE CHKLIST2
PRINT COMP QTR_ENABLE
BY ROLLUP_CODE NOPRINT
IF RECORDLIMIT EQ 1
ON TABLE HOLD AS CHKLIST4 FORMAT FOCUS INDEX COMP 
END

USE
CHKLIST3.FOC AS CHKLIST3
CHKLIST4.FOC AS CHKLIST3
END

FI CHKLIST DISK K:\TNT\TTRACKER\LOADCHK\CHKLIST.TXT

DEFINE FILE CHKLIST3
QTR/A1 = IF QTR_ENABLE EQ 'X' THEN 'Y' 
         ELSE IF COMP EQ 'ZZZ' THEN ' ' ELSE 'N';
END

TABLE FILE CHKLIST3
PRINT COMP QTR
BY COMP NOPRINT
ON TABLE SAVE AS CHKLIST
END
-*************************************************************

-CHKLOOP

FILEDEF CHKLIST DISK K:\TNT\TTRACKER\LOADCHK\CHKLIST.TXT (LRECL 80
-RUN

FILEDEF NEWLIST DISK K:\TNT\TTRACKER\LOADCHK\NEWLIST.TXT (LRECL 80
-RUN

-READ CHKLIST &&CHKTARG
-IF &&CHKTARG EQ 'ZZZ' THEN GOTO XFER;
-TYPE CHKTARG &&CHKTARG

-REPEAT BNEW WHILE &IORETURN EQ 0;
-READ CHKLIST &&SLINE.80
-IF &IORETURN NE 0 THEN GOTO BNEW;
-WRITE NEWLIST &&SLINE
-BNEW

FILEDEF CHKLIST CLEAR
-RUN

FILEDEF NEWLIST CLEAR
-RUN

-SET &&TEST='COPY K:\TNT\TTRACKER\LOADCHK\NEWLIST.TXT';
-SET &&TEST2='K:\TNT\TTRACKER\LOADCHK\CHKLIST.TXT';

&&TEST &&TEST2
-RUN

-TYPE &&TEST
-TYPE &&TEST2

-TYPE CHKTARG &&CHKTARG

-SET &&QTR = SUBSTR(8, &&CHKTARG, 7, 7, 1, 'A1');
-SET &&COMP = SUBSTR(8, &&CHKTARG, 1, 6, 6, 'A6');

-TYPE QUARTER &&QTR
-TYPE COMPANY &&COMP

-SET &&COMPNY = &&COMP || '';

-IF (&&QTR EQ 'Y' OR 'y') THEN GOTO QUARTERA ELSE GOTO NOQUARTERA;
-QUARTERA
EX AIRXUSES
END
-RUN
-GOTO BEGINA
-NOQUARTERA
EX AIRXUSET
END
-RUN
-BEGINA
-* -GOTO AROUND
-TYPE AIR CHECKS &&COMPNY
-SET &&NAME = &&COMPNY.EVAL||'1';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2

-* AIR CHECKS
TABLE FILE SR_50
ON TABLE SET PAGE-NUM OFF
PRINT CITYPAIR.AIR_KEY AND AIR_MAIN.TKT_NUM AND TRN_DATE
LEV_1.AROLL_LEV1 AND LEV_1.AROLL_DSC1 AND LEVEL1 LEVEL2 LEVEL3
BY TRN_DATE
WHERE (LEV_1.AROLL_LEV1 EQ ' ') OR (LEV_1.AROLL_DSC1 EQ ' ');
WHERE TRN_DATE GT '20060401';
-* ON TABLE SET ONLINE-FMT HTML
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN

-SET &&NAME = &&COMPNY.EVAL||'2';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2
TABLE FILE SR_50
PRINT TKT_NUM TICKET_CODE CONJ_REL BR_CL_IDX CITYPAIR.TKT_SORT
AIR_MAIN.AIR_KEY CITYPAIR.AIR_KEY TRN_DATE
WHERE ( AIR_MAIN.CONJ_REL EQ 0) OR (AIR_MAIN.BR_CL_IDX EQ ' ') OR
  (AIR_MAIN.TICKET_CODE EQ ' ');
WHERE TRN_DATE GT '20060401';
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN

-* CITYPAIR - SEGMENTS INTERNATIONAL/DOMESTIC
-AROUND
-SET &&NAME = &&COMPNY.EVAL||'3';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2
TABLE FILE SR_50
ON TABLE SET PAGE-NUM OFF
SUM CITYPAIR.SEG_AMT/D12.2 AND CITYPAIR.SEG_TAX/D12.2
BY CITYPAIR.INTL_DOM
WHERE TRN_DATE GT '20060401';
-* ON TABLE SET ONLINE-FMT HTML
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN

-* CITYPAIR - AIR TICKETS INTERNATIONAL/DOMESTIC
-SET &&NAME = &&COMPNY.EVAL||'4';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2
TABLE FILE SR_50
ON TABLE SET PAGE-NUM OFF
SUM CITYPAIR.SEG_AMT/D12.2 AND CITYPAIR.SEG_TAX/D12.2
BY AIR_MAIN.INTL_DOM
WHERE TRN_DATE GT '20060401';
-* ON TABLE SET ONLINE-FMT HTML
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN
-* -GOTO AROUND1
-SET &&NAME = &&COMPNY.EVAL||'5';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2
TABLE FILE SR_50
ON TABLE SET PAGE-NUM OFF
SUM CITYPAIR.SEG_AMT/D12.2 AND CITYPAIR.SEG_TAX/D12.2
BY CITYPAIR.TRN_DATE
WHERE TRN_DATE GT '20060401';
-* ON TABLE SET ONLINE-FMT HTML
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN

USE CLEAR *
-RUN

-TYPE CAR CHECKS &&COMPNY
-IF (&&QTR EQ 'Y' OR 'y') THEN GOTO QUARTERC ELSE GOTO NOQUARTERC;
-QUARTERC
EX CARXUSES
END
-RUN
-GOTO BEGINC
-NOQUARTERC
EX CARXUSET
END
-RUN
-BEGINC

-SET &&NAME = &&COMPNY.EVAL||'6';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2
TABLE FILE CR_50
ON TABLE SET PAGE-NUM OFF
PRINT LEV_1.AROLL_LEV1 AND LEV_1.AROLL_DSC1 AND LEVEL1 LEVEL2 LEVEL3
CAR_KEY PNR_LOCATOR INVOICE_DATE ROLLUP_CODE
BY LEV_1.AROLL_LEV1 NOPRINT
WHERE (LEV_1.AROLL_LEV1 EQ ' ') OR (LEV_1.AROLL_DSC1 EQ ' ');
-* ON TABLE SET ONLINE-FMT HTML
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN

USE CLEAR *
-RUN

-TYPE HOTEL CHECKS &&COMPNY
-IF (&&QTR EQ 'Y' OR 'y') THEN GOTO QUARTERH ELSE GOTO NOQUARTERH;
-QUARTERH
EX HTLXUSES
END
-RUN
-GOTO BEGINH
-NOQUARTERH
EX HTLXUSET
END
-RUN
-BEGINH

-SET &USE_HH = 'HL' || &&COMPNY;

-* HOTEL HR_50
-SET &&NAME = &&COMPNY.EVAL||'7';
-SET &&NAME2 = &&NAME.EVAL||'.PDF';
FI &&NAME DISK K:\TNT\TTRACKER\LOADCHK\ERRORS\&&NAME2
TABLE FILE HR_50
-* TABLE FILE &USE_HH
ON TABLE SET PAGE-NUM OFF
PRINT LEV_1.AROLL_LEV1 AND LEV_1.AROLL_DSC1 AND LEVEL1 LEVEL2 LEVEL3
HTL_KEY PNR_LOCATOR INVOICE_DATE ROLLUP_CODE
BY LEV_1.AROLL_LEV1 NOPRINT
WHERE (LEV_1.AROLL_LEV1 EQ ' ') OR (LEV_1.AROLL_DSC1 EQ ' ');
-* ON TABLE SET ONLINE-FMT HTML
ON TABLE HOLD AS &&NAME FORMAT PDF
END
-RUN

USE CLEAR *
-RUN
-AROUND1

-GOTO CHKLOOP

-XFER
-TYPE EXITING
-*-EXIT































