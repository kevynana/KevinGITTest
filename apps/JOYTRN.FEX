-* JOIN AIR_KEY IN A9ABCD TO ALL AIR_KEY IN S9ABCD AS J1
-* -RUN

USE ADD
D:\TNT\TTRACKER\DATA\S9ABCD.FOC AS SR_50
D:\TNT\TTRACKER\DATA\A9ABCD.FOC AS AIR_MAIN
END
-RUN
DEFINE FILE SR_50
FARE_PAID/D12.2 = SEG_AMT + SEG_TAX;

TKT_CNT/D8CS = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT EQ 1) THEN 1 ELSE 0; 
MCO_CNT/D9 = IF (EX_FLAG EQ ' ') AND (DOC_TYPE EQ '1') AND
                (EXCHG_SALE NE ' ') THEN 1 ELSE 
             IF (EX_FLAG EQ ' ') AND (DOC_TYPE EQ '1') AND
                (RF_FLAG EQ 'F') THEN 1 ELSE 0;
TKT_ISS/D12.2 = IF ((SEG_NBR EQ '01') AND (SEG_AMT+SEG_TAX GE 0) AND (SEG_COUNT EQ 1)) THEN 1 ELSE 0;
TKT_PURCH/D8.2CS      = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 0;
REF_EXCH_CNT/D8CS   = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 0 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN 1 ELSE 0;
ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE IF (DOC_TYPE EQ '1') AND
                  (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') THEN 1 ELSE 0;
EX_CNT/D9 = IF (EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK NE 'DT1' OR 'RF1' OR 'FP3') THEN TKT_CNT ELSE
            IF (DOC_TYPE EQ '1') AND (EXCHG_SALE EQ 'E') THEN 0 ELSE
            IF (SEG_COUNT GE 0) AND (EXCHG_SALE NE ' ') THEN TKT_CNT ELSE 0;  
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;  
END
-RUN
TABLE FILE SR_50
-*  PRINT SEG_COUNT MCO_CNT TKT_ISS FARE_PAID
-* SUM TKT_ISS TKT_PURCH REF_EXCH_CNT ORIG_SALE EX_CNT MCO_CNT NET_TKT_CNT
SUM TKT_ISS ORIG_SALE EX_CNT MCO_CNT
BY TKT_NUM
-* BY TKT_SORT
-* BY PASSNGR_NAME
-* BY TKT_NUM
-* BY TKT_SORT
-* BY SEG_NBR
WHERE TRN_DATE GE '20120301' AND TRN_DATE LE '20120331'
WHERE AROLL_LEV2 EQ 'ABCDB'
WHERE CATEGORY NE 'GLOBAL'
-* WHERE VOID.VOID_DATE EQ 0
-* WHERE AIR_MAIN.TICKET_CODE EQ '1'
-* WHERE RF_FLAG EQ ' '
ON TABLE COLUMN-TOTAL
END
-RUN
-QUIT
