-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**

-* File AVI112EX.FEX

-****************************************************************************
-* CREATED FROM AVIW63EX FOR SIMPLIFARE REPORT REQUEST
-****************************************************************************
-INCLUDE SETECHO
-TYPE EXTRACT1
SET ASNAMES = ON
-SET HOLDATTR = ON;
-RUN

-SET &&AIR1 = '  ';
-SET &&AIR2 = '  ';
-SET &&AIR3 = '  ';
-SET &&AIR4 = '  ';
-SET &&AIR5 = '  ';
-SET &&AIR6 = '  ';
-SET &&AIR7 = '  ';
-SET &&AIR8 = '  ';
-SET &&AIR9 = '  ';

DEFINE FILE &&EXTRACT
CURRENT/A1 = IF (TRN_DATE GE &&FROMDT.EVAL) AND 
            (TRN_DATE LE &&TODT.EVAL) THEN 'Y' ELSE 'N';

FARE_PAID/D12.2S  = SEG_AMT;
 
NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (EX_FLAG NE ' ') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (RF_FLAG NE ' ') THEN (-1) ELSE 0;
NET_FARE/D12.2S  = IF (EX_FLAG EQ ' ') AND (RF_FLAG EQ ' ')
                         THEN SEG_AMT ELSE 0;
NEW_SEG_COUNT/D8CS = SEG_COUNT;

TOTAL_FARE/D12.2S = SEG_AMT + SEG_TAX;
VASAVINGS/D11.2CS = SEG_DISCOUNT - TOTAL_FARE;
XPSNGR_NM/A15 = EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
XTRAN_DT/MDYY = TRN_DATE;

TRAN_MY/MTYY = TRN_DATE;
XTRAN_M/M = TRN_DATE;
XTRAN_Y/YY = TRN_DATE;
XTRAN_YR/A4 = EDIT(XTRAN_Y);

-* ****DEFINES ON PREVIOUS DEFINES****

DISSAVINGS/D11.2CS= IF EMBARK EQ 'DT1' THEN 0 ELSE
                         TOTAL_FARE - SEG_LOWEST;
TRN_MON/A3          = DECODE XTRAN_M (1 'JAN' 2 'FEB' 3 'MAR'
                                 4 'APR' 5 'MAY' 6 'JUN' 7 'JUL'
                                 8 'AUG' 9 'SEP' 10 'OCT' 11 'NOV' 12 'DEC');
TRNM_FLAG/A2          = DECODE XTRAN_M ( 1 '01' 2 '02' 3 '03'
                                 4 '04' 5 '05' 6 '06' 7 '07' 8 '08'
                                 9 '09' 10 '10' 11 '11' 12 '12');
SAVINGS/D11.2CS   = SEG_STANDARD - TOTAL_FARE;  
 
 P1/A1 = IF (TRN_DATE GE &&FROMDT.EVAL) AND 
            (TRN_DATE LE &&TODT.EVAL) THEN 'Y' ELSE 'N';
 P2/A1 = IF (TRN_DATE GE &&FXDATE.EVAL) AND 
            (TRN_DATE LE &&TXDATE.EVAL) THEN 'Y' ELSE 'N';

 P1FARE/D15.2CS = IF P1 EQ 'Y' THEN FARE_PAID ELSE 0;
 P1CNT/P9CS = IF P1 EQ 'Y' THEN NET_TKT_CNT ELSE 0;
 P2FARE/D15.2CS = IF P2 EQ 'Y' THEN FARE_PAID ELSE 0;
 P2CNT/P9CS = IF P2 EQ 'Y' THEN NET_TKT_CNT ELSE 0;

 CTRN_YR/A10 = &&FROMDT.EVAL;
 
 XTRANMY/A8 = TRN_MON | XTRAN_YR;
 
 CYEAR/A4 = EDIT(CTRN_YR,'9999$$$$$$');
 CMN_YR/A8 = TRN_MON | CYEAR;

END

TABLEF FILE &&EXTRACT
PRINT  AIRLINE.AIRLINE AS 'AIR_LINE'	
  AIRLINE.AIRLINE_NAME 	
  CITYPAIR.AIRLINE AS 'CP_AIRLINE'
  CURRENT
  P1
  P2
  P1CNT
  P1FARE
  P2CNT
  P2FARE    
  TRAN_MY
  TRN_DATE   
  TRNM_FLAG
  CMN_YR 
  XTRANMY
  XTRAN_YR
WHERE (((TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL)) OR
      ((TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)))
WHERE VOID_DATE EQ 0
WHERE CITYPAIR.INTL_DOM EQ 'D'
-INCLUDE RPTPARMS
ON TABLE HOLD AS TCPMPYR
END
-RUN

-* Hardcoded with these airline selections per Patti until airline selection
-* is implemented in GUI - Deb 8/2/07

-SET &&AIR1 = 'UA';
-SET &&AIR2 = 'NW';
-SET &&AIR3 = 'CO';
-SET &&AIR4 = 'DL';
-SET &&AIR5 = 'US';
-SET &&AIR6 = 'F9';


-IF &LINES EQ 0 THEN GOTO NEXTONE;

TABLEF FILE TCPMPYR
PRINT AIR_LINE
    AIRLINE_NAME
    P1CNT
    P1FARE 
    P2CNT
    P2FARE
    XTRANMY
    TRNM_FLAG
    TRN_DATE  
    CMN_YR
    CURRENT
BY TRAN_MY    
BY CP_AIRLINE
ON TABLE HOLD AS HOLD1
END
-RUN

DEFINE FILE HOLD1 
  AIRSELECT/A3 = IF ('&&AIR1' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT2/A3 =IF ('&&AIR2' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT3/A3 =IF ('&&AIR3' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT4/A3 =IF ('&&AIR4' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT5/A3 =IF ('&&AIR5' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT6/A3 =IF ('&&AIR6' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT7/A3 =IF ('&&AIR7' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT8/A3 =IF ('&&AIR8' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
  AIRSELECT9/A3 =IF ('&&AIR9' EQ AIR_LINE) THEN AIR_LINE ELSE '0';
END
TABLE FILE HOLD1
SUM P1CNT
    P1FARE
    P2CNT
    P2FARE
    XTRANMY     
    TRNM_FLAG
    AIR_LINE
    CMN_YR
    CURRENT
BY AIRSELECT NOPRINT
BY AIRSELECT2 NOPRINT
BY AIRSELECT3 NOPRINT
BY AIRSELECT4 NOPRINT
BY AIRSELECT5 NOPRINT
BY AIRSELECT6 NOPRINT
BY AIRSELECT7 NOPRINT
BY AIRSELECT8 NOPRINT
BY AIRSELECT9 NOPRINT
BY CP_AIRLINE
BY AIRLINE_NAME
BY TRAN_MY


-**** Start - WHERE statement to test Flown Airlines selected *****************
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- AND &&AIR5 NE ' ' AND &&AIR6 NE ' ' AND &&AIR7 NE ' ' AND &&AIR8 NE ' '
- AND &&AIR9 NE ' ' THEN GOTO WHEREAIR9 ELSE GOTO CHKAIR8;

-WHEREAIR9
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' OR '&&AIR5' 
OR '&&AIR6' OR '&&AIR7' OR '&&AIR8' OR '&&AIR9'
-GOTO CHKDONE;

-CHKAIR8
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- AND &&AIR5 NE ' ' AND &&AIR6 NE ' ' AND &&AIR7 NE ' ' AND &&AIR8 NE ' '
- THEN GOTO WHEREAIR8 ELSE GOTO CHKAIR7;

-WHEREAIR8
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' OR '&&AIR5' OR
'&&AIR6' OR '&&AIR7' OR '&&AIR8' 
-GOTO CHKDONE;

-CHKAIR7
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- AND &&AIR5 NE ' ' AND &&AIR6 NE ' ' AND &&AIR7 NE ' '
- THEN GOTO WHEREAIR7 ELSE GOTO CHKAIR6;

-WHEREAIR7
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' OR 
'&&AIR5' OR '&&AIR6' OR '&&AIR7'
-GOTO CHKDONE;

-CHKAIR6
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- AND &&AIR5 NE ' ' AND &&AIR6 NE ' ' THEN GOTO WHEREAIR6 ELSE GOTO CHKAIR5;

-WHEREAIR6
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' OR 
'&&AIR5' OR '&&AIR6'
-GOTO CHKDONE;


-CHKAIR5
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- AND &&AIR5 NE ' ' THEN GOTO WHEREAIR5 ELSE GOTO CHKAIR4;

-WHEREAIR5
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' OR 
'&&AIR5'
-GOTO CHKDONE;

-CHKAIR4
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' AND &&AIR4 NE ' '
- THEN GOTO WHEREAIR4 ELSE GOTO CHKAIR3;

-WHEREAIR4
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' OR '&&AIR4' 
-GOTO CHKDONE;

-CHKAIR3
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' AND &&AIR3 NE ' ' 
- THEN GOTO WHEREAIR3 ELSE GOTO CHKAIR2;

-WHEREAIR3
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2' OR '&&AIR3' 
-GOTO CHKDONE;

-CHKAIR2
-IF &&AIR1 NE ' ' AND &&AIR2 NE ' ' THEN GOTO WHEREAIR2 ELSE GOTO CHKAIR1;

-WHEREAIR2
WHERE CP_AIRLINE EQ '&&AIR1' OR '&&AIR2'  
-GOTO CHKDONE;

-CHKAIR1
-IF &&AIR1 NE ' ' THEN GOTO WHEREAIR1 ELSE GOTO CHKDONE;

-WHEREAIR1
WHERE CP_AIRLINE EQ '&&AIR1'  
-GOTO CHKDONE;

-CHKDONE
-**** End - WHERE statement to test Flown Airlines selected *******************

ON TABLE HOLD AS TCHOLD1 
END
-RUN

-IF &LINES EQ 0 THEN GOTO NEXTONE;
-*========================================================================
-*   PROCESS EXTRACTED DATA FROM ABOVE
-*========================================================================

DEFINE FILE TCHOLD1
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE TCHOLD1
SUM AIRLINE_NAME
    AIR_LINE
    P1CNT
    P1FARE 
    P2CNT
    P2FARE
    XTRANMY
    TRNM_FLAG
    CMN_YR
    CURRENT
BY ROLLCD
BY CP_AIRLINE
BY TRAN_MY
ON TABLE HOLD AS CPHOLD2 
END
-RUN

MODIFY FILE TCSMP
FIXFORM FROM CPHOLD2
MATCH ROLLCD CP_AIRLINE TRAN_MY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON CPHOLD2
END
-RUN

DEFINE FILE HOLD1
AIRLINE_NAME/A12 = 'ALL AIRLINES';
CP_AIRLINE/A3 = 'ZZZ';
AIR_LINE/A3 = 'ZZZ';
ROLLCD/A8 = '&&ROLL';
END
TABLE FILE HOLD1
SUM AIRLINE_NAME 
    AIR_LINE
    P1CNT
    P1FARE 
    P2CNT
    P2FARE
    TRAN_MY
    XTRANMY
    TRNM_FLAG
    CMN_YR
    CURRENT
BY ROLLCD
BY CP_AIRLINE
BY TRAN_MY
ON TABLE HOLD AS CPHOLD3
END
-RUN

MODIFY FILE TCSMP
FIXFORM FROM CPHOLD3
MATCH ROLLCD CP_AIRLINE TRAN_MY
ON NOMATCH INCLUDE
ON MATCH REJECT
DATA ON CPHOLD3
END
-RUN

-NEXTONE
