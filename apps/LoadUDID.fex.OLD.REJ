-*=======================================================================
-* retrive all clients to be updated    
-* CALLS LOAD_UDID.FEX
-* Updated on Feb 3rd, 2006 to retrieve COMP from ROLLUP database
-*=======================================================================
-*SET TEMPERASE = OFF
-*-SET &ECHO = ALL;
-SET &&WEB_PATH=
- TEMPPATH(50,'A50');
SET EDAPATH=+&&WEB_PATH;
SET ASNAMES=ON
APP MAP SRCDATA  D:\As400
APP APPENDPATH SRCDATA  
-RUN

-SET &&AS400_PATH = 'D:\AS400\';
-SET &&COM_PATH  = 'D:\TNT\TTRACKER\DATA\';

-SET &AA0=&&AS400_PATH || 'TTPUDAA0.TXT';
-SET &CA0=&&AS400_PATH || 'TTPUDCA0.TXT';
-SET &HA0=&&AS400_PATH || 'TTPUDHA0.TXT';

FI TTPUDAA0 DISK &AA0
FI TTPUDCA0 DISK &CA0
FI TTPUDHA0 DISK &HA0

-****06/16/2006 START OF CHANGE *******************************
TABLE FILE TTPUDAA0
SUM ROLLUP_CODE 
BY ROLLUP_CODE NOPRINT
WHERE ROLLUP_CODE NE ' '
ON TABLE HOLD AS HOLDA 
END
-RUN
-SET &AIRHOLD = IF &LINES GT 0 THEN 'Y' ELSE 'N';

-*CHECK CAR FILE
TABLE FILE TTPUDCA0
SUM ROLLUP_CODE 
BY ROLLUP_CODE NOPRINT
WHERE ROLLUP_CODE NE ' '
ON TABLE HOLD AS HOLDC 
END
-RUN
-SET &CARHOLD = IF &LINES GT 0 THEN 'Y' ELSE 'N';

TABLE FILE TTPUDHA0
SUM ROLLUP_CODE 
BY ROLLUP_CODE NOPRINT
WHERE ROLLUP_CODE NE ' '
ON TABLE HOLD AS HOLDH
END
-RUN
-SET &HTLHOLD = IF &LINES GT 0 THEN 'Y' ELSE 'N';

-IF &AIRHOLD EQ 'N' AND &CARHOLD EQ 'N' AND &HTLHOLD EQ 'N' THEN GOTO ENDOFUDID;

-IF &AIRHOLD EQ 'Y' AND &CARHOLD EQ 'Y' AND &HTLHOLD EQ 'Y' THEN GOTO COMBINE1
- ELSE IF &AIRHOLD EQ 'N' AND &CARHOLD EQ 'Y' AND &HTLHOLD EQ 'Y' THEN GOTO COMBINE2
- ELSE IF &AIRHOLD EQ 'Y' AND &CARHOLD EQ 'N' AND &HTLHOLD EQ 'Y' THEN GOTO COMBINE3
- ELSE IF &AIRHOLD EQ 'N' AND &CARHOLD EQ 'N' AND &HTLHOLD EQ 'Y' THEN GOTO COMBINE4
- ELSE IF &AIRHOLD EQ 'Y' AND &CARHOLD EQ 'Y' AND &HTLHOLD EQ 'N' THEN GOTO COMBINE5
- ELSE IF &AIRHOLD EQ 'Y' AND &CARHOLD EQ 'N' AND &HTLHOLD EQ 'N' THEN GOTO COMBINE6
- ELSE IF &AIRHOLD EQ 'N' AND &CARHOLD EQ 'Y' AND &HTLHOLD EQ 'N' THEN GOTO COMBINE7;


-COMBINE1
MATCH FILE HOLDA
BY ROLLUP_CODE
RUN
FILE HOLDC
BY ROLLUP_CODE
ON MATCH HOLD OLD-OR-NEW
END
-RUN
MATCH FILE HOLD
BY ROLLUP_CODE
RUN
FILE HOLDH
BY ROLLUP_CODE
ON MATCH HOLD OLD-OR-NEW
END
-RUN
TABLE FILE HOLD
BY ROLLUP_CODE
ON TABLE SAVE
END
-GOTO STARTIT;

-COMBINE2
MATCH FILE HOLDC
BY ROLLUP_CODE
RUN
FILE HOLDH
BY ROLLUP_CODE
ON MATCH HOLD OLD-OR-NEW
END
-RUN
TABLE FILE HOLD
BY ROLLUP_CODE
ON TABLE SAVE
END
-RUN
-GOTO STARTIT;

-COMBINE3
MATCH FILE HOLDA
BY ROLLUP_CODE
RUN
FILE HOLDH
BY ROLLUP_CODE
ON MATCH HOLD OLD-OR-NEW
END
-RUN
TABLE FILE HOLD
BY ROLLUP_CODE
ON TABLE SAVE
END
-RUN
-GOTO STARTIT;

-COMBINE4
TABLE FILE HOLDH
BY ROLLUP_CODE
ON TABLE SAVE
END
-RUN
-GOTO STARTIT;

-COMBINE5
MATCH FILE HOLDA
BY ROLLUP_CODE
RUN
FILE HOLDC
BY ROLLUP_CODE
ON MATCH HOLD OLD-OR-NEW
END
-RUN
TABLE FILE HOLD
BY ROLLUP_CODE
ON TABLE SAVE
END
-RUN
-GOTO STARTIT;

-COMBINE6
TABLE FILE HOLDA
BY ROLLUP_CODE
ON TABLE SAVE
END
-RUN
-GOTO STARTIT;

-COMBINE7

TABLE FILE HOLDC
BY ROLLUP_CODE
ON TABLE SAVE
END
-RUN
-GOTO STARTIT;

-****06/16/2006 END OF CHANGE *******************************


-STARTIT
-SET &CNT = &LINES;
-SET &CNT2 = 1;
-REPEAT TOEND &CNT TIMES
-READ SAVE NOCLOSE &ROLLUP.8.
-SET &ROLL.&CNT2 = &ROLLUP;
-SET &CNT2 = &CNT2 + 1;
-TOEND
-CLOSE SAVE

-SET &CNT2 = 1;

-REPEAT TOEND2 &CNT TIMES
-SET &&RUP = &ROLL.&CNT2;

-**********************************
-*get comp from rollup database 
-**********************************
TABLE FILE ROLLUP
PRINT COMP
WHERE ROLLUP_CODE EQ '&&RUP'
ON TABLE SAVE AS SAVE2
END
-RUN

-READ SAVE2 &&COMP.6.
-CLOSE SAVE2
-*-IF &&RUP NE 'RODALE-R' THEN GOTO INCRCNT2;


EX LOAD_UDID
-RUN
-INCRCNT2
-SET &CNT2 = &CNT2 + 1;
-TOEND2

-ENDOFUDID
