-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
 
-* File HVIEW1SM.FEX
 
-**********************************************************************
-*DATE           NAME               DESCRIPTION
-*7/31/00      IBISTL-KR            ADDED DEFINE FOR NOWTOD WHICH IS
-*                                  USED IN FOOTERSM
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-*4/17/01      TANDT-SS             ADDED DOD_TYPE.
-*07/03/02   STEVE              CHANGED TO eTTek Review and Copyright
-*9/22/03     JOY               ADDED NEW CODE TO CALCULATE TOTALS %S
-*                              CORRECTLY
-*10/28/03    DEB               CARRIED THROUGH NEW_TOTAL_AMT
-*11/19/03    jk                Corrected Modify so report would not error
-*                              out in run_set
-*05/05/05    DEB               ADDED CODE FOR GLOBAL CURRENCY 
-*9/28/06     DEB               ADDED SORT BY LEVEL_DESC
-*2/25/08     DEB               ADDED ADDITIONAL CODE FOR HDRR REPORT NOT
-*                              DRILLING CORRECTELY - HDHPN
-*9/11/14     joy               Carried thru fields for new %s based upon exclude flags
-*9/24/14     JOY               ADDED LOGIC FOR PREF/NON-PREF PERCENTAGES
-*5/14/15 - joy - STORY ID - S-08873 - Changed to correct Global Currency Error
-*6/8/15 - joy - STORY ID - S-08873 - Update story id had a transposed number within line above
-*6/8/15 - joy - STORY ID - S-09493 - Updated footer to include more verbiage related to % omitting data based upon preferred/non-preferred setup
-*12/9/15 - DLV - S-13284   Updated to allow reports to sort/subtotal by id-levels
-*01/12/15 - DLV - S-14416 - corrected LEVEL_DESC define to show grand totals
-*03/13/17 - DLV - S-22486 - updated ettek Review to Post-trip Reporting
-*09/29/2017 JEM S-35465 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*10/25/2017 RSB S-38044 Place the footer date/time stamp text in a separate file to be -INCLUDED in the stylesheets 
-*11/17/17 JEM S-42229 Updating % of nights to show as zero if the number if both calculation numbers are LT 0
-*
-**********************************************************************
SET ASNAMES = ON
-RUN
-INCLUDE SETECHO 

 
-IF &&CURRENCY EQ 'USD' THEN GOTO SKIPTHIS;

-IF &&SETF EQ 'ABHPN1' GOTO ABHPN1G;
 
-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,ROOM, AMOUNT, (' | &&CURRENCY || ')';
-SET &GADR_CUR = ' AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &GSAV_CUR = ' SAVINGS, (' | &&CURRENCY || ')';
-SET &GLSV_CUR = ' LOST,SVGS, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2='AMT_TOTL1/D16.2C AS ' | '''&TAMT_CUR.EVAL''';
-SET &&S_SUBJ3='COMPUTE GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND ';
-SET &&S_SUBJ4='(NNROOMS LT 0) THEN ((AMT_TOTL1/NNROOMS)*(-1)) ELSE ';
-SET &&S_SUBJ5='IF ((NNROOMS LT 1) AND (NNROOMS GT (-1))) THEN 0 ELSE  ';
-SET &&S_SUBJ6='(AMT_TOTL1/NNROOMS); AS ' | '''&GADR_CUR.EVAL''' ;
-SET &&S_SUBJ9='SLSAV_TTL1/D16.2C AS ' | '''&GSAV_CUR.EVAL''' ;
-SET &&S_SUBJ10='GLSV/D16.2C AS ' | '''&GLSV_CUR.EVAL''' ;
-SET &&SUMM_ON4='ON LEVEL_DESC RECOMPUTE NNROOMS AMT_TOTL1 GAVGAMT BOOKINGS';
-SET &&SUMM_ON5='SLSAV_TTL1 GLSV AS ''TOTAL''';
-GOTO SKIPTHIS; 

-ABHPN1G;
-SET &&SUBHEAD = <NAMEC;
-SET &TAMT_CUR = ' TOTAL,ROOM, AMOUNT, (' | &&CURRENCY || ')';
-SET &GADR_CUR = ' AVG,DAILY,RATE, (' | &&CURRENCY || ')';
-SET &GSAV_CUR = ' SAVINGS, (' | &&CURRENCY || ')';
-SET &GLSV_CUR = ' LOST,SVGS, (' | &&CURRENCY || ')';
-SET &&S_SUBJ2='AMT_TOTL1/D16.2C AS ' | '''&TAMT_CUR.EVAL''';
-SET &&S_SUBJ3='COMPUTE GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND ';
-SET &&S_SUBJ4='(NNROOMS LT 0) THEN ((AMT_TOTL1/NNROOMS)*(-1)) ELSE ';
-SET &&S_SUBJ5='IF ((NNROOMS LT 1) AND (NNROOMS GT (-1))) THEN 0 ELSE  ';
-SET &&S_SUBJ6='(AMT_TOTL1/NNROOMS); AS ' | '''&GADR_CUR.EVAL''' ;
-SET &&S_SUBJ9='SLSAV_TTL1/D16.2C AS ' | '''&GSAV_CUR.EVAL''' ;
-SET &&S_SUBJ10='GLSV/D16.2C AS ' | '''&GLSV_CUR.EVAL''' ;
-SET &&SUMM_ON4='ON CITY_ST RECOMPUTE MULTILINES NNROOMS';
-SET &&SUMM_ON5='AMT_TOTL1 GAVGAMT BOOKINGS SLSAV_TTL1 GLSV AS ''TOTAL''';
-SET &&SUMM_ON7 = ' '; 
-GOTO SKIPTHIS; 
 
-SKIPTHIS;

-IF &&SETF EQ 'ABHPN1' GOTO ABHPN1;
-IF &&SETF EQ 'ABHPN2' GOTO ABHPN2;

TABLE FILE HTLHLD2
SUM
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  AROLL_DSC7
  BOOKINGS
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  TTL_NGT
  TOTAL_AMT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1/D16.2CS
  RATE_ROOM1/D16.2CS
  AMT_PREF1/D16.2CS
  AMT_NPREF1/D16.2CS
  STD_TOTAL1/D16.2CS
  SLSAV_TTL1/D16.2CS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
ON TABLE HOLD AS XTWO
END
-RUN

TABLE FILE HTLHLD2
SUM NNROOMS3 AS 'TNROOMS' NNROOMS AS 'TNROOMST'
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD AS HTLHOLD
END
-RUN
 

DEFINE FILE XTWO
AROLL_DSC3_CENTERED/A60 = CTRFLD(AROLL_DSC3, 60, 'A60');
AROLL_DSC4_CENTERED/A60 = CTRFLD(AROLL_DSC4, 60, 'A60');
AROLL_DSC5_CENTERED/A60 = CTRFLD(AROLL_DSC5, 60, 'A60');
AROLL_DSC7_CENTERED/A60 = CTRFLD(AROLL_DSC7, 60, 'A60');
END
MATCH FILE XTWO
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  GNAVG
-*  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_NON
  PREF_AMT
  PREF_NGT
  TTL_NGT
  TOTAL_AMT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD
RUN
FILE HTLHOLD
SUM TNROOMS TNROOMST  
BY LEVEL_DESC
BY CITY_ST
AFTER MATCH HOLD AS HHHLD OLD-OR-NEW
END
-RUN
 
TABLE FILE HTLHLD2
SUM BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                        ((PREF_AMT/PREF_NGT)*(-1)) ELSE
                     IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P12.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                        ((AMT_PREF1/PREF_NGT)*(-1)) ELSE
                      IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREF
END
-RUN
 
MATCH FILE HHHLD
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  GNAVG
-*  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD
RUN
FILE HOLDPREF
SUM PAVG
    GPAVG
BY LEVEL_DESC
BY CITY_ST
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN
 
DEFINE FILE XTHREE
PAVG1/D12.3 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/D16.3 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
TNROOMS1/P12CS = IF NNROOMS2E LT 0 AND TNROOMS LT 0 THEN 0 ELSE TNROOMS;
FLAG/A1 = 'A';
END


TABLE FILE XTHREE
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   LEVEL_DESC
  GNAVG
-*  HTL_PREF_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  PAVG1
  GPAVG
  GPAVG1
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2CS=IF (TOTAL_AMT LT 0) AND (NNROOMS LT 0) THEN
                         ((TOTAL_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (TOTAL_AMT/NNROOMS);
       GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND (NNROOMS LT 0) THEN
                         ((AMT_TOTL1/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (AMT_TOTL1/NNROOMS);
       NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
                    ((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
       GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
                    ((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
       PAVG2/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                    ((PREF_AMT/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
       GPAVG2/P16.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                    ((AMT_PREF1/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
       PCTNBRN1/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMSPN/TNROOMS1)*100);                
       PCTNBRN/P12.2 = IF PCTNBRN1 LT 0 AND NAVG2 GT 0 THEN PCTNBRN1 * (-1) ELSE
                       IF PCTNBRN1 LT 0 AND PAVG2 GT 0 THEN PCTNBRN1 * (-1) ELSE PCTNBRN1;
                       
       PPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2I/TNROOMS1)*100);
       NPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2E/TNROOMS1)*100);                           
   NAVGA/P12.2C = IF NAVG LT 0 THEN NAVG*(-1) ELSE NAVG;
   PAVGA/P12.2C = IF PAVG1 LT 0 THEN PAVG1*(-1) ELSE PAVG1;
   GNAVGA/P12.2C = IF GNAVG LT 0 THEN GNAVG*(-1) ELSE GNAVG;
   GPAVGA/P12.2C = IF GPAVG1 LT 0 THEN GPAVG1*(-1) ELSE GPAVG;
 -*  LSV/P12.2C = IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);
   LSV/P12.2C = IF NAVGA-PAVGA LE 0 THEN 0 ELSE
                IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);           

   GLSV/P16.2C = IF GPAVGA EQ 0 THEN 0 ELSE ((GNAVGA-GPAVGA)*NPREF_NGT);
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
ON TABLE HOLD AS HHOLD4 FORMAT FOCUS
END
-RUN


 
DEFINE FILE HTLHLD2
-*LEVEL_DESC/A60 = 'GRAND TOTAL';
LEVEL_DESC/A80 = 'GRAND TOTAL';
CITY_ST/A35 = 'TOTAL';
END
-RUN
TABLE FILE HTLHLD2
SUM BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN ((PREF_AMT/PREF_NGT)*(-1)) ELSE
                     IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P12.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN ((AMT_PREF1/PREF_NGT)*(-1)) ELSE
                      IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREFT
END
-RUN 
 
DEFINE FILE HTLHLD2
FLAG/A1 = 'B';
-*LEVEL_DESC/A60 = 'GRAND TOTAL';
LEVEL_DESC/A80 = 'GRAND TOTAL';
CITY_ST/A35 = 'TOTAL';
AROLL_DSC3_CENTERED/A60 = CTRFLD(AROLL_DSC3, 60, 'A60');
AROLL_DSC4_CENTERED/A60 = CTRFLD(AROLL_DSC4, 60, 'A60');
AROLL_DSC5_CENTERED/A60 = CTRFLD(AROLL_DSC5, 60, 'A60');
AROLL_DSC7_CENTERED/A60 = CTRFLD(AROLL_DSC7, 60, 'A60'); 
END
TABLE FILE HTLHLD2
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   GNAVG
-*   NAVG
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAMEC
  NBR_DAYS
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NEW_TOTAL_AMT
  NPREF_AMT
  NPREF_NGT
-*  PAVG
-*   GPAVG
-*  HTL_PREF_DESC
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;  
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
ON TABLE HOLD AS JKHOLD1
END
-RUN
 
 
MATCH FILE JKHOLD1
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
-*   HTL_PREF_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
  FLAG
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD
RUN
FILE HOLDPREFT
SUM PAVG
    GPAVG
BY LEVEL_DESC
BY CITY_ST
AFTER MATCH HOLD AS XFOUR OLD-OR-NEW
END
-RUN
  
DEFINE FILE HTLHOLD
FLAG/A1='B';
END
 
TABLE FILE HTLHOLD
SUM TNROOMS 
BY FLAG
ON TABLE HOLD AS JHOLD1
END
-RUN
 
MATCH FILE XFOUR
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  CITY_ST
  LEVEL_DESC
  GNAVG
-*   HTL_PREF_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
ON TABLE HOLD
RUN
FILE JHOLD1
SUM TNROOMS
BY FLAG
AFTER MATCH HOLD AS TTLHOLD OLD-OR-NEW
END
-RUN


 
 
DEFINE FILE TTLHOLD
 
FLAG/A1 = 'B';
PAVG1/P12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/P16.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
TNROOMS1/P12CS = IF NNROOMS2E GT TNROOMS THEN 0 ELSE TNROOMS;
-* TNROOMS1/P12CS = IF NNROOMS2E LT 0 AND TNROOMS LT 0 THEN 0 ELSE TNROOMS;

END

 
TABLE FILE TTLHOLD
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   LEVEL_DESC
  GNAVG
-*  HTL_PREF_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  PAVG1
  GPAVG
  GPAVG1
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2CS=IF (TOTAL_AMT LT 0) AND (NNROOMS LT 0) THEN
                         ((TOTAL_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (TOTAL_AMT/NNROOMS);
       GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND (NNROOMS LT 0) THEN
                         ((AMT_TOTL1/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (AMT_TOTL1/NNROOMS);
       NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
                    ((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
       GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
                    ((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
       PAVG2/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                    ((PREF_AMT/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
       GPAVG2/P16.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                    ((AMT_PREF1/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
-*       PCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
-*                          ((NNROOMSPN/TNROOMS1)*100);                    
       PCTNBRN1/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMSPN/TNROOMS1)*100);                
       PCTNBRN/P12.2 = IF PCTNBRN1 LT 0 AND NAVG2 GT 0 THEN PCTNBRN1 * (-1) ELSE
                       IF PCTNBRN1 LT 0 AND PAVG2 GT 0 THEN PCTNBRN1 * (-1) ELSE PCTNBRN1;
       PPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2I/TNROOMS1)*100);
       NPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2E/TNROOMS1)*100);                           
   NAVGA/P12.2C = IF NAVG LT 0 THEN NAVG*(-1) ELSE NAVG;
   PAVGA/P12.2C = IF PAVG1 LT 0 THEN PAVG1*(-1) ELSE PAVG1;
   GNAVGA/P12.2C = IF GNAVG LT 0 THEN GNAVG*(-1) ELSE GNAVG;
   GPAVGA/P12.2C = IF GPAVG1 LT 0 THEN GPAVG1*(-1) ELSE GPAVG;
-*   LSV/P12.2C = IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);
     LSV/P12.2C = IF NAVGA-PAVGA LE 0 THEN 0 ELSE 
                  IF PAVGA EQ 0 THEN 0 ELSE((NAVGA-PAVGA)*NPREF_NGT);           

   GLSV/P16.2C = IF GPAVGA EQ 0 THEN 0 ELSE ((GNAVGA-GPAVGA)*NPREF_NGT);
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-*BY HTL_PREF_DESC
ON TABLE HOLD AS HHOLD5 FORMAT FOCUS
END
-RUN
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK1=&HLDPATH || 'HHOLD4.FOC';
-SET &HRANK2=&HLDPATH || 'HHOLD5.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&HRANK1 AS HHOLD4
&HRANK2 AS HHOLD4
END
-RUN

-* -IF &&SETF EQ 'HDHPN' THEN GOTO HDRR;
 
TABLE FILE HHOLD4
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  NAVG
  GNAVG
-*   HTL_PREF_DESC
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PCTNBRN
  PPCTNBRN
  NPCTNBRN
  PAVG1
  PAVG
  GPAVG1
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AVGAMT
  NAVG2
  GNAVG2
  PAVG2
  GPAVG2
  LSV
  GLSV
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
ON TABLE HOLD AS JOYTEST 
END
-RUN
  
-GOTO Finish;
 
-HDRR;
 
 
TABLE FILE HHOLD4
SUM NNROOMS AS 'TNROOMS'
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
ON TABLE HOLD AS SPL
END
-RUN
 
MATCH FILE HHOLD4
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  NAVG
  GNAVG
  LEVEL1
  LEVEL2
  LEVEL3
  LEVEL4
  LEVEL5
  LEVEL6
  LEVEL7
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  NPCTNBRN
  PPCTNBRN
  PCTNBRN
  PAVG1
  PAVG
  GPAVG1
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AVGAMT
  NAVG2
  GNAVG2
  PAVG2
  GPAVG2
  LSV
  GLSV
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
ON TABLE HOLD
RUN
FILE SPL
SUM TNROOMS
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
-* BY HTL_PREF_DESC
AFTER MATCH HOLD AS JOYTEST OLD-OR-NEW
END
-RUN


 
-Finish;
 
TABLE FILE CONTROL
PRINT ROLLUP_CODE
BY ROLLUP_CODE NOPRINT
ON TABLE SAVE AS XUSER
END
-RUN
-READ XUSER &&RLUP.A8.
-RUN
 
-SET &&RPT_TTL2=IF &&SETF EQ 'NYHPNFPU' THEN '<AROLL_DSC5_CENTERED' ELSE 
-               IF &&SETF EQ 'NYHPNFP3' THEN '<AROLL_DSC3_CENTERED' ELSE 
-               IF &&SETF EQ 'NYHPNFP4' THEN '<AROLL_DSC4_CENTERED' ELSE &&RPT_TTL2;
 
DEFINE FILE JOYTEST
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
-* HTLPDSC/A41 = '*'||HTL_PREF_DESC;
-* HTLPDESC/A41 = IF NNROOMS3 EQ 0 THEN HTL_PREF_DESC ELSE HTLPDSC;
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE JOYTEST
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
-IF &&SETF EQ 'ITHPN' THEN GOTO WHR ELSE GOTO NOWHR;
-WHR
WHERE FLAG EQ 'A'
-NOWHR
 
 
-IF &&RLUP EQ 'METX-R' THEN GOTO METX;
-IF &&SETF EQ 'NYHPNF' OR 'NYHPNFPU'  OR 'NYHPNFP3' OR 'NYHPNFP4' THEN GOTO NYLFOOT;
-IF &&SETF EQ 'UPHPN'  THEN GOTO UPHPN;
-IF &&SETF EQ 'UPHPN1' THEN GOTO UPHPN1;
-IF &&SETF EQ 'UPHPN2' THEN GOTO UPHPN2;
-IF &&SETF EQ 'UPHPN3' THEN GOTO UPHPN3;
-IF &&SETF EQ 'BZHPN'  THEN GOTO BZHPN; 
-*
-SET &FTR_AddlLines = 6;
FOOTING BOTTOM
"</2"
"* BASED UPON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT, % ONLY MAY CONTAIN EXCLUSIONS"
"LOST SAVINGS = NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE "
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-GOTO FOOTER_END;
-*
-********
-NYLFOOT;
-********
-SET &FTR_AddlLines = 11;
FOOTING BOTTOM
"</2"
"Preferred Cities include: Addison TX, Albany NY, Alpharetta GA, Austin TX, Bethesda MD, Bloomington MN, Boston MA, Charleston SC, Chicago IL, Cleveland OH, Dallas TX, Denver CO, Detroit MI,"
"Dublin OH, Franklin TN, Ft.Lauderdale FL, Houston TX, Lebanon NJ, Little Rock AR, Los Angeles CA, New Orleans LA, Newton MA, New York NY, Norfolk VA, Norwood MA, Omaha NE, Orlando FL,"
"Overland Park KS, Oxnard CA, Parsippany NJ, Philadelphia PA, Reno NV, San Francisco CA, Scottsdale AZ, St.Louis MO, Tampa FL, Tarrytown NY, Walnut Creek CA, Washingon DC, Westminster CO"
" "
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"Lost Savings is Based on The Following Calculation:"
"Non-Preferred Average Nightly Rate - Preferred Average Nightly Rate"
"Multiplied by Non-Preferred Number of Nights"
-GOTO FOOTER_END;
-*
-****** 
-METX
-****** 
-GOTO FOOTER_END
-*
-****** 
-UPHPN
-****** 
-SET &FTR_AddlLines = 8;
FOOTING BOTTOM
"</2"
"INCLUDES ALL BUT REASON CODE E"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-GOTO FOOTER_END
-*
-****** 
-UPHPN1
-****** 
-SET &FTR_AddlLines = 8;
FOOTING BOTTOM
"</2"
"INCLUDES REASON CODES G & M ONLY"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-GOTO FOOTER_END
-*
-****** 
-UPHPN2
-****** 
-SET &FTR_AddlLines = 8;
FOOTING BOTTOM
"</2"
"INCLUDES ALL BUT REASON CODES E, G, & M"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-GOTO FOOTER_END
-*
-****** 
-UPHPN3
-****** 
-SET &FTR_AddlLines = 8;
FOOTING BOTTOM
"</2"
"INCLUDES ALL BUT REASON CODES C, E, G, N, M, S, T, U, & X"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-GOTO FOOTER_END
-*
-****** 
-BZHPN
-****** 
-SET &FTR_AddlLines = 8;
FOOTING BOTTOM
"</2"
"EXCLUDES REASON CODES I, N & S"
"* BASED ON PREFERRED VS. NON-PREFERRED CALCULATIONS SETUP FOR THE ACCOUNT"
"LOST SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
"NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
"MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-*
-***********
-FOOTER_END
-***********
-INCLUDE FOOTERSM
-*
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
-IF &&SETF EQ 'NYHPNF' OR 'NYHPNFPU' OR 'NYHPNFP3' OR 'NYHPNFP4' THEN GOTO NYLSTY;
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYS
-GOTO NEXTSTY;
 
-NYLSTY;
 
ON TABLE SET STYLE *
 
-INCLUDE NYLSTYH
 
 
-NEXTSTY;
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&SETF EQ 'NYHPN' OR 'ITHPN' THEN GOTO SKIP_DRILL;
-IF &&DRILLABLE EQ 'N' THEN GOTO SKIP_DRILL;
-INCLUDE &&DSTY
 
-SKIP_DRILL
 
ENDSTYLE
&&OUTLINE1
&&OUTLINE2
END
-RUN
 
-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3;
 
EX REPORT_3
 
-SKIP_R3

 

-GOTO XXIT;

-ABHPN1;

TABLE FILE HTLHLD2
SUM
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  AROLL_DSC7
  BOOKINGS
  LEVEL_DESC
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  TTL_NGT
  TOTAL_AMT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1/D16.2CS
  RATE_ROOM1/D16.2CS
  AMT_PREF1/D16.2CS
  AMT_NPREF1/D16.2CS
  STD_TOTAL1/D16.2CS
  SLSAV_TTL1/D16.2CS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS XTWO
END
-RUN


 
TABLE FILE HTLHLD2
SUM NNROOMS3 AS 'TNROOMS' NNROOMS AS 'TNROOMST'
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD AS HTLHOLD
END
-RUN
 
DEFINE FILE XTWO
AROLL_DSC3_CENTERED/A60 = CTRFLD(AROLL_DSC3, 60, 'A60');
AROLL_DSC4_CENTERED/A60 = CTRFLD(AROLL_DSC4, 60, 'A60');
AROLL_DSC5_CENTERED/A60 = CTRFLD(AROLL_DSC5, 60, 'A60');
AROLL_DSC7_CENTERED/A60 = CTRFLD(AROLL_DSC7, 60, 'A60');
END
MATCH FILE XTWO
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_NON
  PREF_AMT
  PREF_NGT
  TTL_NGT
  TOTAL_AMT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD
RUN
FILE HTLHOLD
SUM TNROOMS TNROOMST  
BY LEVEL_DESC
BY CITY_ST
AFTER MATCH HOLD AS HHHLD OLD-OR-NEW
END
-RUN
 
TABLE FILE HTLHLD2
SUM BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                        ((PREF_AMT/PREF_NGT)*(-1)) ELSE
                     IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P12.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                        ((AMT_PREF1/PREF_NGT)*(-1)) ELSE
                      IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREF
END
-RUN
 
MATCH FILE HHHLD
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD
RUN
FILE HOLDPREF
SUM PAVG
    GPAVG
BY LEVEL_DESC
BY CITY_ST
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN

 
 
DEFINE FILE XTHREE
PAVG1/D12.3 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/D16.3 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
TNROOMS1/P12CS = IF NNROOMS2E GT TNROOMS THEN 0 ELSE TNROOMS;
FLAG/A1 = 'A';
END



TABLE FILE XTHREE
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  PAVG1
  GPAVG
  GPAVG1
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2CS=IF (TOTAL_AMT LT 0) AND (NNROOMS LT 0) THEN
                         ((TOTAL_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (TOTAL_AMT/NNROOMS);
       GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND (NNROOMS LT 0) THEN
                         ((AMT_TOTL1/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (AMT_TOTL1/NNROOMS);
       NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
                    ((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
       GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
                    ((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
       PAVG2/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                    ((PREF_AMT/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
       GPAVG2/P16.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                    ((AMT_PREF1/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
       PCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMSPN/TNROOMS1)*100);                    
       PPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2I/TNROOMS1)*100);
       NPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2E/TNROOMS1)*100);                           
   NAVGA/P12.2C = IF NAVG LT 0 THEN NAVG*(-1) ELSE NAVG;
   PAVGA/P12.2C = IF PAVG1 LT 0 THEN PAVG1*(-1) ELSE PAVG1;
   GNAVGA/P12.2C = IF GNAVG LT 0 THEN GNAVG*(-1) ELSE GNAVG;
   GPAVGA/P12.2C = IF GPAVG1 LT 0 THEN GPAVG1*(-1) ELSE GPAVG;
-*   LSV/P12.2C = IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);
     LSV/P12.2C = IF NAVGA-PAVGA LE 0 THEN 0 ELSE 
                  IF PAVGA EQ 0 THEN 0 ELSE((NAVGA-PAVGA)*NPREF_NGT);           

   GLSV/P16.2C = IF GPAVGA EQ 0 THEN 0 ELSE ((GNAVGA-GPAVGA)*NPREF_NGT);
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS HHOLD4 FORMAT FOCUS
END
-RUN

 
DEFINE FILE HTLHLD2
-*LEVEL_DESC/A60 = 'GRAND TOTAL';
LEVEL_DESC/A80 = 'GRAND TOTAL';
CITY_ST/A35 = 'TOTAL';
END
-RUN
TABLE FILE HTLHLD2
SUM BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN ((PREF_AMT/PREF_NGT)*(-1)) ELSE
                     IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P12.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN ((AMT_PREF1/PREF_NGT)*(-1)) ELSE
                      IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREFT
END
-RUN
 
 
 
DEFINE FILE HTLHLD2
FLAG/A1 = 'B';
-*LEVEL_DESC/A60 = 'GRAND TOTAL';
LEVEL_DESC/A80 = 'GRAND TOTAL';
CITY_ST/A35 = 'TOTAL';
AROLL_DSC3_CENTERED/A60 = CTRFLD(AROLL_DSC3, 60, 'A60');
AROLL_DSC4_CENTERED/A60 = CTRFLD(AROLL_DSC4, 60, 'A60');
AROLL_DSC5_CENTERED/A60 = CTRFLD(AROLL_DSC5, 60, 'A60');
AROLL_DSC7_CENTERED/A60 = CTRFLD(AROLL_DSC7, 60, 'A60'); 
END
TABLE FILE HTLHLD2
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   GNAVG
-*   NAVG
  NAMEC
  NBR_DAYS
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NEW_TOTAL_AMT
  NPREF_AMT
  NPREF_NGT
-*  PAVG
-*   GPAVG
-*  HTL_PREF_DESC
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;  
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS JKHOLD1
END
-RUN
 
 
MATCH FILE JKHOLD1
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
  FLAG
BY LEVEL_DESC
BY CITY_ST
ON TABLE HOLD
RUN
FILE HOLDPREFT
SUM PAVG
    GPAVG
BY LEVEL_DESC
BY CITY_ST
AFTER MATCH HOLD AS XFOUR OLD-OR-NEW
END
-RUN
 
 
 
 
DEFINE FILE HTLHOLD
FLAG/A1='B';
END
 
TABLE FILE HTLHOLD
SUM TNROOMS 
BY FLAG
ON TABLE HOLD AS JHOLD1
END
-RUN
 
MATCH FILE XFOUR
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  CITY_ST
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
ON TABLE HOLD
RUN
FILE JHOLD1
SUM TNROOMS
BY FLAG
AFTER MATCH HOLD AS TTLHOLD OLD-OR-NEW
END
-RUN


 
 
DEFINE FILE TTLHOLD
 
FLAG/A1 = 'B';
PAVG1/P12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/P16.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
-* TNROOMS1/P12CS = IF NNROOMS2E GT TNROOMS THEN 0 ELSE TNROOMS;
TNROOMS1/P12CS = IF NNROOMS2E LT 0 AND TNROOMS LT 0 THEN 0 ELSE TNROOMS;

END

 
TABLE FILE TTLHOLD
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  PAVG1
  GPAVG
  GPAVG1
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2CS=IF (TOTAL_AMT LT 0) AND (NNROOMS LT 0) THEN
                         ((TOTAL_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (TOTAL_AMT/NNROOMS);
       GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND (NNROOMS LT 0) THEN
                         ((AMT_TOTL1/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (AMT_TOTL1/NNROOMS);
       NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
                    ((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
       GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
                    ((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
       PAVG2/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                    ((PREF_AMT/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
       GPAVG2/P16.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                    ((AMT_PREF1/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
       PCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                          ((NNROOMSPN/TNROOMS1)*100);                    
       PPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2I/TNROOMS1)*100);
       NPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2E/TNROOMS1)*100);                           
   NAVGA/P12.2C = IF NAVG LT 0 THEN NAVG*(-1) ELSE NAVG;
   PAVGA/P12.2C = IF PAVG1 LT 0 THEN PAVG1*(-1) ELSE PAVG1;
   GNAVGA/P12.2C = IF GNAVG LT 0 THEN GNAVG*(-1) ELSE GNAVG;
   GPAVGA/P12.2C = IF GPAVG1 LT 0 THEN GPAVG1*(-1) ELSE GPAVG;
-*   LSV/P12.2C = IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);
   LSV/P12.2C = IF NAVGA-PAVGA LE 0 THEN 0 ELSE 
                IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);           

   GLSV/P16.2C = IF GPAVGA EQ 0 THEN 0 ELSE ((GNAVGA-GPAVGA)*NPREF_NGT);
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS HHOLD5 FORMAT FOCUS
END
-RUN

-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK1=&HLDPATH || 'HHOLD4.FOC';
-SET &HRANK2=&HLDPATH || 'HHOLD5.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&HRANK1 AS HHOLD4
&HRANK2 AS HHOLD4
END
-RUN
 
 
TABLE FILE HHOLD4
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  NAVG
  GNAVG
  HTL_PREF_DESC
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PCTNBRN
  PPCTNBRN
  NPCTNBRN
  PAVG1
  PAVG
  GPAVG1
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AVGAMT
  NAVG2
  GNAVG2
  PAVG2
  GPAVG2
  LSV
  GLSV
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
BY LEVEL_DESC
BY CITY_ST
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS JOYTEST 
END
-RUN 

 
TABLE FILE CONTROL
PRINT ROLLUP_CODE
BY ROLLUP_CODE NOPRINT
ON TABLE SAVE AS XUSER
END
-RUN
-READ XUSER &&RLUP.A8.
-RUN
 
 
DEFINE FILE JOYTEST
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
HTLPDSC/A41 = '*'||HTL_PREF_DESC;
HTLPDESC/A41 = IF NNROOMS3 EQ 0 THEN HTL_PREF_DESC ELSE HTLPDSC;
END

-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE JOYTEST
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
"</1>"
"* INCLUDED IN PREFERRED/NON-PREFERRED CALCULATION"
-* "Lost SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
-* "NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
-* "MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-*
-INCLUDE FOOTERSM
-*
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYS

 
-NEXTSTY;
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' THEN GOTO SKIP_DRILL;
-INCLUDE &&DSTY
 
-SKIP_DRILL
 
ENDSTYLE
&&OUTLINE1
&&OUTLINE2
END
-RUN
 
-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3A;
 
EX REPORT_3A
 
-SKIP_R3
-GOTO XXIT;


-ABHPN2;

TABLE FILE HTLHLD2
SUM
  AROLL_DSC3
  AROLL_DSC4
  AROLL_DSC5
  AROLL_DSC7
  BOOKINGS
  LEVEL_DESC
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  TTL_NGT
  TOTAL_AMT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1/D16.2CS
  RATE_ROOM1/D16.2CS
  AMT_PREF1/D16.2CS
  AMT_NPREF1/D16.2CS
  STD_TOTAL1/D16.2CS
  SLSAV_TTL1/D16.2CS
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS XTWO
END
-RUN



 
TABLE FILE HTLHLD2
SUM NNROOMS3 AS 'TNROOMS' NNROOMS AS 'TNROOMST'
BY LEVEL_DESC
ON TABLE HOLD AS HTLHOLD
END
-RUN
 
DEFINE FILE XTWO
AROLL_DSC3_CENTERED/A60 = CTRFLD(AROLL_DSC3, 60, 'A60');
AROLL_DSC4_CENTERED/A60 = CTRFLD(AROLL_DSC4, 60, 'A60');
AROLL_DSC5_CENTERED/A60 = CTRFLD(AROLL_DSC5, 60, 'A60');
AROLL_DSC7_CENTERED/A60 = CTRFLD(AROLL_DSC7, 60, 'A60');
END
MATCH FILE XTWO
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_NON
  PREF_AMT
  PREF_NGT
  TTL_NGT
  TOTAL_AMT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HTLHOLD
SUM TNROOMS TNROOMST  
BY LEVEL_DESC
AFTER MATCH HOLD AS HHHLD OLD-OR-NEW
END
-RUN
 
TABLE FILE HTLHLD2
SUM BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                        ((PREF_AMT/PREF_NGT)*(-1)) ELSE
                     IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P12.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                        ((AMT_PREF1/PREF_NGT)*(-1)) ELSE
                      IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREF
END
-RUN
 
MATCH FILE HHHLD
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDPREF
SUM PAVG
    GPAVG
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN

 
 
DEFINE FILE XTHREE
PAVG1/D12.3 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/D16.3 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
-* TNROOMS1/P12CS = IF NNROOMS2E GT TNROOMS THEN 0 ELSE TNROOMS;
TNROOMS1/P12CS = IF NNROOMS2E LT 0 AND TNROOMS LT 0 THEN 0 ELSE TNROOMS;

FLAG/A1 = 'A';
END



TABLE FILE XTHREE
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  PAVG1
  GPAVG
  GPAVG1
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2CS=IF (TOTAL_AMT LT 0) AND (NNROOMS LT 0) THEN
                         ((TOTAL_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (TOTAL_AMT/NNROOMS);
       GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND (NNROOMS LT 0) THEN
                         ((AMT_TOTL1/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (AMT_TOTL1/NNROOMS);
       NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
                    ((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
       GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
                    ((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
       PAVG2/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                    ((PREF_AMT/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
       GPAVG2/P16.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                    ((AMT_PREF1/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
       PCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMSPN/TNROOMS1)*100);                    
       PPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2I/TNROOMS1)*100);
       NPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2E/TNROOMS1)*100);                           
   NAVGA/P12.2C = IF NAVG2 LT 0 THEN NAVG2*(-1) ELSE NAVG2;
   PAVGA/P12.2C = IF PAVG2 LT 0 THEN PAVG2*(-1) ELSE PAVG2;
   GNAVGA/P12.2C = IF GNAVG LT 0 THEN GNAVG*(-1) ELSE GNAVG;
   GPAVGA/P12.2C = IF GPAVG1 LT 0 THEN GPAVG1*(-1) ELSE GPAVG;
   LSV/P12.2C = IF NAVGA-PAVGA LE 0 THEN 0 ELSE 
                IF PAVGA EQ 0 THEN 0 ELSE ((NAVGA-PAVGA)*NPREF_NGT);
   GLSV/P16.2C = IF GPAVGA EQ 0 THEN 0 ELSE ((GNAVGA-GPAVGA)*NPREF_NGT);
BY FLAG
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS HHOLD4 FORMAT FOCUS
END
-RUN

 
DEFINE FILE HTLHLD2
-*LEVEL_DESC/A60 = 'GRAND TOTAL';
LEVEL_DESC/A80 = 'GRAND TOTAL';
END
-RUN
TABLE FILE HTLHLD2
SUM BOOKINGS
COMPUTE PAVG/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN ((PREF_AMT/PREF_NGT)*(-1)) ELSE
                     IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
COMPUTE GPAVG/P12.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN ((AMT_PREF1/PREF_NGT)*(-1)) ELSE
                      IF ((PREF_NGT LT 1) AND (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
WHERE PREF_NON EQ 'PREFERRED'
ON TABLE HOLD AS HOLDPREFT
END
-RUN
 
 
 
DEFINE FILE HTLHLD2
FLAG/A1 = 'B';
LEVEL_DESC/A60 = 'GRAND TOTAL';
CITY_ST/A35 = 'TOTAL';
AROLL_DSC3_CENTERED/A60 = CTRFLD(AROLL_DSC3, 60, 'A60');
AROLL_DSC4_CENTERED/A60 = CTRFLD(AROLL_DSC4, 60, 'A60');
AROLL_DSC5_CENTERED/A60 = CTRFLD(AROLL_DSC5, 60, 'A60');
AROLL_DSC7_CENTERED/A60 = CTRFLD(AROLL_DSC7, 60, 'A60'); 
END
TABLE FILE HTLHLD2
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   GNAVG
-*   NAVG
  NAMEC
  NBR_DAYS
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NEW_TOTAL_AMT
  NPREF_AMT
  NPREF_NGT
-*  PAVG
-*   GPAVG
-*  HTL_PREF_DESC
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE NAVG/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
COMPUTE GNAVG/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
(NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;  
BY FLAG
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS JKHOLD1
END
-RUN

 
 
MATCH FILE JKHOLD1
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
  FLAG
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE HOLDPREFT
SUM PAVG
    GPAVG
BY LEVEL_DESC
AFTER MATCH HOLD AS XFOUR OLD-OR-NEW
END
-RUN
 

 
DEFINE FILE HTLHOLD
FLAG/A1='B';
END
 
TABLE FILE HTLHOLD
SUM TNROOMS 
BY FLAG
ON TABLE HOLD AS JHOLD1
END
-RUN


 
MATCH FILE XFOUR
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
ON TABLE HOLD
RUN
FILE JHOLD1
SUM TNROOMS
BY FLAG
AFTER MATCH HOLD AS TTLHOLD OLD-OR-NEW
END
-RUN


 
 
DEFINE FILE TTLHOLD
 
FLAG/A1 = 'B';
PAVG1/P12.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE PAVG;
GPAVG1/P16.2 = IF PREF_NON EQ 'PREFERRED' THEN 0 ELSE GPAVG;
-* TNROOMS1/P12CS = IF NNROOMS2E GT TNROOMS THEN 0 ELSE TNROOMS;
TNROOMS1/P12CS = IF NNROOMS2E LT 0 AND TNROOMS LT 0 THEN 0 ELSE TNROOMS;

END

 
TABLE FILE TTLHOLD
SUM
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
-*   LEVEL_DESC
  GNAVG
  HTL_PREF_DESC
  NAVG
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PAVG
  PAVG1
  GPAVG
  GPAVG1
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
COMPUTE AVGAMT/D12.2CS=IF (TOTAL_AMT LT 0) AND (NNROOMS LT 0) THEN
                         ((TOTAL_AMT/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (TOTAL_AMT/NNROOMS);
       GAVGAMT/D16.2CS=IF (AMT_TOTL1 LT 0) AND (NNROOMS LT 0) THEN
                         ((AMT_TOTL1/NNROOMS)*(-1)) ELSE IF ((NNROOMS LT 1) AND
                         (NNROOMS GT (-1))) THEN 0 ELSE (AMT_TOTL1/NNROOMS);
       NAVG2/P12.2 = IF ((NPREF_NGT LT 0) AND (NPREF_AMT LT 0)) THEN
                    ((NPREF_AMT/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE NPREF_AMT/NPREF_NGT;
       GNAVG2/P16.2 = IF ((NPREF_NGT LT 0) AND (AMT_NPREF1 LT 0)) THEN
                    ((AMT_NPREF1/NPREF_NGT)*(-1)) ELSE IF ((NPREF_NGT LT 1) AND
                    (NPREF_NGT GT (-1))) THEN 0 ELSE AMT_NPREF1/NPREF_NGT;
       PAVG2/P12.2 = IF ((PREF_NGT LT 0) AND (PREF_AMT LT 0)) THEN
                    ((PREF_AMT/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE PREF_AMT/PREF_NGT;
       GPAVG2/P16.2 = IF ((PREF_NGT LT 0) AND (AMT_PREF1 LT 0)) THEN
                    ((AMT_PREF1/PREF_NGT)*(-1)) ELSE IF ((PREF_NGT LT 1) AND
                    (PREF_NGT GT (-1))) THEN 0 ELSE AMT_PREF1/PREF_NGT;
       PCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                          ((NNROOMSPN/TNROOMS1)*100);                    
       PPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2I/TNROOMS1)*100);
       NPCTNBRN/P12.2 = IF ((TNROOMS1 LT 1) AND (TNROOMS1 GT (-1))) THEN 0 ELSE
                           ((NNROOMS2E/TNROOMS1)*100);                           
  NAVGA/P12.2C = IF NAVG2 LT 0 THEN NAVG2*(-1) ELSE NAVG2;
  PAVGA/P12.2C = IF PAVG2 LT 0 THEN PAVG2*(-1) ELSE PAVG2;
   GNAVGA/P12.2C = IF GNAVG LT 0 THEN GNAVG*(-1) ELSE GNAVG;
   GPAVGA/P12.2C = IF GPAVG1 LT 0 THEN GPAVG1*(-1) ELSE GPAVG;
   LSV/P12.2C = IF NAVGA-PAVGA LE 0 THEN 0 ELSE 
                IF PAVGA EQ 0 THEN 0 ELSE((NAVGA-PAVGA)*NPREF_NGT);
   GLSV/P16.2C = IF GPAVGA EQ 0 THEN 0 ELSE ((GNAVGA-GPAVGA)*NPREF_NGT);
BY FLAG
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS HHOLD5 FORMAT FOCUS
END
-RUN

 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &HRANK1=&HLDPATH || 'HHOLD4.FOC';
-SET &HRANK2=&HLDPATH || 'HHOLD5.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&HRANK1 AS HHOLD4
&HRANK2 AS HHOLD4
END
-RUN
 
 
TABLE FILE HHOLD4
PRINT
  AROLL_DSC3
  AROLL_DSC3_CENTERED
  AROLL_DSC4
  AROLL_DSC4_CENTERED
  AROLL_DSC5
  AROLL_DSC5_CENTERED
  AROLL_DSC7
  AROLL_DSC7_CENTERED
  BOOKINGS
  NAVG
  GNAVG
  HTL_PREF_DESC
  NAMEC
  NBR_DAYS
  NEW_TOTAL_AMT
  NNROOMS
  NNROOMS2E
  NNROOMS2I
  NNROOMSPN
  NNROOMS3
  NPREF_AMT
  NPREF_NGT
  PCTNBRN
  PPCTNBRN
  NPCTNBRN
  PAVG1
  PAVG
  GPAVG1
  GPAVG
  PREF_AMT
  PREF_NGT
  PREF_NON
  TNROOMS1
  TOTAL_AMT
  TTL_NGT
  TOTAL_SLSAV
  TOTAL_STD
  AVGAMT
  NAVG2
  GNAVG2
  PAVG2
  GPAVG2
  LSV
  GLSV
  AMT_TOTL1
  RATE_ROOM1
  AMT_PREF1
  AMT_NPREF1
  STD_TOTAL1
  SLSAV_TTL1
BY FLAG
BY LEVEL_DESC
BY PREF_NON
BY HTL_PREF_DESC
ON TABLE HOLD AS JOYTEST 
END
-RUN 
 
TABLE FILE CONTROL
PRINT ROLLUP_CODE
BY ROLLUP_CODE NOPRINT
ON TABLE SAVE AS XUSER
END
-RUN
-READ XUSER &&RLUP.A8.
-RUN
 
 
DEFINE FILE JOYTEST
NOWTOD/A8 WITH LEVEL_DESC = HHMMSS (NOWTOD);
HTLPDSC/A41 = '*'||HTL_PREF_DESC;
HTLPDESC/A41 = IF NNROOMS3 EQ 0 THEN HTL_PREF_DESC ELSE HTLPDSC;
PREF_NON1/A30 = IF PREF_NON EQ 'PREFERRED' AND NNROOMS3 NE 0 THEN 'PREFERRED' ELSE
                IF PREF_NON EQ 'NON-PREFERRED' AND NNROOMS3 NE 0 THEN 'NON-PREFERRED' ELSE
                IF NNROOMS3 EQ 0 THEN 'NOT INCLUDED IN CALCULATION' ELSE ' ';
PFLAG/A1 = IF PREF_NON1 EQ 'PREFERRED' THEN 'A' ELSE
           IF PREF_NON1 EQ 'NON-PREFERRED' THEN 'B' ELSE 'C';
END


-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS'; 
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
-RUN

TABLE FILE JOYTEST
-INCLUDE &&PAHDR
"&&SUBHEAD"
-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
"</2"
-NOSPC;
    &&S_SUBJ1
    &&S_SUBJ2
    &&S_SUBJ3
    &&S_SUBJ4
    &&S_SUBJ5
    &&S_SUBJ6
    &&S_SUBJ7
    &&S_SUBJ8
    &&S_SUBJ9
    &&S_SUBJ10
    &&S_SUBJ11
    &&S_SUBJ12
    &&S_SUBJ13
    &&S_SUBJ14
    &&S_SUBJ15
    &&S_SUBJ16
    &&S_SUBJ17
    &&S_SUBJ18
    &&S_SUBJ19
    &&S_SUBJ20
 
-*BY
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
-*ON
&&BREAKOPTION
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
-*
-SET &FTR_AddlLines = 3;
FOOTING BOTTOM
"</1>"
"* INCLUDED IN PREFERRED/NON-PREFERRED CALCULATION"
-* "Lost SAVINGS IS BASED ON THE FOLLOWING CALCULATION:"
-* "NON-PREFERRED AVERAGE NIGHTLY RATE - PREFERRED AVERAGE NIGHTLY RATE"
-* "MULTIPLIED BY NON-PREFERRED NUMBER OF NIGHTS"
-*
-INCLUDE FOOTERSM
-*
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/11/00      IBISTL-SB            CHANGED THE SET STYLE STATEMENT
-*                                  WITH AN INCLUDE
-**********************************************************************
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
 
ON TABLE SET STYLE *
 
-INCLUDE &&PASTYS

 
-NEXTSTY;
-**********************************************************************
-*DATE           NAME               DESCRIPTION OF CHANGE
-*----           ----               ---------------------
-*8/18/00      IBISTL-KR            INCLUDE STYLESHEET PARAMS FOR
-*                                  DRILLABLE REPORTS.
-**********************************************************************
-IF &&DRILLABLE EQ 'N' THEN GOTO SKIP_DRILL;
-INCLUDE &&DSTY
 
-SKIP_DRILL
 
ENDSTYLE
&&OUTLINE1
&&OUTLINE2
END
-RUN
 
-IF &&DRILLABLE EQ 'Y' GOTO SKIP_R3A;
 
EX REPORT_3A
 
-SKIP_R3
-GOTO XXIT;

-XXIT;
