 
-**********************************************************************
-* Summary by Hierarchy - Air
-* 7/8/13 - Added defines/carried thru fields for CCI exchange fields
-* 9/23/13 Added code to be able to run by travel date - Deb
-*1/7/14    UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-* 3/18/14 Shortened LVL_PRINT so report displays on 1 page in pdf - Deb
-*3/20/14  Added logic for Petsmart report - JK
-* 5/8/14 Removed Period2 from PSSMHIER report - Deb
-*6/11/14 Changed some code due to AVG adv pur days not balancing detail-Deb
-*7/16/14 Updated subtotal font size to fit to one page - Joy
-*7/30/14 Updated Pets-r to show &&footer1 and &&footer2 - Joy
-*9/10/14 Updated routine for Pets-r to remove prior date selection entirely 
-*        due to if prior data found but no current data the current data
-*        would show up with 0 - Deb
-* 9/11/14 Updated routine for Pets to Rank by TACH (Total air car hotel)
-*         Deb
-* 1/5/15 - Story S-06758 - Changed Avg Nbr of Bkg Days on ABSMHIER to
-*         Adv Pur Days
-*  02/02/2015  REJ  S-05681 Changes to the no data report to prepare for the Available
-*                           Report changes.  Rollup Code is being removed from BRPTINST in
-*                           ER5, so I'm removing the reference to the ROLLUP_CODE in that report.
-*  02/05/2015  REJ  S-05681 Changes for Available Reports.  Adding code so that the
-*                           program will run in current Review and in Available Reports.
-*  08/04/2015  REJ  S-10079 Latest changes for ER5 Available Reports.  Added code so the footer 
-*                           page with the selection criteria would show.
-* Story ID S-10086 Added &&overdrill flag logic for use in 5.0 to choose to for the report to be drillable or non-drillable - 9/15/15 - JM
-* 3/1/16 - JEM - Updated for NYSMHIER version which includes less fields than the standard
-* 3/3/16 - JEM - Removed CPM field from NYSMHIER per Monica to receive approval
-*02/24/17  DLV S-22486 - updated position of header and footer NEW_HDR NEW_FTR
-*4/25/2017-JEM-S-33318-updated logic for no records report
-*05/11/2017-JEM-D-01491-working with report to get it to fit to one page
-* 05/24/2017 JEM S-34216 - updating to make styling/heading/positioning more consistent
-* 06/12/2017 RSB S-35760 HNS-R Monthly report errors links did not work
-*                         changes marked with -* RSB
-* 06/20/2017 JEM S-35017 Updating column titles on final output to try and save space
-* 09/15/2017 RSB S-38044 Place the footer datetime stamp text in a separate file to be -INCLUDED in the stylesheets
-*                         Removed the old cright_footer and replaced with -INCLUDE FOOTERSM
-*                         With the embedded stylesheets added: TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-* 09/20/2017 CA S-35421 Report view to be updated with standard footer (part 4)

-**********************************************************************
-INCLUDE SETECHO
-*
-* FTR_DateTimePosit sets the position of the Post-trip date/time stamp text within the footer image.
-* The default line number (&FTR_DateTimeLine) in the FOOTING for the date/time stamp text is: 4.
-INCLUDE FTR_DateTimePosit
-*
SET ASNAMES = ON
SET SPACE = 1
-SET &FMM=EDIT(&&FROMDT,'$$$$$$99');
-SET &FMD=EDIT(&&FROMDT,'$$$$$$$$$99');
-SET &FMY=EDIT(&&FROMDT,'$9999');
-SET &TOM=EDIT(&&TODT,'$$$$$$99');
-SET &TOD=EDIT(&&TODT,'$$$$$$$$$99');
-SET &TOY=EDIT(&&TODT,'$9999');
-* PRIOR DATES
-SET &FXMM=EDIT(&&FXDATE,'$$$$$$99');
-SET &FXMD=EDIT(&&FXDATE,'$$$$$$$$$99');
-SET &FXMY=EDIT(&&FXDATE,'$9999');
-SET &TXOM=EDIT(&&TXDATE,'$$$$$$99');
-SET &TXOD=EDIT(&&TXDATE,'$$$$$$$$$99');
-SET &TXOY=EDIT(&&TXDATE,'$9999');
-SET &&SP = '|';
-SET &&SP1A = IF &&ROLLNME EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP1 = IF &&ROLLCS EQ ' ' THEN ' ' ELSE &&SP1A;
-SET &&SP3 = IF &&ROLLCNCT EQ ' ' THEN ' ' ELSE &&SP;
-SET &&SP4 = IF &&ROLLPHN EQ ' ' THEN ' ' ELSE &&SP;
-SET &&RCNCT = &&ROLLCNCT.LENGTH;
-SET &&CSL = &&ROLLCS.LENGTH;
-SET &&REL = &&ROLLEMAIL.LENGTH;

-SET &&RCSL = &&RCNCT.EVAL + &&CSL.EVAL;

-SET &&CSLPA = IF '&&ROLLUP.EVAL' EQ 'ABCD-R' THEN 80 ELSE 
-              IF '&&ROLLEMAIL.EVAL' NE ' ' AND &&REL GT 20 THEN 68 ELSE
-              IF &&RCSL LE 21 THEN 80 ELSE 
-              IF &&RCSL LE 31 THEN 75 ELSE 68;

-* -SET &&CSLPA = IF &&RCNCT.EVAL GE 15 OR &&CSL.EVAL GE 10 THEN 68 ELSE 75;
-*-SET &&CSLP = IF '&&ROLLUP.EVAL' EQ 'BOOZ-R' THEN 88 ELSE &&CSLPA;

-SET &&CSLP = IF '&&ROLLUP.EVAL' EQ 'BOOZ-R' AND &&ORIENTATION LIKE 'L%' THEN 88 
- ELSE IF '&&ROLLUP.EVAL' EQ 'BOOZ-R' AND &&ORIENTATION LIKE 'P%' THEN 68 
- ELSE IF '&&ROLLUP.EVAL' EQ 'HDRR-R' AND &&ORIENTATION LIKE 'L%' THEN 80
- ELSE IF &&ORIENTATION LIKE 'P%' THEN &&CSLPA-15 ELSE &&CSLPA;
-SET &&BLANK = ' ';
-SET &&ROLLPHNEML = IF '&&ROLLEMAIL.EVAL' GT ' ' THEN '&&ROLLEMAIL.EVAL' ELSE '&&ROLLPHN.EVAL';
-RUN
 
-SET &WHATDATE = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'TRN_DATE' ELSE 'FST_DPT_DATE';
 
-IF &&SETF.EVAL EQ 'CHSMHIER' THEN GOTO CHEP;
-IF &&SETF.EVAL EQ 'BASMHIER' THEN GOTO BAIR;
 
CREATE FILE QRHIER
-RUN
 
-IF &&SETF.EVAL EQ 'PSSMHIER' THEN GOTO PETS;
 
 
-*********************************************************************************
-* Gather/Add Air Info to QRHIER File
-*********************************************************************************
 
DEFINE FILE SR_50
  CURRENT/A1 = IF &WHATDATE.EVAL GE &&FROMDT.EVAL AND &WHATDATE.EVAL LE &&TODT.EVAL THEN 'Y' ELSE 'N';
  PRIOR/A1 = IF &WHATDATE.EVAL GE &&FXDATE.EVAL AND &WHATDATE.EVAL LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';
 
  BRK_LVL/I2 = &&BRK_LVL;
  LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999');
  FARE_PAID/P12.2 = SEG_AMT + SEG_TAX;
  AIRLINE_FEE/D8.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN FARE_PAID ELSE 0;
 
  NET_TKT_CNT/P12    = IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (FARE_PAID GE 0) AND
                          (SEG_COUNT EQ 1) AND
                          (CONJ_REL EQ 1) THEN 1 ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (EX_FLAG EQ 'F') THEN (-1) ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
 
  SAVINGS/P12.2     = SEG_STANDARD - FARE_PAID;
  NEW_ADV_PURCH/D9    = ADV_PURCH;
 
  NEW_SEG_MILES/D12 = SEG_MILES;
 -* Defines on Previous Defines
  DISSAVINGS/P12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                   FARE_PAID-SEG_LOWEST;
 
-* Defines added for CCI exchange fields
TTLDAYS/P8 = NEW_ADV_PURCH*NET_TKT_CNT ;
 
F_EXCH_CNT/D8CS   = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND
                           (CONJ_REL EQ 1) THEN 0 ELSE
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (EX_FLAG EQ 'F') THEN 1 ELSE 0;
CFEXCH/P12CS = IF CURRENT EQ 'Y' THEN F_EXCH_CNT ELSE 0;
CAIR_FEE/P12.2 = IF CURRENT EQ 'Y' THEN AIRLINE_FEE ELSE 0;
CTTLDAYS/P9 = IF CURRENT EQ 'Y' THEN TTLDAYS ELSE 0;
END
-RUN
 
 
TABLEF FILE SR_50
PRINT CGADV
  CURRENT
  PRIOR
  DISSAVINGS
  DOD_TYPE
  AIR_MAIN.INTL_DOM AS 'INTDOM'
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
  CFEXCH
  CAIR_FEE
  CTTLDAYS
  RF_FLAG
  EX_FLAG
WHERE (&WHATDATE.EVAL GE &&FROMDT.EVAL) AND (&WHATDATE.EVAL LE &&TODT.EVAL) OR
      (&WHATDATE.EVAL GE &&FXDATE.EVAL) AND (&WHATDATE.EVAL LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHOLD
END
-RUN
 
 
TABLE FILE RPTHOLD
PRINT CGADV
  CFEXCH
  CAIR_FEE
  DISSAVINGS
  DOD_TYPE
  INTDOM
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
  RF_FLAG
  EX_FLAG
  CTTLDAYS
BY CURRENT
BY PRIOR
BY LEVEL_DESC
-IF &&SETF NE 'ABSMHID' GOTO SKIPDom;
WHERE INTDOM NE 'I'
-SKIPDom;
-IF &&SETF NE 'ABSMHII' GOTO SKIPInt;
WHERE INTDOM EQ 'I'
-SKIPInt;
ON TABLE HOLD AS TRANONE
END
-RUN
 
 
 
 
-IF &LINES EQ 0 THEN GOTO NOREC;
 
-SET &&RPTSUF = 'HIERSUM';
-INCLUDE FDEFRPTS
-RUN
 
 
DEFINE FILE TRANONE
NEW_ADV_PURCH1/D9 = IF RF_FLAG EQ ' ' THEN NEW_ADV_PURCH ELSE
                    IF EX_FLAG EQ ' ' THEN NEW_ADV_PURCH ELSE (NEW_ADV_PURCH * (-1));
REC_CNT/D8CS = IF NET_TKT_CNT EQ 1 THEN 1 ELSE 0;
TTLDAYS/D8 = NEW_ADV_PURCH*NET_TKT_CNT;
 
 
CAVOL/P12.2 = IF CURRENT EQ 'Y' THEN FARE_PAID ELSE 0;
CMILES/P12 = IF CURRENT EQ 'Y' THEN NEW_SEG_MILES ELSE 0;
PAVOL/P12.2 = IF PRIOR EQ 'Y' THEN FARE_PAID ELSE 0;
CNTKT/P12 = IF CURRENT EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CNTKTD/P12 = IF CURRENT EQ 'Y' AND INTDOM EQ 'D' THEN NET_TKT_CNT ELSE 0;
PNTKT/P12 = IF PRIOR EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CLSAV/P12.2 = IF CURRENT EQ 'Y' THEN DISSAVINGS ELSE 0;
CADVT/P12 = IF (CURRENT EQ 'Y') AND
                (CGADV EQ '0-6') THEN NET_TKT_CNT ELSE 0;
CADVT1/P12 = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN NET_TKT_CNT ELSE 0;
CONL/P12 = IF (CURRENT EQ 'Y') AND (ONLINE_TRADITIONAL EQ 'ONLINE') AND (INTDOM EQ 'D') THEN
                  NET_TKT_CNT ELSE 0;
CNR/P12 = IF (CURRENT EQ 'Y') AND (NONREF_FLAG EQ 'N') THEN
              NET_TKT_CNT ELSE 0;
CTTLDAYS/D8 = IF CURRENT EQ 'Y' THEN TTLDAYS ELSE 0;
END
-RUN
 
 
TABLE FILE TRANONE
SUM CADVT
    CADVT1
    CAVOL
    CLSAV
    CMILES
    CNR
    CNTKT
    CONL
    PNTKT
    CNTKTD
    CNR
    PAVOL
    CFEXCH/D12
    CAIR_FEE
    CTTLDAYS
BY LEVEL_DESC
ON TABLE HOLD AS TRANTWO
END
-RUN
 
 
 
 
 
 
TABLE FILE TRANTWO
PRINT CAVOL CMILES CNTKT PNTKT CLSAV PAVOL CADVT CADVT1 CONL CNTKTD CNR LEVEL_DESC CFEXCH CAIR_FEE CTTLDAYS
RANKED BY HIGHEST CAVOL
ON TABLE HOLD AS RNK1
END
-RUN
 
-INCLUDE OTHPARMS
-RUN
 
DEFINE FILE RNK1
-* RANK_LIMIT/I2 = 9999;
 RANK_LIMIT/I2 = &&RANK_LIMIT;
 RLIMIT/A2    = EDIT(RANK_LIMIT) ;
 CRANK/D5     = RANK;
 BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
 LIST/D6 = IF LEVEL_DESC NE LAST LEVEL_DESC THEN (LAST LIST + 1)
           ELSE LAST LIST;
 FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
 FRANK/A6  = EDIT(FRANKX,'$999999');
 RANK_VALUE/A9 = IF RANK_LIMIT EQ 0 THEN BRANK ELSE
                IF LIST GT RANK_LIMIT THEN 'ALL OTHER' ELSE FRANK;
 LVL_PRINT/A25 =IF RANK_VALUE LT RLIMIT THEN LEVEL_DESC ELSE 'ALL OTHER';
END
-RUN
 
TABLE FILE RNK1
SUM CAVOL CMILES CNTKT PNTKT CLSAV PAVOL CADVT CADVT1 CONL CNTKTD CNR CFEXCH CAIR_FEE CTTLDAYS
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS RNK2
END
-RUN
 
 
 
TABLE FILE RNK2
PRINT LVL_PRINT RANK_VALUE CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT PNTKT CONL CNTKTD PAVOL CFEXCH CAIR_FEE CTTLDAYS
ON TABLE SAVE
END
-RUN
 
 
MODIFY FILE QRHIER
LOG DUPL MSG OFF
FIXFORM LVL_PRINT/25 RANK_VALUE/9 CADVT/12 CADVT1/12 CAVOL/12 CLSAV/12 CMILES/12 CNR/12 CNTKT/12 PNTKT/12 CONL/12 CNTKTD/12 PAVOL/12 CFEXCH/12 CAIR_FEE/12 CTTLDAYS/8
MATCH RANK_VALUE LVL_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
 
TABLE FILE RNK1
SUM LST.LIST LVL_PRINT
WHERE LVL_PRINT NE 'ALL OTHER'
ON TABLE HOLD AS LASTRANK
END
-RUN
 
-IF &RECORDS EQ 0 THEN GOTO NOADD;
 
 
DEFINE FILE LASTRANK
NRANK/D6 = LIST + 1;
NRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
FRANK/A6  = EDIT(NRANKX,'$999999');
CAVOL/P12.2 =  0;
CMILES/P12 =  0;
PAVOL/P12.2 =  0;
CNTKT/P12 =  0;
CNTKTD/P12 =  0;
PNTKT/P12 =  0;
CLSAV/P12.2 =  0;
CADVT/P12 = 0;
CADVT1/P12 =  0;
CONL/P12 =  0;
CNR/P12 =  0;
CFEXCH/P12 = 0;
CAIR_FEE/P12.2 = 0;
CTTLDAYS/P8 = 0;
 RANK_VALUE/A9 = 'ALL OTHER' ;
 LVL_PRINT/A25=  'ALL OTHER';
END
TABLE FILE LASTRANK
PRINT NRANK LVL_PRINT RANK_VALUE CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT PNTKT CONL CNTKTD PAVOL CFEXCH CAIR_FEE CTTLDAYS
ON TABLE HOLD AS LASTRANK1
END
-RUN
 
TABLE FILE LASTRANK1
PRINT LVL_PRINT RANK_VALUE CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT PNTKT CONL CNTKTD PAVOL CFEXCH CAIR_FEE CTTLDAYS
ON TABLE SAVE
END
-RUN
 
MODIFY FILE QRHIER
LOG DUPL MSG OFF
FIXFORM LVL_PRINT/25 RANK_VALUE/9 CADVT/12 CADVT1/12 CAVOL/12 CLSAV/12 CMILES/12 CNR/12 CNTKT/12 PNTKT/12 CONL/12 CNTKTD/12 PAVOL/12 CFEXCH/12 CAIR_FEE/12 CTTLDAYS/8
MATCH RANK_VALUE LVL_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
-NOADD
DEFINE FILE RNK2
LVLP/A27 = ''''||LVL_PRINT||'''';
END
-RUN
TABLE FILE RNK2
PRINT LVLP
BY LVL_PRINT NOPRINT
ON TABLE SAVE AS LEVELF
END
-RUN
 
 
 
-*********************************************************************************
-* Gather/Add Car Info to QRHIER File Based upon
-*********************************************************************************
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW1;
-SET &&RPTGRP_OVERRIDE='CAR';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW1
 
EX CARUSE
-RUN
 
 
-SET &&RPTGRP = 'CAR';
EX UDIDGEN
-RUN
 
-INCLUDE RESETCPM
-RUN
 
 
-SET &WHATDATEC = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'INVOICE_DATE' ELSE 'PICKUP_DATE';
 
 
 
DEFINE FILE CR_50
 LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999');
 RENTAL_DAYS/P12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
END
 
-RUN
TABLE FILE CR_50
SUM RENTAL_DAYS
    RENTAL_AMT
BY LEVEL_DESC
 
-IF &&FROMAVRP EQ 'Y' GOTO :AVW2;
WHERE (&WHATDATEC.EVAL GE '&&FROMDT.EVAL') AND (&WHATDATEC.EVAL LE '&&TODT.EVAL')
-GOTO :AVW2_CONT;
-:AVW2
WHERE (&WHATDATEC.EVAL GE &&FROMDT.EVAL) AND (&WHATDATEC.EVAL LE &&TODT.EVAL)
-:AVW2_CONT
 
-IF &&SETF NE 'ABSMHID' GOTO NoDomonly;
WHERE PICK_CTY.INTL_DOM NE 'I'
-NoDomonly;
-IF &&SETF NE 'ABSMHII' GOTO NoIntonly;
WHERE PICK_CTY.INTL_DOM EQ 'I'
-NoIntonly;
-INCLUDE RPTPARMS
ON TABLE HOLD AS CAR1
END
-RUN
 
 
 
 
 
TABLE FILE CAR1
SUM RENTAL_AMT/P12.2 AS 'CARVOL'
    RENTAL_DAYS/P12 AS 'CARDAY'
BY LEVEL_DESC
ON TABLE HOLD AS CAR2
END
-RUN
 
 
-******************************************************
-* Matching Hierarchy Levels
-******************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY LEVEL_DESC
WHERE LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS CARMREC
END
-RUN
 
 
 
 
TABLE FILE CARMREC
SUM CARVOL
    CARDAY
BY LEVEL_DESC AS 'LVL_PRINT'
ON TABLE HOLD AS CARMREC1
END
-RUN
 
TABLE FILE CARMREC1
SUM CARVOL CARDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE QRHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 CARVOL/12 CARDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching information ALL OTHER
-**********************************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY LEVEL_DESC
WHERE NOT LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS CARNREC
END
-RUN
 
 
 
DEFINE FILE CARNREC
LVL_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE CARNREC
SUM CARVOL CARDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE QRHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 CARVOL/12 CARDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
 
-*********************************************************************************
-* Gather/Add HTL Info to QRHIER File
-*********************************************************************************
FILEDEF RPTPARMS CLEAR
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVW3;
-SET &&RPTGRP_OVERRIDE='HTL';
EX CODEGEN
-INCLUDE SELCATQT
-RUN
-:AVW3
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
-INCLUDE RESETHPM
-RUN
 
-SET &WHATDATEH = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'INVOICE_DATE' ELSE 'CHKIN_DATE';
 
 
 
DEFINE FILE HR_50
 LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999');
 NBR_DAYS/P12=NUM_DAYS;
 NEW_TOTAL_AMT/P12.2 = TOTAL_AMT;
 NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
END
-RUN
 
TABLE FILE HR_50
SUM NEW_TOTAL_AMT
    NNROOMS
BY LEVEL_DESC
-IF &&FROMAVRP EQ 'Y' GOTO :AVW4;
WHERE (&WHATDATEH.EVAL GE '&&FROMDT.EVAL') AND (&WHATDATEH.EVAL LE '&&TODT.EVAL')
-GOTO :AVW4_CONT;
-:AVW4
WHERE (&WHATDATEH.EVAL GE &&FROMDT.EVAL) AND (&WHATDATEH.EVAL LE &&TODT.EVAL)
-:AVW4_CONT

-INCLUDE RPTPARMS
ON TABLE HOLD AS HTL1
END
-RUN
 
 
 
-**************************************************************************
-* Matching Hotel Records
-**************************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY LEVEL_DESC
ON TABLE HOLD AS HTL2
END
-RUN
 
 
TABLE FILE HTL2
SUM HTLVOL
   HTLDAY
BY LEVEL_DESC
WHERE LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS HTLMREC
END
-RUN
 
TABLE FILE HTLMREC
SUM HTLVOL HTLDAY
BY LEVEL_DESC AS 'LVL_PRINT'
ON TABLE HOLD AS HTLMREC1
END
-RUN
 
TABLE FILE HTLMREC1
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE QRHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 HTLVOL/12 HTLDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching ALL OTHER Records
-**********************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY LEVEL_DESC
WHERE NOT LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS HTLNREC
END
-RUN
 
 
DEFINE FILE HTLNREC
LVL_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE HTLNREC
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE HOLD AS HTLNREC1
END
-RUN
 
TABLE FILE HTLNREC1
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE QRHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 HTLVOL/12 HTLDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-IF '&&SETF.EVAL' EQ 'SKSMHIER' GOTO SKECHVERSION;
-RUN
 
 
 
-SUMMARY
 
 
DEFINE FILE QRHIER
RANK_VALUEA/A9 = 'TOTAL';
LVL_PRINTA/A19 = 'TOTAL';
END
-RUN
 
TABLE FILE QRHIER
SUM CAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  CNTKT
  CLSAV/P12.2M
  PCT.CFEXCH/P4 AS 'PCTEX'
  CAIR_FEE/P12.2M
    CTTLDAYS/P8
 
COMPUTE ADVAP/P8 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE
            (CTTLDAYS/CNTKT);
-*COMPUTE ADVAP2/P8 = IF ((REC_CNT LT 1) AND (REC_CNT GT (-1))) THEN 0 ELSE
-*            (CTTLDAYS/REC_CNT);
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGT/P12.2M = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE CAVOL/CNTKT;
COMPUTE PAVGT/P12.2M = IF ((PNTKT LT 1) AND (PNTKT GT (-1))) THEN 0 ELSE PAVOL/PNTKT; NOPRINT
COMPUTE AAVGV/P12.2M = CAVGT - PAVGT; NOPRINT
COMPUTE AAVGV1/P12 = IF PAVGT EQ 0 THEN 0 ELSE (((CAVGT-PAVGT)/PAVGT)*100);
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CNRP/P12  = IF CNTKT EQ 0 THEN 0 ELSE ((CNR/CNTKT)*100);
 
COMPUTE CPMILE/P4.2 = IF CMILES EQ 0 THEN 0 ELSE (CAVOL/CMILES);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUEA AS 'RANK_VALUE'
-* BY LVL_PRINTA AS 'LVL_PRINT'
BY LVL_PRINTA
ON TABLE COLUMN-TOTAL
ON TABLE HOLD AS TTL1
END
-RUN
 
 
 
 
 
 
 
TABLE FILE TTL1
SUM CAVOL/P12.2M PCTVOL CNTKT/P12 CLSAV/P12 CTLS/P12 CAVGT/P12 AAVGV1/P12
    CADVP1/P12 CADVP2/P12 CONLP/P12 CNRP/P12 CPMILE/P10.2 PCTEX  CAIR_FEE/P12.2M CTTLDAYS/P8 ADVAP/P8 CARAR/P12 HTLARR/P12 TACH/P12
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TTL2
END
-RUN
 
TABLE FILE TTL2
PRINT CAVOL PCTVOL CNTKT CLSAV CTLS CAVGT AAVGV1 CADVP1 CADVP2
      CONLP CNRP CPMILE PCTEX CAIR_FEE CTTLDAYS ADVAP CARAR HTLARR TACH
BY RANK_VALUE
BY LVL_PRINT
 
ON TABLE HOLD AS TTL3 FORMAT FOCUS
END
-RUN
 
 
DEFINE FILE QRHIER
NWLVL_PRINT/A19 = EDIT(LVL_PRINT, '9999999999999999999');
END
TABLE FILE QRHIER
SUM CAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  CNTKT
  CLSAV/P12.2M
  PCT.CFEXCH/P4 AS 'PCTEX'
  CAIR_FEE/P12.2M
  CTTLDAYS/P8
 
COMPUTE ADVAP/P8 = IF ((CNTKT LT 1) AND ((CNTKT GT -1))) THEN 0 ELSE
                  (CTTLDAYS/CNTKT);
-*COMPUTE ADVAP/P8 = IF ((REC_CNT LT 1) AND (REC_CNT GT (-1))) THEN 0 ELSE
-*            (CTTLDAYS/REC_CNT);
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGT/P12.2M = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE CAVOL/CNTKT;
COMPUTE PAVGT/P12.2M = IF ((PNTKT LT 1) AND (PNTKT GT (-1))) THEN 0 ELSE PAVOL/PNTKT; NOPRINT
COMPUTE AAVGV/P12.2M = CAVGT - PAVGT; NOPRINT
COMPUTE AAVGV1/P12 = IF PAVGT EQ 0 THEN 0 ELSE (((CAVGT-PAVGT)/PAVGT)*100);
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CNRP/P12  = IF CNTKT EQ 0 THEN 0 ELSE ((CNR/CNTKT)*100);
COMPUTE CPMILE/P4.2 = IF CMILES EQ 0 THEN 0 ELSE (CAVOL/CMILES);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUE
BY NWLVL_PRINT AS 'LVL_PRINT'
ON TABLE HOLD AS TLEV1
END
-RUN
 
 
 
 
 
TABLE FILE TLEV1
 
 
PRINT CAVOL/P12 PCTVOL/P4 CNTKT/P12 CLSAV/P12 CTLS/P12 CAVGT/P12 AAVGV1/P12 CADVP1/P12 CADVP2/P12
      CONLP/P12 CNRP/P12 CPMILE/P10.2 PCTEX CAIR_FEE/P12.2 CTTLDAYS/P8 ADVAP/P8 CARAR/P12 HTLARR/P12 TACH/P12
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV2
END
-RUN
 
 
TABLE FILE TLEV2
 
PRINT CAVOL PCTVOL CNTKT CLSAV CTLS CAVGT AAVGV1 CADVP1 CADVP2
      CONLP CNRP CPMILE PCTEX CAIR_FEE CTTLDAYS ADVAP CARAR HTLARR TACH
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV3 FORMAT FOCUS
END
-RUN
 
 
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &PHOLD1=&HLDPATH || 'TLEV3.FOC';
-SET &PHOLD2=&HLDPATH || 'TTL3.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&PHOLD1 AS TLEV3
&PHOLD2 AS TLEV3
END
-RUN
 
 
DEFINE FILE TLEV3
RANK_VAL1/A9 = IF RANK_VALUE EQ 'TOTAL' THEN 'ZZ' ELSE RANK_VALUE;
END
-RUN
 
TABLE FILE TLEV3
SUM CAVOL PCTVOL CNTKT CLSAV CTLS CAVGT AAVGV1 CADVP1 CADVP2
    CONLP CNRP CPMILE PCTEX CAIR_FEE CTTLDAYS ADVAP CARAR HTLARR TACH
COMPUTE ZFLAG/A1 = IF (RANK_VAL1 EQ 'ALL OTHER') AND (TACH EQ 0) THEN 'Y' ELSE 'N';
BY RANK_VAL1
BY LVL_PRINT
ON TABLE HOLD AS TLEV4
END
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE OTHPARMS
-INCLUDE AVRP_SUBFOOT
-:AVSF0
-RUN

 
JOIN ROLL WITH RANK_VAL1 IN TLEV4 TO ROLLUP_CODE IN ROLLUP AS J1
-RUN
 
DEFINE FILE TLEV4
NOWTOD/A8 WITH RANK_VAL1 = HHMMSS (NOWTOD);
ROLL/A8='&&ROLLUP.EVAL';
  RPHONE/A15=EDIT(ROLL_PHONE,'9-999-999-9999');
  RN/A60=TRIM('B', '&&RPT_TTL1.EVAL', 60, ' ', 1, 'A60');
  RN1/A60=TRIM('B', '&&RPT_TTL2.EVAL', 60, ' ', 1, 'A60');
  TDATE1/A8MDYY='&MDYY';
  TDATE2/A10=EDIT(TDATE1,'99/99/9999');
  TIME1/A8=HHMMSS('A8');
  TIME2/A8=EDIT(TIME1,'99$:99$:99');
  RD/A10 = 'Run Date:';
  RT/A10 = 'Run Time:';
  DTDESC/A20='Transaction Dates';
  CUR/A15='Current Period:';
  PRI/A15='Prior Period:';
  SPACE/A1 = 'A';
  KEY/A1 = IF RANK_VAL1 EQ 'TOTAL' THEN 'B' ELSE 'A';
END
-RUN


 
-IF '&&SETF.EVAL' EQ 'CCSMHIER' THEN GOTO CCIVERSION;
-IF '&&SETF.EVAL' EQ 'NYSMHIER' THEN GOTO NYLVERSION;
-RUN
 
TABLE FILE TLEV4
HEADING
-IF '&&OUTFMT.EVAL' EQ 'PDF' THEN GOTO HEAD2;
 
-* "Client: <6 <ROLL_NAME "
-* "Contact: <6 <ROLL_CONTACT"
-* "Phone: <6 <RPHONE "
-* " "
-* "<CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-* " <PRI       &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
-* " "
-* "<RN "
-* "<RN1 "
-*
-* RSB 
"&&ROLLNME &&SP1 &&ROLLCS &&SP3 &&RCNCT &&SP4 &&ROLLPHNEML"
-* "&&ROLLNME &&SP1 &&ROLLCS11 &&SP3 &&RCNCT &&SP4 &&ROLLPHNEML"
-* RSB 
-*
"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  Period2: &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"&&RPT_TTL1"
"&&RPT_TTL2"
 
 
-GOTO SkipHead
 
-HEAD2

 

"<86 &&DTDESC"
"<42 <RN <83 <CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
"<42 <RN1 <83 <PRI  &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"<&&CSLP &&ROLLNME <+0> &&SP <+0> &&ROLLCS <+0> &&SP3 <+0> &&ROLLCNCT <+0> &&SP4 <+0> &&ROLLPHNEML"
-* "<42 <RN"
-* "<42 <RN1 "  

-SkipHead
-IF '&&SETF.EVAL' EQ 'SKSMHIER' GOTO SKECHVERSION;
 
 
SUM CAVOL/P12CM AS 'Total,Volume'
-*    PCTVOL/P4% AS '% of,Total,Volume'
    PCTVOL/P4% AS '% of,Total'
    CNTKT/P12C AS 'Net,Tickets'
    CLSAV/P12CM AS 'Total,Lost,Savings'
-*    CTLS/P4% AS '% of,LS to,Air,Volume'
    CTLS/P4% AS '% of,Lost Savings'
    CAVGT/P12CM AS 'Avg,Ticket,Price'
    AAVGV1/P4% AS 'Avg,Ticket,Price,Var %'
-*    CADVP1/P4% AS '% Of,Net Tkts,Purchase,0-6 Days'
    CADVP1/P4% AS '% of,Net Tkts,0-6 Days'
-*    CADVP2/P4% AS '% of,Net Tkts,Purchase,7-13 Days'
    CADVP2/P4% AS '% of,Net Tkts,7-13 Days'

-*    ADVAP/P8 AS 'Avg,Nbr of,Bkg,Days'
    ADVAP/P8 AS 'Adv,Pur,Days'
 
    CONLP/P4% AS '% Dom,Online'
    CNRP/P4% AS '% of,NR'
    CPMILE/P10.2M AS 'CPM'
    CARAR/P12CM AS 'Avg,Car,Rate'
    HTLARR/P12CM AS 'Avg,Hotel,Cost Per,Night'
    TACH/P12CM AS 'Total Air,Car &,Hotel,Spend'
BY RANK_VAL1 NOPRINT
BY KEY NOPRINT
BY LVL_PRINT AS 'Hierarchy'
WHERE ZFLAG EQ 'N'
 
 
ON TABLE SET PAGE-NUM OFF
&&OUTLINE1
&&OUTLINE2
-*
-INCLUDE FOOTERSM
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-* " "
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-IF '&&OUTFMT.EVAL' EQ 'EXCEL' OR 'EXL2K' THEN GOTO NOB;
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.050000, RIGHTMARGIN=0.050000,
    TOPMARGIN=0.00000, BOTTOMMARGIN=0.010000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
 
 
TYPE=REPORT, FONT='ARIAL', SIZE=7, STYLE=NORMAL, BACKCOLOR=NONE, JUSTIFY=LEFT, $

-*      BORDER-TOP-COLOR=RGB(5 76 149),
-*      BORDER-BOTTOM-COLOR=RGB(5 76 149),
-*      BORDER-LEFT-COLOR=RGB(5 76 149),
-*     BORDER-RIGHT-COLOR=RGB(5 76 149),
 
TYPE=DATA,
     GRID=OFF,
     SIZE=7,
     STYLE=NORMAL,
     BACKCOLOR=('WHITE' RGB(239 239 239)),
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR=SILVER,
     BORDER-BOTTOM-COLOR=SILVER,
     BORDER-LEFT-COLOR=SILVER,
     BORDER-RIGHT-COLOR=SILVER,
     JUSTIFY=LEFT,
     WHEN=N1 NE 'ZZ',
$
-NOB

-IF &&OVERDRILL EQ 'Y' GOTO OVERDRILL;

TYPE=DATA, COLUMN=N4, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='A'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N6, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='N'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N7, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='L'     \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N9, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='T'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N11, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='6'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N12, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='7'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N13, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='P'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N14, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='O'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N15, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='R'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N17, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMCAR' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N18, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMHTL' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$

-OVERDRILL;
-IF '&&OUTFMT.EVAL' EQ 'EXCEL' OR 'EXL2K' THEN GOTO NOB2;
 
TYPE=HEADING,
     SIZE=8,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=HEADING,
     SIZE=9,
     LINE=2,
     ITEM=1,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=HEADING,
     SIZE=9,
     LINE=3,
     ITEM=1,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=TITLE,
     FONT='TIMES NEW ROMAN',
     STYLE=BOLD,
     GRID=ON,
     SIZE=7,
     COLOR=RGB(5 76 149),
     JUSTIFY=LEFT,
$
-GOTO PDFFMT
 
-NOB2
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=9, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=9, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$
-JOY
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$
 
TYPE=TITLE, JUSTIFY=LEFT, $
 
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
 
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
 
TYPE=SUBHEAD,
     STYLE=BOLD,
$
 
TYPE=SUBTOTAL,
     STYLE=BOLD,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
 
TYPE=GRANDTOTAL, STYLE=BOLD, $
 
-GOTO XSTY
 
-PDFFMT
 
TYPE=DATA, BACKCOLOR=NONE, GRID=OFF, SIZE=7,STYLE=BOLD, FONT='TIMES NEW ROMAN', JUSTIFY=LEFT, WHEN=N1 EQ 'ZZ',$
TYPE=SUBTOTAL, STYLE=BOLD, $
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
TYPE=TABFOOTING, FONT=TIMES NEW ROMAN, SIZE=6, STYLE=BOLD, COLOR=RGB(70 136 177), $
TYPE=REPORT, IMAGE=NEW_HDR.jpg, POSITION=(0 0.2), SIZE=(2.8 .37),PRESERVERATIO=ON, $ 
TYPE=REPORT, IMAGE=NEW_FTR.jpg, POSITION=(.2 8.0), SIZE=(10.5 .58), PRESERVERATIO=ON, $    
 
-* TYPE=REPORT,GRID=OFF, $
-XSTY
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
 
END
-RUN
 
 
SET SPACE = 2
 
-GOTO XXIT;
 
-CHEP;
 
CREATE FILE CHHIER
-RUN
 
 
-* Chep Summary by Hierarchy
-*********************************************************************************
-* Gather/Add Air Info to QRHIER File
-*********************************************************************************
 
DEFINE FILE SR_50
  CURRENT/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
  PRIOR/A1 = IF TRN_DATE GE &&FXDATE.EVAL AND TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
  INT_FLAG/A1 = IF AIR_MAIN.INTL_DOM EQ 'I' THEN 'Y' ELSE 'N';
  DOM_FLAG/A1 = IF AIR_MAIN.INTL_DOM EQ 'D' THEN 'Y' ELSE 'N';
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';
 
  BRK_LVL/I2 = &&BRK_LVL;
  LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
  FARE_PAID/P12.2 = SEG_AMT + SEG_TAX;
  NET_TKT_CNT/P12    = IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (FARE_PAID GE 0) AND
                          (SEG_COUNT EQ 1) AND
                          (CONJ_REL EQ 1) THEN 1 ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (EX_FLAG EQ 'F') THEN (-1) ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
 
  SAVINGS/P12.2     = SEG_STANDARD - FARE_PAID;
  NEW_SEG_MILES/D12 = SEG_MILES;
 -* Defines on Previous Defines
  DISSAVINGS/P12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                   FARE_PAID-SEG_LOWEST;
 
END
-RUN
 
TABLEF FILE SR_50
PRINT CGADV
  CURRENT
  PRIOR
  DISSAVINGS
  DOD_TYPE
  AIR_MAIN.INTL_DOM AS 'INTDOM'
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHOLD
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO NOREC;
 
-SET &&RPTSUF = 'HIERSUM';
-INCLUDE FDEFRPTS
-RUN
 
TABLE FILE RPTHOLD
PRINT CGADV
  DISSAVINGS
  DOD_TYPE
  INTDOM
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
BY CURRENT
BY PRIOR
BY LEVEL_DESC
ON TABLE HOLD AS TRANONE
END
-RUN
 
 
DEFINE FILE TRANONE
CAVOL/P12.2 = IF CURRENT EQ 'Y' THEN FARE_PAID ELSE 0;
CDAVOL/P12.2 = IF CURRENT EQ 'Y'  AND INTDOM EQ 'D' THEN FARE_PAID ELSE 0;
CIAVOL/P12.2 = IF CURRENT EQ 'Y' AND INTDOM EQ 'I' THEN FARE_PAID ELSE 0;
PAVOL/P12.2 = IF PRIOR EQ 'Y' THEN FARE_PAID ELSE 0;
PDAVOL/P12.2 = IF PRIOR EQ 'Y' AND INTDOM EQ 'D' THEN FARE_PAID ELSE 0;
PIAVOL/P12.2 = IF PRIOR EQ 'Y' AND INTDOM EQ 'I' THEN FARE_PAID ELSE 0;
CNTKT/P12 = IF CURRENT EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CNTKTD/P12 = IF CURRENT EQ 'Y' AND INTDOM EQ 'D' THEN NET_TKT_CNT ELSE 0;
CNTKTI/P12 = IF CURRENT EQ 'Y' AND INTDOM EQ 'I' THEN NET_TKT_CNT ELSE 0;
PNTKT/P12 = IF PRIOR EQ 'Y' THEN NET_TKT_CNT ELSE 0;
PNTKTD/P12 = IF PRIOR EQ 'Y' AND INTDOM EQ 'D' THEN NET_TKT_CNT ELSE 0;
PNTKTI/P12 = IF PRIOR EQ 'Y' AND INTDOM EQ 'I' THEN NET_TKT_CNT ELSE 0;
CLSAV/P12.2 = IF CURRENT EQ 'Y' THEN DISSAVINGS ELSE 0;
CADVT/P12 = IF (CURRENT EQ 'Y') AND
                (CGADV EQ '0-6') THEN NET_TKT_CNT ELSE 0;
CADVT1/P12 = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN NET_TKT_CNT ELSE 0;
CONL/P12 = IF (CURRENT EQ 'Y') AND (ONLINE_TRADITIONAL EQ 'ONLINE') AND (INTDOM EQ 'D') THEN NET_TKT_CNT ELSE 0;
END
-RUN
 
 
TABLE FILE TRANONE
SUM CAVOL
    CDAVOL
    CIAVOL
    PAVOL
    PDAVOL
    PIAVOL
    CNTKT
    CNTKTD
    CNTKTI
    PNTKT
    PNTKTD
    PNTKTI
    CLSAV
    CADVT
    CADVT1
    CONL
BY LEVEL_DESC
ON TABLE HOLD AS TRANTWO
END
-RUN
 
TABLE FILE TRANTWO
PRINT CAVOL CDAVOL CIAVOL PAVOL PDAVOL PIAVOL CNTKT CNTKTD CNTKTI PNTKT PNTKTD PNTKTI CLSAV CADVT CADVT1 CONL LEVEL_DESC
RANKED BY HIGHEST CAVOL
ON TABLE HOLD AS RNK1
END
-RUN
 
DEFINE FILE RNK1
 RANK_LIMIT/I2 = 9999;
 RLIMIT/A2    = EDIT(RANK_LIMIT) ;
 CRANK/D5     = RANK;
 BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
 LIST/D6 = IF LEVEL_DESC NE LAST LEVEL_DESC THEN (LAST LIST + 1)
           ELSE LAST LIST;
 FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
 FRANK/A6  = EDIT(FRANKX,'$999999');
 RANK_VALUE/A9 = IF RANK_LIMIT EQ 0 THEN BRANK ELSE
                IF LIST GT RANK_LIMIT THEN 'ALL OTHER' ELSE FRANK;
 LVL_PRINT/A25 =IF RANK_VALUE LT (RLIMIT) THEN LEVEL_DESC ELSE 'ALL OTHER';
END
-RUN
 
TABLE FILE RNK1
SUM CAVOL CDAVOL CIAVOL PAVOL PDAVOL PIAVOL CNTKT CNTKTD CNTKTI PNTKT PNTKTD PNTKTI CLSAV CADVT CADVT1 CONL
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS RNK2
END
-RUN
 
 
TABLE FILE RNK2
PRINT LVL_PRINT RANK_VALUE CAVOL CDAVOL CIAVOL PAVOL PDAVOL PIAVOL CNTKT CNTKTD CNTKTI PNTKT PNTKTD PNTKTI CLSAV CADVT CADVT1 CONL
ON TABLE SAVE
END
-RUN
 
MODIFY FILE CHHIER
FIXFORM LVL_PRINT/25 RANK_VALUE/9 CAVOL/12 CDAVOL/12 CIAVOL/12 PAVOL/12 PDAVOL/12 PIAVOL/12 CNTKT/12 CNTKTD/12 CNTKTI/12 PNTKT/12 PNTKTD/12 PNTKTI/12 CLSAV/12 CADVT/12 CADVT1/12 CONL/12
MATCH RANK_VALUE LVL_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
DEFINE FILE RNK2
LVLP/A27 = ''''||LVL_PRINT||'''';
END
-RUN
TABLE FILE RNK2
PRINT LVLP
BY LVL_PRINT NOPRINT
ON TABLE SAVE AS LEVELF
END
-RUN
 
-*********************************************************************************
-* Gather/Add Car Info to QRHIER File Based upon
-*********************************************************************************
 
 
EX CARUSE
-RUN
 
-SET &&RPTGRP = 'CAR';
EX UDIDGEN
-RUN
 
 
DEFINE FILE CR_50
 LEVEL_DESC1/A60 = &&LDESC;
 LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 RENTAL_DAYS/P12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
END
 
-RUN
TABLE FILE CR_50
SUM RENTAL_DAYS
    RENTAL_AMT
BY LEVEL_DESC
WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS CAR1
END
-RUN
 
TABLE FILE CAR1
SUM RENTAL_AMT/P12.2 AS 'CARVOL'
    RENTAL_DAYS/P12 AS 'CARDAY'
BY LEVEL_DESC
ON TABLE HOLD AS CAR2
END
-RUN
 
-******************************************************
-* Matching Hierarchy Levels
-******************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY LEVEL_DESC
WHERE LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS CARMREC
END
-RUN
 
TABLE FILE CARMREC
SUM CARVOL
    CARDAY
BY LEVEL_DESC AS 'LVL_PRINT'
ON TABLE HOLD AS CARMREC1
END
-RUN
 
TABLE FILE CARMREC1
SUM CARVOL CARDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE CHHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 CARVOL/12 CARDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching information ALL OTHER
-**********************************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY LEVEL_DESC
WHERE NOT LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS CARNREC
END
-RUN
 
DEFINE FILE CARNREC
LVL_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE CARNREC
SUM CARVOL CARDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE CHHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 CARVOL/12 CARDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-*********************************************************************************
-* Gather/Add HTL Info to QRHIER File
-*********************************************************************************
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
 
DEFINE FILE HR_50
 LEVEL_DESC1/A60 = &&LDESC;
 LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
 NBR_DAYS/P12=NUM_DAYS;
 NEW_TOTAL_AMT/P12.2 = TOTAL_AMT;
 NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
END
-RUN
 
TABLE FILE HR_50
SUM NEW_TOTAL_AMT
    NNROOMS
BY LEVEL_DESC
WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTL1
END
-RUN
 
-**************************************************************************
-* Matching Hotel Records
-**************************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY LEVEL_DESC
WHERE LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS HTLMREC
END
-RUN
 
TABLE FILE HTLMREC
SUM HTLVOL HTLDAY
BY LEVEL_DESC AS 'LVL_PRINT'
ON TABLE HOLD AS HTLMREC1
END
-RUN
 
TABLE FILE HTLMREC1
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE CHHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 HTLVOL/12 HTLDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching ALL OTHER Records
-**********************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY LEVEL_DESC
WHERE NOT LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS HTLNREC
END
-RUN
 
DEFINE FILE HTLNREC
LVL_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE HTLNREC
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE HOLD AS HTLNREC1
END
-RUN
 
TABLE FILE HTLNREC1
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE CHHIER
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 HTLVOL/12 HTLDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
 
DEFINE FILE CHHIER
RANK_VALUEA/A9 = 'TOTAL';
LVL_PRINTA/A25 = 'TOTAL';
END
-RUN
 
TABLE FILE CHHIER
SUM CAVOL/P12.2M
    CDAVOL/P12.2M
    CIAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  PCT.CDAVOL/P4 AS 'PCTVOLD'
  PCT.CIAVOL/P4 AS 'PCTVOLI'
  CNTKT
  CNTKTD
  CNTKTI
  CLSAV/P12.2M
  CARVOL/P12.2M
  HTLVOL/P12.2M
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGTD/P12.2M = IF ((CNTKTD LT 1) AND (CNTKTD GT (-1))) THEN 0 ELSE CDAVOL/CNTKTD;
COMPUTE CAVGTI/P12.2M = IF ((CNTKTI LT 1) AND (CNTKTI GT (-1))) THEN 0 ELSE CIAVOL/CNTKTI;
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUEA AS 'RANK_VALUE'
BY LVL_PRINTA
ON TABLE COLUMN-TOTAL
ON TABLE HOLD AS TTL1
END
-RUN
 
TABLE FILE TTL1
SUM CAVOL/P12.2M CDAVOL/P12.2M CIAVOL/P12.2M PCTVOL PCTVOLD PCTVOLI CNTKT/P12 CNTKTD/P12 CNTKTI/P12 CARVOL/P12 HTLVOL/P12 CLSAV/P12 CTLS/P12 CAVGTD/P12 CAVGTI/P12
    CADVP1/P12 CADVP2/P12 CONLP/P12 CARAR/P12 HTLARR/P12 TACH/P12
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TTL2
END
-RUN
 
TABLE FILE TTL2
PRINT CAVOL CDAVOL CIAVOL PCTVOL PCTVOLD PCTVOLI CNTKT CNTKTD CNTKTI CARVOL HTLVOL CLSAV CTLS CAVGTD CAVGTI
      CADVP1 CADVP2 CONLP CARAR HTLARR TACH
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TTL3 FORMAT FOCUS
END
-RUN
 
TABLE FILE CHHIER
SUM CAVOL/P12.2M
    CDAVOL/P12.2M
    CIAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  PCT.CDAVOL/P4 AS 'PCTVOLD'
  PCT.CIAVOL/P4 AS 'PCTVOLI'
  CNTKT
  CNTKTD
  CNTKTI
  CLSAV/P12.2M
  CARVOL
  HTLVOL
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGTD/P12.2M = IF ((CNTKTD LT 1) AND (CNTKTD GT (-1))) THEN 0 ELSE CDAVOL/CNTKTD;
COMPUTE CAVGTI/P12.2M = IF ((CNTKTI LT 1) AND (CNTKTI GT (-1))) THEN 0 ELSE CIAVOL/CNTKTI;
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV1
END
-RUN
 
TABLE FILE TLEV1
PRINT CAVOL/P12.2M CDAVOL/P12.2M CIAVOL/P12.2M PCTVOL PCTVOLD PCTVOLI CNTKT/P12 CNTKTD/P12 CNTKTI/P12 CARVOL/P12 HTLVOL/P12 CLSAV/P12 CTLS/P12 CAVGTD/P12 CAVGTI/P12
      CADVP1/P12 CADVP2/P12 CONLP/P12 CARAR/P12 HTLARR/P12 TACH/P12
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV2
END
-RUN
 
 
TABLE FILE TLEV2
PRINT CAVOL CDAVOL CIAVOL PCTVOL PCTVOLD PCTVOLI CNTKT CNTKTD CNTKTI CARVOL HTLVOL CLSAV CTLS CAVGTD CAVGTI
      CADVP1 CADVP2 CONLP CARAR HTLARR TACH
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV3 FORMAT FOCUS
END
-RUN
 
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &PHOLD1=&HLDPATH || 'TLEV3.FOC';
-SET &PHOLD2=&HLDPATH || 'TTL3.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&PHOLD1 AS TLEV3
&PHOLD2 AS TLEV3
END
-RUN
 
DEFINE FILE TLEV3
RANK_VAL1/A9 = IF RANK_VALUE EQ 'TOTAL' THEN 'ZZ' ELSE RANK_VALUE;
END
-RUN
 
TABLE FILE TLEV3
SUM CAVOL CDAVOL CIAVOL PCTVOL PCTVOLD PCTVOLI CNTKT CNTKTD CNTKTI CARVOL HTLVOL CLSAV CTLS CAVGTD CAVGTI
    CADVP1 CADVP2 CONLP CARAR HTLARR TACH
BY RANK_VAL1
BY LVL_PRINT
ON TABLE HOLD AS TLEV4
END
-RUN
 
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF1;
-INCLUDE AVRP_SUBFOOT
-:AVSF1
 
DEFINE FILE TLEV4
NOWTOD/A8 WITH RANK_VAL1 = HHMMSS (NOWTOD);
END
-RUN
 
TABLE FILE TLEV4
HEADING
"<2 Current: <12 &FMM/&FMD/&FMY - &TOM/&TOD/&TOY <45 &&RPT_TTL1"
"<2 Prior: <12 &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY <44 &&RPT_TTL2"
" "
SUM CDAVOL/P12CM AS 'Domestic,Total,Air Volume'
    PCTVOLD/P4% AS '% of,Domestic,Total,Air Volume'
    CIAVOL/P12CM AS 'International,Total,Air Volume'
    PCTVOLI/P4% AS '% of,International,Total,Air Volume'
    CNTKTD/P12C AS 'Domestic,Net,Tickets'
    CNTKTI/P12C AS 'International,Net,Tickets'
    CLSAV/P12CM AS 'Total,Lost,Savings'
    CTLS/P4% AS '% of,LS to,Air,Volume'
    CAVGTD/P12CM AS 'Domestic,AVG Ticket,Price'
    CAVGTI/P12CM AS 'International,AVG Ticket,Price'
    CADVP1/P4% AS '% Of,Net Tickets,Purchased,0-6 Days'
    CADVP2/P4% AS '% of,Net Tickets,Purchased,7-13 Days'
    CONLP/P4% AS '% of,Domestic,Online'
    CARVOL/P12CM AS 'Total,Car,Volume'
    CARAR/P12CM AS 'AVG,Car,Rate'
    HTLVOL/P12CM AS 'Total,Hotel,Volume'
    HTLARR/P12CM AS 'AVG,Hotel,Cost Per,Night'
    TACH/P12CM AS 'Total Air,Car &,Hotel,Spend'
BY RANK_VAL1 NOPRINT
BY LVL_PRINT AS 'HIERARCHY'
ON TABLE SET PAGE-NUM OFF
ON LVL_PRINT SKIP-LINE
&&OUTLINE1
&&OUTLINE2
-*
-INCLUDE FOOTERSM
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *
 
 
 
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.100000,
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=HEADING, FONT=TIMES NEW ROMAN, SIZE=9, BACKCOLOR=NONE, STYLE=BOLD, $
TYPE=TITLE, STYLE=BOLD, COLUMN=N1, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N2, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N3, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N4, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N5, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N6, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N7, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N8, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N9, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N10, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N11, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N12, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N13, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N14, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N15, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N16, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N17, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N18, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N19, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N20, BACKCOLOR=RGB(170 170 170), $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=DATA, COLUMN=N2,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N3,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N4,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N5,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N6,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N7,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N8,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N9,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N10,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N11,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N12,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N13,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N14,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N15,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N16,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N17,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=REPORT, WRAP= 1,$
TYPE=SUBTOTAL, STYLE=BOLD, $
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
TYPE=REPORT,GRID=OFF, $
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
END
-RUN
 
SET SPACE = 2
 
-GOTO XXIT;
 
-BAIR;
 
CREATE FILE BAHIER
-RUN
 
 
-* Chep Summary by Hierarchy
-*********************************************************************************
-* Gather/Add Air Info to QRHIER File
-*********************************************************************************
 
DEFINE FILE SR_50
  CURRENT/A1 = IF TRN_DATE GE &&FROMDT.EVAL AND TRN_DATE LE &&TODT.EVAL THEN 'Y' ELSE 'N';
  PRIOR/A1 = IF TRN_DATE GE &&FXDATE.EVAL AND TRN_DATE LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
  INT_FLAG/A1 = IF AIR_MAIN.INTL_DOM EQ 'I' THEN 'Y' ELSE 'N';
  DOM_FLAG/A1 = IF AIR_MAIN.INTL_DOM EQ 'D' THEN 'Y' ELSE 'N';
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';
 
  BRK_LVL/I2 = &&BRK_LVL;
  LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
  FARE_PAID/P12.2 = SEG_AMT + SEG_TAX;
  NET_TKT_CNT/P12    = IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (FARE_PAID GE 0) AND
                          (SEG_COUNT EQ 1) AND
                          (CONJ_REL EQ 1) THEN 1 ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (EX_FLAG EQ 'F') THEN (-1) ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
 
  SAVINGS/P12.2     = SEG_STANDARD - FARE_PAID;
  NEW_SEG_MILES/D12 = SEG_MILES;
 -* Defines on Previous Defines
  DISSAVINGS/P12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                   FARE_PAID-SEG_LOWEST;
 
END
-RUN
 
TABLEF FILE SR_50
PRINT CGADV
  CURRENT
  CATEGORY
  PRIOR
  DISSAVINGS
  DOD_TYPE
  AIR_MAIN.INTL_DOM AS 'INTDOM'
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
WHERE (TRN_DATE GE &&FROMDT.EVAL) AND (TRN_DATE LE &&TODT.EVAL) OR
      (TRN_DATE GE &&FXDATE.EVAL) AND (TRN_DATE LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHOLD
END
-RUN
 
-IF &LINES EQ 0 THEN GOTO NOREC;
 
-SET &&RPTSUF = 'HIERSUM';
-INCLUDE FDEFRPTS
-RUN
 
TABLE FILE RPTHOLD
PRINT CGADV
  DISSAVINGS
  DOD_TYPE
  INTDOM
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_SEG_MILES
  NONREF_FLAG
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
  ONLINE_TRADITIONAL
BY CURRENT
BY PRIOR
BY CATEGORY
ON TABLE HOLD AS TRANONE
END
-RUN
 
DEFINE FILE TRANONE
CAVOL/P12.2 = IF CURRENT EQ 'Y' THEN FARE_PAID ELSE 0;
CDAVOL/P12.2 = IF CURRENT EQ 'Y'  AND INTDOM EQ 'D' THEN FARE_PAID ELSE 0;
CIAVOL/P12.2 = IF CURRENT EQ 'Y' AND INTDOM EQ 'I' THEN FARE_PAID ELSE 0;
PAVOL/P12.2 = IF PRIOR EQ 'Y' THEN FARE_PAID ELSE 0;
PDAVOL/P12.2 = IF PRIOR EQ 'Y' AND INTDOM EQ 'D' THEN FARE_PAID ELSE 0;
PIAVOL/P12.2 = IF PRIOR EQ 'Y' AND INTDOM EQ 'I' THEN FARE_PAID ELSE 0;
CNTKT/P12 = IF CURRENT EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CNTKTD/P12 = IF CURRENT EQ 'Y' AND INTDOM EQ 'D' THEN NET_TKT_CNT ELSE 0;
CNTKTI/P12 = IF CURRENT EQ 'Y' AND INTDOM EQ 'I' THEN NET_TKT_CNT ELSE 0;
PNTKT/P12 = IF PRIOR EQ 'Y' THEN NET_TKT_CNT ELSE 0;
PNTKTD/P12 = IF PRIOR EQ 'Y' AND INTDOM EQ 'D' THEN NET_TKT_CNT ELSE 0;
PNTKTI/P12 = IF PRIOR EQ 'Y' AND INTDOM EQ 'I' THEN NET_TKT_CNT ELSE 0;
CLSAV/P12.2 = IF CURRENT EQ 'Y' THEN DISSAVINGS ELSE 0;
CADVT/P12 = IF (CURRENT EQ 'Y') AND
                (CGADV EQ '0-6') THEN NET_TKT_CNT ELSE 0;
CADVT1/P12 = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN NET_TKT_CNT ELSE 0;
CONL/P12 = IF (CURRENT EQ 'Y') AND (ONLINE_TRADITIONAL EQ 'ONLINE') AND (INTDOM EQ 'D') THEN NET_TKT_CNT ELSE 0;
 
END
-RUN
 
 
TABLE FILE TRANONE
SUM CAVOL
    CDAVOL
    CIAVOL
    PAVOL
    PDAVOL
    PIAVOL
    CNTKT
    CNTKTD
    CNTKTI
    PNTKT
    PNTKTD
    PNTKTI
    CLSAV
    CADVT
    CADVT1
    CONL
BY CATEGORY
ON TABLE HOLD AS TRANTWO
END
-RUN
 
TABLE FILE TRANTWO
PRINT CAVOL CDAVOL CIAVOL PAVOL PDAVOL PIAVOL CNTKT CNTKTD CNTKTI PNTKT PNTKTD PNTKTI CLSAV CADVT CADVT1 CONL CATEGORY
RANKED BY HIGHEST CAVOL
ON TABLE HOLD AS RNK1
END
-RUN
 
DEFINE FILE RNK1
 RANK_LIMIT/I2 = 9999;
 RLIMIT/A2    = EDIT(RANK_LIMIT) ;
 CRANK/D5     = RANK;
 BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
 LIST/D6 = IF CATEGORY NE LAST CATEGORY THEN (LAST LIST + 1)
           ELSE LAST LIST;
 FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
 FRANK/A6  = EDIT(FRANKX,'$999999');
 RANK_VALUE/A9 = IF RANK_LIMIT EQ 0 THEN BRANK ELSE
                IF LIST GT RANK_LIMIT THEN 'ALL OTHER' ELSE FRANK;
 CAT_PRINT/A15 =IF RANK_VALUE LT RLIMIT THEN CATEGORY ELSE 'ALL OTHER';
END
-RUN
 
TABLE FILE RNK1
SUM CAVOL CDAVOL CIAVOL PAVOL PDAVOL PIAVOL CNTKT CNTKTD CNTKTI PNTKT PNTKTD PNTKTI CLSAV CADVT CADVT1 CONL
BY RANK_VALUE
BY CAT_PRINT
ON TABLE HOLD AS RNK2
END
-RUN
 
 
TABLE FILE RNK2
PRINT CAT_PRINT RANK_VALUE CAVOL CDAVOL CIAVOL PAVOL PDAVOL PIAVOL CNTKT CNTKTD CNTKTI PNTKT PNTKTD PNTKTI CLSAV CADVT CADVT1 CONL
ON TABLE SAVE
END
-RUN
 
MODIFY FILE BAHIER
FIXFORM CAT_PRINT/15 RANK_VALUE/9 CAVOL/12 CDAVOL/12 CIAVOL/12 PAVOL/12 PDAVOL/12 PIAVOL/12 CNTKT/12 CNTKTD/12 CNTKTI/12 PNTKT/12 PNTKTD/12 PNTKTI/12 CLSAV/12 CADVT/12 CADVT1/12 CONL/12
MATCH RANK_VALUE CAT_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
DEFINE FILE RNK2
CATP/A17 = ''''||CAT_PRINT||'''';
END
-RUN
TABLE FILE RNK2
PRINT CATP
BY CAT_PRINT NOPRINT
ON TABLE SAVE AS CATF
END
-RUN
 
-*********************************************************************************
-* Gather/Add Car Info to QRHIER File Based upon
-*********************************************************************************
 
 
EX CARUSE
-RUN
 
-SET &&RPTGRP = 'CAR';
EX UDIDGEN
-RUN
 
 
DEFINE FILE CR_50
 LEVEL_DESC1/A60 = &&LDESC;
 LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
-*  LEVEL_DESC/A25 = IF CLIENT_NUM EQ '294942' THEN 'BAIRD GROUPS' ELSE
-*                   IF CLIENT_NUM EQ '106757' OR '294579' THEN 'BAIRD PERSONAL/LEISURE' ELSE 'BAIRD BUSINESS TRAVEL';
 RENTAL_DAYS/P12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
END
 
-RUN
TABLE FILE CR_50
SUM RENTAL_DAYS
    RENTAL_AMT
BY CATEGORY
WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS CAR1
END
-RUN
 
TABLE FILE CAR1
SUM RENTAL_AMT/P12.2 AS 'CARVOL'
    RENTAL_DAYS/P12 AS 'CARDAY'
BY CATEGORY
ON TABLE HOLD AS CAR2
END
-RUN
 
-******************************************************
-* Matching Hierarchy Levels
-******************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY CATEGORY
WHERE CATEGORY IN FILE CATF
ON TABLE HOLD AS CARMREC
END
-RUN
 
TABLE FILE CARMREC
SUM CARVOL
    CARDAY
BY CATEGORY AS 'CAT_PRINT'
ON TABLE HOLD AS CARMREC1
END
-RUN
 
 
TABLE FILE CARMREC1
SUM CARVOL CARDAY
BY CAT_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE BAHIER
LOG NOMATCH MSG OFF
FIXFORM CAT_PRINT/15 CARVOL/12 CARDAY/12
MATCH CAT_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching information ALL OTHER
-**********************************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY CATEGORY
WHERE NOT CATEGORY IN FILE CATF
ON TABLE HOLD AS CARNREC
END
-RUN
 
DEFINE FILE CARNREC
CAT_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE CARNREC
SUM CARVOL CARDAY
BY CAT_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE BAHIER
LOG NOMATCH MSG OFF
FIXFORM CAT_PRINT/15 CARVOL/12 CARDAY/12
MATCH CAT_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-*********************************************************************************
-* Gather/Add HTL Info to QRHIER File
-*********************************************************************************
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
 
DEFINE FILE HR_50
 LEVEL_DESC1/A60 = &&LDESC;
 LEVEL_DESC/A25 = EDIT(LEVEL_DESC1, '9999999999999999999999999$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
-*  LEVEL_DESC/A25 = IF CLIENT_NUM EQ '294942' THEN 'BAIRD GROUPS' ELSE
-*                   IF CLIENT_NUM EQ '106757' OR '294579' THEN 'BAIRD PERSONAL/LEISURE' ELSE 'BAIRD BUSINESS TRAVEL';
 NBR_DAYS/P12=NUM_DAYS;
 NEW_TOTAL_AMT/P12.2 = TOTAL_AMT;
 NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
END
-RUN
 
TABLE FILE HR_50
SUM NEW_TOTAL_AMT
    NNROOMS
BY CATEGORY
WHERE (INVOICE_DATE GE &&FROMDT.EVAL) AND (INVOICE_DATE LE &&TODT.EVAL)
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTL1
END
-RUN
 
-**************************************************************************
-* Matching Hotel Records
-**************************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY CATEGORY
WHERE CATEGORY IN FILE CATF
ON TABLE HOLD AS HTLMREC
END
-RUN
 
TABLE FILE HTLMREC
SUM HTLVOL HTLDAY
BY CATEGORY AS 'CAT_PRINT'
ON TABLE HOLD AS HTLMREC1
END
-RUN
 
TABLE FILE HTLMREC1
SUM HTLVOL HTLDAY
BY CAT_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE BAHIER
LOG NOMATCH MSG OFF
FIXFORM CAT_PRINT/15 HTLVOL/12 HTLDAY/12
MATCH CAT_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
 
-**********************************************************************
-* Non Matching ALL OTHER Records
-**********************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY CATEGORY
WHERE NOT CATEGORY IN FILE CATF
ON TABLE HOLD AS HTLNREC
END
-RUN
 
DEFINE FILE HTLNREC
CAT_PRINT/A15 = 'ALL OTHER';
END
-RUN
TABLE FILE HTLNREC
SUM HTLVOL HTLDAY
BY CAT_PRINT
ON TABLE HOLD AS HTLNREC1
END
-RUN
 
TABLE FILE HTLNREC1
SUM HTLVOL HTLDAY
BY CAT_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE BAHIER
LOG NOMATCH MSG OFF
FIXFORM CAT_PRINT/15 HTLVOL/12 HTLDAY/12
MATCH CAT_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
 
DEFINE FILE BAHIER
RANK_VALUEA/A9 = 'TOTAL';
CAT_PRINTA/A15 = 'TOTAL';
END
-RUN
 
TABLE FILE BAHIER
SUM CAVOL/P12.2M
    CDAVOL/P12.2M
    CIAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  PCT.CDAVOL/P4 AS 'PCTVOLD'
  PCT.CIAVOL/P4 AS 'PCTVOLI'
  CNTKT
  CNTKTD
  CNTKTI
  CLSAV/P12.2M
  CARVOL/P12.2M
  HTLVOL/P12.2M
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGTD/P12.2M = IF ((CNTKTD LT 1) AND (CNTKTD GT (-1))) THEN 0 ELSE CDAVOL/CNTKTD;
COMPUTE CAVGTI/P12.2M = IF ((CNTKTI LT 1) AND (CNTKTI GT (-1))) THEN 0 ELSE CIAVOL/CNTKTI;
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUEA AS 'RANK_VALUE'
BY CAT_PRINTA AS 'CAT_PRINT'
ON TABLE HOLD AS TTL1
END
-RUN
 
TABLE FILE TTL1
SUM CAVOL/P12.2M CDAVOL/P12.2M CIAVOL/P12.2M PCTVOL PCTVOLD PCTVOLI CNTKT/P12 CNTKTD/P12 CNTKTI/P12 CARVOL/P12 HTLVOL/P12 CLSAV/P12 CTLS/P12 CAVGTD/P12 CAVGTI/P12
    CADVP1/P12 CADVP2/P12 CONLP/P12 CARAR/P12 HTLARR/P12 TACH/P12
BY RANK_VALUE
BY CAT_PRINT
ON TABLE HOLD AS TTL2
END
-RUN
 
TABLE FILE TTL2
PRINT CAVOL CDAVOL CIAVOL PCTVOL PCTVOLD PCTVOLI CNTKT CNTKTD CNTKTI CARVOL HTLVOL CLSAV CTLS CAVGTD CAVGTI
      CADVP1 CADVP2 CONLP CARAR HTLARR TACH
BY RANK_VALUE
BY CAT_PRINT
ON TABLE HOLD AS TTL3 FORMAT FOCUS
END
-RUN
 
TABLE FILE BAHIER
SUM CAVOL/P12.2M
    CDAVOL/P12.2M
    CIAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  PCT.CDAVOL/P4 AS 'PCTVOLD'
  PCT.CIAVOL/P4 AS 'PCTVOLI'
  CNTKT
  CNTKTD
  CNTKTI
  CLSAV/P12.2M
  CARVOL
  HTLVOL
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGTD/P12.2M = IF ((CNTKTD LT 1) AND (CNTKTD GT (-1))) THEN 0 ELSE CDAVOL/CNTKTD;
COMPUTE CAVGTI/P12.2M = IF ((CNTKTI LT 1) AND (CNTKTI GT (-1))) THEN 0 ELSE CIAVOL/CNTKTI;
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUE
BY CAT_PRINT
ON TABLE HOLD AS TLEV1
END
-RUN
 
TABLE FILE TLEV1
PRINT CAVOL/P12.2M CDAVOL/P12.2M CIAVOL/P12.2M PCTVOL PCTVOLD PCTVOLI CNTKT/P12 CNTKTD/P12 CNTKTI/P12 CARVOL/P12 HTLVOL/P12 CLSAV/P12 CTLS/P12 CAVGTD/P12 CAVGTI/P12
      CADVP1/P12 CADVP2/P12 CONLP/P12 CARAR/P12 HTLARR/P12 TACH/P12
BY RANK_VALUE
BY CAT_PRINT
ON TABLE HOLD AS TLEV2
END
-RUN
 
 
TABLE FILE TLEV2
PRINT CAVOL CDAVOL CIAVOL PCTVOL PCTVOLD PCTVOLI CNTKT CNTKTD CNTKTI CARVOL HTLVOL CLSAV CTLS CAVGTD CAVGTI
      CADVP1 CADVP2 CONLP CARAR HTLARR TACH
BY RANK_VALUE
BY CAT_PRINT
ON TABLE HOLD AS TLEV3 FORMAT FOCUS
END
-RUN
 
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &PHOLD1=&HLDPATH || 'TLEV3.FOC';
-SET &PHOLD2=&HLDPATH || 'TTL3.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&PHOLD1 AS TLEV3
&PHOLD2 AS TLEV3
END
-RUN
 
DEFINE FILE TLEV3
RANK_VAL1/A9 = IF RANK_VALUE EQ 'TOTAL' THEN 'ZZ' ELSE RANK_VALUE;
END
-RUN
 
TABLE FILE TLEV3
SUM CAVOL CDAVOL CIAVOL PCTVOL PCTVOLD PCTVOLI CNTKT CNTKTD CNTKTI CARVOL HTLVOL CLSAV CTLS CAVGTD CAVGTI
    CADVP1 CADVP2 CONLP CARAR HTLARR TACH
BY RANK_VAL1
BY CAT_PRINT
ON TABLE HOLD AS TLEV4
END
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF2;
-INCLUDE AVRP_SUBFOOT
-:AVSF2
 
 
DEFINE FILE TLEV4
NOWTOD/A9 WITH RANK_VAL1 = HHMMSS (NOWTOD);
END
-RUN
 
TABLE FILE TLEV4
HEADING
-IF '&&OUTFMT.EVAL' NE 'PDF' GOTO BDXLHD;
"<2 Current: <12 &FMM/&FMD/&FMY - &TOM/&TOD/&TOY <45 &&RPT_TTL1"
"<2 Prior: <12 &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY <44 &&RPT_TTL2"
" "
-GOTO BDRPT;
-BDXLHD;
-*
-* RSB
-* "&&ROLLNME &&SP1 &&ROLLCS11 &&SP3 &&RCNCT1 &&SP4 &&ROLLPHN"
"&&ROLLNME &&SP1 &&ROLLCS &&SP3 &&RCNCT &&SP4 &&ROLLPHN"
-* RSB
-*
"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  Period2: &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"&&RPT_TTL1"
"&&RPT_TTL2"
-BDRPT;
SUM CDAVOL/P12CM AS 'Domestic,Total,Air Volume'
    PCTVOLD/P4% AS '% of,Domestic,Total,Air Volume'
    CIAVOL/P12CM AS 'International,Total,Air Volume'
    PCTVOLI/P4% AS '% of,International,Total,Air Volume'
    CNTKTD/P12C AS 'Domestic,Net,Tickets'
    CNTKTI/P12C AS 'International,Net,Tickets'
    CLSAV/P12CM AS 'Total,Lost,Savings'
    CTLS/P4% AS '% of,LS to,Air,Volume'
    CAVGTD/P12CM AS 'Domestic,AVG Ticket,Price'
    CAVGTI/P12CM AS 'International,AVG Ticket,Price'
    CADVP1/P4% AS '% Of,Net Tickets,Purchased,0-6 Days'
    CADVP2/P4% AS '% of,Net Tickets,Purchased,7-13 Days'
    CONLP/P4% AS '% of,Domestic,Online'
    CARVOL/P12CM AS 'Total,Car,Volume'
    CARAR/P12CM AS 'AVG,Car,Rate'
    HTLVOL/P12CM AS 'Total,Hotel,Volume'
    HTLARR/P12CM AS 'AVG,Hotel,Cost Per,Night'
    TACH/P12CM AS 'Total Air,Car &,Hotel,Spend'
BY RANK_VAL1 NOPRINT
BY CAT_PRINT AS 'CATEGORY'
ON TABLE SET PAGE-NUM OFF
ON CAT_PRINT SKIP-LINE
&&OUTLINE1
&&OUTLINE2
-*
-INCLUDE FOOTERSM
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

-IF '&&OUTFMT.EVAL' NE 'PDF' GOTO BDXLSTY;
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.100000,
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=HEADING, FONT=TIMES NEW ROMAN, SIZE=9, BACKCOLOR=NONE, STYLE=BOLD, $
TYPE=TITLE, STYLE=BOLD, COLUMN=N1, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N2, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N3, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N4, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N5, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N6, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N7, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N8, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N9, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N10, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N11, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N12, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N13, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N14, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N15, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N16, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N17, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N18, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N19, BACKCOLOR=RGB(170 170 170), $
TYPE=TITLE, STYLE=BOLD, COLUMN=N20, BACKCOLOR=RGB(170 170 170), $
TYPE=REPORT, FONT=TIMES NEW ROMAN, SIZE=7, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=DATA, COLUMN=N2,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N3,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N4,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N5,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N6,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N7,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N8,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N9,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N10,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N11,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N12,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N13,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N14,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N15,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N16,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N17,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=REPORT, WRAP= 1,$
TYPE=SUBTOTAL, STYLE=BOLD, $
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
TYPE=REPORT,GRID=OFF, $
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
END
-RUN
 
SET SPACE = 2
 
-GOTO XXIT;
 
-BDXLSTY;
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=9, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=9, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$
TYPE=DATA, COLUMN=N2,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N3,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N4,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N5,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N6,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N7,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N8,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N9,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N10,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N11,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N12,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N13,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N14,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N15,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N16,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
TYPE=DATA, COLUMN=N17,WHEN=N2 EQ 'TOTAL', STYLE=BOLD, $
-JOY
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$
 
TYPE=TITLE, JUSTIFY=LEFT, $
 
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
 
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
 
TYPE=SUBHEAD,
     STYLE=BOLD,
$
 
TYPE=SUBTOTAL,
     STYLE=BOLD,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
 
TYPE=GRANDTOTAL, STYLE=BOLD, $
 
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
END
-RUN
-GOTO XXIT;
 
-CCIVERSION;
 
TABLE FILE TLEV4
HEADING
-*
-* RSB
-* "&&ROLLNME &&SP1 &&ROLLCS11 &&SP3 &&RCNCT1 &&SP4 &&ROLLPHN"
"&&ROLLNME &&SP1 &&ROLLCS &&SP3 &&RCNCT &&SP4 &&ROLLPHN"
-* RSB
-*
"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  Period2: &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"&&RPT_TTL1"
"&&RPT_TTL2"
SUM CAVOL/P12CM AS 'Total,Volume'
    PCTVOL/P4% AS '% of,Total,Volume'
    CNTKT/P12C AS 'Net,Tickets'
    CLSAV/P12CM AS 'Total,Lost,Savings'
    CTLS/P4% AS '% of,LS to,Air,Volume'
    CAVGT/P12CM AS 'Avg,Ticket,Price'
    AAVGV1/P4% AS 'Avg,Ticket,Price,Var %'
    CADVP1/P4% AS '% Of,Net Tickets,Purchased,0-6 Days'
    CADVP2/P4% AS '% of,Net Tickets,Purchased,7-13 Days'
    CONLP/P4% AS '% Dom,Online'
    CNRP/P4% AS '% of,NR'
    CPMILE/P10.2M AS 'CPM'
    PCTEX/P4% AS '% of,Total,Exchanges'
    CAIR_FEE/P12CM AS 'Airline,Fees'
    CARAR/P12CM AS 'Avg,Car,Rate'
    HTLARR/P12CM AS 'Avg,Hotel,Cost Per,Night'
    TACH/P12CM AS 'Total Air,Car &,Hotel,Spend'
BY RANK_VAL1 NOPRINT
BY KEY NOPRINT
BY LVL_PRINT AS 'HIERARCHY'
WHERE ZFLAG EQ 'N'
ON TABLE SET PAGE-NUM OFF
&&OUTLINE1
&&OUTLINE2
-*
-INCLUDE FOOTERSM
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET STYLE *

-IF &&OVERDRILL EQ 'Y' GOTO OVERDRILLCCI;
 
TYPE=DATA, COLUMN=N4, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='A'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N6, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='N'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N7, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='L'     \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N9, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='T'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N11, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='6'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N12, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='7'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N13, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='O'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N14, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='R'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N18, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMCAR' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N19, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMHTL' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
ROLUP='&&ROLLUP' user='&&UNAME'),
$

-OVERDRILLCCI;
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=9, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=9, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$
-JOY
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$
 
TYPE=TITLE, JUSTIFY=LEFT, $
 
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
 
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
 
TYPE=SUBHEAD,
     STYLE=BOLD,
$
 
TYPE=SUBTOTAL,
     STYLE=BOLD,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
 
TYPE=GRANDTOTAL, STYLE=BOLD, $
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
END
-RUN
 
 
SET SPACE = 2
 
-GOTO XXIT;

-NYLVERSION;

TABLE FILE TLEV4
HEADING
-IF '&&OUTFMT.EVAL' EQ 'PDF' THEN GOTO HEAD2NYL;
 
-* "Client: <6 <ROLL_NAME "
-* "Contact: <6 <ROLL_CONTACT"
-* "Phone: <6 <RPHONE "
-* " "
-* "<CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-* " <PRI       &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
-* " "
-* "<RN "
-* "<RN1 "
-*
-* RSB 
-* "&&ROLLNME &&SP1 &&ROLLCS11 &&SP3 &&RCNCT1 &&SP4 &&ROLLPHN"
"&&ROLLNME &&SP1 &&ROLLCS &&SP3 &&RCNCT &&SP4 &&ROLLPHN"
-* RSB 
-*
"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  Period2: &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"&&RPT_TTL1"
"&&RPT_TTL2"
 
 
-GOTO SkipHeadNYL
 
-HEAD2NYL
"<83 &&DTDESC"
"<42 <RN <78 <CUR <87 &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
"<42 <RN1 <78 <PRI <87 &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"<72 &&ROLLNME <+0> &&SP <+0> &&ROLLCS <+0> &&SP3 <+0> &&ROLLCNCT <+0> &&SP4 <+0> &&ROLLPHN"
" "
-* "Client: <6 <ROLL_NAME <42 <RN <90 <DTDESC"
-* "Contact: <6 <ROLL_CONTACT <40 <RN1 <90 <CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-* "Phone: <6 <RPHONE <90 <PRI       &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
-* " "
-SkipHeadNYL

 
SUM CAVOL/P12CM AS 'Total,Volume'
    PCTVOL/P4% AS '% of,Total,Volume'
    CNTKT/P12C AS 'Net,Tickets'
    CAVGT/P12CM AS 'Avg,Ticket,Price'
    AAVGV1/P4% AS 'Avg,Ticket,Price,Var %'
    CADVP1/P4% AS '% Of,Net Tkts,Purchase,0-6 Days'
    CADVP2/P4% AS '% of,Net Tkts,Purchase,7-13 Days'
    ADVAP/P8 AS 'Adv,Pur,Days'
    CONLP/P4% AS '% Dom,Online'
    CNRP/P4% AS '% of,NR'
BY RANK_VAL1 NOPRINT
BY KEY NOPRINT
BY LVL_PRINT AS 'HIERARCHY'
WHERE ZFLAG EQ 'N'
 
 
ON TABLE SET PAGE-NUM OFF
&&OUTLINE1
&&OUTLINE2
-*
-INCLUDE FOOTERSM
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-* " "
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-IF '&&OUTFMT.EVAL' EQ 'EXCEL' OR 'EXL2K' THEN GOTO NOB;
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.050000, RIGHTMARGIN=0.050000,
    TOPMARGIN=0.00000, BOTTOMMARGIN=0.010000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
 
 
TYPE=REPORT, FONT='ARIAL', SIZE=8, STYLE=NORMAL, BACKCOLOR=NONE, JUSTIFY=LEFT, $
 
 
TYPE=DATA,
     GRID=OFF,
     SIZE=8,
     STYLE=NORMAL,
     BACKCOLOR=('WHITE' RGB(239 239 239)),
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR=RGB(5 76 149),
     BORDER-BOTTOM-COLOR=RGB(5 76 149),
     BORDER-LEFT-COLOR=RGB(5 76 149),
     BORDER-RIGHT-COLOR=RGB(5 76 149),
     JUSTIFY=LEFT,
     WHEN=N1 NE 'ZZ',
$
-NOBNYL

-IF &&OVERDRILL EQ 'Y' GOTO OVERDRILLNYL;

TYPE=DATA, COLUMN=N4, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='A'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N6, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='N'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N7, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='T'     \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N9, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='6'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N10, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='7'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N11, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='P'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N12, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='O'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N13, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='R'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$

-GOTO JOY 
TYPE=DATA, COLUMN=N15, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='R'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N17, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMCAR' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N18, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMHTL' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
-JOY;
-OVERDRILLNYL;
-IF '&&OUTFMT.EVAL' EQ 'EXCEL' OR 'EXL2K' THEN GOTO NOB2NYL;
 
TYPE=HEADING,
     SIZE=8,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=HEADING,
     SIZE=9,
     LINE=2,
     ITEM=1,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=HEADING,
     SIZE=9,
     LINE=3,
     ITEM=1,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=TITLE,
     FONT='ARIAL',
     STYLE=BOLD,
     GRID=ON,
     SIZE=8,
     COLOR=RGB(5 76 149),
     JUSTIFY=LEFT,
$
-GOTO PDFFMTNYL
 
-NOB2NYL
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=9, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=9, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$
-JOY
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$
 
TYPE=TITLE, JUSTIFY=LEFT, $
 
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
 
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
 
TYPE=SUBHEAD,
     STYLE=BOLD,
$
 
TYPE=SUBTOTAL,
     STYLE=BOLD,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
 
TYPE=GRANDTOTAL, STYLE=BOLD, $
 
-GOTO XSTYNYL
 
-PDFFMTNYL
 
TYPE=DATA, BACKCOLOR=NONE, GRID=OFF, SIZE=8,STYLE=BOLD, FONT='ARIAL', JUSTIFY=LEFT, WHEN=N1 EQ 'ZZ',$
TYPE=SUBTOTAL, STYLE=BOLD, $
TYPE=TABFOOTING, FONT=TIMES NEW ROMAN, SIZE=6, STYLE=BOLD, COLOR=RGB(70 136 177), $
 
TYPE=REPORT, IMAGE=NEW_HDR.jpg, POSITION=(0 0), SIZE=(4.5 .375),PRESERVERATIO=ON, $ 
TYPE=REPORT, IMAGE=NEW_FTR.jpg, POSITION=(.2 8.0), SIZE=(10.5 .58), PRESERVERATIO=ON, $    
 
-* TYPE=REPORT,GRID=OFF, $
-XSTYNYL
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
 
END
-RUN
 
 
SET SPACE = 2
 
-GOTO XXIT;
 
-PETS;
 
CREATE FILE PSHIER2
-RUN
 
 
-SET &&RNK_LIMIT = &&RANK_LIMIT;
-*********************************************************************************
-* Gather/Add Air Info to QRHIER File
-*********************************************************************************
 
DEFINE FILE SR_50
  CURRENT/A1 = IF &WHATDATE.EVAL GE &&FROMDT.EVAL AND &WHATDATE.EVAL LE &&TODT.EVAL THEN 'Y' ELSE 'N';
  PRIOR/A1 = IF &WHATDATE.EVAL GE &&FXDATE.EVAL AND &WHATDATE.EVAL LE &&TXDATE.EVAL THEN 'Y' ELSE 'N';
  CGADV/A8 = IF (ADV_PURCH LT 7) THEN '0-6' ELSE
             IF (ADV_PURCH GE 7) AND (ADV_PURCH LE 13) THEN '7-13' ELSE
             IF (ADV_PURCH GE 14) AND (ADV_PURCH LE 20) THEN '14-20' ELSE
                '21+';
 
  BRK_LVL/I2 = &&BRK_LVL;
  LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = GETTOK(LEVEL_DESC1, 60, -1, ')', 25, LEVEL_DESC);
 
  FARE_PAID/P12.2 = SEG_AMT + SEG_TAX;
  AIRLINE_FEE/D8.2CS = IF EMBARK EQ 'FP2' OR 'FP3' THEN FARE_PAID ELSE 0;
 
  NET_TKT_CNT/P12    = IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (FARE_PAID GE 0) AND
                          (SEG_COUNT EQ 1) AND
                          (CONJ_REL EQ 1) THEN 1 ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (EX_FLAG EQ 'F') THEN (-1) ELSE
                       IF (TICKET_CODE EQ '1') AND
                          (SEG_NBR EQ '01') AND
                          (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
 
  SAVINGS/P12.2     = SEG_STANDARD - FARE_PAID;
  NEW_ADV_PURCH/D9    = ADV_PURCH;
 
  NEW_SEG_MILES/D12 = SEG_MILES;
 -* Defines on Previous Defines
  DISSAVINGS/P12.2 = IF EMBARK EQ 'DT1' THEN 0 ELSE
                   FARE_PAID-SEG_LOWEST;
-* Defines added for CCI exchange fields
 
F_EXCH_CNT/D8CS   = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND
                           (CONJ_REL EQ 1) THEN 0 ELSE
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (EX_FLAG EQ 'F') THEN 1 ELSE 0;
CFEXCH/P12CS = IF CURRENT EQ 'Y' THEN F_EXCH_CNT ELSE 0;
CAIR_FEE/P12.2 = IF CURRENT EQ 'Y' THEN AIRLINE_FEE ELSE 0;
 
END
-RUN
 
 
TABLEF FILE SR_50
PRINT CGADV
  CURRENT
  PRIOR
  DISSAVINGS
  DOD_TYPE
  AIR_MAIN.INTL_DOM AS 'INTDOM'
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
  CFEXCH
  CAIR_FEE
  RF_FLAG
  EX_FLAG
WHERE (&WHATDATE.EVAL GE &&FROMDT.EVAL) AND (&WHATDATE.EVAL LE &&TODT.EVAL)
-*OR   (&WHATDATE.EVAL GE &&FXDATE.EVAL) AND (&WHATDATE.EVAL LE &&TXDATE.EVAL)
WHERE VOID_DATE EQ 0
-INCLUDE RPTPARMS
ON TABLE HOLD AS RPTHOLD
END
-RUN
 
 
 
TABLE FILE RPTHOLD
PRINT CGADV
  CFEXCH
  CAIR_FEE
  DISSAVINGS
  DOD_TYPE
  INTDOM
  FARE_PAID
  LEVEL_DESC
  NET_TKT_CNT
  NEW_ADV_PURCH
  NEW_SEG_MILES
  NONREF_FLAG
  ONLINE_TRADITIONAL
  SEG_COUNT
  SEG_NBR
  TKT_NUM
  TRN_DATE
  RF_FLAG
  EX_FLAG
BY CURRENT
-*BY PRIOR
BY LEVEL_DESC
-IF &&SETF NE 'ABSMHID' GOTO SKIPDom;
WHERE INTDOM NE 'I'
-SKIPDom;
-IF &&SETF NE 'ABSMHII' GOTO SKIPInt;
WHERE INTDOM EQ 'I'
-SKIPInt;
ON TABLE HOLD AS TRANONE
END
-RUN
 
 
 
-IF &LINES EQ 0 THEN GOTO NOREC;
 
-SET &&RPTSUF = 'HIERSUM';
-INCLUDE FDEFRPTS
-RUN
 
 
DEFINE FILE TRANONE
NEW_ADV_PURCH1/D9 = IF RF_FLAG EQ ' ' THEN NEW_ADV_PURCH ELSE
                    IF EX_FLAG EQ ' ' THEN NEW_ADV_PURCH ELSE (NEW_ADV_PURCH * (-1));
TTLDAYS/D8 = NEW_ADV_PURCH1*NET_TKT_CNT;
CAVOL/P12.2 = IF CURRENT EQ 'Y' THEN FARE_PAID ELSE 0;
CMILES/P12 = IF CURRENT EQ 'Y' THEN NEW_SEG_MILES ELSE 0;
-*PAVOL/P12.2 = IF PRIOR EQ 'Y' THEN FARE_PAID ELSE 0;
CNTKT/P12 = IF CURRENT EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CNTKTD/P12 = IF CURRENT EQ 'Y' AND INTDOM EQ 'D' THEN NET_TKT_CNT ELSE 0;
-*PNTKT/P12 = IF PRIOR EQ 'Y' THEN NET_TKT_CNT ELSE 0;
CLSAV/P12.2 = IF CURRENT EQ 'Y' THEN DISSAVINGS ELSE 0;
CADVT/P12 = IF (CURRENT EQ 'Y') AND
                (CGADV EQ '0-6') THEN NET_TKT_CNT ELSE 0;
CADVT1/P12 = IF (CURRENT EQ 'Y') AND
                 (CGADV EQ '7-13') THEN NET_TKT_CNT ELSE 0;
CONL/P12 = IF (CURRENT EQ 'Y') AND (ONLINE_TRADITIONAL EQ 'ONLINE') AND (INTDOM EQ 'D') THEN
                  NET_TKT_CNT ELSE 0;
CNR/P12 = IF (CURRENT EQ 'Y') AND (NONREF_FLAG EQ 'N') THEN
              NET_TKT_CNT ELSE 0;
CTTLDAYS/D8 = IF CURRENT EQ 'Y' THEN TTLDAYS ELSE 0;
END
-RUN
 
 
TABLE FILE TRANONE
SUM CADVT
    CADVT1
    CAVOL
    CLSAV
    CMILES
    CNR
    CNTKT
    CONL
-*    PNTKT
    CNTKTD
    CNR
-*    PAVOL
    CFEXCH/D12
    CAIR_FEE
    CTTLDAYS
BY LEVEL_DESC
ON TABLE HOLD AS TRANTWO
END
-RUN
 
-GOTO NewAir;
 
 
TABLE FILE TRANTWO
PRINT CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR LEVEL_DESC CFEXCH CAIR_FEE CTTLDAYS
RANKED BY HIGHEST CAVOL
ON TABLE HOLD AS RNK1
END
-RUN
 
-INCLUDE OTHPARMS
-RUN
 
DEFINE FILE RNK1
-* RANK_LIMIT/I2 = 9999;
 RANK_LIMIT/I2 = &&RANK_LIMIT;
 RLIMIT/A2    = EDIT(RANK_LIMIT) ;
 CRANK/D5     = RANK;
 BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
 LIST/D6 = IF LEVEL_DESC NE LAST LEVEL_DESC THEN (LAST LIST + 1)
           ELSE LAST LIST;
 FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
 FRANK/A6  = EDIT(FRANKX,'$999999');
 RANK_VALUE/A9 = IF RANK_LIMIT EQ 0 THEN BRANK ELSE
                IF LIST GT RANK_LIMIT THEN 'ALL OTHER' ELSE FRANK;
 LVL_PRINT/A25 =IF RANK_VALUE LT RLIMIT THEN LEVEL_DESC ELSE 'ALL OTHER';
END
-RUN
 
TABLE FILE RNK1
SUM CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR CFEXCH CAIR_FEE CTTLDAYS
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS RNK2
END
-RUN
 
 
 
TABLE FILE RNK2
PRINT LVL_PRINT RANK_VALUE CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT  CONL CNTKTD  CFEXCH CAIR_FEE CTTLDAYS
ON TABLE SAVE
END
-RUN
 
 
MODIFY FILE PSHIER2
LOG DUPL MSG OFF
FIXFORM LVL_PRINT/25 RANK_VALUE/9 CADVT/12 CADVT1/12 CAVOL/12 CLSAV/12 CMILES/12 CNR/12 CNTKT/12  CONL/12 CNTKTD/12  CFEXCH/12 CAIR_FEE/12 CTTLDAYS/8
MATCH RANK_VALUE LVL_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
 
TABLE FILE RNK1
SUM LST.LIST LVL_PRINT
WHERE LVL_PRINT NE 'ALL OTHER'
ON TABLE HOLD AS LASTRANK
END
-RUN
 
-IF &RECORDS EQ 0 THEN GOTO NOADDP;
 
 
DEFINE FILE LASTRANK
NRANK/D6 = LIST + 1;
NRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
FRANK/A6  = EDIT(NRANKX,'$999999');
CAVOL/P12.2 =  0;
CMILES/P12 =  0;
CNTKT/P12 =  0;
CNTKTD/P12 =  0;
CLSAV/P12.2 =  0;
CADVT/P12 = 0;
CADVT1/P12 =  0;
CONL/P12 =  0;
CNR/P12 =  0;
CFEXCH/P12 = 0;
CAIR_FEE/P12.2 = 0;
CTTLDAYS/P8 = 0;
 RANK_VALUE/A9 = 'ALL OTHER' ;
 LVL_PRINT/A25=  'ALL OTHER';
END
TABLE FILE LASTRANK
PRINT NRANK LVL_PRINT RANK_VALUE CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT  CONL CNTKTD  CFEXCH CAIR_FEE CTTLDAYS
ON TABLE HOLD AS LASTRANK1
END
-RUN
 
TABLE FILE LASTRANK1
PRINT LVL_PRINT RANK_VALUE CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT  CONL CNTKTD  CFEXCH CAIR_FEE CTTLDAYS
ON TABLE SAVE
END
-RUN
 
MODIFY FILE PSHIER2
LOG DUPL MSG OFF
FIXFORM LVL_PRINT/25 RANK_VALUE/9 CADVT/12 CADVT1/12 CAVOL/12 CLSAV/12 CMILES/12 CNR/12 CNTKT/12  CONL/12 CNTKTD/12  CFEXCH/12 CAIR_FEE/12 CTTLDAYS/8
MATCH RANK_VALUE LVL_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
-NOADDP
DEFINE FILE RNK2
LVLP/A27 = ''''||LVL_PRINT||'''';
END
-RUN
TABLE FILE RNK2
PRINT LVLP
BY LVL_PRINT NOPRINT
ON TABLE SAVE AS LEVELF
END
-RUN
 
-NewAir
TABLE FILE TRANTWO
PRINT CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR  CFEXCH CAIR_FEE CTTLDAYS
 BY LEVEL_DESC
ON TABLE HOLD AS PETAIR
END
-RUN
 
-*********************************************************************************
-* Gather/Add Car Info to QRHIER File Based upon
-*********************************************************************************
 
EX CARUSE
-RUN
 
 
-SET &&RPTGRP = 'CAR';
EX UDIDGEN
-RUN
 
-INCLUDE RESETCPM
-RUN
 
 
-SET &WHATDATEC = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'INVOICE_DATE' ELSE 'PICKUP_DATE';
 
 
 
DEFINE FILE CR_50
 LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = GETTOK(LEVEL_DESC1, 60, -1, ')', 25, LEVEL_DESC);
 RENTAL_DAYS/P12 = IF (NUM_DAYS LT 0) AND (NUM_CARS LT 0) THEN
                   ((NUM_DAYS * NUM_CARS) * (-1)) ELSE NUM_DAYS * NUM_CARS;
END
 
-RUN
TABLE FILE CR_50
SUM RENTAL_DAYS
    RENTAL_AMT
BY LEVEL_DESC
WHERE (&WHATDATEC.EVAL GE '&&FROMDT.EVAL') AND (&WHATDATEC.EVAL LE '&&TODT.EVAL')
-IF &&SETF NE 'ABSMHID' GOTO NoDomonly;
WHERE PICK_CTY.INTL_DOM NE 'I'
-NoDomonly;
-IF &&SETF NE 'ABSMHII' GOTO NoIntonly;
WHERE PICK_CTY.INTL_DOM EQ 'I'
-NoIntonly;
-INCLUDE RPTPARMS
ON TABLE HOLD AS CAR1
END
-RUN
 
 
 
 
 
TABLE FILE CAR1
SUM RENTAL_AMT/P12.2 AS 'CARVOL'
    RENTAL_DAYS/P12 AS 'CARDAY'
BY LEVEL_DESC
ON TABLE HOLD AS CAR2
END
-RUN
-GOTO NewCar
 
-******************************************************
-* Matching Hierarchy Levels
-******************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY LEVEL_DESC
WHERE LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS CARMREC
END
-RUN
 
 
 
 
TABLE FILE CARMREC
SUM CARVOL
    CARDAY
BY LEVEL_DESC AS 'LVL_PRINT'
ON TABLE HOLD AS CARMREC1
END
-RUN
 
TABLE FILE CARMREC1
SUM CARVOL CARDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE PSHIER2
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 CARVOL/12 CARDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching information ALL OTHER
-**********************************************************************
 
TABLE FILE CAR2
SUM CARVOL
    CARDAY
BY LEVEL_DESC
WHERE NOT LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS CARNREC
END
-RUN
 
 
 
DEFINE FILE CARNREC
LVL_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE CARNREC
SUM CARVOL CARDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE PSHIER2
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 CARVOL/12 CARDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE CARVOL CARDAY
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-NewCar
 
 
 
TABLE FILE CAR1
SUM RENTAL_AMT/P12.2 AS 'CARVOL'
    RENTAL_DAYS/P12 AS 'CARDAY'
BY LEVEL_DESC
ON TABLE HOLD AS CAR2
END
-RUN
 
TABLE FILE CAR2
PRINT CARVOL CARDAY
BY LEVEL_DESC
ON TABLE HOLD AS PETCAR
END
-RUN
 
-* Match Air hold file to Car hold File
MATCH  FILE TRANTWO
PRINT CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR  CFEXCH CAIR_FEE CTTLDAYS
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE PETCAR
SUM CARVOL CARDAY
BY LEVEL_DESC
AFTER MATCH HOLD AS XTWO OLD-OR-NEW
END
-RUN
 
 
-*********************************************************************************
-* Gather/Add HTL Info to QRHIER File
-*********************************************************************************
FILEDEF RPTPARMS CLEAR
-RUN
 
EX HTLUSE
-RUN
 
-SET &&RPTGRP = 'HTL';
EX UDIDGEN
-RUN
 
-INCLUDE RESETHPM
-RUN
 
-SET &WHATDATEH = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'INVOICE_DATE' ELSE 'CHKIN_DATE';
 
 
 
DEFINE FILE HR_50
 LEVEL_DESC1/A60 = &&LDESC;
  LEVEL_DESC/A25 = GETTOK(LEVEL_DESC1, 60, -1, ')', 25, LEVEL_DESC);
 NBR_DAYS/P12=NUM_DAYS;
 NEW_TOTAL_AMT/P12.2 = TOTAL_AMT;
 NNROOMS/P12 = IF ((NBR_DAYS LT 0) AND (NUM_ROOMS LT 0)) THEN
                ((NBR_DAYS*NUM_ROOMS) * (-1)) ELSE NBR_DAYS*NUM_ROOMS;
END
-RUN
 
TABLE FILE HR_50
SUM NEW_TOTAL_AMT
    NNROOMS
BY LEVEL_DESC
WHERE (&WHATDATEH.EVAL GE '&&FROMDT.EVAL') AND (&WHATDATEH.EVAL LE '&&TODT.EVAL')
-IF &&SETF NE 'ABSMHID' GOTO NoHDomonly;
WHERE CITY.INTL_DOM NE 'I'
-NoHDomonly;
-IF &&SETF NE 'ABSMHII' GOTO NoHIntonly;
WHERE CITY.INTL_DOM EQ 'I'
-NoHIntonly;
-INCLUDE RPTPARMS
ON TABLE HOLD AS HTL1
END
-RUN
 
 
 
-**************************************************************************
-* Matching Hotel Records
-**************************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY LEVEL_DESC
ON TABLE HOLD AS HTL2
END
-RUN
 
-GOTO NewHtl
 
TABLE FILE HTL2
SUM HTLVOL
   HTLDAY
BY LEVEL_DESC
WHERE LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS HTLMREC
END
-RUN
 
TABLE FILE HTLMREC
SUM HTLVOL HTLDAY
BY LEVEL_DESC AS 'LVL_PRINT'
ON TABLE HOLD AS HTLMREC1
END
-RUN
 
TABLE FILE HTLMREC1
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE PSHIER2
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 HTLVOL/12 HTLDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-**********************************************************************
-* Non Matching ALL OTHER Records
-**********************************************************************
TABLE FILE HTL1
SUM NEW_TOTAL_AMT AS 'HTLVOL'
    NNROOMS AS 'HTLDAY'
BY LEVEL_DESC
WHERE NOT LEVEL_DESC IN FILE LEVELF
ON TABLE HOLD AS HTLNREC
END
-RUN
 
 
DEFINE FILE HTLNREC
LVL_PRINT/A25 = 'ALL OTHER';
END
-RUN
TABLE FILE HTLNREC
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE HOLD AS HTLNREC1
END
-RUN
 
TABLE FILE HTLNREC1
SUM HTLVOL HTLDAY
BY LVL_PRINT
ON TABLE SAVE
END
-RUN
 
MODIFY FILE PSHIER2
LOG NOMATCH MSG OFF
FIXFORM LVL_PRINT/25 HTLVOL/12 HTLDAY/12
MATCH LVL_PRINT
ON MATCH UPDATE HTLDAY HTLVOL
ON NOMATCH REJECT
DATA ON SAVE
END
-RUN
 
-NewHtl
 
TABLE FILE HTL1
SUM
    NNROOMS AS 'HTLDAY'
    NEW_TOTAL_AMT AS 'HTLVOL'
BY LEVEL_DESC
ON TABLE HOLD AS PETHTL
END
-RUN
 
 
-*Match Air and Car hold file to Hotel hold file
 
MATCH  FILE XTWO
PRINT CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR
      CFEXCH CAIR_FEE CTTLDAYS CARVOL CARDAY
BY LEVEL_DESC
ON TABLE HOLD
RUN
FILE PETHTL
SUM HTLDAY HTLVOL
BY LEVEL_DESC
AFTER MATCH HOLD AS XTHREE OLD-OR-NEW
END
-RUN
 
 
DEFINE FILE XTHREE
TACH/D12.2CS = CAVOL + HTLVOL + CARVOL;
END
TABLE FILE XTHREE
PRINT CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR
      CFEXCH CAIR_FEE CTTLDAYS CARVOL CARDAY  HTLDAY HTLVOL
      TACH
BY LEVEL_DESC
ON TABLE HOLD AS ACHHLD
END
-RUN
 
 
TABLE FILE ACHHLD
PRINT CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL CNTKTD CNR
      CFEXCH CAIR_FEE CTTLDAYS CARVOL CARDAY  HTLDAY HTLVOL
      TACH LEVEL_DESC
RANKED BY HIGHEST TACH
ON TABLE HOLD AS RNK1
END
-RUN
 
 
DEFINE FILE RNK1
 RNK_LIMIT/I2 = &&RNK_LIMIT;
 RANK_LIMIT/I2 = RNK_LIMIT;
 
 RLIMIT/A2    = EDIT(RANK_LIMIT) ;
 CRANK/D5     = RANK;
 BRANK/A6     = FTOA(CRANK, '(D5)', 'A6');
 LIST/D6 = IF LEVEL_DESC NE LAST LEVEL_DESC THEN (LAST LIST + 1)
           ELSE LAST LIST;
 FRANKX/A7 = FTOA(LIST, '(D6)', 'A7');
 FRANK/A6  = EDIT(FRANKX,'$999999');
 RANK_VALUE/A9 = IF RANK_LIMIT EQ 0 THEN BRANK ELSE
                IF LIST GT RANK_LIMIT THEN 'ALL OTHER' ELSE FRANK;
 LVL_PRINT/A25 =IF RANK_VALUE LT RLIMIT THEN LEVEL_DESC ELSE 'ALL OTHER';
END
-RUN
 
 
TABLE FILE RNK1
SUM TACH CAVOL CMILES CNTKT  CLSAV  CADVT CADVT1 CONL
    CNTKTD CNR CFEXCH CAIR_FEE CTTLDAYS CARVOL CARDAY  HTLDAY HTLVOL LEVEL_DESC
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS RNK2
END
-RUN
 
TABLE FILE RNK2
PRINT CADVT CADVT1 CAVOL CLSAV CMILES CNR CNTKT
      CONL CNTKTD  CFEXCH CAIR_FEE CTTLDAYS CARVOL CARDAY  HTLDAY  HTLVOL TACH
BY LVL_PRINT
BY RANK_VALUE
ON TABLE SAVE
END
-RUN
 
 
MODIFY FILE PSHIER2
LOG DUPL MSG OFF
FIXFORM LVL_PRINT/25 RANK_VALUE/9 CADVT/12 CADVT1/12 CAVOL/12 CLSAV/12 CMILES/12 CNR/12 CNTKT/12  CONL/12 CNTKTD/12 CFEXCH/12 CAIR_FEE/12 CTTLDAYS/8 CARVOL/12 CARDAY/12 HTLDAY/12  HTLVOL/12 TACH/12
MATCH RANK_VALUE LVL_PRINT
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON SAVE
END
-RUN
 
 
 
 
 
 
 
 
 
-SUMMARY
 
 
DEFINE FILE PSHIER2
RANK_VALUEA/A9 = 'TOTAL';
LVL_PRINTA/A25 = 'TOTAL';
END
-RUN
 
TABLE FILE PSHIER2
SUM CAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  CNTKT
  CLSAV/P12.2M
  PCT.CFEXCH/P4 AS 'PCTEX'
  CAIR_FEE/P12.2M
    CTTLDAYS/P8
  TACH/P12.2M
COMPUTE ADVAP/P8 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE
            (CTTLDAYS/CNTKT);
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGT/P12.2M = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE CAVOL/CNTKT;
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CNRP/P12  = IF CNTKT EQ 0 THEN 0 ELSE ((CNR/CNTKT)*100);
 
COMPUTE CPMILE/P4.2 = IF CMILES EQ 0 THEN 0 ELSE (CAVOL/CMILES);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
-*COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUEA AS 'RANK_VALUE'
-* BY LVL_PRINTA AS 'LVL_PRINT'
BY LVL_PRINTA
ON TABLE COLUMN-TOTAL
ON TABLE HOLD AS TTL1
END
-RUN
 
 
 
 
 
TABLE FILE TTL1
SUM CAVOL/P12.2M PCTVOL CNTKT/P12 CLSAV/P12 CTLS/P12 CAVGT/P12
    CADVP1/P12 CADVP2/P12 CONLP/P12 CNRP/P12 CPMILE/P10.2 PCTEX  CAIR_FEE/P12.2M CTTLDAYS/P8 ADVAP/P8 CARAR/P12 HTLARR/P12 TACH/P12.2M
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TTL2
END
-RUN
 
 
TABLE FILE TTL2
PRINT CAVOL PCTVOL CNTKT CLSAV CTLS CAVGT   CADVP1 CADVP2
      CONLP CNRP CPMILE PCTEX CAIR_FEE CTTLDAYS ADVAP CARAR HTLARR TACH
BY RANK_VALUE
BY LVL_PRINT
 
ON TABLE HOLD AS TTL3 FORMAT FOCUS
END
-RUN
 
 
DEFINE FILE PSHIER2
NWLVL_PRINT/A25 = EDIT(LVL_PRINT, '9999999999999999999999999');
END
TABLE FILE PSHIER2
SUM CAVOL/P12.2M
  PCT.CAVOL/P4 AS 'PCTVOL'
  CNTKT
  CLSAV/P12.2M
  PCT.CFEXCH/P4 AS 'PCTEX'
  CAIR_FEE/P12.2M
  CTTLDAYS/P8
  TACH/P12.2
 
COMPUTE ADVAP/P8 = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE
            (CTTLDAYS/CNTKT);
COMPUTE CTLS/P12 =  IF CAVOL EQ 0 THEN 0 ELSE ((CLSAV/CAVOL)*100);
COMPUTE CAVGT/P12.2M = IF ((CNTKT LT 1) AND (CNTKT GT (-1))) THEN 0 ELSE CAVOL/CNTKT;
-*COMPUTE PAVGT/P12.2M = IF ((PNTKT LT 1) AND (PNTKT GT (-1))) THEN 0 ELSE PAVOL/PNTKT; NOPRINT
-*COMPUTE AAVGV/P12.2M = CAVGT - PAVGT; NOPRINT
-*COMPUTE AAVGV1/P12 = IF PAVGT EQ 0 THEN 0 ELSE (((CAVGT-PAVGT)/PAVGT)*100);
COMPUTE CADVP1/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT/CNTKT)*100);
COMPUTE CADVP2/P12 = IF CNTKT EQ 0 THEN 0 ELSE ((CADVT1/CNTKT)*100);
COMPUTE CONLP/P12  = IF CNTKTD EQ 0 THEN 0 ELSE ((CONL/CNTKTD)*100);
COMPUTE CNRP/P12  = IF CNTKT EQ 0 THEN 0 ELSE ((CNR/CNTKT)*100);
COMPUTE CPMILE/P4.2 = IF CMILES EQ 0 THEN 0 ELSE (CAVOL/CMILES);
COMPUTE CARAR/P12.2M = IF ((CARDAY LT 1) AND (CARDAY GT (-1))) THEN 0 ELSE CARVOL/CARDAY;
COMPUTE HTLARR/P12.2M = IF ((HTLDAY LT 1) AND (HTLDAY GT (-1))) THEN 0 ELSE HTLVOL/HTLDAY;
-*COMPUTE TACH/P12.2M = CAVOL + CARVOL + HTLVOL;
BY RANK_VALUE
BY NWLVL_PRINT AS 'LVL_PRINT'
ON TABLE HOLD AS TLEV1
END
-RUN
 
 
 
TABLE FILE TLEV1
 
 
PRINT CAVOL/P12 PCTVOL/P4 CNTKT/P12 CLSAV/P12 CTLS/P12 CAVGT/P12  CADVP1/P12 CADVP2/P12
      CONLP/P12 CNRP/P12 CPMILE/P10.2 PCTEX CAIR_FEE/P12.2 CTTLDAYS/P8 ADVAP/P8 CARAR/P12 HTLARR/P12 TACH/P12.2
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV2
END
-RUN
 
 
TABLE FILE TLEV2
 
PRINT CAVOL PCTVOL CNTKT CLSAV CTLS CAVGT  CADVP1 CADVP2
      CONLP CNRP CPMILE PCTEX CAIR_FEE CTTLDAYS ADVAP CARAR HTLARR TACH
BY RANK_VALUE
BY LVL_PRINT
ON TABLE HOLD AS TLEV3 FORMAT FOCUS
END
-RUN
 
 
 
 
 
-SET &HLDPATH=TEMPPATH(50,'A50');
-SET &PHOLD1=&HLDPATH || 'TLEV3.FOC';
-SET &PHOLD2=&HLDPATH || 'TTL3.FOC';
-RUN
 
USE CLEAR *
-RUN
 
EX SUUSES
-RUN
 
USE ADD
&PHOLD1 AS TLEV3
&PHOLD2 AS TLEV3
END
-RUN
 
 
DEFINE FILE TLEV3
RANK_VAL1/A9 = IF RANK_VALUE EQ 'TOTAL' THEN 'ZZ' ELSE RANK_VALUE;
END
-RUN
 
TABLE FILE TLEV3
SUM CAVOL PCTVOL CNTKT CLSAV CTLS CAVGT  CADVP1 CADVP2
    CONLP CNRP CPMILE PCTEX CAIR_FEE CTTLDAYS ADVAP CARAR HTLARR TACH
COMPUTE ZFLAG/A1 = IF (RANK_VAL1 EQ 'ALL OTHER') AND (TACH EQ 0) THEN 'Y' ELSE 'N';
BY RANK_VAL1
BY LVL_PRINT
ON TABLE HOLD AS TLEV4
END
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF3;
-INCLUDE AVRP_SUBFOOT
-:AVSF3
 
JOIN ROLL WITH RANK_VAL1 IN TLEV4 TO ROLLUP_CODE IN ROLLUP AS J1
-RUN
 
DEFINE FILE TLEV4
NOWTOD/A8 WITH RANK_VAL1 = HHMMSS (NOWTOD);
ROLL/A8='&&ROLLUP.EVAL';
  RPHONE/A15=EDIT(ROLL_PHONE,'9-999-999-9999');
  RN/A60=TRIM('B', '&&RPT_TTL1.EVAL', 60, ' ', 1, 'A60');
  RN1/A60=TRIM('B', '&&RPT_TTL2.EVAL', 60, ' ', 1, 'A60');
  TDATE1/A8MDYY='&MDYY';
  TDATE2/A10=EDIT(TDATE1,'99/99/9999');
  TIME1/A8=HHMMSS('A8');
  TIME2/A8=EDIT(TIME1,'99$:99$:99');
  RD/A10 = 'Run Date:';
  RT/A10 = 'Run Time:';
  DTDESC/A20='Transaction Dates';
  CUR/A15='Current Period:';
  PRI/A15='Prior Period:';
  SPACE/A1 = 'A';
  KEY/A1 = IF RANK_VAL1 EQ 'TOTAL' THEN 'B' ELSE 'A';
END
-RUN
 
 
TABLE FILE TLEV4
HEADING
-IF '&&OUTFMT.EVAL' EQ 'PDF' THEN GOTO HEAD2P;
 
-* "Client: <6 <ROLL_NAME "
-* "Contact: <6 <ROLL_CONTACT"
-* "Phone: <6 <RPHONE "
-* " "
-* "<CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-* " <PRI       &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
-* " "
-* "<RN "
-* "<RN1 "
-*
-* RSB 
-* "&&ROLLNME &&SP1 &&ROLLCS11 &&SP3 &&RCNCT1 &&SP4 &&ROLLPHN"
"&&ROLLNME &&SP1 &&ROLLCS &&SP3 &&RCNCT &&SP4 &&ROLLPHN"
-* RSB 
-*
-*"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY  Period2: &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"&&DTDESC  Period1: &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
 
"&&RPT_TTL1"
"&&RPT_TTL2"
 
 
-GOTO SkipHeadP
 
-HEAD2P 
-QUIT


"</5"
"<86 &&DTDESC"
"<42 <RN <83 <CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-*"<42 <RN1 <83 <PRI  &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
"<42 <RN1 <83 "
 
"<96 &&ROLLNME <+0> &&SP <+0> &&ROLLCS <+0> &&SP3 <+0> &&ROLLCNCT <+0> &&SP4 <+0> &&ROLLPHN"
" "
-* "Client: <6 <ROLL_NAME <42 <RN <90 <DTDESC"
-* "Contact: <6 <ROLL_CONTACT <40 <RN1 <90 <CUR  &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-* "Phone: <6 <RPHONE <90 <PRI       &FXMM/&FXMD/&FXMY - &TXOM/&TXOD/&TXOY"
-* " "
-SkipHeadP
 
 
SUM CAVOL/P12CM AS 'Total,Volume'
    PCTVOL/P4% AS '% of,Total,Volume'
    CNTKT/P12C AS 'Net,Tickets'
    CLSAV/P12CM AS 'Total,Lost,Savings'
    CTLS/P4% AS '% of,LS to,Air,Volume'
    CAVGT/P12CM AS 'Avg,Ticket,Price'
    CADVP1/P4% AS '% Of,Net Tickets,Purchased,0-6 Days'
    CADVP2/P4% AS '% of,Net Tickets,Purchased,7-13 Days'
    ADVAP/P8 AS 'Avg,Nbr of,Bkg,Days'
 
    CONLP/P4% AS '% Dom,Online'
    CNRP/P4% AS '% of,NR'
    CPMILE/P10.2M AS 'CPM'
    CARAR/P12CM AS 'Avg,Car,Rate'
    HTLARR/P12CM AS 'Avg,Hotel,Cost Per,Night'
    TACH/P12CM AS 'Total Air,Car &,Hotel,Spend'
BY RANK_VAL1 NOPRINT
BY KEY NOPRINT
BY LVL_PRINT AS 'HIERARCHY'
WHERE ZFLAG EQ 'N'
 
 
 
ON TABLE SET PAGE-NUM OFF
&&OUTLINE1
&&OUTLINE2
-*
-INCLUDE FOOTERSM
-*
ON TABLE PAGE-BREAK AND SUBFOOT
-* " "
-INCLUDE SBFOOT
ON TABLE SET STYLE *
-IF '&&OUTFMT.EVAL' EQ 'EXCEL' OR 'EXL2K' THEN GOTO NOBP;
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.050000, RIGHTMARGIN=0.050000,
    TOPMARGIN=0.00000, BOTTOMMARGIN=0.010000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
 
 
TYPE=REPORT, FONT='ARIAL', SIZE=7, STYLE=NORMAL, BACKCOLOR=NONE, JUSTIFY=LEFT, $
 
 
TYPE=DATA,
     GRID=OFF,
     SIZE=7,
     STYLE=NORMAL,
     BACKCOLOR=('WHITE' RGB(239 239 239)),
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR=RGB(5 76 149),
     BORDER-BOTTOM-COLOR=RGB(5 76 149),
     BORDER-LEFT-COLOR=RGB(5 76 149),
     BORDER-RIGHT-COLOR=RGB(5 76 149),
     JUSTIFY=LEFT,
     WHEN=N1 NE 'ZZ',
$
-NOBP

-IF &&OVERDRILL EQ 'Y' GOTO OVERDRILLPETS;

TYPE=DATA, COLUMN=N4, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='A'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N6, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='N'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N7, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='L'     \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N9, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='T'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N10, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='6'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N11, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='7'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N12, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='P'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N13, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='O'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
 
TYPE=DATA, COLUMN=N14, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMair1' ROW_LABEL=N1 LSEL=LVL_PRINT PARM1='R'    \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N16, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMCAR' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$
TYPE=DATA, COLUMN=N17, STYLE=-UNDERLINE, COLOR=RGB(0 0 138), \
URL=&&SRVR.EVAL/ibi_apps/WFServlet? \
(IBIF_ex='drSMHTL' ROW_LABEL=N1 LSEL=LVL_PRINT   \
SETFNM='&&DTTMSTRM.EVAL' \
FPARM='&&DTTMID.EVAL' \
DTTYPE='&&DATETYPE.EVAL'\
ROLUP='&&ROLLUP' user='&&UNAME'),
$

-OVERDRILLPETS;

-IF '&&OUTFMT.EVAL' EQ 'EXCEL' OR 'EXL2K' THEN GOTO NOB2P;
 
TYPE=HEADING,
     SIZE=8,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=HEADING,
     SIZE=9,
     LINE=2,
     ITEM=1,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=HEADING,
     SIZE=9,
     LINE=3,
     ITEM=1,
     JUSTIFY=LEFT,
     COLOR=RGB(70 136 177),
     STYLE=BOLD,
     FONT='ARIAL',
$
 
TYPE=TITLE,
     FONT='TIMES NEW ROMAN',
     STYLE=BOLD,
     GRID=ON,
     SIZE=7,
     COLOR=RGB(5 76 149),
     JUSTIFY=LEFT,
$
-GOTO PDFFMTP
 
-NOB2P
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
 
TYPE=REPORT, FONT=ARIAL, SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(31 114 164), BACKCOLOR=NONE, $
TYPE=HEADING, HEADALIGN=BODY, $
TYPE=HEADING, LINE=1, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=2, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=HEADING, LINE=3, COLSPAN=9, SIZE=9, JUSTIFY=CENTER, $
TYPE=HEADING, LINE=4, COLSPAN=9, SIZE=9,JUSTIFY=CENTER, $
TYPE=HEADING, LINE=5, COLSPAN=3, JUSTIFY=LEFT, $
TYPE=DATA,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     BACKCOLOR=(RGB(242 242 242) 'WHITE' ),$
-JOYP
TYPE=TITLE,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-STYLE=RIDGE,
     BORDER-BOTTOM-STYLE=RIDGE,
     BORDER-LEFT-STYLE=RIDGE,
     BORDER-RIGHT-STYLE=RIDGE,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER',
     SIZE=8,
     COLOR='WHITE',
     BACKCOLOR=RGB(31 114 164),
     STYLE=BOLD,$
 
TYPE=TITLE, JUSTIFY=LEFT, $
 
TYPE=TABFOOTING, FONT=ARIAL, COLOR=GRAY,$
 
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
 
TYPE=SUBHEAD,
     STYLE=BOLD,
$
 
TYPE=SUBTOTAL,
     STYLE=BOLD,
     BORDER-TOP=LIGHT,
     BORDER-BOTTOM=LIGHT,
     BORDER-LEFT=LIGHT,
     BORDER-RIGHT=LIGHT,
     BORDER-TOP-COLOR='SILVER',
     BORDER-BOTTOM-COLOR='SILVER',
     BORDER-LEFT-COLOR='SILVER',
     BORDER-RIGHT-COLOR='SILVER', $
 
TYPE=GRANDTOTAL, STYLE=BOLD, $
 
-GOTO XSTYP
 
-PDFFMTP
 
TYPE=DATA, BACKCOLOR=NONE, GRID=OFF, SIZE=8,STYLE=BOLD, FONT='TIMES NEW ROMAN', JUSTIFY=LEFT, WHEN=N1 EQ 'ZZ',$
TYPE=SUBTOTAL, STYLE=BOLD, $
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
TYPE=TABFOOTING, FONT=TIMES NEW ROMAN, SIZE=6, STYLE=BOLD, COLOR=RGB(70 136 177), $
 
TYPE=REPORT, IMAGE=NEW_HDR.jpg, POSITION=(0 0), SIZE=(4.5 .375),PRESERVERATIO=ON, $ 
TYPE=REPORT, IMAGE=NEW_FTR.jpg, POSITION=(.2 8.0), SIZE=(10.5 .58), PRESERVERATIO=ON, $    
-* TYPE=REPORT,GRID=OFF, $
-XSTYP
-*
TYPE=FOOTING, LINE=&FTR_DateTimeLine, STYLE=BOLD,POSITION=(&FTR_DatePosit),$ 
-*
ENDSTYLE
 
END
-RUN
 
 
SET SPACE = 2
 
-GOTO XXIT;
 
 
 
 
 
 
 

-NOREC
-IF &&FROMAVRP NE 'Y' GOTO :AVSF2;
-INCLUDE OTHPARMS
-INCLUDE AVRP_SUBFOOT
-:AVSF2

-INCLUDE NORECRPT
-RUN
-EXIT
 
 
-XXIT
 
