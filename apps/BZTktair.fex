-*****************THIS HEADER REPRESENTS THE 80 CHARACTER MAXIUM FOR PROGRAMS**
-* File BZTKTAIR.FEX
-*1/28/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-* ADDED TRANTYPE INCLUDE - JK 12/16/14 STORY ID S-06492

-********************************************************************


-INCLUDE SETECHO
 

SET ASNAMES = ON
-SET HOLDATTR = ON;

-SET &AIRDATES = &&WEB_PATH || 'AIRDATES.fex';
-SET &WHATDATE = IF '&&DATETYPE.EVAL' EQ 'I' THEN 'TRN_DATE' ELSE 'FST_DPT_DATE';
-RUN

DEFINE FILE &&EXTRACT
  AIRLN/A30 = AIRLINE_NAME;
  CCA_CARD/A7 = EDIT(CREDIT_CARD, '99$$$$$$$$$$99999');
  CHG_COD/A47 = IF LEVEL3 NE ' ' AND LEVEL2 NE ' ' THEN
                    LEVEL1  || '-' || LEVEL2 || '-' ||LEVEL3 ELSE
                    IF LEVEL3 EQ ' ' AND LEVEL2 NE ' ' THEN
                    LEVEL1  || '-' || LEVEL2 ELSE
                    IF LEVEL3 EQ ' ' AND LEVEL2 EQ ' ' THEN LEVEL1;
  CC/A2 = EDIT(CREDIT_CARD, '99$$$$$$$$$$$$$$$$');
  CCNUM2/A4 = IF CC EQ 'AX' THEN EDIT(CREDIT_CARD,'$$$$$$$$$$$$$9999$')
             ELSE EDIT(CREDIT_CARD, '$$$$$$$$$$$$$$9999');
  CTY1/A25 = CITYPAIR.EMBARK;
  CTY2/A25 = CITYPAIR.ROUTE;
  FARE_PAID/D12.2CS   = SEG_AMT + SEG_TAX;
  LEVEL_DESC/A60 = &&LDESC;
  OTFLAG/A15 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE' ELSE 'TRADITIONAL';
  NET_TKT_CNT/D8CS    = IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (FARE_PAID GE 0) AND
                           (SEG_COUNT EQ 1) AND 
                           (CONJ_REL EQ 1) THEN 1 ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND 
                           (EX_FLAG EQ 'F') THEN (-1) ELSE 
                        IF (TICKET_CODE EQ '1') AND
                           (SEG_NBR EQ '01') AND
                           (RF_FLAG EQ 'F') THEN (-1) ELSE 0;
  NEW_ADV_PURCH/D9    = ADV_PURCH;
  NEW_SEG_DISC/D12.2CS = SEG_DISCOUNT;
                         
  TKT_TYPE/A4          = IF (SEG_COUNT LE 0) AND
                          (RF_FLAG EQ 'P') THEN 'P-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (RF_FLAG EQ 'F') THEN 'F-RF' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'P') THEN 'P-EX' ELSE
                        IF (SEG_COUNT LE 0) AND 
                          (EX_FLAG EQ 'F') THEN 'F-EX' ELSE ' ';
  XDPT_DT/MDYY         = DPT_DATE;
  XPSNGR_NM/A15        = 
    EDIT(PASSNGR_NAME,'999999999999999$$$$$$$$$$$$$$$$$$');
  XTRAN_DT/MDYY        = TRN_DATE;

-***DEFINES ON PREVIOUS DEFINES
  AIRLINE_FEE/D12.2CS = IF EMBARK EQ 'FP2' OR 'FP3' 
  THEN FARE_PAID ELSE 0;
WRCC4/A1 = IF CREDIT_CARD CONTAINS 'CA540510XXXXXX3300' OR 
               'CA540510XXXXXX6207' OR 'CA540510XXXXXX6199' OR
               'CA540510XXXXXX6181' THEN 'Y' ELSE 'N'; 
  DISSAVINGS/D11.2CS  = IF EMBARK EQ 'DT1' THEN 0 ELSE
                         FARE_PAID - SEG_LOWEST;               
  VASAVINGS/D12.2CS    = NEW_SEG_DISC - FARE_PAID;
AFLAG/A5 = 'AIR';  
-INCLUDE TRANTYPE                         
END
TABLEF FILE &&EXTRACT
PRINT AFLAG
  AIRCRAFT_TYPE AS 'AIRT'
  AIRLN  
  AIRLINE_FEE  
  AIRCRAFT_TYPE
  CCA_CARD
  CC_NUM
  CCNUM2
  CHG_COD
  CLASS
  CONJ_REL
  DISSAVINGS
  EMB_CTY.CITY_NAME AS 'CITY1' 
  EX_FLAG
  FARE_PAID
  LEVEL_DESC
  LEVEL1
  LEVEL2
  LEVEL3 
  LEVEL4
  NET_TKT_CNT 
  NEW_ADV_PURCH
  OTFLAG
  PASSNGR_NAME
  PNR_LOCATOR
  REFUSE_CODE
  RF_FLAG
  RTE_CTY.CITY_NAME AS 'CITY2'
  SEG_COUNT
  SEG_NBR
  SEG_LOWEST
  TICKET_CODE
  TKT_DATE
  TKT_NUM
  TKT_SORT
  TKT_TYPE
  VASAVINGS
  &WHATDATE
  TRIP_PURPOSE
  XDPT_DT   
  XTRAN_DT   
  XPSNGR_NM
  EMB_APT.GEO_ZONE AS 'GEO_ZONE'

-INCLUDE BYHIERARCHY
-INCLUDE &AIRDATES
WHERE VOID_DATE EQ 0

-********************************************************************
-* Where statements to select data specified in user profile
-********************************************************************
&&WHERE1
&&WHERE2
&&WHERE3
&&WHERE4
-*&&WHERE5
-*&&WHERE6
-* &&WHERE7
-* &&WHERE8
-* &&WHERE9
-* &&WHERE10

-INCLUDE RPTPARMS
ON TABLE HOLD AS AIRHOLD
END
-RUN

TABLE FILE AIRHOLD
PRINT AFLAG 
BY LEVEL_DESC
BY PNR_LOCATOR
ON TABLE HOLD AS AIRHOLD1
END



 
 

