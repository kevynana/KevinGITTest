CURRQ/Q = INVOICE_DATE;
CY/Y = INVOICE_DATE;
CM/M  = INVOICE_DATE;
FM/M = &&ROLLFY;
DM/I2 = CM - FM;

TRANYR/YY= INVOICE_DATE;
AYEAR/A4YY = TRANYR;

THEYR/I1 = IF (INVOICE_DATE GE '&&FROMDT.EVAL') AND (INVOICE_DATE LE '&&TODT.EVAL') THEN 2
  ELSE IF (INVOICE_DATE GE '&&FXDATE.EVAL') AND (INVOICE_DATE LE '&&TXDATE.EVAL') THEN 1;

-*first year as fiscal year label
FMDATE1/YYMD='&&FXDATE.EVAL';
FMDATE2/YYMD='&&FROMDT.EVAL';
FYYR1/Y=FMDATE1;
FYYR2/Y=FMDATE2;

-*second year as fiscal year label
Y2DATE/YYMD = DATEADD(FMDATE2, 'Y', 1);
FYYR3/Y=Y2DATE;

FY_YR/A4= IF '&&FYFLAG.EVAL' EQ '1' AND THEYR EQ 1 THEN 'FY' | EDIT(FYYR1) 
  ELSE IF '&&FYFLAG.EVAL' EQ '1' AND THEYR EQ 2 THEN 'FY' | EDIT(FYYR2) 
  ELSE IF '&&FYFLAG.EVAL' EQ '2' AND THEYR EQ 1 THEN 'FY' | EDIT(FYYR2) 
  ELSE IF '&&FYFLAG.EVAL' EQ '2' AND THEYR EQ 2 THEN 'FY' | EDIT(FYYR3) 
  ELSE AYEAR;

YEAR/A4 = IF FM EQ 01 THEN AYEAR ELSE FY_YR;
  
FTRAN1/A2 = IF FM EQ 01 THEN 'Q' | EDIT(CURRQ)  
  ELSE IF (DM GE 9 OR (DM GE -3 AND DM LE -1)) THEN 'Q4'
  ELSE IF (DM GE 6 OR (DM GE -6 AND DM LE -4)) THEN 'Q3' 
  ELSE IF (DM GE 3 OR (DM GE -9 AND DM LE -7))  THEN 'Q2'
  ELSE IF DM LE 0 AND FM GE 11 THEN 'Q1' 
  ELSE 'Q1';    
  
FTRAN/A6 = IF FM EQ 01 THEN FTRAN1 | ' ' | EDIT(CY)
  ELSE FTRAN1 | FY_YR;
  
TRAN/A7 = IF THEYR EQ 1 THEN ' ' | FTRAN ELSE FTRAN;

-*Current: current YTD; PRIOR: prior year; PYTD: prior YTD flag; PQ: prior quarter; CQ: current quarter
CURRENT/A1 = IF INVOICE_DATE GE '&&FROMDT.EVAL'  AND INVOICE_DATE LE '&&TODT.EVAL'     THEN 'Y' ELSE 'N';
PRIOR/A1   = IF INVOICE_DATE GE '&&FXDATE.EVAL'  AND INVOICE_DATE LE '&&TXDATE.EVAL'   THEN 'Y' ELSE 'N'; 
PYTD/A1    = IF INVOICE_DATE GE '&&FXDATE.EVAL'  AND INVOICE_DATE LE '&&PYTDDATE.EVAL' THEN 'Y' ELSE 'N';
PQ/A1      = IF INVOICE_DATE GE '&&PQFMDT.EVAL'  AND INVOICE_DATE LE '&&PQTODT.EVAL'   THEN 'Y' ELSE 'N';	
CQ/A1      = IF INVOICE_DATE GE '&&CQFMDT.EVAL'  AND INVOICE_DATE LE '&&CQTODT.EVAL'   THEN 'Y' ELSE 'N';	
