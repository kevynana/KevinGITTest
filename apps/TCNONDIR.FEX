-*  08/23/2016  REJ  S-17914 Changes for ER5.
-*  12/29/2016  REJ  S-28553 Move ER5 My Reports to production.
-* 03/14/17 JEM S-22486 - updated position of header and footer NEW_HDR NEW_FTR

-INCLUDE SETECHO
 
CREATE FILE TCRANK
-RUN
 
-INCLUDE TCGETROLL
-RUN
 
-INCLUDE SetParmtime
-RUN
 
-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT;
EX TCAIRDB
-RUN
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop2;
 
EX TCNONDEX
-RUN
-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE AVRP_SUBFOOT
-:AVSF0
 
-**************************************************************
-* GET THE FINAL REPORT
-**************************************************************
TABLE FILE TCRANK
BY ROLLCD
SUM NET_TKT_CNT AS 'TTMRK'
    FARE        AS 'TTFARE'
ON TABLE HOLD AS PASS1 FORMAT FOCUS INDEX ROLLCD
END
 
TABLE FILE PASS1
RANKED BY HIGHEST TTMRK
       BY TTFARE
       BY ROLLCD
ON TABLE HOLD AS PASS2 FORMAT FOCUS INDEX ROLLCD
END
 
JOIN ROLLCD IN TCRANK TO ROLLCD IN PASS2
 
DEFINE FILE TCRANK
XL01/P9.2 = IF ((TTMRK LT 1) AND (TTMRK GT (-1))) THEN 0 ELSE
            (NET_TKT_CNT/TTMRK) * 100 ;
XL02/P9.2 = IF ((TTFARE LT 1) AND (TTFARE GT (-1))) THEN 0 ELSE
            (FARE/TTFARE) * 100 ;
NOWTOD/A8 WITH ROLLCD = HHMMSS (NOWTOD);
END
TABLE FILE TCRANK
BY RANK           AS 'RANK'
BY ROLLCD         AS 'CLIENT'
BY RANK_VALUE     AS 'RNK'
BY AIRLINE_PRINT  AS 'CARRIER'
SUM NET_TKT_CNT   AS 'TMARKETS'
    XL01          AS 'PERMRK'
    FARE          AS 'BASE'
    XL02          AS 'PERFARE'
    AVG_FLT       AS 'AVG'
    MILES         AS 'TMILES'
    COST_PER_MILE AS 'COST'
ON TABLE HOLD FORMAT FOCUS
END
-RUN
 
TABLE FILE HOLD
SUM TMARKETS
    BASE
    TMILES
COMPUTE XCOST/P12.2 = IF ((TMILES LT 1) AND (TMILES GT (-1))) THEN 0 ELSE
                         (BASE/TMILES);
        XAVG/D12.2S = IF ((TMARKETS LT 1) AND (TMARKET GT (-1))) THEN 0 ELSE
                         (BASE/TMARKETS);
ON TABLE SAVE AS TT
END
-RUN
-READ TT &&TMRK.A8. &&BASE.A12. &&MILES.A9. &&COST.A12. &&AVG.A12.
-RUN
-*============
DEFINE FILE HOLD
XL01A/A8 = '&&TMRK' ;
XL01B/I8 = EDIT(XL01A);
XL01C/P9.2 = IF ((XL01B LT 1) AND (XL01B GT (-1))) THEN 0 ELSE
                ((TMARKETS/XL01B) * 100);
 
XL02A/A12 = '&&BASE' ;
XL02B/P12.2 = EDIT(XL02A);
XL02C/P9.2  = IF ((XL02B LT 1) AND (XL02B GT (-1))) THEN 0 ELSE
                 ((BASE/XL02B) * 100);
 
END
TABLE FILE HOLD
BY  CARRIER
SUM TMARKETS/I9
    XL01C AS 'PMARK'
    BASE/P12.2
    XL02C AS 'PBASE'
    TMILES/I9        AS 'MILES'
ON TABLE HOLD AS HOLD1
END
-RUN
-*============
DEFINE FILE HOLD1
NOWTOD/A8 = HHMMSS (NOWTOD);
END
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS';
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
 
TABLE FILE HOLD1
-INCLUDE &&PAHDR
"&&SUBHEAD"
-*-IF &&PAHDR EQ 'HDREXLS' GOTO NOSPC;
-*"</1"
-*-NOSPC;
SUM
-* CARRIER 	     AS 'CARRIER'
    TMARKETS/I9C      AS 'TOTAL,MARKETS'       IN +8
    PMARK            AS '% OF,MRK'            IN +8
    BASE/P12.2C       AS 'BASE,FARE'           IN +8
    PBASE            AS '% OF,FARE'           IN +8
COMPUTE XL03/P12.2C = IF ((TMARKETS LT 1) AND (TMARKETS GT (-1))) THEN 0 ELSE
                     BASE/TMARKETS ; AS 'AVG,FLIGHT,PRICE'    IN +8
    TMILES/I9C        AS 'TOTAL,MILES'         IN +8
COMPUTE XL04/D12.2SC = IF ((TMILES LT 1) AND (TMILES GT (-1))) THEN 0 ELSE
                         BASE/TMILES; AS 'COST,/MILE'  IN +8
BY HIGHEST TMARKETS NOPRINT
BY CARRIER AS 'CARRIER'
ON CARRIER RECOMPUTE MULTILINES TMARKETS BASE XL03 TMILES XL04
FOOTING
-INCLUDE FOOTERSM1
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
-* ON TABLE SUBFOOT
-* "--------  <16 --------- <38 ------------- <60  --------------
-* <73 ----------- <84 ------------"
-* "TOTALS    <16 &&TMRK <37 &&BASE   <60  &&AVG <73 &&MILES   <84 &&COST"
-* " "
-* " "
-* ON TABLE SET COMPOUND OPEN
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
-GOTO JOY
-INCLUDE GLOBAL_LOGO_SM
 
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.100000, RIGHTMARGIN=0.030000,
    TOPMARGIN=0.300000, BOTTOMMARGIN=0.050000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FONT='ARIAL', SIZE=8, BACKCOLOR=NONE, STYLE=NORMAL, $
-* TYPE=HEADING, OBJECT=TEXT, SIZE=8, COLOR=BLACK, $
-* TYPE=HEADING, LINE=4, SIZE=9, STYLE=BOLD, COLOR=GREY, $
-* TYPE=HEADING, LINE=5, SIZE=9, STYLE=BOLD, COLOR=GREY, $
-* TYPE=HEADING, LINE=6, SIZE=9, STYLE=BOLD, COLOR=GREY, $
-* TYPE=HEADING, LINE=7, SIZE=9, STYLE=BOLD, COLOR=GREY, $
-* TYPE=HEADING, LINE=8, SIZE=9, STYLE=BOLD, COLOR=GREY, $
-* TYPE=HEADING, LINE=10, SIZE=9, STYLE=BOLD, COLOR=GREY, $
-* TYPE=HEADING, LINE=11, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
-* TYPE=HEADING, LINE=12, SIZE=12, STYLE=BOLD+ITALIC, FONT=COURIER NEW, $
 
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),$
-* TYPE=HEADING, LINE=4,  SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),  $
-* TYPE=HEADING, LINE=5, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),  $
TYPE=HEADING, LINE=8, SIZE=10, JUSTIFY=LEFT, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),  $
TYPE=HEADING, LINE=9, SIZE=10, JUSTIFY=LEFT, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),  $
TYPE=SUBHEAD, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),$
 
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
TYPE=TABFOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
 
TYPE=TITLE, STYLE=BOLD, $
-* TYPE=SUBFOOT, SIZE=8, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=8, STYLE=BOLD, $
TYPE=GRANDTOTAL, SIZE=8, STYLE=BOLD, $
 
TYPE=REPORT, IMAGE=NEW_HDR.jpg, POSITION=(0 0), SIZE=(2.8 .37),PRESERVERATIO=ON, $ 
TYPE=REPORT, IMAGE=NEW_FTR.jpg, POSITION=(0 8.0), SIZE=(10.5 .58), PRESERVERATIO=ON, $
TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&TNTDTPOS), SIZE=(&&ROLDTSIZ), $
-JOY
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
-GOTO XXIT;
 
DEFINE FILE HOLD
NOWTOD/A8 WITH CLIENT = HHMMSS (NOWTOD);
END
 
-SET &&PAHDR = IF '&&OUTFMT.EVAL' EQ 'PDF' OR 'PPT' OR 'COM' THEN 'HEADER' ELSE 'HDREXLS';
-SET &&PASTYS = IF '&&OUTFMT.EVAL' NE 'PDF' OR 'PPT' OR 'COM' THEN 'SMEXL' ELSE &&SMSTY;
 
TABLE FILE HOLD
-INCLUDE &&PAHDR
   &&S_SUBJ1
   &&S_SUBJ2
   &&S_SUBJ3
   &&S_SUBJ4
   &&S_SUBJ5
   &&S_SUBJ6
   &&S_SUBJ7
   &&S_SUBJ8
   &&S_SUBJ9
   &&S_SUBJ10
   &&S_TARG1
   &&S_TARG2
   &&S_TARG3
   &&S_TARG4
   &&S_TARG5
   &&S_TARG6
   &&S_TARG7
   &&S_TARG8
   &&S_TARG9
   &&S_TARG10
   &&SUMM_ON1
   &&SUMM_ON2
   &&SUMM_ON3
   &&SUMM_ON4
   &&SUMM_ON5
   &&SUMM_ON6
   &&SUMM_ON7
   &&SUMM_ON8
   &&SUMM_ON9
   &&SUMM_ON10
 
-INCLUDE FOOTERSM1
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
ON TABLE SET COMPOUND CLOSE
ON TABLE SET STYLE *
-INCLUDE &&PASTYS
ENDSTYLE
&&OUTLINE1
&&SUMMDEST
&&OUTLINE2
END
-RUN
 
-XXIT
-IF &LINES GT 0 THEN GOTO XXIT1;
EX TCEMPTY
-RUN
-XXIT1
