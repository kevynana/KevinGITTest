-*12/21/04 -DEB  - ADDED ADDTL DOD_TYPE TO IFLAG DEFINE
-*04/20/10   DEB                CHANGED ORIG_SALE DEFINE
-*1/31/14 UPDATED ONLINE/TRADITIONAL DEFINES TO USE ONLINE_TRADITIONAL FIELD INSTEAD OF DOD_TYPE
-*5/23/14   DEB   ADDED EX5 TO NUMEROUS DEFINES
-*  08/23/2016  REJ  S-17914 Changes for ER5.
-*  12/29/2016  REJ  S-28553 Move ER5 My Reports to production.
-* 03/09/17 JEM S-22486 - updated position of header and footer NEW_HDR NEW_FTR

 
-INCLUDE SETECHO
 
CREATE FILE TCTRAN
CREATE FILE TCTRN1
 
-RUN
 
-INCLUDE TCGETROLL
-RUN
 
-SET &CNT = 1;
-REPEAT Loop2 &TOTROLLS TIMES
-SET &&ROLL = &ROLL.&CNT;
 
-TYPE TCAIRDB
-SET &&PAIRDB = 'S';
EX TCAIRDB
-RUN
- IF &FOCERRNUM EQ 36 THEN GOTO IncLoop2;
 
EX TCTRNEX
-RUN
-IncLoop2
-SET &CNT = &CNT + 1;
-Loop2
 
-INCLUDE SetParmtime
-RUN
 
-IF &&FROMAVRP NE 'Y' GOTO :AVSF0;
-INCLUDE AVRP_SUBFOOT
-:AVSF0
 
-**************************************************************
-* GET THE FINAL REPORT
-**************************************************************
DEFINE FILE TCTRAN
FLAG/A8 = 'AAAAAAAA';
END
 
 
TABLE FILE TCTRAN
PRINT
   DOC_TYPE
   DOD_TYPE
   EMBARK
   EX_FLAG
   EXCHG_SALE
   DOD_DESC
   ONLINE_TRADITIONAL
   ROLLCD
   RF_FLAG
   SEG_AMT
   SEG_COM
   SEG_NBR
   SEG_TAX
   TRN_DATE
   VOID_DATE
   VOID_STATUS
BY FLAG
BY TKT_NUM
BY SEG_COUNT
ON TABLE HOLD AS TRANONE
END
-RUN
 
 
 
-SET &&RPTSUF = 'SMY';
-INCLUDE FDEFRPTS
-RUN
 
 
 
DEFINE FILE TRANONE
DOC1/A30 = 'Traditional Booking';
DOC2/A30 = 'Online Booking';
DOC3/A30 = 'Web Booking';
DOC4/A30 = 'Exchange from online Booking';
DOC5/A30 = 'Base Fare';
DOC6/A30 = 'Tax';
DOC7/A30=  'Total Fare';
DOC8/A30=  'Total Booking';
DOC9/A30=  'Grand Total Booking';
DOC10/A30= 'Grand Total Fare';
 
EMCO_TAX/D15 = IF DOC_TYPE EQ '1' AND EXCHG_SALE EQ 'E' THEN SEG_TAX
  ELSE 0;
EXCH_AMT/D15 = IF (DOC_TYPE EQ '1' AND EXCHG_SALE EQ 'E') THEN 0 ELSE IF
  ((EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK NE 'DT1' OR
  'RF1' OR 'FP3') AND (RF_FLAG EQ ' ')) OR ((SEG_COUNT GE 0) AND
  (EXCHG_SALE NE ' ')) OR (EMBARK EQ 'EX1' OR 'EX5') THEN SEG_AMT ELSE 0;
EXCH_MCO/D15 = IF DOC_TYPE EQ '1' AND EXCHG_SALE EQ 'E' THEN SEG_AMT
  ELSE 0;
EXCH_TAX/D15 = IF (DOC_TYPE EQ '1' AND EXCHG_SALE EQ 'E') THEN 0 ELSE IF
  ((EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK NE 'DT1' OR
  'RF1' OR 'FP3') AND (RF_FLAG EQ ' ')) OR ((SEG_COUNT GE 0) AND
  (EXCHG_SALE NE ' ')) OR (EMBARK EQ 'EX1' OR 'EX5') THEN SEG_TAX ELSE 0;
EXMCOS/D9 = IF (EX_FLAG NE ' ') AND (DOC_TYPE EQ '1') AND (EXCHG_SALE
	NE ' ') THEN 1 ELSE 0;
FARE_PAID/D15 = SEG_AMT + SEG_TAX;
FULL_RFNDS/D9 = IF ((VOID_DATE EQ 0) AND (RF_FLAG EQ 'F') AND (TKT_NUM
          NE LAST TKT_NUM) AND (SEG_COUNT LT 0)) THEN 1 ELSE 0;
IFLAG/A33 = IF ONLINE_TRADITIONAL EQ 'ONLINE' THEN 'ONLINE BOOKINGS' ELSE
            IF DOD_DESC CONTAINS 'EXCHANGE' THEN 'EXCHANGE FROM AN INTERNET BOOKING' ELSE
            IF DOD_DESC CONTAINS 'WEB' THEN 'WEB BOOKINGS' ELSE 'TRADITIONAL BOOKINGS';
NEW_SALES/D15 = IF (SEG_AMT GT 0) AND (SEG_COUNT GE 0) AND (EXCHG_SALE
  EQ ' ') AND (EMBARK NE 'EX1' OR 'RF1' OR 'EX5') THEN SEG_AMT ELSE 0;
NEW_TAX/D15 = IF ((SEG_TAX GT 0) AND (SEG_COUNT GE 0) AND (EXCHG_SALE EQ
  ' ') AND (EMBARK NE 'EX1' OR 'RF1' OR 'EX5')) THEN SEG_TAX ELSE 0;
NEW_TOTAL/D15 = NEW_SALES + NEW_TAX;
-*ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT
-* EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE IF (DOC_TYPE EQ '1') AND
-* (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') THEN 1 ELSE 0;
 
 
ORIG_SALE/D9 = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND
     (SEG_COUNT EQ 1) AND (EXCHG_SALE EQ ' ') THEN 1 ELSE
     IF (DOC_TYPE EQ '1') AND (EX_FLAG EQ ' ') AND (EXCHG_SALE NE ' ') AND
     (RF_FLAG EQ ' ') THEN 1 ELSE 0;
 
 
PART_RFNDS/D9 = IF ((VOID_DATE EQ 0) AND (RF_FLAG EQ 'P') AND (TKT_NUM
  NE LAST TKT_NUM) AND (SEG_COUNT LE 0)) THEN 1 ELSE 0;
REFUND_AMT/D15 = IF ((RF_FLAG EQ 'F' OR 'P') AND (EMBARK NE 'EX1' OR
  'FP2' OR 'EX5') AND (SEG_COUNT LE 0)) OR (EMBARK EQ 'RF1') THEN SEG_AMT ELSE 0;
REFUND_TAX/D15 = IF ((RF_FLAG EQ 'F' OR 'P') AND (EMBARK NE 'EX1' OR
  'FP2' OR 'EX5') AND (SEG_COUNT LE 0)) OR (EMBARK EQ 'RF1') THEN SEG_TAX ELSE 0;
REFUND_TOTAL/D15 = IF ((RF_FLAG EQ 'F' OR 'P') AND (EMBARK NE 'EX1' OR
  'FP2' OR 'EX5') AND (SEG_COUNT LE 0)) OR (EMBARK EQ 'RF1') THEN FARE_PAID ELSE 0;
REFUNDS/D9 = FULL_RFNDS + PART_RFNDS;
TKT_CNT/D8CS = IF (SEG_NBR EQ '01') AND (FARE_PAID GE 0) AND (SEG_COUNT
  EQ 1) THEN 1 ELSE 0;
 
 
TOTL/A15 = 'TOTAL NEW SALES';
 
TRAN_DT/MDYY = TRN_DATE;
VOID_AMT/D15 = IF VOID_DATE NE 0 THEN SEG_AMT ELSE 0;
VOID_TAX/D15 = IF VOID_DATE NE 0 THEN SEG_TAX ELSE 0;
VOID_TOTAL/D15 = IF VOID_DATE NE 0 THEN FARE_PAID ELSE 0;
VOIDS/D9 = IF (VOID_DATE NE 0) AND (SEG_COUNT EQ 1) AND (SEG_NBR EQ '01')
 THEN 1 ELSE IF (DOC_TYPE EQ '1' AND VOID_DATE NE 0) THEN 1 ELSE 0;
 
-* Defines on previous DEFINEs
TOT_ETAX/D15 = EXCH_TAX + EMCO_TAX;
TOT_EXCH/D15 = EXCH_AMT + EXCH_MCO;
EMCO_TOTAL/D15 = IF DOC_TYPE EQ '1' AND EXCHG_SALE EQ 'E' THEN FARE_PAID
  ELSE 0;
EXCHGS/D9 = IF (EX_FLAG EQ 'F' OR 'P') AND (SEG_COUNT LE 0) AND (EMBARK
 NE 'DT1' OR 'RF1' OR 'FP3') THEN TKT_CNT ELSE IF (DOC_TYPE EQ '1') AND
(EXCHG_SALE EQ 'E') THEN 0 ELSE IF (SEG_COUNT GE 0) AND (EXCHG_SALE NE
  ' ') THEN TKT_CNT ELSE 0;
EXCH_TOTAL/D15 = IF (DOC_TYPE EQ '1' AND EXCHG_SALE EQ 'E') THEN 0 ELSE
  IF (((EXCHG_SALE NE ' ') AND (SEG_COUNT GE 0)) OR ((EMBARK NE 'DT1' OR
  'RF1' OR 'FP3') AND (RF_FLAG EQ ' ') AND (EX_FLAG EQ 'F' OR 'P') AND
  (SEG_COUNT LE 0)) OR (EMBARK EQ 'EX1' OR 'EX5')) THEN FARE_PAID ELSE 0;
MCO_AMT/D15 = IF DOC_TYPE EQ '1' THEN NEW_SALES ELSE 0;
MCO_CNT/D9 = IF DOC_TYPE EQ '1' THEN ORIG_SALE ELSE 0;
MCO_TAX/D15 = IF DOC_TYPE EQ '1' THEN NEW_TAX ELSE 0;
MCO_TOTAL/D15 = IF DOC_TYPE EQ '1' THEN NEW_TOTAL ELSE 0;
MCOS/D9CS           = IF (DOC_TYPE EQ '1') AND
                           (EX_FLAG EQ ' ')  AND
                           (EXCHG_SALE NE ' ') THEN 1 ELSE 0;
NET_AMT/D15 = NEW_SALES + REFUND_AMT + TOT_EXCH - VOID_AMT;
NET_TAX/D15 = NEW_TAX + REFUND_TAX + TOT_ETAX - VOID_TAX;
TOTAL_EXCHG/D15 = EXCH_TOTAL + EMCO_TOTAL;
TOT_EXAMT/D15 = EXCH_AMT + EXCH_MCO;
TOT_EXTAX/D15 = EXCH_TAX + EMCO_TAX;
TOT_ECNT/D9 = EXCHGS + EXMCOS;
TOT_TRANS/D9 = ORIG_SALE + VOIDS + TOT_ECNT + REFUNDS;
CHARGE_TRN/D9 = ORIG_SALE + VOIDS + EXCHGS + REFUNDS;
 
-* Defines on previous DEFINEs
NET_AMT/D15 = NEW_SALES + REFUND_AMT + TOT_EXAMT - VOID_AMT;
NET_TAX/D15 = NEW_TAX + REFUND_TAX + TOT_EXTAX - VOID_TAX;
NET_TOTAL/D15 = NEW_TOTAL + REFUND_TOTAL + TOTAL_EXCHG - VOID_TOTAL;
NET_TRAN/D15 = ORIG_SALE + EXCHGS - REFUNDS - VOIDS;
 
 
NOWTOD/A8 WITH ROLLCD = HHMMSS (NOWTOD);
 
END
-RUN
 
 
-* -INCLUDE FDEFRPTS
-* -RUN
 
-* Traditional ticket count by rollup
TABLE FILE TRANONE
SUM DOC1/A30
ORIG_SALE/D15
EXCHGS/D15
EXMCOS/D15
REFUNDS/D15
MCOS/D15
VOIDS/D15
TOT_TRANS/D15
BY FLAG
WHERE IFLAG EQ 'TRADITIONAL BOOKINGS'
ON TABLE HOLD AS 'TRADBK'
END
-RUN
 
DEFINE FILE TRADBK
CATEGORY/A30 = 'Ticket Count';
CAT_ORDER/I2 = 1
END
-RUN
 
 
TABLE FILE TRADBK
PRINT FLAG/A30 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC1/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND ORIG_SALE/D15 AS 'TNEWSLS'
AND EXCHGS/D15 AS 'TEXCHSLS' AND EXMCOS/D15 AS 'TEXCMCOS' AND
REFUNDS/D15 AS 'TREFUND' AND MCOS/D15 AS 'TMCO' AND VOIDS/D15 AS 'TVOIDS'
AND TOT_TRANS/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 1;
ON TABLE HOLD AS TRADBK1
END
-RUN
 
TABLE FILE TRADBK1
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS TRADBK2
END
MODIFY FILE TCTRN1
FIXFORM FROM TRADBK2
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON TRADBK2
END
-RUN
 
 
 
-* Online ticket count by rollup
 
 
TABLE FILE TRANONE
SUM DOC2/A30
ORIG_SALE/D15
EXCHGS/D15
EXMCOS/D15
REFUNDS/D15
MCOS/D15
VOIDS/D15
TOT_TRANS/D15
BY FLAG
WHERE IFLAG EQ 'ONLINE BOOKINGS'
ON TABLE HOLD AS 'ONLBK'
END
-RUN
 
 
 
DEFINE FILE ONLBK
CATEGORY/A30 = 'Ticket Count';
CAT_ORDER/I2 = 1
END
-RUN
 
 
TABLE FILE ONLBK
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC2/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND ORIG_SALE/D15 AS 'TNEWSLS'
AND EXCHGS/D15 AS 'TEXCHSLS' AND EXMCOS/D15 AS 'TEXCMCOS' AND
REFUNDS/D15 AS 'TREFUND' AND MCOS/D15 AS 'TMCO' AND VOIDS/D15 AS 'TVOIDS'
AND TOT_TRANS/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 2;
ON TABLE HOLD AS ONLBK1
END
-RUN
 
TABLE FILE ONLBK1
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS ONLBK2
END
MODIFY FILE TCTRN1
FIXFORM FROM ONLBK2
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON ONLBK2
END
-RUN
 
-* Web Booking ticket count by rollup
 
TABLE FILE TRANONE
SUM DOC3/A30
ORIG_SALE/D15
EXCHGS/D15
EXMCOS/D15
REFUNDS/D15
MCOS/D15
VOIDS/D15
TOT_TRANS/D15
BY FLAG
WHERE IFLAG EQ 'WEB BOOKINGS'
ON TABLE HOLD AS 'WEBBK'
END
-RUN
 
 
 
DEFINE FILE WEBBK
CATEGORY/A30 = 'Ticket Count';
CAT_ORDER/I2 = 1
END
-RUN
 
 
TABLE FILE WEBBK
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC3/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND ORIG_SALE/D15 AS 'TNEWSLS'
AND EXCHGS/D15 AS 'TEXCHSLS' AND EXMCOS/D15 AS 'TEXCMCOS' AND
REFUNDS/D15 AS 'TREFUND' AND MCOS/D15 AS 'TMCO' AND VOIDS/D15 AS 'TVOIDS'
AND TOT_TRANS/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 3;
ON TABLE HOLD AS WEBBK1
END
-RUN
 
TABLE FILE WEBBK1
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS WEBBK2
END
MODIFY FILE TCTRN1
FIXFORM FROM WEBBK2
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON WEBBK2
END
-RUN
 
 
 
-* Exchange from Online ticket count by rollup
 
TABLE FILE TRANONE
SUM DOC4/A30
ORIG_SALE/D15
EXCHGS/D15
EXMCOS/D15
REFUNDS/D15
MCOS/D15
VOIDS/D15
TOT_TRANS/D15
BY FLAG
WHERE IFLAG EQ 'EXCHANGE FROM AN INTERNET BOOKING'
ON TABLE HOLD AS 'EXINBK'
END
-RUN
 
 
 
DEFINE FILE EXINBK
CATEGORY/A30 = 'Ticket Count';
CAT_ORDER/I2 = 1
END
-RUN
 
 
TABLE FILE EXINBK
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC4/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND ORIG_SALE/D15 AS 'TNEWSLS'
AND EXCHGS/D15 AS 'TEXCHSLS' AND EXMCOS/D15 AS 'TEXCMCOS' AND
REFUNDS/D15 AS 'TREFUND' AND MCOS/D15 AS 'TMCO' AND VOIDS/D15 AS 'TVOIDS'
AND TOT_TRANS/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 4;
ON TABLE HOLD AS EXINBK1
END
-RUN
 
TABLE FILE EXINBK1
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS EXINBK2
END
MODIFY FILE TCTRN1
FIXFORM FROM EXINBK2
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON EXINBK2
END
-RUN
 
 
 
 
TABLE FILE TRANONE
SUM
DOC5/A30
DOC6/A30
DOC7/A30
DOC8/A30
ORIG_SALE/D15
EXCHGS/D15
EXMCOS/D15
REFUNDS/D15
MCOS/D15
VOIDS/D15
TOT_TRANS/D15
NEW_SALES/D15
NEW_TAX/D15
NEW_TOTAL/D15
EXCH_AMT/D15
EXCH_TAX/D15
EXCH_TOTAL/D15
EXCH_MCO/D15
EMCO_TAX/D15
EMCO_TOTAL/D15
REFUND_AMT/D15
REFUND_TAX/D15
REFUND_TOTAL/D15
MCO_AMT/D15
MCO_TAX/D15
MCO_TOTAL/D15
VOID_AMT/D15
VOID_TAX/D15
VOID_TOTAL/D15
NET_AMT/D15
NET_TAX/D15
NET_TOTAL/D15
BY FLAG
ON TABLE HOLD AS TRANTWO
END
-RUN
 
-* Total Ticket count by rollup
 
DEFINE FILE TRANTWO
CATEGORY/A30 = 'Ticket Count';
CAT_ORDER/I2 = 1
END
-RUN
 
 
TABLE FILE TRANTWO
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC8/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND ORIG_SALE/D15 AS 'TNEWSLS'
AND EXCHGS/D15 AS 'TEXCHSLS' AND EXMCOS/D15 AS 'TEXCMCOS' AND
REFUNDS/D15 AS 'TREFUND' AND MCOS/D15 AS 'TMCO' AND VOIDS/D15 AS 'TVOIDS'
AND TOT_TRANS/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 5;
ON TABLE HOLD AS TCNTTTL
END
-RUN
 
TABLE FILE TCNTTTL
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS TCNTTTL1
END
MODIFY FILE TCTRN1
FIXFORM FROM TCNTTTL1
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON TCNTTTL1
END
-RUN
 
-* Total Base fare by rollup
 
DEFINE FILE TRANTWO
CATEGORY/A30 = 'Fare';
CAT_ORDER/I2 = 2
END
-RUN
 
 
TABLE FILE TRANTWO
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC5/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND NEW_SALES/D15C AS 'TNEWSLS'
AND EXCH_AMT/D15C AS 'TEXCHSLS' AND EXCH_MCO/D15C AS 'TEXCMCOS' AND
REFUND_AMT/D15C AS 'TREFUND' AND MCO_AMT/D15C AS 'TMCO' AND VOID_AMT/D15C AS 'TVOIDS'
AND NET_AMT/D15C AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 1;
ON TABLE HOLD AS BFARE
END
-RUN
 
TABLE FILE BFARE
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS BFARE1
END
MODIFY FILE TCTRN1
FIXFORM FROM BFARE1
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON BFARE1
END
-RUN
 
 
 
-* Total tax by rollup
 
DEFINE FILE TRANTWO
CATEGORY/A30 = 'Fare';
CAT_ORDER/I2 = 2
END
-RUN
 
 
TABLE FILE TRANTWO
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC6/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND NEW_TAX/D15 AS 'TNEWSLS'
AND EXCH_TAX/D15 AS 'TEXCHSLS' AND EMCO_TAX/D15 AS 'TEXCMCOS' AND
REFUND_TAX/D15 AS 'TREFUND' AND MCO_TAX/D15 AS 'TMCO' AND VOID_TAX/D15 AS 'TVOIDS'
AND NET_TAX/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 2;
ON TABLE HOLD AS TAX
END
-RUN
 
TABLE FILE TAX
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS TAX1
END
MODIFY FILE TCTRN1
FIXFORM FROM TAX1
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON TAX1
END
-RUN
 
-* Total fare paid by rollup
 
DEFINE FILE TRANTWO
CATEGORY/A30 = 'Fare';
CAT_ORDER/I2 = 2
END
-RUN
 
 
TABLE FILE TRANTWO
PRINT FLAG/A8 AS 'ROLLCD' AND CATEGORY/A30 AND
DOC7/A30 AS 'ROW_LABEL' AND CAT_ORDER/I2 AND NEW_TOTAL/D15 AS 'TNEWSLS'
AND EXCH_TOTAL/D15 AS 'TEXCHSLS' AND EMCO_TOTAL/D15 AS 'TEXCMCOS' AND
REFUND_TOTAL/D15 AS 'TREFUND' AND MCO_TOTAL/D15 AS 'TMCO' AND
VOID_TOTAL/D15 AS 'TVOIDS' AND NET_TOTAL/D15 AS 'TTRANS' AND
COMPUTE ROW_ORDER/I2 = 3;
ON TABLE HOLD AS TFARE
END
-RUN
 
TABLE FILE TFARE
PRINT ROLLCD AND CATEGORY AND ROW_LABEL
      AND CAT_ORDER AND ROW_ORDER AND TNEWSLS AND TEXCHSLS
      AND TEXCMCOS AND TREFUND AND TMCO AND TVOIDS
      AND TTRANS
ON TABLE HOLD AS TFARE1
END
MODIFY FILE TCTRN1
FIXFORM FROM TFARE1
MATCH ROLLCD CATEGORY ROW_LABEL
ON MATCH REJECT
ON NOMATCH INCLUDE
DATA ON TFARE1
END
-RUN
 
 
 
 
 
 
-*-SET &&HEADING = 'TRANSACTION SUMMARY BY BOOKING TYPE';
-SET &FMM=EDIT(&&FROMDT,'$$$$$$99');
-SET &FMD=EDIT(&&FROMDT,'$$$$$$$$$99');
-SET &FMY=EDIT(&&FROMDT,'$9999');
-SET &TOM=EDIT(&&TODT,'$$$$$$99');
-SET &TOD=EDIT(&&TODT,'$$$$$$$$$99');
-SET &TOY=EDIT(&&TODT,'$9999');
 
 
-INCLUDE FDEFRPTS
-RUN
 
 
 
 
DEFINE FILE TCTRN1
ROLLCDX/A14 = IF ROLLCD EQ 'AAAAAAAA' THEN 'COMBINED TOTAL' ELSE ' ';
KEY/A1 = IF TCTRN1.ROW_LABEL CONTAINS 'Total' THEN 'A' ELSE 'B';
NOWTOD/A8 WITH CAT_ORDER = HHMMSS (NOWTOD);
END
-RUN
 
 
 
TABLE FILE TCTRN1
PRINT
      TCTRN1.ROW_LABEL AS ''
      TCTRN1.TNEWSLS AS 'NEW,SALES'
      TCTRN1.TEXCHSLS AS 'EXCHANGE,SALES'
      TCTRN1.TEXCMCOS AS 'EXCHANGE,MCOS'
      TCTRN1.TREFUND AS 'REFUNDS'
      TCTRN1.TMCO AS 'MCOS'
      TCTRN1.TVOIDS AS 'VOIDS'
      TCTRN1.TTRANS AS 'TOTALS'
BY TCTRN1.ROLLCDX AS 'ROLLUP'
BY TCTRN1.CAT_ORDER NOPRINT
BY TCTRN1.ROW_ORDER NOPRINT
BY KEY NOPRINT
ON TABLE NOTOTAL
ON TABLE SET PAGE-NUM OFF
ON TCTRN1.ROLLCDX SKIP-LINE
ON TCTRN1.CAT_ORDER SKIP-LINE
 
-GOTO HEAD
 
-HEAD
HEADING
-* "</3"
-* "</5"
-* " "
-* "<20 &&RPT_TTL1"
-* "<20 &&RPT_TTL2"
-* " "
-* " "
-* " <35 &FMM/&FMD/&FMY - &TOM/&TOD/&TOY"
-INCLUDE HEADER
"</2"
FOOTING BOTTOM
"NOTE:"
" ** TOTALS EXCLUDES MCOS ** "
"Post-trip Reporting &DATE AT <NOWTOD <60 &&FOOTR"
-* "Copyright (c) 1996-2004, Travel and Transport - Confidential/Proprietary"
ON TABLE SET PAGE-NUM OFF
ON TABLE NOTOTAL
ON TABLE PAGE-BREAK AND SUBFOOT
-INCLUDE SBFOOT
 
ON TABLE SET STYLE *
UNITS=IN, PAGESIZE='Letter', LEFTMARGIN=0.500000, RIGHTMARGIN=0.250000,
    TOPMARGIN=0.500000, BOTTOMMARGIN=0.250000, SQUEEZE=ON,
    ORIENTATION=LANDSCAPE, $
TYPE=REPORT, FOCEXEC=NONE, FONT=TIMES NEW ROMAN, SIZE=9, COLOR=BLACK,
    BACKCOLOR=NONE, STYLE=NORMAL, $
TYPE=DATA, COLUMN=N5, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N6, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N7, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N8, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N9, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N10, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N11, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=DATA, COLUMN=N12, SIZE=9, STYLE=BOLD, WHEN=KEY EQ 'A', $
TYPE=HEADING, SIZE=8, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),$
TYPE=HEADING, LINE=8, SIZE=10, JUSTIFY=LEFT, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),  $
TYPE=HEADING, LINE=9, SIZE=10, JUSTIFY=LEFT, STYLE=BOLD, FONT='ARIAL', COLOR=RGB(70 136 177),  $
TYPE=FOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177), $
TYPE=TABFOOTING, SIZE=7, FONT='ARIAL', COLOR=RGB(70 136 177),$
TYPE=TITLE, STYLE=BOLD, $
TYPE=SUBFOOT, SIZE=9, STYLE=BOLD, $
TYPE=SUBTOTAL, SIZE=9, STYLE=BOLD, $
TYPE=GRANDTOTAL, SIZE=9, STYLE=BOLD, $
TYPE=REPORT, IMAGE=NEW_HDR.jpg, POSITION=(0 0), SIZE=(2.8 .37),PRESERVERATIO=ON, $ 
TYPE=REPORT, IMAGE=NEW_FTR.jpg, POSITION=(0 8.0), SIZE=(10.5 .58), PRESERVERATIO=ON, $       

TYPE=REPORT, IMAGE=&&ROLLPIC, POSITION=(&&TNTDTPOS), SIZE=(&&ROLDTSIZ), $
ENDSTYLE
&&OUTLINE1
&&OUTPUTDEST
&&OUTLINE2
-*
END
-RUN
 
 
 
 
 
 
-IF &LINES GT 0 THEN GOTO XXIT;
EX TCEMPTY
-RUN
-XXIT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
